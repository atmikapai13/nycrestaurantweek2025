(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))P(L);new MutationObserver(L=>{for(const B of L)if(B.type==="childList")for(const K of B.addedNodes)K.tagName==="LINK"&&K.rel==="modulepreload"&&P(K)}).observe(document,{childList:!0,subtree:!0});function v(L){const B={};return L.integrity&&(B.integrity=L.integrity),L.referrerPolicy&&(B.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?B.credentials="include":L.crossOrigin==="anonymous"?B.credentials="omit":B.credentials="same-origin",B}function P(L){if(L.ep)return;L.ep=!0;const B=v(L);fetch(L.href,B)}})();var k7=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function A7(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var q3={exports:{}},gy={},G3={exports:{}},kn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ff=Symbol.for("react.element"),S7=Symbol.for("react.portal"),T7=Symbol.for("react.fragment"),P7=Symbol.for("react.strict_mode"),M7=Symbol.for("react.profiler"),E7=Symbol.for("react.provider"),C7=Symbol.for("react.context"),D7=Symbol.for("react.forward_ref"),I7=Symbol.for("react.suspense"),z7=Symbol.for("react.memo"),L7=Symbol.for("react.lazy"),Wk=Symbol.iterator;function R7(c){return c===null||typeof c!="object"?null:(c=Wk&&c[Wk]||c["@@iterator"],typeof c=="function"?c:null)}var Y3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H3=Object.assign,Z3={};function Fd(c,m,v){this.props=c,this.context=m,this.refs=Z3,this.updater=v||Y3}Fd.prototype.isReactComponent={};Fd.prototype.setState=function(c,m){if(typeof c!="object"&&typeof c!="function"&&c!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,c,m,"setState")};Fd.prototype.forceUpdate=function(c){this.updater.enqueueForceUpdate(this,c,"forceUpdate")};function K3(){}K3.prototype=Fd.prototype;function Kw(c,m,v){this.props=c,this.context=m,this.refs=Z3,this.updater=v||Y3}var Xw=Kw.prototype=new K3;Xw.constructor=Kw;H3(Xw,Fd.prototype);Xw.isPureReactComponent=!0;var Nk=Array.isArray,X3=Object.prototype.hasOwnProperty,Qw={current:null},Q3={key:!0,ref:!0,__self:!0,__source:!0};function eA(c,m,v){var P,L={},B=null,K=null;if(m!=null)for(P in m.ref!==void 0&&(K=m.ref),m.key!==void 0&&(B=""+m.key),m)X3.call(m,P)&&!Q3.hasOwnProperty(P)&&(L[P]=m[P]);var o=arguments.length-2;if(o===1)L.children=v;else if(1<o){for(var _e=Array(o),Ie=0;Ie<o;Ie++)_e[Ie]=arguments[Ie+2];L.children=_e}if(c&&c.defaultProps)for(P in o=c.defaultProps,o)L[P]===void 0&&(L[P]=o[P]);return{$$typeof:ff,type:c,key:B,ref:K,props:L,_owner:Qw.current}}function B7(c,m){return{$$typeof:ff,type:c.type,key:m,ref:c.ref,props:c.props,_owner:c._owner}}function eb(c){return typeof c=="object"&&c!==null&&c.$$typeof===ff}function W7(c){var m={"=":"=0",":":"=2"};return"$"+c.replace(/[=:]/g,function(v){return m[v]})}var Fk=/\/+/g;function I0(c,m){return typeof c=="object"&&c!==null&&c.key!=null?W7(""+c.key):m.toString(36)}function L_(c,m,v,P,L){var B=typeof c;(B==="undefined"||B==="boolean")&&(c=null);var K=!1;if(c===null)K=!0;else switch(B){case"string":case"number":K=!0;break;case"object":switch(c.$$typeof){case ff:case S7:K=!0}}if(K)return K=c,L=L(K),c=P===""?"."+I0(K,0):P,Nk(L)?(v="",c!=null&&(v=c.replace(Fk,"$&/")+"/"),L_(L,m,v,"",function(Ie){return Ie})):L!=null&&(eb(L)&&(L=B7(L,v+(!L.key||K&&K.key===L.key?"":(""+L.key).replace(Fk,"$&/")+"/")+c)),m.push(L)),1;if(K=0,P=P===""?".":P+":",Nk(c))for(var o=0;o<c.length;o++){B=c[o];var _e=P+I0(B,o);K+=L_(B,m,v,_e,L)}else if(_e=R7(c),typeof _e=="function")for(c=_e.call(c),o=0;!(B=c.next()).done;)B=B.value,_e=P+I0(B,o++),K+=L_(B,m,v,_e,L);else if(B==="object")throw m=String(c),Error("Objects are not valid as a React child (found: "+(m==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":m)+"). If you meant to render a collection of children, use an array instead.");return K}function g_(c,m,v){if(c==null)return c;var P=[],L=0;return L_(c,P,"","",function(B){return m.call(v,B,L++)}),P}function N7(c){if(c._status===-1){var m=c._result;m=m(),m.then(function(v){(c._status===0||c._status===-1)&&(c._status=1,c._result=v)},function(v){(c._status===0||c._status===-1)&&(c._status=2,c._result=v)}),c._status===-1&&(c._status=0,c._result=m)}if(c._status===1)return c._result.default;throw c._result}var yr={current:null},R_={transition:null},F7={ReactCurrentDispatcher:yr,ReactCurrentBatchConfig:R_,ReactCurrentOwner:Qw};function tA(){throw Error("act(...) is not supported in production builds of React.")}kn.Children={map:g_,forEach:function(c,m,v){g_(c,function(){m.apply(this,arguments)},v)},count:function(c){var m=0;return g_(c,function(){m++}),m},toArray:function(c){return g_(c,function(m){return m})||[]},only:function(c){if(!eb(c))throw Error("React.Children.only expected to receive a single React element child.");return c}};kn.Component=Fd;kn.Fragment=T7;kn.Profiler=M7;kn.PureComponent=Kw;kn.StrictMode=P7;kn.Suspense=I7;kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F7;kn.act=tA;kn.cloneElement=function(c,m,v){if(c==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+c+".");var P=H3({},c.props),L=c.key,B=c.ref,K=c._owner;if(m!=null){if(m.ref!==void 0&&(B=m.ref,K=Qw.current),m.key!==void 0&&(L=""+m.key),c.type&&c.type.defaultProps)var o=c.type.defaultProps;for(_e in m)X3.call(m,_e)&&!Q3.hasOwnProperty(_e)&&(P[_e]=m[_e]===void 0&&o!==void 0?o[_e]:m[_e])}var _e=arguments.length-2;if(_e===1)P.children=v;else if(1<_e){o=Array(_e);for(var Ie=0;Ie<_e;Ie++)o[Ie]=arguments[Ie+2];P.children=o}return{$$typeof:ff,type:c.type,key:L,ref:B,props:P,_owner:K}};kn.createContext=function(c){return c={$$typeof:C7,_currentValue:c,_currentValue2:c,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},c.Provider={$$typeof:E7,_context:c},c.Consumer=c};kn.createElement=eA;kn.createFactory=function(c){var m=eA.bind(null,c);return m.type=c,m};kn.createRef=function(){return{current:null}};kn.forwardRef=function(c){return{$$typeof:D7,render:c}};kn.isValidElement=eb;kn.lazy=function(c){return{$$typeof:L7,_payload:{_status:-1,_result:c},_init:N7}};kn.memo=function(c,m){return{$$typeof:z7,type:c,compare:m===void 0?null:m}};kn.startTransition=function(c){var m=R_.transition;R_.transition={};try{c()}finally{R_.transition=m}};kn.unstable_act=tA;kn.useCallback=function(c,m){return yr.current.useCallback(c,m)};kn.useContext=function(c){return yr.current.useContext(c)};kn.useDebugValue=function(){};kn.useDeferredValue=function(c){return yr.current.useDeferredValue(c)};kn.useEffect=function(c,m){return yr.current.useEffect(c,m)};kn.useId=function(){return yr.current.useId()};kn.useImperativeHandle=function(c,m,v){return yr.current.useImperativeHandle(c,m,v)};kn.useInsertionEffect=function(c,m){return yr.current.useInsertionEffect(c,m)};kn.useLayoutEffect=function(c,m){return yr.current.useLayoutEffect(c,m)};kn.useMemo=function(c,m){return yr.current.useMemo(c,m)};kn.useReducer=function(c,m,v){return yr.current.useReducer(c,m,v)};kn.useRef=function(c){return yr.current.useRef(c)};kn.useState=function(c){return yr.current.useState(c)};kn.useSyncExternalStore=function(c,m,v){return yr.current.useSyncExternalStore(c,m,v)};kn.useTransition=function(){return yr.current.useTransition()};kn.version="18.3.1";G3.exports=kn;var ta=G3.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O7=ta,$7=Symbol.for("react.element"),j7=Symbol.for("react.fragment"),V7=Object.prototype.hasOwnProperty,U7=O7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J7={key:!0,ref:!0,__self:!0,__source:!0};function iA(c,m,v){var P,L={},B=null,K=null;v!==void 0&&(B=""+v),m.key!==void 0&&(B=""+m.key),m.ref!==void 0&&(K=m.ref);for(P in m)V7.call(m,P)&&!J7.hasOwnProperty(P)&&(L[P]=m[P]);if(c&&c.defaultProps)for(P in m=c.defaultProps,m)L[P]===void 0&&(L[P]=m[P]);return{$$typeof:$7,type:c,key:B,ref:K,props:L,_owner:U7.current}}gy.Fragment=j7;gy.jsx=iA;gy.jsxs=iA;q3.exports=gy;var gt=q3.exports,nA={exports:{}},Zr={},aA={exports:{}},rA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(c){function m(jt,bi){var Ht=jt.length;jt.push(bi);e:for(;0<Ht;){var vn=Ht-1>>>1,Wn=jt[vn];if(0<L(Wn,bi))jt[vn]=bi,jt[Ht]=Wn,Ht=vn;else break e}}function v(jt){return jt.length===0?null:jt[0]}function P(jt){if(jt.length===0)return null;var bi=jt[0],Ht=jt.pop();if(Ht!==bi){jt[0]=Ht;e:for(var vn=0,Wn=jt.length,Rr=Wn>>>1;vn<Rr;){var Za=2*(vn+1)-1,mn=jt[Za],An=Za+1,Un=jt[An];if(0>L(mn,Ht))An<Wn&&0>L(Un,mn)?(jt[vn]=Un,jt[An]=Ht,vn=An):(jt[vn]=mn,jt[Za]=Ht,vn=Za);else if(An<Wn&&0>L(Un,Ht))jt[vn]=Un,jt[An]=Ht,vn=An;else break e}}return bi}function L(jt,bi){var Ht=jt.sortIndex-bi.sortIndex;return Ht!==0?Ht:jt.id-bi.id}if(typeof performance=="object"&&typeof performance.now=="function"){var B=performance;c.unstable_now=function(){return B.now()}}else{var K=Date,o=K.now();c.unstable_now=function(){return K.now()-o}}var _e=[],Ie=[],pt=1,dt=null,Xe=3,zt=!1,St=!1,He=!1,yi=typeof setTimeout=="function"?setTimeout:null,Ee=typeof clearTimeout=="function"?clearTimeout:null,Ae=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Oe(jt){for(var bi=v(Ie);bi!==null;){if(bi.callback===null)P(Ie);else if(bi.startTime<=jt)P(Ie),bi.sortIndex=bi.expirationTime,m(_e,bi);else break;bi=v(Ie)}}function vt(jt){if(He=!1,Oe(jt),!St)if(v(_e)!==null)St=!0,Ui(Ot);else{var bi=v(Ie);bi!==null&&nn(vt,bi.startTime-jt)}}function Ot(jt,bi){St=!1,He&&(He=!1,Ee(ri),ri=-1),zt=!0;var Ht=Xe;try{for(Oe(bi),dt=v(_e);dt!==null&&(!(dt.expirationTime>bi)||jt&&!ci());){var vn=dt.callback;if(typeof vn=="function"){dt.callback=null,Xe=dt.priorityLevel;var Wn=vn(dt.expirationTime<=bi);bi=c.unstable_now(),typeof Wn=="function"?dt.callback=Wn:dt===v(_e)&&P(_e),Oe(bi)}else P(_e);dt=v(_e)}if(dt!==null)var Rr=!0;else{var Za=v(Ie);Za!==null&&nn(vt,Za.startTime-bi),Rr=!1}return Rr}finally{dt=null,Xe=Ht,zt=!1}}var Qt=!1,ti=null,ri=-1,oi=5,Yt=-1;function ci(){return!(c.unstable_now()-Yt<oi)}function Bn(){if(ti!==null){var jt=c.unstable_now();Yt=jt;var bi=!0;try{bi=ti(!0,jt)}finally{bi?Ki():(Qt=!1,ti=null)}}else Qt=!1}var Ki;if(typeof Ae=="function")Ki=function(){Ae(Bn)};else if(typeof MessageChannel<"u"){var It=new MessageChannel,wi=It.port2;It.port1.onmessage=Bn,Ki=function(){wi.postMessage(null)}}else Ki=function(){yi(Bn,0)};function Ui(jt){ti=jt,Qt||(Qt=!0,Ki())}function nn(jt,bi){ri=yi(function(){jt(c.unstable_now())},bi)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(jt){jt.callback=null},c.unstable_continueExecution=function(){St||zt||(St=!0,Ui(Ot))},c.unstable_forceFrameRate=function(jt){0>jt||125<jt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oi=0<jt?Math.floor(1e3/jt):5},c.unstable_getCurrentPriorityLevel=function(){return Xe},c.unstable_getFirstCallbackNode=function(){return v(_e)},c.unstable_next=function(jt){switch(Xe){case 1:case 2:case 3:var bi=3;break;default:bi=Xe}var Ht=Xe;Xe=bi;try{return jt()}finally{Xe=Ht}},c.unstable_pauseExecution=function(){},c.unstable_requestPaint=function(){},c.unstable_runWithPriority=function(jt,bi){switch(jt){case 1:case 2:case 3:case 4:case 5:break;default:jt=3}var Ht=Xe;Xe=jt;try{return bi()}finally{Xe=Ht}},c.unstable_scheduleCallback=function(jt,bi,Ht){var vn=c.unstable_now();switch(typeof Ht=="object"&&Ht!==null?(Ht=Ht.delay,Ht=typeof Ht=="number"&&0<Ht?vn+Ht:vn):Ht=vn,jt){case 1:var Wn=-1;break;case 2:Wn=250;break;case 5:Wn=1073741823;break;case 4:Wn=1e4;break;default:Wn=5e3}return Wn=Ht+Wn,jt={id:pt++,callback:bi,priorityLevel:jt,startTime:Ht,expirationTime:Wn,sortIndex:-1},Ht>vn?(jt.sortIndex=Ht,m(Ie,jt),v(_e)===null&&jt===v(Ie)&&(He?(Ee(ri),ri=-1):He=!0,nn(vt,Ht-vn))):(jt.sortIndex=Wn,m(_e,jt),St||zt||(St=!0,Ui(Ot))),jt},c.unstable_shouldYield=ci,c.unstable_wrapCallback=function(jt){var bi=Xe;return function(){var Ht=Xe;Xe=bi;try{return jt.apply(this,arguments)}finally{Xe=Ht}}}})(rA);aA.exports=rA;var q7=aA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G7=ta,Hr=q7;function Bt(c){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+c,v=1;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+c+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oA=new Set,Km={};function qc(c,m){Id(c,m),Id(c+"Capture",m)}function Id(c,m){for(Km[c]=m,c=0;c<m.length;c++)oA.add(m[c])}var al=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aw=Object.prototype.hasOwnProperty,Y7=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ok={},$k={};function H7(c){return aw.call($k,c)?!0:aw.call(Ok,c)?!1:Y7.test(c)?$k[c]=!0:(Ok[c]=!0,!1)}function Z7(c,m,v,P){if(v!==null&&v.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return P?!1:v!==null?!v.acceptsBooleans:(c=c.toLowerCase().slice(0,5),c!=="data-"&&c!=="aria-");default:return!1}}function K7(c,m,v,P){if(m===null||typeof m>"u"||Z7(c,m,v,P))return!0;if(P)return!1;if(v!==null)switch(v.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function wr(c,m,v,P,L,B,K){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=P,this.attributeNamespace=L,this.mustUseProperty=v,this.propertyName=c,this.type=m,this.sanitizeURL=B,this.removeEmptyString=K}var Ha={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(c){Ha[c]=new wr(c,0,!1,c,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(c){var m=c[0];Ha[m]=new wr(m,1,!1,c[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(c){Ha[c]=new wr(c,2,!1,c.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(c){Ha[c]=new wr(c,2,!1,c,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(c){Ha[c]=new wr(c,3,!1,c.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(c){Ha[c]=new wr(c,3,!0,c,null,!1,!1)});["capture","download"].forEach(function(c){Ha[c]=new wr(c,4,!1,c,null,!1,!1)});["cols","rows","size","span"].forEach(function(c){Ha[c]=new wr(c,6,!1,c,null,!1,!1)});["rowSpan","start"].forEach(function(c){Ha[c]=new wr(c,5,!1,c.toLowerCase(),null,!1,!1)});var tb=/[\-:]([a-z])/g;function ib(c){return c[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(c){var m=c.replace(tb,ib);Ha[m]=new wr(m,1,!1,c,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(c){var m=c.replace(tb,ib);Ha[m]=new wr(m,1,!1,c,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(c){var m=c.replace(tb,ib);Ha[m]=new wr(m,1,!1,c,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(c){Ha[c]=new wr(c,1,!1,c.toLowerCase(),null,!1,!1)});Ha.xlinkHref=new wr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(c){Ha[c]=new wr(c,1,!1,c.toLowerCase(),null,!0,!0)});function nb(c,m,v,P){var L=Ha.hasOwnProperty(m)?Ha[m]:null;(L!==null?L.type!==0:P||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(K7(m,v,L,P)&&(v=null),P||L===null?H7(m)&&(v===null?c.removeAttribute(m):c.setAttribute(m,""+v)):L.mustUseProperty?c[L.propertyName]=v===null?L.type===3?!1:"":v:(m=L.attributeName,P=L.attributeNamespace,v===null?c.removeAttribute(m):(L=L.type,v=L===3||L===4&&v===!0?"":""+v,P?c.setAttributeNS(P,m,v):c.setAttribute(m,v))))}var ll=G7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,__=Symbol.for("react.element"),md=Symbol.for("react.portal"),fd=Symbol.for("react.fragment"),ab=Symbol.for("react.strict_mode"),rw=Symbol.for("react.profiler"),sA=Symbol.for("react.provider"),lA=Symbol.for("react.context"),rb=Symbol.for("react.forward_ref"),ow=Symbol.for("react.suspense"),sw=Symbol.for("react.suspense_list"),ob=Symbol.for("react.memo"),su=Symbol.for("react.lazy"),uA=Symbol.for("react.offscreen"),jk=Symbol.iterator;function Cm(c){return c===null||typeof c!="object"?null:(c=jk&&c[jk]||c["@@iterator"],typeof c=="function"?c:null)}var la=Object.assign,z0;function Nm(c){if(z0===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);z0=m&&m[1]||""}return`
`+z0+c}var L0=!1;function R0(c,m){if(!c||L0)return"";L0=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(Ie){var P=Ie}Reflect.construct(c,[],m)}else{try{m.call()}catch(Ie){P=Ie}c.call(m.prototype)}else{try{throw Error()}catch(Ie){P=Ie}c()}}catch(Ie){if(Ie&&P&&typeof Ie.stack=="string"){for(var L=Ie.stack.split(`
`),B=P.stack.split(`
`),K=L.length-1,o=B.length-1;1<=K&&0<=o&&L[K]!==B[o];)o--;for(;1<=K&&0<=o;K--,o--)if(L[K]!==B[o]){if(K!==1||o!==1)do if(K--,o--,0>o||L[K]!==B[o]){var _e=`
`+L[K].replace(" at new "," at ");return c.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",c.displayName)),_e}while(1<=K&&0<=o);break}}}finally{L0=!1,Error.prepareStackTrace=v}return(c=c?c.displayName||c.name:"")?Nm(c):""}function X7(c){switch(c.tag){case 5:return Nm(c.type);case 16:return Nm("Lazy");case 13:return Nm("Suspense");case 19:return Nm("SuspenseList");case 0:case 2:case 15:return c=R0(c.type,!1),c;case 11:return c=R0(c.type.render,!1),c;case 1:return c=R0(c.type,!0),c;default:return""}}function lw(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case fd:return"Fragment";case md:return"Portal";case rw:return"Profiler";case ab:return"StrictMode";case ow:return"Suspense";case sw:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case lA:return(c.displayName||"Context")+".Consumer";case sA:return(c._context.displayName||"Context")+".Provider";case rb:var m=c.render;return c=c.displayName,c||(c=m.displayName||m.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case ob:return m=c.displayName||null,m!==null?m:lw(c.type)||"Memo";case su:m=c._payload,c=c._init;try{return lw(c(m))}catch{}}return null}function Q7(c){var m=c.type;switch(c.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=m.render,c=c.displayName||c.name||"",m.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lw(m);case 8:return m===ab?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function vu(c){switch(typeof c){case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function cA(c){var m=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function eT(c){var m=cA(c)?"checked":"value",v=Object.getOwnPropertyDescriptor(c.constructor.prototype,m),P=""+c[m];if(!c.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var L=v.get,B=v.set;return Object.defineProperty(c,m,{configurable:!0,get:function(){return L.call(this)},set:function(K){P=""+K,B.call(this,K)}}),Object.defineProperty(c,m,{enumerable:v.enumerable}),{getValue:function(){return P},setValue:function(K){P=""+K},stopTracking:function(){c._valueTracker=null,delete c[m]}}}}function y_(c){c._valueTracker||(c._valueTracker=eT(c))}function hA(c){if(!c)return!1;var m=c._valueTracker;if(!m)return!0;var v=m.getValue(),P="";return c&&(P=cA(c)?c.checked?"true":"false":c.value),c=P,c!==v?(m.setValue(c),!0):!1}function q_(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}function uw(c,m){var v=m.checked;return la({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??c._wrapperState.initialChecked})}function Vk(c,m){var v=m.defaultValue==null?"":m.defaultValue,P=m.checked!=null?m.checked:m.defaultChecked;v=vu(m.value!=null?m.value:v),c._wrapperState={initialChecked:P,initialValue:v,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function dA(c,m){m=m.checked,m!=null&&nb(c,"checked",m,!1)}function cw(c,m){dA(c,m);var v=vu(m.value),P=m.type;if(v!=null)P==="number"?(v===0&&c.value===""||c.value!=v)&&(c.value=""+v):c.value!==""+v&&(c.value=""+v);else if(P==="submit"||P==="reset"){c.removeAttribute("value");return}m.hasOwnProperty("value")?hw(c,m.type,v):m.hasOwnProperty("defaultValue")&&hw(c,m.type,vu(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(c.defaultChecked=!!m.defaultChecked)}function Uk(c,m,v){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var P=m.type;if(!(P!=="submit"&&P!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+c._wrapperState.initialValue,v||m===c.value||(c.value=m),c.defaultValue=m}v=c.name,v!==""&&(c.name=""),c.defaultChecked=!!c._wrapperState.initialChecked,v!==""&&(c.name=v)}function hw(c,m,v){(m!=="number"||q_(c.ownerDocument)!==c)&&(v==null?c.defaultValue=""+c._wrapperState.initialValue:c.defaultValue!==""+v&&(c.defaultValue=""+v))}var Fm=Array.isArray;function Td(c,m,v,P){if(c=c.options,m){m={};for(var L=0;L<v.length;L++)m["$"+v[L]]=!0;for(v=0;v<c.length;v++)L=m.hasOwnProperty("$"+c[v].value),c[v].selected!==L&&(c[v].selected=L),L&&P&&(c[v].defaultSelected=!0)}else{for(v=""+vu(v),m=null,L=0;L<c.length;L++){if(c[L].value===v){c[L].selected=!0,P&&(c[L].defaultSelected=!0);return}m!==null||c[L].disabled||(m=c[L])}m!==null&&(m.selected=!0)}}function dw(c,m){if(m.dangerouslySetInnerHTML!=null)throw Error(Bt(91));return la({},m,{value:void 0,defaultValue:void 0,children:""+c._wrapperState.initialValue})}function Jk(c,m){var v=m.value;if(v==null){if(v=m.children,m=m.defaultValue,v!=null){if(m!=null)throw Error(Bt(92));if(Fm(v)){if(1<v.length)throw Error(Bt(93));v=v[0]}m=v}m==null&&(m=""),v=m}c._wrapperState={initialValue:vu(v)}}function pA(c,m){var v=vu(m.value),P=vu(m.defaultValue);v!=null&&(v=""+v,v!==c.value&&(c.value=v),m.defaultValue==null&&c.defaultValue!==v&&(c.defaultValue=v)),P!=null&&(c.defaultValue=""+P)}function qk(c){var m=c.textContent;m===c._wrapperState.initialValue&&m!==""&&m!==null&&(c.value=m)}function mA(c){switch(c){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pw(c,m){return c==null||c==="http://www.w3.org/1999/xhtml"?mA(m):c==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":c}var w_,fA=function(c){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,v,P,L){MSApp.execUnsafeLocalFunction(function(){return c(m,v,P,L)})}:c}(function(c,m){if(c.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in c)c.innerHTML=m;else{for(w_=w_||document.createElement("div"),w_.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=w_.firstChild;c.firstChild;)c.removeChild(c.firstChild);for(;m.firstChild;)c.appendChild(m.firstChild)}});function Xm(c,m){if(m){var v=c.firstChild;if(v&&v===c.lastChild&&v.nodeType===3){v.nodeValue=m;return}}c.textContent=m}var jm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tT=["Webkit","ms","Moz","O"];Object.keys(jm).forEach(function(c){tT.forEach(function(m){m=m+c.charAt(0).toUpperCase()+c.substring(1),jm[m]=jm[c]})});function gA(c,m,v){return m==null||typeof m=="boolean"||m===""?"":v||typeof m!="number"||m===0||jm.hasOwnProperty(c)&&jm[c]?(""+m).trim():m+"px"}function _A(c,m){c=c.style;for(var v in m)if(m.hasOwnProperty(v)){var P=v.indexOf("--")===0,L=gA(v,m[v],P);v==="float"&&(v="cssFloat"),P?c.setProperty(v,L):c[v]=L}}var iT=la({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mw(c,m){if(m){if(iT[c]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(Bt(137,c));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(Bt(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(Bt(61))}if(m.style!=null&&typeof m.style!="object")throw Error(Bt(62))}}function fw(c,m){if(c.indexOf("-")===-1)return typeof m.is=="string";switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gw=null;function sb(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var _w=null,Pd=null,Md=null;function Gk(c){if(c=yf(c)){if(typeof _w!="function")throw Error(Bt(280));var m=c.stateNode;m&&(m=vy(m),_w(c.stateNode,c.type,m))}}function yA(c){Pd?Md?Md.push(c):Md=[c]:Pd=c}function wA(){if(Pd){var c=Pd,m=Md;if(Md=Pd=null,Gk(c),m)for(c=0;c<m.length;c++)Gk(m[c])}}function bA(c,m){return c(m)}function vA(){}var B0=!1;function xA(c,m,v){if(B0)return c(m,v);B0=!0;try{return bA(c,m,v)}finally{B0=!1,(Pd!==null||Md!==null)&&(vA(),wA())}}function Qm(c,m){var v=c.stateNode;if(v===null)return null;var P=vy(v);if(P===null)return null;v=P[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(c=c.type,P=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!P;break e;default:c=!1}if(c)return null;if(v&&typeof v!="function")throw Error(Bt(231,m,typeof v));return v}var yw=!1;if(al)try{var Dm={};Object.defineProperty(Dm,"passive",{get:function(){yw=!0}}),window.addEventListener("test",Dm,Dm),window.removeEventListener("test",Dm,Dm)}catch{yw=!1}function nT(c,m,v,P,L,B,K,o,_e){var Ie=Array.prototype.slice.call(arguments,3);try{m.apply(v,Ie)}catch(pt){this.onError(pt)}}var Vm=!1,G_=null,Y_=!1,ww=null,aT={onError:function(c){Vm=!0,G_=c}};function rT(c,m,v,P,L,B,K,o,_e){Vm=!1,G_=null,nT.apply(aT,arguments)}function oT(c,m,v,P,L,B,K,o,_e){if(rT.apply(this,arguments),Vm){if(Vm){var Ie=G_;Vm=!1,G_=null}else throw Error(Bt(198));Y_||(Y_=!0,ww=Ie)}}function Gc(c){var m=c,v=c;if(c.alternate)for(;m.return;)m=m.return;else{c=m;do m=c,m.flags&4098&&(v=m.return),c=m.return;while(c)}return m.tag===3?v:null}function kA(c){if(c.tag===13){var m=c.memoizedState;if(m===null&&(c=c.alternate,c!==null&&(m=c.memoizedState)),m!==null)return m.dehydrated}return null}function Yk(c){if(Gc(c)!==c)throw Error(Bt(188))}function sT(c){var m=c.alternate;if(!m){if(m=Gc(c),m===null)throw Error(Bt(188));return m!==c?null:c}for(var v=c,P=m;;){var L=v.return;if(L===null)break;var B=L.alternate;if(B===null){if(P=L.return,P!==null){v=P;continue}break}if(L.child===B.child){for(B=L.child;B;){if(B===v)return Yk(L),c;if(B===P)return Yk(L),m;B=B.sibling}throw Error(Bt(188))}if(v.return!==P.return)v=L,P=B;else{for(var K=!1,o=L.child;o;){if(o===v){K=!0,v=L,P=B;break}if(o===P){K=!0,P=L,v=B;break}o=o.sibling}if(!K){for(o=B.child;o;){if(o===v){K=!0,v=B,P=L;break}if(o===P){K=!0,P=B,v=L;break}o=o.sibling}if(!K)throw Error(Bt(189))}}if(v.alternate!==P)throw Error(Bt(190))}if(v.tag!==3)throw Error(Bt(188));return v.stateNode.current===v?c:m}function AA(c){return c=sT(c),c!==null?SA(c):null}function SA(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var m=SA(c);if(m!==null)return m;c=c.sibling}return null}var TA=Hr.unstable_scheduleCallback,Hk=Hr.unstable_cancelCallback,lT=Hr.unstable_shouldYield,uT=Hr.unstable_requestPaint,ya=Hr.unstable_now,cT=Hr.unstable_getCurrentPriorityLevel,lb=Hr.unstable_ImmediatePriority,PA=Hr.unstable_UserBlockingPriority,H_=Hr.unstable_NormalPriority,hT=Hr.unstable_LowPriority,MA=Hr.unstable_IdlePriority,_y=null,vs=null;function dT(c){if(vs&&typeof vs.onCommitFiberRoot=="function")try{vs.onCommitFiberRoot(_y,c,void 0,(c.current.flags&128)===128)}catch{}}var No=Math.clz32?Math.clz32:fT,pT=Math.log,mT=Math.LN2;function fT(c){return c>>>=0,c===0?32:31-(pT(c)/mT|0)|0}var b_=64,v_=4194304;function Om(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function Z_(c,m){var v=c.pendingLanes;if(v===0)return 0;var P=0,L=c.suspendedLanes,B=c.pingedLanes,K=v&268435455;if(K!==0){var o=K&~L;o!==0?P=Om(o):(B&=K,B!==0&&(P=Om(B)))}else K=v&~L,K!==0?P=Om(K):B!==0&&(P=Om(B));if(P===0)return 0;if(m!==0&&m!==P&&!(m&L)&&(L=P&-P,B=m&-m,L>=B||L===16&&(B&4194240)!==0))return m;if(P&4&&(P|=v&16),m=c.entangledLanes,m!==0)for(c=c.entanglements,m&=P;0<m;)v=31-No(m),L=1<<v,P|=c[v],m&=~L;return P}function gT(c,m){switch(c){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _T(c,m){for(var v=c.suspendedLanes,P=c.pingedLanes,L=c.expirationTimes,B=c.pendingLanes;0<B;){var K=31-No(B),o=1<<K,_e=L[K];_e===-1?(!(o&v)||o&P)&&(L[K]=gT(o,m)):_e<=m&&(c.expiredLanes|=o),B&=~o}}function bw(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function EA(){var c=b_;return b_<<=1,!(b_&4194240)&&(b_=64),c}function W0(c){for(var m=[],v=0;31>v;v++)m.push(c);return m}function gf(c,m,v){c.pendingLanes|=m,m!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,m=31-No(m),c[m]=v}function yT(c,m){var v=c.pendingLanes&~m;c.pendingLanes=m,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=m,c.mutableReadLanes&=m,c.entangledLanes&=m,m=c.entanglements;var P=c.eventTimes;for(c=c.expirationTimes;0<v;){var L=31-No(v),B=1<<L;m[L]=0,P[L]=-1,c[L]=-1,v&=~B}}function ub(c,m){var v=c.entangledLanes|=m;for(c=c.entanglements;v;){var P=31-No(v),L=1<<P;L&m|c[P]&m&&(c[P]|=m),v&=~L}}var Vn=0;function CA(c){return c&=-c,1<c?4<c?c&268435455?16:536870912:4:1}var DA,cb,IA,zA,LA,vw=!1,x_=[],pu=null,mu=null,fu=null,ef=new Map,tf=new Map,uu=[],wT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zk(c,m){switch(c){case"focusin":case"focusout":pu=null;break;case"dragenter":case"dragleave":mu=null;break;case"mouseover":case"mouseout":fu=null;break;case"pointerover":case"pointerout":ef.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":tf.delete(m.pointerId)}}function Im(c,m,v,P,L,B){return c===null||c.nativeEvent!==B?(c={blockedOn:m,domEventName:v,eventSystemFlags:P,nativeEvent:B,targetContainers:[L]},m!==null&&(m=yf(m),m!==null&&cb(m)),c):(c.eventSystemFlags|=P,m=c.targetContainers,L!==null&&m.indexOf(L)===-1&&m.push(L),c)}function bT(c,m,v,P,L){switch(m){case"focusin":return pu=Im(pu,c,m,v,P,L),!0;case"dragenter":return mu=Im(mu,c,m,v,P,L),!0;case"mouseover":return fu=Im(fu,c,m,v,P,L),!0;case"pointerover":var B=L.pointerId;return ef.set(B,Im(ef.get(B)||null,c,m,v,P,L)),!0;case"gotpointercapture":return B=L.pointerId,tf.set(B,Im(tf.get(B)||null,c,m,v,P,L)),!0}return!1}function RA(c){var m=Bc(c.target);if(m!==null){var v=Gc(m);if(v!==null){if(m=v.tag,m===13){if(m=kA(v),m!==null){c.blockedOn=m,LA(c.priority,function(){IA(v)});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){c.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}c.blockedOn=null}function B_(c){if(c.blockedOn!==null)return!1;for(var m=c.targetContainers;0<m.length;){var v=xw(c.domEventName,c.eventSystemFlags,m[0],c.nativeEvent);if(v===null){v=c.nativeEvent;var P=new v.constructor(v.type,v);gw=P,v.target.dispatchEvent(P),gw=null}else return m=yf(v),m!==null&&cb(m),c.blockedOn=v,!1;m.shift()}return!0}function Kk(c,m,v){B_(c)&&v.delete(m)}function vT(){vw=!1,pu!==null&&B_(pu)&&(pu=null),mu!==null&&B_(mu)&&(mu=null),fu!==null&&B_(fu)&&(fu=null),ef.forEach(Kk),tf.forEach(Kk)}function zm(c,m){c.blockedOn===m&&(c.blockedOn=null,vw||(vw=!0,Hr.unstable_scheduleCallback(Hr.unstable_NormalPriority,vT)))}function nf(c){function m(L){return zm(L,c)}if(0<x_.length){zm(x_[0],c);for(var v=1;v<x_.length;v++){var P=x_[v];P.blockedOn===c&&(P.blockedOn=null)}}for(pu!==null&&zm(pu,c),mu!==null&&zm(mu,c),fu!==null&&zm(fu,c),ef.forEach(m),tf.forEach(m),v=0;v<uu.length;v++)P=uu[v],P.blockedOn===c&&(P.blockedOn=null);for(;0<uu.length&&(v=uu[0],v.blockedOn===null);)RA(v),v.blockedOn===null&&uu.shift()}var Ed=ll.ReactCurrentBatchConfig,K_=!0;function xT(c,m,v,P){var L=Vn,B=Ed.transition;Ed.transition=null;try{Vn=1,hb(c,m,v,P)}finally{Vn=L,Ed.transition=B}}function kT(c,m,v,P){var L=Vn,B=Ed.transition;Ed.transition=null;try{Vn=4,hb(c,m,v,P)}finally{Vn=L,Ed.transition=B}}function hb(c,m,v,P){if(K_){var L=xw(c,m,v,P);if(L===null)G0(c,m,P,X_,v),Zk(c,P);else if(bT(L,c,m,v,P))P.stopPropagation();else if(Zk(c,P),m&4&&-1<wT.indexOf(c)){for(;L!==null;){var B=yf(L);if(B!==null&&DA(B),B=xw(c,m,v,P),B===null&&G0(c,m,P,X_,v),B===L)break;L=B}L!==null&&P.stopPropagation()}else G0(c,m,P,null,v)}}var X_=null;function xw(c,m,v,P){if(X_=null,c=sb(P),c=Bc(c),c!==null)if(m=Gc(c),m===null)c=null;else if(v=m.tag,v===13){if(c=kA(m),c!==null)return c;c=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;c=null}else m!==c&&(c=null);return X_=c,null}function BA(c){switch(c){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cT()){case lb:return 1;case PA:return 4;case H_:case hT:return 16;case MA:return 536870912;default:return 16}default:return 16}}var hu=null,db=null,W_=null;function WA(){if(W_)return W_;var c,m=db,v=m.length,P,L="value"in hu?hu.value:hu.textContent,B=L.length;for(c=0;c<v&&m[c]===L[c];c++);var K=v-c;for(P=1;P<=K&&m[v-P]===L[B-P];P++);return W_=L.slice(c,1<P?1-P:void 0)}function N_(c){var m=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&m===13&&(c=13)):c=m,c===10&&(c=13),32<=c||c===13?c:0}function k_(){return!0}function Xk(){return!1}function Kr(c){function m(v,P,L,B,K){this._reactName=v,this._targetInst=L,this.type=P,this.nativeEvent=B,this.target=K,this.currentTarget=null;for(var o in c)c.hasOwnProperty(o)&&(v=c[o],this[o]=v?v(B):B[o]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?k_:Xk,this.isPropagationStopped=Xk,this}return la(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=k_)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=k_)},persist:function(){},isPersistent:k_}),m}var Od={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pb=Kr(Od),_f=la({},Od,{view:0,detail:0}),AT=Kr(_f),N0,F0,Lm,yy=la({},_f,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mb,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Lm&&(Lm&&c.type==="mousemove"?(N0=c.screenX-Lm.screenX,F0=c.screenY-Lm.screenY):F0=N0=0,Lm=c),N0)},movementY:function(c){return"movementY"in c?c.movementY:F0}}),Qk=Kr(yy),ST=la({},yy,{dataTransfer:0}),TT=Kr(ST),PT=la({},_f,{relatedTarget:0}),O0=Kr(PT),MT=la({},Od,{animationName:0,elapsedTime:0,pseudoElement:0}),ET=Kr(MT),CT=la({},Od,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),DT=Kr(CT),IT=la({},Od,{data:0}),e3=Kr(IT),zT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function BT(c){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(c):(c=RT[c])?!!m[c]:!1}function mb(){return BT}var WT=la({},_f,{key:function(c){if(c.key){var m=zT[c.key]||c.key;if(m!=="Unidentified")return m}return c.type==="keypress"?(c=N_(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?LT[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mb,charCode:function(c){return c.type==="keypress"?N_(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?N_(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),NT=Kr(WT),FT=la({},yy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),t3=Kr(FT),OT=la({},_f,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mb}),$T=Kr(OT),jT=la({},Od,{propertyName:0,elapsedTime:0,pseudoElement:0}),VT=Kr(jT),UT=la({},yy,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),JT=Kr(UT),qT=[9,13,27,32],fb=al&&"CompositionEvent"in window,Um=null;al&&"documentMode"in document&&(Um=document.documentMode);var GT=al&&"TextEvent"in window&&!Um,NA=al&&(!fb||Um&&8<Um&&11>=Um),i3=" ",n3=!1;function FA(c,m){switch(c){case"keyup":return qT.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OA(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var gd=!1;function YT(c,m){switch(c){case"compositionend":return OA(m);case"keypress":return m.which!==32?null:(n3=!0,i3);case"textInput":return c=m.data,c===i3&&n3?null:c;default:return null}}function HT(c,m){if(gd)return c==="compositionend"||!fb&&FA(c,m)?(c=WA(),W_=db=hu=null,gd=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return NA&&m.locale!=="ko"?null:m.data;default:return null}}var ZT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function a3(c){var m=c&&c.nodeName&&c.nodeName.toLowerCase();return m==="input"?!!ZT[c.type]:m==="textarea"}function $A(c,m,v,P){yA(P),m=Q_(m,"onChange"),0<m.length&&(v=new pb("onChange","change",null,v,P),c.push({event:v,listeners:m}))}var Jm=null,af=null;function KT(c){XA(c,0)}function wy(c){var m=wd(c);if(hA(m))return c}function XT(c,m){if(c==="change")return m}var jA=!1;if(al){var $0;if(al){var j0="oninput"in document;if(!j0){var r3=document.createElement("div");r3.setAttribute("oninput","return;"),j0=typeof r3.oninput=="function"}$0=j0}else $0=!1;jA=$0&&(!document.documentMode||9<document.documentMode)}function o3(){Jm&&(Jm.detachEvent("onpropertychange",VA),af=Jm=null)}function VA(c){if(c.propertyName==="value"&&wy(af)){var m=[];$A(m,af,c,sb(c)),xA(KT,m)}}function QT(c,m,v){c==="focusin"?(o3(),Jm=m,af=v,Jm.attachEvent("onpropertychange",VA)):c==="focusout"&&o3()}function eP(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return wy(af)}function tP(c,m){if(c==="click")return wy(m)}function iP(c,m){if(c==="input"||c==="change")return wy(m)}function nP(c,m){return c===m&&(c!==0||1/c===1/m)||c!==c&&m!==m}var Oo=typeof Object.is=="function"?Object.is:nP;function rf(c,m){if(Oo(c,m))return!0;if(typeof c!="object"||c===null||typeof m!="object"||m===null)return!1;var v=Object.keys(c),P=Object.keys(m);if(v.length!==P.length)return!1;for(P=0;P<v.length;P++){var L=v[P];if(!aw.call(m,L)||!Oo(c[L],m[L]))return!1}return!0}function s3(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function l3(c,m){var v=s3(c);c=0;for(var P;v;){if(v.nodeType===3){if(P=c+v.textContent.length,c<=m&&P>=m)return{node:v,offset:m-c};c=P}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=s3(v)}}function UA(c,m){return c&&m?c===m?!0:c&&c.nodeType===3?!1:m&&m.nodeType===3?UA(c,m.parentNode):"contains"in c?c.contains(m):c.compareDocumentPosition?!!(c.compareDocumentPosition(m)&16):!1:!1}function JA(){for(var c=window,m=q_();m instanceof c.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)c=m.contentWindow;else break;m=q_(c.document)}return m}function gb(c){var m=c&&c.nodeName&&c.nodeName.toLowerCase();return m&&(m==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||m==="textarea"||c.contentEditable==="true")}function aP(c){var m=JA(),v=c.focusedElem,P=c.selectionRange;if(m!==v&&v&&v.ownerDocument&&UA(v.ownerDocument.documentElement,v)){if(P!==null&&gb(v)){if(m=P.start,c=P.end,c===void 0&&(c=m),"selectionStart"in v)v.selectionStart=m,v.selectionEnd=Math.min(c,v.value.length);else if(c=(m=v.ownerDocument||document)&&m.defaultView||window,c.getSelection){c=c.getSelection();var L=v.textContent.length,B=Math.min(P.start,L);P=P.end===void 0?B:Math.min(P.end,L),!c.extend&&B>P&&(L=P,P=B,B=L),L=l3(v,B);var K=l3(v,P);L&&K&&(c.rangeCount!==1||c.anchorNode!==L.node||c.anchorOffset!==L.offset||c.focusNode!==K.node||c.focusOffset!==K.offset)&&(m=m.createRange(),m.setStart(L.node,L.offset),c.removeAllRanges(),B>P?(c.addRange(m),c.extend(K.node,K.offset)):(m.setEnd(K.node,K.offset),c.addRange(m)))}}for(m=[],c=v;c=c.parentNode;)c.nodeType===1&&m.push({element:c,left:c.scrollLeft,top:c.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<m.length;v++)c=m[v],c.element.scrollLeft=c.left,c.element.scrollTop=c.top}}var rP=al&&"documentMode"in document&&11>=document.documentMode,_d=null,kw=null,qm=null,Aw=!1;function u3(c,m,v){var P=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Aw||_d==null||_d!==q_(P)||(P=_d,"selectionStart"in P&&gb(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),qm&&rf(qm,P)||(qm=P,P=Q_(kw,"onSelect"),0<P.length&&(m=new pb("onSelect","select",null,m,v),c.push({event:m,listeners:P}),m.target=_d)))}function A_(c,m){var v={};return v[c.toLowerCase()]=m.toLowerCase(),v["Webkit"+c]="webkit"+m,v["Moz"+c]="moz"+m,v}var yd={animationend:A_("Animation","AnimationEnd"),animationiteration:A_("Animation","AnimationIteration"),animationstart:A_("Animation","AnimationStart"),transitionend:A_("Transition","TransitionEnd")},V0={},qA={};al&&(qA=document.createElement("div").style,"AnimationEvent"in window||(delete yd.animationend.animation,delete yd.animationiteration.animation,delete yd.animationstart.animation),"TransitionEvent"in window||delete yd.transitionend.transition);function by(c){if(V0[c])return V0[c];if(!yd[c])return c;var m=yd[c],v;for(v in m)if(m.hasOwnProperty(v)&&v in qA)return V0[c]=m[v];return c}var GA=by("animationend"),YA=by("animationiteration"),HA=by("animationstart"),ZA=by("transitionend"),KA=new Map,c3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ku(c,m){KA.set(c,m),qc(m,[c])}for(var U0=0;U0<c3.length;U0++){var J0=c3[U0],oP=J0.toLowerCase(),sP=J0[0].toUpperCase()+J0.slice(1);ku(oP,"on"+sP)}ku(GA,"onAnimationEnd");ku(YA,"onAnimationIteration");ku(HA,"onAnimationStart");ku("dblclick","onDoubleClick");ku("focusin","onFocus");ku("focusout","onBlur");ku(ZA,"onTransitionEnd");Id("onMouseEnter",["mouseout","mouseover"]);Id("onMouseLeave",["mouseout","mouseover"]);Id("onPointerEnter",["pointerout","pointerover"]);Id("onPointerLeave",["pointerout","pointerover"]);qc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qc("onBeforeInput",["compositionend","keypress","textInput","paste"]);qc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $m="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lP=new Set("cancel close invalid load scroll toggle".split(" ").concat($m));function h3(c,m,v){var P=c.type||"unknown-event";c.currentTarget=v,oT(P,m,void 0,c),c.currentTarget=null}function XA(c,m){m=(m&4)!==0;for(var v=0;v<c.length;v++){var P=c[v],L=P.event;P=P.listeners;e:{var B=void 0;if(m)for(var K=P.length-1;0<=K;K--){var o=P[K],_e=o.instance,Ie=o.currentTarget;if(o=o.listener,_e!==B&&L.isPropagationStopped())break e;h3(L,o,Ie),B=_e}else for(K=0;K<P.length;K++){if(o=P[K],_e=o.instance,Ie=o.currentTarget,o=o.listener,_e!==B&&L.isPropagationStopped())break e;h3(L,o,Ie),B=_e}}}if(Y_)throw c=ww,Y_=!1,ww=null,c}function ea(c,m){var v=m[Ew];v===void 0&&(v=m[Ew]=new Set);var P=c+"__bubble";v.has(P)||(QA(m,c,2,!1),v.add(P))}function q0(c,m,v){var P=0;m&&(P|=4),QA(v,c,P,m)}var S_="_reactListening"+Math.random().toString(36).slice(2);function of(c){if(!c[S_]){c[S_]=!0,oA.forEach(function(v){v!=="selectionchange"&&(lP.has(v)||q0(v,!1,c),q0(v,!0,c))});var m=c.nodeType===9?c:c.ownerDocument;m===null||m[S_]||(m[S_]=!0,q0("selectionchange",!1,m))}}function QA(c,m,v,P){switch(BA(m)){case 1:var L=xT;break;case 4:L=kT;break;default:L=hb}v=L.bind(null,m,v,c),L=void 0,!yw||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(L=!0),P?L!==void 0?c.addEventListener(m,v,{capture:!0,passive:L}):c.addEventListener(m,v,!0):L!==void 0?c.addEventListener(m,v,{passive:L}):c.addEventListener(m,v,!1)}function G0(c,m,v,P,L){var B=P;if(!(m&1)&&!(m&2)&&P!==null)e:for(;;){if(P===null)return;var K=P.tag;if(K===3||K===4){var o=P.stateNode.containerInfo;if(o===L||o.nodeType===8&&o.parentNode===L)break;if(K===4)for(K=P.return;K!==null;){var _e=K.tag;if((_e===3||_e===4)&&(_e=K.stateNode.containerInfo,_e===L||_e.nodeType===8&&_e.parentNode===L))return;K=K.return}for(;o!==null;){if(K=Bc(o),K===null)return;if(_e=K.tag,_e===5||_e===6){P=B=K;continue e}o=o.parentNode}}P=P.return}xA(function(){var Ie=B,pt=sb(v),dt=[];e:{var Xe=KA.get(c);if(Xe!==void 0){var zt=pb,St=c;switch(c){case"keypress":if(N_(v)===0)break e;case"keydown":case"keyup":zt=NT;break;case"focusin":St="focus",zt=O0;break;case"focusout":St="blur",zt=O0;break;case"beforeblur":case"afterblur":zt=O0;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":zt=Qk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":zt=TT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":zt=$T;break;case GA:case YA:case HA:zt=ET;break;case ZA:zt=VT;break;case"scroll":zt=AT;break;case"wheel":zt=JT;break;case"copy":case"cut":case"paste":zt=DT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":zt=t3}var He=(m&4)!==0,yi=!He&&c==="scroll",Ee=He?Xe!==null?Xe+"Capture":null:Xe;He=[];for(var Ae=Ie,Oe;Ae!==null;){Oe=Ae;var vt=Oe.stateNode;if(Oe.tag===5&&vt!==null&&(Oe=vt,Ee!==null&&(vt=Qm(Ae,Ee),vt!=null&&He.push(sf(Ae,vt,Oe)))),yi)break;Ae=Ae.return}0<He.length&&(Xe=new zt(Xe,St,null,v,pt),dt.push({event:Xe,listeners:He}))}}if(!(m&7)){e:{if(Xe=c==="mouseover"||c==="pointerover",zt=c==="mouseout"||c==="pointerout",Xe&&v!==gw&&(St=v.relatedTarget||v.fromElement)&&(Bc(St)||St[rl]))break e;if((zt||Xe)&&(Xe=pt.window===pt?pt:(Xe=pt.ownerDocument)?Xe.defaultView||Xe.parentWindow:window,zt?(St=v.relatedTarget||v.toElement,zt=Ie,St=St?Bc(St):null,St!==null&&(yi=Gc(St),St!==yi||St.tag!==5&&St.tag!==6)&&(St=null)):(zt=null,St=Ie),zt!==St)){if(He=Qk,vt="onMouseLeave",Ee="onMouseEnter",Ae="mouse",(c==="pointerout"||c==="pointerover")&&(He=t3,vt="onPointerLeave",Ee="onPointerEnter",Ae="pointer"),yi=zt==null?Xe:wd(zt),Oe=St==null?Xe:wd(St),Xe=new He(vt,Ae+"leave",zt,v,pt),Xe.target=yi,Xe.relatedTarget=Oe,vt=null,Bc(pt)===Ie&&(He=new He(Ee,Ae+"enter",St,v,pt),He.target=Oe,He.relatedTarget=yi,vt=He),yi=vt,zt&&St)t:{for(He=zt,Ee=St,Ae=0,Oe=He;Oe;Oe=pd(Oe))Ae++;for(Oe=0,vt=Ee;vt;vt=pd(vt))Oe++;for(;0<Ae-Oe;)He=pd(He),Ae--;for(;0<Oe-Ae;)Ee=pd(Ee),Oe--;for(;Ae--;){if(He===Ee||Ee!==null&&He===Ee.alternate)break t;He=pd(He),Ee=pd(Ee)}He=null}else He=null;zt!==null&&d3(dt,Xe,zt,He,!1),St!==null&&yi!==null&&d3(dt,yi,St,He,!0)}}e:{if(Xe=Ie?wd(Ie):window,zt=Xe.nodeName&&Xe.nodeName.toLowerCase(),zt==="select"||zt==="input"&&Xe.type==="file")var Ot=XT;else if(a3(Xe))if(jA)Ot=iP;else{Ot=eP;var Qt=QT}else(zt=Xe.nodeName)&&zt.toLowerCase()==="input"&&(Xe.type==="checkbox"||Xe.type==="radio")&&(Ot=tP);if(Ot&&(Ot=Ot(c,Ie))){$A(dt,Ot,v,pt);break e}Qt&&Qt(c,Xe,Ie),c==="focusout"&&(Qt=Xe._wrapperState)&&Qt.controlled&&Xe.type==="number"&&hw(Xe,"number",Xe.value)}switch(Qt=Ie?wd(Ie):window,c){case"focusin":(a3(Qt)||Qt.contentEditable==="true")&&(_d=Qt,kw=Ie,qm=null);break;case"focusout":qm=kw=_d=null;break;case"mousedown":Aw=!0;break;case"contextmenu":case"mouseup":case"dragend":Aw=!1,u3(dt,v,pt);break;case"selectionchange":if(rP)break;case"keydown":case"keyup":u3(dt,v,pt)}var ti;if(fb)e:{switch(c){case"compositionstart":var ri="onCompositionStart";break e;case"compositionend":ri="onCompositionEnd";break e;case"compositionupdate":ri="onCompositionUpdate";break e}ri=void 0}else gd?FA(c,v)&&(ri="onCompositionEnd"):c==="keydown"&&v.keyCode===229&&(ri="onCompositionStart");ri&&(NA&&v.locale!=="ko"&&(gd||ri!=="onCompositionStart"?ri==="onCompositionEnd"&&gd&&(ti=WA()):(hu=pt,db="value"in hu?hu.value:hu.textContent,gd=!0)),Qt=Q_(Ie,ri),0<Qt.length&&(ri=new e3(ri,c,null,v,pt),dt.push({event:ri,listeners:Qt}),ti?ri.data=ti:(ti=OA(v),ti!==null&&(ri.data=ti)))),(ti=GT?YT(c,v):HT(c,v))&&(Ie=Q_(Ie,"onBeforeInput"),0<Ie.length&&(pt=new e3("onBeforeInput","beforeinput",null,v,pt),dt.push({event:pt,listeners:Ie}),pt.data=ti))}XA(dt,m)})}function sf(c,m,v){return{instance:c,listener:m,currentTarget:v}}function Q_(c,m){for(var v=m+"Capture",P=[];c!==null;){var L=c,B=L.stateNode;L.tag===5&&B!==null&&(L=B,B=Qm(c,v),B!=null&&P.unshift(sf(c,B,L)),B=Qm(c,m),B!=null&&P.push(sf(c,B,L))),c=c.return}return P}function pd(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5);return c||null}function d3(c,m,v,P,L){for(var B=m._reactName,K=[];v!==null&&v!==P;){var o=v,_e=o.alternate,Ie=o.stateNode;if(_e!==null&&_e===P)break;o.tag===5&&Ie!==null&&(o=Ie,L?(_e=Qm(v,B),_e!=null&&K.unshift(sf(v,_e,o))):L||(_e=Qm(v,B),_e!=null&&K.push(sf(v,_e,o)))),v=v.return}K.length!==0&&c.push({event:m,listeners:K})}var uP=/\r\n?/g,cP=/\u0000|\uFFFD/g;function p3(c){return(typeof c=="string"?c:""+c).replace(uP,`
`).replace(cP,"")}function T_(c,m,v){if(m=p3(m),p3(c)!==m&&v)throw Error(Bt(425))}function ey(){}var Sw=null,Tw=null;function Pw(c,m){return c==="textarea"||c==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Mw=typeof setTimeout=="function"?setTimeout:void 0,hP=typeof clearTimeout=="function"?clearTimeout:void 0,m3=typeof Promise=="function"?Promise:void 0,dP=typeof queueMicrotask=="function"?queueMicrotask:typeof m3<"u"?function(c){return m3.resolve(null).then(c).catch(pP)}:Mw;function pP(c){setTimeout(function(){throw c})}function Y0(c,m){var v=m,P=0;do{var L=v.nextSibling;if(c.removeChild(v),L&&L.nodeType===8)if(v=L.data,v==="/$"){if(P===0){c.removeChild(L),nf(m);return}P--}else v!=="$"&&v!=="$?"&&v!=="$!"||P++;v=L}while(v);nf(m)}function gu(c){for(;c!=null;c=c.nextSibling){var m=c.nodeType;if(m===1||m===3)break;if(m===8){if(m=c.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return c}function f3(c){c=c.previousSibling;for(var m=0;c;){if(c.nodeType===8){var v=c.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return c;m--}else v==="/$"&&m++}c=c.previousSibling}return null}var $d=Math.random().toString(36).slice(2),bs="__reactFiber$"+$d,lf="__reactProps$"+$d,rl="__reactContainer$"+$d,Ew="__reactEvents$"+$d,mP="__reactListeners$"+$d,fP="__reactHandles$"+$d;function Bc(c){var m=c[bs];if(m)return m;for(var v=c.parentNode;v;){if(m=v[rl]||v[bs]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(c=f3(c);c!==null;){if(v=c[bs])return v;c=f3(c)}return m}c=v,v=c.parentNode}return null}function yf(c){return c=c[bs]||c[rl],!c||c.tag!==5&&c.tag!==6&&c.tag!==13&&c.tag!==3?null:c}function wd(c){if(c.tag===5||c.tag===6)return c.stateNode;throw Error(Bt(33))}function vy(c){return c[lf]||null}var Cw=[],bd=-1;function Au(c){return{current:c}}function ia(c){0>bd||(c.current=Cw[bd],Cw[bd]=null,bd--)}function Xn(c,m){bd++,Cw[bd]=c.current,c.current=m}var xu={},ur=Au(xu),Ir=Au(!1),$c=xu;function zd(c,m){var v=c.type.contextTypes;if(!v)return xu;var P=c.stateNode;if(P&&P.__reactInternalMemoizedUnmaskedChildContext===m)return P.__reactInternalMemoizedMaskedChildContext;var L={},B;for(B in v)L[B]=m[B];return P&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=m,c.__reactInternalMemoizedMaskedChildContext=L),L}function zr(c){return c=c.childContextTypes,c!=null}function ty(){ia(Ir),ia(ur)}function g3(c,m,v){if(ur.current!==xu)throw Error(Bt(168));Xn(ur,m),Xn(Ir,v)}function e4(c,m,v){var P=c.stateNode;if(m=m.childContextTypes,typeof P.getChildContext!="function")return v;P=P.getChildContext();for(var L in P)if(!(L in m))throw Error(Bt(108,Q7(c)||"Unknown",L));return la({},v,P)}function iy(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||xu,$c=ur.current,Xn(ur,c),Xn(Ir,Ir.current),!0}function _3(c,m,v){var P=c.stateNode;if(!P)throw Error(Bt(169));v?(c=e4(c,m,$c),P.__reactInternalMemoizedMergedChildContext=c,ia(Ir),ia(ur),Xn(ur,c)):ia(Ir),Xn(Ir,v)}var el=null,xy=!1,H0=!1;function t4(c){el===null?el=[c]:el.push(c)}function gP(c){xy=!0,t4(c)}function Su(){if(!H0&&el!==null){H0=!0;var c=0,m=Vn;try{var v=el;for(Vn=1;c<v.length;c++){var P=v[c];do P=P(!0);while(P!==null)}el=null,xy=!1}catch(L){throw el!==null&&(el=el.slice(c+1)),TA(lb,Su),L}finally{Vn=m,H0=!1}}return null}var vd=[],xd=0,ny=null,ay=0,oo=[],so=0,jc=null,tl=1,il="";function Lc(c,m){vd[xd++]=ay,vd[xd++]=ny,ny=c,ay=m}function i4(c,m,v){oo[so++]=tl,oo[so++]=il,oo[so++]=jc,jc=c;var P=tl;c=il;var L=32-No(P)-1;P&=~(1<<L),v+=1;var B=32-No(m)+L;if(30<B){var K=L-L%5;B=(P&(1<<K)-1).toString(32),P>>=K,L-=K,tl=1<<32-No(m)+L|v<<L|P,il=B+c}else tl=1<<B|v<<L|P,il=c}function _b(c){c.return!==null&&(Lc(c,1),i4(c,1,0))}function yb(c){for(;c===ny;)ny=vd[--xd],vd[xd]=null,ay=vd[--xd],vd[xd]=null;for(;c===jc;)jc=oo[--so],oo[so]=null,il=oo[--so],oo[so]=null,tl=oo[--so],oo[so]=null}var Yr=null,Gr=null,aa=!1,Wo=null;function n4(c,m){var v=lo(5,null,null,0);v.elementType="DELETED",v.stateNode=m,v.return=c,m=c.deletions,m===null?(c.deletions=[v],c.flags|=16):m.push(v)}function y3(c,m){switch(c.tag){case 5:var v=c.type;return m=m.nodeType!==1||v.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(c.stateNode=m,Yr=c,Gr=gu(m.firstChild),!0):!1;case 6:return m=c.pendingProps===""||m.nodeType!==3?null:m,m!==null?(c.stateNode=m,Yr=c,Gr=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(v=jc!==null?{id:tl,overflow:il}:null,c.memoizedState={dehydrated:m,treeContext:v,retryLane:1073741824},v=lo(18,null,null,0),v.stateNode=m,v.return=c,c.child=v,Yr=c,Gr=null,!0):!1;default:return!1}}function Dw(c){return(c.mode&1)!==0&&(c.flags&128)===0}function Iw(c){if(aa){var m=Gr;if(m){var v=m;if(!y3(c,m)){if(Dw(c))throw Error(Bt(418));m=gu(v.nextSibling);var P=Yr;m&&y3(c,m)?n4(P,v):(c.flags=c.flags&-4097|2,aa=!1,Yr=c)}}else{if(Dw(c))throw Error(Bt(418));c.flags=c.flags&-4097|2,aa=!1,Yr=c}}}function w3(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;Yr=c}function P_(c){if(c!==Yr)return!1;if(!aa)return w3(c),aa=!0,!1;var m;if((m=c.tag!==3)&&!(m=c.tag!==5)&&(m=c.type,m=m!=="head"&&m!=="body"&&!Pw(c.type,c.memoizedProps)),m&&(m=Gr)){if(Dw(c))throw a4(),Error(Bt(418));for(;m;)n4(c,m),m=gu(m.nextSibling)}if(w3(c),c.tag===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(Bt(317));e:{for(c=c.nextSibling,m=0;c;){if(c.nodeType===8){var v=c.data;if(v==="/$"){if(m===0){Gr=gu(c.nextSibling);break e}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++}c=c.nextSibling}Gr=null}}else Gr=Yr?gu(c.stateNode.nextSibling):null;return!0}function a4(){for(var c=Gr;c;)c=gu(c.nextSibling)}function Ld(){Gr=Yr=null,aa=!1}function wb(c){Wo===null?Wo=[c]:Wo.push(c)}var _P=ll.ReactCurrentBatchConfig;function Rm(c,m,v){if(c=v.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(Bt(309));var P=v.stateNode}if(!P)throw Error(Bt(147,c));var L=P,B=""+c;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===B?m.ref:(m=function(K){var o=L.refs;K===null?delete o[B]:o[B]=K},m._stringRef=B,m)}if(typeof c!="string")throw Error(Bt(284));if(!v._owner)throw Error(Bt(290,c))}return c}function M_(c,m){throw c=Object.prototype.toString.call(m),Error(Bt(31,c==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":c))}function b3(c){var m=c._init;return m(c._payload)}function r4(c){function m(Ee,Ae){if(c){var Oe=Ee.deletions;Oe===null?(Ee.deletions=[Ae],Ee.flags|=16):Oe.push(Ae)}}function v(Ee,Ae){if(!c)return null;for(;Ae!==null;)m(Ee,Ae),Ae=Ae.sibling;return null}function P(Ee,Ae){for(Ee=new Map;Ae!==null;)Ae.key!==null?Ee.set(Ae.key,Ae):Ee.set(Ae.index,Ae),Ae=Ae.sibling;return Ee}function L(Ee,Ae){return Ee=bu(Ee,Ae),Ee.index=0,Ee.sibling=null,Ee}function B(Ee,Ae,Oe){return Ee.index=Oe,c?(Oe=Ee.alternate,Oe!==null?(Oe=Oe.index,Oe<Ae?(Ee.flags|=2,Ae):Oe):(Ee.flags|=2,Ae)):(Ee.flags|=1048576,Ae)}function K(Ee){return c&&Ee.alternate===null&&(Ee.flags|=2),Ee}function o(Ee,Ae,Oe,vt){return Ae===null||Ae.tag!==6?(Ae=iw(Oe,Ee.mode,vt),Ae.return=Ee,Ae):(Ae=L(Ae,Oe),Ae.return=Ee,Ae)}function _e(Ee,Ae,Oe,vt){var Ot=Oe.type;return Ot===fd?pt(Ee,Ae,Oe.props.children,vt,Oe.key):Ae!==null&&(Ae.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===su&&b3(Ot)===Ae.type)?(vt=L(Ae,Oe.props),vt.ref=Rm(Ee,Ae,Oe),vt.return=Ee,vt):(vt=J_(Oe.type,Oe.key,Oe.props,null,Ee.mode,vt),vt.ref=Rm(Ee,Ae,Oe),vt.return=Ee,vt)}function Ie(Ee,Ae,Oe,vt){return Ae===null||Ae.tag!==4||Ae.stateNode.containerInfo!==Oe.containerInfo||Ae.stateNode.implementation!==Oe.implementation?(Ae=nw(Oe,Ee.mode,vt),Ae.return=Ee,Ae):(Ae=L(Ae,Oe.children||[]),Ae.return=Ee,Ae)}function pt(Ee,Ae,Oe,vt,Ot){return Ae===null||Ae.tag!==7?(Ae=Oc(Oe,Ee.mode,vt,Ot),Ae.return=Ee,Ae):(Ae=L(Ae,Oe),Ae.return=Ee,Ae)}function dt(Ee,Ae,Oe){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number")return Ae=iw(""+Ae,Ee.mode,Oe),Ae.return=Ee,Ae;if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case __:return Oe=J_(Ae.type,Ae.key,Ae.props,null,Ee.mode,Oe),Oe.ref=Rm(Ee,null,Ae),Oe.return=Ee,Oe;case md:return Ae=nw(Ae,Ee.mode,Oe),Ae.return=Ee,Ae;case su:var vt=Ae._init;return dt(Ee,vt(Ae._payload),Oe)}if(Fm(Ae)||Cm(Ae))return Ae=Oc(Ae,Ee.mode,Oe,null),Ae.return=Ee,Ae;M_(Ee,Ae)}return null}function Xe(Ee,Ae,Oe,vt){var Ot=Ae!==null?Ae.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Ot!==null?null:o(Ee,Ae,""+Oe,vt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case __:return Oe.key===Ot?_e(Ee,Ae,Oe,vt):null;case md:return Oe.key===Ot?Ie(Ee,Ae,Oe,vt):null;case su:return Ot=Oe._init,Xe(Ee,Ae,Ot(Oe._payload),vt)}if(Fm(Oe)||Cm(Oe))return Ot!==null?null:pt(Ee,Ae,Oe,vt,null);M_(Ee,Oe)}return null}function zt(Ee,Ae,Oe,vt,Ot){if(typeof vt=="string"&&vt!==""||typeof vt=="number")return Ee=Ee.get(Oe)||null,o(Ae,Ee,""+vt,Ot);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case __:return Ee=Ee.get(vt.key===null?Oe:vt.key)||null,_e(Ae,Ee,vt,Ot);case md:return Ee=Ee.get(vt.key===null?Oe:vt.key)||null,Ie(Ae,Ee,vt,Ot);case su:var Qt=vt._init;return zt(Ee,Ae,Oe,Qt(vt._payload),Ot)}if(Fm(vt)||Cm(vt))return Ee=Ee.get(Oe)||null,pt(Ae,Ee,vt,Ot,null);M_(Ae,vt)}return null}function St(Ee,Ae,Oe,vt){for(var Ot=null,Qt=null,ti=Ae,ri=Ae=0,oi=null;ti!==null&&ri<Oe.length;ri++){ti.index>ri?(oi=ti,ti=null):oi=ti.sibling;var Yt=Xe(Ee,ti,Oe[ri],vt);if(Yt===null){ti===null&&(ti=oi);break}c&&ti&&Yt.alternate===null&&m(Ee,ti),Ae=B(Yt,Ae,ri),Qt===null?Ot=Yt:Qt.sibling=Yt,Qt=Yt,ti=oi}if(ri===Oe.length)return v(Ee,ti),aa&&Lc(Ee,ri),Ot;if(ti===null){for(;ri<Oe.length;ri++)ti=dt(Ee,Oe[ri],vt),ti!==null&&(Ae=B(ti,Ae,ri),Qt===null?Ot=ti:Qt.sibling=ti,Qt=ti);return aa&&Lc(Ee,ri),Ot}for(ti=P(Ee,ti);ri<Oe.length;ri++)oi=zt(ti,Ee,ri,Oe[ri],vt),oi!==null&&(c&&oi.alternate!==null&&ti.delete(oi.key===null?ri:oi.key),Ae=B(oi,Ae,ri),Qt===null?Ot=oi:Qt.sibling=oi,Qt=oi);return c&&ti.forEach(function(ci){return m(Ee,ci)}),aa&&Lc(Ee,ri),Ot}function He(Ee,Ae,Oe,vt){var Ot=Cm(Oe);if(typeof Ot!="function")throw Error(Bt(150));if(Oe=Ot.call(Oe),Oe==null)throw Error(Bt(151));for(var Qt=Ot=null,ti=Ae,ri=Ae=0,oi=null,Yt=Oe.next();ti!==null&&!Yt.done;ri++,Yt=Oe.next()){ti.index>ri?(oi=ti,ti=null):oi=ti.sibling;var ci=Xe(Ee,ti,Yt.value,vt);if(ci===null){ti===null&&(ti=oi);break}c&&ti&&ci.alternate===null&&m(Ee,ti),Ae=B(ci,Ae,ri),Qt===null?Ot=ci:Qt.sibling=ci,Qt=ci,ti=oi}if(Yt.done)return v(Ee,ti),aa&&Lc(Ee,ri),Ot;if(ti===null){for(;!Yt.done;ri++,Yt=Oe.next())Yt=dt(Ee,Yt.value,vt),Yt!==null&&(Ae=B(Yt,Ae,ri),Qt===null?Ot=Yt:Qt.sibling=Yt,Qt=Yt);return aa&&Lc(Ee,ri),Ot}for(ti=P(Ee,ti);!Yt.done;ri++,Yt=Oe.next())Yt=zt(ti,Ee,ri,Yt.value,vt),Yt!==null&&(c&&Yt.alternate!==null&&ti.delete(Yt.key===null?ri:Yt.key),Ae=B(Yt,Ae,ri),Qt===null?Ot=Yt:Qt.sibling=Yt,Qt=Yt);return c&&ti.forEach(function(Bn){return m(Ee,Bn)}),aa&&Lc(Ee,ri),Ot}function yi(Ee,Ae,Oe,vt){if(typeof Oe=="object"&&Oe!==null&&Oe.type===fd&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case __:e:{for(var Ot=Oe.key,Qt=Ae;Qt!==null;){if(Qt.key===Ot){if(Ot=Oe.type,Ot===fd){if(Qt.tag===7){v(Ee,Qt.sibling),Ae=L(Qt,Oe.props.children),Ae.return=Ee,Ee=Ae;break e}}else if(Qt.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===su&&b3(Ot)===Qt.type){v(Ee,Qt.sibling),Ae=L(Qt,Oe.props),Ae.ref=Rm(Ee,Qt,Oe),Ae.return=Ee,Ee=Ae;break e}v(Ee,Qt);break}else m(Ee,Qt);Qt=Qt.sibling}Oe.type===fd?(Ae=Oc(Oe.props.children,Ee.mode,vt,Oe.key),Ae.return=Ee,Ee=Ae):(vt=J_(Oe.type,Oe.key,Oe.props,null,Ee.mode,vt),vt.ref=Rm(Ee,Ae,Oe),vt.return=Ee,Ee=vt)}return K(Ee);case md:e:{for(Qt=Oe.key;Ae!==null;){if(Ae.key===Qt)if(Ae.tag===4&&Ae.stateNode.containerInfo===Oe.containerInfo&&Ae.stateNode.implementation===Oe.implementation){v(Ee,Ae.sibling),Ae=L(Ae,Oe.children||[]),Ae.return=Ee,Ee=Ae;break e}else{v(Ee,Ae);break}else m(Ee,Ae);Ae=Ae.sibling}Ae=nw(Oe,Ee.mode,vt),Ae.return=Ee,Ee=Ae}return K(Ee);case su:return Qt=Oe._init,yi(Ee,Ae,Qt(Oe._payload),vt)}if(Fm(Oe))return St(Ee,Ae,Oe,vt);if(Cm(Oe))return He(Ee,Ae,Oe,vt);M_(Ee,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"?(Oe=""+Oe,Ae!==null&&Ae.tag===6?(v(Ee,Ae.sibling),Ae=L(Ae,Oe),Ae.return=Ee,Ee=Ae):(v(Ee,Ae),Ae=iw(Oe,Ee.mode,vt),Ae.return=Ee,Ee=Ae),K(Ee)):v(Ee,Ae)}return yi}var Rd=r4(!0),o4=r4(!1),ry=Au(null),oy=null,kd=null,bb=null;function vb(){bb=kd=oy=null}function xb(c){var m=ry.current;ia(ry),c._currentValue=m}function zw(c,m,v){for(;c!==null;){var P=c.alternate;if((c.childLanes&m)!==m?(c.childLanes|=m,P!==null&&(P.childLanes|=m)):P!==null&&(P.childLanes&m)!==m&&(P.childLanes|=m),c===v)break;c=c.return}}function Cd(c,m){oy=c,bb=kd=null,c=c.dependencies,c!==null&&c.firstContext!==null&&(c.lanes&m&&(Dr=!0),c.firstContext=null)}function co(c){var m=c._currentValue;if(bb!==c)if(c={context:c,memoizedValue:m,next:null},kd===null){if(oy===null)throw Error(Bt(308));kd=c,oy.dependencies={lanes:0,firstContext:c}}else kd=kd.next=c;return m}var Wc=null;function kb(c){Wc===null?Wc=[c]:Wc.push(c)}function s4(c,m,v,P){var L=m.interleaved;return L===null?(v.next=v,kb(m)):(v.next=L.next,L.next=v),m.interleaved=v,ol(c,P)}function ol(c,m){c.lanes|=m;var v=c.alternate;for(v!==null&&(v.lanes|=m),v=c,c=c.return;c!==null;)c.childLanes|=m,v=c.alternate,v!==null&&(v.childLanes|=m),v=c,c=c.return;return v.tag===3?v.stateNode:null}var lu=!1;function Ab(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l4(c,m){c=c.updateQueue,m.updateQueue===c&&(m.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function nl(c,m){return{eventTime:c,lane:m,tag:0,payload:null,callback:null,next:null}}function _u(c,m,v){var P=c.updateQueue;if(P===null)return null;if(P=P.shared,Rn&2){var L=P.pending;return L===null?m.next=m:(m.next=L.next,L.next=m),P.pending=m,ol(c,v)}return L=P.interleaved,L===null?(m.next=m,kb(P)):(m.next=L.next,L.next=m),P.interleaved=m,ol(c,v)}function F_(c,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194240)!==0)){var P=m.lanes;P&=c.pendingLanes,v|=P,m.lanes=v,ub(c,v)}}function v3(c,m){var v=c.updateQueue,P=c.alternate;if(P!==null&&(P=P.updateQueue,v===P)){var L=null,B=null;if(v=v.firstBaseUpdate,v!==null){do{var K={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};B===null?L=B=K:B=B.next=K,v=v.next}while(v!==null);B===null?L=B=m:B=B.next=m}else L=B=m;v={baseState:P.baseState,firstBaseUpdate:L,lastBaseUpdate:B,shared:P.shared,effects:P.effects},c.updateQueue=v;return}c=v.lastBaseUpdate,c===null?v.firstBaseUpdate=m:c.next=m,v.lastBaseUpdate=m}function sy(c,m,v,P){var L=c.updateQueue;lu=!1;var B=L.firstBaseUpdate,K=L.lastBaseUpdate,o=L.shared.pending;if(o!==null){L.shared.pending=null;var _e=o,Ie=_e.next;_e.next=null,K===null?B=Ie:K.next=Ie,K=_e;var pt=c.alternate;pt!==null&&(pt=pt.updateQueue,o=pt.lastBaseUpdate,o!==K&&(o===null?pt.firstBaseUpdate=Ie:o.next=Ie,pt.lastBaseUpdate=_e))}if(B!==null){var dt=L.baseState;K=0,pt=Ie=_e=null,o=B;do{var Xe=o.lane,zt=o.eventTime;if((P&Xe)===Xe){pt!==null&&(pt=pt.next={eventTime:zt,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var St=c,He=o;switch(Xe=m,zt=v,He.tag){case 1:if(St=He.payload,typeof St=="function"){dt=St.call(zt,dt,Xe);break e}dt=St;break e;case 3:St.flags=St.flags&-65537|128;case 0:if(St=He.payload,Xe=typeof St=="function"?St.call(zt,dt,Xe):St,Xe==null)break e;dt=la({},dt,Xe);break e;case 2:lu=!0}}o.callback!==null&&o.lane!==0&&(c.flags|=64,Xe=L.effects,Xe===null?L.effects=[o]:Xe.push(o))}else zt={eventTime:zt,lane:Xe,tag:o.tag,payload:o.payload,callback:o.callback,next:null},pt===null?(Ie=pt=zt,_e=dt):pt=pt.next=zt,K|=Xe;if(o=o.next,o===null){if(o=L.shared.pending,o===null)break;Xe=o,o=Xe.next,Xe.next=null,L.lastBaseUpdate=Xe,L.shared.pending=null}}while(!0);if(pt===null&&(_e=dt),L.baseState=_e,L.firstBaseUpdate=Ie,L.lastBaseUpdate=pt,m=L.shared.interleaved,m!==null){L=m;do K|=L.lane,L=L.next;while(L!==m)}else B===null&&(L.shared.lanes=0);Uc|=K,c.lanes=K,c.memoizedState=dt}}function x3(c,m,v){if(c=m.effects,m.effects=null,c!==null)for(m=0;m<c.length;m++){var P=c[m],L=P.callback;if(L!==null){if(P.callback=null,P=v,typeof L!="function")throw Error(Bt(191,L));L.call(P)}}}var wf={},xs=Au(wf),uf=Au(wf),cf=Au(wf);function Nc(c){if(c===wf)throw Error(Bt(174));return c}function Sb(c,m){switch(Xn(cf,m),Xn(uf,c),Xn(xs,wf),c=m.nodeType,c){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:pw(null,"");break;default:c=c===8?m.parentNode:m,m=c.namespaceURI||null,c=c.tagName,m=pw(m,c)}ia(xs),Xn(xs,m)}function Bd(){ia(xs),ia(uf),ia(cf)}function u4(c){Nc(cf.current);var m=Nc(xs.current),v=pw(m,c.type);m!==v&&(Xn(uf,c),Xn(xs,v))}function Tb(c){uf.current===c&&(ia(xs),ia(uf))}var oa=Au(0);function ly(c){for(var m=c;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if(m.flags&128)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Z0=[];function Pb(){for(var c=0;c<Z0.length;c++)Z0[c]._workInProgressVersionPrimary=null;Z0.length=0}var O_=ll.ReactCurrentDispatcher,K0=ll.ReactCurrentBatchConfig,Vc=0,sa=null,Ea=null,Oa=null,uy=!1,Gm=!1,hf=0,yP=0;function or(){throw Error(Bt(321))}function Mb(c,m){if(m===null)return!1;for(var v=0;v<m.length&&v<c.length;v++)if(!Oo(c[v],m[v]))return!1;return!0}function Eb(c,m,v,P,L,B){if(Vc=B,sa=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,O_.current=c===null||c.memoizedState===null?xP:kP,c=v(P,L),Gm){B=0;do{if(Gm=!1,hf=0,25<=B)throw Error(Bt(301));B+=1,Oa=Ea=null,m.updateQueue=null,O_.current=AP,c=v(P,L)}while(Gm)}if(O_.current=cy,m=Ea!==null&&Ea.next!==null,Vc=0,Oa=Ea=sa=null,uy=!1,m)throw Error(Bt(300));return c}function Cb(){var c=hf!==0;return hf=0,c}function ws(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oa===null?sa.memoizedState=Oa=c:Oa=Oa.next=c,Oa}function ho(){if(Ea===null){var c=sa.alternate;c=c!==null?c.memoizedState:null}else c=Ea.next;var m=Oa===null?sa.memoizedState:Oa.next;if(m!==null)Oa=m,Ea=c;else{if(c===null)throw Error(Bt(310));Ea=c,c={memoizedState:Ea.memoizedState,baseState:Ea.baseState,baseQueue:Ea.baseQueue,queue:Ea.queue,next:null},Oa===null?sa.memoizedState=Oa=c:Oa=Oa.next=c}return Oa}function df(c,m){return typeof m=="function"?m(c):m}function X0(c){var m=ho(),v=m.queue;if(v===null)throw Error(Bt(311));v.lastRenderedReducer=c;var P=Ea,L=P.baseQueue,B=v.pending;if(B!==null){if(L!==null){var K=L.next;L.next=B.next,B.next=K}P.baseQueue=L=B,v.pending=null}if(L!==null){B=L.next,P=P.baseState;var o=K=null,_e=null,Ie=B;do{var pt=Ie.lane;if((Vc&pt)===pt)_e!==null&&(_e=_e.next={lane:0,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null}),P=Ie.hasEagerState?Ie.eagerState:c(P,Ie.action);else{var dt={lane:pt,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null};_e===null?(o=_e=dt,K=P):_e=_e.next=dt,sa.lanes|=pt,Uc|=pt}Ie=Ie.next}while(Ie!==null&&Ie!==B);_e===null?K=P:_e.next=o,Oo(P,m.memoizedState)||(Dr=!0),m.memoizedState=P,m.baseState=K,m.baseQueue=_e,v.lastRenderedState=P}if(c=v.interleaved,c!==null){L=c;do B=L.lane,sa.lanes|=B,Uc|=B,L=L.next;while(L!==c)}else L===null&&(v.lanes=0);return[m.memoizedState,v.dispatch]}function Q0(c){var m=ho(),v=m.queue;if(v===null)throw Error(Bt(311));v.lastRenderedReducer=c;var P=v.dispatch,L=v.pending,B=m.memoizedState;if(L!==null){v.pending=null;var K=L=L.next;do B=c(B,K.action),K=K.next;while(K!==L);Oo(B,m.memoizedState)||(Dr=!0),m.memoizedState=B,m.baseQueue===null&&(m.baseState=B),v.lastRenderedState=B}return[B,P]}function c4(){}function h4(c,m){var v=sa,P=ho(),L=m(),B=!Oo(P.memoizedState,L);if(B&&(P.memoizedState=L,Dr=!0),P=P.queue,Db(m4.bind(null,v,P,c),[c]),P.getSnapshot!==m||B||Oa!==null&&Oa.memoizedState.tag&1){if(v.flags|=2048,pf(9,p4.bind(null,v,P,L,m),void 0,null),$a===null)throw Error(Bt(349));Vc&30||d4(v,m,L)}return L}function d4(c,m,v){c.flags|=16384,c={getSnapshot:m,value:v},m=sa.updateQueue,m===null?(m={lastEffect:null,stores:null},sa.updateQueue=m,m.stores=[c]):(v=m.stores,v===null?m.stores=[c]:v.push(c))}function p4(c,m,v,P){m.value=v,m.getSnapshot=P,f4(m)&&g4(c)}function m4(c,m,v){return v(function(){f4(m)&&g4(c)})}function f4(c){var m=c.getSnapshot;c=c.value;try{var v=m();return!Oo(c,v)}catch{return!0}}function g4(c){var m=ol(c,1);m!==null&&Fo(m,c,1,-1)}function k3(c){var m=ws();return typeof c=="function"&&(c=c()),m.memoizedState=m.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:df,lastRenderedState:c},m.queue=c,c=c.dispatch=vP.bind(null,sa,c),[m.memoizedState,c]}function pf(c,m,v,P){return c={tag:c,create:m,destroy:v,deps:P,next:null},m=sa.updateQueue,m===null?(m={lastEffect:null,stores:null},sa.updateQueue=m,m.lastEffect=c.next=c):(v=m.lastEffect,v===null?m.lastEffect=c.next=c:(P=v.next,v.next=c,c.next=P,m.lastEffect=c)),c}function _4(){return ho().memoizedState}function $_(c,m,v,P){var L=ws();sa.flags|=c,L.memoizedState=pf(1|m,v,void 0,P===void 0?null:P)}function ky(c,m,v,P){var L=ho();P=P===void 0?null:P;var B=void 0;if(Ea!==null){var K=Ea.memoizedState;if(B=K.destroy,P!==null&&Mb(P,K.deps)){L.memoizedState=pf(m,v,B,P);return}}sa.flags|=c,L.memoizedState=pf(1|m,v,B,P)}function A3(c,m){return $_(8390656,8,c,m)}function Db(c,m){return ky(2048,8,c,m)}function y4(c,m){return ky(4,2,c,m)}function w4(c,m){return ky(4,4,c,m)}function b4(c,m){if(typeof m=="function")return c=c(),m(c),function(){m(null)};if(m!=null)return c=c(),m.current=c,function(){m.current=null}}function v4(c,m,v){return v=v!=null?v.concat([c]):null,ky(4,4,b4.bind(null,m,c),v)}function Ib(){}function x4(c,m){var v=ho();m=m===void 0?null:m;var P=v.memoizedState;return P!==null&&m!==null&&Mb(m,P[1])?P[0]:(v.memoizedState=[c,m],c)}function k4(c,m){var v=ho();m=m===void 0?null:m;var P=v.memoizedState;return P!==null&&m!==null&&Mb(m,P[1])?P[0]:(c=c(),v.memoizedState=[c,m],c)}function A4(c,m,v){return Vc&21?(Oo(v,m)||(v=EA(),sa.lanes|=v,Uc|=v,c.baseState=!0),m):(c.baseState&&(c.baseState=!1,Dr=!0),c.memoizedState=v)}function wP(c,m){var v=Vn;Vn=v!==0&&4>v?v:4,c(!0);var P=K0.transition;K0.transition={};try{c(!1),m()}finally{Vn=v,K0.transition=P}}function S4(){return ho().memoizedState}function bP(c,m,v){var P=wu(c);if(v={lane:P,action:v,hasEagerState:!1,eagerState:null,next:null},T4(c))P4(m,v);else if(v=s4(c,m,v,P),v!==null){var L=_r();Fo(v,c,P,L),M4(v,m,P)}}function vP(c,m,v){var P=wu(c),L={lane:P,action:v,hasEagerState:!1,eagerState:null,next:null};if(T4(c))P4(m,L);else{var B=c.alternate;if(c.lanes===0&&(B===null||B.lanes===0)&&(B=m.lastRenderedReducer,B!==null))try{var K=m.lastRenderedState,o=B(K,v);if(L.hasEagerState=!0,L.eagerState=o,Oo(o,K)){var _e=m.interleaved;_e===null?(L.next=L,kb(m)):(L.next=_e.next,_e.next=L),m.interleaved=L;return}}catch{}finally{}v=s4(c,m,L,P),v!==null&&(L=_r(),Fo(v,c,P,L),M4(v,m,P))}}function T4(c){var m=c.alternate;return c===sa||m!==null&&m===sa}function P4(c,m){Gm=uy=!0;var v=c.pending;v===null?m.next=m:(m.next=v.next,v.next=m),c.pending=m}function M4(c,m,v){if(v&4194240){var P=m.lanes;P&=c.pendingLanes,v|=P,m.lanes=v,ub(c,v)}}var cy={readContext:co,useCallback:or,useContext:or,useEffect:or,useImperativeHandle:or,useInsertionEffect:or,useLayoutEffect:or,useMemo:or,useReducer:or,useRef:or,useState:or,useDebugValue:or,useDeferredValue:or,useTransition:or,useMutableSource:or,useSyncExternalStore:or,useId:or,unstable_isNewReconciler:!1},xP={readContext:co,useCallback:function(c,m){return ws().memoizedState=[c,m===void 0?null:m],c},useContext:co,useEffect:A3,useImperativeHandle:function(c,m,v){return v=v!=null?v.concat([c]):null,$_(4194308,4,b4.bind(null,m,c),v)},useLayoutEffect:function(c,m){return $_(4194308,4,c,m)},useInsertionEffect:function(c,m){return $_(4,2,c,m)},useMemo:function(c,m){var v=ws();return m=m===void 0?null:m,c=c(),v.memoizedState=[c,m],c},useReducer:function(c,m,v){var P=ws();return m=v!==void 0?v(m):m,P.memoizedState=P.baseState=m,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:m},P.queue=c,c=c.dispatch=bP.bind(null,sa,c),[P.memoizedState,c]},useRef:function(c){var m=ws();return c={current:c},m.memoizedState=c},useState:k3,useDebugValue:Ib,useDeferredValue:function(c){return ws().memoizedState=c},useTransition:function(){var c=k3(!1),m=c[0];return c=wP.bind(null,c[1]),ws().memoizedState=c,[m,c]},useMutableSource:function(){},useSyncExternalStore:function(c,m,v){var P=sa,L=ws();if(aa){if(v===void 0)throw Error(Bt(407));v=v()}else{if(v=m(),$a===null)throw Error(Bt(349));Vc&30||d4(P,m,v)}L.memoizedState=v;var B={value:v,getSnapshot:m};return L.queue=B,A3(m4.bind(null,P,B,c),[c]),P.flags|=2048,pf(9,p4.bind(null,P,B,v,m),void 0,null),v},useId:function(){var c=ws(),m=$a.identifierPrefix;if(aa){var v=il,P=tl;v=(P&~(1<<32-No(P)-1)).toString(32)+v,m=":"+m+"R"+v,v=hf++,0<v&&(m+="H"+v.toString(32)),m+=":"}else v=yP++,m=":"+m+"r"+v.toString(32)+":";return c.memoizedState=m},unstable_isNewReconciler:!1},kP={readContext:co,useCallback:x4,useContext:co,useEffect:Db,useImperativeHandle:v4,useInsertionEffect:y4,useLayoutEffect:w4,useMemo:k4,useReducer:X0,useRef:_4,useState:function(){return X0(df)},useDebugValue:Ib,useDeferredValue:function(c){var m=ho();return A4(m,Ea.memoizedState,c)},useTransition:function(){var c=X0(df)[0],m=ho().memoizedState;return[c,m]},useMutableSource:c4,useSyncExternalStore:h4,useId:S4,unstable_isNewReconciler:!1},AP={readContext:co,useCallback:x4,useContext:co,useEffect:Db,useImperativeHandle:v4,useInsertionEffect:y4,useLayoutEffect:w4,useMemo:k4,useReducer:Q0,useRef:_4,useState:function(){return Q0(df)},useDebugValue:Ib,useDeferredValue:function(c){var m=ho();return Ea===null?m.memoizedState=c:A4(m,Ea.memoizedState,c)},useTransition:function(){var c=Q0(df)[0],m=ho().memoizedState;return[c,m]},useMutableSource:c4,useSyncExternalStore:h4,useId:S4,unstable_isNewReconciler:!1};function Ro(c,m){if(c&&c.defaultProps){m=la({},m),c=c.defaultProps;for(var v in c)m[v]===void 0&&(m[v]=c[v]);return m}return m}function Lw(c,m,v,P){m=c.memoizedState,v=v(P,m),v=v==null?m:la({},m,v),c.memoizedState=v,c.lanes===0&&(c.updateQueue.baseState=v)}var Ay={isMounted:function(c){return(c=c._reactInternals)?Gc(c)===c:!1},enqueueSetState:function(c,m,v){c=c._reactInternals;var P=_r(),L=wu(c),B=nl(P,L);B.payload=m,v!=null&&(B.callback=v),m=_u(c,B,L),m!==null&&(Fo(m,c,L,P),F_(m,c,L))},enqueueReplaceState:function(c,m,v){c=c._reactInternals;var P=_r(),L=wu(c),B=nl(P,L);B.tag=1,B.payload=m,v!=null&&(B.callback=v),m=_u(c,B,L),m!==null&&(Fo(m,c,L,P),F_(m,c,L))},enqueueForceUpdate:function(c,m){c=c._reactInternals;var v=_r(),P=wu(c),L=nl(v,P);L.tag=2,m!=null&&(L.callback=m),m=_u(c,L,P),m!==null&&(Fo(m,c,P,v),F_(m,c,P))}};function S3(c,m,v,P,L,B,K){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(P,B,K):m.prototype&&m.prototype.isPureReactComponent?!rf(v,P)||!rf(L,B):!0}function E4(c,m,v){var P=!1,L=xu,B=m.contextType;return typeof B=="object"&&B!==null?B=co(B):(L=zr(m)?$c:ur.current,P=m.contextTypes,B=(P=P!=null)?zd(c,L):xu),m=new m(v,B),c.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Ay,c.stateNode=m,m._reactInternals=c,P&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=L,c.__reactInternalMemoizedMaskedChildContext=B),m}function T3(c,m,v,P){c=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,P),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,P),m.state!==c&&Ay.enqueueReplaceState(m,m.state,null)}function Rw(c,m,v,P){var L=c.stateNode;L.props=v,L.state=c.memoizedState,L.refs={},Ab(c);var B=m.contextType;typeof B=="object"&&B!==null?L.context=co(B):(B=zr(m)?$c:ur.current,L.context=zd(c,B)),L.state=c.memoizedState,B=m.getDerivedStateFromProps,typeof B=="function"&&(Lw(c,m,B,v),L.state=c.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(m=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),m!==L.state&&Ay.enqueueReplaceState(L,L.state,null),sy(c,v,L,P),L.state=c.memoizedState),typeof L.componentDidMount=="function"&&(c.flags|=4194308)}function Wd(c,m){try{var v="",P=m;do v+=X7(P),P=P.return;while(P);var L=v}catch(B){L=`
Error generating stack: `+B.message+`
`+B.stack}return{value:c,source:m,stack:L,digest:null}}function ew(c,m,v){return{value:c,source:null,stack:v??null,digest:m??null}}function Bw(c,m){try{console.error(m.value)}catch(v){setTimeout(function(){throw v})}}var SP=typeof WeakMap=="function"?WeakMap:Map;function C4(c,m,v){v=nl(-1,v),v.tag=3,v.payload={element:null};var P=m.value;return v.callback=function(){dy||(dy=!0,qw=P),Bw(c,m)},v}function D4(c,m,v){v=nl(-1,v),v.tag=3;var P=c.type.getDerivedStateFromError;if(typeof P=="function"){var L=m.value;v.payload=function(){return P(L)},v.callback=function(){Bw(c,m)}}var B=c.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(v.callback=function(){Bw(c,m),typeof P!="function"&&(yu===null?yu=new Set([this]):yu.add(this));var K=m.stack;this.componentDidCatch(m.value,{componentStack:K!==null?K:""})}),v}function P3(c,m,v){var P=c.pingCache;if(P===null){P=c.pingCache=new SP;var L=new Set;P.set(m,L)}else L=P.get(m),L===void 0&&(L=new Set,P.set(m,L));L.has(v)||(L.add(v),c=FP.bind(null,c,m,v),m.then(c,c))}function M3(c){do{var m;if((m=c.tag===13)&&(m=c.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return c;c=c.return}while(c!==null);return null}function E3(c,m,v,P,L){return c.mode&1?(c.flags|=65536,c.lanes=L,c):(c===m?c.flags|=65536:(c.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(m=nl(-1,1),m.tag=2,_u(v,m,1))),v.lanes|=1),c)}var TP=ll.ReactCurrentOwner,Dr=!1;function gr(c,m,v,P){m.child=c===null?o4(m,null,v,P):Rd(m,c.child,v,P)}function C3(c,m,v,P,L){v=v.render;var B=m.ref;return Cd(m,L),P=Eb(c,m,v,P,B,L),v=Cb(),c!==null&&!Dr?(m.updateQueue=c.updateQueue,m.flags&=-2053,c.lanes&=~L,sl(c,m,L)):(aa&&v&&_b(m),m.flags|=1,gr(c,m,P,L),m.child)}function D3(c,m,v,P,L){if(c===null){var B=v.type;return typeof B=="function"&&!Ob(B)&&B.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(m.tag=15,m.type=B,I4(c,m,B,P,L)):(c=J_(v.type,null,P,m,m.mode,L),c.ref=m.ref,c.return=m,m.child=c)}if(B=c.child,!(c.lanes&L)){var K=B.memoizedProps;if(v=v.compare,v=v!==null?v:rf,v(K,P)&&c.ref===m.ref)return sl(c,m,L)}return m.flags|=1,c=bu(B,P),c.ref=m.ref,c.return=m,m.child=c}function I4(c,m,v,P,L){if(c!==null){var B=c.memoizedProps;if(rf(B,P)&&c.ref===m.ref)if(Dr=!1,m.pendingProps=P=B,(c.lanes&L)!==0)c.flags&131072&&(Dr=!0);else return m.lanes=c.lanes,sl(c,m,L)}return Ww(c,m,v,P,L)}function z4(c,m,v){var P=m.pendingProps,L=P.children,B=c!==null?c.memoizedState:null;if(P.mode==="hidden")if(!(m.mode&1))m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Xn(Sd,qr),qr|=v;else{if(!(v&1073741824))return c=B!==null?B.baseLanes|v:v,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:c,cachePool:null,transitions:null},m.updateQueue=null,Xn(Sd,qr),qr|=c,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},P=B!==null?B.baseLanes:v,Xn(Sd,qr),qr|=P}else B!==null?(P=B.baseLanes|v,m.memoizedState=null):P=v,Xn(Sd,qr),qr|=P;return gr(c,m,L,v),m.child}function L4(c,m){var v=m.ref;(c===null&&v!==null||c!==null&&c.ref!==v)&&(m.flags|=512,m.flags|=2097152)}function Ww(c,m,v,P,L){var B=zr(v)?$c:ur.current;return B=zd(m,B),Cd(m,L),v=Eb(c,m,v,P,B,L),P=Cb(),c!==null&&!Dr?(m.updateQueue=c.updateQueue,m.flags&=-2053,c.lanes&=~L,sl(c,m,L)):(aa&&P&&_b(m),m.flags|=1,gr(c,m,v,L),m.child)}function I3(c,m,v,P,L){if(zr(v)){var B=!0;iy(m)}else B=!1;if(Cd(m,L),m.stateNode===null)j_(c,m),E4(m,v,P),Rw(m,v,P,L),P=!0;else if(c===null){var K=m.stateNode,o=m.memoizedProps;K.props=o;var _e=K.context,Ie=v.contextType;typeof Ie=="object"&&Ie!==null?Ie=co(Ie):(Ie=zr(v)?$c:ur.current,Ie=zd(m,Ie));var pt=v.getDerivedStateFromProps,dt=typeof pt=="function"||typeof K.getSnapshotBeforeUpdate=="function";dt||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(o!==P||_e!==Ie)&&T3(m,K,P,Ie),lu=!1;var Xe=m.memoizedState;K.state=Xe,sy(m,P,K,L),_e=m.memoizedState,o!==P||Xe!==_e||Ir.current||lu?(typeof pt=="function"&&(Lw(m,v,pt,P),_e=m.memoizedState),(o=lu||S3(m,v,o,P,Xe,_e,Ie))?(dt||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount()),typeof K.componentDidMount=="function"&&(m.flags|=4194308)):(typeof K.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=P,m.memoizedState=_e),K.props=P,K.state=_e,K.context=Ie,P=o):(typeof K.componentDidMount=="function"&&(m.flags|=4194308),P=!1)}else{K=m.stateNode,l4(c,m),o=m.memoizedProps,Ie=m.type===m.elementType?o:Ro(m.type,o),K.props=Ie,dt=m.pendingProps,Xe=K.context,_e=v.contextType,typeof _e=="object"&&_e!==null?_e=co(_e):(_e=zr(v)?$c:ur.current,_e=zd(m,_e));var zt=v.getDerivedStateFromProps;(pt=typeof zt=="function"||typeof K.getSnapshotBeforeUpdate=="function")||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(o!==dt||Xe!==_e)&&T3(m,K,P,_e),lu=!1,Xe=m.memoizedState,K.state=Xe,sy(m,P,K,L);var St=m.memoizedState;o!==dt||Xe!==St||Ir.current||lu?(typeof zt=="function"&&(Lw(m,v,zt,P),St=m.memoizedState),(Ie=lu||S3(m,v,Ie,P,Xe,St,_e)||!1)?(pt||typeof K.UNSAFE_componentWillUpdate!="function"&&typeof K.componentWillUpdate!="function"||(typeof K.componentWillUpdate=="function"&&K.componentWillUpdate(P,St,_e),typeof K.UNSAFE_componentWillUpdate=="function"&&K.UNSAFE_componentWillUpdate(P,St,_e)),typeof K.componentDidUpdate=="function"&&(m.flags|=4),typeof K.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof K.componentDidUpdate!="function"||o===c.memoizedProps&&Xe===c.memoizedState||(m.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||o===c.memoizedProps&&Xe===c.memoizedState||(m.flags|=1024),m.memoizedProps=P,m.memoizedState=St),K.props=P,K.state=St,K.context=_e,P=Ie):(typeof K.componentDidUpdate!="function"||o===c.memoizedProps&&Xe===c.memoizedState||(m.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||o===c.memoizedProps&&Xe===c.memoizedState||(m.flags|=1024),P=!1)}return Nw(c,m,v,P,B,L)}function Nw(c,m,v,P,L,B){L4(c,m);var K=(m.flags&128)!==0;if(!P&&!K)return L&&_3(m,v,!1),sl(c,m,B);P=m.stateNode,TP.current=m;var o=K&&typeof v.getDerivedStateFromError!="function"?null:P.render();return m.flags|=1,c!==null&&K?(m.child=Rd(m,c.child,null,B),m.child=Rd(m,null,o,B)):gr(c,m,o,B),m.memoizedState=P.state,L&&_3(m,v,!0),m.child}function R4(c){var m=c.stateNode;m.pendingContext?g3(c,m.pendingContext,m.pendingContext!==m.context):m.context&&g3(c,m.context,!1),Sb(c,m.containerInfo)}function z3(c,m,v,P,L){return Ld(),wb(L),m.flags|=256,gr(c,m,v,P),m.child}var Fw={dehydrated:null,treeContext:null,retryLane:0};function Ow(c){return{baseLanes:c,cachePool:null,transitions:null}}function B4(c,m,v){var P=m.pendingProps,L=oa.current,B=!1,K=(m.flags&128)!==0,o;if((o=K)||(o=c!==null&&c.memoizedState===null?!1:(L&2)!==0),o?(B=!0,m.flags&=-129):(c===null||c.memoizedState!==null)&&(L|=1),Xn(oa,L&1),c===null)return Iw(m),c=m.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?(m.mode&1?c.data==="$!"?m.lanes=8:m.lanes=1073741824:m.lanes=1,null):(K=P.children,c=P.fallback,B?(P=m.mode,B=m.child,K={mode:"hidden",children:K},!(P&1)&&B!==null?(B.childLanes=0,B.pendingProps=K):B=Py(K,P,0,null),c=Oc(c,P,v,null),B.return=m,c.return=m,B.sibling=c,m.child=B,m.child.memoizedState=Ow(v),m.memoizedState=Fw,c):zb(m,K));if(L=c.memoizedState,L!==null&&(o=L.dehydrated,o!==null))return PP(c,m,K,P,o,L,v);if(B){B=P.fallback,K=m.mode,L=c.child,o=L.sibling;var _e={mode:"hidden",children:P.children};return!(K&1)&&m.child!==L?(P=m.child,P.childLanes=0,P.pendingProps=_e,m.deletions=null):(P=bu(L,_e),P.subtreeFlags=L.subtreeFlags&14680064),o!==null?B=bu(o,B):(B=Oc(B,K,v,null),B.flags|=2),B.return=m,P.return=m,P.sibling=B,m.child=P,P=B,B=m.child,K=c.child.memoizedState,K=K===null?Ow(v):{baseLanes:K.baseLanes|v,cachePool:null,transitions:K.transitions},B.memoizedState=K,B.childLanes=c.childLanes&~v,m.memoizedState=Fw,P}return B=c.child,c=B.sibling,P=bu(B,{mode:"visible",children:P.children}),!(m.mode&1)&&(P.lanes=v),P.return=m,P.sibling=null,c!==null&&(v=m.deletions,v===null?(m.deletions=[c],m.flags|=16):v.push(c)),m.child=P,m.memoizedState=null,P}function zb(c,m){return m=Py({mode:"visible",children:m},c.mode,0,null),m.return=c,c.child=m}function E_(c,m,v,P){return P!==null&&wb(P),Rd(m,c.child,null,v),c=zb(m,m.pendingProps.children),c.flags|=2,m.memoizedState=null,c}function PP(c,m,v,P,L,B,K){if(v)return m.flags&256?(m.flags&=-257,P=ew(Error(Bt(422))),E_(c,m,K,P)):m.memoizedState!==null?(m.child=c.child,m.flags|=128,null):(B=P.fallback,L=m.mode,P=Py({mode:"visible",children:P.children},L,0,null),B=Oc(B,L,K,null),B.flags|=2,P.return=m,B.return=m,P.sibling=B,m.child=P,m.mode&1&&Rd(m,c.child,null,K),m.child.memoizedState=Ow(K),m.memoizedState=Fw,B);if(!(m.mode&1))return E_(c,m,K,null);if(L.data==="$!"){if(P=L.nextSibling&&L.nextSibling.dataset,P)var o=P.dgst;return P=o,B=Error(Bt(419)),P=ew(B,P,void 0),E_(c,m,K,P)}if(o=(K&c.childLanes)!==0,Dr||o){if(P=$a,P!==null){switch(K&-K){case 4:L=2;break;case 16:L=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:L=32;break;case 536870912:L=268435456;break;default:L=0}L=L&(P.suspendedLanes|K)?0:L,L!==0&&L!==B.retryLane&&(B.retryLane=L,ol(c,L),Fo(P,c,L,-1))}return Fb(),P=ew(Error(Bt(421))),E_(c,m,K,P)}return L.data==="$?"?(m.flags|=128,m.child=c.child,m=OP.bind(null,c),L._reactRetry=m,null):(c=B.treeContext,Gr=gu(L.nextSibling),Yr=m,aa=!0,Wo=null,c!==null&&(oo[so++]=tl,oo[so++]=il,oo[so++]=jc,tl=c.id,il=c.overflow,jc=m),m=zb(m,P.children),m.flags|=4096,m)}function L3(c,m,v){c.lanes|=m;var P=c.alternate;P!==null&&(P.lanes|=m),zw(c.return,m,v)}function tw(c,m,v,P,L){var B=c.memoizedState;B===null?c.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:P,tail:v,tailMode:L}:(B.isBackwards=m,B.rendering=null,B.renderingStartTime=0,B.last=P,B.tail=v,B.tailMode=L)}function W4(c,m,v){var P=m.pendingProps,L=P.revealOrder,B=P.tail;if(gr(c,m,P.children,v),P=oa.current,P&2)P=P&1|2,m.flags|=128;else{if(c!==null&&c.flags&128)e:for(c=m.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&L3(c,v,m);else if(c.tag===19)L3(c,v,m);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===m)break e;for(;c.sibling===null;){if(c.return===null||c.return===m)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}P&=1}if(Xn(oa,P),!(m.mode&1))m.memoizedState=null;else switch(L){case"forwards":for(v=m.child,L=null;v!==null;)c=v.alternate,c!==null&&ly(c)===null&&(L=v),v=v.sibling;v=L,v===null?(L=m.child,m.child=null):(L=v.sibling,v.sibling=null),tw(m,!1,L,v,B);break;case"backwards":for(v=null,L=m.child,m.child=null;L!==null;){if(c=L.alternate,c!==null&&ly(c)===null){m.child=L;break}c=L.sibling,L.sibling=v,v=L,L=c}tw(m,!0,v,null,B);break;case"together":tw(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function j_(c,m){!(m.mode&1)&&c!==null&&(c.alternate=null,m.alternate=null,m.flags|=2)}function sl(c,m,v){if(c!==null&&(m.dependencies=c.dependencies),Uc|=m.lanes,!(v&m.childLanes))return null;if(c!==null&&m.child!==c.child)throw Error(Bt(153));if(m.child!==null){for(c=m.child,v=bu(c,c.pendingProps),m.child=v,v.return=m;c.sibling!==null;)c=c.sibling,v=v.sibling=bu(c,c.pendingProps),v.return=m;v.sibling=null}return m.child}function MP(c,m,v){switch(m.tag){case 3:R4(m),Ld();break;case 5:u4(m);break;case 1:zr(m.type)&&iy(m);break;case 4:Sb(m,m.stateNode.containerInfo);break;case 10:var P=m.type._context,L=m.memoizedProps.value;Xn(ry,P._currentValue),P._currentValue=L;break;case 13:if(P=m.memoizedState,P!==null)return P.dehydrated!==null?(Xn(oa,oa.current&1),m.flags|=128,null):v&m.child.childLanes?B4(c,m,v):(Xn(oa,oa.current&1),c=sl(c,m,v),c!==null?c.sibling:null);Xn(oa,oa.current&1);break;case 19:if(P=(v&m.childLanes)!==0,c.flags&128){if(P)return W4(c,m,v);m.flags|=128}if(L=m.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),Xn(oa,oa.current),P)break;return null;case 22:case 23:return m.lanes=0,z4(c,m,v)}return sl(c,m,v)}var N4,$w,F4,O4;N4=function(c,m){for(var v=m.child;v!==null;){if(v.tag===5||v.tag===6)c.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};$w=function(){};F4=function(c,m,v,P){var L=c.memoizedProps;if(L!==P){c=m.stateNode,Nc(xs.current);var B=null;switch(v){case"input":L=uw(c,L),P=uw(c,P),B=[];break;case"select":L=la({},L,{value:void 0}),P=la({},P,{value:void 0}),B=[];break;case"textarea":L=dw(c,L),P=dw(c,P),B=[];break;default:typeof L.onClick!="function"&&typeof P.onClick=="function"&&(c.onclick=ey)}mw(v,P);var K;v=null;for(Ie in L)if(!P.hasOwnProperty(Ie)&&L.hasOwnProperty(Ie)&&L[Ie]!=null)if(Ie==="style"){var o=L[Ie];for(K in o)o.hasOwnProperty(K)&&(v||(v={}),v[K]="")}else Ie!=="dangerouslySetInnerHTML"&&Ie!=="children"&&Ie!=="suppressContentEditableWarning"&&Ie!=="suppressHydrationWarning"&&Ie!=="autoFocus"&&(Km.hasOwnProperty(Ie)?B||(B=[]):(B=B||[]).push(Ie,null));for(Ie in P){var _e=P[Ie];if(o=L!=null?L[Ie]:void 0,P.hasOwnProperty(Ie)&&_e!==o&&(_e!=null||o!=null))if(Ie==="style")if(o){for(K in o)!o.hasOwnProperty(K)||_e&&_e.hasOwnProperty(K)||(v||(v={}),v[K]="");for(K in _e)_e.hasOwnProperty(K)&&o[K]!==_e[K]&&(v||(v={}),v[K]=_e[K])}else v||(B||(B=[]),B.push(Ie,v)),v=_e;else Ie==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,o=o?o.__html:void 0,_e!=null&&o!==_e&&(B=B||[]).push(Ie,_e)):Ie==="children"?typeof _e!="string"&&typeof _e!="number"||(B=B||[]).push(Ie,""+_e):Ie!=="suppressContentEditableWarning"&&Ie!=="suppressHydrationWarning"&&(Km.hasOwnProperty(Ie)?(_e!=null&&Ie==="onScroll"&&ea("scroll",c),B||o===_e||(B=[])):(B=B||[]).push(Ie,_e))}v&&(B=B||[]).push("style",v);var Ie=B;(m.updateQueue=Ie)&&(m.flags|=4)}};O4=function(c,m,v,P){v!==P&&(m.flags|=4)};function Bm(c,m){if(!aa)switch(c.tailMode){case"hidden":m=c.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?c.tail=null:v.sibling=null;break;case"collapsed":v=c.tail;for(var P=null;v!==null;)v.alternate!==null&&(P=v),v=v.sibling;P===null?m||c.tail===null?c.tail=null:c.tail.sibling=null:P.sibling=null}}function sr(c){var m=c.alternate!==null&&c.alternate.child===c.child,v=0,P=0;if(m)for(var L=c.child;L!==null;)v|=L.lanes|L.childLanes,P|=L.subtreeFlags&14680064,P|=L.flags&14680064,L.return=c,L=L.sibling;else for(L=c.child;L!==null;)v|=L.lanes|L.childLanes,P|=L.subtreeFlags,P|=L.flags,L.return=c,L=L.sibling;return c.subtreeFlags|=P,c.childLanes=v,m}function EP(c,m,v){var P=m.pendingProps;switch(yb(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sr(m),null;case 1:return zr(m.type)&&ty(),sr(m),null;case 3:return P=m.stateNode,Bd(),ia(Ir),ia(ur),Pb(),P.pendingContext&&(P.context=P.pendingContext,P.pendingContext=null),(c===null||c.child===null)&&(P_(m)?m.flags|=4:c===null||c.memoizedState.isDehydrated&&!(m.flags&256)||(m.flags|=1024,Wo!==null&&(Hw(Wo),Wo=null))),$w(c,m),sr(m),null;case 5:Tb(m);var L=Nc(cf.current);if(v=m.type,c!==null&&m.stateNode!=null)F4(c,m,v,P,L),c.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!P){if(m.stateNode===null)throw Error(Bt(166));return sr(m),null}if(c=Nc(xs.current),P_(m)){P=m.stateNode,v=m.type;var B=m.memoizedProps;switch(P[bs]=m,P[lf]=B,c=(m.mode&1)!==0,v){case"dialog":ea("cancel",P),ea("close",P);break;case"iframe":case"object":case"embed":ea("load",P);break;case"video":case"audio":for(L=0;L<$m.length;L++)ea($m[L],P);break;case"source":ea("error",P);break;case"img":case"image":case"link":ea("error",P),ea("load",P);break;case"details":ea("toggle",P);break;case"input":Vk(P,B),ea("invalid",P);break;case"select":P._wrapperState={wasMultiple:!!B.multiple},ea("invalid",P);break;case"textarea":Jk(P,B),ea("invalid",P)}mw(v,B),L=null;for(var K in B)if(B.hasOwnProperty(K)){var o=B[K];K==="children"?typeof o=="string"?P.textContent!==o&&(B.suppressHydrationWarning!==!0&&T_(P.textContent,o,c),L=["children",o]):typeof o=="number"&&P.textContent!==""+o&&(B.suppressHydrationWarning!==!0&&T_(P.textContent,o,c),L=["children",""+o]):Km.hasOwnProperty(K)&&o!=null&&K==="onScroll"&&ea("scroll",P)}switch(v){case"input":y_(P),Uk(P,B,!0);break;case"textarea":y_(P),qk(P);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(P.onclick=ey)}P=L,m.updateQueue=P,P!==null&&(m.flags|=4)}else{K=L.nodeType===9?L:L.ownerDocument,c==="http://www.w3.org/1999/xhtml"&&(c=mA(v)),c==="http://www.w3.org/1999/xhtml"?v==="script"?(c=K.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild)):typeof P.is=="string"?c=K.createElement(v,{is:P.is}):(c=K.createElement(v),v==="select"&&(K=c,P.multiple?K.multiple=!0:P.size&&(K.size=P.size))):c=K.createElementNS(c,v),c[bs]=m,c[lf]=P,N4(c,m,!1,!1),m.stateNode=c;e:{switch(K=fw(v,P),v){case"dialog":ea("cancel",c),ea("close",c),L=P;break;case"iframe":case"object":case"embed":ea("load",c),L=P;break;case"video":case"audio":for(L=0;L<$m.length;L++)ea($m[L],c);L=P;break;case"source":ea("error",c),L=P;break;case"img":case"image":case"link":ea("error",c),ea("load",c),L=P;break;case"details":ea("toggle",c),L=P;break;case"input":Vk(c,P),L=uw(c,P),ea("invalid",c);break;case"option":L=P;break;case"select":c._wrapperState={wasMultiple:!!P.multiple},L=la({},P,{value:void 0}),ea("invalid",c);break;case"textarea":Jk(c,P),L=dw(c,P),ea("invalid",c);break;default:L=P}mw(v,L),o=L;for(B in o)if(o.hasOwnProperty(B)){var _e=o[B];B==="style"?_A(c,_e):B==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&fA(c,_e)):B==="children"?typeof _e=="string"?(v!=="textarea"||_e!=="")&&Xm(c,_e):typeof _e=="number"&&Xm(c,""+_e):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(Km.hasOwnProperty(B)?_e!=null&&B==="onScroll"&&ea("scroll",c):_e!=null&&nb(c,B,_e,K))}switch(v){case"input":y_(c),Uk(c,P,!1);break;case"textarea":y_(c),qk(c);break;case"option":P.value!=null&&c.setAttribute("value",""+vu(P.value));break;case"select":c.multiple=!!P.multiple,B=P.value,B!=null?Td(c,!!P.multiple,B,!1):P.defaultValue!=null&&Td(c,!!P.multiple,P.defaultValue,!0);break;default:typeof L.onClick=="function"&&(c.onclick=ey)}switch(v){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}}P&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return sr(m),null;case 6:if(c&&m.stateNode!=null)O4(c,m,c.memoizedProps,P);else{if(typeof P!="string"&&m.stateNode===null)throw Error(Bt(166));if(v=Nc(cf.current),Nc(xs.current),P_(m)){if(P=m.stateNode,v=m.memoizedProps,P[bs]=m,(B=P.nodeValue!==v)&&(c=Yr,c!==null))switch(c.tag){case 3:T_(P.nodeValue,v,(c.mode&1)!==0);break;case 5:c.memoizedProps.suppressHydrationWarning!==!0&&T_(P.nodeValue,v,(c.mode&1)!==0)}B&&(m.flags|=4)}else P=(v.nodeType===9?v:v.ownerDocument).createTextNode(P),P[bs]=m,m.stateNode=P}return sr(m),null;case 13:if(ia(oa),P=m.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(aa&&Gr!==null&&m.mode&1&&!(m.flags&128))a4(),Ld(),m.flags|=98560,B=!1;else if(B=P_(m),P!==null&&P.dehydrated!==null){if(c===null){if(!B)throw Error(Bt(318));if(B=m.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(Bt(317));B[bs]=m}else Ld(),!(m.flags&128)&&(m.memoizedState=null),m.flags|=4;sr(m),B=!1}else Wo!==null&&(Hw(Wo),Wo=null),B=!0;if(!B)return m.flags&65536?m:null}return m.flags&128?(m.lanes=v,m):(P=P!==null,P!==(c!==null&&c.memoizedState!==null)&&P&&(m.child.flags|=8192,m.mode&1&&(c===null||oa.current&1?Ca===0&&(Ca=3):Fb())),m.updateQueue!==null&&(m.flags|=4),sr(m),null);case 4:return Bd(),$w(c,m),c===null&&of(m.stateNode.containerInfo),sr(m),null;case 10:return xb(m.type._context),sr(m),null;case 17:return zr(m.type)&&ty(),sr(m),null;case 19:if(ia(oa),B=m.memoizedState,B===null)return sr(m),null;if(P=(m.flags&128)!==0,K=B.rendering,K===null)if(P)Bm(B,!1);else{if(Ca!==0||c!==null&&c.flags&128)for(c=m.child;c!==null;){if(K=ly(c),K!==null){for(m.flags|=128,Bm(B,!1),P=K.updateQueue,P!==null&&(m.updateQueue=P,m.flags|=4),m.subtreeFlags=0,P=v,v=m.child;v!==null;)B=v,c=P,B.flags&=14680066,K=B.alternate,K===null?(B.childLanes=0,B.lanes=c,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=K.childLanes,B.lanes=K.lanes,B.child=K.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=K.memoizedProps,B.memoizedState=K.memoizedState,B.updateQueue=K.updateQueue,B.type=K.type,c=K.dependencies,B.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),v=v.sibling;return Xn(oa,oa.current&1|2),m.child}c=c.sibling}B.tail!==null&&ya()>Nd&&(m.flags|=128,P=!0,Bm(B,!1),m.lanes=4194304)}else{if(!P)if(c=ly(K),c!==null){if(m.flags|=128,P=!0,v=c.updateQueue,v!==null&&(m.updateQueue=v,m.flags|=4),Bm(B,!0),B.tail===null&&B.tailMode==="hidden"&&!K.alternate&&!aa)return sr(m),null}else 2*ya()-B.renderingStartTime>Nd&&v!==1073741824&&(m.flags|=128,P=!0,Bm(B,!1),m.lanes=4194304);B.isBackwards?(K.sibling=m.child,m.child=K):(v=B.last,v!==null?v.sibling=K:m.child=K,B.last=K)}return B.tail!==null?(m=B.tail,B.rendering=m,B.tail=m.sibling,B.renderingStartTime=ya(),m.sibling=null,v=oa.current,Xn(oa,P?v&1|2:v&1),m):(sr(m),null);case 22:case 23:return Nb(),P=m.memoizedState!==null,c!==null&&c.memoizedState!==null!==P&&(m.flags|=8192),P&&m.mode&1?qr&1073741824&&(sr(m),m.subtreeFlags&6&&(m.flags|=8192)):sr(m),null;case 24:return null;case 25:return null}throw Error(Bt(156,m.tag))}function CP(c,m){switch(yb(m),m.tag){case 1:return zr(m.type)&&ty(),c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 3:return Bd(),ia(Ir),ia(ur),Pb(),c=m.flags,c&65536&&!(c&128)?(m.flags=c&-65537|128,m):null;case 5:return Tb(m),null;case 13:if(ia(oa),c=m.memoizedState,c!==null&&c.dehydrated!==null){if(m.alternate===null)throw Error(Bt(340));Ld()}return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 19:return ia(oa),null;case 4:return Bd(),null;case 10:return xb(m.type._context),null;case 22:case 23:return Nb(),null;case 24:return null;default:return null}}var C_=!1,lr=!1,DP=typeof WeakSet=="function"?WeakSet:Set,pi=null;function Ad(c,m){var v=c.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(P){da(c,m,P)}else v.current=null}function jw(c,m,v){try{v()}catch(P){da(c,m,P)}}var R3=!1;function IP(c,m){if(Sw=K_,c=JA(),gb(c)){if("selectionStart"in c)var v={start:c.selectionStart,end:c.selectionEnd};else e:{v=(v=c.ownerDocument)&&v.defaultView||window;var P=v.getSelection&&v.getSelection();if(P&&P.rangeCount!==0){v=P.anchorNode;var L=P.anchorOffset,B=P.focusNode;P=P.focusOffset;try{v.nodeType,B.nodeType}catch{v=null;break e}var K=0,o=-1,_e=-1,Ie=0,pt=0,dt=c,Xe=null;t:for(;;){for(var zt;dt!==v||L!==0&&dt.nodeType!==3||(o=K+L),dt!==B||P!==0&&dt.nodeType!==3||(_e=K+P),dt.nodeType===3&&(K+=dt.nodeValue.length),(zt=dt.firstChild)!==null;)Xe=dt,dt=zt;for(;;){if(dt===c)break t;if(Xe===v&&++Ie===L&&(o=K),Xe===B&&++pt===P&&(_e=K),(zt=dt.nextSibling)!==null)break;dt=Xe,Xe=dt.parentNode}dt=zt}v=o===-1||_e===-1?null:{start:o,end:_e}}else v=null}v=v||{start:0,end:0}}else v=null;for(Tw={focusedElem:c,selectionRange:v},K_=!1,pi=m;pi!==null;)if(m=pi,c=m.child,(m.subtreeFlags&1028)!==0&&c!==null)c.return=m,pi=c;else for(;pi!==null;){m=pi;try{var St=m.alternate;if(m.flags&1024)switch(m.tag){case 0:case 11:case 15:break;case 1:if(St!==null){var He=St.memoizedProps,yi=St.memoizedState,Ee=m.stateNode,Ae=Ee.getSnapshotBeforeUpdate(m.elementType===m.type?He:Ro(m.type,He),yi);Ee.__reactInternalSnapshotBeforeUpdate=Ae}break;case 3:var Oe=m.stateNode.containerInfo;Oe.nodeType===1?Oe.textContent="":Oe.nodeType===9&&Oe.documentElement&&Oe.removeChild(Oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Bt(163))}}catch(vt){da(m,m.return,vt)}if(c=m.sibling,c!==null){c.return=m.return,pi=c;break}pi=m.return}return St=R3,R3=!1,St}function Ym(c,m,v){var P=m.updateQueue;if(P=P!==null?P.lastEffect:null,P!==null){var L=P=P.next;do{if((L.tag&c)===c){var B=L.destroy;L.destroy=void 0,B!==void 0&&jw(m,v,B)}L=L.next}while(L!==P)}}function Sy(c,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&c)===c){var P=v.create;v.destroy=P()}v=v.next}while(v!==m)}}function Vw(c){var m=c.ref;if(m!==null){var v=c.stateNode;switch(c.tag){case 5:c=v;break;default:c=v}typeof m=="function"?m(c):m.current=c}}function $4(c){var m=c.alternate;m!==null&&(c.alternate=null,$4(m)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(m=c.stateNode,m!==null&&(delete m[bs],delete m[lf],delete m[Ew],delete m[mP],delete m[fP])),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function j4(c){return c.tag===5||c.tag===3||c.tag===4}function B3(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||j4(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Uw(c,m,v){var P=c.tag;if(P===5||P===6)c=c.stateNode,m?v.nodeType===8?v.parentNode.insertBefore(c,m):v.insertBefore(c,m):(v.nodeType===8?(m=v.parentNode,m.insertBefore(c,v)):(m=v,m.appendChild(c)),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=ey));else if(P!==4&&(c=c.child,c!==null))for(Uw(c,m,v),c=c.sibling;c!==null;)Uw(c,m,v),c=c.sibling}function Jw(c,m,v){var P=c.tag;if(P===5||P===6)c=c.stateNode,m?v.insertBefore(c,m):v.appendChild(c);else if(P!==4&&(c=c.child,c!==null))for(Jw(c,m,v),c=c.sibling;c!==null;)Jw(c,m,v),c=c.sibling}var Ga=null,Bo=!1;function ou(c,m,v){for(v=v.child;v!==null;)V4(c,m,v),v=v.sibling}function V4(c,m,v){if(vs&&typeof vs.onCommitFiberUnmount=="function")try{vs.onCommitFiberUnmount(_y,v)}catch{}switch(v.tag){case 5:lr||Ad(v,m);case 6:var P=Ga,L=Bo;Ga=null,ou(c,m,v),Ga=P,Bo=L,Ga!==null&&(Bo?(c=Ga,v=v.stateNode,c.nodeType===8?c.parentNode.removeChild(v):c.removeChild(v)):Ga.removeChild(v.stateNode));break;case 18:Ga!==null&&(Bo?(c=Ga,v=v.stateNode,c.nodeType===8?Y0(c.parentNode,v):c.nodeType===1&&Y0(c,v),nf(c)):Y0(Ga,v.stateNode));break;case 4:P=Ga,L=Bo,Ga=v.stateNode.containerInfo,Bo=!0,ou(c,m,v),Ga=P,Bo=L;break;case 0:case 11:case 14:case 15:if(!lr&&(P=v.updateQueue,P!==null&&(P=P.lastEffect,P!==null))){L=P=P.next;do{var B=L,K=B.destroy;B=B.tag,K!==void 0&&(B&2||B&4)&&jw(v,m,K),L=L.next}while(L!==P)}ou(c,m,v);break;case 1:if(!lr&&(Ad(v,m),P=v.stateNode,typeof P.componentWillUnmount=="function"))try{P.props=v.memoizedProps,P.state=v.memoizedState,P.componentWillUnmount()}catch(o){da(v,m,o)}ou(c,m,v);break;case 21:ou(c,m,v);break;case 22:v.mode&1?(lr=(P=lr)||v.memoizedState!==null,ou(c,m,v),lr=P):ou(c,m,v);break;default:ou(c,m,v)}}function W3(c){var m=c.updateQueue;if(m!==null){c.updateQueue=null;var v=c.stateNode;v===null&&(v=c.stateNode=new DP),m.forEach(function(P){var L=$P.bind(null,c,P);v.has(P)||(v.add(P),P.then(L,L))})}}function Lo(c,m){var v=m.deletions;if(v!==null)for(var P=0;P<v.length;P++){var L=v[P];try{var B=c,K=m,o=K;e:for(;o!==null;){switch(o.tag){case 5:Ga=o.stateNode,Bo=!1;break e;case 3:Ga=o.stateNode.containerInfo,Bo=!0;break e;case 4:Ga=o.stateNode.containerInfo,Bo=!0;break e}o=o.return}if(Ga===null)throw Error(Bt(160));V4(B,K,L),Ga=null,Bo=!1;var _e=L.alternate;_e!==null&&(_e.return=null),L.return=null}catch(Ie){da(L,m,Ie)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)U4(m,c),m=m.sibling}function U4(c,m){var v=c.alternate,P=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:if(Lo(m,c),ys(c),P&4){try{Ym(3,c,c.return),Sy(3,c)}catch(He){da(c,c.return,He)}try{Ym(5,c,c.return)}catch(He){da(c,c.return,He)}}break;case 1:Lo(m,c),ys(c),P&512&&v!==null&&Ad(v,v.return);break;case 5:if(Lo(m,c),ys(c),P&512&&v!==null&&Ad(v,v.return),c.flags&32){var L=c.stateNode;try{Xm(L,"")}catch(He){da(c,c.return,He)}}if(P&4&&(L=c.stateNode,L!=null)){var B=c.memoizedProps,K=v!==null?v.memoizedProps:B,o=c.type,_e=c.updateQueue;if(c.updateQueue=null,_e!==null)try{o==="input"&&B.type==="radio"&&B.name!=null&&dA(L,B),fw(o,K);var Ie=fw(o,B);for(K=0;K<_e.length;K+=2){var pt=_e[K],dt=_e[K+1];pt==="style"?_A(L,dt):pt==="dangerouslySetInnerHTML"?fA(L,dt):pt==="children"?Xm(L,dt):nb(L,pt,dt,Ie)}switch(o){case"input":cw(L,B);break;case"textarea":pA(L,B);break;case"select":var Xe=L._wrapperState.wasMultiple;L._wrapperState.wasMultiple=!!B.multiple;var zt=B.value;zt!=null?Td(L,!!B.multiple,zt,!1):Xe!==!!B.multiple&&(B.defaultValue!=null?Td(L,!!B.multiple,B.defaultValue,!0):Td(L,!!B.multiple,B.multiple?[]:"",!1))}L[lf]=B}catch(He){da(c,c.return,He)}}break;case 6:if(Lo(m,c),ys(c),P&4){if(c.stateNode===null)throw Error(Bt(162));L=c.stateNode,B=c.memoizedProps;try{L.nodeValue=B}catch(He){da(c,c.return,He)}}break;case 3:if(Lo(m,c),ys(c),P&4&&v!==null&&v.memoizedState.isDehydrated)try{nf(m.containerInfo)}catch(He){da(c,c.return,He)}break;case 4:Lo(m,c),ys(c);break;case 13:Lo(m,c),ys(c),L=c.child,L.flags&8192&&(B=L.memoizedState!==null,L.stateNode.isHidden=B,!B||L.alternate!==null&&L.alternate.memoizedState!==null||(Bb=ya())),P&4&&W3(c);break;case 22:if(pt=v!==null&&v.memoizedState!==null,c.mode&1?(lr=(Ie=lr)||pt,Lo(m,c),lr=Ie):Lo(m,c),ys(c),P&8192){if(Ie=c.memoizedState!==null,(c.stateNode.isHidden=Ie)&&!pt&&c.mode&1)for(pi=c,pt=c.child;pt!==null;){for(dt=pi=pt;pi!==null;){switch(Xe=pi,zt=Xe.child,Xe.tag){case 0:case 11:case 14:case 15:Ym(4,Xe,Xe.return);break;case 1:Ad(Xe,Xe.return);var St=Xe.stateNode;if(typeof St.componentWillUnmount=="function"){P=Xe,v=Xe.return;try{m=P,St.props=m.memoizedProps,St.state=m.memoizedState,St.componentWillUnmount()}catch(He){da(P,v,He)}}break;case 5:Ad(Xe,Xe.return);break;case 22:if(Xe.memoizedState!==null){F3(dt);continue}}zt!==null?(zt.return=Xe,pi=zt):F3(dt)}pt=pt.sibling}e:for(pt=null,dt=c;;){if(dt.tag===5){if(pt===null){pt=dt;try{L=dt.stateNode,Ie?(B=L.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(o=dt.stateNode,_e=dt.memoizedProps.style,K=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,o.style.display=gA("display",K))}catch(He){da(c,c.return,He)}}}else if(dt.tag===6){if(pt===null)try{dt.stateNode.nodeValue=Ie?"":dt.memoizedProps}catch(He){da(c,c.return,He)}}else if((dt.tag!==22&&dt.tag!==23||dt.memoizedState===null||dt===c)&&dt.child!==null){dt.child.return=dt,dt=dt.child;continue}if(dt===c)break e;for(;dt.sibling===null;){if(dt.return===null||dt.return===c)break e;pt===dt&&(pt=null),dt=dt.return}pt===dt&&(pt=null),dt.sibling.return=dt.return,dt=dt.sibling}}break;case 19:Lo(m,c),ys(c),P&4&&W3(c);break;case 21:break;default:Lo(m,c),ys(c)}}function ys(c){var m=c.flags;if(m&2){try{e:{for(var v=c.return;v!==null;){if(j4(v)){var P=v;break e}v=v.return}throw Error(Bt(160))}switch(P.tag){case 5:var L=P.stateNode;P.flags&32&&(Xm(L,""),P.flags&=-33);var B=B3(c);Jw(c,B,L);break;case 3:case 4:var K=P.stateNode.containerInfo,o=B3(c);Uw(c,o,K);break;default:throw Error(Bt(161))}}catch(_e){da(c,c.return,_e)}c.flags&=-3}m&4096&&(c.flags&=-4097)}function zP(c,m,v){pi=c,J4(c)}function J4(c,m,v){for(var P=(c.mode&1)!==0;pi!==null;){var L=pi,B=L.child;if(L.tag===22&&P){var K=L.memoizedState!==null||C_;if(!K){var o=L.alternate,_e=o!==null&&o.memoizedState!==null||lr;o=C_;var Ie=lr;if(C_=K,(lr=_e)&&!Ie)for(pi=L;pi!==null;)K=pi,_e=K.child,K.tag===22&&K.memoizedState!==null?O3(L):_e!==null?(_e.return=K,pi=_e):O3(L);for(;B!==null;)pi=B,J4(B),B=B.sibling;pi=L,C_=o,lr=Ie}N3(c)}else L.subtreeFlags&8772&&B!==null?(B.return=L,pi=B):N3(c)}}function N3(c){for(;pi!==null;){var m=pi;if(m.flags&8772){var v=m.alternate;try{if(m.flags&8772)switch(m.tag){case 0:case 11:case 15:lr||Sy(5,m);break;case 1:var P=m.stateNode;if(m.flags&4&&!lr)if(v===null)P.componentDidMount();else{var L=m.elementType===m.type?v.memoizedProps:Ro(m.type,v.memoizedProps);P.componentDidUpdate(L,v.memoizedState,P.__reactInternalSnapshotBeforeUpdate)}var B=m.updateQueue;B!==null&&x3(m,B,P);break;case 3:var K=m.updateQueue;if(K!==null){if(v=null,m.child!==null)switch(m.child.tag){case 5:v=m.child.stateNode;break;case 1:v=m.child.stateNode}x3(m,K,v)}break;case 5:var o=m.stateNode;if(v===null&&m.flags&4){v=o;var _e=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&v.focus();break;case"img":_e.src&&(v.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var Ie=m.alternate;if(Ie!==null){var pt=Ie.memoizedState;if(pt!==null){var dt=pt.dehydrated;dt!==null&&nf(dt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Bt(163))}lr||m.flags&512&&Vw(m)}catch(Xe){da(m,m.return,Xe)}}if(m===c){pi=null;break}if(v=m.sibling,v!==null){v.return=m.return,pi=v;break}pi=m.return}}function F3(c){for(;pi!==null;){var m=pi;if(m===c){pi=null;break}var v=m.sibling;if(v!==null){v.return=m.return,pi=v;break}pi=m.return}}function O3(c){for(;pi!==null;){var m=pi;try{switch(m.tag){case 0:case 11:case 15:var v=m.return;try{Sy(4,m)}catch(_e){da(m,v,_e)}break;case 1:var P=m.stateNode;if(typeof P.componentDidMount=="function"){var L=m.return;try{P.componentDidMount()}catch(_e){da(m,L,_e)}}var B=m.return;try{Vw(m)}catch(_e){da(m,B,_e)}break;case 5:var K=m.return;try{Vw(m)}catch(_e){da(m,K,_e)}}}catch(_e){da(m,m.return,_e)}if(m===c){pi=null;break}var o=m.sibling;if(o!==null){o.return=m.return,pi=o;break}pi=m.return}}var LP=Math.ceil,hy=ll.ReactCurrentDispatcher,Lb=ll.ReactCurrentOwner,uo=ll.ReactCurrentBatchConfig,Rn=0,$a=null,xa=null,Ya=0,qr=0,Sd=Au(0),Ca=0,mf=null,Uc=0,Ty=0,Rb=0,Hm=null,Cr=null,Bb=0,Nd=1/0,Qs=null,dy=!1,qw=null,yu=null,D_=!1,du=null,py=0,Zm=0,Gw=null,V_=-1,U_=0;function _r(){return Rn&6?ya():V_!==-1?V_:V_=ya()}function wu(c){return c.mode&1?Rn&2&&Ya!==0?Ya&-Ya:_P.transition!==null?(U_===0&&(U_=EA()),U_):(c=Vn,c!==0||(c=window.event,c=c===void 0?16:BA(c.type)),c):1}function Fo(c,m,v,P){if(50<Zm)throw Zm=0,Gw=null,Error(Bt(185));gf(c,v,P),(!(Rn&2)||c!==$a)&&(c===$a&&(!(Rn&2)&&(Ty|=v),Ca===4&&cu(c,Ya)),Lr(c,P),v===1&&Rn===0&&!(m.mode&1)&&(Nd=ya()+500,xy&&Su()))}function Lr(c,m){var v=c.callbackNode;_T(c,m);var P=Z_(c,c===$a?Ya:0);if(P===0)v!==null&&Hk(v),c.callbackNode=null,c.callbackPriority=0;else if(m=P&-P,c.callbackPriority!==m){if(v!=null&&Hk(v),m===1)c.tag===0?gP($3.bind(null,c)):t4($3.bind(null,c)),dP(function(){!(Rn&6)&&Su()}),v=null;else{switch(CA(P)){case 1:v=lb;break;case 4:v=PA;break;case 16:v=H_;break;case 536870912:v=MA;break;default:v=H_}v=Q4(v,q4.bind(null,c))}c.callbackPriority=m,c.callbackNode=v}}function q4(c,m){if(V_=-1,U_=0,Rn&6)throw Error(Bt(327));var v=c.callbackNode;if(Dd()&&c.callbackNode!==v)return null;var P=Z_(c,c===$a?Ya:0);if(P===0)return null;if(P&30||P&c.expiredLanes||m)m=my(c,P);else{m=P;var L=Rn;Rn|=2;var B=Y4();($a!==c||Ya!==m)&&(Qs=null,Nd=ya()+500,Fc(c,m));do try{WP();break}catch(o){G4(c,o)}while(!0);vb(),hy.current=B,Rn=L,xa!==null?m=0:($a=null,Ya=0,m=Ca)}if(m!==0){if(m===2&&(L=bw(c),L!==0&&(P=L,m=Yw(c,L))),m===1)throw v=mf,Fc(c,0),cu(c,P),Lr(c,ya()),v;if(m===6)cu(c,P);else{if(L=c.current.alternate,!(P&30)&&!RP(L)&&(m=my(c,P),m===2&&(B=bw(c),B!==0&&(P=B,m=Yw(c,B))),m===1))throw v=mf,Fc(c,0),cu(c,P),Lr(c,ya()),v;switch(c.finishedWork=L,c.finishedLanes=P,m){case 0:case 1:throw Error(Bt(345));case 2:Rc(c,Cr,Qs);break;case 3:if(cu(c,P),(P&130023424)===P&&(m=Bb+500-ya(),10<m)){if(Z_(c,0)!==0)break;if(L=c.suspendedLanes,(L&P)!==P){_r(),c.pingedLanes|=c.suspendedLanes&L;break}c.timeoutHandle=Mw(Rc.bind(null,c,Cr,Qs),m);break}Rc(c,Cr,Qs);break;case 4:if(cu(c,P),(P&4194240)===P)break;for(m=c.eventTimes,L=-1;0<P;){var K=31-No(P);B=1<<K,K=m[K],K>L&&(L=K),P&=~B}if(P=L,P=ya()-P,P=(120>P?120:480>P?480:1080>P?1080:1920>P?1920:3e3>P?3e3:4320>P?4320:1960*LP(P/1960))-P,10<P){c.timeoutHandle=Mw(Rc.bind(null,c,Cr,Qs),P);break}Rc(c,Cr,Qs);break;case 5:Rc(c,Cr,Qs);break;default:throw Error(Bt(329))}}}return Lr(c,ya()),c.callbackNode===v?q4.bind(null,c):null}function Yw(c,m){var v=Hm;return c.current.memoizedState.isDehydrated&&(Fc(c,m).flags|=256),c=my(c,m),c!==2&&(m=Cr,Cr=v,m!==null&&Hw(m)),c}function Hw(c){Cr===null?Cr=c:Cr.push.apply(Cr,c)}function RP(c){for(var m=c;;){if(m.flags&16384){var v=m.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var P=0;P<v.length;P++){var L=v[P],B=L.getSnapshot;L=L.value;try{if(!Oo(B(),L))return!1}catch{return!1}}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function cu(c,m){for(m&=~Rb,m&=~Ty,c.suspendedLanes|=m,c.pingedLanes&=~m,c=c.expirationTimes;0<m;){var v=31-No(m),P=1<<v;c[v]=-1,m&=~P}}function $3(c){if(Rn&6)throw Error(Bt(327));Dd();var m=Z_(c,0);if(!(m&1))return Lr(c,ya()),null;var v=my(c,m);if(c.tag!==0&&v===2){var P=bw(c);P!==0&&(m=P,v=Yw(c,P))}if(v===1)throw v=mf,Fc(c,0),cu(c,m),Lr(c,ya()),v;if(v===6)throw Error(Bt(345));return c.finishedWork=c.current.alternate,c.finishedLanes=m,Rc(c,Cr,Qs),Lr(c,ya()),null}function Wb(c,m){var v=Rn;Rn|=1;try{return c(m)}finally{Rn=v,Rn===0&&(Nd=ya()+500,xy&&Su())}}function Jc(c){du!==null&&du.tag===0&&!(Rn&6)&&Dd();var m=Rn;Rn|=1;var v=uo.transition,P=Vn;try{if(uo.transition=null,Vn=1,c)return c()}finally{Vn=P,uo.transition=v,Rn=m,!(Rn&6)&&Su()}}function Nb(){qr=Sd.current,ia(Sd)}function Fc(c,m){c.finishedWork=null,c.finishedLanes=0;var v=c.timeoutHandle;if(v!==-1&&(c.timeoutHandle=-1,hP(v)),xa!==null)for(v=xa.return;v!==null;){var P=v;switch(yb(P),P.tag){case 1:P=P.type.childContextTypes,P!=null&&ty();break;case 3:Bd(),ia(Ir),ia(ur),Pb();break;case 5:Tb(P);break;case 4:Bd();break;case 13:ia(oa);break;case 19:ia(oa);break;case 10:xb(P.type._context);break;case 22:case 23:Nb()}v=v.return}if($a=c,xa=c=bu(c.current,null),Ya=qr=m,Ca=0,mf=null,Rb=Ty=Uc=0,Cr=Hm=null,Wc!==null){for(m=0;m<Wc.length;m++)if(v=Wc[m],P=v.interleaved,P!==null){v.interleaved=null;var L=P.next,B=v.pending;if(B!==null){var K=B.next;B.next=L,P.next=K}v.pending=P}Wc=null}return c}function G4(c,m){do{var v=xa;try{if(vb(),O_.current=cy,uy){for(var P=sa.memoizedState;P!==null;){var L=P.queue;L!==null&&(L.pending=null),P=P.next}uy=!1}if(Vc=0,Oa=Ea=sa=null,Gm=!1,hf=0,Lb.current=null,v===null||v.return===null){Ca=1,mf=m,xa=null;break}e:{var B=c,K=v.return,o=v,_e=m;if(m=Ya,o.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var Ie=_e,pt=o,dt=pt.tag;if(!(pt.mode&1)&&(dt===0||dt===11||dt===15)){var Xe=pt.alternate;Xe?(pt.updateQueue=Xe.updateQueue,pt.memoizedState=Xe.memoizedState,pt.lanes=Xe.lanes):(pt.updateQueue=null,pt.memoizedState=null)}var zt=M3(K);if(zt!==null){zt.flags&=-257,E3(zt,K,o,B,m),zt.mode&1&&P3(B,Ie,m),m=zt,_e=Ie;var St=m.updateQueue;if(St===null){var He=new Set;He.add(_e),m.updateQueue=He}else St.add(_e);break e}else{if(!(m&1)){P3(B,Ie,m),Fb();break e}_e=Error(Bt(426))}}else if(aa&&o.mode&1){var yi=M3(K);if(yi!==null){!(yi.flags&65536)&&(yi.flags|=256),E3(yi,K,o,B,m),wb(Wd(_e,o));break e}}B=_e=Wd(_e,o),Ca!==4&&(Ca=2),Hm===null?Hm=[B]:Hm.push(B),B=K;do{switch(B.tag){case 3:B.flags|=65536,m&=-m,B.lanes|=m;var Ee=C4(B,_e,m);v3(B,Ee);break e;case 1:o=_e;var Ae=B.type,Oe=B.stateNode;if(!(B.flags&128)&&(typeof Ae.getDerivedStateFromError=="function"||Oe!==null&&typeof Oe.componentDidCatch=="function"&&(yu===null||!yu.has(Oe)))){B.flags|=65536,m&=-m,B.lanes|=m;var vt=D4(B,o,m);v3(B,vt);break e}}B=B.return}while(B!==null)}Z4(v)}catch(Ot){m=Ot,xa===v&&v!==null&&(xa=v=v.return);continue}break}while(!0)}function Y4(){var c=hy.current;return hy.current=cy,c===null?cy:c}function Fb(){(Ca===0||Ca===3||Ca===2)&&(Ca=4),$a===null||!(Uc&268435455)&&!(Ty&268435455)||cu($a,Ya)}function my(c,m){var v=Rn;Rn|=2;var P=Y4();($a!==c||Ya!==m)&&(Qs=null,Fc(c,m));do try{BP();break}catch(L){G4(c,L)}while(!0);if(vb(),Rn=v,hy.current=P,xa!==null)throw Error(Bt(261));return $a=null,Ya=0,Ca}function BP(){for(;xa!==null;)H4(xa)}function WP(){for(;xa!==null&&!lT();)H4(xa)}function H4(c){var m=X4(c.alternate,c,qr);c.memoizedProps=c.pendingProps,m===null?Z4(c):xa=m,Lb.current=null}function Z4(c){var m=c;do{var v=m.alternate;if(c=m.return,m.flags&32768){if(v=CP(v,m),v!==null){v.flags&=32767,xa=v;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{Ca=6,xa=null;return}}else if(v=EP(v,m,qr),v!==null){xa=v;return}if(m=m.sibling,m!==null){xa=m;return}xa=m=c}while(m!==null);Ca===0&&(Ca=5)}function Rc(c,m,v){var P=Vn,L=uo.transition;try{uo.transition=null,Vn=1,NP(c,m,v,P)}finally{uo.transition=L,Vn=P}return null}function NP(c,m,v,P){do Dd();while(du!==null);if(Rn&6)throw Error(Bt(327));v=c.finishedWork;var L=c.finishedLanes;if(v===null)return null;if(c.finishedWork=null,c.finishedLanes=0,v===c.current)throw Error(Bt(177));c.callbackNode=null,c.callbackPriority=0;var B=v.lanes|v.childLanes;if(yT(c,B),c===$a&&(xa=$a=null,Ya=0),!(v.subtreeFlags&2064)&&!(v.flags&2064)||D_||(D_=!0,Q4(H_,function(){return Dd(),null})),B=(v.flags&15990)!==0,v.subtreeFlags&15990||B){B=uo.transition,uo.transition=null;var K=Vn;Vn=1;var o=Rn;Rn|=4,Lb.current=null,IP(c,v),U4(v,c),aP(Tw),K_=!!Sw,Tw=Sw=null,c.current=v,zP(v),uT(),Rn=o,Vn=K,uo.transition=B}else c.current=v;if(D_&&(D_=!1,du=c,py=L),B=c.pendingLanes,B===0&&(yu=null),dT(v.stateNode),Lr(c,ya()),m!==null)for(P=c.onRecoverableError,v=0;v<m.length;v++)L=m[v],P(L.value,{componentStack:L.stack,digest:L.digest});if(dy)throw dy=!1,c=qw,qw=null,c;return py&1&&c.tag!==0&&Dd(),B=c.pendingLanes,B&1?c===Gw?Zm++:(Zm=0,Gw=c):Zm=0,Su(),null}function Dd(){if(du!==null){var c=CA(py),m=uo.transition,v=Vn;try{if(uo.transition=null,Vn=16>c?16:c,du===null)var P=!1;else{if(c=du,du=null,py=0,Rn&6)throw Error(Bt(331));var L=Rn;for(Rn|=4,pi=c.current;pi!==null;){var B=pi,K=B.child;if(pi.flags&16){var o=B.deletions;if(o!==null){for(var _e=0;_e<o.length;_e++){var Ie=o[_e];for(pi=Ie;pi!==null;){var pt=pi;switch(pt.tag){case 0:case 11:case 15:Ym(8,pt,B)}var dt=pt.child;if(dt!==null)dt.return=pt,pi=dt;else for(;pi!==null;){pt=pi;var Xe=pt.sibling,zt=pt.return;if($4(pt),pt===Ie){pi=null;break}if(Xe!==null){Xe.return=zt,pi=Xe;break}pi=zt}}}var St=B.alternate;if(St!==null){var He=St.child;if(He!==null){St.child=null;do{var yi=He.sibling;He.sibling=null,He=yi}while(He!==null)}}pi=B}}if(B.subtreeFlags&2064&&K!==null)K.return=B,pi=K;else e:for(;pi!==null;){if(B=pi,B.flags&2048)switch(B.tag){case 0:case 11:case 15:Ym(9,B,B.return)}var Ee=B.sibling;if(Ee!==null){Ee.return=B.return,pi=Ee;break e}pi=B.return}}var Ae=c.current;for(pi=Ae;pi!==null;){K=pi;var Oe=K.child;if(K.subtreeFlags&2064&&Oe!==null)Oe.return=K,pi=Oe;else e:for(K=Ae;pi!==null;){if(o=pi,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Sy(9,o)}}catch(Ot){da(o,o.return,Ot)}if(o===K){pi=null;break e}var vt=o.sibling;if(vt!==null){vt.return=o.return,pi=vt;break e}pi=o.return}}if(Rn=L,Su(),vs&&typeof vs.onPostCommitFiberRoot=="function")try{vs.onPostCommitFiberRoot(_y,c)}catch{}P=!0}return P}finally{Vn=v,uo.transition=m}}return!1}function j3(c,m,v){m=Wd(v,m),m=C4(c,m,1),c=_u(c,m,1),m=_r(),c!==null&&(gf(c,1,m),Lr(c,m))}function da(c,m,v){if(c.tag===3)j3(c,c,v);else for(;m!==null;){if(m.tag===3){j3(m,c,v);break}else if(m.tag===1){var P=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(yu===null||!yu.has(P))){c=Wd(v,c),c=D4(m,c,1),m=_u(m,c,1),c=_r(),m!==null&&(gf(m,1,c),Lr(m,c));break}}m=m.return}}function FP(c,m,v){var P=c.pingCache;P!==null&&P.delete(m),m=_r(),c.pingedLanes|=c.suspendedLanes&v,$a===c&&(Ya&v)===v&&(Ca===4||Ca===3&&(Ya&130023424)===Ya&&500>ya()-Bb?Fc(c,0):Rb|=v),Lr(c,m)}function K4(c,m){m===0&&(c.mode&1?(m=v_,v_<<=1,!(v_&130023424)&&(v_=4194304)):m=1);var v=_r();c=ol(c,m),c!==null&&(gf(c,m,v),Lr(c,v))}function OP(c){var m=c.memoizedState,v=0;m!==null&&(v=m.retryLane),K4(c,v)}function $P(c,m){var v=0;switch(c.tag){case 13:var P=c.stateNode,L=c.memoizedState;L!==null&&(v=L.retryLane);break;case 19:P=c.stateNode;break;default:throw Error(Bt(314))}P!==null&&P.delete(m),K4(c,v)}var X4;X4=function(c,m,v){if(c!==null)if(c.memoizedProps!==m.pendingProps||Ir.current)Dr=!0;else{if(!(c.lanes&v)&&!(m.flags&128))return Dr=!1,MP(c,m,v);Dr=!!(c.flags&131072)}else Dr=!1,aa&&m.flags&1048576&&i4(m,ay,m.index);switch(m.lanes=0,m.tag){case 2:var P=m.type;j_(c,m),c=m.pendingProps;var L=zd(m,ur.current);Cd(m,v),L=Eb(null,m,P,c,L,v);var B=Cb();return m.flags|=1,typeof L=="object"&&L!==null&&typeof L.render=="function"&&L.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,zr(P)?(B=!0,iy(m)):B=!1,m.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,Ab(m),L.updater=Ay,m.stateNode=L,L._reactInternals=m,Rw(m,P,c,v),m=Nw(null,m,P,!0,B,v)):(m.tag=0,aa&&B&&_b(m),gr(null,m,L,v),m=m.child),m;case 16:P=m.elementType;e:{switch(j_(c,m),c=m.pendingProps,L=P._init,P=L(P._payload),m.type=P,L=m.tag=VP(P),c=Ro(P,c),L){case 0:m=Ww(null,m,P,c,v);break e;case 1:m=I3(null,m,P,c,v);break e;case 11:m=C3(null,m,P,c,v);break e;case 14:m=D3(null,m,P,Ro(P.type,c),v);break e}throw Error(Bt(306,P,""))}return m;case 0:return P=m.type,L=m.pendingProps,L=m.elementType===P?L:Ro(P,L),Ww(c,m,P,L,v);case 1:return P=m.type,L=m.pendingProps,L=m.elementType===P?L:Ro(P,L),I3(c,m,P,L,v);case 3:e:{if(R4(m),c===null)throw Error(Bt(387));P=m.pendingProps,B=m.memoizedState,L=B.element,l4(c,m),sy(m,P,null,v);var K=m.memoizedState;if(P=K.element,B.isDehydrated)if(B={element:P,isDehydrated:!1,cache:K.cache,pendingSuspenseBoundaries:K.pendingSuspenseBoundaries,transitions:K.transitions},m.updateQueue.baseState=B,m.memoizedState=B,m.flags&256){L=Wd(Error(Bt(423)),m),m=z3(c,m,P,v,L);break e}else if(P!==L){L=Wd(Error(Bt(424)),m),m=z3(c,m,P,v,L);break e}else for(Gr=gu(m.stateNode.containerInfo.firstChild),Yr=m,aa=!0,Wo=null,v=o4(m,null,P,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Ld(),P===L){m=sl(c,m,v);break e}gr(c,m,P,v)}m=m.child}return m;case 5:return u4(m),c===null&&Iw(m),P=m.type,L=m.pendingProps,B=c!==null?c.memoizedProps:null,K=L.children,Pw(P,L)?K=null:B!==null&&Pw(P,B)&&(m.flags|=32),L4(c,m),gr(c,m,K,v),m.child;case 6:return c===null&&Iw(m),null;case 13:return B4(c,m,v);case 4:return Sb(m,m.stateNode.containerInfo),P=m.pendingProps,c===null?m.child=Rd(m,null,P,v):gr(c,m,P,v),m.child;case 11:return P=m.type,L=m.pendingProps,L=m.elementType===P?L:Ro(P,L),C3(c,m,P,L,v);case 7:return gr(c,m,m.pendingProps,v),m.child;case 8:return gr(c,m,m.pendingProps.children,v),m.child;case 12:return gr(c,m,m.pendingProps.children,v),m.child;case 10:e:{if(P=m.type._context,L=m.pendingProps,B=m.memoizedProps,K=L.value,Xn(ry,P._currentValue),P._currentValue=K,B!==null)if(Oo(B.value,K)){if(B.children===L.children&&!Ir.current){m=sl(c,m,v);break e}}else for(B=m.child,B!==null&&(B.return=m);B!==null;){var o=B.dependencies;if(o!==null){K=B.child;for(var _e=o.firstContext;_e!==null;){if(_e.context===P){if(B.tag===1){_e=nl(-1,v&-v),_e.tag=2;var Ie=B.updateQueue;if(Ie!==null){Ie=Ie.shared;var pt=Ie.pending;pt===null?_e.next=_e:(_e.next=pt.next,pt.next=_e),Ie.pending=_e}}B.lanes|=v,_e=B.alternate,_e!==null&&(_e.lanes|=v),zw(B.return,v,m),o.lanes|=v;break}_e=_e.next}}else if(B.tag===10)K=B.type===m.type?null:B.child;else if(B.tag===18){if(K=B.return,K===null)throw Error(Bt(341));K.lanes|=v,o=K.alternate,o!==null&&(o.lanes|=v),zw(K,v,m),K=B.sibling}else K=B.child;if(K!==null)K.return=B;else for(K=B;K!==null;){if(K===m){K=null;break}if(B=K.sibling,B!==null){B.return=K.return,K=B;break}K=K.return}B=K}gr(c,m,L.children,v),m=m.child}return m;case 9:return L=m.type,P=m.pendingProps.children,Cd(m,v),L=co(L),P=P(L),m.flags|=1,gr(c,m,P,v),m.child;case 14:return P=m.type,L=Ro(P,m.pendingProps),L=Ro(P.type,L),D3(c,m,P,L,v);case 15:return I4(c,m,m.type,m.pendingProps,v);case 17:return P=m.type,L=m.pendingProps,L=m.elementType===P?L:Ro(P,L),j_(c,m),m.tag=1,zr(P)?(c=!0,iy(m)):c=!1,Cd(m,v),E4(m,P,L),Rw(m,P,L,v),Nw(null,m,P,!0,c,v);case 19:return W4(c,m,v);case 22:return z4(c,m,v)}throw Error(Bt(156,m.tag))};function Q4(c,m){return TA(c,m)}function jP(c,m,v,P){this.tag=c,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lo(c,m,v,P){return new jP(c,m,v,P)}function Ob(c){return c=c.prototype,!(!c||!c.isReactComponent)}function VP(c){if(typeof c=="function")return Ob(c)?1:0;if(c!=null){if(c=c.$$typeof,c===rb)return 11;if(c===ob)return 14}return 2}function bu(c,m){var v=c.alternate;return v===null?(v=lo(c.tag,m,c.key,c.mode),v.elementType=c.elementType,v.type=c.type,v.stateNode=c.stateNode,v.alternate=c,c.alternate=v):(v.pendingProps=m,v.type=c.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=c.flags&14680064,v.childLanes=c.childLanes,v.lanes=c.lanes,v.child=c.child,v.memoizedProps=c.memoizedProps,v.memoizedState=c.memoizedState,v.updateQueue=c.updateQueue,m=c.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=c.sibling,v.index=c.index,v.ref=c.ref,v}function J_(c,m,v,P,L,B){var K=2;if(P=c,typeof c=="function")Ob(c)&&(K=1);else if(typeof c=="string")K=5;else e:switch(c){case fd:return Oc(v.children,L,B,m);case ab:K=8,L|=8;break;case rw:return c=lo(12,v,m,L|2),c.elementType=rw,c.lanes=B,c;case ow:return c=lo(13,v,m,L),c.elementType=ow,c.lanes=B,c;case sw:return c=lo(19,v,m,L),c.elementType=sw,c.lanes=B,c;case uA:return Py(v,L,B,m);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case sA:K=10;break e;case lA:K=9;break e;case rb:K=11;break e;case ob:K=14;break e;case su:K=16,P=null;break e}throw Error(Bt(130,c==null?c:typeof c,""))}return m=lo(K,v,m,L),m.elementType=c,m.type=P,m.lanes=B,m}function Oc(c,m,v,P){return c=lo(7,c,P,m),c.lanes=v,c}function Py(c,m,v,P){return c=lo(22,c,P,m),c.elementType=uA,c.lanes=v,c.stateNode={isHidden:!1},c}function iw(c,m,v){return c=lo(6,c,null,m),c.lanes=v,c}function nw(c,m,v){return m=lo(4,c.children!==null?c.children:[],c.key,m),m.lanes=v,m.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},m}function UP(c,m,v,P,L){this.tag=m,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=W0(0),this.expirationTimes=W0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=W0(0),this.identifierPrefix=P,this.onRecoverableError=L,this.mutableSourceEagerHydrationData=null}function $b(c,m,v,P,L,B,K,o,_e){return c=new UP(c,m,v,o,_e),m===1?(m=1,B===!0&&(m|=8)):m=0,B=lo(3,null,null,m),c.current=B,B.stateNode=c,B.memoizedState={element:P,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ab(B),c}function JP(c,m,v){var P=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:md,key:P==null?null:""+P,children:c,containerInfo:m,implementation:v}}function e5(c){if(!c)return xu;c=c._reactInternals;e:{if(Gc(c)!==c||c.tag!==1)throw Error(Bt(170));var m=c;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(zr(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(Bt(171))}if(c.tag===1){var v=c.type;if(zr(v))return e4(c,v,m)}return m}function t5(c,m,v,P,L,B,K,o,_e){return c=$b(v,P,!0,c,L,B,K,o,_e),c.context=e5(null),v=c.current,P=_r(),L=wu(v),B=nl(P,L),B.callback=m??null,_u(v,B,L),c.current.lanes=L,gf(c,L,P),Lr(c,P),c}function My(c,m,v,P){var L=m.current,B=_r(),K=wu(L);return v=e5(v),m.context===null?m.context=v:m.pendingContext=v,m=nl(B,K),m.payload={element:c},P=P===void 0?null:P,P!==null&&(m.callback=P),c=_u(L,m,K),c!==null&&(Fo(c,L,K,B),F_(c,L,K)),K}function fy(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return c.child.stateNode;default:return c.child.stateNode}}function V3(c,m){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var v=c.retryLane;c.retryLane=v!==0&&v<m?v:m}}function jb(c,m){V3(c,m),(c=c.alternate)&&V3(c,m)}function qP(){return null}var i5=typeof reportError=="function"?reportError:function(c){console.error(c)};function Vb(c){this._internalRoot=c}Ey.prototype.render=Vb.prototype.render=function(c){var m=this._internalRoot;if(m===null)throw Error(Bt(409));My(c,m,null,null)};Ey.prototype.unmount=Vb.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var m=c.containerInfo;Jc(function(){My(null,c,null,null)}),m[rl]=null}};function Ey(c){this._internalRoot=c}Ey.prototype.unstable_scheduleHydration=function(c){if(c){var m=zA();c={blockedOn:null,target:c,priority:m};for(var v=0;v<uu.length&&m!==0&&m<uu[v].priority;v++);uu.splice(v,0,c),v===0&&RA(c)}};function Ub(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function Cy(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11&&(c.nodeType!==8||c.nodeValue!==" react-mount-point-unstable "))}function U3(){}function GP(c,m,v,P,L){if(L){if(typeof P=="function"){var B=P;P=function(){var Ie=fy(K);B.call(Ie)}}var K=t5(m,P,c,0,null,!1,!1,"",U3);return c._reactRootContainer=K,c[rl]=K.current,of(c.nodeType===8?c.parentNode:c),Jc(),K}for(;L=c.lastChild;)c.removeChild(L);if(typeof P=="function"){var o=P;P=function(){var Ie=fy(_e);o.call(Ie)}}var _e=$b(c,0,!1,null,null,!1,!1,"",U3);return c._reactRootContainer=_e,c[rl]=_e.current,of(c.nodeType===8?c.parentNode:c),Jc(function(){My(m,_e,v,P)}),_e}function Dy(c,m,v,P,L){var B=v._reactRootContainer;if(B){var K=B;if(typeof L=="function"){var o=L;L=function(){var _e=fy(K);o.call(_e)}}My(m,K,c,L)}else K=GP(v,m,c,L,P);return fy(K)}DA=function(c){switch(c.tag){case 3:var m=c.stateNode;if(m.current.memoizedState.isDehydrated){var v=Om(m.pendingLanes);v!==0&&(ub(m,v|1),Lr(m,ya()),!(Rn&6)&&(Nd=ya()+500,Su()))}break;case 13:Jc(function(){var P=ol(c,1);if(P!==null){var L=_r();Fo(P,c,1,L)}}),jb(c,1)}};cb=function(c){if(c.tag===13){var m=ol(c,134217728);if(m!==null){var v=_r();Fo(m,c,134217728,v)}jb(c,134217728)}};IA=function(c){if(c.tag===13){var m=wu(c),v=ol(c,m);if(v!==null){var P=_r();Fo(v,c,m,P)}jb(c,m)}};zA=function(){return Vn};LA=function(c,m){var v=Vn;try{return Vn=c,m()}finally{Vn=v}};_w=function(c,m,v){switch(m){case"input":if(cw(c,v),m=v.name,v.type==="radio"&&m!=null){for(v=c;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<v.length;m++){var P=v[m];if(P!==c&&P.form===c.form){var L=vy(P);if(!L)throw Error(Bt(90));hA(P),cw(P,L)}}}break;case"textarea":pA(c,v);break;case"select":m=v.value,m!=null&&Td(c,!!v.multiple,m,!1)}};bA=Wb;vA=Jc;var YP={usingClientEntryPoint:!1,Events:[yf,wd,vy,yA,wA,Wb]},Wm={findFiberByHostInstance:Bc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},HP={bundleType:Wm.bundleType,version:Wm.version,rendererPackageName:Wm.rendererPackageName,rendererConfig:Wm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ll.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=AA(c),c===null?null:c.stateNode},findFiberByHostInstance:Wm.findFiberByHostInstance||qP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var I_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!I_.isDisabled&&I_.supportsFiber)try{_y=I_.inject(HP),vs=I_}catch{}}Zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YP;Zr.createPortal=function(c,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ub(m))throw Error(Bt(200));return JP(c,m,null,v)};Zr.createRoot=function(c,m){if(!Ub(c))throw Error(Bt(299));var v=!1,P="",L=i5;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(P=m.identifierPrefix),m.onRecoverableError!==void 0&&(L=m.onRecoverableError)),m=$b(c,1,!1,null,null,v,!1,P,L),c[rl]=m.current,of(c.nodeType===8?c.parentNode:c),new Vb(m)};Zr.findDOMNode=function(c){if(c==null)return null;if(c.nodeType===1)return c;var m=c._reactInternals;if(m===void 0)throw typeof c.render=="function"?Error(Bt(188)):(c=Object.keys(c).join(","),Error(Bt(268,c)));return c=AA(m),c=c===null?null:c.stateNode,c};Zr.flushSync=function(c){return Jc(c)};Zr.hydrate=function(c,m,v){if(!Cy(m))throw Error(Bt(200));return Dy(null,c,m,!0,v)};Zr.hydrateRoot=function(c,m,v){if(!Ub(c))throw Error(Bt(405));var P=v!=null&&v.hydratedSources||null,L=!1,B="",K=i5;if(v!=null&&(v.unstable_strictMode===!0&&(L=!0),v.identifierPrefix!==void 0&&(B=v.identifierPrefix),v.onRecoverableError!==void 0&&(K=v.onRecoverableError)),m=t5(m,null,c,1,v??null,L,!1,B,K),c[rl]=m.current,of(c),P)for(c=0;c<P.length;c++)v=P[c],L=v._getVersion,L=L(v._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[v,L]:m.mutableSourceEagerHydrationData.push(v,L);return new Ey(m)};Zr.render=function(c,m,v){if(!Cy(m))throw Error(Bt(200));return Dy(null,c,m,!1,v)};Zr.unmountComponentAtNode=function(c){if(!Cy(c))throw Error(Bt(40));return c._reactRootContainer?(Jc(function(){Dy(null,null,c,!1,function(){c._reactRootContainer=null,c[rl]=null})}),!0):!1};Zr.unstable_batchedUpdates=Wb;Zr.unstable_renderSubtreeIntoContainer=function(c,m,v,P){if(!Cy(v))throw Error(Bt(200));if(c==null||c._reactInternals===void 0)throw Error(Bt(38));return Dy(c,m,v,!1,P)};Zr.version="18.3.1-next-f1338f8080-20240426";function n5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n5)}catch(c){console.error(c)}}n5(),nA.exports=Zr;var ZP=nA.exports,a5,J3=ZP;a5=J3.createRoot,J3.hydrateRoot;const KP="/nyc.png";function XP(){return gt.jsx("header",{className:"header",children:gt.jsxs("div",{className:"header-content",children:[gt.jsxs("div",{className:"header-left",children:[gt.jsx("h1",{children:"NYC Eats"}),gt.jsx("div",{className:"header-dates",children:gt.jsx("div",{className:"header-dates-main",children:"Stay tuned for Spring 2026 Restaurant Week!"})}),gt.jsxs("div",{className:"header-credits",children:["Built by"," ",gt.jsx("a",{href:"https://atmikapai.dev/",target:"_blank",rel:"noopener noreferrer",className:"author-link",style:{color:"white",textDecoration:"none"},children:"Atmika Pai"})," | Sourced from ",gt.jsx("a",{href:"https://www.nyctourism.com/restaurant-week/",target:"_blank",rel:"noopener noreferrer",className:"nyc-credits-link",style:{color:"white",textDecoration:"none"},children:"NYC Tourism"})]})]}),gt.jsx("div",{className:"header-right",children:gt.jsx("a",{href:"https://www.nyctourism.com/restaurant-week/",target:"_blank",rel:"noopener noreferrer",className:"nyc-logo-link",children:gt.jsx("img",{src:KP,alt:"NEW YORK CITY",className:"nyc-logo"})})})]})})}var r5={exports:{}};(function(c,m){(function(v,P){c.exports=P()})(k7,function(){var v,P,L;function B(o,_e){if(!v)v=_e;else if(!P)P=_e;else{var Ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+v+")(sharedChunk); ("+P+")(sharedChunk); self.onerror = null;",pt={};v(pt),L=_e(pt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(L.workerUrl=window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"})))}}B(["exports"],function(o){var _e=1e-6,Ie=typeof Float32Array<"u"?Float32Array:Array;function pt(n,e){var i=e[0],r=e[1],s=e[2],h=e[3],d=i*h-s*r;return d?(n[0]=h*(d=1/d),n[1]=-r*d,n[2]=-s*d,n[3]=i*d,n):null}function dt(){var n=new Ie(9);return Ie!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Xe(n,e){var i=e[0],r=e[1],s=e[2],h=e[3],d=e[4],g=e[5],y=e[6],w=e[7],k=e[8];return n[0]=d*k-g*w,n[1]=s*w-r*k,n[2]=r*g-s*d,n[3]=g*y-h*k,n[4]=i*k-s*y,n[5]=s*h-i*g,n[6]=h*w-d*y,n[7]=r*y-i*w,n[8]=i*d-r*h,n}function zt(n,e,i){var r=e[0],s=e[1],h=e[2],d=e[3],g=e[4],y=e[5],w=e[6],k=e[7],A=e[8],S=i[0],E=i[1],D=i[2],R=i[3],F=i[4],j=i[5],Y=i[6],H=i[7],W=i[8];return n[0]=S*r+E*d+D*w,n[1]=S*s+E*g+D*k,n[2]=S*h+E*y+D*A,n[3]=R*r+F*d+j*w,n[4]=R*s+F*g+j*k,n[5]=R*h+F*y+j*A,n[6]=Y*r+H*d+W*w,n[7]=Y*s+H*g+W*k,n[8]=Y*h+H*y+W*A,n}function St(){var n=new Ie(16);return Ie!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function He(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function yi(n,e){var i=e[0],r=e[1],s=e[2],h=e[3],d=e[4],g=e[5],y=e[6],w=e[7],k=e[8],A=e[9],S=e[10],E=e[11],D=e[12],R=e[13],F=e[14],j=e[15],Y=i*g-r*d,H=i*y-s*d,W=i*w-h*d,J=r*y-s*g,Z=r*w-h*g,ee=s*w-h*y,pe=k*R-A*D,ce=k*F-S*D,me=k*j-E*D,we=A*F-S*R,Le=A*j-E*R,Ze=S*j-E*F,Ve=Y*Ze-H*Le+W*we+J*me-Z*ce+ee*pe;return Ve?(n[0]=(g*Ze-y*Le+w*we)*(Ve=1/Ve),n[1]=(s*Le-r*Ze-h*we)*Ve,n[2]=(R*ee-F*Z+j*J)*Ve,n[3]=(S*Z-A*ee-E*J)*Ve,n[4]=(y*me-d*Ze-w*ce)*Ve,n[5]=(i*Ze-s*me+h*ce)*Ve,n[6]=(F*W-D*ee-j*H)*Ve,n[7]=(k*ee-S*W+E*H)*Ve,n[8]=(d*Le-g*me+w*pe)*Ve,n[9]=(r*me-i*Le-h*pe)*Ve,n[10]=(D*Z-R*W+j*Y)*Ve,n[11]=(A*W-k*Z-E*Y)*Ve,n[12]=(g*ce-d*we-y*pe)*Ve,n[13]=(i*we-r*ce+s*pe)*Ve,n[14]=(R*H-D*J-F*Y)*Ve,n[15]=(k*J-A*H+S*Y)*Ve,n):null}function Ee(n,e,i){var r=e[0],s=e[1],h=e[2],d=e[3],g=e[4],y=e[5],w=e[6],k=e[7],A=e[8],S=e[9],E=e[10],D=e[11],R=e[12],F=e[13],j=e[14],Y=e[15],H=i[0],W=i[1],J=i[2],Z=i[3];return n[0]=H*r+W*g+J*A+Z*R,n[1]=H*s+W*y+J*S+Z*F,n[2]=H*h+W*w+J*E+Z*j,n[3]=H*d+W*k+J*D+Z*Y,n[4]=(H=i[4])*r+(W=i[5])*g+(J=i[6])*A+(Z=i[7])*R,n[5]=H*s+W*y+J*S+Z*F,n[6]=H*h+W*w+J*E+Z*j,n[7]=H*d+W*k+J*D+Z*Y,n[8]=(H=i[8])*r+(W=i[9])*g+(J=i[10])*A+(Z=i[11])*R,n[9]=H*s+W*y+J*S+Z*F,n[10]=H*h+W*w+J*E+Z*j,n[11]=H*d+W*k+J*D+Z*Y,n[12]=(H=i[12])*r+(W=i[13])*g+(J=i[14])*A+(Z=i[15])*R,n[13]=H*s+W*y+J*S+Z*F,n[14]=H*h+W*w+J*E+Z*j,n[15]=H*d+W*k+J*D+Z*Y,n}function Ae(n,e,i){var r,s,h,d,g,y,w,k,A,S,E,D,R=i[0],F=i[1],j=i[2];return e===n?(n[12]=e[0]*R+e[4]*F+e[8]*j+e[12],n[13]=e[1]*R+e[5]*F+e[9]*j+e[13],n[14]=e[2]*R+e[6]*F+e[10]*j+e[14],n[15]=e[3]*R+e[7]*F+e[11]*j+e[15]):(s=e[1],h=e[2],d=e[3],g=e[4],y=e[5],w=e[6],k=e[7],A=e[8],S=e[9],E=e[10],D=e[11],n[0]=r=e[0],n[1]=s,n[2]=h,n[3]=d,n[4]=g,n[5]=y,n[6]=w,n[7]=k,n[8]=A,n[9]=S,n[10]=E,n[11]=D,n[12]=r*R+g*F+A*j+e[12],n[13]=s*R+y*F+S*j+e[13],n[14]=h*R+w*F+E*j+e[14],n[15]=d*R+k*F+D*j+e[15]),n}function Oe(n,e,i){var r=i[0],s=i[1],h=i[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*h,n[9]=e[9]*h,n[10]=e[10]*h,n[11]=e[11]*h,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function vt(n,e,i){var r=Math.sin(i),s=Math.cos(i),h=e[4],d=e[5],g=e[6],y=e[7],w=e[8],k=e[9],A=e[10],S=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=h*s+w*r,n[5]=d*s+k*r,n[6]=g*s+A*r,n[7]=y*s+S*r,n[8]=w*s-h*r,n[9]=k*s-d*r,n[10]=A*s-g*r,n[11]=S*s-y*r,n}function Ot(n,e,i){var r=Math.sin(i),s=Math.cos(i),h=e[0],d=e[1],g=e[2],y=e[3],w=e[8],k=e[9],A=e[10],S=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=h*s-w*r,n[1]=d*s-k*r,n[2]=g*s-A*r,n[3]=y*s-S*r,n[8]=h*r+w*s,n[9]=d*r+k*s,n[10]=g*r+A*s,n[11]=y*r+S*s,n}function Qt(n,e,i){var r=Math.sin(i),s=Math.cos(i),h=e[0],d=e[1],g=e[2],y=e[3],w=e[4],k=e[5],A=e[6],S=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=h*s+w*r,n[1]=d*s+k*r,n[2]=g*s+A*r,n[3]=y*s+S*r,n[4]=w*s-h*r,n[5]=k*s-d*r,n[6]=A*s-g*r,n[7]=S*s-y*r,n}function ti(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ri(n,e,i){var r,s,h,d=i[0],g=i[1],y=i[2],w=Math.hypot(d,g,y);return w<_e?null:(d*=w=1/w,g*=w,y*=w,r=Math.sin(e),s=Math.cos(e),n[0]=d*d*(h=1-s)+s,n[1]=g*d*h+y*r,n[2]=y*d*h-g*r,n[3]=0,n[4]=d*g*h-y*r,n[5]=g*g*h+s,n[6]=y*g*h+d*r,n[7]=0,n[8]=d*y*h+g*r,n[9]=g*y*h-d*r,n[10]=y*y*h+s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function oi(n,e){var i=e[0],r=e[1],s=e[2],h=e[3],d=i+i,g=r+r,y=s+s,w=i*d,k=r*d,A=r*g,S=s*d,E=s*g,D=s*y,R=h*d,F=h*g,j=h*y;return n[0]=1-A-D,n[1]=k+j,n[2]=S-F,n[3]=0,n[4]=k-j,n[5]=1-w-D,n[6]=E+R,n[7]=0,n[8]=S+F,n[9]=E-R,n[10]=1-w-A,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Yt=Ee;function ci(){var n=new Ie(3);return Ie!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Bn(n){var e=new Ie(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Ki(n){return Math.hypot(n[0],n[1],n[2])}function It(n,e,i){var r=new Ie(3);return r[0]=n,r[1]=e,r[2]=i,r}function wi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Ui(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function nn(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function jt(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function bi(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Ht(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function vn(n,e,i,r){return n[0]=e[0]+i[0]*r,n[1]=e[1]+i[1]*r,n[2]=e[2]+i[2]*r,n}function Wn(n,e){var i=e[0]-n[0],r=e[1]-n[1],s=e[2]-n[2];return i*i+r*r+s*s}function Rr(n){var e=n[0],i=n[1],r=n[2];return e*e+i*i+r*r}function Za(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function mn(n,e){var i=e[0],r=e[1],s=e[2],h=i*i+r*r+s*s;return h>0&&(h=1/Math.sqrt(h)),n[0]=e[0]*h,n[1]=e[1]*h,n[2]=e[2]*h,n}function An(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Un(n,e,i){var r=e[0],s=e[1],h=e[2],d=i[0],g=i[1],y=i[2];return n[0]=s*y-h*g,n[1]=h*d-r*y,n[2]=r*g-s*d,n}function br(n,e,i,r){var s=e[0],h=e[1],d=e[2];return n[0]=s+r*(i[0]-s),n[1]=h+r*(i[1]-h),n[2]=d+r*(i[2]-d),n}function fn(n,e,i){var r=e[0],s=e[1],h=e[2],d=i[3]*r+i[7]*s+i[11]*h+i[15];return n[0]=(i[0]*r+i[4]*s+i[8]*h+i[12])/(d=d||1),n[1]=(i[1]*r+i[5]*s+i[9]*h+i[13])/d,n[2]=(i[2]*r+i[6]*s+i[10]*h+i[14])/d,n}function ul(n,e,i){var r=e[0],s=e[1],h=e[2];return n[0]=r*i[0]+s*i[3]+h*i[6],n[1]=r*i[1]+s*i[4]+h*i[7],n[2]=r*i[2]+s*i[5]+h*i[8],n}function po(n,e,i){var r=i[0],s=i[1],h=i[2],d=e[0],g=e[1],y=e[2],w=s*y-h*g,k=h*d-r*y,A=r*g-s*d,S=s*A-h*k,E=h*w-r*A,D=r*k-s*w,R=2*i[3];return k*=R,A*=R,E*=2,D*=2,n[0]=d+(w*=R)+(S*=2),n[1]=g+k+E,n[2]=y+A+D,n}function Br(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Jn=Ui,cl=nn,$o=Ki;function Da(){var n=new Ie(4);return Ie!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function ks(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function Tu(n,e){var i=e[0],r=e[1],s=e[2],h=e[3],d=i*i+r*r+s*s+h*h;return d>0&&(d=1/Math.sqrt(d)),n[0]=i*d,n[1]=r*d,n[2]=s*d,n[3]=h*d,n}function Ia(n,e,i){var r=e[0],s=e[1],h=e[2],d=e[3];return n[0]=i[0]*r+i[4]*s+i[8]*h+i[12]*d,n[1]=i[1]*r+i[5]*s+i[9]*h+i[13]*d,n[2]=i[2]*r+i[6]*s+i[10]*h+i[14]*d,n[3]=i[3]*r+i[7]*s+i[11]*h+i[15]*d,n}function Ka(){var n=new Ie(4);return Ie!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function jo(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Vo(n,e,i){i*=.5;var r=e[0],s=e[1],h=e[2],d=e[3],g=Math.sin(i),y=Math.cos(i);return n[0]=r*y+d*g,n[1]=s*y+h*g,n[2]=h*y-s*g,n[3]=d*y-r*g,n}function Uo(n,e,i){i*=.5;var r=e[0],s=e[1],h=e[2],d=e[3],g=Math.sin(i),y=Math.cos(i);return n[0]=r*y-h*g,n[1]=s*y+d*g,n[2]=h*y+r*g,n[3]=d*y-s*g,n}ci(),Da();var za,hl,dl,Xa,Pu,mo=Tu,pl=(za=ci(),hl=It(1,0,0),dl=It(0,1,0),function(n,e,i){var r=An(e,i);return r<-.999999?(Un(za,hl,e),$o(za)<1e-6&&Un(za,dl,e),mn(za,za),function(s,h,d){d*=.5;var g=Math.sin(d);s[0]=g*h[0],s[1]=g*h[1],s[2]=g*h[2],s[3]=Math.cos(d)}(n,za,Math.PI),n):r>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Un(za,e,i),n[0]=za[0],n[1]=za[1],n[2]=za[2],n[3]=1+r,mo(n,n))});function ka(){var n=new Ie(2);return Ie!=Float32Array&&(n[0]=0,n[1]=0),n}function vr(n,e){var i=new Ie(2);return i[0]=n,i[1]=e,i}function As(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Jo(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function Ss(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function qo(n){return Math.hypot(n[0],n[1])}function ml(n,e){var i=e[0],r=e[1],s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),n[0]=e[0]*s,n[1]=e[1]*s,n}function xn(n,e){return n[0]*e[0]+n[1]*e[1]}function Go(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Ka(),Ka(),dt(),ka();var fl,Qa,jd=function(){if(Pu)return Xa;function n(e,i,r,s){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(s-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=r,this.p2y=s}return Pu=1,Xa=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,s=0;s<8;s++){var h=this.sampleCurveX(r)-e;if(Math.abs(h)<i)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=h/d}var g=0,y=1;for(r=e,s=0;s<20&&(h=this.sampleCurveX(r),!(Math.abs(h-e)<i));s++)e>h?g=r:y=r,r=.5*(y-g)+g;return r},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Xa}(),Yc=Go(jd);function Ts(){if(Qa)return fl;function n(e,i){this.x=e,this.y=i}return Qa=1,fl=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,r=e.y-this.y;return i*i+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),r=Math.sin(e),s=r*this.x+i*this.y;return this.x=i*this.x-r*this.y,this.y=s,this},_rotateAround:function(e,i){var r=Math.cos(e),s=Math.sin(e),h=i.y+s*(this.x-i.x)+r*(this.y-i.y);return this.x=i.x+r*(this.x-i.x)-s*(this.y-i.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},fl}var st=Go(Ts());function fo(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!fo(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!fo(n[i],e[i]))return!1;return!0}return n===e}const Vd=Math.PI/180,Mu=180/Math.PI;function Ci(n){return n*Vd}function Me(n){return n*Mu}const V=[[0,0],[1,0],[1,1],[0,1]];function G(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ie(n,e,i,r){const s=new Yc(n,e,i,r);return function(h){return s.solve(h)}}const de=ie(.25,.1,.25,1);function oe(n,e,i){return Math.min(i,Math.max(e,n))}function ge(n,e,i){return(i=oe((i-n)/(e-n),0,1))*i*(3-2*i)}function Se(n,e,i){const r=i-e,s=((n-e)%r+r)%r+e;return s===e?i:s}function ye(n,e,i){if(!n.length)return i(null,[]);let r=n.length;const s=new Array(n.length);let h=null;n.forEach((d,g)=>{e(d,(y,w)=>{y&&(h=y),s[g]=w,--r==0&&i(h,s)})})}function Te(n,...e){for(const i of e)for(const r in i)n[r]=i[r];return n}let Ue=1;function Ce(){return Ue++}function ot(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Tt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Mt(n,e,i){const r={};for(const s in n)r[s]=e.call(this,n[s],s,n);return r}function qt(n,e,i){const r={};for(const s in n)e.call(this,n[s],s,n)&&(r[s]=n[s]);return r}function Zt(n){return Array.isArray(n)?n.map(Zt):typeof n=="object"&&n?Mt(n,Zt):n}function Xt(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const _i={};function ai(n){_i[n]||(typeof console<"u"&&console.warn(n),_i[n]=!0)}function Xi(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function gn(n){let e=0;for(let i,r,s=0,h=n.length,d=h-1;s<h;d=s++)i=n[s],r=n[d],e+=(r.x-i.x)*(i.y+r.y);return e}function _n([n,e,i]){const r=Ci(e+90),s=Ci(i);return{x:n*Math.cos(r)*Math.sin(s),y:n*Math.sin(r)*Math.sin(s),z:n*Math.cos(s),azimuthal:e,polar:i}}function $i(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Ii(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,s,h)=>{const d=s||h;return e[r]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Nn=null;function En(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Sn(n,e,i,r){for(;e<i;){const s=e+i>>1;n[s]<r?e=s+1:i=s}return e}function ua(n,e,i,r){for(;e<i;){const s=e+i>>1;n[s]<=r?e=s+1:i=s}return e}function ja(n){return n>0?1/(1.001-n):1+n}function Aa(n){return n>0?1-1/(1.001-n):-n}function Eu(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const pa={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!pa.API_URL)return null;try{const n=new URL(pa.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Yo(n){return pa.API_URL_REGEX.test(n)}function Hc(n){return pa.API_SPRITE_REGEX.test(n)}let Cu,Du,Zc,Kc,Ps,Iu;function Xc(){return Cu==null&&(Cu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Cu}const Wr={now:()=>Kc!==void 0?Kc:performance.now(),setNow(n){Kc=n},restoreNow(){Kc=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:r}=n;Ps||(Ps=document.createElement("canvas"));const s=Ps.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(i>Ps.width||r>Ps.height)&&(Ps.width=i,Ps.height=r),s.clearRect(-e,-e,i+2*e,r+2*e),s.drawImage(n,0,0,i,r),s.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:n=>(Du||(Du=document.createElement("a")),Du.href=n,Du.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Zc==null&&(Zc=window.matchMedia("(prefers-reduced-motion: reduce)")),Zc.matches)},hasCanvasFingerprintNoise(){if(Iu!==void 0)return Iu;if(!Xc())return Iu=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let s=0;s<n.width;++s)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(s,0,1,1);const r=e.getImageData(0,0,n.width,n.height);i=0;for(let s=0;s<r.data.length;++s)if(s%4!=3&&i++!==r.data[s])return Iu=!0,!0;return Iu=!1,!1}};function cr(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const r=new URLSearchParams(n.slice(i));for(const s in e)r.set(s,e[s]);return`${n.slice(0,i)}?${r.toString()}`}function xr(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const r=new URLSearchParams,s=new URLSearchParams(n.slice(i));for(const d of e.persistentParams){const g=s.get(d);g&&r.set(d,g)}const h=r.toString();return`${n.slice(0,i)}${h.length>0?`?${h}`:""}`}const go="mapbox-tiles";let Nr=500,_o=50;const zu=["language","worldview","jobid"];let Xr,Lu;function Ms(){try{return caches}catch{}}function gl(){const n=Ms();n&&Xr==null&&(Xr=n.open(go))}let Ud=1/0;const Jd={supported:!1,testSupport:function(n){!Ru&&Es&&(_l?vf(n):Va=n)}};let Va,Es,Ru=!1,_l=!1;const bf=typeof self<"u"?self:{};function vf(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Es),n.isContextLost())return;Jd.supported=!0}catch{}n.deleteTexture(e),Ru=!0}bf.document&&(Es=bf.document.createElement("img"),Es.onload=function(){Va&&vf(Va),Va=null,_l=!0},Es.onerror=function(){Ru=!0,Va=null},Es.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Bu);class Mi extends Error{constructor(e,i,r){i===401&&Yo(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Qc=$i()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,yl=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Qc())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(r,s){const h=new AbortController,d=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Qc(),referrerPolicy:r.referrerPolicy,signal:h.signal});let g=!1,y=!1;const w=(k=d.url).indexOf("sku=")>0&&Yo(k);var k;r.type==="json"&&d.headers.set("Accept","application/json");const A=(E,D,R)=>{if(y)return;if(E&&E.message!=="SecurityError"&&ai(E.toString()),D&&R)return S(D);const F=Date.now();fetch(d).then(j=>{if(j.ok){const Y=w?j.clone():null;return S(j,Y,F)}return s(new Mi(j.statusText,j.status,r.url))}).catch(j=>{j.name!=="AbortError"&&s(new Error(`${j.message} ${r.url}`))})},S=(E,D,R)=>{(r.type==="arrayBuffer"?E.arrayBuffer():r.type==="json"?E.json():E.text()).then(F=>{y||(D&&R&&function(j,Y,H){if(gl(),Xr==null)return;const W=Ii(Y.headers.get("Cache-Control")||"");if(W["no-store"])return;const J={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((pe,ce)=>J.headers.set(ce,pe)),W["max-age"]&&J.headers.set("Expires",new Date(H+1e3*W["max-age"]).toUTCString());const Z=J.headers.get("Expires");if(!Z||new Date(Z).getTime()-H<42e4)return;let ee=xr(j.url,{persistentParams:zu});if(Y.status===206){const pe=j.headers.get("Range");if(!pe)return;J.status=200,ee=cr(ee,{range:pe})}(function(pe,ce){if(Lu===void 0)try{new Response(new ReadableStream),Lu=!0}catch{Lu=!1}Lu?ce(pe.body):pe.blob().then(ce).catch(me=>ai(me.message))})(Y,pe=>{const ce=new Response((me=Y.status)!==200&&me!==404&&[101,103,204,205,304].includes(me)?null:pe,J);var me;gl(),Xr!=null&&Xr.then(we=>we.put(ee,ce)).catch(we=>ai(we.message))})}(d,D,R),g=!0,s(null,F,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(F=>{y||s(new Error(F.message))})};return w?function(E,D){if(gl(),Xr==null)return D(null);Xr.then(R=>{let F=xr(E.url,{persistentParams:zu});const j=E.headers.get("Range");j&&(F=cr(F,{range:j})),R.match(F).then(Y=>{const H=function(W){if(!W)return!1;const J=new Date(W.headers.get("Expires")||0),Z=Ii(W.headers.get("Cache-Control")||"");return Number(J)>Date.now()&&!Z["no-cache"]}(Y);R.delete(F).catch(D),H&&R.put(F,Y.clone()).catch(D),D(null,Y,H)}).catch(D)}).catch(D)}(d,A):A(null,null),{cancel:()=>{y=!0,g||h.abort()}}}(n,e);if($i(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(r,s){const h=new XMLHttpRequest;h.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const d in r.headers)h.setRequestHeader(d,r.headers[d]);return r.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=r.credentials==="include",h.onerror=()=>{s(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let d=h.response;if(r.type==="json")try{d=JSON.parse(h.response)}catch(g){return s(g)}s(null,d,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else s(new Mi(h.statusText,h.status,r.url))},h.send(r.body),{cancel:()=>h.abort()}}(n,e)},Wu=function(n,e){return yl(Te(n,{type:"arrayBuffer"}),e)};function Iy(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Nu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Cs,Ho;Cs=[],Ho=0;const qd=function(n,e){if(Jd.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Ho>=pa.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Cs.push(h),h}Ho++;let i=!1;const r=()=>{if(!i)for(i=!0,Ho--;Cs.length&&Ho<pa.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Cs.shift(),{requestParameters:d,callback:g,cancelled:y}=h;y||(h.cancel=qd(d,g).cancel)}},s=Wu(n,(h,d,g,y)=>{r(),h?e(h):d&&(self.createImageBitmap?function(w,k){const A=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(A).then(S=>{k(null,S)}).catch(S=>{k(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(w,k)=>e(w,k,g,y)):function(w,k){const A=new Image;A.onload=()=>{k(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=Nu})},A.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const S=new Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?URL.createObjectURL(S):Nu}(d,(w,k)=>e(w,k,g,y)))});return{cancel:()=>{s.cancel(),r()}}};var Gd,Ds,xf,yo={exports:{}},eh={exports:{}},th={exports:{}},Fr=function(){if(xf)return yo.exports;xf=1;var n=(Gd||(Gd=1,eh.exports=function(i,r){var s,h,d,g,y,w,k,A;for(h=i.length-(s=3&i.length),d=r,y=3432918353,w=461845907,A=0;A<h;)k=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,d=27492+(65535&(g=5*(65535&(d=(d^=k=(65535&(k=(k=(65535&k)*y+(((k>>>16)*y&65535)<<16)&4294967295)<<15|k>>>17))*w+(((k>>>16)*w&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(k=0,s){case 3:k^=(255&i.charCodeAt(A+2))<<16;case 2:k^=(255&i.charCodeAt(A+1))<<8;case 1:d^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(A)))*y+(((k>>>16)*y&65535)<<16)&4294967295)<<15|k>>>17))*w+(((k>>>16)*w&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),eh.exports),e=(Ds||(Ds=1,th.exports=function(i,r){for(var s,h=i.length,d=r^h,g=0;h>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:d^=(255&i.charCodeAt(g+2))<<16;case 2:d^=(255&i.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),th.exports);return yo.exports=n,yo.exports.murmur3=n,yo.exports.murmur2=e,yo.exports}(),Fu=Go(Fr);class Is{constructor(e,...i){Te(this,i[0]||{}),this.type=e}}class ih extends Is{constructor(e,i={}){super("error",Te({error:e},i))}}function Yd(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function nh(n,e,i){if(i&&i[n]){const r=i[n].indexOf(e);r!==-1&&i[n].splice(r,1)}}class zs{on(e,i){return this._listeners=this._listeners||{},Yd(e,i,this._listeners),this}off(e,i){return nh(e,i,this._listeners),nh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Yd(e,i,this._oneTimeListeners),this):new Promise(r=>{this.once(e,r)})}fire(e,i){const r=typeof e=="string"?new Is(e,i):e,s=r.type;if(this.listens(s)){r.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of h)y.call(this,r);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of d)nh(s,y,this._oneTimeListeners),y.call(this,r);const g=this._eventedParent;g&&(Te(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(r))}else r instanceof ih&&console.error(r.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class er{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new er(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,r]=e.split("");return new er({name:i,iconsetId:r})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return er.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Hd,wl={},Ls=function(){if(Hd)return wl;Hd=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(h){return(h=Math.round(h))<0?0:h>255?255:h}function i(h){return e(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function r(h){return(d=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:d>1?1:d;var d}function s(h,d,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?h+(d-h)*g*6:2*g<1?d:3*g<2?h+(d-h)*(2/3-g)*6:h}try{wl.parseCSSColor=function(h){var d,g=h.replace(/ /g,"").toLowerCase();if(g in n)return n[g].slice();if(g[0]==="#")return g.length===4?(d=parseInt(g.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:g.length===7&&(d=parseInt(g.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var y=g.indexOf("("),w=g.indexOf(")");if(y!==-1&&w+1===g.length){var k=g.substr(0,y),A=g.substr(y+1,w-(y+1)).split(","),S=1;switch(k){case"rgba":if(A.length!==4)return null;S=r(A.pop());case"rgb":return A.length!==3?null:[i(A[0]),i(A[1]),i(A[2]),S];case"hsla":if(A.length!==4)return null;S=r(A.pop());case"hsl":if(A.length!==3)return null;var E=(parseFloat(A[0])%360+360)%360/360,D=r(A[1]),R=r(A[2]),F=R<=.5?R*(D+1):R+D-R*D,j=2*R-F;return[e(255*s(j,F,E+1/3)),e(255*s(j,F,E)),e(255*s(j,F,E-1/3)),S];default:return null}}return null}}catch{}return wl}();class Bi{constructor(e,i,r,s=1){this.r=e,this.g=i,this.b=r,this.a=s}static parse(e){if(!e)return;if(e instanceof Bi)return e;if(typeof e!="string")return;const i=Ls.parseCSSColor(e);return i?new Bi(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,r,s]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*r)},${s})`}toNonPremultipliedRenderColor(e){const{r:i,g:r,b:s,a:h}=this;return new zy(e,i,r,s,h)}toPremultipliedRenderColor(e){const{r:i,g:r,b:s,a:h}=this;return new Zd(e,i*h,r*h,s*h,h)}clone(){return new Bi(this.r,this.g,this.b,this.a)}}class Or{constructor(e,i,r,s,h,d=!1){if(this.premultiplied=!1,this.premultiplied=d,e){const g=e.image.height,y=g*g;this.premultiplied?(i=h===0?0:i/h*(g-1),r=h===0?0:r/h*(g-1),s=h===0?0:s/h*(g-1)):(i*=g-1,r*=g-1,s*=g-1);const w=Math.floor(i),k=Math.floor(r),A=Math.floor(s),S=Math.ceil(i),E=Math.ceil(r),D=Math.ceil(s),R=i-w,F=r-k,j=s-A,Y=e.image.data,H=4*(w+k*y+A*g),W=4*(w+k*y+D*g),J=4*(w+E*y+A*g),Z=4*(w+E*y+D*g),ee=4*(S+k*y+A*g),pe=4*(S+k*y+D*g),ce=4*(S+E*y+A*g),me=4*(S+E*y+D*g);if(H<0||me>=Y.length)throw new Error("out of range");this.r=Vt(Vt(Vt(Y[H],Y[W],j),Vt(Y[J],Y[Z],j),F),Vt(Vt(Y[ee],Y[pe],j),Vt(Y[ce],Y[me],j),F),R)/255*(this.premultiplied?h:1),this.g=Vt(Vt(Vt(Y[H+1],Y[W+1],j),Vt(Y[J+1],Y[Z+1],j),F),Vt(Vt(Y[ee+1],Y[pe+1],j),Vt(Y[ce+1],Y[me+1],j),F),R)/255*(this.premultiplied?h:1),this.b=Vt(Vt(Vt(Y[H+2],Y[W+2],j),Vt(Y[J+2],Y[Z+2],j),F),Vt(Vt(Y[ee+2],Y[pe+2],j),Vt(Y[ce+2],Y[me+2],j),F),R)/255*(this.premultiplied?h:1),this.a=h}else this.r=i,this.g=r,this.b=s,this.a=h}toArray(){const{r:e,g:i,b:r,a:s}=this;return[255*e,255*i,255*r,s]}toHslaArray(){let{r:e,g:i,b:r,a:s}=this;if(this.premultiplied){if(s===0)return[0,0,0,0];e/=s,i/=s,r/=s}const h=Math.min(Math.max(e,0),1),d=Math.min(Math.max(i,0),1),g=Math.min(Math.max(r,0),1),y=Math.min(h,d,g),w=Math.max(h,d,g),k=(y+w)/2;if(y===w)return[0,0,100*k,s];const A=w-y,S=k>.5?A/(2-w-y):A/(w+y);let E=0;return w===h?E=(d-g)/A+(d<g?6:0):w===d?E=(g-h)/A+2:w===g&&(E=(h-d)/A+4),E*=60,[Math.min(Math.max(E,0),360),Math.min(Math.max(100*S,0),100),Math.min(Math.max(100*k,0),100),s]}toArray01(){const{r:e,g:i,b:r,a:s}=this;return[e,i,r,s]}toArray01Scaled(e){const{r:i,g:r,b:s}=this;return[i*e,r*e,s*e]}toArray01Linear(){const{r:e,g:i,b:r,a:s}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(r,2.2),s]}}class zy extends Or{constructor(e,i,r,s,h){super(e,i,r,s,h,!1)}}class Zd extends Or{constructor(e,i,r,s,h){super(e,i,r,s,h,!0)}}function Vt(n,e,i){return n*(1-i)+e*i}function ah(n,e,i){return n.map((r,s)=>Vt(r,e[s],i))}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1),Bi.blue=new Bi(0,0,1,1);var Ou=Object.freeze({__proto__:null,array:ah,color:function(n,e,i){return new Bi(Vt(n.r,e.r,i),Vt(n.g,e.g,i),Vt(n.b,e.b,i),Vt(n.a,e.a,i))},number:Vt});function Rs(n,...e){for(const i of e)for(const r in i)n[r]=i[r];return n}class hr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Kd{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,s]of i)this.bindings[r]=s}concat(e){return new Kd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bl={kind:"null"},Ct={kind:"number"},Ji={kind:"string"},Li={kind:"boolean"},tr={kind:"color"},wo={kind:"object"},Wi={kind:"value"},rh={kind:"collator"},$u={kind:"formatted"},ju={kind:"resolvedImage"};function La(n,e){return{kind:"array",itemType:n,N:e}}function Hn(n){if(n.kind==="array"){const e=Hn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Ly=[bl,Ct,Ji,Li,tr,$u,wo,La(Wi),ju];function vl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!vl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Ly)if(!vl(i,e))return null}}return`Expected ${Hn(n)} but found ${Hn(e)} instead.`}function Zo(n,e){return e.some(i=>i.kind===n.kind)}function Vu(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function oh(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&oh(n.itemType,e.itemType):n.kind===e.kind}class Uu{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sh{constructor(e,i,r,s,h){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=s,this.textColor=h}}class Ra{constructor(e){this.sections=e}static fromString(e){return new Ra([new sh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ra?e:Ra.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const s=i.image.getPrimary().id.toString();e.push(["image",s]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(r)}return e}}class bo{constructor(e,i={}){if(this.id=er.from(e),this.options=Object.assign({},i),i.transform){const{a:r,b:s,c:h,d,e:g,f:y}=i.transform;this.options.transform=new DOMMatrix([r,s,h,d,g,y])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:r,d:s,e:h,f:d}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:r,d:s,e:h,f:d}})}static parse(e){let i,r,s,h;try{({name:i,iconsetId:r,params:s,transform:h}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:d,b:g,c:y,d:w,e:k,f:A}=h||{};return new bo({name:i,iconsetId:r},{params:s,transform:new DOMMatrix([d,g,y,w,k,A])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Ua{constructor(e,i,r,s,h=!1){this.primaryId=er.from(e),this.primaryOptions=i,r&&(this.secondaryId=er.from(r)),this.secondaryOptions=s,this.available=h}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new bo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new bo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ua.build({name:e}):e}static build(e,i,r,s){return!e||typeof e=="object"&&!("name"in e)?null:new Ua(e,r,i,s)}}function Bs(n,e,i,r){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[n,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[n,e,i,r]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mi(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Bi||n instanceof Uu||n instanceof Ra||n instanceof Ua)return!0;if(Array.isArray(n)){for(const e of n)if(!mi(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!mi(n[e]))return!1;return!0}return!1}function _t(n){if(n===null)return bl;if(typeof n=="string")return Ji;if(typeof n=="boolean")return Li;if(typeof n=="number")return Ct;if(n instanceof Bi)return tr;if(n instanceof Uu)return rh;if(n instanceof Ra)return $u;if(n instanceof Ua)return ju;if(Array.isArray(n)){const e=n.length;let i;for(const r of n){const s=_t(r);if(i){if(i===s)continue;i=Wi;break}i=s}return La(i||Wi,e)}return wo}function kr(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ra||n instanceof Ua||n instanceof Bi?n.toString():JSON.stringify(n)}class Gt{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mi(e[1]))return i.error("invalid value");const r=e[1];let s=_t(r);const h=i.expectedType;return s.kind!=="array"||s.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(s=h),new Gt(s,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ra?this.value.serialize():this.value}}class qn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ju={string:Ji,number:Ct,boolean:Li,object:wo};class Ft{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,s=1;const h=e[0];if(h==="array"){let g,y;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Ju)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=Ju[w],s++}else g=Wi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],s++}r=La(g,y)}else r=Ju[h];const d=[];for(;s<e.length;s++){const g=i.parse(e[s],s,Wi);if(!g)return null;d.push(g)}return new Ft(r,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!vl(this.type,_t(r)))return r;if(i===this.args.length-1)throw new qn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Hn(_t(r))} but was expected to be of type ${Hn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const s=e.N;(typeof s=="number"||this.args.length>1)&&i.push(s)}}return i.concat(this.args.map(r=>r.serialize()))}}class xl{constructor(e){this.type=$u,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const s=[];let h=!1;for(let d=1;d<=e.length-1;++d){const g=e[d];if(h&&typeof g=="object"&&!Array.isArray(g)){h=!1;let y=null;if(g["font-scale"]&&(y=i.parseObjectValue(g["font-scale"],d,"font-scale",Ct),!y))return null;let w=null;if(g["text-font"]&&(w=i.parseObjectValue(g["text-font"],d,"text-font",La(Ji)),!w))return null;let k=null;if(g["text-color"]&&(k=i.parseObjectValue(g["text-color"],d,"text-color",tr),!k))return null;const A=s[s.length-1];A.scale=y,A.font=w,A.textColor=k}else{const y=i.parse(e[d],d,Wi);if(!y)return null;const w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,s.push({content:y,scale:null,font:null,textColor:null})}}return new xl(s)}evaluate(e){return new Ra(this.sections.map(i=>{const r=i.content.evaluate(e);return oh(_t(r),ju)?new sh("",r,null,null,null):new sh(kr(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class kl{constructor(e,i,r,s){this._imageWarnHistory={},this.type=ju,this.namePrimary=e,this.nameSecondary=i,r&&(this.paramsPrimary=r.params,this.iconsetIdPrimary=r.iconset?r.iconset.id:void 0),s&&(this.paramsSecondary=s.params,this.iconsetIdSecondary=s.iconset?s.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let r=1;const s=[];function h(){if(r<e.length){const g=i.parse(e[r],r++,Ji);return g?(s.push({image:g,options:{}}),!0):(i.error(s.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(r<e.length){const y=e[r];if((g=y)===null||typeof g!="object"||Array.isArray(g))return!0;const w=y.params,k=y.iconset,A=i.concat(r);if(!w&&!k)return r++,!0;if(w){if(typeof w!="object"||w.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const S={},E=A.concat(void 0,"params");for(const D in w){if(!D)return E.error("Image parameter name should be non-empty"),!1;const R=E.concat(void 0,D).parse(w[D],void 0,tr,void 0,{typeAnnotation:"coerce"});if(!R)return!1;S[D]=R}s[s.length-1].options.params=S}if(k){if(typeof k!="object"||k.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!k.id)return A.error('Image options "iconset" should have an "id" property'),!1;s[s.length-1].options.iconset=k}return r++,!0}var g;return!0}for(let g=0;g<2;g++)if(!h()||!d())return;return new kl(s[0].image,s[1]?s[1].image:void 0,s[0].options,s[1]?s[1].options:void 0)}evaluateParams(e,i){const r={};if(i){for(const s in i)if(i[s])try{r[s]=i[s].evaluate(e)}catch{continue}if(Object.keys(r).length!==0)return{params:r}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},r=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,s=Ua.build(i,r,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(s&&e.availableImages){const h=s.getPrimary().id;if(s.available=e.availableImages.some(d=>er.isEqual(d,h)),s.available){const d=s.getSecondary()?s.getSecondary().id:null;d&&(s.available=e.availableImages.some(g=>er.isEqual(g,d)))}}return s}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const r={};if(i&&(r.iconset={id:i}),e){r.params={};for(const s in e)e[s]&&(r.params[s]=e[s].serialize())}return Object.keys(r).length>0?r:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Ko(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const kf={"to-boolean":Li,"to-color":tr,"to-number":Ct,"to-string":Ji};class Ar{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0],s=[];let h=bl;if(r==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);h=La(i.expectedType.itemType,d)}else{if(!(d>0&&mi(e[1][0])))return null;h=La(_t(e[1][0]),d)}for(let g=0;g<d;g++){const y=e[1][g];let w;if(Ko(y)==="array")w=i.parse(y,void 0,h.itemType);else{const k=Ko(y);if(k!==h.itemType.kind)return i.error(`Expected ${h.itemType.kind} but found ${k}.`);w=i.registry.literal.parse(["literal",y===void 0?null:y],i)}if(!w)return null;s.push(w)}}else{if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");h=kf[r];for(let d=1;d<e.length;d++){const g=i.parse(e[d],d,Wi);if(!g)return null;s.push(g)}}return new Ar(h,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,r;for(const s of this.args){if(i=s.evaluate(e),r=null,i instanceof Bi)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Bs(i[0],i[1],i[2],i[3]),!r))return new Bi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new qn(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const s=Number(i);if(!isNaN(s))return s}throw new qn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ra.fromString(kr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ua.build(kr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):kr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new kl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ba=["Unknown","Point","LineString","Polygon"];class qu{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ba[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*i-e[0])+this.featureDistanceData.bearing[1]*(s*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Bi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ca{constructor(e,i,r,s,h){this.name=e,this.type=i,this._evaluate=r,this.args=s,this._overloadIndex=h}evaluate(e){if(!this._evaluate){const i=ca.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],s=ca.definitions[r];if(!s)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(s)?s[0]:s.type,d=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,g=[];let y=null,w=-1;for(const[k,A]of d){if(Array.isArray(k)&&k.length!==e.length-1)continue;g.push(k),w++,y=new wh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const S=[];let E=!1;for(let D=1;D<e.length;D++){const R=e[D],F=Array.isArray(k)?k[D-1]:k.type,j=y.parse(R,1+S.length,F);if(!j){E=!0;break}S.push(j)}if(!E)if(Array.isArray(k)&&k.length!==S.length)y.error(`Expected ${k.length} arguments, but found ${S.length} instead.`);else{for(let D=0;D<S.length;D++){const R=Array.isArray(k)?k[D]:k.type,F=S[D];y.concat(D+1).checkSubtype(R,F.type)}if(y.errors.length===0)return new ca(r,h,A,S,w)}}if(g.length===1)i.errors.push(...y.errors);else{const k=(g.length?g:d.map(([S])=>S)).map(Xd).join(" | "),A=[];for(let S=1;S<e.length;S++){const E=i.parse(e[S],1+A.length);if(!E)return null;A.push(Hn(E.type))}i.error(`Expected arguments of type ${k}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){ca.definitions=i;for(const r in i)e[r]=ca}}function Xd(n){return Array.isArray(n)?`(${n.map(Hn).join(", ")})`:`(${Hn(n.type)}...)`}class Qr{constructor(e,i,r){this.type=rh,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const s=r["case-sensitive"]===void 0?i.parse(!1,1,Li):i.parseObjectValue(r["case-sensitive"],1,"case-sensitive",Li);if(!s)return null;const h=r["diacritic-sensitive"]===void 0?i.parse(!1,1,Li):i.parseObjectValue(r["diacritic-sensitive"],1,"diacritic-sensitive",Li);if(!h)return null;let d=null;return r.locale&&(d=i.parseObjectValue(r.locale,1,"locale",Ji),!d)?null:new Qr(s,h,d)}evaluate(e){return new Uu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Sa(n,e,i=0,r=n.length-1,s=Ry){for(;r>i;){if(r-i>600){const y=r-i+1,w=e-i+1,k=Math.log(y),A=.5*Math.exp(2*k/3),S=.5*Math.sqrt(k*A*(y-A)/y)*(w-y/2<0?-1:1);Sa(n,e,Math.max(i,Math.floor(e-w*A/y+S)),Math.min(r,Math.floor(e+(y-w)*A/y+S)),s)}const h=n[e];let d=i,g=r;for(Gu(n,i,e),s(n[r],h)>0&&Gu(n,i,r);d<g;){for(Gu(n,d,g),d++,g--;s(n[d],h)<0;)d++;for(;s(n[g],h)>0;)g--}s(n[i],h)===0?Gu(n,i,g):(g++,Gu(n,g,r)),g<=e&&(i=g+1),e<=g&&(r=g-1)}}function Gu(n,e,i){const r=n[e];n[e]=n[i],n[i]=r}function Ry(n,e){return n<e?-1:n>e?1:0}function By(n){let e=0;for(let i,r,s=0,h=n.length,d=h-1;s<h;d=s++)i=n[s],r=n[d],e+=(r.x-i.x)*(i.y+r.y);return e}function Xo(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Al(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Ws(n,e,i){const r=n[0]-e[0],s=n[1]-e[1],h=n[0]-i[0],d=n[1]-i[1];return r*d-h*s==0&&r*h<=0&&s*d<=0}function Sl(n,e,i=!1){let r=!1;for(let g=0,y=e.length;g<y;g++){const w=e[g];for(let k=0,A=w.length,S=A-1;k<A;S=k++){const E=w[S],D=w[k];if(Ws(n,E,D))return i;(h=E)[1]>(s=n)[1]!=(d=D)[1]>s[1]&&s[0]<(d[0]-h[0])*(s[1]-h[1])/(d[1]-h[1])+h[0]&&(r=!r)}}var s,h,d;return r}function Af(n,e,i,r){const s=r[0]-i[0],h=r[1]-i[1],d=(n[0]-i[0])*h-s*(n[1]-i[1]),g=(e[0]-i[0])*h-s*(e[1]-i[1]);return d>0&&g<0||d<0&&g>0}function lh(n,e,i,r){return(s=[r[0]-i[0],r[1]-i[1]])[0]*(h=[e[0]-n[0],e[1]-n[1]])[1]-s[1]*h[0]!=0&&!(!Af(n,e,i,r)||!Af(i,r,n,e));var s,h}function Qd(n){const e=new st(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new st(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const r of n[0])e.x>r.x&&(e.x=r.x),e.y>r.y&&(e.y=r.y),i.x<r.x&&(i.x=r.x),i.y<r.y&&(i.y=r.y);return{min:e,max:i}}const vo=8192;function Wy(n,e){const i=(180+n[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*vo),Math.round(r*s*vo)]}function Ny(n,e){for(let i=0;i<e.length;i++)if(Sl(n,e[i]))return!0;return!1}function Sf(n,e,i){for(const r of i)for(let s=0,h=r.length,d=h-1;s<h;d=s++)if(lh(n,e,r[d],r[s]))return!0;return!1}function Tf(n,e){for(let i=0;i<n.length;++i)if(!Sl(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Sf(n[i],n[i+1],e))return!1;return!0}function Ns(n,e){for(let i=0;i<e.length;i++)if(Tf(n,e[i]))return!0;return!1}function ep(n,e,i){const r=[];for(let s=0;s<n.length;s++){const h=[];for(let d=0;d<n[s].length;d++){const g=Wy(n[s][d],i);Xo(e,g),h.push(g)}r.push(h)}return r}function Pf(n,e,i){const r=[];for(let s=0;s<n.length;s++){const h=ep(n[s],e,i);r.push(h)}return r}function uh(n,e,i,r){if(n[0]<i[0]||n[0]>i[2]){const s=.5*r;let h=n[0]-i[0]>s?-r:i[0]-n[0]>s?r:0;h===0&&(h=n[0]-i[2]>s?-r:i[2]-n[0]>s?r:0),n[0]+=h}Xo(e,n)}function tp(n,e,i,r){const s=Math.pow(2,r.z)*vo,h=[r.x*vo,r.y*vo],d=[];if(!n)return d;for(const g of n)for(const y of g){const w=[y.x+h[0],y.y+h[1]];uh(w,e,i,s),d.push(w)}return d}function ip(n,e,i,r){const s=Math.pow(2,r.z)*vo,h=[r.x*vo,r.y*vo],d=[];if(!n)return d;for(const y of n){const w=[];for(const k of y){const A=[k.x+h[0],k.y+h[1]];Xo(e,A),w.push(A)}d.push(w)}if(e[2]-e[0]<=s/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const y of d)for(const w of y)uh(w,e,i,s)}var g;return d}class Ta{constructor(e,i){this.type=Li,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mi(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let s=0;s<r.features.length;++s){const h=r.features[s].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ta(r,r.features[s].geometry)}else if(r.type==="Feature"){const s=r.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Ta(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Ta(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const s=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const g=ep(r.coordinates,h,d),y=tp(i.geometry(),s,h,d);if(!Al(s,h))return!1;for(const w of y)if(!Sl(w,g))return!1}if(r.type==="MultiPolygon"){const g=Pf(r.coordinates,h,d),y=tp(i.geometry(),s,h,d);if(!Al(s,h))return!1;for(const w of y)if(!Ny(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const s=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const g=ep(r.coordinates,h,d),y=ip(i.geometry(),s,h,d);if(!Al(s,h))return!1;for(const w of y)if(!Tf(w,g))return!1}if(r.type==="MultiPolygon"){const g=Pf(r.coordinates,h,d),y=ip(i.geometry(),s,h,d);if(!Al(s,h))return!1;for(const w of y)if(!Ns(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Yu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},np=1/298.257223563,ap=np*(2-np),Tl=Math.PI/180;class Pl{static fromTile(e,i,r){const s=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),h=Math.atan(.5*(Math.exp(s)-Math.exp(-s)))/Tl;return new Pl(h,r)}static get units(){return Yu}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Yu[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Yu).join(", ")}`);const r=6378.137*Tl*(i?Yu[i]:1),s=Math.cos(e*Tl),h=1/(1-ap*(1-s*s)),d=Math.sqrt(h);this.kx=r*d*s,this.ky=r*d*h*(1-ap)}distance(e,i){const r=dr(e[0]-i[0])*this.kx,s=(e[1]-i[1])*this.ky;return Math.sqrt(r*r+s*s)}bearing(e,i){const r=dr(i[0]-e[0])*this.kx;return Math.atan2(r,(i[1]-e[1])*this.ky)/Tl}destination(e,i,r){const s=r*Tl;return this.offset(e,Math.sin(s)*i,Math.cos(s)*i)}offset(e,i,r){return[e[0]+i/this.kx,e[1]+r/this.ky]}lineDistance(e){let i=0;for(let r=0;r<e.length-1;r++)i+=this.distance(e[r],e[r+1]);return i}area(e){let i=0;for(let r=0;r<e.length;r++){const s=e[r];for(let h=0,d=s.length,g=d-1;h<d;g=h++)i+=dr(s[h][0]-s[g][0])*(s[h][1]+s[g][1])*(r?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let r=0;if(i<=0)return e[0];for(let s=0;s<e.length-1;s++){const h=e[s],d=e[s+1],g=this.distance(h,d);if(r+=g,r>i)return ch(h,d,(i-(r-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,r){let[s,h]=i,d=dr(r[0]-s)*this.kx,g=(r[1]-h)*this.ky;if(d!==0||g!==0){const y=(dr(e[0]-s)*this.kx*d+(e[1]-h)*this.ky*g)/(d*d+g*g);y>1?(s=r[0],h=r[1]):y>0&&(s+=d/this.kx*y,h+=g/this.ky*y)}return d=dr(e[0]-s)*this.kx,g=(e[1]-h)*this.ky,Math.sqrt(d*d+g*g)}pointOnLine(e,i){let r=1/0,s=e[0][0],h=e[0][1],d=0,g=0;for(let y=0;y<e.length-1;y++){let w=e[y][0],k=e[y][1],A=dr(e[y+1][0]-w)*this.kx,S=(e[y+1][1]-k)*this.ky,E=0;A===0&&S===0||(E=(dr(i[0]-w)*this.kx*A+(i[1]-k)*this.ky*S)/(A*A+S*S),E>1?(w=e[y+1][0],k=e[y+1][1]):E>0&&(w+=A/this.kx*E,k+=S/this.ky*E)),A=dr(i[0]-w)*this.kx,S=(i[1]-k)*this.ky;const D=A*A+S*S;D<r&&(r=D,s=w,h=k,d=y,g=E)}return{point:[s,h],index:d,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,r){let s=this.pointOnLine(r,e),h=this.pointOnLine(r,i);if(s.index>h.index||s.index===h.index&&s.t>h.t){const w=s;s=h,h=w}const d=[s.point],g=s.index+1,y=h.index;!rp(r[g],d[0])&&g<=y&&d.push(r[g]);for(let w=g+1;w<=y;w++)d.push(r[w]);return rp(r[y],h.point)||d.push(h.point),d}lineSliceAlong(e,i,r){let s=0;const h=[];for(let d=0;d<r.length-1;d++){const g=r[d],y=r[d+1],w=this.distance(g,y);if(s+=w,s>e&&h.length===0&&h.push(ch(g,y,(e-(s-w))/w)),s>=i)return h.push(ch(g,y,(i-(s-w))/w)),h;s>e&&h.push(y)}return h}bufferPoint(e,i){const r=i/this.ky,s=i/this.kx;return[e[0]-s,e[1]-r,e[0]+s,e[1]+r]}bufferBBox(e,i){const r=i/this.ky,s=i/this.kx;return[e[0]-s,e[1]-r,e[2]+s,e[3]+r]}insideBBox(e,i){return dr(e[0]-i[0])>=0&&dr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function rp(n,e){return n[0]===e[0]&&n[1]===e[1]}function ch(n,e,i){const r=dr(e[0]-n[0]);return[n[0]+r*i,n[1]+(e[1]-n[1])*i]}function dr(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class hh{constructor(e=[],i=(r,s)=>r<s?-1:r>s?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,s=i[e];for(;e>0;){const h=e-1>>1,d=i[h];if(r(s,d)>=0)break;i[e]=d,e=h}i[e]=s}_down(e){const{data:i,compare:r}=this,s=this.length>>1,h=i[e];for(;e<s;){let d=1+(e<<1);const g=d+1;if(g<this.length&&r(i[g],i[d])<0&&(d=g),r(i[d],h)>=0)break;i[e]=i[d],e=d}i[e]=h}}var lt=8192;function op(n,e){return e.dist-n.dist}const Ml=100,El=50;function Hu(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Zu(n){return n[1]-n[0]+1}function eo(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function dh(n,e){if(n[0]>n[1])return[null,null];const i=Zu(n);if(e){if(i===2)return[n,null];const r=Math.floor(i/2);return[[n[0],n[0]+r],[n[0]+r,n[1]]]}{if(i===1)return[n,null];const r=Math.floor(i/2)-1;return[[n[0],n[0]+r],[n[0]+r+1,n[1]]]}}function Sr(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!eo(e,n.length))return i;for(let r=e[0];r<=e[1];++r)Xo(i,n[r]);return i}function Si(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let r=0;r<n[i].length;++r)Xo(e,n[i][r]);return e}function Cl(n,e,i){if(Hu(n)||Hu(e))return NaN;let r=0,s=0;return n[2]<e[0]&&(r=e[0]-n[2]),n[0]>e[2]&&(r=n[0]-e[2]),n[1]>e[3]&&(s=n[1]-e[3]),n[3]<e[1]&&(s=e[1]-n[3]),i.distance([0,0],[r,s])}function Fy(n){return 360*n-180}function Oy(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ph(n,e){const i=Math.pow(2,e.z),r=(n.y/lt+e.y)/i;return[Fy((n.x/lt+e.x)/i),Oy(r)]}function $y(n,e){const i=[];for(let r=0;r<n.length;++r)i.push(ph(n[r],e));return i}function Tn(n,e,i){const r=i.pointOnLine(e,n).point;return i.distance(n,r)}function Mf(n,e,i,r,s){const h=i.slice(r[0],r[1]+1);let d=1/0;for(let g=e[0];g<=e[1];++g)if((d=Math.min(d,Tn(n[g],h,s)))===0)return 0;return d}function sp(n,e,i,r,s){const h=Math.min(s.pointToSegmentDistance(n,i,r),s.pointToSegmentDistance(e,i,r)),d=Math.min(s.pointToSegmentDistance(i,n,e),s.pointToSegmentDistance(r,n,e));return Math.min(h,d)}function jy(n,e,i,r,s){if(!eo(e,n.length)||!eo(r,i.length))return NaN;let h=1/0;for(let d=e[0];d<e[1];++d)for(let g=r[0];g<r[1];++g){if(lh(n[d],n[d+1],i[g],i[g+1]))return 0;h=Math.min(h,sp(n[d],n[d+1],i[g],i[g+1],s))}return h}function Vy(n,e,i,r,s){if(!eo(e,n.length)||!eo(r,i.length))return NaN;let h=1/0;for(let d=e[0];d<=e[1];++d)for(let g=r[0];g<=r[1];++g)if((h=Math.min(h,s.distance(n[d],i[g])))===0)return h;return h}function Uy(n,e,i){if(Sl(n,e,!0))return 0;let r=1/0;for(const s of e){const h=s.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[h-1]&&(r=Math.min(r,i.pointToSegmentDistance(n,s[h-1],s[0])))===0||(r=Math.min(r,Tn(n,s,i)))===0)return r}return r}function Jy(n,e,i,r){if(!eo(e,n.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Sl(n[h],i,!0))return 0;let s=1/0;for(let h=e[0];h<e[1];++h)for(const d of i)for(let g=0,y=d.length,w=y-1;g<y;w=g++){if(lh(n[h],n[h+1],d[w],d[g]))return 0;s=Math.min(s,sp(n[h],n[h+1],d[w],d[g],r))}return s}function Ef(n,e){for(const i of n)for(let r=0;r<=i.length-1;++r)if(Sl(i[r],e,!0))return!0;return!1}function qy(n,e,i,r=1/0){const s=Si(n),h=Si(e);if(r!==1/0&&Cl(s,h,i)>=r)return r;if(Al(s,h)){if(Ef(n,e))return 0}else if(Ef(e,n))return 0;let d=r;for(const g of n)for(let y=0,w=g.length,k=w-1;y<w;k=y++)for(const A of e)for(let S=0,E=A.length,D=E-1;S<E;D=S++){if(lh(g[k],g[y],A[D],A[S]))return 0;d=Math.min(d,sp(g[k],g[y],A[D],A[S],i))}return d}function mh(n,e,i,r,s,h,d){if(h===null||d===null)return;const g=Cl(Sr(r,h),Sr(s,d),i);g<e&&n.push({dist:g,range1:h,range2:d})}function Gy(n,e,i,r,s=1/0){let h=Math.min(r.distance(n[0],i[0][0]),s);if(h===0)return h;const d=new hh([{dist:0,range1:[0,n.length-1],range2:[0,0]}],op),g=e?El:Ml,y=Si(i);for(;d.length;){const w=d.pop();if(w.dist>=h)continue;const k=w.range1;if(Zu(k)<=g){if(!eo(k,n.length))return NaN;if(e){const A=Jy(n,k,i,r);if((h=Math.min(h,A))===0)return h}else for(let A=k[0];A<=k[1];++A){const S=Uy(n[A],i,r);if((h=Math.min(h,S))===0)return h}}else{const A=dh(k,e);if(A[0]!==null){const S=Cl(Sr(n,A[0]),y,r);S<h&&d.push({dist:S,range1:A[0],range2:[0,0]})}if(A[1]!==null){const S=Cl(Sr(n,A[1]),y,r);S<h&&d.push({dist:S,range1:A[1],range2:[0,0]})}}}return h}function Cf(n,e,i,r,s,h=1/0){let d=Math.min(h,s.distance(n[0],i[0]));if(d===0)return d;const g=new hh([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],op),y=e?El:Ml,w=r?El:Ml;for(;g.length;){const k=g.pop();if(k.dist>=d)continue;const A=k.range1,S=k.range2;if(Zu(A)<=y&&Zu(S)<=w){if(!eo(A,n.length)||!eo(S,i.length))return NaN;if(e&&r?d=Math.min(d,jy(n,A,i,S,s)):e||r?e&&!r?d=Math.min(d,Mf(i,S,n,A,s)):!e&&r&&(d=Math.min(d,Mf(n,A,i,S,s))):d=Math.min(d,Vy(n,A,i,S,s)),d===0)return d}else{const E=dh(A,e),D=dh(S,r);mh(g,d,s,n,i,E[0],D[0]),mh(g,d,s,n,i,E[0],D[1]),mh(g,d,s,n,i,E[1],D[0]),mh(g,d,s,n,i,E[1],D[1])}}return d}function lp(n,e,i,r,s=1/0){let h=s;const d=Sr(n,[0,n.length-1]);for(const g of i)if(!(h!==1/0&&Cl(d,Sr(g,[0,g.length-1]),r)>=h)&&(h=Math.min(h,Cf(n,e,g,!0,r,h)),h===0))return h;return h}function fh(n,e,i,r,s=1/0){let h=s;const d=Sr(n,[0,n.length-1]);for(const g of i){if(h!==1/0&&Cl(d,Si(g),r)>=h)continue;const y=Gy(n,e,g,r,h);if(isNaN(y))return y;if((h=Math.min(h,y))===0)return h}return h}function up(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Fs{constructor(e,i){this.type=Ct,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(mi(e[1])){const r=e[1];if(r.type==="FeatureCollection"){for(let s=0;s<r.features.length;++s)if(up(r.features[s].geometry.type))return new Fs(r,r.features[s].geometry)}else if(r.type==="Feature"){if(up(r.geometry.type))return new Fs(r,r.geometry)}else if(up(r.type))return new Fs(r,r)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),r=e.canonicalID();if(i!=null&&r!=null){if(e.geometryType()==="Point")return function(s,h,d){const g=[];for(const w of s)for(const k of w)g.push(ph(k,h));const y=new Pl(g[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Cf(g,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y):d.type==="MultiLineString"?lp(g,!1,d.coordinates,y):d.type==="Polygon"||d.type==="MultiPolygon"?fh(g,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,y):null}(i,r,this.geometries);if(e.geometryType()==="LineString")return function(s,h,d){const g=[];for(const w of s){const k=[];for(const A of w)k.push(ph(A,h));g.push(k)}const y=new Pl(g[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return lp(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,y);if(d.type==="MultiLineString"){let w=1/0;for(let k=0;k<d.coordinates.length;k++){const A=lp(d.coordinates[k],!0,g,y,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}if(d.type==="Polygon"||d.type==="MultiPolygon"){let w=1/0;for(let k=0;k<g.length;k++){const A=fh(g[k],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,y,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return null}(i,r,this.geometries);if(e.geometryType()==="Polygon")return function(s,h,d){const g=[];for(const w of function(k,A){const S=k.length;if(S<=1)return[k];const E=[];let D,R;for(let F=0;F<S;F++){const j=By(k[F]);j!==0&&(k[F].area=Math.abs(j),R===void 0&&(R=j<0),R===j<0?(D&&E.push(D),D=[k[F]]):D.push(k[F]))}return D&&E.push(D),E}(s)){const k=[];for(let A=0;A<w.length;++A)k.push($y(w[A],h));g.push(k)}const y=new Pl(g[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return fh(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,y);if(d.type==="MultiLineString"){let w=1/0;for(let k=0;k<d.coordinates.length;k++){const A=fh(d.coordinates[k],!0,g,y,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return d.type==="Polygon"||d.type==="MultiPolygon"?function(w,k,A){let S=1/0;for(const E of w)for(const D of k){const R=qy(E,D,A,S);if(isNaN(R))return R;if((S=Math.min(S,R))===0)return S}return S}(d.type==="Polygon"?[d.coordinates]:d.coordinates,g,y):null}(i,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Dl(n){if(n instanceof ca&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Ta||n instanceof Fs)return!1;if(n instanceof zl)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!Dl(i)&&(e=!1)}),e}function gh(n){if(n instanceof ca&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!gh(i)&&(e=!1)}),e}function _h(n){if(n instanceof zl)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,..._h(i)])}),e}function Il(n,e){if(n instanceof ca&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(r=>{i&&!Il(r,e)&&(i=!1)}),i}function Df(n,e,i){return[n,e,i].filter(Boolean).join("")}function cp(n,e){switch(n){case"string":return kr(e);case"number":return+e;case"boolean":return!!e;case"color":return Bi.parse(e);case"formatted":return Ra.fromString(kr(e));case"resolvedImage":return Ua.build(kr(e))}return e}function If(n,e,i,r){return r!==void 0&&(n=r*Math.round(n/r)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class zl{constructor(e,i,r,s=!1){this.type=e,this.key=i,this.scope=r,this.featureConstant=s}static parse(e,i){let r=i.expectedType;if(r==null&&(r=Wi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const s=i.parse(e[1],1);if(!(s instanceof Gt))return i.error("Key name of 'config' expression must be a string literal.");let h,d=!0;const g=kr(s.value);if(e.length>=3){const y=i.parse(e[2],2);if(!(y instanceof Gt))return i.error("Scope of 'config' expression must be a string literal.");h=kr(y.value)}if(i.options){const y=Df(g,h,i._scope),w=i.options.get(y);w&&(d=Dl(w.value||w.default))}return new zl(r,g,h,d)}evaluate(e){const i=Df(this.key,this.scope,e.scope),r=e.getConfig(i);if(!r)return null;const{type:s,value:h,values:d,minValue:g,maxValue:y,stepValue:w}=r,k=r.default.evaluate(e);let A=k;if(h){const S=e.scope;e.scope=(S||"").split("").slice(1).join(""),A=h.evaluate(e),e.scope=S}return s&&(A=cp(s,A)),A===void 0||g===void 0&&y===void 0&&w===void 0||(typeof A=="number"?A=If(A,g,y,w):Array.isArray(A)&&(A=A.map(S=>typeof S=="number"?If(S,g,y,w):S))),h!==void 0&&A!==void 0&&d&&!d.includes(A)&&(A=k,s&&(A=cp(s,A))),(s&&s!==this.type||A!==void 0&&!oh(_t(A),this.type))&&(A=cp(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class yh{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new yh(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class wh{constructor(e,i=[],r,s=new Kd,h=[],d,g){this.registry=e,this.path=i,this.key=i.map(y=>typeof y=="string"?`['${y}']`:`[${y}]`).join(""),this.scope=s,this.errors=h,this.expectedType=r,this._scope=d,this.options=g}parse(e,i,r,s,h={}){return i||r?this.concat(i,null,r,s)._parse(e,h):this._parse(e,h)}parseObjectValue(e,i,r,s,h,d={}){return this.concat(i,r,s,h)._parse(e,d)}_parse(e,i){function r(s,h,d){return d==="assert"?new Ft(h,[s]):d==="coerce"?new Ar(h,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(s){let h=s.parse(e,this);if(!h)return null;if(this.expectedType){const d=this.expectedType,g=h.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||g.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(d,g))return null}else h=r(h,d,i.typeAnnotation||"coerce");else h=r(h,d,i.typeAnnotation||"assert")}if(!(h instanceof Gt)&&h.type.kind!=="resolvedImage"&&hp(h)){const d=new qu(this._scope,this.options);try{h=new Gt(h.type,h.evaluate(d))}catch(g){return this.error(g.message),null}}return h}return Ar.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r,s){let h=typeof e=="number"?this.path.concat(e):this.path;h=typeof i=="string"?h.concat(i):h;const d=s?this.scope.concat(s):this.scope;return new wh(this.registry,h,r||null,d,this.errors,this._scope,this.options)}error(e,...i){const r=`${this.key}${i.map(s=>`[${s}]`).join("")}`;this.errors.push(new hr(r,e))}checkSubtype(e,i){const r=vl(e,i);return r&&this.error(r),r}}function hp(n){if(n instanceof yh)return hp(n.boundExpression);if(n instanceof ca&&n.name==="error"||n instanceof Qr||n instanceof Ta||n instanceof Fs||n instanceof zl)return!1;const e=n instanceof Ar||n instanceof Ft;let i=!0;return n.eachChild(r=>{i=e?i&&hp(r):i&&r instanceof Gt}),!!i&&Dl(n)&&Il(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function bh(n,e){const i=n.length-1;let r,s,h=0,d=i,g=0;for(;h<=d;)if(g=Math.floor((h+d)/2),r=n[g],s=n[g+1],r<=e){if(g===i||e<s)return g;h=g+1}else{if(!(r>e))throw new qn("Input is not a number.");d=g-1}return 0}class Ku{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[s,h]of r)this.labels.push(s),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,Ct);if(!r)return null;const s=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let d=1;d<e.length;d+=2){const g=d===1?-1/0:e[d],y=e[d+1],w=d,k=d+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(s.length&&s[s.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=i.parse(y,k,h);if(!A)return null;h=h||A.type,s.push([g,A])}return new Ku(h,r,s)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return r[0].evaluate(e);const h=i.length;return s>=i[h-1]?r[h-1].evaluate(e):r[bh(i,s)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const zf=.95047,Lf=1.08883,Rf=4/29,Qo=6/29,Bf=3*Qo*Qo,Wf=Qo*Qo*Qo,Yy=Math.PI/180,Hy=180/Math.PI;function dp(n){return n>Wf?Math.pow(n,1/3):n/Bf+Rf}function vh(n){return n>Qo?n*n*n:Bf*(n-Rf)}function xh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function es(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function pp(n){const e=es(n.r),i=es(n.g),r=es(n.b),s=dp((.4124564*e+.3575761*i+.1804375*r)/zf),h=dp((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*h-16,a:500*(s-h),b:200*(h-dp((.0193339*e+.119192*i+.9503041*r)/Lf)),alpha:n.a}}function mp(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,r=isNaN(n.b)?e:e-n.b/200;return e=1*vh(e),i=zf*vh(i),r=Lf*vh(r),new Bi(xh(3.2404542*i-1.5371385*e-.4985314*r),xh(-.969266*i+1.8760108*e+.041556*r),xh(.0556434*i-.2040259*e+1.0572252*r),n.alpha)}function Zy(n,e,i){const r=e-n;return n+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Os={forward:pp,reverse:mp,interpolate:function(n,e,i){return{l:Vt(n.l,e.l,i),a:Vt(n.a,e.a,i),b:Vt(n.b,e.b,i),alpha:Vt(n.alpha,e.alpha,i)}}},$s={forward:function(n){const{l:e,a:i,b:r}=pp(n),s=Math.atan2(r,i)*Hy;return{h:s<0?s+360:s,c:Math.sqrt(i*i+r*r),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Yy,i=n.c;return mp({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Zy(n.h,e.h,i),c:Vt(n.c,e.c,i),l:Vt(n.l,e.l,i),alpha:Vt(n.alpha,e.alpha,i)}}};var Nf=Object.freeze({__proto__:null,hcl:$s,lab:Os});class pr{constructor(e,i,r,s,h){this.type=e,this.operator=i,this.interpolation=r,this.input=s,this.labels=[],this.outputs=[];for(const[d,g]of h)this.labels.push(d),this.outputs.push(g)}static interpolationFactor(e,i,r,s){let h=0;if(e.name==="exponential")h=kh(i,e.base,r,s);else if(e.name==="linear")h=kh(i,1,r,s);else if(e.name==="cubic-bezier"){const d=e.controlPoints;h=new Yc(d[0],d[1],d[2],d[3]).solve(kh(i,1,r,s))}return h}static parse(e,i){let[r,s,h,...d]=e;if(!Array.isArray(s)||s.length===0)return i.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){const w=s[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:w}}else{if(s[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const w=s.slice(1);if(w.length!==4||w.some(k=>typeof k!="number"||k<0||k>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,Ct),!h)return null;const g=[];let y=null;r==="interpolate-hcl"||r==="interpolate-lab"?y=tr:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let w=0;w<d.length;w+=2){const k=d[w],A=d[w+1],S=w+3,E=w+4;if(typeof k!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(g.length&&g[g.length-1][0]>=k)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);const D=i.parse(A,E,y);if(!D)return null;y=y||D.type,g.push([k,D])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new pr(y,r,s,h,g):i.error(`Type ${Hn(y)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return r[0].evaluate(e);const h=i.length;if(s>=i[h-1])return r[h-1].evaluate(e);const d=bh(i,s),g=pr.interpolationFactor(this.interpolation,s,i[d],i[d+1]),y=r[d].evaluate(e),w=r[d+1].evaluate(e);return this.operator==="interpolate"?Ou[this.type.kind.toLowerCase()](y,w,g):this.operator==="interpolate-hcl"?$s.reverse($s.interpolate($s.forward(y),$s.forward(w),g)):Os.reverse(Os.interpolate(Os.forward(y),Os.forward(w),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function kh(n,e,i,r){const s=r-i,h=n-i;return s===0?0:e===1?h/s:(Math.pow(e,h)-1)/(Math.pow(e,s)-1)}class Xu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const s=i.expectedType;s&&s.kind!=="value"&&(r=s);const h=[];for(const g of e.slice(1)){const y=i.parse(g,1+h.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,h.push(y)}const d=s&&h.some(g=>vl(s,g.type));return new Xu(d?Wi:r,h)}evaluate(e){let i,r=null,s=0;for(const h of this.args){if(s++,r=h.evaluate(e),r&&r instanceof Ua&&!r.available&&(i||(i=r),r=null,s===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Ah{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let h=1;h<e.length-1;h+=2){const d=e[h];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const g=i.parse(e[h+1],h+1);if(!g)return null;r.push([d,g])}const s=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return s?new Ah(r,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}class fp{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ct),s=i.parse(e[2],2,La(i.expectedType||Wi));return r&&s?new fp(s.type.itemType,r,s):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new qn(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new qn(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new qn(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class gp{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ct),s=i.parse(e[2],2,La(i.expectedType||Wi));return r&&s?new gp(s.type.itemType,r,s):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new qn(`Array index out of bounds: ${i} < 0.`);if(i>r.length-1)throw new qn(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i===Math.floor(i))return r[i];const s=Math.floor(i),h=Math.ceil(i),d=r[s],g=r[h];if(typeof d!="number"||typeof g!="number")throw new qn(`Cannot interpolate between non-number values at index ${i}.`);const y=i-s;return d*(1-y)+g*y}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Sh{constructor(e,i){this.type=Li,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Wi),s=i.parse(e[2],2,Wi);return r&&s?Zo(r.type,[Li,Ji,Ct,bl,Wi])?new Sh(r,s):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!Vu(i,["boolean","string","number","null"]))throw new qn(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(_t(i))} instead.`);if(!Vu(r,["string","array"]))throw new qn(`Expected second argument to be of type array or string, but found ${Hn(_t(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Qu{constructor(e,i,r){this.type=Ct,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Wi),s=i.parse(e[2],2,Wi);if(!r||!s)return null;if(!Zo(r.type,[Li,Ji,Ct,bl,Wi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(r.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Ct);return h?new Qu(r,s,h):null}return new Qu(r,s)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Vu(i,["boolean","string","number","null"]))throw new qn(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(_t(i))} instead.`);if(!Vu(r,["string","array"]))throw new qn(`Expected second argument to be of type array or string, but found ${Hn(_t(r))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return r.indexOf(i,s)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ll{constructor(e,i,r,s,h,d){this.inputType=e,this.type=i,this.input=r,this.cases=s,this.outputs=h,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const h={},d=[];for(let w=2;w<e.length-1;w+=2){let k=e[w];const A=e[w+1];Array.isArray(k)||(k=[k]);const S=i.concat(w);if(k.length===0)return S.error("Expected at least one branch label.");for(const D of k){if(typeof D!="number"&&typeof D!="string")return S.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return S.error("Numeric branch labels must be integer values.");if(r){if(S.checkSubtype(r,_t(D)))return null}else r=_t(D);if(h[String(D)]!==void 0)return S.error("Branch labels must be unique.");h[String(D)]=d.length}const E=i.parse(A,w,s);if(!E)return null;s=s||E.type,d.push(E)}const g=i.parse(e[1],1,Wi);if(!g)return null;const y=i.parse(e[e.length-1],e.length-1,s);return y?g.type.kind!=="value"&&i.concat(1).checkSubtype(r,g.type)?null:new Ll(r,s,g,h,d,y):null}evaluate(e){const i=this.input.evaluate(e);return(oh(_t(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],s={};for(const d of i){const g=s[this.cases[d]];g===void 0?(s[this.cases[d]]=r.length,r.push([this.cases[d],[d]])):r[g][1].push(d)}const h=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,g]of r)e.push(g.length===1?h(g[0]):g.map(h)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class _p{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const s=[];for(let d=1;d<e.length-1;d+=2){const g=i.parse(e[d],d,Li);if(!g)return null;const y=i.parse(e[d+1],d+1,r);if(!y)return null;s.push([g,y]),r=r||y.type}const h=i.parse(e[e.length-1],e.length-1,r);return h?new _p(r,s,h):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ec{constructor(e,i,r,s){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Wi),s=i.parse(e[2],2,Ct);if(!r||!s)return null;if(!Zo(r.type,[La(Wi),Ji,Wi]))return i.error(`Expected first argument to be of type array or string, but found ${Hn(r.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Ct);return h?new ec(r.type,r,s,h):null}return new ec(r.type,r,s)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Vu(i,["string","array"]))throw new qn(`Expected first argument to be of type array or string, but found ${Hn(_t(i))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return i.slice(r,s)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ff(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Of(n,e,i,r){return r.compare(e,i)===0}function js(n,e,i){const r=n!=="=="&&n!=="!=";return class o5{constructor(h,d,g){this.type=Li,this.lhs=h,this.rhs=d,this.collator=g,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");const g=h[0];let y=d.parse(h[1],1,Wi);if(!y)return null;if(!Ff(g,y.type))return d.concat(1).error(`"${g}" comparisons are not supported for type '${Hn(y.type)}'.`);let w=d.parse(h[2],2,Wi);if(!w)return null;if(!Ff(g,w.type))return d.concat(2).error(`"${g}" comparisons are not supported for type '${Hn(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return d.error(`Cannot compare types '${Hn(y.type)}' and '${Hn(w.type)}'.`);r&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new Ft(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new Ft(y.type,[w])));let k=null;if(h.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(k=d.parse(h[3],3,rh),!k)return null}return new o5(y,w,k)}evaluate(h){const d=this.lhs.evaluate(h),g=this.rhs.evaluate(h);if(r&&this.hasUntypedArgument){const y=_t(d),w=_t(g);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new qn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const y=_t(d),w=_t(g);if(y.kind!=="string"||w.kind!=="string")return e(h,d,g)}return this.collator?i(h,d,g,this.collator.evaluate(h)):e(h,d,g)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[n];return this.eachChild(d=>{h.push(d.serialize())}),h}}}const $f=js("==",function(n,e,i){return e===i},Of),Ky=js("!=",function(n,e,i){return e!==i},function(n,e,i,r){return!Of(0,e,i,r)}),Xy=js("<",function(n,e,i){return e<i},function(n,e,i,r){return r.compare(e,i)<0}),Qy=js(">",function(n,e,i){return e>i},function(n,e,i,r){return r.compare(e,i)>0}),Th=js("<=",function(n,e,i){return e<=i},function(n,e,i,r){return r.compare(e,i)<=0}),e1=js(">=",function(n,e,i){return e>=i},function(n,e,i,r){return r.compare(e,i)>=0});class Ph{constructor(e,i,r,s,h,d){this.type=Ji,this.number=e,this.locale=i,this.currency=r,this.unit=s,this.minFractionDigits=h,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Ct);if(!r)return null;const s=e[2];if(typeof s!="object"||Array.isArray(s))return i.error("NumberFormat options argument must be an object.");let h=null;if(s.locale&&(h=i.parseObjectValue(s.locale,2,"locale",Ji),!h))return null;let d=null;if(s.currency&&(d=i.parseObjectValue(s.currency,2,"currency",Ji),!d))return null;let g=null;if(s.unit&&(g=i.parseObjectValue(s.unit,2,"unit",Ji),!g))return null;let y=null;if(s["min-fraction-digits"]&&(y=i.parseObjectValue(s["min-fraction-digits"],2,"min-fraction-digits",Ct),!y))return null;let w=null;return s["max-fraction-digits"]&&(w=i.parseObjectValue(s["max-fraction-digits"],2,"max-fraction-digits",Ct),!w)?null:new Ph(r,h,d,g,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class yp{constructor(e){this.type=Ct,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Hn(r.type)} instead.`):new yp(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new qn(`Expected value to be of type string or array, but found ${Hn(_t(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function jf(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Vs={"==":$f,"!=":Ky,">":Qy,"<":Xy,">=":e1,"<=":Th,array:Ft,at:fp,"at-interpolated":gp,boolean:Ft,case:_p,coalesce:Xu,collator:Qr,format:xl,image:kl,in:Sh,"index-of":Qu,interpolate:pr,"interpolate-hcl":pr,"interpolate-lab":pr,length:yp,let:Ah,literal:Gt,match:Ll,number:Ft,"number-format":Ph,object:Ft,slice:ec,step:Ku,string:Ft,"to-boolean":Ar,"to-color":Ar,"to-number":Ar,"to-string":Ar,var:yh,within:Ta,distance:Fs,config:zl};function wp(n,[e,i,r,s]){e=e.evaluate(n),i=i.evaluate(n),r=r.evaluate(n);const h=s?s.evaluate(n):1,d=Bs(e,i,r,h);if(d)throw new qn(d);return new Bi(e/255,i/255,r/255,h)}function bp(n,[e,i,r,s]){e=e.evaluate(n),i=i.evaluate(n),r=r.evaluate(n);const h=s?s.evaluate(n):1,d=function(w,k,A,S){return typeof w=="number"&&w>=0&&w<=360?typeof k=="number"&&k>=0&&k<=100&&typeof A=="number"&&A>=0&&A<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[w,k,A,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[w,k,A,S]:[w,k,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[w,k,A,S]:[w,k,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,r,h);if(d)throw new qn(d);const g=`hsla(${e}, ${i}%, ${r}%, ${h})`,y=Bi.parse(g);if(!y)throw new qn(`Failed to parse HSLA color: ${g}`);return y}function Vf(n,e){return n in e}function ts(n,e){const i=e[n];return i===void 0?null:i}function Us(n){return{type:n}}function Uf(n){return{result:"success",value:n}}function is(n){return{result:"error",value:n}}function Mh(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function tc(n){return n["property-type"]==="data-driven"}function vp(n){return Mh(n.expression,"measure-light")}function xp(n){return Mh(n.expression,"zoom")}function ic(n){return!!n.expression&&n.expression.interpolated}function nc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Jf(n){return n}function qf(n,e){const i=e.type==="color",r=n.stops&&typeof n.stops[0][0]=="object",s=r||!(r||n.property!==void 0),h=n.type||(ic(e)?"exponential":"interval");if(i&&((n=Rs({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],Bi.parse(w[1])])),n.default=Bi.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Nf[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let d,g,y;if(h==="exponential")d=kp;else if(h==="interval")d=i1;else if(h==="categorical"){d=t1,g=Object.create(null);for(const w of n.stops)g[w[0]]=w[1];y=typeof n.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);d=n1}if(r){const w={},k=[];for(let E=0;E<n.stops.length;E++){const D=n.stops[E],R=D[0].zoom;w[R]===void 0&&(w[R]={zoom:R,type:n.type,property:n.property,default:n.default,stops:[]},k.push(R)),w[R].stops.push([D[0].value,D[1]])}const A=[];for(const E of k)A.push([w[E].zoom,qf(w[E],e)]);const S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:pr.interpolationFactor.bind(void 0,S),zoomStops:A.map(E=>E[0]),evaluate:({zoom:E},D)=>kp({stops:A,base:n.base},e,E).evaluate(E,D)}}if(s){const w=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:pr.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(k=>k[0]),evaluate:({zoom:k})=>d(n,e,k,g,y)}}return{kind:"source",evaluate(w,k){const A=k&&k.properties?k.properties[n.property]:void 0;return A===void 0?Tr(n.default,e.default):d(n,e,A,g,y)}}}function Tr(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function t1(n,e,i,r,s){return Tr(typeof i===s?r[i]:void 0,n.default,e.default)}function i1(n,e,i){if(Ko(i)!=="number")return Tr(n.default,e.default);const r=n.stops.length;if(r===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[r-1][0])return n.stops[r-1][1];const s=bh(n.stops.map(h=>h[0]),i);return n.stops[s][1]}function kp(n,e,i){const r=n.base!==void 0?n.base:1;if(Ko(i)!=="number")return Tr(n.default,e.default);const s=n.stops.length;if(s===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const h=bh(n.stops.map(k=>k[0]),i),d=function(k,A,S,E){const D=E-S,R=k-S;return D===0?0:A===1?R/D:(Math.pow(A,R)-1)/(Math.pow(A,D)-1)}(i,r,n.stops[h][0],n.stops[h+1][0]),g=n.stops[h][1],y=n.stops[h+1][1];let w=Ou[e.type]||Jf;if(n.colorSpace&&n.colorSpace!=="rgb"){const k=Nf[n.colorSpace];w=(A,S)=>k.reverse(k.interpolate(k.forward(A),k.forward(S),d))}return typeof g.evaluate=="function"?{evaluate(...k){const A=g.evaluate.apply(void 0,k),S=y.evaluate.apply(void 0,k);if(A!==void 0&&S!==void 0)return w(A,S,d)}}:w(g,y,d)}function n1(n,e,i){return e.type==="color"?i=Bi.parse(i):e.type==="formatted"?i=Ra.fromString(i.toString()):e.type==="resolvedImage"?i=Ua.build(i.toString()):Ko(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Tr(i,n.default,e.default)}ca.register(Vs,{error:[{kind:"error"},[Ji],(n,[e])=>{throw new qn(e.evaluate(n))}],typeof:[Ji,[Wi],(n,[e])=>Hn(_t(e.evaluate(n)))],"to-rgba":[La(Ct,4),[tr],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[La(Ct,4),[tr],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[tr,[Ct,Ct,Ct],wp],rgba:[tr,[Ct,Ct,Ct,Ct],wp],hsl:[tr,[Ct,Ct,Ct],bp],hsla:[tr,[Ct,Ct,Ct,Ct],bp],has:{type:Li,overloads:[[[Ji],(n,[e])=>Vf(e.evaluate(n),n.properties())],[[Ji,wo],(n,[e,i])=>Vf(e.evaluate(n),i.evaluate(n))]]},get:{type:Wi,overloads:[[[Ji],(n,[e])=>ts(e.evaluate(n),n.properties())],[[Ji,wo],(n,[e,i])=>ts(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Wi,[Ji],(n,[e])=>ts(e.evaluate(n),n.featureState||{})],properties:[wo,[],n=>n.properties()],"geometry-type":[Ji,[],n=>n.geometryType()],worldview:[Ji,[],n=>n.globals.worldview||""],id:[Wi,[],n=>n.id()],zoom:[Ct,[],n=>n.globals.zoom],pitch:[Ct,[],n=>n.globals.pitch||0],"distance-from-center":[Ct,[],n=>n.distanceFromCenter()],"measure-light":[Ct,[Ji],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Ct,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ct,[],n=>n.globals.lineProgress||0],"raster-value":[Ct,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Ct,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ct,[],n=>n.globals.skyRadialProgress||0],accumulated:[Wi,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ct,Us(Ct),(n,e)=>{let i=0;for(const r of e)i+=r.evaluate(n);return i}],"*":[Ct,Us(Ct),(n,e)=>{let i=1;for(const r of e)i*=r.evaluate(n);return i}],"-":{type:Ct,overloads:[[[Ct,Ct],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Ct],(n,[e])=>-e.evaluate(n)]]},"/":[Ct,[Ct,Ct],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Ct,[Ct,Ct],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Ct,[],()=>Math.LN2],pi:[Ct,[],()=>Math.PI],e:[Ct,[],()=>Math.E],"^":[Ct,[Ct,Ct],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Ct,[Ct],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Ct,[Ct],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Ct,[Ct],(n,[e])=>Math.log(e.evaluate(n))],log2:[Ct,[Ct],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Ct,[Ct],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Ct,[Ct],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Ct,[Ct],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Ct,[Ct],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Ct,[Ct],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Ct,[Ct],(n,[e])=>Math.atan(e.evaluate(n))],min:[Ct,Us(Ct),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Ct,Us(Ct),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Ct,[Ct],(n,[e])=>Math.abs(e.evaluate(n))],round:[Ct,[Ct],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ct,[Ct],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Ct,[Ct],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Li,[Ji,Wi],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Li,[Wi],(n,[e])=>n.id()===e.value],"filter-type-==":[Li,[Ji],(n,[e])=>n.geometryType()===e.value],"filter-<":[Li,[Ji,Wi],(n,[e,i])=>{const r=n.properties()[e.value],s=i.value;return typeof r==typeof s&&r<s}],"filter-id-<":[Li,[Wi],(n,[e])=>{const i=n.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[Li,[Ji,Wi],(n,[e,i])=>{const r=n.properties()[e.value],s=i.value;return typeof r==typeof s&&r>s}],"filter-id->":[Li,[Wi],(n,[e])=>{const i=n.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[Li,[Ji,Wi],(n,[e,i])=>{const r=n.properties()[e.value],s=i.value;return typeof r==typeof s&&r<=s}],"filter-id-<=":[Li,[Wi],(n,[e])=>{const i=n.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[Li,[Ji,Wi],(n,[e,i])=>{const r=n.properties()[e.value],s=i.value;return typeof r==typeof s&&r>=s}],"filter-id->=":[Li,[Wi],(n,[e])=>{const i=n.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[Li,[Wi],(n,[e])=>e.value in n.properties()],"filter-has-id":[Li,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Li,[La(Ji)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Li,[La(Wi)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Li,[Ji,La(Wi)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Li,[Ji,La(Wi)],(n,[e,i])=>function(r,s,h,d){for(;h<=d;){const g=h+d>>1;if(s[g]===r)return!0;s[g]>r?d=g-1:h=g+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Li,overloads:[[[Li,Li],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Us(Li),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Li,overloads:[[[Li,Li],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Us(Li),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Li,[Li],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Li,[Ji],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Ji,[Ji],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Ji,[Ji],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Ji,Us(Wi),(n,e)=>e.map(i=>kr(i.evaluate(n))).join("")],"resolved-locale":[Ji,[rh],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Ct,[Ct,Ct,Wi],(n,e)=>{const[i,r,s]=e.map(d=>d.evaluate(n));if(i>r||i===r)return i;let h;if(typeof s=="string")h=function(d){let g=0;if(d.length===0)return g;for(let y=0;y<d.length;y++)g=(g<<5)-g+d.charCodeAt(y),g|=0;return g}(s);else{if(typeof s!="number")throw new qn(`Invalid seed input: ${s}`);h=s}return i+jf(h)()*(r-i)}]});class Rl{constructor(e,i,r,s){this.expression=e,this._warningHistory={},this._evaluator=new qu(r,s),this._defaultValue=i?function(h){return h.type==="color"&&(nc(h.default)||Array.isArray(h.default))?new Bi(0,0,0,0):h.type==="color"?Bi.parse(h.default)||null:h.default===void 0?null:h.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=_h(e)}evaluateWithoutErrorHandling(e,i,r,s,h,d,g,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=s||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,s,h,d,g,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new qn(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${w.message}`)),this._defaultValue}}}function Eh(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Vs}function xo(n,e,i,r){const s=new wh(Vs,[],e?function(d){const g={color:tr,string:Ji,number:Ct,enum:Ji,boolean:Li,formatted:$u,resolvedImage:ju};return d.type==="array"?La(g[d.value]||Wi,d.length):g[d.type]}(e):void 0,void 0,void 0,i,r),h=s.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Uf(new Rl(h,e,i,r)):is(s.errors)}class ac{constructor(e,i,r,s){this.kind=e,this._styleExpression=i,this.isLightConstant=r,this.isLineProgressConstant=s,this.isStateDependent=e!=="constant"&&!gh(i.expression),this.configDependencies=_h(i.expression)}evaluateWithoutErrorHandling(e,i,r,s,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,s,h,d)}evaluate(e,i,r,s,h,d){return this._styleExpression.evaluate(e,i,r,s,h,d)}}class rc{constructor(e,i,r,s,h,d){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!gh(i.expression),this.isLightConstant=h,this.isLineProgressConstant=d,this.configDependencies=_h(i.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,i,r,s,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,s,h,d)}evaluate(e,i,r,s,h,d){return this._styleExpression.evaluate(e,i,r,s,h,d)}interpolationFactor(e,i,r){return this.interpolationType?pr.interpolationFactor(this.interpolationType,e,i,r):0}}function Gf(n,e,i,r){if((n=xo(n,e,i,r)).result==="error")return n;const s=n.value.expression,h=Dl(s);if(!h&&!tc(e))return is([new hr("","data expressions not supported")]);const d=Il(s,["zoom","pitch","distance-from-center"]);if(!d&&!xp(e))return is([new hr("","zoom expressions not supported")]);const g=Il(s,["measure-light"]);if(!g&&!vp(e))return is([new hr("","measure-light expression not supported")]);const y=Il(s,["line-progress"]);if(!y&&!function(A){return Mh(A.expression,"line-progress")}(e))return is([new hr("","line-progress expression not supported")]);const w=e.expression&&e.expression.relaxZoomRestriction,k=Wl(s);return k||d||w?k instanceof hr?is([k]):k instanceof pr&&!ic(e)?is([new hr("",'"interpolate" expressions cannot be used with this property')]):Uf(k?new rc(h&&y?"camera":"composite",n.value,k.labels,k instanceof pr?k.interpolation:void 0,g,y):new ac(h&&y?"constant":"source",n.value,g,y)):is([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Bl{constructor(e,i){this._parameters=e,this._specification=i,Rs(this,qf(this._parameters,this._specification))}static deserialize(e){return new Bl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Wl(n){let e=null;if(n instanceof Ah)e=Wl(n.result);else if(n instanceof Xu){for(const i of n.args)if(e=Wl(i),e)break}else(n instanceof Ku||n instanceof pr)&&n.input instanceof ca&&n.input.name==="zoom"&&(e=n);return e instanceof hr||n.eachChild(i=>{const r=Wl(i);r instanceof hr?e=r:e&&r&&e!==r&&(e=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Ch,Ap,Sp=function(){if(Ap)return Ch;Ap=1,Ch=e;var n=3;function e(i,r,s){var h=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(r=d[1])+2*(s=d[2]);for(var g=0;g<this.d*this.d;g++){var y=d[n+g],w=d[n+g+1];h.push(y===w?null:d.subarray(y,w))}var k=d[n+h.length+1];this.keys=d.subarray(d[n+h.length],k),this.bboxes=d.subarray(k),this.insert=this._insertReadonly}else{this.d=r+2*s;for(var A=0;A<this.d*this.d;A++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=s,this.scale=r/i,this.uid=0;var S=s/r*i;this.min=-S,this.max=i+S}return e.prototype.insert=function(i,r,s,h,d){this._forEachCell(r,s,h,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,r,s,h,d,g){this.cells[d].push(g)},e.prototype.query=function(i,r,s,h,d){var g=this.min,y=this.max;if(i<=g&&r<=g&&y<=s&&y<=h&&!d)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(i,r,s,h,this._queryCell,w,{},d),w},e.prototype._queryCell=function(i,r,s,h,d,g,y,w){var k=this.cells[d];if(k!==null)for(var A=this.keys,S=this.bboxes,E=0;E<k.length;E++){var D=k[E];if(y[D]===void 0){var R=4*D;(w?w(S[R+0],S[R+1],S[R+2],S[R+3]):i<=S[R+2]&&r<=S[R+3]&&s>=S[R+0]&&h>=S[R+1])?(y[D]=!0,g.push(A[D])):y[D]=!1}}},e.prototype._forEachCell=function(i,r,s,h,d,g,y,w){for(var k=this._convertToCellCoord(i),A=this._convertToCellCoord(r),S=this._convertToCellCoord(s),E=this._convertToCellCoord(h),D=k;D<=S;D++)for(var R=A;R<=E;R++){var F=this.d*R+D;if((!w||w(this._convertFromCellCoord(D),this._convertFromCellCoord(R),this._convertFromCellCoord(D+1),this._convertFromCellCoord(R+1)))&&d.call(this,i,r,s,h,F,g,y,w))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,r=n+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var d=new Int32Array(r+s+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var g=r,y=0;y<i.length;y++){var w=i[y];d[n+y]=g,d.set(w,g),g+=w.length}return d[n+i.length]=g,d.set(this.keys,g),d[n+i.length+1]=g+=this.keys.length,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer},Ch}(),ko=Go(Sp);const Ao={};function yt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Ao[e]={klass:n,omit:i.omit||[]}}yt(Object,"Object"),ko.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},ko.deserialize=function(n){return new ko(n.buffer)},Object.defineProperty(ko,"name",{value:"Grid"}),yt(ko,"Grid"),typeof DOMMatrix<"u"&&yt(DOMMatrix,"DOMMatrix"),yt(Bi,"Color"),yt(Error,"Error"),yt(Ra,"Formatted"),yt(sh,"FormattedSection"),yt(Mi,"AJAXError"),yt(Ua,"ResolvedImage"),yt(Bl,"StylePropertyFunction"),yt(Rl,"StyleExpression",{omit:["_evaluator"]}),yt(er,"ImageId"),yt(bo,"ImageVariant"),yt(rc,"ZoomDependentExpression"),yt(ac,"ZoomConstantExpression"),yt(ca,"CompoundExpression",{omit:["_evaluate"]});for(const n in Vs)Ao[Vs[n]._classRegistryKey]||yt(Vs[n],`Expression${n}`);function Yf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Hf(n){return self.ImageBitmap&&n instanceof ImageBitmap}function ns(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Yf(n)||Hf(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const r of n)i.push(ns(r,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[r,s]of n.entries())i.entries.push(ns(r),ns(s,e));return i}if(n instanceof Set){const i={$name:"Set"};let r=0;for(const s of n.values())i[++r]=ns(s);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},r=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const s of r)i[s]=n[s];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,r=i._classRegistryKey;if(!r)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const s=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const h in n)n.hasOwnProperty(h)&&(Ao[r].omit.indexOf(h)>=0||(s[h]=ns(n[h],e)));n instanceof Error&&(s.message=n.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(s.$name=r),s}throw new Error("can't serialize object of type "+typeof n)}function as(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Yf(n)||Hf(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(as);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const s=n.entries||[],h=new Map;for(let d=0;d<s.length;d+=2)h.set(as(s[d]),as(s[d+1]));return h}if(e==="Set"){const s=new Set;for(const h of Object.keys(n))h!=="$name"&&s.add(as(n[h]));return s}if(e==="DOMMatrix"){let s;return s=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(s)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Ao[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const r=Object.create(i.prototype);for(const s of Object.keys(n))s!=="$name"&&(r[s]=as(n[s]));return r}throw new Error("can't deserialize object of type "+typeof n)}const Wt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function oc(n){for(const e of n)if(Tp(e.charCodeAt(0)))return!0;return!1}function a1(n){for(const e of n)if(!r1(e.charCodeAt(0)))return!1;return!0}function r1(n){return!(Wt.Arabic(n)||Wt["Arabic Supplement"](n)||Wt["Arabic Extended-A"](n)||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n))}function Tp(n){return!(n!==746&&n!==747&&(n<4352||!(Wt["Bopomofo Extended"](n)||Wt.Bopomofo(n)||Wt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Wt["CJK Compatibility Ideographs"](n)||Wt["CJK Compatibility"](n)||Wt["CJK Radicals Supplement"](n)||Wt["CJK Strokes"](n)||!(!Wt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Wt["CJK Unified Ideographs Extension A"](n)||Wt["CJK Unified Ideographs"](n)||Wt["Enclosed CJK Letters and Months"](n)||Wt["Hangul Compatibility Jamo"](n)||Wt["Hangul Jamo Extended-A"](n)||Wt["Hangul Jamo Extended-B"](n)||Wt["Hangul Jamo"](n)||Wt["Hangul Syllables"](n)||Wt.Hiragana(n)||Wt["Ideographic Description Characters"](n)||Wt.Kanbun(n)||Wt["Kangxi Radicals"](n)||Wt["Katakana Phonetic Extensions"](n)||Wt.Katakana(n)&&n!==12540||!(!Wt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Wt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Wt["Unified Canadian Aboriginal Syllabics"](n)||Wt["Unified Canadian Aboriginal Syllabics Extended"](n)||Wt["Vertical Forms"](n)||Wt["Yijing Hexagram Symbols"](n)||Wt["Yi Syllables"](n)||Wt["Yi Radicals"](n))))}function Zf(n){return!(Tp(n)||function(e){return!!(Wt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Wt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Wt["Letterlike Symbols"](e)||Wt["Number Forms"](e)||Wt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Wt["Control Pictures"](e)&&e!==9251||Wt["Optical Character Recognition"](e)||Wt["Enclosed Alphanumerics"](e)||Wt["Geometric Shapes"](e)||Wt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Wt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wt["CJK Symbols and Punctuation"](e)||Wt.Katakana(e)||Wt["Private Use Area"](e)||Wt["CJK Compatibility Forms"](e)||Wt["Small Form Variants"](e)||Wt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function o1(n){return Wt.Arabic(n)||Wt["Arabic Supplement"](n)||Wt["Arabic Extended-A"](n)||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n)}function Kf(n){return n>=1424&&n<=2303||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n)}function s1(n,e){return!(!e&&Kf(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Wt.Khmer(n))}function l1(n){for(const e of n)if(Kf(e.charCodeAt(0)))return!0;return!1}const ir={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Pp=null,Wa=ir.unavailable,So=null;const Js=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Wa=ir.error),Pp&&Pp(n)};function Dh(){Ih.fire(new Is("pluginStateChange",{pluginStatus:Wa,pluginURL:So}))}const Ih=new zs,Nl=function(){return Wa},Xf=function(){if(Wa!==ir.deferred||!So)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wa=ir.loading,Dh(),So&&Wu({url:So},n=>{n?Js(n):(Wa=ir.loaded,Dh())})},To={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wa===ir.loaded||To.applyArabicShaping!=null,isLoading:()=>Wa===ir.loading,setState(n){Wa=n.pluginStatus,So=n.pluginURL},isParsing:()=>Wa===ir.parsing,isParsed:()=>Wa===ir.parsed,getPluginURL:()=>So};class Yi{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,r){for(const s of i)if(!s1(s.charCodeAt(0),r))return!1;return!0}(e,To.isLoaded())}}class sc{constructor(e,i,r,s){this.property=e,this.value=i,this.expression=function(h,d,g,y){if(nc(h))return new Bl(h,d);if(Eh(h)||Array.isArray(h)&&h.length>0){const w=Gf(h,d,g,y);if(w.result==="error")throw new Error(w.value.map(k=>`${k.key}: ${k.message}`).join(", "));return w.value}{let w=h;return typeof h=="string"&&d.type==="color"&&(w=Bi.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>w}}}(i===void 0?e.specification.default:i,e.specification,r,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class rs{constructor(e,i,r){this.property=e,this.value=new sc(e,void 0,i,r)}transitioned(e,i){return new eg(this.property,this.value,i,Te({},e.transition,this.transition),e.now)}untransitioned(){return new eg(this.property,this.value,null,{},0)}}class Qf{constructor(e,i,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=r,this.configDependencies=new Set}getValue(e){return Zt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new rs(this._values[e].property,this._scope,this._options)),this._values[e].value=new sc(this._values[e].property,i===null?void 0:Zt(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const r=this._properties.properties;if(e)for(const s in e){const h=e[s];if(s.endsWith("-transition")){const d=s.slice(0,-11);r[d]&&this.setTransition(d,h)}else r.hasOwnProperty(s)&&this.setValue(s,h)}}getTransition(e){return Zt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new rs(this._values[e].property)),this._values[e].transition=Zt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const s=this.getTransition(i);s!==void 0&&(e[`${i}-transition`]=s)}return e}transitioned(e,i){const r=new tg(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].transitioned(e,i._values[s]);return r}untransitioned(){const e=new tg(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class eg{constructor(e,i,r,s,h){const d=s.delay||0,g=s.duration||0;h=h||0,this.property=e,this.value=i,this.begin=h+d,this.end=this.begin+g,e.specification.transition&&(s.delay||s.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const s=e.now||0,h=this.value.possiblyEvaluate(e,i,r),d=this.prior;if(d){if(s>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(s<this.begin)return d.possiblyEvaluate(e,i,r);{const g=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,r),h,G(g))}}return h}}class tg{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const s=new qs(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].possiblyEvaluate(e,i,r);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class u1{constructor(e,i,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=r,this.configDependencies=new Set}getValue(e){return Zt(this._values[e].value)}setValue(e,i){this._values[e]=new sc(this._values[e].property,i===null?void 0:Zt(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const s=new qs(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].possiblyEvaluate(e,i,r);return s}}class Fl{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,s){return this.property.evaluate(this.value,this.parameters,e,i,r,s)}}class qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Qe{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const s=Ou[this.specification.type];return s?s(e,i,r):e}}class mt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,s){return new Fl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,s)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Fl(this,{kind:"constant",value:void 0},e.parameters);const s=Ou[this.specification.type];return s?new Fl(this,{kind:"constant",value:s(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,s,h,d){return e.kind==="constant"?e.value:e.evaluate(i,r,s,h,d)}}class Gs{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,s){return!!e.expression.evaluate(i,null,{},r,s)}interpolate(){return!1}}class Cn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Yi(0,{});for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new sc(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new rs(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate(i)}}}yt(mt,"DataDrivenProperty"),yt(Qe,"DataConstantProperty"),yt(Gs,"ColorRampProperty");var ve=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function $r(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function zh(n){if(Array.isArray(n))return n.map(zh);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=zh(n[i]);return e}return $r(n)}function Lh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Lh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Mp(n,e="",i=null,r="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lh(n)||(n=Rh(n));const s=n;let h=!0;try{h=function(k){if(!Ol(k))return k;let A=zh(k);return ng(A),A=ig(A),A}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}let d=null,g=null;if(r!=="background"&&r!=="sky"&&r!=="slot"){g=ve[`filter_${r}`];const k=xo(h,g,e,i);if(k.result==="error")throw new Error(k.value.map(A=>`${A.key}: ${A.message}`).join(", "));d=(A,S,E)=>k.value.evaluate(A,S,{},E)}let y=null,w=null;if(h!==s){const k=xo(s,g,e,i);if(k.result==="error")throw new Error(k.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,S,E,D,R)=>k.value.evaluate(A,S,{},E,void 0,void 0,D,R),w=!Dl(k.value.expression)}return{filter:d,dynamicFilter:y||void 0,needGeometry:ag(h),needFeature:!!w}}function ig(n){if(!Array.isArray(n))return n;const e=function(i){if(c1.has(i[0])){for(let r=1;r<i.length;r++)if(Ol(i[r]))return!0}return i}(n);return e===!0?e:e.map(i=>ig(i))}function ng(n){let e=!1;const i=[];if(n[0]==="case"){for(let r=1;r<n.length-1;r+=2)e=e||Ol(n[r]),i.push(n[r+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Ol(n[1]);for(let r=2;r<n.length-1;r+=2)i.push(n[r+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Ol(n[1]);for(let r=1;r<n.length-1;r+=2)i.push(n[r+1])}e&&(n.length=0,n.push("any",...i));for(let r=1;r<n.length;r++)ng(n[r])}function Ol(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Ol(n[i]))return!0;return!1}const c1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function h1(n,e){return n<e?-1:n>e?1:0}function ag(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(ag(n[e]))return!0;return!1}function Rh(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Ep(n[1],n[2],"=="):e==="!="?Bh(Ep(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ep(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Rh))):e==="all"?["all"].concat(n.slice(1).map(Rh)):e==="none"?["all"].concat(n.slice(1).map(Rh).map(Bh)):e==="in"?Cp(n[1],n.slice(2)):e==="!in"?Bh(Cp(n[1],n.slice(2))):e==="has"?rg(n[1]):e!=="!has"||Bh(rg(n[1]));var i}function Ep(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Cp(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(h1)]]:["filter-in-small",n,["literal",e]]}}function rg(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Bh(n){return["!",n]}const lc="";function Ys(n,e){return e?`${n}${lc}${e}`:n}const Dp="-transition",os=new Set(["fill","line","background","hillshade","raster"]);class Pa extends zs{constructor(e,i,r,s,h){if(super(),this.id=e.id,this.fqid=Ys(this.id,r),this.type=e.type,this.scope=r,this.lut=s,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=xo(this.filter,ve[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new u1(i.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Qf(i.paint,this.scope,h);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qs(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&os.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...r.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Dp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const r=this._transitionablePaint,s=r._properties.properties;if(e.endsWith(Dp)){const A=e.slice(0,-11);return s[A]&&r.setTransition(A,i||void 0),!1}if(!s[e])return!1;const h=r._values[e],d=h.value.isDataDriven(),g=h.value;r.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...r.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const y=r._values[e].value,w=y.isDataDriven(),k=e.endsWith("pattern")||e==="line-dasharray";return w||d||k||this._handleOverridablePaintPropertyUpdate(e,g,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,r){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return qt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Fl&&tc(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Mp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,r,s,h,d,g,y,w){}}const d1={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class uc{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ei(n,e=1){let i=0,r=0;return{members:n.map(s=>{const h=d1[s.type].BYTES_PER_ELEMENT,d=i=Ip(i,Math.max(e,h)),g=s.components||1;return r=Math.max(r,h),i+=h*g,{name:s.name,type:s.type,components:g,offset:d}}),size:Ip(i,Math.max(r,e)),alignment:e}}function Ip(n,e){return Math.ceil(n/e)*e}class Po extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.int16[s+0]=i,this.int16[s+1]=r,e}}Po.prototype.bytesPerElement=4,yt(Po,"StructArrayLayout2i4");class cc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.int16[h+2]=s,e}}cc.prototype.bytesPerElement=6,yt(cc,"StructArrayLayout3i6");class $l extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,s)}emplace(e,i,r,s,h){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=r,this.int16[d+2]=s,this.int16[d+3]=h,e}}$l.prototype.bytesPerElement=8,yt($l,"StructArrayLayout4i8");class ss extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ss.prototype.bytesPerElement=4,yt(ss,"StructArrayLayout1f4");class zp extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const h=4*e,d=2*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.float32[d+1]=s,e}}zp.prototype.bytesPerElement=8,yt(zp,"StructArrayLayout2i1f8");class Wh extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.int16[h+2]=s,e}}Wh.prototype.bytesPerElement=8,yt(Wh,"StructArrayLayout3i8");class jl extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,s,h)}emplace(e,i,r,s,h,d){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=s,this.int16[g+3]=h,this.int16[g+4]=d,e}}jl.prototype.bytesPerElement=10,yt(jl,"StructArrayLayout5i10");class Lp extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,r,s,h,d,g)}emplace(e,i,r,s,h,d,g,y){const w=6*e,k=12*e,A=3*e;return this.int16[w+0]=i,this.int16[w+1]=r,this.uint8[k+4]=s,this.uint8[k+5]=h,this.uint8[k+6]=d,this.uint8[k+7]=g,this.float32[A+2]=y,e}}Lp.prototype.bytesPerElement=12,yt(Lp,"StructArrayLayout2i4ub1f12");class to extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=r,this.float32[h+2]=s,e}}to.prototype.bytesPerElement=12,yt(to,"StructArrayLayout3f12");class ls extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,s,h)}emplace(e,i,r,s,h,d){const g=6*e,y=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=r,this.uint16[g+2]=s,this.uint16[g+3]=h,this.float32[y+2]=d,e}}ls.prototype.bytesPerElement=12,yt(ls,"StructArrayLayout4ui1f12");class hc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,s)}emplace(e,i,r,s,h){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=r,this.uint16[d+2]=s,this.uint16[d+3]=h,e}}hc.prototype.bytesPerElement=8,yt(hc,"StructArrayLayout4ui8");class Nh extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,s,h,d)}emplace(e,i,r,s,h,d,g){const y=6*e;return this.int16[y+0]=i,this.int16[y+1]=r,this.int16[y+2]=s,this.int16[y+3]=h,this.int16[y+4]=d,this.int16[y+5]=g,e}}Nh.prototype.bytesPerElement=12,yt(Nh,"StructArrayLayout6i12");class Vl extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w,k,A,S){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,r,s,h,d,g,y,w,k,A,S)}emplace(e,i,r,s,h,d,g,y,w,k,A,S,E){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=r,this.int16[D+2]=s,this.int16[D+3]=h,this.uint16[D+4]=d,this.uint16[D+5]=g,this.uint16[D+6]=y,this.uint16[D+7]=w,this.int16[D+8]=k,this.int16[D+9]=A,this.int16[D+10]=S,this.int16[D+11]=E,e}}Vl.prototype.bytesPerElement=24,yt(Vl,"StructArrayLayout4i4ui4i24");class Ul extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,s,h,d)}emplace(e,i,r,s,h,d,g){const y=10*e,w=5*e;return this.int16[y+0]=i,this.int16[y+1]=r,this.int16[y+2]=s,this.float32[w+2]=h,this.float32[w+3]=d,this.float32[w+4]=g,e}}Ul.prototype.bytesPerElement=20,yt(Ul,"StructArrayLayout3i3f20");class ma extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,s)}emplace(e,i,r,s,h){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=r,this.float32[d+2]=s,this.float32[d+3]=h,e}}ma.prototype.bytesPerElement=16,yt(ma,"StructArrayLayout4f16");class Jl extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Jl.prototype.bytesPerElement=4,yt(Jl,"StructArrayLayout1ul4");class us extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.uint16[s+0]=i,this.uint16[s+1]=r,e}}us.prototype.bytesPerElement=4,yt(us,"StructArrayLayout2ui4");class Rp extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w,k,A,S,E){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,r,s,h,d,g,y,w,k,A,S,E)}emplace(e,i,r,s,h,d,g,y,w,k,A,S,E,D){const R=20*e,F=10*e;return this.int16[R+0]=i,this.int16[R+1]=r,this.int16[R+2]=s,this.int16[R+3]=h,this.int16[R+4]=d,this.float32[F+3]=g,this.float32[F+4]=y,this.float32[F+5]=w,this.float32[F+6]=k,this.int16[R+14]=A,this.uint32[F+8]=S,this.uint16[R+18]=E,this.uint16[R+19]=D,e}}Rp.prototype.bytesPerElement=40,yt(Rp,"StructArrayLayout5i4f1i1ul2ui40");class Fh extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,r,s,h,d,g)}emplace(e,i,r,s,h,d,g,y){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=r,this.int16[w+2]=s,this.int16[w+4]=h,this.int16[w+5]=d,this.int16[w+6]=g,this.int16[w+7]=y,e}}Fh.prototype.bytesPerElement=16,yt(Fh,"StructArrayLayout3i2i2i16");class Bp extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,s,h)}emplace(e,i,r,s,h,d){const g=4*e,y=8*e;return this.float32[g+0]=i,this.float32[g+1]=r,this.float32[g+2]=s,this.int16[y+6]=h,this.int16[y+7]=d,e}}Bp.prototype.bytesPerElement=16,yt(Bp,"StructArrayLayout2f1f2i16");class dc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,s,h,d)}emplace(e,i,r,s,h,d,g){const y=20*e,w=5*e;return this.uint8[y+0]=i,this.uint8[y+1]=r,this.float32[w+1]=s,this.float32[w+2]=h,this.float32[w+3]=d,this.float32[w+4]=g,e}}dc.prototype.bytesPerElement=20,yt(dc,"StructArrayLayout2ub4f20");class fa extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=r,this.uint16[h+2]=s,e}}fa.prototype.bytesPerElement=6,yt(fa,"StructArrayLayout3ui6");class pc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H,W,J){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H,W,J)}emplace(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H,W,J,Z){const ee=30*e,pe=15*e,ce=60*e;return this.int16[ee+0]=i,this.int16[ee+1]=r,this.int16[ee+2]=s,this.float32[pe+2]=h,this.float32[pe+3]=d,this.uint16[ee+8]=g,this.uint16[ee+9]=y,this.uint32[pe+5]=w,this.uint32[pe+6]=k,this.uint32[pe+7]=A,this.uint16[ee+16]=S,this.uint16[ee+17]=E,this.uint16[ee+18]=D,this.float32[pe+10]=R,this.float32[pe+11]=F,this.uint8[ce+48]=j,this.uint8[ce+49]=Y,this.uint8[ce+50]=H,this.uint32[pe+13]=W,this.int16[ee+28]=J,this.uint8[ce+58]=Z,e}}pc.prototype.bytesPerElement=60,yt(pc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wp extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H,W,J,Z,ee,pe,ce,me,we,Le,Ze,Ve,Ye,Ke,Be){const qe=this.length;return this.resize(qe+1),this.emplace(qe,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H,W,J,Z,ee,pe,ce,me,we,Le,Ze,Ve,Ye,Ke,Be)}emplace(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H,W,J,Z,ee,pe,ce,me,we,Le,Ze,Ve,Ye,Ke,Be,qe){const De=20*e,Re=40*e,tt=80*e;return this.float32[De+0]=i,this.float32[De+1]=r,this.int16[Re+4]=s,this.int16[Re+5]=h,this.int16[Re+6]=d,this.int16[Re+7]=g,this.int16[Re+8]=y,this.int16[Re+9]=w,this.int16[Re+10]=k,this.int16[Re+11]=A,this.int16[Re+12]=S,this.uint16[Re+13]=E,this.uint16[Re+14]=D,this.uint16[Re+15]=R,this.uint16[Re+16]=F,this.uint16[Re+17]=j,this.uint16[Re+18]=Y,this.uint16[Re+19]=H,this.uint16[Re+20]=W,this.uint16[Re+21]=J,this.uint16[Re+22]=Z,this.uint16[Re+23]=ee,this.uint16[Re+24]=pe,this.uint16[Re+25]=ce,this.uint16[Re+26]=me,this.uint16[Re+27]=we,this.uint32[De+14]=Le,this.float32[De+15]=Ze,this.float32[De+16]=Ve,this.float32[De+17]=Ye,this.float32[De+18]=Ke,this.uint8[tt+76]=Be,this.uint16[Re+39]=qe,e}}Wp.prototype.bytesPerElement=80,yt(Wp,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Np extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,s,h,d)}emplace(e,i,r,s,h,d,g){const y=6*e;return this.float32[y+0]=i,this.float32[y+1]=r,this.float32[y+2]=s,this.float32[y+3]=h,this.float32[y+4]=d,this.float32[y+5]=g,e}}Np.prototype.bytesPerElement=24,yt(Np,"StructArrayLayout6f24");class cs extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,s,h)}emplace(e,i,r,s,h,d){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=r,this.float32[g+2]=s,this.float32[g+3]=h,this.float32[g+4]=d,e}}cs.prototype.bytesPerElement=20,yt(cs,"StructArrayLayout5f20");class mc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,r,s,h,d,g)}emplace(e,i,r,s,h,d,g,y){const w=7*e;return this.float32[w+0]=i,this.float32[w+1]=r,this.float32[w+2]=s,this.float32[w+3]=h,this.float32[w+4]=d,this.float32[w+5]=g,this.float32[w+6]=y,e}}mc.prototype.bytesPerElement=28,yt(mc,"StructArrayLayout7f28");class Fp extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w,k,A){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,r,s,h,d,g,y,w,k,A)}emplace(e,i,r,s,h,d,g,y,w,k,A,S){const E=11*e;return this.float32[E+0]=i,this.float32[E+1]=r,this.float32[E+2]=s,this.float32[E+3]=h,this.float32[E+4]=d,this.float32[E+5]=g,this.float32[E+6]=y,this.float32[E+7]=w,this.float32[E+8]=k,this.float32[E+9]=A,this.float32[E+10]=S,e}}Fp.prototype.bytesPerElement=44,yt(Fp,"StructArrayLayout11f44");class Oh extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,r,s,h,d,g,y,w)}emplace(e,i,r,s,h,d,g,y,w,k){const A=9*e;return this.float32[A+0]=i,this.float32[A+1]=r,this.float32[A+2]=s,this.float32[A+3]=h,this.float32[A+4]=d,this.float32[A+5]=g,this.float32[A+6]=y,this.float32[A+7]=w,this.float32[A+8]=k,e}}Oh.prototype.bytesPerElement=36,yt(Oh,"StructArrayLayout9f36");class Hs extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.float32[s+0]=i,this.float32[s+1]=r,e}}Hs.prototype.bytesPerElement=8,yt(Hs,"StructArrayLayout2f8");class Op extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,s)}emplace(e,i,r,s,h){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=r,this.uint16[d+3]=s,this.uint16[d+4]=h,e}}Op.prototype.bytesPerElement=12,yt(Op,"StructArrayLayout1ul3ui12");class fc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}fc.prototype.bytesPerElement=2,yt(fc,"StructArrayLayout1ui2");class ql extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F)}emplace(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j){const Y=16*e;return this.float32[Y+0]=i,this.float32[Y+1]=r,this.float32[Y+2]=s,this.float32[Y+3]=h,this.float32[Y+4]=d,this.float32[Y+5]=g,this.float32[Y+6]=y,this.float32[Y+7]=w,this.float32[Y+8]=k,this.float32[Y+9]=A,this.float32[Y+10]=S,this.float32[Y+11]=E,this.float32[Y+12]=D,this.float32[Y+13]=R,this.float32[Y+14]=F,this.float32[Y+15]=j,e}}ql.prototype.bytesPerElement=64,yt(ql,"StructArrayLayout16f64");class gc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,h,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,r,s,h,d,g)}emplace(e,i,r,s,h,d,g,y){const w=10*e,k=5*e;return this.uint16[w+0]=i,this.uint16[w+1]=r,this.uint16[w+2]=s,this.uint16[w+3]=h,this.float32[k+2]=d,this.float32[k+3]=g,this.float32[k+4]=y,e}}gc.prototype.bytesPerElement=20,yt(gc,"StructArrayLayout4ui3f20");class $p extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}$p.prototype.bytesPerElement=2,yt($p,"StructArrayLayout1i2");class $h extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}$h.prototype.bytesPerElement=1,yt($h,"StructArrayLayout1ub1");class og extends uc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}og.prototype.size=40;class jh extends Rp{get(e){return new og(this,e)}}yt(jh,"CollisionBoxArray");class sg extends uc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}sg.prototype.size=60;class lg extends pc{get(e){return new sg(this,e)}}yt(lg,"PlacedSymbolArray");class ug extends uc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ug.prototype.size=80;class cg extends Wp{get(e){return new ug(this,e)}}yt(cg,"SymbolInstanceArray");class jp extends ss{getoffsetX(e){return this.float32[1*e+0]}}yt(jp,"GlyphOffsetArray");class hg extends Po{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}yt(hg,"SymbolLineVertexArray");class dg extends uc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}dg.prototype.size=12;class pg extends Op{get(e){return new dg(this,e)}}yt(pg,"FeatureIndexArray");class mg extends us{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}yt(mg,"FillExtrusionCentroidArray");class fg extends uc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}fg.prototype.size=6;class gg extends cc{get(e){return new fg(this,e)}}yt(gg,"FillExtrusionWallArray");const p1=Ei([{name:"a_pos",components:2,type:"Int16"}],4),m1=Ei([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Vh=Ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class In{constructor(e=[]){this.segments=e}_prepareSegment(e,i,r,s){let h=this.segments[this.segments.length-1];return e>In.MAX_VERTEX_ARRAY_LENGTH&&ai(`Max vertices per segment is ${In.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>In.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==s)&&(h={vertexOffset:i,primitiveOffset:r,vertexLength:0,primitiveLength:0},s!==void 0&&(h.sortKey=s),this.segments.push(h)),h}prepareSegment(e,i,r,s){return this._prepareSegment(e,i.length,r.length,s)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,s){return new In([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:s,vaos:{},sortKey:0}])}}function _g(n,e){return 256*(n=oe(Math.floor(n),0,255))+oe(Math.floor(e),0,255)}In.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt(In,"SegmentVector");const Uh=Ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vp=Ei([{name:"a_pattern_b",components:4,type:"Uint16"}]),yg=Ei([{name:"a_dash",components:4,type:"Uint16"}]);class _c{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,r,s){this.ids.push(Up(e)),this.positions.push(i,r,s)}eachPosition(e,i){const r=Up(e);let s=0,h=this.ids.length-1;for(;s<h;){const d=s+h>>1;this.ids[d]>=r?h=d:s=d+1}for(;this.ids[s]===r;)i(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,i){const r=new Float64Array(e.ids),s=new Uint32Array(e.positions);return Jh(r,s,0,r.length-1),i&&(i.add(r.buffer),i.add(s.buffer)),{ids:r,positions:s}}static deserialize(e){const i=new _c;let r;i.ids=e.ids,i.positions=e.positions;for(const s of i.ids)s!==r&&i.uniqueIds.push(s),r=s;return i.indexed=!0,i}}function Up(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Fu(String(n))}function Jh(n,e,i,r){for(;i<r;){const s=n[i+r>>1];let h=i-1,d=r+1;for(;;){do h++;while(n[h]<s);do d--;while(n[d]>s);if(h>=d)break;yc(n,h,d),yc(e,3*h,3*d),yc(e,3*h+1,3*d+1),yc(e,3*h+2,3*d+2)}d-i<r-d?(Jh(n,e,i,d),i=d+1):(Jh(n,e,d+1,r),r=d)}}function yc(n,e,i){const r=n[e];n[e]=n[i],n[i]=r}yt(_c,"FeaturePositionMap");class Mo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,r){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class qh extends Mo{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class $n extends Mo{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class io extends Mo{constructor(e){super(e),this.current=[0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class wc extends Mo{constructor(e){super(e),this.current=[0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Gh extends Mo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class wg extends Mo{constructor(e){super(e),this.current=Bi.transparent.toPremultipliedRenderColor(null)}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const f1=new Float32Array(16);class Gl extends Mo{constructor(e){super(e),this.current=f1}set(e,i,r){if(this.fetchUniformLocation(e,i)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let s=1;s<16;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Jp=new Float32Array(9),no=new Float32Array(4);class bc extends Mo{constructor(e){super(e),this.current=no}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let s=0;s<4;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function qp(n){return[_g(255*n.r,255*n.g),_g(255*n.b,255*n.a)]}class vc{constructor(e,i,r,s){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=r,this.context=s}setUniform(e,i,r,s,h){const d=s.constantOr(this.value);i.set(e,h,d instanceof Bi?d.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new wg(e):new $n(e)}}class Yl{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,r,s,h){let d=null;h!=="u_pattern"&&h!=="u_dash"||(d=this.pattern),h==="u_pattern_b"&&(d=this.patternTransition),h==="u_pixel_ratio"&&(d=this.pixelRatio),d&&i.set(e,h,d)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Gh(e):new $n(e)}}class Eo{constructor(e,i,r,s){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,i,r,s,h,d,g,y){const w=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Yi(0,{brightness:d,worldview:y}),i,{},h,s,g):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Yi(0,{brightness:d,worldview:y}),i,{},h,s,g):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(w,e,k,A?null:this.context.lut)}updatePaintArray(e,i,r,s,h,d,g,y){const w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g,worldview:y},r,s,void 0,h):this.expression.kind==="constant"&&this.expression.value,k=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Yi(0,{brightness:g,worldview:y}),r,s,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(e,i,w,k?null:this.context.lut)}_setPaintValue(e,i,r,s){if(this.type==="color"){const h=qp(r.toPremultipliedRenderColor(s));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jr{constructor(e,i,r,s,h,d){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=r,this.useIntegerZoom=s,this.context=h,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,r,s,h,d,g,y){const w=this.expression.evaluate(new Yi(this.context.zoom,{brightness:d,worldview:y}),i,{},h,s,g),k=this.expression.evaluate(new Yi(this.context.zoom+1,{brightness:d,worldview:y}),i,{},h,s,g),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Yi(0,{brightness:d,worldview:y}),i,{},h,s,g):this.lutExpression.value)==="none",S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,w,k,A?null:this.context.lut)}updatePaintArray(e,i,r,s,h,d,g,y){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:g,worldview:y},r,s,void 0,h),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g,worldview:y},r,s,void 0,h),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Yi(0,{brightness:g,worldview:y}),r,s,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(e,i,w,k,A?null:this.context.lut)}_setPaintValue(e,i,r,s,h){if(this.type==="color"){const d=qp(r.toPremultipliedRenderColor(h)),g=qp(r.toPremultipliedRenderColor(h));for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],g[0],g[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,r,s);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,s,h){const d=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,g=oe(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,h,g)}getBinding(e,i){return new $n(e)}}class Pr{constructor(e,i,r,s,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(r==="array"?yg:Uh).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new s,this.paintTransitionVertexArray=new hc}populatePaintArray(e,i,r,s){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,s,h,d,g){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],d)}_setPaintValues(e,i,r,s){if(!s||!r)return;const h=s[r[0]],d=s[r[1]];if(h){if(h){const{tl:g,br:y,pixelRatio:w}=h;for(let k=e;k<i;k++)this.paintVertexArray.emplace(k,g[0],g[1],y[0],y[1],w)}if(d){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:g,br:y}=d;for(let w=e;w<i;w++)this.paintTransitionVertexArray.emplace(w,g[0],g[1],y[0],y[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Vp.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Hl{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[],this.context=i;const s=[];for(const h in e.paint._values){const d=e.paint.get(h);if(h.endsWith("-use-theme")||!r(h)||!(d instanceof Fl&&tc(d.property.specification)))continue;const g=a(h,e.type),y=d.value,w=d.property.specification.type,k=!!d.property.useIntegerZoom,A=h==="line-dasharray"||h.endsWith("pattern"),S=e.paint.get(`${h}-use-theme`),E=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||S&&S.value.kind!=="constant";if(y.kind!=="constant"||E)if(y.kind==="source"||E||A){const D=f(h,w,"source");this.binders[h]=A?new Pr(y,g,w,D,e.id):new Eo(y,g,w,D),s.push(`/a_${h}`)}else{const D=f(h,w,"composite");this.binders[h]=new jr(y,g,w,k,i,D),s.push(`/z_${h}`)}else this.binders[h]=A?new Yl(y.value,g):new vc(y.value,g,w,i),s.push(`/u_${h}`);S&&(this.binders[h].lutExpression=S.value)}this.cacheKey=s.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Eo||i instanceof jr?i.maxValue:0}populatePaintArrays(e,i,r,s,h,d,g,y){for(const w in this.binders){const k=this.binders[w];k.context=this.context,(k instanceof Eo||k instanceof jr||k instanceof Pr)&&k.populatePaintArray(e,i,r,s,h,d,g,y)}}setConstantPatternPositions(e,i){for(const r in this.binders){const s=this.binders[r];s instanceof Yl&&s.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Pr?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,r,s,h,d,g,y,w,k){let A=!1;const S=Object.keys(e),E=S.length!==0&&!y,D=E?S:i.uniqueIds;this.context.lut=h.lut;for(const R in this.binders){const F=this.binders[R];if(F.context=this.context,(F instanceof Eo||F instanceof jr||F instanceof Pr)&&F.expression&&F.expression.kind&&F.expression.kind!=="constant"&&(F.expression.isStateDependent===!0||F.expression.isLightConstant===!1)){const j=h.paint.get(R);F.expression=j.value;for(const Y of D){const H=e[Y.toString()];i.eachPosition(Y,(W,J,Z)=>{const ee=s.feature(W);F.updatePaintArray(J,Z,ee,H,d,g,w,k)})}if(!E)for(const Y of r.uniqueIds){const H=e[Y.toString()];r.eachPosition(Y,(W,J,Z)=>{const ee=s.feature(W);F.updatePaintArray(J,Z,ee,H,d,g,w,k)})}A=!0}}return A}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof vc||r instanceof Yl)&&e.push(...r.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Eo||r instanceof jr||r instanceof Pr)for(let s=0;s<r.paintVertexAttributes.length;s++)e.push(r.paintVertexAttributes[s].name);if(r instanceof Pr)for(let s=0;s<Vp.members.length;s++)e.push(Vp.members[s].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof vc||r instanceof Yl||r instanceof jr)for(const s of r.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof vc||s instanceof Yl||s instanceof jr)for(const h of s.uniformNames)i.push({name:h,property:r,binding:s.getBinding(e,h)})}return i}setUniforms(e,i,r,s,h){for(const{name:d,property:g,binding:y}of r)this.binders[g].setUniform(e,y,h,s.get(g),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Eo||i instanceof jr||i instanceof Pr)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Pr&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof Eo||r instanceof jr||r instanceof Pr)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Eo||i instanceof jr||i instanceof Pr)&&i.destroy()}}}class l{constructor(e,i,r=()=>!0){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new Hl(s,i,r);this.needsUpload=!1,this._featureMap=new _c,this._featureMapWithoutIds=new _c,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,r,s,h,d,g,y,w){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(e,i,s,h,d,g,y,w);i.id!==void 0?this._featureMap.add(i.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,s,h,d,g,y){for(const w of r)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,w,s,h,d,g||0,y)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function a(n,e){return t[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const u={"line-pattern":{source:ls,composite:ls},"fill-pattern":{source:ls,composite:ls},"fill-extrusion-pattern":{source:ls,composite:ls},"line-dasharray":{source:hc,composite:hc}},p={color:{source:Hs,composite:ma},number:{source:ss,composite:Hs}};function f(n,e,i){const r=u[n];return r&&r[i]||p[e][i]}yt(vc,"ConstantBinder"),yt(Yl,"PatternConstantBinder"),yt(Eo,"SourceExpressionBinder"),yt(Pr,"PatternCompositeBinder"),yt(jr,"CompositeExpressionBinder"),yt(Hl,"ProgramConfiguration",{omit:["_buffers"]}),yt(l,"ProgramConfigurationSet");const _=lt/Math.PI/2,b=5,x=6,T=16383,M=64,I=[M,32,16],C=-_,z=_;function O(n,e,i,r=_){return i=Ci(i),[n*Math.sin(i)*r,-e*r,n*Math.cos(i)*r]}function N(n,e,i){return O(Math.cos(Ci(n)),Math.sin(Ci(n)),e,i)}const $=63710088e-1,U=2*Math.PI*$;class q{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new q(Se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,s=e.lat*i,h=Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos((e.lng-this.lng)*i);return $*Math.acos(Math.min(h,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Q({lng:this.lng-r,lat:this.lat-i},{lng:this.lng+r,lat:this.lat+i})}toEcef(e){return N(this.lat,this.lng,_+e*_/$)}static convert(e){if(e instanceof q)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new q(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new q(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Q{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const r=e;this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]])}else{const r=e;this.setSouthWest(r[0]).setNorthEast(r[1])}}setNorthEast(e){return this._ne=e instanceof q?new q(e.lng,e.lat):q.convert(e),this}setSouthWest(e){return this._sw=e instanceof q?new q(e.lng,e.lat):q.convert(e),this}extend(e){const i=this._sw,r=this._ne;let s,h;if(e instanceof q)s=e,h=e;else{if(!(e instanceof Q))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Q.convert(e)):this.extend(q.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(q.convert(e)):this;if(s=e._sw,h=e._ne,!s||!h)return this}return i||r?(i.lng=Math.min(s.lng,i.lng),i.lat=Math.min(s.lat,i.lat),r.lng=Math.max(h.lng,r.lng),r.lat=Math.max(h.lat,r.lat)):(this._sw=new q(s.lng,s.lat),this._ne=new q(h.lng,h.lat)),this}getCenter(){return new q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new q(this.getWest(),this.getNorth())}getSouthEast(){return new q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=q.convert(e);let s=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&s}static convert(e){if(e)return e instanceof Q?e:new Q(e)}}const ne=0,le=25.5;function se(n){return U*Math.cos(n*Math.PI/180)}function re(n){return(180+n)/360}function ae(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ue(n,e){return n/se(e)}function he(n){return 360*n-180}function xe(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ke(n,e){return n*se(xe(e))}const Ne=85.051129;function Fe(n){return Math.cos(Ci(oe(n,-85.051129,Ne)))}function Ge(n,e){const i=oe(e,ne,le),r=Math.pow(2,i);return Fe(n)*U/(512*r)}function be(n){return 1/Math.cos(n*Math.PI/180)}function ze(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/lt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/lt/(1<<n.z)}class fe{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=q.convert(e);return new fe(re(r.lng),ae(r.lat),ue(i,r.lat))}toLngLat(){return new q(he(this.x),xe(this.y))}toAltitude(){return ke(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/U*be(xe(this.y))}}function je(n,e,i,r,s,h,d,g,y){const w=(e+r)/2,k=(i+s)/2,A=new st(w,k);g(A),function(S,E,D,R,F,j){const Y=D-F,H=R-j;return Math.abs((R-E)*Y-(D-S)*H)/Math.hypot(Y,H)}(A.x,A.y,h.x,h.y,d.x,d.y)>=y?(je(n,e,i,w,k,h,A,g,y),je(n,w,k,r,s,A,d,g,y)):n.push(d)}function Pe(n,e,i){let r=n[0],s=r.x,h=r.y;e(r);const d=[r];for(let g=1;g<n.length;g++){const y=n[g],{x:w,y:k}=y;e(y),je(d,s,h,w,k,r,y,e,i),s=w,h=k,r=y}return d}function Je(n,e,i,r){if(r(e,i)){const s=e.add(i)._mult(.5);Je(n,e,s,r),Je(n,s,i,r)}else n.push(i)}function at(n,e){let i=n[0];const r=[i];for(let s=1;s<n.length;s++){const h=n[s];Je(r,i,h,e),i=h}return r}const $e=Math.pow(2,14)-1,it=-$e-1;function wt(n,e){const i=Math.round(n.x*e),r=Math.round(n.y*e);return n.x=oe(i,it,$e),n.y=oe(r,it,$e),(i<n.x||i>n.x+1||r<n.y||r>n.y+1)&&ai("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function bt(n,e,i){const r=n.loadGeometry(),s=n.extent,h=lt/s;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:g,x:y,y:w,projection:k}=i,A=S=>{const E=he((e.x+S.x/s)/d),D=xe((e.y+S.y/s)/d),R=k.project(E,D);S.x=(R.x*g-y)*s,S.y=(R.y*g-w)*s};for(let S=0;S<r.length;S++)if(n.type!==1)r[S]=Pe(r[S],A,1);else{const E=[];for(const D of r[S])D.x<0||D.x>=s||D.y<0||D.y>=s||(A(D),E.push(D));r[S]=E}}for(const d of r)for(const g of d)wt(g,h);return r}function ft(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?bt(n):[]}}var Et,Dt,Rt,Jt,si,Ni,an,ji={};function qi(){if(Dt)return Et;Dt=1;var n=Ts();function e(s,h,d,g,y){this.properties={},this.extent=d,this.type=0,this._pbf=s,this._geometry=-1,this._keys=g,this._values=y,s.readFields(i,this,h)}function i(s,h,d){s==1?h.id=d.readVarint():s==2?function(g,y){for(var w=g.readVarint()+g.pos;g.pos<w;){var k=y._keys[g.readVarint()],A=y._values[g.readVarint()];y.properties[k]=A}}(d,h):s==3?h.type=d.readVarint():s==4&&(h._geometry=d.pos)}function r(s){for(var h,d,g=0,y=0,w=s.length,k=w-1;y<w;k=y++)g+=((d=s[k]).x-(h=s[y]).x)*(h.y+d.y);return g}return Et=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var h,d=s.readVarint()+s.pos,g=1,y=0,w=0,k=0,A=[];s.pos<d;){if(y<=0){var S=s.readVarint();g=7&S,y=S>>3}if(y--,g===1||g===2)w+=s.readSVarint(),k+=s.readSVarint(),g===1&&(h&&A.push(h),h=[]),h.push(new n(w,k));else{if(g!==7)throw new Error("unknown command "+g);h&&h.push(h[0].clone())}}return h&&A.push(h),A},e.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var h=s.readVarint()+s.pos,d=1,g=0,y=0,w=0,k=1/0,A=-1/0,S=1/0,E=-1/0;s.pos<h;){if(g<=0){var D=s.readVarint();d=7&D,g=D>>3}if(g--,d===1||d===2)(y+=s.readSVarint())<k&&(k=y),y>A&&(A=y),(w+=s.readSVarint())<S&&(S=w),w>E&&(E=w);else if(d!==7)throw new Error("unknown command "+d)}return[k,S,A,E]},e.prototype.toGeoJSON=function(s,h,d){var g,y,w=this.extent*Math.pow(2,d),k=this.extent*s,A=this.extent*h,S=this.loadGeometry(),E=e.types[this.type];function D(j){for(var Y=0;Y<j.length;Y++){var H=j[Y];j[Y]=[360*(H.x+k)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+A)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(g=0;g<S.length;g++)R[g]=S[g][0];D(S=R);break;case 2:for(g=0;g<S.length;g++)D(S[g]);break;case 3:for(S=function(j){var Y=j.length;if(Y<=1)return[j];for(var H,W,J=[],Z=0;Z<Y;Z++){var ee=r(j[Z]);ee!==0&&(W===void 0&&(W=ee<0),W===ee<0?(H&&J.push(H),H=[j[Z]]):H.push(j[Z]))}return H&&J.push(H),J}(S),g=0;g<S.length;g++)for(y=0;y<S[g].length;y++)D(S[g][y])}S.length===1?S=S[0]:E="Multi"+E;var F={type:"Feature",geometry:{type:E,coordinates:S},properties:this.properties};return"id"in this&&(F.id=this.id),F},Et}function Fn(){if(Jt)return Rt;Jt=1;var n=qi();function e(r,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(i,this,s),this.length=this._features.length}function i(r,s,h){r===15?s.version=h.readVarint():r===1?s.name=h.readString():r===5?s.extent=h.readVarint():r===2?s._features.push(h.pos):r===3?s._keys.push(h.readString()):r===4&&s._values.push(function(d){for(var g=null,y=d.readVarint()+d.pos;d.pos<y;){var w=d.readVarint()>>3;g=w===1?d.readString():w===2?d.readFloat():w===3?d.readDouble():w===4?d.readVarint64():w===5?d.readVarint():w===6?d.readSVarint():w===7?d.readBoolean():null}return g}(h))}return Rt=e,e.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var s=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,s,this.extent,this._keys,this._values)},Rt}function ei(){return an||(an=1,ji.VectorTile=function(){if(Ni)return si;Ni=1;var n=Fn();function e(i,r,s){if(i===3){var h=new n(s,s.readVarint()+s.pos);h.length&&(r[h.name]=h)}}return si=function(i,r){this.layers=i.readFields(e,{},r)},si}(),ji.VectorTileFeature=qi(),ji.VectorTileLayer=Fn()),ji}var hi=ei();const vi="3d_elevation_id",un="level";class Gn{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,r){return this.get(e,!0,i,r)}optional(e,i,r){return this.get(e,!1,i,r)}success(){return this._valid}get(e,i,r,s){const h=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&h!==void 0&&!Number.isNaN(h)?r(s?s(h):h):i&&(this._valid=!1),this}}class rn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,r){return this.featureFunc(e,i,r)}parseVertex(e,i,r){return this.vertexFunc(e,i,r)}}const zi=new rn((n,e,i)=>n.reset(e).require(vi,r=>{i.id=r}).optional("fixed_height_relative",r=>{i.constantHeight=r},Ti.decodeRelativeHeight).geometry(r=>{i.bounds=r},Qd).success(),(n,e,i)=>n.reset(e).require(vi,r=>{i.id=r}).require("elevation_idx",r=>{i.idx=r}).require("extent",r=>{i.extent=r}).require("height_relative",r=>{i.height=r},Ti.decodeRelativeHeight).geometry(r=>{i.position=r},Ti.getPoint).success()),Dn=new rn((n,e,i)=>n.reset(e).require(vi,r=>{i.id=r}).optional("fixed_height",r=>{i.constantHeight=r},Ti.decodeMetricHeight).geometry(r=>{i.bounds=r},Qd).success(),(n,e,i)=>n.reset(e).require(vi,r=>{i.id=r}).require("elevation_idx",r=>{i.idx=r}).require("extent",r=>{i.extent=r}).require("height",r=>{i.height=r},Ti.decodeMetricHeight).geometry(r=>{i.position=r},Ti.getPoint).success());class Ti{static getPoint(e){return vr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],r=[],s=e.length,h=new Gn;for(let g=0;g<s;g++){const y=e.feature(g),w=y.properties.hasOwnProperty("version")?String(y.properties.version):void 0,k=(d=w)?d==="1.0.1"?Dn:void 0:zi;if(k===void 0){ai(`Unknown elevation feature version number ${w||"(unknown)"}`);continue}const A=y.properties.hasOwnProperty("type")?y.properties.type:void 0;if(A){if(hi.VectorTileFeature.types[y.type]==="Point"&&A==="curve_point"){const S={};k.parseVertex(h,y,S)&&i.push(S)}else if(hi.VectorTileFeature.types[y.type]==="Polygon"&&A==="curve_meta"){const S={};k.parseFeature(h,y,S)&&r.push(S)}}}var d;return{vertices:i,features:r}}}class jn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const s=xn(i,this.dir);if(Math.abs(s)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/s;return r[0]=this.pos[0]+this.dir[0]*h,r[1]=this.pos[1]+this.dir[1]*h,!0}}class cn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const s=An(i,this.dir);if(Math.abs(s)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/s;return r[0]=this.pos[0]+this.dir[0]*h,r[1]=this.pos[1]+this.dir[1]*h,r[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,i,r){if(function(E,D){var R=E[0],F=E[1],j=E[2],Y=D[0],H=D[1],W=D[2];return Math.abs(R-Y)<=_e*Math.max(1,Math.abs(R),Math.abs(Y))&&Math.abs(F-H)<=_e*Math.max(1,Math.abs(F),Math.abs(H))&&Math.abs(j-W)<=_e*Math.max(1,Math.abs(j),Math.abs(W))}(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[s,h,d]=this.dir,g=this.pos[0]-e[0],y=this.pos[1]-e[1],w=this.pos[2]-e[2],k=s*s+h*h+d*d,A=2*(g*s+y*h+w*d),S=A*A-4*k*(g*g+y*y+w*w-i*i);if(S<0){const E=Math.max(-A/2,0),D=g+s*E,R=y+h*E,F=w+d*E,j=Math.hypot(D,R,F);return r[0]=D*i/j,r[1]=R*i/j,r[2]=F*i/j,!1}{const E=(-A-Math.sqrt(S))/(2*k);if(E<0){const D=Math.hypot(g,y,w);return r[0]=g*i/D,r[1]=y*i/D,r[2]=w*i/D,!1}return r[0]=g+s*E,r[1]=y+h*E,r[2]=w+d*E,!0}}}class Qi{constructor(e,i,r,s,h){this.TL=e,this.TR=i,this.BR=r,this.BL=s,this.horizon=h}static fromInvProjectionMatrix(e,i,r){const s=[-1,1,1],h=[1,1,1],d=[1,-1,1],g=[-1,-1,1],y=fn(s,s,e),w=fn(h,h,e),k=fn(d,d,e),A=fn(g,g,e);return new Qi(y,w,k,A,i/r)}}function hn(n,e,i){let r=1/0,s=-1/0;const h=[];for(const d of n){Jn(h,d,e);const g=An(h,i);r=Math.min(r,g),s=Math.max(s,g)}return[r,s]}function Ri(n,e){let i=!0;for(let r=0;r<n.planes.length;r++){const s=n.planes[r];let h=0;for(let d=0;d<e.length;d++)h+=An(s,e[d])+s[3]>=0;if(h===0)return 0;h!==e.length&&(i=!1)}return i?2:1}function zn(n,e){for(const i of n.projections){const r=hn(e,n.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function ga(n,e){let i=0;const r=[0,0,0,0];for(let d=0;d<n.length;d++)r[0]=n[d][0],r[1]=n[d][1],r[2]=n[d][2],r[3]=1,(s=r)[0]*(h=e)[0]+s[1]*h[1]+s[2]*h[2]+s[3]*h[3]>=0&&i++;var s,h;return i}class wn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Di.fromPoints(this.points),this.projections=[],this.frustumEdges=[Jn([],this.points[2],this.points[3]),Jn([],this.points[0],this.points[3]),Jn([],this.points[4],this.points[0]),Jn([],this.points[5],this.points[1]),Jn([],this.points[6],this.points[2]),Jn([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const s=[0,-r[2],r[1]],h=[r[2],0,-r[0]];this.projections.push({axis:s,projection:hn(this.points,this.points[0],s)}),this.projections.push({axis:h,projection:hn(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,i,r,s){const h=Math.pow(2,r),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const k=Ia([],w,e),A=1/k[3]/i*h;return(S=k)[0]=(E=k)[0]*(D=[A,A,s?1/k[3]:A,A])[0],S[1]=E[1]*D[1],S[2]=E[2]*D[2],S[3]=E[3]*D[3],S;var S,E,D}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const k=mn([],Un([],Jn([],d[w[0]],d[w[1]]),Jn([],d[w[2]],d[w[1]]))),A=-An(k,d[w[1]]);return k.concat(A)}),y=[];for(let w=0;w<d.length;w++)y.push([d[w][0],d[w][1],d[w][2]]);return new wn(y,g)}intersectsPrecise(e,i,r){for(let s=0;s<i.length;s++)if(!ga(e,i[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!ga(e,this.planes[s]))return 0;for(const s of r)for(const h of this.frustumEdges){const d=Un([],s,h),g=Ki(d);if(g===0)continue;Ht(d,d,1/g);const y=hn(this.points,this.points[0],d),w=hn(e,this.points[0],d);if(y[0]>w[1]||w[0]>y[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const r=i[3];if(An([i[0],i[1],i[2]],e)+r<0)return!1}return!0}}class Di{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const s of e)jt(i,i,s),bi(r,r,s);return new Di(i,r)}static fromTileIdAndHeight(e,i,r){const s=1<<e.canonical.z,h=e.canonical.x,d=e.canonical.y;return new Di([h/s,d/s,i],[(h+1)/s,(d+1)/s,r])}static applyTransform(e,i){const r=e.getCorners();for(let s=0;s<r.length;++s)fn(r[s],r[s],i);return Di.fromPoints(r)}static applyTransformFast(e,i){const r=[i[12],i[13],i[14]],s=[...r];for(let h=0;h<3;h++)for(let d=0;d<3;d++){const g=i[4*d+h],y=g*e.min[d],w=g*e.max[d];r[h]+=Math.min(y,w),s[h]+=Math.max(y,w)}return new Di(r,s)}static projectAabbCorners(e,i){const r=e.getCorners();for(let s=0;s<r.length;++s)fn(r[s],r[s],i);return r}constructor(e,i){this.min=e,this.max=i,this.center=Ht([],wi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=Bn(this.min),s=Bn(this.max);for(let h=0;h<i.length;h++)r[h]=i[h]?this.min[h]:this.center[h],s[h]=i[h]?this.center[h]:this.max[h];return s[2]=this.max[2],new Di(r,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ri(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ri(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?zn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?zn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}yt(Di,"Aabb");class nr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,r=i[1],s=-i[0],h=(e.extent+1)*this.metersToTile;return[new st(Math.trunc(e.position[0]+r*h),Math.trunc(e.position[1]+s*h)),new st(Math.trunc(e.position[0]-r*h),Math.trunc(e.position[1]-s*h))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ja{constructor(e,i,r,s,h,d){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:r,max:r},this.safeArea=i,this.constantHeight=r,this.constantHeight==null&&(this.constantHeight!=null||s.length!==0)){this.vertices=s,this.edges=h,this.edges=this.edges.filter(g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((y=this.vertices[g.a].position)[0]===(w=this.vertices[g.b].position)[0]&&y[1]===w[1]);var y,w}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const g of this.vertices)this.vertexProps.push({dir:vr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(const g of this.edges){const y=this.vertices[g.a].position,w=this.vertices[g.b].position,k=Jo(ka(),w,y),A=qo(k),S=Ss(ka(),k,1/A);this.edgeProps.push({vec:k,dir:S,len:A});const E=this.vertexProps[g.a].dir,D=this.vertexProps[g.b].dir;As(E,E,S),As(D,D,S)}for(const g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||ml(g.dir,g.dir);this.tessellate(d)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[r,s]=i;return Vt(this.vertices[this.edges[r].a].height,this.vertices[this.edges[r].b].height,s)}computeSlopeNormal(e,i){const r=this.getClosestEdge(e);if(!r)return It(0,0,1);const s=r[0],h=this.edges[s],d=this.edgeProps[s].vec,g=It(d[0],d[1],(this.vertices[h.b].height-this.vertices[h.a].height)*i),y=It(g[1],-g[0],0);Un(y,y,g);const w=Ki(y);return w>0?Ht(y,y,1/w):It(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,r=Number.POSITIVE_INFINITY,s=0;const h=vr(e.x,e.y);for(let d=0;d<this.edges.length;d++){const g=this.edges[d],y=this.edgeProps[d].dir,w=new jn(h,this.edgeProps[d].dir),k=this.vertices[g.a].position,A=this.vertices[g.b].position,S=ka(),E=ka(),D=w.intersectsPlane(k,this.vertexProps[g.a].dir,S),R=w.intersectsPlane(A,this.vertexProps[g.b].dir,E);if(!D||!R)continue;const F=Jo(ka(),E,S),j=Jo(ka(),h,S),Y=xn(F,F),H=Y>0?xn(j,F)/Y:0,W=oe(H,0,1),J=Math.abs((H-W)*this.edgeProps[d].len),Z=Jo(ka(),h,k),ee=J+Math.abs(xn(Z,vr(y[1],-y[0])));ee<r&&(i=d,r=ee,s=W)}return[i,s]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const r=this.edges[i].a,s=this.edges[i].b,{position:h,height:d,extent:g}=this.vertices[r],{position:y,height:w,extent:k}=this.vertices[s],A=this.vertexProps[r].dir,S=this.vertexProps[s].dir,E=It(h[0]/e,h[1]/e,d),D=It(y[0]/e,y[1]/e,w),R=It(A[1],-A[0],0);Ht(R,R,g);const F=It(S[1],-S[0],0);if(Ht(F,F,k),this.distSqLines(It(E[0]+.5*R[0],E[1]+.5*R[1],E[2]+.5*R[2]),It(D[0]-.5*F[0],D[1]-.5*F[1],D[2]-.5*F[2]),It(E[0]-.5*R[0],E[1]-.5*R[1],E[2]-.5*R[2]),It(D[0]+.5*F[0],D[1]+.5*F[1],D[2]+.5*F[2]))<=.0025000000000000005)continue;const j=this.vertices.length,Y=As(ka(),h,y);this.vertices.push({position:Ss(Y,Y,.5),height:.5*(d+w),extent:.5*(g+k)});const H=As(ka(),A,S);this.vertexProps.push({dir:ml(H,H)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:r,b:j}),this.edges.push({a:j,b:s});const W=Jo(ka(),this.vertices[j].position,h),J=qo(W),Z={vec:W,dir:Ss(ka(),W,1/J),len:J};this.edgeProps.push(Z),this.edgeProps.push(Z)}}distSqLines(e,i,r,s){const h=Ui(ci(),i,e),d=Ui(ci(),s,r),g=Ui(ci(),e,r),y=An(h,h),w=An(h,d),k=An(h,g),A=An(d,d),S=An(d,g),E=y*A-w*w;if(E===0){const F=An(g,d)/An(d,d);return Wn(br(ci(),r,s,F),e)}const D=(w*S-k*A)/E,R=(y*S-w*k)/E;return Wn(br(ci(),e,i,D),br(ci(),r,s,R))}}class mr{static parseFrom(e,i){const r=Ti.parse(e);if(!r)return[];let{vertices:s,features:h}=r;const d=1/ze(i);h.sort((k,A)=>k.id-A.id),s.sort((k,A)=>k.id-A.id||k.idx-A.idx),s=s.filter((k,A,S)=>A===S.findIndex(E=>E.id===k.id&&E.idx===k.idx));const g=new Array;let y=0;const w=s.length;for(const k of h){if(k.constantHeight){g.push(new Ja(k.id,k.bounds,k.constantHeight));continue}for(;y!==w&&s[y].id<k.id;)y++;if(y===w||s[y].id!==k.id)continue;const A=new Array,S=new Array,E=y;for(;y!==w&&s[y].id===k.id;){const D=s[y];if(A.push({position:D.position,height:D.height,extent:D.extent}),y!==E&&s[y-1].idx===D.idx-1){const R=y-E;S.push({a:R-1,b:R})}y++}g.push(new Ja(k.id,k.bounds,void 0,A,S,d))}return g}static getElevationFeature(e,i){if(!i)return;const r=+e.properties[vi];return Number.isNaN(r)?void 0:i.find(s=>s.id===r)}}class Vr{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*lt,this.yOffset=(e.y*this.zScale-i.y)*lt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,r){const s=this.constantElevation(i,r);return s??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),r))}computeBiasedHeight(e,i){return i<=0?e:e+i*ge(0,i,e>=0?e:Math.abs(.5*e))}}yt(Ja,"ElevationFeature");class Mr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Po,this.indexArray=new fa,this.segments=new In,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ss),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,r,s){const h=this.layers[0],d=[];let g=null;h.type==="circle"&&(g=h.layout.get("circle-sort-key"));for(const{feature:w,id:k,index:A,sourceLayerIndex:S}of e){const E=this.layers[0]._featureFilter.needGeometry,D=ft(w,E);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview}),D,r))continue;const R=g?g.evaluate(D,{},r):void 0,F={id:k,properties:w.properties,type:w.type,sourceLayerIndex:S,index:A,geometry:E?D.geometry:bt(w,r,s),patterns:{},sortKey:R};d.push(F)}g&&d.sort((w,k)=>w.sortKey-k.sortKey);let y=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new Nh,y=s.projection);for(const w of d){const{geometry:k,index:A,sourceLayerIndex:S}=w,E=e[A].feature;this.addFeature(w,k,A,i.availableImages,r,y,i.brightness,i.elevationFeatures),i.featureIndex.insert(E,k,A,S,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,r,s,h,d,g){this.programConfigurations.updatePaintArrays(e,i,h,r,s,d,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,p1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vh.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,m1.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,r,s,h,d,g,y){let w;this.elevationMode!=="none"&&(w=mr.getElevationFeature(e,y));for(const k of i)for(const A of k){const S=A.x,E=A.y;if(S<0||S>=lt||E<0||E>=lt)continue;if(d){const F=d.projectTilePoint(S,E,h),j=d.upVector(h,S,E);this.addGlobeExtVertex(F,j),this.addGlobeExtVertex(F,j),this.addGlobeExtVertex(F,j),this.addGlobeExtVertex(F,j)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=D.vertexLength;if(this.addCircleVertex(S,E,-1,-1),this.addCircleVertex(S,E,1,-1),this.addCircleVertex(S,E,1,1),this.addCircleVertex(S,E,-1,1),this.elevationMode!=="none"){const F=w?w.pointElevation(new st(S,E)):0;this.hasElevation=this.hasElevation||F!==0;for(let j=0;j<4;j++)this.elevatedLayoutVertexArray.emplaceBack(F)}this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},s,h,g,void 0,this.worldview)}addCircleVertex(e,i,r,s){this.layoutVertexArray.emplaceBack(2*e+(r+1)/2,2*i+(s+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function qa(n,e){for(let i=0;i<n.length;i++)if(ao(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ao(n,e[i]))return!0;return!!xc(n,e)}function hs(n,e,i){return!!ao(n,e)||!!kc(e,n,i)}function Ur(n,e){if(n.length===1)return Hh(e,n[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let s=0;s<r.length;s++)if(ao(n,r[s]))return!0}for(let i=0;i<n.length;i++)if(Hh(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(xc(n,e[i]))return!0;return!1}function ds(n,e,i){if(n.length>1){if(xc(n,e))return!0;for(let r=0;r<e.length;r++)if(kc(e[r],n,i))return!0}for(let r=0;r<n.length;r++)if(kc(n[r],e,i))return!0;return!1}function xc(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const r=n[i],s=n[i+1];for(let h=0;h<e.length-1;h++)if(Gp(r,s,e[h],e[h+1]))return!0}return!1}function Gp(n,e,i,r){return Xi(n,i,r)!==Xi(e,i,r)&&Xi(n,e,i)!==Xi(n,e,r)}function Zl(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Yp(n,e,i,r){const s=Zl(n,e,r),h=Zl(n,e,i);if(Math.sign(s)===Math.sign(h))return;const d=Zl(i,r,n),g=d+h-s;return Math.sign(d)!==Math.sign(g)?[d/(d-g),h/(h-s)]:void 0}function kc(n,e,i){const r=i*i;if(e.length===1)return n.distSqr(e[0])<r;for(let s=1;s<e.length;s++)if(Yh(n,e[s-1],e[s])<r)return!0;return!1}function Yh(n,e,i){const r=e.distSqr(i);if(r===0)return n.distSqr(e);const s=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/r;return n.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function Hh(n,e){let i,r,s,h=!1;for(let d=0;d<n.length;d++){i=n[d];for(let g=0,y=i.length-1;g<i.length;y=g++)r=i[g],s=i[y],r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(h=!h)}return h}function ao(n,e){let i=!1;for(let r=0,s=n.length-1;r<n.length;s=r++){const h=n[r],d=n[s];h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(i=!i)}return i}function Kl(n,e,i,r,s){for(const d of n)if(e<=d.x&&i<=d.y&&r>=d.x&&s>=d.y)return!0;const h=[new st(e,i),new st(e,s),new st(r,s),new st(r,i)];if(n.length>2){for(const d of h)if(ao(n,d))return!0}for(let d=0;d<n.length-1;d++)if(Zs(n[d],n[d+1],h))return!0;return!1}function Zs(n,e,i){const r=i[0],s=i[2];if(n.x<r.x&&e.x<r.x||n.x>s.x&&e.x>s.x||n.y<r.y&&e.y<r.y||n.y>s.y&&e.y>s.y)return!1;const h=Xi(n,e,i[0]);return h!==Xi(n,e,i[1])||h!==Xi(n,e,i[2])||h!==Xi(n,e,i[3])}function ps(n,e,i,r,s,h){let d=e.y-n.y,g=n.x-e.x;if(h=h||0){const y=d*d+g*g;if(y===0)return!0;const w=Math.sqrt(y);d/=w,g/=w}return!((i.x-n.x)*d+(i.y-n.y)*g-h<0||(r.x-n.x)*d+(r.y-n.y)*g-h<0||(s.x-n.x)*d+(s.y-n.y)*g-h<0)}function g1(n,e,i,r,s,h,d){return!(ps(n,e,r,s,h,d)||ps(e,i,r,s,h,d)||ps(i,n,r,s,h,d)||ps(r,s,n,e,i,d)||ps(s,h,n,e,i,d)||ps(h,r,n,e,i,d))}function Zh(n,e,i){const r=e.paint.get(n).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(n)}function bg(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Jb(n,e,i,r,s){if(!e[0]&&!e[1])return n;const h=st.convert(e)._mult(s);i==="viewport"&&h._rotate(-r);const d=[];for(let g=0;g<n.length;g++)d.push(n[g].sub(h));return d}function qb(n,e,i,r){const s=st.convert(n)._mult(r);return e==="viewport"&&s._rotate(-i),s}let Gb,Yb;function Hb(n,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[n*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}yt(Mr,"CircleBucket",{omit:["layers"]});class Ac{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=Kh(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=function(h,d,g){var y=Hb(256*h,256*(d=Math.pow(2,g)-d-1),g),w=Hb(256*(h+1),256*(d+1),g);return y[0]+","+y[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),s=function(h,d,g){let y,w="";for(let k=h;k>0;k--)y=1<<k-1,w+=(d&y?1:0)+(g&y?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zb{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Kh(e,i.z,i.z,i.x,i.y)}}class Na{constructor(e,i,r,s,h){this.overscaledZ=e,this.wrap=i,this.canonical=new Ac(r,+s,+h),this.key=i===0&&e===r?this.canonical.key:Kh(i,e,r,s,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Na(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Na(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Kh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Kh(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Na(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,s=2*this.canonical.y;return[new Na(i,this.wrap,i,r,s),new Na(i,this.wrap,i,r+1,s),new Na(i,this.wrap,i,r,s+1),new Na(i,this.wrap,i,r+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Na(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Na(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Kh(n,e,i,r,s){const h=1<<Math.min(i,22);let d=h*(s%h)+r%h;return n&&i<22&&(d+=h*h*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const s5=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Na(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Na(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Na(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Na(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];yt(Ac,"CanonicalTileID"),yt(Na,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const l5=Ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vg}=l5,u5=Ei([{name:"a_pos_3",components:3,type:"Int16"}]);var Kb=Ei([{name:"a_pos",type:"Int16",components:2}]);function xg(n){return n*_/$}const c5=[new Di([C,C,C],[z,z,z]),new Di([C,C,C],[0,0,z]),new Di([0,C,C],[z,0,z]),new Di([C,0,C],[0,z,z]),new Di([0,0,C],[z,z,z])];function Xb(n,e,i,r=!0){const s=Ht([],n._camera.position,n.worldSize),h=[e,i,1,1];Ia(h,h,n.pixelMatrixInverse),ks(h,h,1/h[3]);const d=mn([],Jn([],h,s)),g=n.globeMatrix,y=[g[12],g[13],g[14]],w=Jn([],y,s),k=Ki(w),A=mn([],w),S=n.worldSize/(2*Math.PI),E=An(A,d),D=Math.asin(S/k);if(D<Math.acos(E)){if(!r)return null;const me=[],we=[];Ht(me,d,k/E),mn(we,Jn(we,me,w)),mn(d,wi(d,w,Ht(d,we,Math.tan(D)*k)))}const R=[];new cn(s,d).closestPointOnSphere(y,S,R);const F=mn([],En(g,0)),j=mn([],En(g,1)),Y=mn([],En(g,2)),H=An(F,R),W=An(j,R),J=An(Y,R),Z=Me(Math.asin(-W/S));let ee=Me(Math.atan2(H,J));ee=n.center.lng+function(me,we){const Le=(we-me+180)%360-180;return Le<-180?Le+360:Le}(n.center.lng,ee);const pe=re(ee),ce=oe(ae(Z),0,1);return new fe(pe,ce)}class h5{constructor(e,i,r){this.a=Jn([],e,r),this.b=Jn([],i,r),this.center=r;const s=mn([],this.a),h=mn([],this.b);this.angle=Math.acos(An(s,h))}}function _1(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(r,s,h,d){const g=Math.sin(h);return r*(Math.sin((1-d)*h)/g)+s*(Math.sin(d*h)/g)}(n.a[e],n.b[e],n.angle,oe(i,0,1))+n.center[e]}function ms(n){if(n.z<=1)return c5[n.z+2*n.y+n.x];const e=y1(kg(n));return Di.fromPoints(e)}function Ks(n,e,i){return Ht(n,n,1-i),vn(n,n,e,i)}function Qb(n,e,i){for(const r of n)fn(r,r,e),Ht(r,r,i)}function ev(n,e,i,r){const s=e/n.worldSize,h=n.globeMatrix;if(i.z<=1){const ce=ms(i).getCorners();return Qb(ce,h,s),Di.fromPoints(ce)}const d=kg(i,r),g=y1(d,_+xg(n._tileCoverLift));Qb(g,h,s);const y=Number.MAX_VALUE,w=[-y,-y,-y],k=[y,y,y];if(d.contains(n.center)){for(const we of g)jt(k,k,we),bi(w,w,we);w[2]=0;const ce=n.point,me=[ce.x*s,ce.y*s,0];return jt(k,k,me),bi(w,w,me),new Di(k,w)}if(n._tileCoverLift>0){for(const ce of g)jt(k,k,ce),bi(w,w,ce);return new Di(k,w)}const A=[h[12]*s,h[13]*s,h[14]*s],S=d.getCenter(),E=oe(n.center.lat,-85.051129,Ne),D=oe(S.lat,-85.051129,Ne),R=re(n.center.lng),F=ae(E);let j=R-re(S.lng);const Y=F-ae(D);j>.5?j-=1:j<-.5&&(j+=1);let H=0;Math.abs(j)>Math.abs(Y)?H=j>=0?1:3:(H=Y>=0?0:2,vn(A,A,[h[4]*s,h[5]*s,h[6]*s],-Math.sin(Ci(Y>=0?d.getSouth():d.getNorth()))*_));const W=g[H],J=g[(H+1)%4],Z=new h5(W,J,A),ee=[_1(Z,0)||W[0],_1(Z,1)||W[1],_1(Z,2)||W[2]],pe=Xl(n.zoom);if(pe>0){const ce=function({x:we,y:Le,z:Ze},Ve,Ye,Ke,Be){const qe=1/(1<<Ze);let De=we*qe,Re=De+qe,tt=Le*qe,nt=tt+qe,Lt=0;const At=(De+Re)/2-Ke;return At>.5?Lt=-1:At<-.5&&(Lt=1),De=((De+Lt)*Ve-(Ke*=Ve))*Ye+Ke,Re=((Re+Lt)*Ve-Ke)*Ye+Ke,tt=(tt*Ve-(Be*=Ve))*Ye+Be,nt=(nt*Ve-Be)*Ye+Be,[[De,nt,0],[Re,nt,0],[Re,tt,0],[De,tt,0]]}(i,e,n._pixelsPerMercatorPixel,R,F);for(let we=0;we<g.length;we++)Ks(g[we],ce[we],pe);const me=wi([],ce[H],ce[(H+1)%4]);Ht(me,me,.5),Ks(ee,me,pe)}for(const ce of g)jt(k,k,ce),bi(w,w,ce);return k[2]=Math.min(W[2],J[2]),jt(k,k,ee),bi(w,w,ee),new Di(k,w)}function kg({x:n,y:e,z:i},r=!1){const s=1/(1<<i),h=new q(he(n*s),e===(1<<i)-1&&r?-90:xe((e+1)*s)),d=new q(he((n+1)*s),e===0&&r?90:xe(e*s));return new Q(h,d)}function y1(n,e=_){const i=Ci(n.getNorth()),r=Ci(n.getSouth()),s=Math.cos(i),h=Math.cos(r),d=Math.sin(i),g=Math.sin(r),y=n.getWest(),w=n.getEast();return[O(h,g,y,e),O(h,g,w,e),O(s,d,w,e),O(s,d,y,e)]}function Hp(n,e,i,r){const s=1<<i.z,h=(n/lt+i.x)/s;return N(xe((e/lt+i.y)/s),he(h),r)}function Ag({min:n,max:e}){return T/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const tv=new Float64Array(16);function Sg(n){const e=Ag(n),i=ti(tv,[e,e,e]);return Ae(i,i,Za([],n.min))}function w1(n){const e=(r=n.min,(i=tv)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const s=1/Ag(n);return Oe(e,e,[s,s,s])}function b1(n){const e=lt/(2*Math.PI);return n/(2*Math.PI)/e}function iv(n,e){return lt/(512*Math.pow(2,n))*Ag(ms(e))}function nv(n,e,i,r,s){const h=b1(i),d=[n,e,-i/(2*Math.PI)],g=He(new Float64Array(16));return Ae(g,g,d),Oe(g,g,[h,h,h]),vt(g,g,Ci(-s)),Ot(g,g,Ci(-r)),g}function Xl(n){return ge(b,x,n)}function av(n,e){const i=N(e.lat,e.lng),r=function(D){const R=N(D._center.lat,D._center.lng);let F=Un([],It(0,1,0),R);const j=ri([],-D.angle,R);F=fn(F,F,j),ri(j,-D._pitch,F);const Y=mn([],R);return Ht(Y,Y,xg(D.cameraToCenterDistance/D.pixelsPerMeter)),fn(Y,Y,j),wi([],R,Y)}(n);return d=(s=Ui([],r,i))[0],g=s[1],y=s[2],w=(h=i)[0],k=h[1],A=h[2],E=(S=Math.sqrt(d*d+g*g+y*y)*Math.sqrt(w*w+k*k+A*A))&&An(s,h)/S,Math.acos(Math.min(Math.max(E,-1),1));var s,h,d,g,y,w,k,A,S,E}function v1(n,e){return av(n,e)>Math.PI/2*1.01}const rv=Ci(85),d5=Math.cos(rv),p5=Math.sin(rv),m5=St(),ov=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function sv(n,e,i,r,s,h,d,g,y){if(h&&n.queryGeometry.isAboveHorizon)return!1;h&&(y*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,k=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const A of e)for(const S of A){const E=S.add(g),D=s&&i.elevation?i.elevation.exaggeration()*s.getElevationAt(E.x,E.y,!0):0,R=i.projection.projectTilePoint(E.x,E.y,w);if(D>0){const H=i.projection.upVector(w,E.x,E.y);R.x+=H[0]*k*D,R.y+=H[1]*k*D,R.z+=H[2]*k*D}const F=h?E:f5(R.x,R.y,R.z,r),j=h?n.tilespaceRays.map(H=>_5(H,D)):n.queryGeometry.screenGeometry,Y=Ia([],[R.x,R.y,R.z,1],r);if(!d&&h?y*=Y[3]/i.cameraToCenterDistance:d&&!h&&(y*=i.cameraToCenterDistance/Y[3]),h){const H=xe((S.y/lt+w.y)/(1<<w.z));y/=i.projection.pixelsPerMeter(H,1)/ue(1,H)}if(hs(j,F,y))return!0}return!1}function f5(n,e,i,r){const s=Ia([],[n,e,i,1],r);return new st(s[0]/s[3],s[1]/s[3])}const lv=It(0,0,0),g5=It(0,0,1);function _5(n,e){const i=ci();return lv[2]=e,n.intersectsPlane(lv,g5,i),new st(i[0],i[1])}class uv extends Mr{}let cv,hv,dv,pv;function mv(n,{width:e,height:i},r,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*r)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*i*r);return n.width=e,n.height=i,n.data=s,n}function fv(n,e,i){const{width:r,height:s}=e;r===n.width&&s===n.height||(x1(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,r),height:Math.min(n.height,s)},i,null),n.width=r,n.height=s,n.data=e.data)}function x1(n,e,i,r,s,h,d,g){if(s.width===0||s.height===0)return e;if(s.width>n.width||s.height>n.height||i.x>n.width-s.width||i.y>n.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||r.x>e.width-s.width||r.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,w=e.data,k=h===4&&g;for(let A=0;A<s.height;A++){const S=((i.y+A)*n.width+i.x)*h,E=((r.y+A)*e.width+r.x)*h;if(k)for(let D=0;D<s.width;D++){const R=S+D*h+3,F=E+D*h;w[F+0]=255,w[F+1]=255,w[F+2]=255,w[F+3]=y[R]}else if(d)for(let D=0;D<s.width;D++){const R=S+D*h,F=E+D*h,j=new Bi(y[R+0]/255,y[R+1]/255,y[R+2]/255,y[R+3]).toNonPremultipliedRenderColor(d).toArray();w[F+0]=j[0],w[F+1]=j[1],w[F+2]=j[2],w[F+3]=j[3]}else for(let D=0;D<s.width*h;D++)w[E+D]=y[S+D]}return e}yt(uv,"HeatmapBucket",{omit:["layers"]});class Ql{constructor(e,i){mv(this,e,1,i)}resize(e){fv(this,new Ql(e),1)}clone(){return new Ql({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,s,h){x1(e,i,r,s,h,1,null)}}class wa{constructor(e,i){mv(this,e,4,i)}resize(e){fv(this,new wa(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,s,h,d,g){x1(e,i,r,s,h,4,d,g)}}class gv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Zp(n){const e={},i=n.resolution||256,r=n.clips?n.clips.length:1,s=n.image||new wa({width:i,height:r}),h=(d,g,y)=>{e[n.evaluationKey]=y;const w=n.expression.evaluate(e),k=w?w.toNonPremultipliedRenderColor(null):null;k&&(s.data[d+g+0]=Math.floor(255*k.r),s.data[d+g+1]=Math.floor(255*k.g),s.data[d+g+2]=Math.floor(255*k.b),s.data[d+g+3]=Math.floor(255*k.a))};if(n.clips)for(let d=0,g=0;d<r;++d,g+=4*i)for(let y=0,w=0;y<i;y++,w+=4){const k=y/(i-1),{start:A,end:S}=n.clips[d];h(g,w,A*(1-k)+S*k)}else for(let d=0,g=0;d<i;d++,g+=4)h(0,g,d/(i-1));return s}yt(Ql,"AlphaImage"),yt(wa,"RGBAImage");const y5=Ei([{name:"a_pos",components:2,type:"Int16"}],4),w5=Ei([{name:"a_road_z_offset",components:1,type:"Float32"}],4),b5=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),v5=Ei([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Kp(n,e,i=2){const r=e&&e.length,s=r?e[0]*i:n.length;let h=_v(n,0,s,i,!0);const d=[];if(!h||h.next===h.prev)return d;let g,y,w;if(r&&(h=function(k,A,S,E){const D=[];for(let R=0,F=A.length;R<F;R++){const j=_v(k,A[R]*E,R<F-1?A[R+1]*E:k.length,E,!1);j===j.next&&(j.steiner=!0),D.push(E5(j))}D.sort(T5);for(let R=0;R<D.length;R++)S=P5(D[R],S);return S}(n,e,h,i)),n.length>80*i){g=1/0,y=1/0;let k=-1/0,A=-1/0;for(let S=i;S<s;S+=i){const E=n[S],D=n[S+1];E<g&&(g=E),D<y&&(y=D),E>k&&(k=E),D>A&&(A=D)}w=Math.max(k-g,A-y),w=w!==0?32767/w:0}return Xp(h,d,i,g,y,w,0),d}function _v(n,e,i,r,s){let h;if(s===function(d,g,y,w){let k=0;for(let A=g,S=y-w;A<y;A+=w)k+=(d[S]-d[A])*(d[A+1]+d[S+1]),S=A;return k}(n,e,i,r)>0)for(let d=e;d<i;d+=r)h=vv(d/r|0,n[d],n[d+1],h);else for(let d=i-r;d>=e;d-=r)h=vv(d/r|0,n[d],n[d+1],h);return h&&Xh(h,h.next)&&(tm(h),h=h.next),h}function Sc(n,e){if(!n)return n;e||(e=n);let i,r=n;do if(i=!1,r.steiner||!Xh(r,r.next)&&ra(r.prev,r,r.next)!==0)r=r.next;else{if(tm(r),r=e=r.prev,r===r.next)break;i=!0}while(i||r!==e);return e}function Xp(n,e,i,r,s,h,d){if(!n)return;!d&&h&&function(y,w,k,A){let S=y;do S.z===0&&(S.z=k1(S.x,S.y,w,k,A)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==y);S.prevZ.nextZ=null,S.prevZ=null,function(E){let D,R=1;do{let F,j=E;E=null;let Y=null;for(D=0;j;){D++;let H=j,W=0;for(let Z=0;Z<R&&(W++,H=H.nextZ,H);Z++);let J=R;for(;W>0||J>0&&H;)W!==0&&(J===0||!H||j.z<=H.z)?(F=j,j=j.nextZ,W--):(F=H,H=H.nextZ,J--),Y?Y.nextZ=F:E=F,F.prevZ=Y,Y=F;j=H}Y.nextZ=null,R*=2}while(D>1)}(S)}(n,r,s,h);let g=n;for(;n.prev!==n.next;){const y=n.prev,w=n.next;if(h?k5(n,r,s,h):x5(n))e.push(y.i,n.i,w.i),tm(n),n=w.next,g=w.next;else if((n=w)===g){d?d===1?Xp(n=A5(Sc(n),e),e,i,r,s,h,2):d===2&&S5(n,e,i,r,s,h):Xp(Sc(n),e,i,r,s,h,1);break}}}function x5(n){const e=n.prev,i=n,r=n.next;if(ra(e,i,r)>=0)return!1;const s=e.x,h=i.x,d=r.x,g=e.y,y=i.y,w=r.y,k=Math.min(s,h,d),A=Math.min(g,y,w),S=Math.max(s,h,d),E=Math.max(g,y,w);let D=r.next;for(;D!==e;){if(D.x>=k&&D.x<=S&&D.y>=A&&D.y<=E&&Qp(s,g,h,y,d,w,D.x,D.y)&&ra(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function k5(n,e,i,r){const s=n.prev,h=n,d=n.next;if(ra(s,h,d)>=0)return!1;const g=s.x,y=h.x,w=d.x,k=s.y,A=h.y,S=d.y,E=Math.min(g,y,w),D=Math.min(k,A,S),R=Math.max(g,y,w),F=Math.max(k,A,S),j=k1(E,D,e,i,r),Y=k1(R,F,e,i,r);let H=n.prevZ,W=n.nextZ;for(;H&&H.z>=j&&W&&W.z<=Y;){if(H.x>=E&&H.x<=R&&H.y>=D&&H.y<=F&&H!==s&&H!==d&&Qp(g,k,y,A,w,S,H.x,H.y)&&ra(H.prev,H,H.next)>=0||(H=H.prevZ,W.x>=E&&W.x<=R&&W.y>=D&&W.y<=F&&W!==s&&W!==d&&Qp(g,k,y,A,w,S,W.x,W.y)&&ra(W.prev,W,W.next)>=0))return!1;W=W.nextZ}for(;H&&H.z>=j;){if(H.x>=E&&H.x<=R&&H.y>=D&&H.y<=F&&H!==s&&H!==d&&Qp(g,k,y,A,w,S,H.x,H.y)&&ra(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;W&&W.z<=Y;){if(W.x>=E&&W.x<=R&&W.y>=D&&W.y<=F&&W!==s&&W!==d&&Qp(g,k,y,A,w,S,W.x,W.y)&&ra(W.prev,W,W.next)>=0)return!1;W=W.nextZ}return!0}function A5(n,e){let i=n;do{const r=i.prev,s=i.next.next;!Xh(r,s)&&wv(r,i,i.next,s)&&em(r,s)&&em(s,r)&&(e.push(r.i,i.i,s.i),tm(i),tm(i.next),i=n=s),i=i.next}while(i!==n);return Sc(i)}function S5(n,e,i,r,s,h){let d=n;do{let g=d.next.next;for(;g!==d.prev;){if(d.i!==g.i&&C5(d,g)){let y=bv(d,g);return d=Sc(d,d.next),y=Sc(y,y.next),Xp(d,e,i,r,s,h,0),void Xp(y,e,i,r,s,h,0)}g=g.next}d=d.next}while(d!==n)}function T5(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function P5(n,e){const i=function(s,h){let d=h;const g=s.x,y=s.y;let w,k=-1/0;if(Xh(s,d))return d;do{if(Xh(s,d.next))return d.next;if(y<=d.y&&y>=d.next.y&&d.next.y!==d.y){const R=d.x+(y-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(R<=g&&R>k&&(k=R,w=d.x<d.next.x?d:d.next,R===g))return w}d=d.next}while(d!==h);if(!w)return null;const A=w,S=w.x,E=w.y;let D=1/0;d=w;do{if(g>=d.x&&d.x>=S&&g!==d.x&&yv(y<E?g:k,y,S,E,y<E?k:g,y,d.x,d.y)){const R=Math.abs(y-d.y)/(g-d.x);em(d,s)&&(R<D||R===D&&(d.x>w.x||d.x===w.x&&M5(w,d)))&&(w=d,D=R)}d=d.next}while(d!==A);return w}(n,e);if(!i)return e;const r=bv(i,n);return Sc(r,r.next),Sc(i,i.next)}function M5(n,e){return ra(n.prev,n,e.prev)<0&&ra(e.next,n,n.next)<0}function k1(n,e,i,r,s){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*s|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function E5(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function yv(n,e,i,r,s,h,d,g){return(s-d)*(e-g)>=(n-d)*(h-g)&&(n-d)*(r-g)>=(i-d)*(e-g)&&(i-d)*(h-g)>=(s-d)*(r-g)}function Qp(n,e,i,r,s,h,d,g){return!(n===d&&e===g)&&yv(n,e,i,r,s,h,d,g)}function C5(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,r){let s=i;do{if(s.i!==i.i&&s.next.i!==i.i&&s.i!==r.i&&s.next.i!==r.i&&wv(s,s.next,i,r))return!0;s=s.next}while(s!==i);return!1}(n,e)&&(em(n,e)&&em(e,n)&&function(i,r){let s=i,h=!1;const d=(i.x+r.x)/2,g=(i.y+r.y)/2;do s.y>g!=s.next.y>g&&s.next.y!==s.y&&d<(s.next.x-s.x)*(g-s.y)/(s.next.y-s.y)+s.x&&(h=!h),s=s.next;while(s!==i);return h}(n,e)&&(ra(n.prev,n,e.prev)||ra(n,e.prev,e))||Xh(n,e)&&ra(n.prev,n,n.next)>0&&ra(e.prev,e,e.next)>0)}function ra(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Xh(n,e){return n.x===e.x&&n.y===e.y}function wv(n,e,i,r){const s=Pg(ra(n,e,i)),h=Pg(ra(n,e,r)),d=Pg(ra(i,r,n)),g=Pg(ra(i,r,e));return s!==h&&d!==g||!(s!==0||!Tg(n,i,e))||!(h!==0||!Tg(n,r,e))||!(d!==0||!Tg(i,n,r))||!(g!==0||!Tg(i,e,r))}function Tg(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Pg(n){return n>0?1:n<0?-1:0}function em(n,e){return ra(n.prev,n,n.next)<0?ra(n,e,n.next)>=0&&ra(n,n.prev,e)>=0:ra(n,e,n.prev)<0||ra(n,n.next,e)<0}function bv(n,e){const i=A1(n.i,n.x,n.y),r=A1(e.i,e.x,e.y),s=n.next,h=e.prev;return n.next=e,e.prev=n,i.next=s,s.prev=i,r.next=i,i.prev=r,h.next=r,r.prev=h,r}function vv(n,e,i,r){const s=A1(n,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function tm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function A1(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mg(n,e){const i=n.length;if(i<=1)return[n];const r=[];let s,h;for(let d=0;d<i;d++){const g=gn(n[d]);g!==0&&(n[d].area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(s&&r.push(s),s=[n[d]]):s.push(n[d]))}if(s&&r.push(s),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(Sa(r[d],e,1,r[d].length-1,D5),r[d]=r[d].slice(0,e));return r}function D5(n,e){return e.area-n.area}function xv(n,e,i=1){if(!n)return null;const r=typeof n=="string"?Ua.from(n).getPrimary():n.getPrimary(),s=typeof n=="string"?null:n.getSecondary();for(const h of[r,s]){if(!h)continue;const d=h.id.toString();e.has(d)||e.set(d,[]),h.scaleSelf(i),e.get(d).push(h)}return{primary:r.toString(),secondary:s?s.toString():null}}function S1(n,e,i,r){const s=r.patternDependencies;let h=!1;for(const d of e){const g=d.paint.get(`${n}-pattern`);g.isConstant()||(h=!0),xv(g.constantOr(null),s,i)&&(h=!0)}return h}function T1(n,e,i,r,s,h){const d=h.patternDependencies;for(const g of e){const y=g.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let w=y.evaluate({zoom:r},i,{},h.availableImages);w=w&&w.name?w.name:w;const k=xv(w,d,s);if(!k)continue;const{primary:A,secondary:S}=k;A&&(i.patterns[g.id]=[A,S].filter(Boolean))}}return i}class kv{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,r]of e.polygons)this.add(i,...r)}}class Tc{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Tc;let i=[];for(const w of e)i.push(...w.portals);if(i.length===0)return new Tc;const r=(w,k)=>w<=0&&k<=0||w>=lt&&k>=lt;for(const w of i){const k=w.va,A=w.vb;(r(k.x,A.x)||r(k.y,A.y))&&(w.type="border")}const s=i.filter(w=>w.type!=="unevaluated"),h=i.filter(w=>w.type==="unevaluated");if(h.length===0)return new Tc;h.sort((w,k)=>w.hash===k.hash?w.isTunnel===k.isTunnel?0:w.isTunnel?-1:1:w.hash<k.hash?1:-1),i=s.concat(h);let d=s.length,g=d,y=d;do if(g++,g===i.length||i[d].hash!==i[g].hash){if(g-d==2){y<d&&(i[y]=i[d],i[d]=null);const w=i[y],k=i[g-1];w.type=w.isTunnel!==k.isTunnel?"tunnel":"polygon",w.connection={a:w.connection.a,b:k.connection.a},y++}d=g}while(d!==i.length);return i.splice(y),i.sort((w,k)=>w.hash<k.hash?1:-1),{portals:i}}}yt(Tc,"ElevationPortalGraph"),yt(kv,"ElevationPolygons");class I5{constructor(e,i,r){this.outPositions=e,this.outNormals=i,this.outIndices=r,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,r){let s=e[2];r!=null&&(s*=r);const h=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),d=this.vertexLookup.get(h);if(d!=null)return d;const g=this.outPositions.length;this.vertexLookup.set(h,g);const y=Math.trunc(16384*i[0]),w=Math.trunc(16384*i[1]),k=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],s),this.outNormals.emplaceBack(y,w,k),g}addVertices(e,i,...r){const s=[];for(const h of r){const d=this.addVertex(h,e,i);s.push(d)}return s}addTriangles(e,i,r){if(i&&r){const s=r.length===1,h=It(0,0,0);for(let d=0;d<e.length;d+=3){const g=i[e[d+0]],y=i[e[d+1]],w=i[e[d+2]],k=s?r[0]:r[e[d+1]],A=s?r[0]:r[e[d+2]],S=this.addVertex(It(g.x,g.y,s?r[0]:r[e[d+0]]),h),E=this.addVertex(It(y.x,y.y,k),h),D=this.addVertex(It(w.x,w.y,A),h);this.outIndices.emplaceBack(S,E,D)}}else for(let s=0;s<e.length;s+=3)this.outIndices.emplaceBack(e[s+0],e[s+1],e[s+2])}addQuad(e,i){const r=this.addVertices(i,void 0,...e.map(y=>It(y.coord.x,y.coord.y,y.height))),[s,h,d,g]=r;this.addTriangles([s,h,d,d,g,s])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Er{constructor(e,i,r,s){this.unevaluatedPortals=new Tc,this.portalPolygons=new kv,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new zp,this.vertexNormals=new Wh,this.indexArray=new fa,this.tileToMeters=ze(e),this.bridgeProgramConfigurations=new l(i,{zoom:r,lut:s},h=>h!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new l(i,{zoom:r,lut:s},h=>h!=="fill-bridge-guard-rail-color")}addVertices(e,i){const r=this.unevalVertices.length;for(let s=0;s<e.length;s++)this.unevalVertices.push(e[s]),this.unevalHeights.push(i[s]);return r}addTriangles(e,i,r){const s=r?this.unevalTunnelTriangles:this.unevalTriangles;for(const h of e)s.push(h+i)}addRenderableRing(e,i,r,s,h,d){const g=[new st(h.min.x,h.min.y),new st(h.max.x,h.min.y),new st(h.max.x,h.max.y),new st(h.min.x,h.max.y)];for(let y=0;y<r-1;y++){const w=i+y,k=w+1,A=this.unevalVertices[w],S=this.unevalVertices[k];if(!(A.x>=h.min.x&&A.x<=h.max.x&&A.y>=h.min.y&&A.y<=h.max.y||S.x>=h.min.x&&S.x<=h.max.x&&S.y>=h.min.y&&S.y<=h.max.y||Zs(A,S,g))||this.isOnBorder(A.x,S.x)||this.isOnBorder(A.y,S.y))continue;const E=Er.computeEdgeHash(this.unevalVertices[w],this.unevalVertices[k]);let D,R=this.vertexHashLookup.get(Er.computePosHash(A));R!=null?D=R.next:(R=this.vertexHashLookup.get(Er.computePosHash(S)),D=R!=null?R.prev:E),this.unevalEdges.push({polygonIdx:e,a:w,b:k,hash:E,portalHash:D,isTunnel:s,type:"unevaluated",featureInfo:d})}}addPortalCandidates(e,i,r,s,h){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:h});const d=i[0];this.vertexHashLookup.clear();let g=Er.computeEdgeHash(d[d.length-2],d[d.length-1]);for(let y=0;y<d.length-1;y++){const w=d[y+0],k=d[y+1],A=vr(k.x-w.x,k.y-w.y),S=qo(A);if(S===0)continue;let E="unevaluated";const D=s.pointElevation(w),R=s.pointElevation(k);Math.abs(D)<.01&&Math.abs(R)<.01?E="entrance":(this.isOnBorder(w.x,k.x)||this.isOnBorder(w.y,k.y))&&(E="border");const F=Er.computeEdgeHash(w,k);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:w,vb:k,vab:A,length:S,hash:F,isTunnel:r,type:E});const j=Er.computePosHash(w);this.vertexHashLookup.set(j,{prev:g,next:F}),g=F}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),r=S=>{S.primitiveLength=this.indexArray.length-S.primitiveOffset},s=new I5(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const h=i(),d=i(),g=i(),y=(S,E)=>{S.sort((R,F)=>R.type===E&&F.type!==E?-1:R.type!==E&&F.type===E?1:0);const D=S.findIndex(R=>R.type!==E);return D>=0?D:S.length};let w=0;this.unevalEdges.length>0&&(w=y(this.unevalEdges,"none"),this.constructBridgeStructures(s,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},this.tileToMeters)),r(g);const k=i(),A=i();if(this.unevalEdges.length>0){const S=this.unevalEdges.splice(w),E=y(S,"tunnel")+w;this.unevalEdges.push(...S),this.constructTunnelStructures(s,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},{min:w,max:E})}r(k),s.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),r(A),s.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),r(d),s.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),r(h),this.maskSegments=In.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=In.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength),this.renderableBridgeSegments=In.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableTunnelSegments=In.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=In.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength)}update(e,i,r,s,h,d,g,y){this.bridgeProgramConfigurations.updatePaintArrays(e,i,h,r,s,d,g,y),this.tunnelProgramConfigurations.updatePaintArrays(e,i,h,r,s,d,g,y)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,b5.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,v5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,r,s,h){const d=(g,y)=>{for(let w=0;w<y.length-1;w++){const k=y[w].featureIndex,A=y[w+1].vertexStart,S=e.feature(k);g.populatePaintArrays(A,S,k,{},r,i,s,void 0,h)}};d(this.bridgeProgramConfigurations,this.bridgeFeatureSections),d(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,r,s,h){const d=new Map;for(let g=s;g<h;g++){const y=r[g],w=y.a,k=y.b,A=Er.computePosHash(e[w]),S=Er.computePosHash(e[k]);d.has(A)||d.set(A,{}),d.has(S)||d.set(S,{});const E=d.get(A),D=d.get(S);i[w]<=0&&i[k]<=0||(E.to=k,D.from=w)}return d}constructBridgeStructures(e,i,r,s,h,d){e.clearVertexLookup();const g=this.computeVertexConnections(i,r,s,h.min,h.max),y=1/d,w=.5*y,k=E=>It(i[E].x,i[E].y,r[E]*y),A=E=>{const D=g.get(Er.computePosHash(i[E])),R=D.from,F=D.to;if(!R||!F)return;const j=k(R),Y=k(E),H=k(F),W=It(0,0,0);if(!Br(j,Y)){const Z=Jn(ci(),Y,j);wi(W,W,mn(Z,Z))}if(!Br(H,Y)){const Z=Jn(ci(),H,Y);wi(W,W,mn(Z,Z))}const J=$o(W);return J>0?Ht(W,W,1/J):void 0};let S=Number.POSITIVE_INFINITY;this.sortSubarray(s,h.min,h.max,(E,D)=>E.featureInfo.featureIndex-D.featureInfo.featureIndex);for(let E=h.min;E<h.max;E++){const D=s[E];if(!D.featureInfo.guardRailEnabled)continue;const R=this.prepareEdgePoints(i,r,D,(Kt,kt)=>Kt>kt);if(R==null)continue;const F=R[0],j=R[1],Y=It(F.coord.x,F.coord.y,y*F.height),H=It(j.coord.x,j.coord.y,y*j.height);if(Br(Y,H))continue;const W=Jn(ci(),H,Y);mn(W,W);const J=Kt=>mn(Kt,Kt),Z=A(D.a)||W,ee=A(D.b)||W,pe=J(It(Z[1],-Z[0],0)),ce=J(It(ee[1],-ee[0],0)),me=J(Un(ci(),pe,Z)),we=J(Un(ci(),ce,ee)),Le=ci(),Ze=[wi(ci(),Y,Ht(Le,Jn(Le,pe,me),w)),wi(ci(),Y,Ht(Le,wi(Le,pe,me),w)),wi(ci(),Y,Ht(Le,me,w)),Y],Ve=[wi(ci(),H,Ht(Le,Jn(Le,ce,we),w)),wi(ci(),H,Ht(Le,wi(Le,ce,we),w)),wi(ci(),H,Ht(Le,we,w)),H];S=this.addFeatureSection(D.featureInfo.featureIndex,S,this.bridgeFeatureSections,e);const[Ye,Ke]=e.addVertices(pe,d,Ze[0],Ze[1]),[Be,qe]=e.addVertices(ce,d,Ve[0],Ve[1]);e.addTriangles([Ye,Ke,Be,Ke,qe,Be]);const[De,Re]=e.addVertices(me,d,Ze[1],Ze[2]),[tt,nt]=e.addVertices(we,d,Ve[1],Ve[2]);e.addTriangles([De,Re,tt,Re,nt,tt]);const[Lt,At]=e.addVertices(Za(pe,pe),d,Ze[2],Ze[3]),[ct,et]=e.addVertices(Za(ce,ce),d,Ve[2],Ve[3]);e.addTriangles([Lt,At,ct,At,et,ct])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,r,s,h,d){e.clearVertexLookup();let g=Number.POSITIVE_INFINITY;const y=(k,A)=>k.featureInfo.featureIndex-A.featureInfo.featureIndex;this.sortSubarray(s,h.min,h.max,y),this.sortSubarray(s,d.min,d.max,y);const w=k=>mn(k,k);for(let k=h.min;k<h.max;k++){const A=this.prepareEdgePoints(i,r,s[k],(R,F)=>R<F);if(A==null)continue;const[S,E]=A,D=w(It(-(E.coord.y-S.coord.y),E.coord.x-S.coord.x,0));g=this.addFeatureSection(s[k].featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad([S,E,{coord:E.coord,height:s[k].isTunnel?-.1:0},{coord:S.coord,height:s[k].isTunnel?-.1:0}],D)}for(let k=d.min;k<d.max;k++){const A=s[k];A.isTunnel&&([A.a,A.b]=[A.b,A.a]);const S=i[A.a],E=i[A.b],D=w(It(-(E.y-S.y),E.x-S.x,0));g=this.addFeatureSection(A.featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad([{coord:E,height:0},{coord:S,height:0},{coord:S,height:r[A.a]+4},{coord:E,height:r[A.b]+4}],D),e.addQuad([{coord:S,height:0},{coord:E,height:0},{coord:E,height:r[A.b]+4},{coord:S,height:r[A.a]+4}],D)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,r,s){let h=i[r.a],d=i[r.b];const g=s(h,0),y=s(d,0);if(g&&y)return[{coord:e[r.a],height:h},{coord:e[r.b],height:d}];if(!g&&!y)return;const w=e[r.a].clone(),k=e[r.b].clone();if(g){if(!y){const A=d/(d-h);k.x=Vt(k.x,w.x,A),k.y=Vt(k.y,w.y,A),d=Vt(d,h,A)}}else{const A=h/(h-d);w.x=Vt(w.x,k.x,A),w.y=Vt(w.y,k.y,A),h=Vt(h,d,A)}return[{coord:w,height:h},{coord:k,height:d}]}prepareEdges(e,i){if(i.length===0)return;i.sort((g,y)=>g.hash===y.hash?y.polygonIdx-g.polygonIdx:y.hash>g.hash?1:-1);let r=0,s=0,h=0,d=i[r].polygonIdx;do s++,(s===i.length||i[r].hash!==i[s].hash)&&((s-r==1||i[s-1].polygonIdx!==d)&&(h<r&&(i[h]=i[r],i[r]=null),i[h].type="none",h++),r=s,r!==i.length&&(d=i[r].polygonIdx));while(r!==i.length);if(i.splice(h),i.length!==0&&e.length!==0){i.sort((w,k)=>w.portalHash<k.portalHash?1:-1);let g=0,y=0;for(;g!==i.length&&y!==e.length;){const w=i[g],k=e[y];w.portalHash>k.hash?g++:k.hash>w.portalHash?y++:(w.type=k.type,g++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=lt&&i>=lt}addFeatureSection(e,i,r,s){return e!==i&&(i=e,r.push({featureIndex:e,vertexStart:s.getVertexCount()}),s.clearVertexLookup()),i}sortSubarray(e,i,r,s){const h=e.slice(i,r);h.sort(s),e.splice(i,h.length,...h)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Er.computePosHash(e))<<32n|BigInt(Er.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Av,Sv={exports:{}},Tv=(Av||(Av=1,function(n,e){(function(i){function r(X,te){return X>te?1:X<te?-1:0}var s=function(X,te){X===void 0&&(X=r),te===void 0&&(te=!1),this._compare=X,this._root=null,this._size=0,this._noDuplicates=!!te},h={size:{configurable:!0}};function d(X,te,We,rt,ht){var ut=ht-rt;if(ut>0){var xt=rt+Math.floor(ut/2),$t={key:te[xt],data:We[xt],parent:X};return $t.left=d($t,te,We,rt,xt),$t.right=d($t,te,We,xt+1,ht),$t}return null}function g(X,te,We,rt,ht){if(!(We>=rt)){for(var ut=X[We+rt>>1],xt=We-1,$t=rt+1;;){do xt++;while(ht(X[xt],ut)<0);do $t--;while(ht(X[$t],ut)>0);if(xt>=$t)break;var xi=X[xt];X[xt]=X[$t],X[$t]=xi,xi=te[xt],te[xt]=te[$t],te[$t]=xi}g(X,te,We,$t,ht),g(X,te,$t+1,rt,ht)}}s.prototype.rotateLeft=function(X){var te=X.right;te&&(X.right=te.left,te.left&&(te.left.parent=X),te.parent=X.parent),X.parent?X===X.parent.left?X.parent.left=te:X.parent.right=te:this._root=te,te&&(te.left=X),X.parent=te},s.prototype.rotateRight=function(X){var te=X.left;te&&(X.left=te.right,te.right&&(te.right.parent=X),te.parent=X.parent),X.parent?X===X.parent.left?X.parent.left=te:X.parent.right=te:this._root=te,te&&(te.right=X),X.parent=te},s.prototype._splay=function(X){for(;X.parent;){var te=X.parent;te.parent?te.left===X&&te.parent.left===te?(this.rotateRight(te.parent),this.rotateRight(te)):te.right===X&&te.parent.right===te?(this.rotateLeft(te.parent),this.rotateLeft(te)):te.left===X&&te.parent.right===te?(this.rotateRight(te),this.rotateLeft(te)):(this.rotateLeft(te),this.rotateRight(te)):te.left===X?this.rotateRight(te):this.rotateLeft(te)}},s.prototype.splay=function(X){for(var te,We,rt,ht,ut;X.parent;)(We=(te=X.parent).parent)&&We.parent?((rt=We.parent).left===We?rt.left=X:rt.right=X,X.parent=rt):(X.parent=null,this._root=X),ht=X.left,ut=X.right,X===te.left?(We&&(We.left===te?(te.right?(We.left=te.right,We.left.parent=We):We.left=null,te.right=We,We.parent=te):(ht?(We.right=ht,ht.parent=We):We.right=null,X.left=We,We.parent=X)),ut?(te.left=ut,ut.parent=te):te.left=null,X.right=te,te.parent=X):(We&&(We.right===te?(te.left?(We.right=te.left,We.right.parent=We):We.right=null,te.left=We,We.parent=te):(ut?(We.left=ut,ut.parent=We):We.left=null,X.right=We,We.parent=X)),ht?(te.right=ht,ht.parent=te):te.right=null,X.left=te,te.parent=X)},s.prototype.replace=function(X,te){X.parent?X===X.parent.left?X.parent.left=te:X.parent.right=te:this._root=te,te&&(te.parent=X.parent)},s.prototype.minNode=function(X){if(X===void 0&&(X=this._root),X)for(;X.left;)X=X.left;return X},s.prototype.maxNode=function(X){if(X===void 0&&(X=this._root),X)for(;X.right;)X=X.right;return X},s.prototype.insert=function(X,te){var We=this._root,rt=null,ht=this._compare;if(this._noDuplicates)for(;We;){if(rt=We,ht(We.key,X)===0)return;We=ht(We.key,X)<0?We.right:We.left}else for(;We;)rt=We,We=ht(We.key,X)<0?We.right:We.left;return We={key:X,data:te,left:null,right:null,parent:rt},rt?ht(rt.key,We.key)<0?rt.right=We:rt.left=We:this._root=We,this.splay(We),this._size++,We},s.prototype.find=function(X){for(var te=this._root,We=this._compare;te;){var rt=We(te.key,X);if(rt<0)te=te.right;else{if(!(rt>0))return te;te=te.left}}return null},s.prototype.contains=function(X){for(var te=this._root,We=this._compare;te;){var rt=We(X,te.key);if(rt===0)return!0;te=rt<0?te.left:te.right}return!1},s.prototype.remove=function(X){var te=this.find(X);if(!te)return!1;if(this.splay(te),te.left)if(te.right){var We=this.minNode(te.right);We.parent!==te&&(this.replace(We,We.right),We.right=te.right,We.right.parent=We),this.replace(te,We),We.left=te.left,We.left.parent=We}else this.replace(te,te.left);else this.replace(te,te.right);return this._size--,!0},s.prototype.removeNode=function(X){if(!X)return!1;if(this.splay(X),X.left)if(X.right){var te=this.minNode(X.right);te.parent!==X&&(this.replace(te,te.right),te.right=X.right,te.right.parent=te),this.replace(X,te),te.left=X.left,te.left.parent=te}else this.replace(X,X.left);else this.replace(X,X.right);return this._size--,!0},s.prototype.erase=function(X){var te=this.find(X);if(te){this.splay(te);var We=te.left,rt=te.right,ht=null;We&&(We.parent=null,ht=this.maxNode(We),this.splay(ht),this._root=ht),rt&&(We?ht.right=rt:this._root=rt,rt.parent=ht),this._size--}},s.prototype.pop=function(){var X=this._root,te=null;if(X){for(;X.left;)X=X.left;te={key:X.key,data:X.data},this.remove(X.key)}return te},s.prototype.next=function(X){var te=X;if(te)if(te.right)for(te=te.right;te&&te.left;)te=te.left;else for(te=X.parent;te&&te.right===X;)X=te,te=te.parent;return te},s.prototype.prev=function(X){var te=X;if(te)if(te.left)for(te=te.left;te&&te.right;)te=te.right;else for(te=X.parent;te&&te.left===X;)X=te,te=te.parent;return te},s.prototype.forEach=function(X){for(var te=this._root,We=[],rt=!1,ht=0;!rt;)te?(We.push(te),te=te.left):We.length>0?(X(te=We.pop(),ht++),te=te.right):rt=!0;return this},s.prototype.range=function(X,te,We,rt){for(var ht=[],ut=this._compare,xt=this._root;ht.length!==0||xt;)if(xt)ht.push(xt),xt=xt.left;else{if(ut((xt=ht.pop()).key,te)>0)break;if(ut(xt.key,X)>=0&&We.call(rt,xt))return this;xt=xt.right}return this},s.prototype.keys=function(){for(var X=this._root,te=[],We=[],rt=!1;!rt;)X?(te.push(X),X=X.left):te.length>0?(X=te.pop(),We.push(X.key),X=X.right):rt=!0;return We},s.prototype.values=function(){for(var X=this._root,te=[],We=[],rt=!1;!rt;)X?(te.push(X),X=X.left):te.length>0?(X=te.pop(),We.push(X.data),X=X.right):rt=!0;return We},s.prototype.at=function(X){for(var te=this._root,We=[],rt=!1,ht=0;!rt;)if(te)We.push(te),te=te.left;else if(We.length>0){if(te=We.pop(),ht===X)return te;ht++,te=te.right}else rt=!0;return null},s.prototype.load=function(X,te,We){if(X===void 0&&(X=[]),te===void 0&&(te=[]),We===void 0&&(We=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var rt=X.length;return We&&g(X,te,0,rt-1,this._compare),this._root=d(null,X,te,0,rt),this._size=rt,this},s.prototype.min=function(){var X=this.minNode(this._root);return X?X.key:null},s.prototype.max=function(){var X=this.maxNode(this._root);return X?X.key:null},s.prototype.isEmpty=function(){return this._root===null},h.size.get=function(){return this._size},s.createTree=function(X,te,We,rt,ht){return new s(We,ht).load(X,te,rt)},Object.defineProperties(s.prototype,h);var y=0,w=1,k=2,A=3,S=0,E=1,D=2,R=3;function F(X,te,We){te===null?(X.inOut=!1,X.otherInOut=!0):(X.isSubject===te.isSubject?(X.inOut=!te.inOut,X.otherInOut=te.otherInOut):(X.inOut=!te.otherInOut,X.otherInOut=te.isVertical()?!te.inOut:te.inOut),te&&(X.prevInResult=!j(te,We)||te.isVertical()?te.prevInResult:te));var rt=j(X,We);X.resultTransition=rt?function(ht,ut){var xt,$t=!ht.inOut,xi=!ht.otherInOut;switch(ut){case S:xt=$t&&xi;break;case E:xt=$t||xi;break;case R:xt=$t^xi;break;case D:xt=ht.isSubject?$t&&!xi:xi&&!$t}return xt?1:-1}(X,We):0}function j(X,te){switch(X.type){case y:switch(te){case S:return!X.otherInOut;case E:return X.otherInOut;case D:return X.isSubject&&X.otherInOut||!X.isSubject&&!X.otherInOut;case R:return!0}break;case k:return te===S||te===E;case A:return te===D;case w:return!1}return!1}var Y=function(X,te,We,rt,ht){this.left=te,this.point=X,this.otherEvent=We,this.isSubject=rt,this.type=ht||y,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},H={inResult:{configurable:!0}};function W(X,te){return X[0]===te[0]&&X[1]===te[1]}Y.prototype.isBelow=function(X){var te=this.point,We=this.otherEvent.point;return this.left?(te[0]-X[0])*(We[1]-X[1])-(We[0]-X[0])*(te[1]-X[1])>0:(We[0]-X[0])*(te[1]-X[1])-(te[0]-X[0])*(We[1]-X[1])>0},Y.prototype.isAbove=function(X){return!this.isBelow(X)},Y.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},H.inResult.get=function(){return this.resultTransition!==0},Y.prototype.clone=function(){var X=new Y(this.point,this.left,this.otherEvent,this.isSubject,this.type);return X.contourId=this.contourId,X.resultTransition=this.resultTransition,X.prevInResult=this.prevInResult,X.isExteriorRing=this.isExteriorRing,X.inOut=this.inOut,X.otherInOut=this.otherInOut,X},Object.defineProperties(Y.prototype,H);var J=11102230246251565e-32,Z=134217729,ee=(3+8*J)*J;function pe(X,te,We,rt,ht){var ut,xt,$t,xi,ki=te[0],ui=rt[0],Vi=0,en=0;ui>ki==ui>-ki?(ut=ki,ki=te[++Vi]):(ut=ui,ui=rt[++en]);var Ai=0;if(Vi<X&&en<We)for(ui>ki==ui>-ki?($t=ut-((xt=ki+ut)-ki),ki=te[++Vi]):($t=ut-((xt=ui+ut)-ui),ui=rt[++en]),ut=xt,$t!==0&&(ht[Ai++]=$t);Vi<X&&en<We;)ui>ki==ui>-ki?($t=ut-((xt=ut+ki)-(xi=xt-ut))+(ki-xi),ki=te[++Vi]):($t=ut-((xt=ut+ui)-(xi=xt-ut))+(ui-xi),ui=rt[++en]),ut=xt,$t!==0&&(ht[Ai++]=$t);for(;Vi<X;)$t=ut-((xt=ut+ki)-(xi=xt-ut))+(ki-xi),ki=te[++Vi],ut=xt,$t!==0&&(ht[Ai++]=$t);for(;en<We;)$t=ut-((xt=ut+ui)-(xi=xt-ut))+(ui-xi),ui=rt[++en],ut=xt,$t!==0&&(ht[Ai++]=$t);return ut===0&&Ai!==0||(ht[Ai++]=ut),Ai}function ce(X){return new Float64Array(X)}var me=33306690738754716e-32,we=22204460492503146e-32,Le=11093356479670487e-47,Ze=ce(4),Ve=ce(8),Ye=ce(12),Ke=ce(16),Be=ce(4);function qe(X,te,We){var rt=function(ht,ut,xt,$t,xi,ki){var ui=(ut-ki)*(xt-xi),Vi=(ht-xi)*($t-ki),en=ui-Vi;if(ui===0||Vi===0||ui>0!=Vi>0)return en;var Ai=Math.abs(ui+Vi);return Math.abs(en)>=me*Ai?en:-function(Pn,sn,Oi,On,dn,tn,ln){var Gi,di,Hi,Mn,Nt,Pi,pn,Ln,bn,Zn,Zi,Yn,ar,ba,_a,rr,_s,Kn,na=Pn-dn,va=Oi-dn,Fa=sn-tn,Ma=On-tn;Ze[0]=(_a=(Ln=na-(pn=(Pi=Z*na)-(Pi-na)))*(Zn=Ma-(bn=(Pi=Z*Ma)-(Pi-Ma)))-((ba=na*Ma)-pn*bn-Ln*bn-pn*Zn))-((Zi=_a-(_s=(Ln=Fa-(pn=(Pi=Z*Fa)-(Pi-Fa)))*(Zn=va-(bn=(Pi=Z*va)-(Pi-va)))-((rr=Fa*va)-pn*bn-Ln*bn-pn*Zn)))+(Nt=_a-Zi))+(Nt-_s),Ze[1]=(ar=ba-((Yn=ba+Zi)-(Nt=Yn-ba))+(Zi-Nt))-((Zi=ar-rr)+(Nt=ar-Zi))+(Nt-rr),Ze[2]=Yn-((Kn=Yn+Zi)-(Nt=Kn-Yn))+(Zi-Nt),Ze[3]=Kn;var ru=function(aM,Rk){for(var Bk=Rk[0],D0=1;D0<4;D0++)Bk+=Rk[D0];return Bk}(0,Ze),Em=we*ln;if(ru>=Em||-ru>=Em||(Gi=Pn-(na+(Nt=Pn-na))+(Nt-dn),Hi=Oi-(va+(Nt=Oi-va))+(Nt-dn),di=sn-(Fa+(Nt=sn-Fa))+(Nt-tn),Mn=On-(Ma+(Nt=On-Ma))+(Nt-tn),Gi===0&&di===0&&Hi===0&&Mn===0)||(Em=Le*ln+ee*Math.abs(ru),(ru+=na*Mn+Ma*Gi-(Fa*Hi+va*di))>=Em||-ru>=Em))return ru;Be[0]=(_a=(Ln=Gi-(pn=(Pi=Z*Gi)-(Pi-Gi)))*(Zn=Ma-(bn=(Pi=Z*Ma)-(Pi-Ma)))-((ba=Gi*Ma)-pn*bn-Ln*bn-pn*Zn))-((Zi=_a-(_s=(Ln=di-(pn=(Pi=Z*di)-(Pi-di)))*(Zn=va-(bn=(Pi=Z*va)-(Pi-va)))-((rr=di*va)-pn*bn-Ln*bn-pn*Zn)))+(Nt=_a-Zi))+(Nt-_s),Be[1]=(ar=ba-((Yn=ba+Zi)-(Nt=Yn-ba))+(Zi-Nt))-((Zi=ar-rr)+(Nt=ar-Zi))+(Nt-rr),Be[2]=Yn-((Kn=Yn+Zi)-(Nt=Kn-Yn))+(Zi-Nt),Be[3]=Kn;var b7=pe(4,Ze,4,Be,Ve);Be[0]=(_a=(Ln=na-(pn=(Pi=Z*na)-(Pi-na)))*(Zn=Mn-(bn=(Pi=Z*Mn)-(Pi-Mn)))-((ba=na*Mn)-pn*bn-Ln*bn-pn*Zn))-((Zi=_a-(_s=(Ln=Fa-(pn=(Pi=Z*Fa)-(Pi-Fa)))*(Zn=Hi-(bn=(Pi=Z*Hi)-(Pi-Hi)))-((rr=Fa*Hi)-pn*bn-Ln*bn-pn*Zn)))+(Nt=_a-Zi))+(Nt-_s),Be[1]=(ar=ba-((Yn=ba+Zi)-(Nt=Yn-ba))+(Zi-Nt))-((Zi=ar-rr)+(Nt=ar-Zi))+(Nt-rr),Be[2]=Yn-((Kn=Yn+Zi)-(Nt=Kn-Yn))+(Zi-Nt),Be[3]=Kn;var v7=pe(b7,Ve,4,Be,Ye);Be[0]=(_a=(Ln=Gi-(pn=(Pi=Z*Gi)-(Pi-Gi)))*(Zn=Mn-(bn=(Pi=Z*Mn)-(Pi-Mn)))-((ba=Gi*Mn)-pn*bn-Ln*bn-pn*Zn))-((Zi=_a-(_s=(Ln=di-(pn=(Pi=Z*di)-(Pi-di)))*(Zn=Hi-(bn=(Pi=Z*Hi)-(Pi-Hi)))-((rr=di*Hi)-pn*bn-Ln*bn-pn*Zn)))+(Nt=_a-Zi))+(Nt-_s),Be[1]=(ar=ba-((Yn=ba+Zi)-(Nt=Yn-ba))+(Zi-Nt))-((Zi=ar-rr)+(Nt=ar-Zi))+(Nt-rr),Be[2]=Yn-((Kn=Yn+Zi)-(Nt=Kn-Yn))+(Zi-Nt),Be[3]=Kn;var x7=pe(v7,Ye,4,Be,Ke);return Ke[x7-1]}(ht,ut,xt,$t,xi,ki,Ai)}(X[0],X[1],te[0],te[1],We[0],We[1]);return rt>0?-1:rt<0?1:0}function De(X,te){var We=X.point,rt=te.point;return We[0]>rt[0]?1:We[0]<rt[0]?-1:We[1]!==rt[1]?We[1]>rt[1]?1:-1:function(ht,ut,xt,$t){return ht.left!==ut.left?ht.left?1:-1:qe(xt,ht.otherEvent.point,ut.otherEvent.point)!==0?ht.isBelow(ut.otherEvent.point)?-1:1:!ht.isSubject&&ut.isSubject?1:-1}(X,te,We)}function Re(X,te,We){var rt=new Y(te,!1,X,X.isSubject),ht=new Y(te,!0,X.otherEvent,X.isSubject);return W(X.point,X.otherEvent.point)&&console.warn("what is that, a collapsed segment?",X),rt.contourId=ht.contourId=X.contourId,De(ht,X.otherEvent)>0&&(X.otherEvent.left=!0,ht.left=!1),X.otherEvent.otherEvent=ht,X.otherEvent=rt,We.push(ht),We.push(rt),We}function tt(X,te){return X[0]*te[1]-X[1]*te[0]}function nt(X,te){return X[0]*te[0]+X[1]*te[1]}function Lt(X,te,We){var rt=function(xi,ki,ui,Vi,en){var Ai=[ki[0]-xi[0],ki[1]-xi[1]],Pn=[Vi[0]-ui[0],Vi[1]-ui[1]];function sn(Pi,pn,Ln){return[Pi[0]+pn*Ln[0],Pi[1]+pn*Ln[1]]}var Oi=[ui[0]-xi[0],ui[1]-xi[1]],On=tt(Ai,Pn),dn=On*On,tn=nt(Ai,Ai);if(dn>0){var ln=tt(Oi,Pn)/On;if(ln<0||ln>1)return null;var Gi=tt(Oi,Ai)/On;return Gi<0||Gi>1?null:ln===0||ln===1?[sn(xi,ln,Ai)]:Gi===0||Gi===1?[sn(ui,Gi,Pn)]:[sn(xi,ln,Ai)]}if((dn=(On=tt(Oi,Ai))*On)>0)return null;var di=nt(Ai,Oi)/tn,Hi=di+nt(Ai,Pn)/tn,Mn=Math.min(di,Hi),Nt=Math.max(di,Hi);return Mn<=1&&Nt>=0?Mn===1?[sn(xi,Mn>0?Mn:0,Ai)]:Nt===0?[sn(xi,Nt<1?Nt:1,Ai)]:[sn(xi,Mn>0?Mn:0,Ai),sn(xi,Nt<1?Nt:1,Ai)]:null}(X.point,X.otherEvent.point,te.point,te.otherEvent.point),ht=rt?rt.length:0;if(ht===0||ht===1&&(W(X.point,te.point)||W(X.otherEvent.point,te.otherEvent.point))||ht===2&&X.isSubject===te.isSubject)return 0;if(ht===1)return W(X.point,rt[0])||W(X.otherEvent.point,rt[0])||Re(X,rt[0],We),W(te.point,rt[0])||W(te.otherEvent.point,rt[0])||Re(te,rt[0],We),1;var ut=[],xt=!1,$t=!1;return W(X.point,te.point)?xt=!0:De(X,te)===1?ut.push(te,X):ut.push(X,te),W(X.otherEvent.point,te.otherEvent.point)?$t=!0:De(X.otherEvent,te.otherEvent)===1?ut.push(te.otherEvent,X.otherEvent):ut.push(X.otherEvent,te.otherEvent),xt&&$t||xt?(te.type=w,X.type=te.inOut===X.inOut?k:A,xt&&!$t&&Re(ut[1].otherEvent,ut[0].point,We),2):$t?(Re(ut[0],ut[1].point,We),3):ut[0]!==ut[3].otherEvent?(Re(ut[0],ut[1].point,We),Re(ut[1],ut[2].point,We),3):(Re(ut[0],ut[1].point,We),Re(ut[3].otherEvent,ut[2].point,We),3)}function At(X,te){if(X===te)return 0;if(qe(X.point,X.otherEvent.point,te.point)!==0||qe(X.point,X.otherEvent.point,te.otherEvent.point)!==0)return W(X.point,te.point)?X.isBelow(te.otherEvent.point)?-1:1:X.point[0]===te.point[0]?X.point[1]<te.point[1]?-1:1:De(X,te)===1?te.isAbove(X.point)?-1:1:X.isBelow(te.point)?-1:1;if(X.isSubject!==te.isSubject)return X.isSubject?-1:1;var We=X.point,rt=te.point;return We[0]===rt[0]&&We[1]===rt[1]?(We=X.otherEvent.point)[0]===(rt=te.otherEvent.point)[0]&&We[1]===rt[1]?0:X.contourId>te.contourId?1:-1:De(X,te)===1?1:-1}var ct=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function et(X,te,We,rt){var ht,ut=X+1,xt=te[X].point,$t=te.length;for(ut<$t&&(ht=te[ut].point);ut<$t&&ht[0]===xt[0]&&ht[1]===xt[1];){if(!We[ut])return ut;++ut<$t&&(ht=te[ut].point)}for(ut=X-1;We[ut]&&ut>rt;)ut--;return ut}ct.prototype.isExterior=function(){return this.holeOf==null};var Kt=Pt,kt=Pt;function Pt(X,te){if(!(this instanceof Pt))return new Pt(X,te);if(this.data=X||[],this.length=this.data.length,this.compare=te||Ut,this.length>0)for(var We=(this.length>>1)-1;We>=0;We--)this._down(We)}function Ut(X,te){return X<te?-1:X>te?1:0}Pt.prototype={push:function(X){this.data.push(X),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var X=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),X}},peek:function(){return this.data[0]},_up:function(X){for(var te=this.data,We=this.compare,rt=te[X];X>0;){var ht=X-1>>1,ut=te[ht];if(We(rt,ut)>=0)break;te[X]=ut,X=ht}te[X]=rt},_down:function(X){for(var te=this.data,We=this.compare,rt=this.length>>1,ht=te[X];X<rt;){var ut=1+(X<<1),xt=ut+1,$t=te[ut];if(xt<this.length&&We(te[xt],$t)<0&&(ut=xt,$t=te[xt]),We($t,ht)>=0)break;te[X]=$t,X=ut}te[X]=ht}},Kt.default=kt;var ni=Math.max,ii=Math.min,fi=0;function li(X,te,We,rt,ht,ut){var xt,$t,xi,ki,ui,Vi;for(xt=0,$t=X.length-1;xt<$t;xt++)if(ki=X[xt+1],ui=new Y(xi=X[xt],!1,void 0,te),Vi=new Y(ki,!1,ui,te),ui.otherEvent=Vi,xi[0]!==ki[0]||xi[1]!==ki[1]){ui.contourId=Vi.contourId=We,ut||(ui.isExteriorRing=!1,Vi.isExteriorRing=!1),De(ui,Vi)>0?Vi.left=!0:ui.left=!0;var en=xi[0],Ai=xi[1];ht[0]=ii(ht[0],en),ht[1]=ii(ht[1],Ai),ht[2]=ni(ht[2],en),ht[3]=ni(ht[3],Ai),rt.push(ui),rt.push(Vi)}}var gi=[];function Fi(X,te,We){typeof X[0][0][0]=="number"&&(X=[X]),typeof te[0][0][0]=="number"&&(te=[te]);var rt=function(Ai,Pn,sn){var Oi=null;return Ai.length*Pn.length==0&&(sn===S?Oi=gi:sn===D?Oi=Ai:sn!==E&&sn!==R||(Oi=Ai.length===0?Pn:Ai)),Oi}(X,te,We);if(rt)return rt===gi?null:rt;var ht=[1/0,1/0,-1/0,-1/0],ut=[1/0,1/0,-1/0,-1/0],xt=function(Ai,Pn,sn,Oi,On){var dn,tn,ln,Gi,di,Hi,Mn=new Kt(null,De);for(ln=0,Gi=Ai.length;ln<Gi;ln++)for(di=0,Hi=(dn=Ai[ln]).length;di<Hi;di++)(tn=di===0)&&fi++,li(dn[di],!0,fi,Mn,sn,tn);for(ln=0,Gi=Pn.length;ln<Gi;ln++)for(di=0,Hi=(dn=Pn[ln]).length;di<Hi;di++)tn=di===0,On===D&&(tn=!1),tn&&fi++,li(dn[di],!1,fi,Mn,Oi,tn);return Mn}(X,te,ht,ut,We);if(rt=function(Ai,Pn,sn,Oi,On){var dn=null;return(sn[0]>Oi[2]||Oi[0]>sn[2]||sn[1]>Oi[3]||Oi[1]>sn[3])&&(On===S?dn=gi:On===D?dn=Ai:On!==E&&On!==R||(dn=Ai.concat(Pn))),dn}(X,te,ht,ut,We))return rt===gi?null:rt;for(var $t=function(Ai){var Pn,sn,Oi=function(ln){var Gi,di,Hi,Mn,Nt=[];for(di=0,Hi=ln.length;di<Hi;di++)((Gi=ln[di]).left&&Gi.inResult||!Gi.left&&Gi.otherEvent.inResult)&&Nt.push(Gi);for(var Pi=!1;!Pi;)for(Pi=!0,di=0,Hi=Nt.length;di<Hi;di++)di+1<Hi&&De(Nt[di],Nt[di+1])===1&&(Mn=Nt[di],Nt[di]=Nt[di+1],Nt[di+1]=Mn,Pi=!1);for(di=0,Hi=Nt.length;di<Hi;di++)(Gi=Nt[di]).otherPos=di;for(di=0,Hi=Nt.length;di<Hi;di++)(Gi=Nt[di]).left||(Mn=Gi.otherPos,Gi.otherPos=Gi.otherEvent.otherPos,Gi.otherEvent.otherPos=Mn);return Nt}(Ai),On={},dn=[],tn=function(){if(!On[Pn]){var ln=dn.length,Gi=function(Nt,Pi,pn){var Ln=new ct;if(Nt.prevInResult!=null){var bn=Nt.prevInResult,Zn=bn.outputContourId;if(bn.resultTransition>0){var Zi=Pi[Zn];if(Zi.holeOf!=null){var Yn=Zi.holeOf;Pi[Yn].holeIds.push(pn),Ln.holeOf=Yn,Ln.depth=Pi[Zn].depth}else Pi[Zn].holeIds.push(pn),Ln.holeOf=Zn,Ln.depth=Pi[Zn].depth+1}else Ln.holeOf=null,Ln.depth=Pi[Zn].depth}else Ln.holeOf=null,Ln.depth=0;return Ln}(Oi[Pn],dn,ln),di=function(Nt){On[Nt]=!0,Nt<Oi.length&&Oi[Nt]&&(Oi[Nt].outputContourId=ln)},Hi=Pn,Mn=Pn;for(Gi.points.push(Oi[Pn].point);di(Hi),di(Hi=Oi[Hi].otherPos),Gi.points.push(Oi[Hi].point),!((Hi=et(Hi,Oi,On,Mn))==Mn||Hi>=Oi.length)&&Oi[Hi];);dn.push(Gi)}};for(Pn=0,sn=Oi.length;Pn<sn;Pn++)tn();return dn}(function(Ai,Pn,sn,Oi,On,dn){for(var tn,ln,Gi,di=new s(At),Hi=[],Mn=Math.min(Oi[2],On[2]);Ai.length!==0;){var Nt=Ai.pop();if(Hi.push(Nt),dn===S&&Nt.point[0]>Mn||dn===D&&Nt.point[0]>Oi[2])break;if(Nt.left){ln=tn=di.insert(Nt),tn=tn!==(Gi=di.minNode())?di.prev(tn):null,ln=di.next(ln);var Pi=tn?tn.key:null;if(F(Nt,Pi,dn),ln&&Lt(Nt,ln.key,Ai)===2&&(F(Nt,Pi,dn),F(ln.key,Nt,dn)),tn&&Lt(tn.key,Nt,Ai)===2){var pn=tn;F(Pi,(pn=pn!==Gi?di.prev(pn):null)?pn.key:null,dn),F(Nt,Pi,dn)}}else ln=tn=di.find(Nt=Nt.otherEvent),tn&&ln&&(tn=tn!==Gi?di.prev(tn):null,ln=di.next(ln),di.remove(Nt),ln&&tn&&Lt(tn.key,ln.key,Ai))}return Hi}(xt,0,0,ht,ut,We)),xi=[],ki=0;ki<$t.length;ki++){var ui=$t[ki];if(ui.isExterior()){for(var Vi=[ui.points],en=0;en<ui.holeIds.length;en++)Vi.push($t[ui.holeIds[en]].points);xi.push(Vi)}}return xi}var on={UNION:E,DIFFERENCE:D,INTERSECTION:S,XOR:R};i.diff=function(X,te){return Fi(X,te,D)},i.intersection=function(X,te){return Fi(X,te,S)},i.operations=on,i.union=function(X,te){return Fi(X,te,E)},i.xor=function(X,te){return Fi(X,te,R)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Sv.exports)),Sv.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Eg(n,e,i,r){const s=[],h=r===0?(d,g,y,w,k,A)=>{d.push(new st(A,y+(A-g)/(w-g)*(k-y)))}:(d,g,y,w,k,A)=>{d.push(new st(g+(A-y)/(k-y)*(w-g),A))};for(const d of n){const g=[];for(const y of d){if(y.length<=2)continue;const w=[];for(let S=0;S<y.length-1;S++){const E=y[S].x,D=y[S].y,R=y[S+1].x,F=y[S+1].y,j=r===0?E:D,Y=r===0?R:F;j<e?Y>e&&h(w,E,D,R,F,e):j>i?Y<i&&h(w,E,D,R,F,i):w.push(y[S]),Y<e&&j>=e&&h(w,E,D,R,F,e),Y>i&&j<=i&&h(w,E,D,R,F,i)}let k=y[y.length-1];const A=r===0?k.x:k.y;A>=e&&A<=i&&w.push(k),w.length&&(k=w[w.length-1],w[0].x===k.x&&w[0].y===k.y||w.push(w[0]),g.push(w))}g.length&&s.push(g)}return s}function z5(n,e){const i=P1(n),r=P1([e]),s=Tv.intersection(i,r);return s==null?[]:Pv(s)}function L5(n,e){let r=P1(n,65536);for(;e.valid();e.next()){const[s,h]=e.get(),d=s.x*65536,g=s.y*65536,y=h.x*65536,w=h.y*65536,k=y-d,A=w-g,S=Math.hypot(k,A),E=Math.trunc(A/S*3),D=-Math.trunc(k/S*3);r=Tv.diff(r,[[[d,g],[y,w],[y+E,w+D],[d+E,g+D],[d,g]]])}return Pv(r,1/65536)}function P1(n,e=1){return[n.map(i=>i.map(r=>[r.x*e,r.y*e]))]}function Pv(n,e=1){return n.map(i=>i.map((r,s)=>{const h=r.map(d=>new st(d[0]*e,d[1]*e).round());return s>0&&h.reverse(),h}))}class M1{constructor(e,i){this.layoutVertexArray=new Po,this.indexArray=new fa,this.lineIndexArray=new us,this.triangleSegments=new In,this.lineSegments=new In,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new ss)}update(e,i,r,s,h,d,g,y){this.programConfigurations.updatePaintArrays(e,i,h,r,s,d,g,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,y5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,w5.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,r,s,h,d,g){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,s,h,d,void 0,g)}}class E1{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new M1(e,!1),this.elevationBufferData=new M1(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,r,s){this.hasPattern=S1("fill",this.layers,this.pixelRatio,i);const h=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:g,id:y,index:w,sourceLayerIndex:k}of e){const A=this.layers[0]._featureFilter.needGeometry,S=ft(g,A);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview}),S,r))continue;const E=h?h.evaluate(S,{},r,i.availableImages):void 0,D={id:y,properties:g.properties,type:g.type,sourceLayerIndex:k,index:w,geometry:A?S.geometry:bt(g,r,s),patterns:{},sortKey:E};d.push(D)}h&&d.sort((g,y)=>g.sortKey-y.sortKey);for(const g of d){const{geometry:y,index:w,sourceLayerIndex:k}=g;if(this.hasPattern){const A=T1("fill",this.layers,g,this.zoom,this.pixelRatio,i);this.patternFeatures.push(A)}else this.addFeature(g,y,w,r,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[w].feature,y,w,k,this.index)}}update(e,i,r,s,h,d,g){this.bufferData.update(e,i,r,s,h,d,g,this.worldview),this.elevationBufferData.update(e,i,r,s,h,d,g,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,r,s,h,d,g,this.worldview)}addFeatures(e,i,r,s,h,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,r,s,d,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,r,s,h,d=[],g,y){const w=Mg(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,w,s,r,y):this.addGeometry(w,this.bufferData),this.bufferData.populatePaintArrays(e,r,h,d,s,g,this.worldview),this.elevationBufferData.populatePaintArrays(e,r,h,d,s,g,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,r,s,h){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,r,s,h,this.worldview))}addElevatedRoadFeature(e,i,r,s,h){const d=new Array,g=mr.getElevationFeature(e,h);if(!g)return void this.addGeometry(i,this.bufferData);{const w=this.clipPolygonsToTile(i,1);w.length>0&&d.push({polygons:w,elevationFeature:g,elevationTileID:r})}const y={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},r),featureIndex:s};for(const w of d)if(w.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Er(w.elevationTileID,this.layers,this.zoom,this.lut));const A=w.elevationFeature.isTunnel();let S=0;e.properties.hasOwnProperty(un)&&(S=+e.properties[un]);for(const E of w.polygons)this.elevatedStructures.addPortalCandidates(w.elevationFeature.id,E,A,w.elevationFeature,S)}w.elevationFeature.constantHeight==null&&(w.polygons=this.prepareElevatedPolygons(w.polygons,w.elevationFeature,w.elevationTileID));const k=new Vr(r,w.elevationTileID);this.addElevatedGeometry(w.polygons,k,w.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,s,y)}}addElevatedGeometry(e,i,r,s,h,d){const g={elevation:r,elevationSampler:i,bias:s,index:h,featureInfo:d},[y,w]=this.addGeometry(e,this.elevationBufferData,g);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:w}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,w))}addGeometry(e,i,r){let s=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,d=null;r&&(d=r.elevationSampler.constantElevation(r.elevation,r.bias),d!=null&&(s=d,h=d));const g=(y,w,k)=>{if(r!=null)if(w.push(y),d!=null)i.elevatedLayoutVertexArray.emplaceBack(d),k.push(d);else{const A=r.elevationSampler.pointElevation(y,r.elevation,r.bias);i.elevatedLayoutVertexArray.emplaceBack(A),k.push(A),s=Math.min(s,A),h=Math.max(h,A)}};for(const y of e){let w=0;for(const H of y)w+=H.length;const k=i.triangleSegments.prepareSegment(w,i.layoutVertexArray,i.indexArray),A=k.vertexLength,S=[],E=[],D=[],R=[],F=[],j=i.layoutVertexArray.length;for(const H of y){if(H.length===0)continue;H!==y[0]&&E.push(S.length/2);const W=i.lineSegments.prepareSegment(H.length,i.layoutVertexArray,i.lineIndexArray),J=W.vertexLength;r&&F.push(i.layoutVertexArray.length-j),g(H[0],D,R),i.layoutVertexArray.emplaceBack(H[0].x,H[0].y),i.lineIndexArray.emplaceBack(J+H.length-1,J),S.push(H[0].x),S.push(H[0].y);for(let Z=1;Z<H.length;Z++)g(H[Z],D,R),i.layoutVertexArray.emplaceBack(H[Z].x,H[Z].y),i.lineIndexArray.emplaceBack(J+Z-1,J+Z),S.push(H[Z].x),S.push(H[Z].y);W.vertexLength+=H.length,W.primitiveLength+=H.length}const Y=Kp(S,E);for(let H=0;H<Y.length;H+=3)i.indexArray.emplaceBack(A+Y[H],A+Y[H+1],A+Y[H+2]);if(Y.length>0&&r&&this.elevationMode==="hd-road-base"){const H=r.elevation.isTunnel(),W=r.elevation.safeArea,J=this.elevatedStructures.addVertices(D,R);this.elevatedStructures.addTriangles(Y,J,H);const Z=F.length;if(Z>0){for(let ee=0;ee<Z-1;ee++)this.elevatedStructures.addRenderableRing(r.index,F[ee]+J,F[ee+1]-F[ee],H,W,r.featureInfo);this.elevatedStructures.addRenderableRing(r.index,F[Z-1]+J,D.length-F[Z-1],H,W,r.featureInfo)}}k.vertexLength+=w,k.primitiveLength+=Y.length/3}return[s,h]}prepareElevatedPolygons(e,i,r){const s=1/ze(r),h=[];for(const d of e){const g=L5(d,new nr(i,s));h.push(...g)}return h}clipPolygonsToTile(e,i){const r=-i,s=-i,h=lt+i,d=lt+i;let g=0;const y=[],w=[];for(;g<e.length;g++){const S=e[g],E=Qd(S);(E.min.x>=r&&E.max.x<=h&&E.min.y>=s&&E.max.y<=d?y:w).push(S)}if(y.length===e.length)return e;const k=[new st(r,s),new st(h,s),new st(h,d),new st(r,d),new st(r,s)],A=y;for(const S of w)A.push(...z5(S,k));return A}}let Mv,Ev,Cv,Dv;yt(E1,"FillBucket",{omit:["layers","patternFeatures"]}),yt(M1,"FillBufferData"),yt(Er,"ElevatedStructures");class C1{constructor(e,i,r,s){if(this.triangleCount=i.length/3,this.min=new st(0,0),this.max=new st(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[h,d]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const S=e[A];h.x=Math.min(h.x,S.x),h.y=Math.min(h.y,S.y),d.x=Math.max(d.x,S.x),d.y=Math.max(d.y,S.y)}if(s){const A=Math.ceil(Math.max(d.x-h.x,d.y-h.y)/s);r=Math.max(r,A)}if(r===0)return;this.min=h,this.max=d;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const y=Math.max(g.x,g.y)/r;this.cellsX=Math.max(1,Math.ceil(g.x/y)),this.cellsY=Math.max(1,Math.ceil(g.y/y)),this.xScale=1/y,this.yScale=1/y;const w=[];for(let A=0;A<this.triangleCount;A++){const S=e[i[3*A+0]].sub(this.min),E=e[i[3*A+1]].sub(this.min),D=e[i[3*A+2]].sub(this.min),R=fs(Math.floor(Math.min(S.x,E.x,D.x)),this.xScale,this.cellsX),F=fs(Math.floor(Math.max(S.x,E.x,D.x)),this.xScale,this.cellsX),j=fs(Math.floor(Math.min(S.y,E.y,D.y)),this.yScale,this.cellsY),Y=fs(Math.floor(Math.max(S.y,E.y,D.y)),this.yScale,this.cellsY),H=new st(0,0),W=new st(0,0),J=new st(0,0),Z=new st(0,0);for(let ee=j;ee<=Y;++ee){H.y=W.y=ee*y,J.y=Z.y=(ee+1)*y;for(let pe=R;pe<=F;++pe)H.x=J.x=pe*y,W.x=Z.x=(pe+1)*y,(g1(S,E,D,H,W,Z)||g1(S,E,D,H,Z,J))&&w.push({cellIdx:ee*this.cellsX+pe,triIdx:A})}}if(w.length===0)return;w.sort((A,S)=>A.cellIdx-S.cellIdx||A.triIdx-S.triIdx);let k=0;for(;k<w.length;){const A=w[k].cellIdx,S={start:this.payload.length,len:0};for(;k<w.length&&w[k].cellIdx===A;)++S.len,this.payload.push(w[k++].triIdx);this.cells[A]=S}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const r=fs(e.x-this.min.x,this.xScale,this.cellsX),s=fs(e.y-this.min.y,this.yScale,this.cellsY),h=this.cells[s*this.cellsX+r];if(h){this._lazyInitLookup();for(let d=0;d<h.len;d++){const g=this.payload[h.start+d],y=Math.floor(g/8),w=1<<g%8;if(!(this.lookup[y]&w)&&(this.lookup[y]|=w,i.push(g),i.length===this.triangleCount))return}}}query(e,i,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const s=fs(e.x-this.min.x,this.xScale,this.cellsX),h=fs(i.x-this.min.x,this.xScale,this.cellsX),d=fs(e.y-this.min.y,this.yScale,this.cellsY),g=fs(i.y-this.min.y,this.yScale,this.cellsY);for(let y=d;y<=g;y++)for(let w=s;w<=h;w++){const k=this.cells[y*this.cellsX+w];if(k)for(let A=0;A<k.len;A++){const S=this.payload[k.start+A],E=Math.floor(S/8),D=1<<S%8;if(!(this.lookup[E]&D)&&(this.lookup[E]|=D,r.push(S),r.length===this.triangleCount))return}}}}function fs(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}yt(C1,"TriangleGridIndex");class Iv{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const r of this.footprints)i.push({footprint:r,id:e})}populate(e,i,r,s){const h=[];for(const{feature:d,id:g,index:y,sourceLayerIndex:w}of e){const k=this.layers[0]._featureFilter.needGeometry,A=ft(d,k);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview}),A,r))continue;const S={id:g,properties:d.properties,type:d.type,sourceLayerIndex:w,index:y,geometry:k?A.geometry:bt(d,r,s),patterns:{}};h.push(S)}for(const d of h){const{geometry:g,index:y,sourceLayerIndex:w}=d;this.addFeature(d,g,y,r,{},i.availableImages,i.brightness),i.featureIndex.insert(e[y].feature,g,y,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,r,s,h,d,g){}destroy(){}addFeature(e,i,r,s,h,d=[],g){for(const y of Mg(i,2)){const w=[],k=[],A=[],S=new st(1/0,1/0),E=new st(-1/0,-1/0);for(const F of y)if(F.length!==0){F!==y[0]&&A.push(k.length/2);for(let j=0;j<F.length;j++)k.push(F[j].x),k.push(F[j].y),w.push(F[j]),S.x=Math.min(S.x,F[j].x),S.y=Math.min(S.y,F[j].y),E.x=Math.max(E.x,F[j].x),E.y=Math.max(E.y,F[j].y)}const D=Kp(k,A),R=new C1(w,D,8,256);this.footprints.push({vertices:w,indices:D,grid:R,min:S,max:E})}}}yt(Iv,"ClipBucket",{omit:["layers"]});const R5=Ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),B5=Ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),W5=Ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),N5=Ei([{name:"a_join_normal_inside",components:3,type:"Int16"}]),F5=Ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),O5=Ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:$5}=R5,Cg=Number.MAX_SAFE_INTEGER;function zv(n,e,i,r){return n.order<e||n.order===Cg||!(n.clipMask&i)||function(s,h){return h.length!==0&&h.find(d=>d===s)===void 0}(r,n.clipScope)}function Dg(n,e){return n.x-e.x||n.y-e.y}function Lv(n,e){return Dg(n.min,e.min)===0&&Dg(n.max,e.max)===0}function D1(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function I1(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!Lv(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!fo(n[i].clipScope,e[i].clipScope))return!1;return!0}function Rv(n,e,i){const r=1/lt,s=1/(1<<i.canonical.z),h=(e.x*r+i.canonical.x)*s+i.wrap,d=(e.y*r+i.canonical.y)*s;return{min:new st((n.x*r+i.canonical.x)*s+i.wrap,(n.y*r+i.canonical.y)*s),max:new st(h,d)}}function j5(n,e,i){const r=1<<i.canonical.z,s=((e.x-i.wrap)*r-i.canonical.x)*lt,h=(e.y*r-i.canonical.y)*lt;return{min:new st(((n.x-i.wrap)*r-i.canonical.x)*lt,(n.y*r-i.canonical.y)*lt),max:new st(s,h)}}function Bv(n,e,i,r,s,h,d){const g=n.indices,y=n.vertices,w=[];for(let k=r;k<r+s;k+=3){const A=e[i[k+0]+h],S=e[i[k+1]+h],E=e[i[k+2]+h],D=Math.min(A.x,S.x,E.x),R=Math.max(A.x,S.x,E.x),F=Math.min(A.y,S.y,E.y),j=Math.max(A.y,S.y,E.y);w.length=0,n.grid.query(new st(D,F),new st(R,j),w);for(let Y=0;Y<w.length;Y++){const H=w[Y];if(g1(y[g[3*H+0]],y[g[3*H+1]],y[g[3*H+2]],A,S,E,d))return!0}}return!1}function Wv(n,e,i,r){if(!n||!i)return!1;let s=n.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(i.vertices.length<n.vertices.length)return Wv(i,r,n,e);const h=e.canonical,d=r.canonical,g=Math.pow(2,d.z-h.z);s=n.vertices.map(y=>new st((y.x+h.x*lt)*g-d.x*lt,(y.y+h.y*lt)*g-d.y*lt))}return Bv(i,s,n.indices,0,n.indices.length,0,0)}function Nv(n,e,i,r){const s=Math.pow(2,r.z-i.z);return new st((n+i.x*lt)*s-r.x*lt,(e+i.y*lt)*s-r.y*lt)}function Fv(n,e){const i=[];e.grid.queryPoint(n,i);const r=e.indices,s=e.vertices;for(let h=0;h<i.length;h++){const d=i[h];if(ao([s[r[3*d+0]],s[r[3*d+1]],s[r[3*d+2]]],n))return!0}return!1}const z1=[new st(0,0),new st(lt,0),new st(lt,lt),new st(0,lt)];function Ov(n,e){const i=[];let r=[];if(!e||n.length<2)return[n];if(n.length===2)return Zs(n[0],n[1],z1)?[n]:[];for(let s=0;s<n.length+2;s++){const h=n[s%n.length],d=n[(s+1)%n.length],g=Zs(s===0?n[n.length-1]:n[(s-1)%n.length],h,z1),y=Zs(h,d,z1),w=g||y;w&&r.push(h),w&&y||r.length>0&&(r.length>1&&i.push(r),r=[])}return r.length>1&&i.push(r),i}const L1=hi.VectorTileFeature.types,V5=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],U5=["fill-extrusion-flood-light-ground-radius"],J5=Math.pow(2,13),q5=Math.pow(2,15)-1,$v=new st(0,1),eu=2147483648;function im(n,e,i,r,s,h,d,g){n.emplaceBack((e<<1)+d,(i<<1)+h,(Math.floor(r*J5)<<1)+s,Math.round(g))}function nm(n,e,i){n.emplaceBack(e.x*lt,e.y*lt,i?1:0)}function Ig(n,e,i,r,s,h){n.emplaceBack(e.x,e.y,(i.x<<1)+r,(i.y<<1)+s,h)}function am(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class jv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Vv{constructor(){this.centroidXY=new st(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new st(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new st(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}}class Uv{constructor(){this.acc=new st(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,r){this.accCount++,this.acc._add(i);let s=!!this.borders;i.x<e.min.x?(e.min.x=i.x,s=!0):i.x>e.max.x&&(e.max.x=i.x,s=!0),i.y<e.min.y?(e.min.y=i.y,s=!0):i.y>e.max.y&&(e.max.y=i.y,s=!0),((i.x===0||i.x===lt)&&i.x===r.x)!=((i.y===0||i.y===lt)&&i.y===r.y)&&this.processBorderOverlap(i,r),s&&this.checkBorderIntersection(i,r)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Vt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>lt!=e.x>lt&&this.addBorderIntersection(1,Vt(i.y,e.y,(lt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Vt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>lt!=e.y>lt&&this.addBorderIntersection(3,Vt(i.x,e.x,(lt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){return this.accCount===0?new st(0,0):new st(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Jv(n,e){const i=n.add(e)._unit(),r=oe(n.x*i.x+n.y*i.y,-1,1);var s,h,d;return s=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(s)))/4*q5*((h=n).x*(d=e).y-h.y*d.x<0?-1:1)}const G5=[n=>n.x<0,n=>n.x>lt,n=>n.y<0,n=>n.y>lt];function Y5(n,e,i,r){const s=[4];if(r===0)return s;i._mult(r);const h=n.sub(i),d=e.sub(i),g=[n,e,h,d];for(let y=0;y<4;y++)for(const w of g)if(G5[y](w)){s.push(y);break}return s}class qv{constructor(e){this.vertexArray=new jl,this.indexArray=new fa,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut},i=>U5.includes(i)),this._segments=new In,this.hiddenByLandmarkVertexArray=new $h,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new In}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,r,s=!1){const h=e.length;if(h>2){let d=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let y;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const w=e[0],k=e[1];y=Jv(w.sub(e[h-1])._perp()._unit(),k.sub(w)._perp()._unit())}for(let w=0;w<h;w++){const k=w===h-1?0:w+1,A=e[w],S=e[k],E=e[k===h-1?0:k+1],D=S.sub(A)._perp()._unit(),R=Jv(D,E.sub(S)._perp()._unit()),F=y,j=R;if(R1(A,S,i)||s&&Hv(A,i)&&Hv(S,i)){y=R;continue}const Y=g.vertexLength;Ig(this.vertexArray,A,S,1,1,F),Ig(this.vertexArray,A,S,1,0,F),Ig(this.vertexArray,A,S,0,1,j),Ig(this.vertexArray,A,S,0,0,j),g.vertexLength+=4;const H=Y5(A,S,D,r);for(const W of H)this._segmentToGroundQuads[d].push({id:Y,region:W}),this._segmentToRegionTriCounts[d][W]+=2,g.primitiveLength+=2;y=R}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let r=0;r<i;r++)this._segmentToGroundQuads[r].sort((s,h)=>s.region-h.region);for(let r=0;r<i;r++){const s=this._segmentToGroundQuads[r],h=e[r],d=this._segmentToRegionTriCounts[r];d.reduce((y,w)=>y+w,0);let g=0;for(let y=0;y<=4;y++){const w=d[y];if(w!==0){let k=this.regionSegments[y];k||(k=this.regionSegments[y]=new In);const A={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+g,vertexLength:h.vertexLength,primitiveLength:w};k.get().push(A)}g+=w}for(let y=0;y<s.length;y++){const w=s[y].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,r,s,h,d,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,r,s,h,d,void 0,g)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,B5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,r,s,h,d,g,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,r,s,h,d,g,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const r=e.flags&eu?1:0;for(let s=e.groundVertexArrayOffset;s<i;++s)this.hiddenByLandmarkVertexArray.emplace(s,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,F5.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class zg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new fa,this.footprintVertices=new Po,this.footprintSegments=[],this.layoutVertexArray=new $l,this.centroidVertexArray=new mg,this.wallVertexArray=new gg,this.indexArray=new fa,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut},i=>V5.includes(i)),this.segments=new In,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new qv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,r,s){this.features=[],this.hasPattern=S1("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ze(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:d,index:g,sourceLayerIndex:y}of e){const w=this.layers[0]._featureFilter.needGeometry,k=ft(h,w);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview}),k,r))continue;const A={id:d,sourceLayerIndex:y,index:g,geometry:w?k.geometry:bt(h,r,s),properties:h.properties,type:h.type,patterns:{}},S=this.layoutVertexArray.length,E=L1[A.type]==="Polygon";if(this.hasPattern)this.features.push(T1("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const D of A.geometry)for(const R of Ov(D,E))this.addFeature(A,[R],g,r,{},i.availableImages,s,i.brightness);else this.addFeature(A,A.geometry,g,r,{},i.availableImages,s,i.brightness);i.featureIndex.insert(h,A.geometry,g,y,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,r,s,h,d){for(const g of this.features){const y=L1[g.type]==="Polygon",{geometry:w}=g;if(this.wallMode)for(const k of w)for(const A of Ov(k,y))this.addFeature(g,[A],g.index,i,r,s,h,d);else this.addFeature(g,w,g.index,i,r,s,h,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,r,s,h,d,g){this.programConfigurations.updatePaintArrays(e,i,h,r,s,d,g,this.worldview),this.groundEffect.update(e,i,h,r,s,d,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$5),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,N5.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,O5.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,W5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,s,h,d,g,y){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,k=[new st(0,0),new st(lt,lt)],A=g.projection,S=A.name==="globe",E=this.wallMode||L1[e.type]==="Polygon",D=new Uv;D.centroidDataIndex=this.centroidData.length;const R=new Vv,F=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s);let Y;if(R.height=j,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Nh),this.wallMode){if(S)return void ai("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;Y=function(me){const we=me[0].x===me[me.length-1].x&&me[0].y===me[me.length-1].y;(function(ct){let et=0;const Kt=ct.length;for(let kt=0;kt<Kt;kt++)et+=(ct[(kt+1)%Kt].x-ct[kt].x)*(ct[(kt+1)%Kt].y+ct[kt].y);return et>=0})(me)||(me=me.reverse());const Ze={geometry:[],joinNormals:[],indices:[]},Ve=[],Ye=[],Ke=[];let Be=me.length;for(;Be>=2&&me[Be-1].equals(me[Be-2]);)Be--;if(Be<(we?3:2))return Ze;let qe,De,Re,tt,nt,Lt=0;for(;Lt<Be-1&&me[Lt].equals(me[Lt+1]);)Lt++;we&&(qe=me[Be-2],nt=me[Lt].sub(qe)._unit()._perp());for(let ct=Lt;ct<Be;ct++){if(Re=ct===Be-1?we?me[Lt+1]:void 0:me[ct+1],Re&&me[ct].equals(Re))continue;nt&&(tt=nt),qe&&(De=qe),qe=me[ct],nt=Re?Re.sub(qe)._unit()._perp():tt,tt=tt||nt;let et=tt.add(nt);et.x===0&&et.y===0||et._unit();const Kt=et.x*nt.x+et.y*nt.y,kt=Kt!==0?1/Kt:1/0,Pt=tt.x*nt.y-tt.y*nt.x>0;let Ut="miter";const ni=2;Ut==="miter"&&kt>ni&&(Ut="bevel"),Ut==="bevel"&&(kt>100&&(Ut="flipbevel"),kt<ni&&(Ut="miter"));const ii=(fi,li,gi,Fi)=>{const on=new st(fi.x,fi.y),X=new st(fi.x,fi.y);on.x+=li.x*Fi,on.y+=li.y*Fi,X.x-=li.x*Math.max(gi,1),X.y-=li.y*Math.max(gi,1),Ke.push(li),Ve.push(on),Ye.push(X)};if(Ut==="miter")et._mult(kt),ii(qe,et,0,0);else if(Ut==="flipbevel")et=nt.mult(-1),ii(qe,et,0,0),ii(qe,et.mult(-1),0,0);else{const fi=-Math.sqrt(kt*kt-1),li=Pt?fi:0,gi=Pt?0:fi;De&&ii(qe,tt,li,gi),Re&&ii(qe,nt,li,gi)}}Ze.geometry=[...Ve,...Ye.reverse(),Ve[0]],Ze.joinNormals=[...Ke,...Ke.reverse(),Ke[Ke.length-1]];const At=Ze.geometry.length-1;for(let ct=0;ct<At/2;ct++)if(ct+1<At/2){let et=ct,Kt=ct+1,kt=At-1-ct,Pt=At-2-ct;et=et===0?At-1:et-1,Kt=Kt===0?At-1:Kt-1,kt=kt===0?At-1:kt-1,Pt=Pt===0?At-1:Pt-1,Ze.indices.push(kt),Ze.indices.push(Kt),Ze.indices.push(et),Ze.indices.push(kt),Ze.indices.push(Pt),Ze.indices.push(Kt)}return Ze}(i[0]),i=[Y.geometry]}const H=(me,we)=>me<(we.length-1)/2||me===we.length-1,W=this.wallMode?[i]:Mg(i,500);for(let me=W.length-1;me>=0;me--){const we=W[me];(we.length===0||(J=we[0]).every(Le=>Le.x<=0)||J.every(Le=>Le.x>=lt)||J.every(Le=>Le.y<=0)||J.every(Le=>Le.y>=lt))&&W.splice(me,1)}var J;let Z;if(S)Z=Qv(W,k,s);else{Z=[];for(const me of W)Z.push({polygon:me,bounds:k})}const ee=E?this.edgeRadius:0,pe=ee>0&&this.zoom<17,ce=(me,we)=>{if(me.length===0)return!1;const Le=me[me.length-1];return we.x===Le.x&&we.y===Le.y};for(const{polygon:me,bounds:we}of Z){let Le=0,Ze=0;for(const Be of me)E&&!Be[0].equals(Be[Be.length-1])&&Be.push(Be[0]),Ze+=E?Be.length-1:Be.length;const Ve=this.segments.prepareSegment((E?5:4)*Ze,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ke=new jv;if(Ke.vertexOffset=this.footprintVertices.length,Ke.indexOffset=3*this.footprintIndices.length,Ke.ringIndices=[],E){const Be=[],qe=[];Le=Ve.vertexLength;for(let Re=0;Re<me.length;Re++){const tt=me[Re];tt.length&&Re!==0&&qe.push(Be.length/2);const nt=[];let Lt,At;Lt=tt[1].sub(tt[0])._perp()._unit(),Ke.ringIndices.push(tt.length-1);for(let ct=1;ct<tt.length;ct++){const et=tt[ct],Kt=tt[ct===tt.length-1?1:ct+1],kt=et.clone();if(ee){At=Kt.sub(et)._perp()._unit();const Pt=Lt.add(At)._unit(),Ut=ee*Math.min(4,1/(Lt.x*Pt.x+Lt.y*Pt.y));kt.x+=Ut*Pt.x,kt.y+=Ut*Pt.y,kt.x=Math.round(kt.x),kt.y=Math.round(kt.y),Lt=At}if(!F||ee!==0&&!pe||ce(nt,kt)||nt.push(kt),im(this.layoutVertexArray,kt.x,kt.y,0,0,1,1,0),this.wallMode){const Pt=H(ct,tt);nm(this.wallVertexArray,Y.joinNormals[ct],!Pt)}Ve.vertexLength++,this.footprintVertices.emplaceBack(et.x,et.y),Be.push(et.x,et.y),S&&am(this.layoutVertexExtArray,A.projectTilePoint(kt.x,kt.y,s),A.upVector(s,kt.x,kt.y))}F&&(ee===0||pe)&&(nt.length!==0&&ce(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,we,w))}const De=this.wallMode?Y.indices:Kp(Be,qe);for(let Re=0;Re<De.length;Re+=3)this.footprintIndices.emplaceBack(Ke.vertexOffset+De[Re+0],Ke.vertexOffset+De[Re+1],Ke.vertexOffset+De[Re+2]),this.indexArray.emplaceBack(Le+De[Re],Le+De[Re+2],Le+De[Re+1]),Ve.primitiveLength++;Ke.indexCount+=De.length,Ke.vertexCount+=this.footprintVertices.length-Ke.vertexOffset}for(let Be=0;Be<me.length;Be++){const qe=me[Be];D.startRing(R,qe[0]);let De=qe.length>4&&Zv(qe[qe.length-2],qe[0],qe[1]),Re=ee?H5(qe[qe.length-2],qe[0],qe[1],ee):0;const tt=[];let nt,Lt,At;Lt=qe[1].sub(qe[0])._perp()._unit();let ct=!0;for(let et=1,Kt=0;et<qe.length;et++){let kt=qe[et-1],Pt=qe[et];const Ut=qe[et===qe.length-1?1:et+1];if(D.appendEdge(R,Pt,kt),R1(Pt,kt,we)){ee&&(Lt=Ut.sub(Pt)._perp()._unit(),ct=!ct);continue}const ni=Pt.sub(kt)._perp(),ii=ni.x/(Math.abs(ni.x)+Math.abs(ni.y)),fi=ni.y>0?1:0,li=kt.dist(Pt);if(Kt+li>32768&&(Kt=0),ee){At=Ut.sub(Pt)._perp()._unit();let X=Yv(kt,Pt,Ut,Gv(Lt,At),ee);isNaN(X)&&(X=0);const te=Pt.sub(kt)._unit();kt=kt.add(te.mult(Re))._round(),Pt=Pt.add(te.mult(-X))._round(),Re=X,Lt=At,F&&this.zoom>=17&&(ce(tt,kt)||tt.push(kt),ce(tt,Pt)||tt.push(Pt))}const gi=Ve.vertexLength,Fi=qe.length>4&&Zv(kt,Pt,Ut);let on=Kv(Kt,De,ct);if(im(this.layoutVertexArray,kt.x,kt.y,ii,fi,0,0,on),im(this.layoutVertexArray,kt.x,kt.y,ii,fi,0,1,on),this.wallMode){const X=H(et-1,qe),te=Y.joinNormals[et-1];nm(this.wallVertexArray,te,X),nm(this.wallVertexArray,te,X)}if(Kt+=li,on=Kv(Kt,Fi,!ct),De=Fi,im(this.layoutVertexArray,Pt.x,Pt.y,ii,fi,0,0,on),im(this.layoutVertexArray,Pt.x,Pt.y,ii,fi,0,1,on),this.wallMode){const X=H(et,qe),te=Y.joinNormals[et];nm(this.wallVertexArray,te,X),nm(this.wallVertexArray,te,X)}if(Ve.vertexLength+=4,this.indexArray.emplaceBack(gi+0,gi+1,gi+2),this.indexArray.emplaceBack(gi+1,gi+3,gi+2),Ve.primitiveLength+=2,ee){const X=Le+(et===1?qe.length-2:et-2),te=et===1?Le:X+1;if(this.indexArray.emplaceBack(gi+1,X,gi+3),this.indexArray.emplaceBack(X,te,gi+3),Ve.primitiveLength+=2,nt===void 0&&(nt=gi),!R1(Ut,qe[et],we)){const We=et===qe.length-1?nt:Ve.vertexLength;this.indexArray.emplaceBack(gi+2,gi+3,We),this.indexArray.emplaceBack(gi+3,We+1,We),this.indexArray.emplaceBack(gi+3,te,We+1),Ve.primitiveLength+=3}ct=!ct}if(S){const X=this.layoutVertexExtArray,te=A.projectTilePoint(kt.x,kt.y,s),We=A.projectTilePoint(Pt.x,Pt.y,s),rt=A.upVector(s,kt.x,kt.y),ht=A.upVector(s,Pt.x,Pt.y);am(X,te,rt),am(X,te,rt),am(X,We,ht),am(X,We,ht)}}E&&(Le+=qe.length-1),F&&ee&&this.zoom>=17&&(tt.length!==0&&ce(tt,tt[0])&&tt.pop(),this.groundEffect.addData(tt,we,w,ee>0))}this.footprintSegments.push(Ke),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=D.borders?$v:this.encodeCentroid(D,R),this.centroidData.push(R),D.borders){this.featuresOnBorder.push(D);const me=this.featuresOnBorder.length-1;for(let we=0;we<D.borders.length;we++)D.borders[we][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[we].push(me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,d,s,y,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,r,h,d,s,y,this.worldview),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const y=this.centroidData[g],w=+(y.min.y+y.max.y>lt),k=2*w+(+(y.min.x+y.max.x>lt)^w);for(let A=0;A<y.polygonSegLen;A++){const S=y.polygonSegIdx+A;e.push({centroidIdx:g,subtile:k,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}const i=new fa;e.sort((g,y)=>g.triangleSegmentIdx===y.triangleSegmentIdx?g.subtile-y.subtile:g.triangleSegmentIdx-y.triangleSegmentIdx);let r=0,s=0,h=0;for(const g of e){if(g.triangleSegmentIdx!==r)break;h++}const d=e.length;for(;s!==e.length;){r=e[s].triangleSegmentIdx;let g=0,y=s,w=s;for(let k=y;k<h&&e[k].subtile===g;k++)w++;for(;y!==h;){const k=e[y];g=k.subtile;const A=this.centroidData[k.centroidIdx].min.clone(),S=this.centroidData[k.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=y;D<w;D++){const R=e[D],F=this.polygonSegments[R.polygonSegmentIdx],j=this.centroidData[R.centroidIdx].min,Y=this.centroidData[R.centroidIdx].max,H=this.indexArray.uint16;for(let W=F.triangleArrayOffset;W<F.triangleArrayOffset+F.triangleCount;W++)i.emplaceBack(H[3*W],H[3*W+1],H[3*W+2]);E.primitiveLength+=F.triangleCount,A.x=Math.min(A.x,j.x),A.y=Math.min(A.y,j.y),S.x=Math.max(S.x,Y.x),S.y=Math.max(S.y,Y.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:A,max:S}),y=w;for(let D=y;D<h&&e[D].subtile===e[y].subtile;D++)w++}s=h;for(let k=s;k<d&&e[k].triangleSegmentIdx===e[s].triangleSegmentIdx;k++)h++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,r){const s=new In;if(this.wallMode){for(const R of this.triangleSubSegments)s.segments.push(R.segment);return s}let h=0,d=0;const g=1<<e.canonical.z;if(i){const R=i.getMinMaxForTile(e);R&&(h=R.min,d=R.max)}d+=this.maxHeight;const y=e.toUnwrapped();let w;const k=[y.canonical.x/g+y.wrap,y.canonical.y/g],A=[(y.canonical.x+1)/g+y.wrap,(y.canonical.y+1)/g],S=(R,F,j)=>[R[0]*(1-j[0])+F[0]*j[0],R[1]*(1-j[1])+F[1]*j[1]],E=[],D=[];for(const R of this.triangleSubSegments){E[0]=R.min.x/lt,E[1]=R.min.y/lt,D[0]=R.max.x/lt,D[1]=R.max.y/lt;const F=S(k,A,E),j=S(k,A,D);if(new Di([F[0],F[1],h],[j[0],j[1],d]).intersectsPrecise(r)===0){w&&(s.segments.push(w),w=void 0);continue}const Y=R.segment;w&&w.vertexOffset!==Y.vertexOffset&&(s.segments.push(w),w=void 0),w?(w.vertexLength+=Y.vertexLength,w.primitiveLength+=Y.primitiveLength):w={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&s.segments.push(w),s}encodeCentroid(e,i){const r=e.centroid(),s=i.span(),h=Math.min(7,Math.round(s.x*this.tileToMeter/10)),d=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new st(oe(r.x,1,lt-1)<<3|h,oe(r.y,1,lt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new st(0,0);const i=e.borders,r=Number.MAX_VALUE;if(i[0][0]!==r||i[1][0]!==r){const s=i[0][0]!==r?0:1;return new st(6|(i[0][0]!==r?0:65528),(i[s][0]+i[s][1])/2<<3|6)}{const s=i[2][0]!==r?2:3;return new st((i[s][0]+i[s][1])/2<<3|6,6|(i[2][0]!==r?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=eu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,s=e.flags&eu?$v:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==s.y||h!==s.x){for(let d=i;d<r;++d)this.centroidVertexArray.emplace(d,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,r){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());if(I1(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const h=[];for(const d of this.activeReplacements){if(d.order<r)continue;const g=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const y of this.centroidData)if(!(y.flags&eu||d.min.x>y.max.x||y.min.x>d.max.x||d.min.y>y.max.y||y.min.y>d.max.y))for(let w=0;w<y.footprintSegLen;w++){const k=this.footprintSegments[y.footprintSegIdx+w];if(h.length=0,Z5(this.footprintVertices,k.vertexOffset,k.vertexCount,d.footprintTileId.canonical,e.canonical,h),Bv(d.footprint,h,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-g)){y.flags|=eu;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,r){let s=!1;for(let h=0;h<r.footprintSegLen;h++){const d=this.footprintSegments[r.footprintSegIdx+h];let g=0;for(const y of d.ringIndices){for(let w=g,k=y+g-1;w<y+g;k=w++){const A=this.footprintVertices.int16[2*(w+d.vertexOffset)+0],S=this.footprintVertices.int16[2*(w+d.vertexOffset)+1],E=this.footprintVertices.int16[2*(k+d.vertexOffset)+1];S>i!=E>i&&e<(this.footprintVertices.int16[2*(k+d.vertexOffset)+0]-A)*(i-S)/(E-S)+A&&(s=!s)}g=y}}return s}getHeightAtTileCoord(e,i){let r=Number.NEGATIVE_INFINITY,s=!0;const h=4*(e+lt)*lt+(i+lt);if(this.partLookup.hasOwnProperty(h)){const d=this.partLookup[h];return d?{height:d.height,hidden:!!(d.flags&eu)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>r&&(r=d.height,this.partLookup[h]=d,s=!!(d.flags&eu));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:s};this.partLookup[h]=void 0}}function Gv(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function H5(n,e,i,r){const s=e.sub(n)._perp()._unit(),h=i.sub(e)._perp()._unit();return Yv(n,e,i,Gv(s,h),r)}function Yv(n,e,i,r,s){const h=Math.sqrt(1-r*r);return Math.min(n.dist(e)/3,e.dist(i)/3,s*h/r)}function R1(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Hv(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function Zv(n,e,i){if(n.x<0||n.x>=lt||e.x<0||e.x>=lt||i.x<0||i.x>=lt)return!1;const r=i.sub(e),s=r.perp(),h=n.sub(e);return(r.x*h.x+r.y*h.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(h.x*h.x+h.y*h.y))>-.866&&s.x*h.x+s.y*h.y<0}function Kv(n,e,i){const r=e?2|n:-3&n;return i?1|r:-2&r}function Xv(){const n=Math.PI/32,e=Math.tan(n),i=$;return i*Math.sqrt(1+2*e*e)-i}function Qv(n,e,i){const r=1<<i.z,s=he(i.x/r),h=he((i.x+1)/r),d=xe(i.y/r),g=xe((i.y+1)/r);return function(y,w,k,A,S=0,E){const D=[];if(!y.length||!k||!A)return D;const R=(Z,ee)=>{for(const pe of Z)D.push({polygon:pe,bounds:ee})},F=Math.ceil(Math.log2(k)),j=Math.ceil(Math.log2(A)),Y=F-j,H=[];for(let Z=0;Z<Math.abs(Y);Z++)H.push(Y>0?0:1);for(let Z=0;Z<Math.min(F,j);Z++)H.push(0),H.push(1);let W=y;if(W=Eg(W,w[0].y-S,w[1].y+S,1),W=Eg(W,w[0].x-S,w[1].x+S,0),!W.length)return D;const J=[];for(H.length?J.push({polygons:W,bounds:w,depth:0}):R(W,w);J.length;){const Z=J.pop(),ee=Z.depth,pe=H[ee],ce=Z.bounds[0],me=Z.bounds[1],we=pe===0?ce.x:ce.y,Le=pe===0?me.x:me.y,Ze=E?E(pe,we,Le):.5*(we+Le),Ve=Eg(Z.polygons,we-S,Ze+S,pe),Ye=Eg(Z.polygons,Ze-S,Le+S,pe);if(Ve.length){const Ke=[ce,new st(pe===0?Ze:me.x,pe===1?Ze:me.y)];H.length>ee+1?J.push({polygons:Ve,bounds:Ke,depth:ee+1}):R(Ve,Ke)}if(Ye.length){const Ke=[new st(pe===0?Ze:ce.x,pe===1?Ze:ce.y),me];H.length>ee+1?J.push({polygons:Ye,bounds:Ke,depth:ee+1}):R(Ye,Ke)}}return D}(n,e,Math.ceil((h-s)/11.25),Math.ceil((d-g)/11.25),1,(y,w,k)=>{if(y===0)return .5*(w+k);{const A=xe((i.y+w/lt)/r);return(ae(.5*(xe((i.y+k/lt)/r)+A))*r-i.y)*lt}})}function Z5(n,e,i,r,s,h){const d=Math.pow(2,r.z-s.z);for(let g=0;g<i;g++){let y=n.int16[2*(g+e)+0],w=n.int16[2*(g+e)+1];y=(y+s.x*lt)*d-r.x*lt,w=(w+s.y*lt)*d-r.y*lt,h.push(new st(y,w))}}let e2,t2;yt(zg,"FillExtrusionBucket",{omit:["layers","features"]}),yt(Vv,"PartData"),yt(jv,"FootprintSegment"),yt(Uv,"BorderCentroidData"),yt(qv,"GroundEffect");class Pc extends st{constructor(e,i,r){super(e,i),this.z=r}}class i2 extends Pc{constructor(e,i,r,s){super(e,i,r),this.w=s}}function n2(n,e,i,r){const s=i==="x"?"y":"x",h=(r-n[i])/(e[i]-n[i]);n[s]=Math.round(n[s]+(e[s]-n[s])*h),n[i]=r,n.hasOwnProperty("z")&&(n.z=Vt(n.z,e.z,h)),n.hasOwnProperty("w")&&(n.w=Vt(n.w,e.w,h))}function a2(n,e,i,r){const s=i,h=r;for(const d of["x","y"]){let g=n,y=e;g[d]>=y[d]&&(g=e,y=n),g[d]<s&&y[d]>s&&n2(g,y,d,s),g[d]<h&&y[d]>h&&n2(y,g,d,h)}}function Lg(n,e,i,r,s,h){const d=[];for(let g=0;g<n.length;g++){const y=n[g];let w;const k=d.length;let A=0;for(let S=0;S<y.length-1;S++){let E=y[S],D=y[S+1],R=0;const F=A;let j,Y;h&&(R=Math.hypot(D.x-E.x,D.y-E.y),A+=R,j=E,Y=D),E.x<e&&D.x<e||(E.x<e?E=new st(e,E.y+(e-E.x)/(D.x-E.x)*(D.y-E.y))._round():D.x<e&&(D=new st(e,E.y+(e-E.x)/(D.x-E.x)*(D.y-E.y))._round()),E.y<i&&D.y<i||(E.y<i?E=new st(E.x+(i-E.y)/(D.y-E.y)*(D.x-E.x),i)._round():D.y<i&&(D=new st(E.x+(i-E.y)/(D.y-E.y)*(D.x-E.x),i)._round()),E.x>=r&&D.x>=r||(E.x>=r?E=new st(r,E.y+(r-E.x)/(D.x-E.x)*(D.y-E.y))._round():D.x>=r&&(D=new st(r,E.y+(r-E.x)/(D.x-E.x)*(D.y-E.y))._round()),E.y>=s&&D.y>=s||(E.y>=s?E=new st(E.x+(s-E.y)/(D.y-E.y)*(D.x-E.x),s)._round():D.y>=s&&(D=new st(E.x+(s-E.y)/(D.y-E.y)*(D.x-E.x),s)._round()),w&&E.equals(w[w.length-1])||(w=[E],d.push(w),h&&h.push({progress:{min:F+r2(j,Y,E)*R,max:1},parentIndex:g,prevPoint:j,nextPoint:Y})),w.push(D),h&&(h[h.length-1].progress.max=F+r2(j,Y,D)*R,h[h.length-1].nextPoint=Y)))))}if(h&&A>0)for(let S=k;S<d.length;S++)h[S].progress.min/=A,h[S].progress.max/=A}return d}function K5(n,e,i,r,s){if(n.length<2)return void r.push(n);const h=[];for(;e.valid();){const[w,k]=e.get();for(let A=0;A<n.length-1;A++){const S=n[A],E=n[A+1],D=Yp(S,E,w,k);if(D){const[R]=D,F=new st(Vt(S.x,E.x,R),Vt(S.y,E.y,R));h.push({t:A+R,distance:0,point:F})}}e.next()}if(h.length===0)return void r.push(n);h.sort((w,k)=>w.t-k.t);let d=0,g=0,y=[];for(r.push(y);d!==n.length;){if(g===h.length){for(;d!==n.length;)y.length!==0&&y[y.length-1].equals(n[d])||y.push(n[d]),d++;break}h[g].t<=d?(y.length!==0&&y[y.length-1].equals(h[g].point)||y.push(h[g].point),Math.trunc(h[g].t),g++):(y.length!==0&&y[y.length-1].equals(n[d])||y.push(n[d]),d++)}}function r2(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function rm(n,e){return n.x*e.x+n.y*e.y}function o2(n,e){if(n.length===1){let i=0;const r=e[i++];let s;for(;!s||r.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){const h=e[i],d=n[0],g=s.sub(r),y=h.sub(r),w=d.sub(r),k=rm(g,g),A=rm(g,y),S=rm(y,y),E=rm(w,g),D=rm(w,y),R=k*S-A*A,F=(S*E-A*D)/R,j=(k*D-A*E)/R,Y=r.z*(1-F-j)+s.z*F+h.z*j;if(isFinite(Y))return Y}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function s2(n,e,i,r,s,h,d,g){const y=d*s.getElevationAt(n,e,!0,!0),w=h[0]!==0,k=w?h[1]===0?d*(h[0]/7-450):d*function(A,S,E){const D=Math.floor(S[0]/8),R=Math.floor(S[1]/8),F=10*(S[0]-8*D),j=10*(S[1]-8*R),Y=A.getElevationAt(D,R,!0,!0),H=A.getMeterToDEM(E),W=Math.floor(.5*(F*H-1)),J=Math.floor(.5*(j*H-1)),Z=A.tileCoordToPixel(D,R),ee=2*W+1,pe=2*J+1,ce=function(Ye,Ke,Be,qe,De){return[Ye.getElevationAtPixel(Ke,Be,!0),Ye.getElevationAtPixel(Ke+De,Be,!0),Ye.getElevationAtPixel(Ke,Be+De,!0),Ye.getElevationAtPixel(Ke+qe,Be+De,!0)]}(A,Z.x-W,Z.y-J,ee,pe),me=Math.abs(ce[0]-ce[1]),we=Math.abs(ce[2]-ce[3]),Le=Math.abs(ce[0]-ce[2])+Math.abs(ce[1]-ce[3]),Ze=Math.min(.25,.5*H*(me+we)/ee),Ve=Math.min(.25,.5*H*Le/pe);return Y+Math.max(Ze*F,Ve*j)}(s,h,g):y;return{base:y+(i===0?-1:i),top:w?Math.max(k+r,y+i+2):y+r}}class X5{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Q5{constructor(){this.tasks={},this.taskQueue=[],Tt(["process"],this),this.invoker=new X5(this.process),this.nextId=0}add(e,i){const r=this.nextId++,s=function({type:h,isSymbolTile:d,zoom:g}){return g=g||0,h==="message"?0:h!=="maybePrepare"||d?h!=="parseTile"||d?h==="parseTile"&&d?300-g:h==="maybePrepare"&&d?400-g:500:200-g:100-g}(i);if(s===0){try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:i,priority:s,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let s=0;s<this.taskQueue.length;s++){const h=this.tasks[this.taskQueue[s]];h.priority<i&&(i=h.priority,e=s)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class l2{constructor(e,i,r){this.target=e,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Tt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Q5}send(e,i,r,s,h=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[g]=r);const y=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!r,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:ns(i,y)},y),{cancel:()=>{r&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const r=i.id;if(r&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(i.mustQueue||$i(self)){const s=this.callbacks[r],h=this.scheduler.add(()=>this.processTask(r,i),s&&s.metadata||{type:"message"});h&&(this.cancelCallbacks[r]=h)}else this.processTask(r,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const r=this.callbacks[e];delete this.callbacks[e],r&&(i.error?r(as(i.error)):r(null,as(i.data)))}else{const r=new Set,s=i.hasCallback?(d,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?ns(d):null,data:ns(g,r)},r)}:()=>{},h=as(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,h,s);else if(this.parent.getWorkerSource){const d=i.type.split("."),{source:g,scope:y}=h;this.parent.getWorkerSource(i.sourceMapId,d[0],g,y)[d[1]](h,s)}else s(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var om={workerUrl:"",workerClass:null,workerParams:void 0};const B1="mapboxgl_preloaded_worker_pool";class Mc{constructor(){this.active={}}acquire(e,i=Mc.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(om.workerClass!=null?new om.workerClass:new self.Worker(om.workerUrl,om.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[B1]}numActive(){return Object.keys(this.active).length}}Mc.workerCount=2;class Qh{constructor(e,i,r="Worker",s=Mc.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ce();const h=this.workerPool.acquire(this.id,s);for(let d=0;d<h.length;d++){const g=new Qh.Actor(h[d],i,this.id);g.name=`${r} ${d}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,r){ye(this.actors,(s,h)=>{s.send(e,i,h)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let sm,W1;function Rg(){return sm||(sm=new Mc),sm}Qh.Actor=l2;class e6{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),r=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,r/i.BYTES_PER_ELEMENT),r}createFloatArray(e){const i=new Float32Array(e),r=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,r/i.BYTES_PER_ELEMENT),r}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let r=0;r<e.length;++r)this.module.heapU8[i+r]=e.charCodeAt(r);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,r=e.facadeGlazingColorRgb,s=e.roofColorRgb,h=e.wallColorRgb,d=e.normalScale;this.module.setStyle(i[0],i[1],i[2],r[0],r[1],r[2],s[0],s[1],s[2],h[0],h[1],h[2],d[0],d[1],d[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,r){this.module.setFacadeOptions(e,i,r)}generateMesh(e,i){for(const g of e){const y=this.createStringBuffer(g.roofType),w=[0],k=[];for(const E of g.coordinates)if(Array.isArray(E)){for(const D of E)k.push(D.x),k.push(D.y);w.push(k.length)}const A=this.createIntArray(w),S=this.createFloatArray(k);this.module.addFeature(g.id,g.sourceId,g.minHeight,g.height,y,g.roofType.length,S,A,w.length-1),this.module.free(y),this.module.free(A),this.module.free(S)}for(const g of i){let y;y=g.entrances?JSON.parse(g.entrances):[];const w=this.createFloatArray(y),k=[];for(const S of g.coordinates)k.push(S.x),k.push(S.y);const A=this.createFloatArray(k);this.module.addFacade(g.sourceId,g.crossPerc,g.distanceToRoad,w,y.length,A,k.length),this.module.free(w),this.module.free(A)}if(!this.module.generateMesh()){const g=this.module.getLastError();return this.readStringBuffer(g)}const r=this.module.getMeshCount(),s=new Array(r);for(let g=0;g<r;g++){const y=this.module.getPositionsPtr(g),w=this.module.getPositionsLength(g),k=new Float32Array(this.module.heapF32.buffer,y,w),A=this.module.getNormalsPtr(g),S=this.module.getNormalsLength(g),E=new Float32Array(this.module.heapF32.buffer,A,S),D=this.module.getColorsPtr(g),R=this.module.getColorsLength(g),F=new Uint8Array(this.module.heapU8.buffer,D,R),j=this.module.getAOPtr(g),Y=this.module.getAOLength(g),H=new Float32Array(this.module.heapF32.buffer,j,Y),W=this.module.getIndicesPtr(g),J=this.module.getIndicesLength(g),Z=new Int32Array(this.module.heap32.buffer,W,J),ee=this.module.getBuildingPart(g),pe=this.readStringBuffer(ee);s[g]={positions:k,normals:E,colors:F,ao:H,indices:Z,buildingPart:pe}}const h=this.module.getRingCount(),d=[];for(let g=0;g<h;g++){const y=this.module.getRingPtr(g),w=this.module.getRingLength(g),k=new Float32Array(this.module.heapF32.buffer,y,w);d.push(k)}return{meshes:s,modifiedPolygonRings:d}}}let lm,N1,Co,ed,F1,td=null,id=null,u2=null,O1=null;function c2(){return $i(self)&&self.worker.dracoUrl?self.worker.dracoUrl:N1||pa.DRACO_URL}function h2(){if($i(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ed)return ed;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ed=WebAssembly.validate(n)?pa.MESHOPT_SIMD_URL:pa.MESHOPT_URL,ed}const Bg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},t6={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},um={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function d2(n,e,i){const r=i.json.bufferViews.length,s=i.buffers.length;e.bufferView=r,i.json.bufferViews[r]={buffer:s,byteLength:n.byteLength},i.buffers[s]=n}const $1="KHR_draco_mesh_compression";function i6(n,e){const i=n.extensions&&n.extensions[$1];if(!i)return;const r=new Co.Decoder,s=g2(e,i.bufferView),h=new Co.Mesh;if(!r.DecodeArrayToMesh(s,s.byteLength,h))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[n.indices],g=Bg[d.componentType],y=d.count*g.BYTES_PER_ELEMENT,w=Co._malloc(y);g===Uint16Array?r.GetTrianglesUInt16Array(h,y,w):r.GetTrianglesUInt32Array(h,y,w),d2(Co.memory.buffer.slice(w,w+y),d,e),Co._free(w);for(const k of Object.keys(i.attributes)){const A=r.GetAttributeByUniqueId(h,i.attributes[k]),S=e.json.accessors[n.attributes[k]],E=t6[S.componentType],D=S.count*um[S.type]*Bg[S.componentType].BYTES_PER_ELEMENT,R=Co._malloc(D);r.GetAttributeDataArrayForAllPoints(h,A,Co[E],D,R),d2(Co.memory.buffer.slice(R,R+D),S,e),Co._free(R)}r.destroy(),h.destroy(),delete n.extensions[$1]}const Wg="EXT_meshopt_compression";function n6(n,e){if(!n.extensions||!n.extensions[Wg])return;const i=n.extensions[Wg],r=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),s=new Uint8Array(i.count*i.byteStride);F1.decodeGltfBuffer(s,i.count,i.byteStride,r,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=s.buffer,delete n.extensions[Wg]}const p2=1179937895,m2=new TextDecoder("utf8");function f2(n,e){return new URL(n,e).href}function a6(n,e,i,r){return fetch(f2(n.uri,r)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[i]=s})}function g2(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function r6(n,e,i,r){if(n.uri){const s=f2(n.uri,r);return fetch(s).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[i]=h})}if(n.bufferView!==void 0){const s=g2(e,n.bufferView),h=new Blob([s],{type:n.mimeType});return createImageBitmap(h).then(d=>{e.images[i]=d})}}function _2(n,e=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===p2){const k=new Uint32Array(n,e);let A=2;const S=(k[A++]>>2)-3,E=k[A++]>>2;if(A++,r.json=JSON.parse(m2.decode(k.subarray(A,A+E))),A+=E,A<S){const D=k[A++];A++;const R=e+(A<<2);r.buffers[0]=n.slice(R,R+D)}}else r.json=JSON.parse(m2.decode(new Uint8Array(n,e)));const{buffers:s,images:h,meshes:d,extensionsUsed:g,bufferViews:y}=r.json;let w=Promise.resolve();if(s){const k=[];for(let A=0;A<s.length;A++){const S=s[A];S.uri?k.push(a6(S,r,A,i)):r.buffers[A]||(r.buffers[A]=null)}w=Promise.all(k)}return w.then(()=>{const k=[],A=g&&g.includes($1),S=g&&g.includes(Wg);if(A&&k.push(function(){if(!Co)return lm??(lm=function(E){let D,R=null;function F(){D=new Uint8Array(R.buffer)}function j(){throw new Error("Unexpected Draco error.")}const Y={a:{a:j,d:function(H,W,J){return D.copyWithin(H,W,W+J)},c:function(H){const W=D.length,J=Math.max(H>>>0,Math.ceil(1.2*W)),Z=Math.ceil((J-W)/65536);try{return R.grow(Z),F(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,Y):E.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,Y))).then(H=>{const{Rb:W,Qb:J,P:Z,T:ee,X:pe,Ja:ce,La:me,Qa:we,Va:Le,Wa:Ze,eb:Ve,jb:Ye,f:Ke,e:Be,yb:qe,zb:De,Ab:Re,Bb:tt,Db:nt,Gb:Lt}=H.instance.exports;R=Be;const At=(()=>{let ct=0,et=0,Kt=0,kt=0;return Pt=>{Kt&&(W(kt),W(ct),et+=Kt,Kt=ct=0),ct||(et+=128,ct=J(et));const Ut=Pt.length+7&-8;let ni=ct;Ut>=et&&(Kt=Ut,ni=kt=J(Ut));for(let ii=0;ii<Pt.length;ii++)D[ni+ii]=Pt[ii];return ni}})();return F(),Ke(),{memory:Be,_free:W,_malloc:J,Mesh:class{constructor(){this.ptr=Z()}destroy(){ee(this.ptr)}},Decoder:class{constructor(){this.ptr=ce()}destroy(){Ye(this.ptr)}DecodeArrayToMesh(ct,et,Kt){const kt=At(ct),Pt=me(this.ptr,kt,et,Kt.ptr);return!!pe(Pt)}GetAttributeByUniqueId(ct,et){return{ptr:we(this.ptr,ct.ptr,et)}}GetTrianglesUInt16Array(ct,et,Kt){Le(this.ptr,ct.ptr,et,Kt)}GetTrianglesUInt32Array(ct,et,Kt){Ze(this.ptr,ct.ptr,et,Kt)}GetAttributeDataArrayForAllPoints(ct,et,Kt,kt,Pt){Ve(this.ptr,ct.ptr,et.ptr,Kt,kt,Pt)}},DT_INT8:qe(),DT_UINT8:De(),DT_INT16:Re(),DT_UINT16:tt(),DT_UINT32:nt(),DT_FLOAT32:Lt()}})}(fetch(c2())),lm.then(E=>{Co=E,lm=void 0}))}()),S&&k.push(function(){if(F1)return;const E=function(D){let R;const F=WebAssembly.instantiateStreaming(D,{}).then(H=>{R=H.instance,R.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:F,supported:!0,decodeGltfBuffer(H,W,J,Z,ee,pe){(function(ce,me,we,Le,Ze,Ve,Ye){const Ke=ce.exports.sbrk,Be=Le+3&-4,qe=Ke(Be*Ze),De=Ke(Ve.length),Re=new Uint8Array(ce.exports.memory.buffer);Re.set(Ve,De);const tt=me(qe,Le,Ze,De,Ve.length);if(tt===0&&Ye&&Ye(qe,Be,Ze),we.set(Re.subarray(qe,qe+Le*Ze)),Ke(qe-Ke(0)),tt!==0)throw new Error(`Malformed buffer data: ${tt}`)})(R,R.exports[Y[ee]],H,W,J,Z,R.exports[j[pe]])}}}(fetch(h2()));return E.ready.then(()=>{F1=E})}()),h)for(let E=0;E<h.length;E++)k.push(r6(h[E],r,E,i));return(k.length?Promise.all(k):Promise.resolve()).then(()=>{if(A&&d)for(const{primitives:E}of d)for(const D of E)i6(D,r);if(S&&d&&y)for(const E of y)n6(E,r);return r})})}class y2{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(O1!=null||u2!=null)return null;if(id!=null)return id;const e=fetch(pa.BUILDING_GEN_URL);return id=function(i){let r,s,h,d;function g(){r=new Uint8Array(d.buffer),s=new Int32Array(d.buffer),h=new Float32Array(d.buffer)}function y(){throw new Error("Unexpected BuildingGen error.")}const w=()=>{},k={a:{a:y,f:function(A){const S=r.length,E=Math.max(A>>>0,Math.ceil(1.2*S)),D=Math.ceil((E-S)/65536);try{return d.grow(D),g(),!0}catch{return!1}},g:y,b:w,c:w,d:w,e:w}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,k):i.then(A=>A.arrayBuffer()).then(A=>WebAssembly.instantiate(A,k))).then(A=>{const S=A.instance.exports;return(0,S.g)(),d=S.f,g(),new e6({setStyle:S.h,setAOOptions:S.i,setMetricOptions:S.j,setFacadeOptions:S.k,addFeature:S.l,addFacade:S.m,generateMesh:S.n,getLastError:S.o,getMeshCount:S.p,getPositionsPtr:S.q,getPositionsLength:S.r,getNormalsPtr:S.s,getNormalsLength:S.t,getColorsPtr:S.u,getColorsLength:S.v,getAOPtr:S.w,getAOLength:S.x,getIndicesPtr:S.y,getIndicesLength:S.z,getBuildingPart:S.A,getRingCount:S.B,getRingPtr:S.C,getRingLength:S.D,free:S.E,malloc:S.F,heapU8:r,heap32:s,heapF32:h})})}(e).then(i=>(id=null,O1=i,O1)).catch(i=>{ai("Could not load building-gen"),id=null,u2=i}),id}()}populate(e,i,r,s){}update(e,i,r,s,h,d,g){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let w2,b2;yt(y2,"BuildingBucket",{omit:["layers"]});const o6=Ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),s6=Ei([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:l6}=o6,u6=Ei([{name:"a_packed",components:3,type:"Float32"}]),{members:c6}=u6,h6=Ei([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:d6}=h6;class v2{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ql({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=ot(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const s=[];let h=e.length%2==1?-e[e.length-1]*r:0,d=e[0]*r,g=!0;s.push({left:h,right:d,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){g=!g;const k=e[w];h=y*r,y+=k,d=y*r,s.push({left:h,right:d,isDash:g,zeroLength:k===0})}return s}addRoundDash(e,i,r){const s=i/2;for(let h=-r;h<=r;h++){const d=this.width*(this.nextRow+r+h);let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const k=Math.abs(w-y.left),A=Math.abs(w-y.right),S=Math.min(k,A);let E;const D=h/r*(s+1);if(y.isDash){const R=s-Math.abs(D);E=Math.sqrt(S*S+R*R)}else E=s-Math.sqrt(S*S+D*D);this.image.data[d+w]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){const w=e[y],k=e[y+1];w.zeroLength?e.splice(y,1):k&&k.isDash===w.isDash&&(k.left=w.left,e.splice(y,1))}const r=e[0],s=e[e.length-1];r.isDash===s.isDash&&(r.left=s.left-this.width,s.right=r.right+this.width);const h=this.width*this.nextRow;let d=0,g=e[d];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++d]);const w=Math.abs(y-g.left),k=Math.abs(y-g.right),A=Math.min(w,k);this.image.data[h+y]=Math.max(0,Math.min(255,(g.isDash?A:-A)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const s=i==="round",h=s?7:0,d=2*h+1;if(this.nextRow+d>this.height)return ai("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let k=0;k<e.length;k++)e[k]<0&&(ai("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),g+=e[k];if(g!==0){const k=this.width/g,A=this.getDashRanges(e,this.width,k);s?this.addRoundDash(A,k,h):this.addRegularDash(A,i==="square"?.5*k:0)}const y=this.nextRow+h;this.nextRow+=d;const w={tl:[y,h],br:[g,0]};return this.positions[r]=w,w}}yt(v2,"LineAtlas");const p6=hi.VectorTileFeature.types,m6=Math.cos(Math.PI/180*37.5),f6=Math.cos(Math.PI/180*5);class j1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Lp,this.layoutVertexArray2=new to,this.patternVertexArray=new to,this.indexArray=new fa,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new In,this.maxLineLength=0,this.zOffsetVertexArray=new to,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:lt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,r,s){this.hasPattern=S1("line",this.layers,this.pixelRatio,i);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ze(r);const d=this.layers[0].layout.get("line-elevation-reference");if(d==="hd-road-markup")this.elevationType="road";else{const S=this.layers[0].layout.get("line-z-offset"),E=S.isConstant()&&!S.constantOr(0);this.elevationType=d!=="sea"&&d!=="ground"&&E?"none":"offset",this.elevationType==="offset"&&d==="none"&&ai(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;const y=[];for(const{feature:S,id:E,index:D,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,j=ft(S,F);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview}),j,r))continue;const Y=h?h.evaluate(j,{},r):void 0,H={id:E,properties:S.properties,type:S.type,sourceLayerIndex:R,index:D,geometry:F?j.geometry:bt(S,r,s),patterns:{},sortKey:Y};y.push(H)}h&&y.sort((S,E)=>S.sortKey-E.sortKey);const{lineAtlas:w,featureIndex:k}=i,A=this.addConstantDashes(w);for(const S of y){const{geometry:E,index:D,sourceLayerIndex:R}=S;if(A&&this.addFeatureDashes(S,w),this.hasPattern){const F=T1("line",this.layers,S,this.zoom,this.pixelRatio,i);this.patternFeatures.push(F)}else this.addFeature(S,E,D,r,w.positions,i.availableImages,i.brightness,i.elevationFeatures);k.insert(e[D].feature,E,D,R,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const s=r.paint.get("line-dasharray").value,h=r.layout.get("line-cap").value;if(s.kind!=="constant"||h.kind!=="constant")i=!0;else{const d=h.value,g=s.value;if(!g)continue;e.addDash(g,d)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if(h.kind==="constant"&&d.kind==="constant")continue;let g,y;if(h.kind==="constant"){if(g=h.value,!g)continue}else g=h.evaluate({zoom:r},e);y=d.kind==="constant"?d.value:d.evaluate({zoom:r},e),i.addDash(g,y),e.patterns[s.id]=[i.getKey(g,y)]}}update(e,i,r,s,h,d,g,y){this.programConfigurations.updatePaintArrays(e,i,h,r,s,d,g,y)}addFeatures(e,i,r,s,h,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,r,s,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,c6)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,d6)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,s6.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l6),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,s,h,d,g,y){const w=this.layers[0].layout,k=w.get("line-join").evaluate(e,{}),A=w.get("line-cap").evaluate(e,{}),S=w.get("line-miter-limit"),E=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;const D=this.layers[0].paint.get("line-width").value;if(D.kind!=="constant"&&D.isLineProgressConstant===!1&&(this.variableWidthValue=D),this.elevationType==="road"){const R=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,s,y,k,A,S,E)){const[F,j]=this.clipRuntimeLinesToTile(i,1);for(let Y=0;Y<F.length;Y++){const H=F[Y],W=j[Y],J={progress:{min:W.progress.min,max:W.progress.max},nextDir:this.computeSegNextDir(W,H),prevDir:this.computeSegPrevDir(W,H)};this.addLine(H,e,s,k,A,S,E,J)}this.fillNonElevatedRoadSegment(R)}}else for(const R of i)this.addLine(R,e,s,k,A,S,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,d,s,g,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Lg(e,-i,-i,lt+i,lt+i)}clipRuntimeLinesToTile(e,i){const r=[];return[Lg(e,-i,-i,lt+i,lt+i,r),r]}addElevatedRoadFeature(e,i,r,s,h,d,g,y){const w=[],k=mr.getElevationFeature(e,s);if(k){const A=this.clipLinesToTile(i,1),S=this.prepareElevatedLines(A,k,r);for(const E of S)w.push({geometry:E,elevation:k,elevationTileID:r,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(w.length===0)return!1;for(const A of w){const S=this.layoutVertexArray.length;this.addLine(A.geometry,e,r,h,d,g,y);const E=new Vr(r,A.elevationTileID);if(A.elevation)for(let D=S;D<this.layoutVertexArray.length;D++){const R=new st(this.layoutVertexArray.int16[6*D]>>1,this.layoutVertexArray.int16[6*D+1]>>1),F=E.pointElevation(R,A.elevation,.05);this.updateHeightRange(F),this.zOffsetVertexArray.emplaceBack(F,0,0)}else this.fillNonElevatedRoadSegment(S)}return!0}prepareElevatedLines(e,i,r){if(i.constantHeight!=null)return e;const s=[],h=1/ze(r);for(const d of e)K5(d,new nr(i,h),0,s);return s}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,r,s,h,d,g,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=s==="none";this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const k=y&&y.progress.min>0,A=y&&y.progress.max<1;if(this.lineClips){let pe={min:this.lineClips.start,max:this.lineClips.end},ce=1;if(y){const Le=this.lineClips.end-this.lineClips.start;pe=function(Ze,Ve,Ye){return{min:Eu(Ze.min,Ve,Ye),max:Eu(Ze.max,Ve,Ye)}}(y.progress,{min:0,max:1},pe),Le>0&&(ce=(pe.max-pe.min)/Le)}const me=+i.properties.mapbox_clip_feature_len,we=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(me)||Number.isNaN(we)){for(let Ze=0;Ze<e.length-1;Ze++)this.totalDistance+=e[Ze].dist(e[Ze+1]);const Le=this.totalDistance/(pe.max-pe.min);this.totalFeatureLength=Number.isFinite(Le)?Le:0,this.lineClips.start=pe.min,this.lineClips.end=pe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=me,this.distance=we*ce,this.lineClips.start=pe.min,this.lineClips.end=pe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const S=p6[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let D=0;for(;D<E-1&&e[D].equals(e[D+1]);)D++;if(E<(S?3:2))return;s==="bevel"&&(d=1.05);const R=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let F,j,Y,H,W,J,Z,ee;y&&y.prevDir&&(J=y.prevDir.perp()),y&&y.nextDir&&(Z=y.nextDir.perp()),this.e1=this.e2=-1,S&&(F=e[E-2],W=e[D].sub(F)._unit()._perp());for(let pe=D;pe<E;pe++){if(Y=pe===E-1?S?e[D+1]:void 0:e[pe+1],Y&&e[pe].equals(Y))continue;W&&(H=W),F&&(j=F),F=e[pe],ee=this.evaluateLineProgressFeatures(j?j.dist(F):0),W=Y?Y.sub(F)._unit()._perp():H,H=H||W;const ce=j&&Y;let me=ce?s:S||w?"butt":h;const we=H.x*W.x+H.y*W.y;if(w){const De=function(Re){if(Re.patternJoinNone){const tt=Re.segmentPoints.length/2,nt=Re.lineSoFar-Re.segmentStart;for(let Lt=0;Lt<tt;++Lt){const At=Re.segmentPoints[2*Lt+1],ct=Math.round(Re.segmentPoints[2*Lt])+.5+.25*At;Re.patternVertexArray.emplaceBack(ct,nt,Re.segmentStart),Re.patternVertexArray.emplaceBack(ct,nt,Re.segmentStart)}Re.segmentPoints.length=0}Re.e1=Re.e2=-1};if(ce&&we<f6){this.updateDistance(j,F),this.addCurrentVertex(F,H,1,1,R,ee),De(this),this.addCurrentVertex(F,W,-1,-1,R,ee);continue}if(j){if(!Y){this.updateDistance(j,F),this.addCurrentVertex(F,H,1,1,R,ee),De(this);continue}me="miter"}}let Le=H.add(W);Le.x===0&&Le.y===0||Le._unit();const Ze=Le.x*W.x+Le.y*W.y,Ve=Ze!==0?1/Ze:1/0,Ye=2*Math.sqrt(2-2*Ze),Ke=Ze<m6&&j&&Y,Be=H.x*W.y-H.y*W.x>0,qe=this.overscaling<=16?15*lt/(512*this.overscaling):0;if(ce&&me==="round"){if(Ve<g)me="miter";else if(Ve<=2){const De=V1(F,-10,lt+10);me=this.elevationType==="offset"&&(De||this.hasCrossSlope)?"miter":"fakeround"}}if(me==="miter"&&Ve>d&&(me="bevel"),me==="bevel"&&(Ve>2&&(me="flipbevel"),Ve<d&&(me="miter")),j&&!(me==="miter"&&Ke)&&this.updateDistance(j,F),me==="miter")if(Ke){const De=F.dist(j);if(De>2*qe){const tt=F.sub(F.sub(j)._mult(qe/De)._round());this.updateDistance(j,tt),this.addCurrentVertex(tt,H,0,0,R,ee),j=tt}this.updateDistance(j,F),Le._mult(Ve),this.addCurrentVertex(F,Le,0,0,R,ee);const Re=F.dist(Y);if(Re>2*qe){const tt=F.add(Y.sub(F)._mult(qe/Re)._round());this.updateDistance(F,tt),this.addCurrentVertex(tt,W,0,0,R,ee),F=tt}}else Le._mult(Ve),this.addCurrentVertex(F,Le,0,0,R,ee);else if(me==="flipbevel"){if(Ve>100)Le=W.mult(-1);else{const De=Ve*H.add(W).mag()/H.sub(W).mag();Le._perp()._mult(De*(Be?-1:1))}this.addCurrentVertex(F,Le,0,0,R,ee),this.addCurrentVertex(F,Le.mult(-1),0,0,R,ee)}else if(me==="bevel"||me==="fakeround"){ee!=null&&j&&this.addCurrentVertex(F,Z||H,-1,-1,R,ee);const De=F.dist(j)<=2*qe&&me!=="bevel",Re=Le.mult(Be?1:-1);Re._mult(Ve);const tt=W.mult(Be?-1:1),nt=H.mult(Be?-1:1),Lt=this.evaluateLineProgressFeatures(this.distance);if(ee==null&&(this.addHalfVertex(F,Re.x,Re.y,!1,!Be,0,R,Lt),De||this.addHalfVertex(F,Re.x+2*nt.x,Re.y+2*nt.y,!1,Be,0,R,Lt)),me==="fakeround"){const At=Math.round(180*Ye/Math.PI/20);this.addHalfVertex(F,nt.x,nt.y,!1,Be,0,R,Lt);for(let ct=0;ct<At;ct++){let et=ct/At;if(et!==.5){const kt=et-.5;et+=et*kt*(et-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*kt*kt+(.848013+we*(.215638*we-1.06021)))}const Kt=tt.sub(nt)._mult(et)._add(nt)._unit();this.addHalfVertex(F,Kt.x,Kt.y,!1,Be,0,R,Lt)}this.addHalfVertex(F,tt.x,tt.y,!1,Be,0,R,Lt)}De||ee!=null||this.addHalfVertex(F,Re.x+2*tt.x,Re.y+2*tt.y,!1,Be,0,R,Lt),ee!=null&&Y&&this.addCurrentVertex(F,J||W,1,1,R,ee)}else if(me==="butt")this.addCurrentVertex(F,Le,0,0,R,ee);else if(me==="square"){if(!j){const De=k?0:-1;this.addCurrentVertex(F,Le,De,De,R,ee)}if(this.addCurrentVertex(F,Le,0,0,R,ee),j){const De=A?0:1;this.addCurrentVertex(F,Le,De,De,R,ee)}}else if(me==="round"){if(j){const De=!ce&&Z?Z:H;this.addCurrentVertex(F,De,0,0,R,ee),!ce&&A||this.addCurrentVertex(F,De,1,1,R,ee,!0)}if(Y){const De=!ce&&J?J:W;!ce&&k||this.addCurrentVertex(F,De,-1,-1,R,ee,!0),this.addCurrentVertex(F,De,0,0,R,ee)}}}}addVerticesTo(e,i,r,s,h,d,g,y,w,k){const A=(i.w-e.w)/this.tessellationStep|0;let S=0;const E=this.scaledDistance;if(A>1){this.lineSoFar=e.w;const R=(i.x-e.x)/A,F=(i.y-e.y)/A,j=(i.z-e.z)/A,Y=(i.w-e.w)/A;for(let H=1;H<A;++H){e.x+=R,e.y+=F,e.z+=j,this.lineSoFar+=Y,S+=Y;const W=this.evaluateLineProgressFeatures(this.prevDistance+S);this.scaledDistance=(this.prevDistance+S)/this.totalDistance,this.addHalfVertex(e,r,s,k,!1,g,w,W),this.addHalfVertex(e,h,d,k,!0,-y,w,W)}}this.lineSoFar=i.w,this.scaledDistance=E;const D=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,r,s,k,!1,g,w,D),this.addHalfVertex(i,h,d,k,!0,-y,w,D)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ai(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,r,s,h,d,g=!1){const y=i.x+i.y*r,w=i.y-i.x*r,k=i.y*s-i.x,A=-i.y-i.x*s;if(d!=null){const S=this.elevationType==="offset",E=-10,D=lt+10,R=d.zOffset,F=new i2(e.x,e.y,R,this.lineSoFar),j=!!S&&V1(e,E,D),Y=this.lineSoFar,H=this.distance;if(this.currentVertex)if(j){const W=this.currentVertexIsOutside,J=this.currentVertex,Z=new i2(e.x,e.y,R,this.lineSoFar);if(a2(J,Z,E,D),!V1(Z,E,D)){if(W){this.e1=this.e2=-1,this.distance-=J.dist(F),this.lineSoFar=J.w;const ee=this.evaluateLineProgressFeatures(J.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(J,y,w,g,!1,r,h,ee),this.addHalfVertex(J,k,A,g,!0,-s,h,ee),this.prevDistance=this.distance}this.distance=this.prevDistance+J.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(J,Z,y,w,k,A,r,s,h,g),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const W=this.currentVertex;if(this.currentVertexIsOutside){a2(W,F,E,D),this.e1=this.e2=-1,this.distance-=W.dist(F),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=W.w;const J=this.evaluateLineProgressFeatures(W.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(W,y,w,g,!1,r,h,J),this.addHalfVertex(W,k,A,g,!0,-s,h,J),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(W,F,y,w,k,A,r,s,h,g)}else j||(this.addHalfVertex(e,y,w,g,!1,r,h,d),this.addHalfVertex(e,k,A,g,!0,-s,h,d));this.currentVertex=F,this.currentVertexIsOutside=j,this.lineSoFar=Y}else this.addHalfVertex(e,y,w,g,!1,r,h,d),this.addHalfVertex(e,k,A,g,!0,-s,h,d)}addHalfVertex({x:e,y:i},r,s,h,d,g,y,w){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(d?1:0),Math.round(63*r)+128,Math.round(63*s)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=Vt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const k=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),y.primitiveLength++),d?this.e2=k:this.e1=k,w!=null&&this.zOffsetVertexArray.emplaceBack(w.zOffset,w.variableWidth,w.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function V1(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let x2,k2;function A2(n,e,i){return e*(lt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}yt(j1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const S2=(n,e,i)=>(1-i)*n+i*e;function T2(n,e){return 1/A2(n,1,e.tileZoom)}function P2(n,e,i,r){return n.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const M2=n=>{const e=[];E2(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const r=n.layout.get("line-join").constantOr("miter")==="none",s=!!n.paint.get("line-pattern").constantOr(1);return r&&s&&e.push("LINE_JOIN_NONE"),e};function E2(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let U1;const C2=()=>U1||(U1={layout:x2||(x2=new Cn({"line-cap":new mt(ve.layout_line["line-cap"]),"line-join":new mt(ve.layout_line["line-join"]),"line-miter-limit":new Qe(ve.layout_line["line-miter-limit"]),"line-round-limit":new Qe(ve.layout_line["line-round-limit"]),"line-sort-key":new mt(ve.layout_line["line-sort-key"]),"line-z-offset":new mt(ve.layout_line["line-z-offset"]),"line-elevation-reference":new Qe(ve.layout_line["line-elevation-reference"]),"line-cross-slope":new Qe(ve.layout_line["line-cross-slope"]),visibility:new Qe(ve.layout_line.visibility),"line-width-unit":new Qe(ve.layout_line["line-width-unit"])})),paint:k2||(k2=new Cn({"line-opacity":new mt(ve.paint_line["line-opacity"]),"line-color":new mt(ve.paint_line["line-color"]),"line-translate":new Qe(ve.paint_line["line-translate"]),"line-translate-anchor":new Qe(ve.paint_line["line-translate-anchor"]),"line-width":new mt(ve.paint_line["line-width"]),"line-gap-width":new mt(ve.paint_line["line-gap-width"]),"line-offset":new mt(ve.paint_line["line-offset"]),"line-blur":new mt(ve.paint_line["line-blur"]),"line-dasharray":new mt(ve.paint_line["line-dasharray"]),"line-pattern":new mt(ve.paint_line["line-pattern"]),"line-pattern-cross-fade":new Qe(ve.paint_line["line-pattern-cross-fade"]),"line-gradient":new Gs(ve.paint_line["line-gradient"]),"line-trim-offset":new Qe(ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new Qe(ve.paint_line["line-trim-fade-range"]),"line-trim-color":new Qe(ve.paint_line["line-trim-color"]),"line-emissive-strength":new Qe(ve.paint_line["line-emissive-strength"]),"line-border-width":new mt(ve.paint_line["line-border-width"]),"line-border-color":new mt(ve.paint_line["line-border-color"]),"line-occlusion-opacity":new Qe(ve.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},U1);class g6 extends mt{possiblyEvaluate(e,i){return i=new Yi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,r,s){return i=Te({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,r,s)}}let cm;function D2(n,e){return e>0?e+2*n:n}const _6=Ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),y6=Ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),w6=Ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const b6=Ei([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),v6=Ei([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),x6=Ei([{name:"a_texb",components:2,type:"Uint16"}]),k6=Ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),A6=Ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const I2=Ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),S6=Ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ei([{name:"triangle",components:3,type:"Uint16"}]),Ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ei([{type:"Float32",name:"offsetX"}]),Ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ha=24;function T6(n,e,i){return n.sections.forEach(r=>{r.text=function(s,h,d){const g=h.layout.get("text-transform").evaluate(d,{});return g==="uppercase"?s=s.toLocaleUpperCase():g==="lowercase"&&(s=s.toLocaleLowerCase()),To.applyArabicShaping&&(s=To.applyArabicShaping(s)),s}(r.text,e,i)}),n}const hm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function P6(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function M6(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var z2,J1,L2,q1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function E6(){return z2||(z2=1,q1.read=function(n,e,i,r,s){var h,d,g=8*s-r-1,y=(1<<g)-1,w=y>>1,k=-7,A=i?s-1:0,S=i?-1:1,E=n[e+A];for(A+=S,h=E&(1<<-k)-1,E>>=-k,k+=g;k>0;h=256*h+n[e+A],A+=S,k-=8);for(d=h&(1<<-k)-1,h>>=-k,k+=r;k>0;d=256*d+n[e+A],A+=S,k-=8);if(h===0)h=1-w;else{if(h===y)return d?NaN:1/0*(E?-1:1);d+=Math.pow(2,r),h-=w}return(E?-1:1)*d*Math.pow(2,h-r)},q1.write=function(n,e,i,r,s,h){var d,g,y,w=8*h-s-1,k=(1<<w)-1,A=k>>1,S=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=r?0:h-1,D=r?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,d=k):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+A>=1?S/y:S*Math.pow(2,1-A))*y>=2&&(d++,y/=2),d+A>=k?(g=0,d=k):d+A>=1?(g=(e*y-1)*Math.pow(2,s),d+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,s),d=0));s>=8;n[i+E]=255&g,E+=D,g/=256,s-=8);for(d=d<<s|g,w+=s;w>0;n[i+E]=255&d,E+=D,d/=256,w-=8);n[i+E-D]|=128*R}),q1}function R2(){if(L2)return J1;L2=1,J1=e;var n=E6();function e(W){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(W)?W:new Uint8Array(W||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,r=1/i,s=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(W){return W.type===e.Bytes?W.readVarint()+W.pos:W.pos+1}function d(W,J,Z){return Z?4294967296*J+(W>>>0):4294967296*(J>>>0)+(W>>>0)}function g(W,J,Z){var ee=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));Z.realloc(ee);for(var pe=Z.pos-1;pe>=W;pe--)Z.buf[pe+ee]=Z.buf[pe]}function y(W,J){for(var Z=0;Z<W.length;Z++)J.writeVarint(W[Z])}function w(W,J){for(var Z=0;Z<W.length;Z++)J.writeSVarint(W[Z])}function k(W,J){for(var Z=0;Z<W.length;Z++)J.writeFloat(W[Z])}function A(W,J){for(var Z=0;Z<W.length;Z++)J.writeDouble(W[Z])}function S(W,J){for(var Z=0;Z<W.length;Z++)J.writeBoolean(W[Z])}function E(W,J){for(var Z=0;Z<W.length;Z++)J.writeFixed32(W[Z])}function D(W,J){for(var Z=0;Z<W.length;Z++)J.writeSFixed32(W[Z])}function R(W,J){for(var Z=0;Z<W.length;Z++)J.writeFixed64(W[Z])}function F(W,J){for(var Z=0;Z<W.length;Z++)J.writeSFixed64(W[Z])}function j(W,J){return(W[J]|W[J+1]<<8|W[J+2]<<16)+16777216*W[J+3]}function Y(W,J,Z){W[Z]=J,W[Z+1]=J>>>8,W[Z+2]=J>>>16,W[Z+3]=J>>>24}function H(W,J){return(W[J]|W[J+1]<<8|W[J+2]<<16)+(W[J+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(W,J,Z){for(Z=Z||this.length;this.pos<Z;){var ee=this.readVarint(),pe=ee>>3,ce=this.pos;this.type=7&ee,W(pe,J,this),this.pos===ce&&this.skip(ee)}return J},readMessage:function(W,J){return this.readFields(W,J,this.readVarint()+this.pos)},readFixed32:function(){var W=j(this.buf,this.pos);return this.pos+=4,W},readSFixed32:function(){var W=H(this.buf,this.pos);return this.pos+=4,W},readFixed64:function(){var W=j(this.buf,this.pos)+j(this.buf,this.pos+4)*i;return this.pos+=8,W},readSFixed64:function(){var W=j(this.buf,this.pos)+H(this.buf,this.pos+4)*i;return this.pos+=8,W},readFloat:function(){var W=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,W},readDouble:function(){var W=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,W},readVarint:function(W){var J,Z,ee=this.buf;return J=127&(Z=ee[this.pos++]),Z<128?J:(J|=(127&(Z=ee[this.pos++]))<<7,Z<128?J:(J|=(127&(Z=ee[this.pos++]))<<14,Z<128?J:(J|=(127&(Z=ee[this.pos++]))<<21,Z<128?J:function(pe,ce,me){var we,Le,Ze=me.buf;if(we=(112&(Le=Ze[me.pos++]))>>4,Le<128||(we|=(127&(Le=Ze[me.pos++]))<<3,Le<128)||(we|=(127&(Le=Ze[me.pos++]))<<10,Le<128)||(we|=(127&(Le=Ze[me.pos++]))<<17,Le<128)||(we|=(127&(Le=Ze[me.pos++]))<<24,Le<128)||(we|=(1&(Le=Ze[me.pos++]))<<31,Le<128))return d(pe,we,ce);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(Z=ee[this.pos]))<<28,W,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var W=this.readVarint();return W%2==1?(W+1)/-2:W/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var W=this.readVarint()+this.pos,J=this.pos;return this.pos=W,W-J>=12&&s?function(Z,ee,pe){return s.decode(Z.subarray(ee,pe))}(this.buf,J,W):function(Z,ee,pe){for(var ce="",me=ee;me<pe;){var we,Le,Ze,Ve=Z[me],Ye=null,Ke=Ve>239?4:Ve>223?3:Ve>191?2:1;if(me+Ke>pe)break;Ke===1?Ve<128&&(Ye=Ve):Ke===2?(192&(we=Z[me+1]))==128&&(Ye=(31&Ve)<<6|63&we)<=127&&(Ye=null):Ke===3?(Le=Z[me+2],(192&(we=Z[me+1]))==128&&(192&Le)==128&&((Ye=(15&Ve)<<12|(63&we)<<6|63&Le)<=2047||Ye>=55296&&Ye<=57343)&&(Ye=null)):Ke===4&&(Le=Z[me+2],Ze=Z[me+3],(192&(we=Z[me+1]))==128&&(192&Le)==128&&(192&Ze)==128&&((Ye=(15&Ve)<<18|(63&we)<<12|(63&Le)<<6|63&Ze)<=65535||Ye>=1114112)&&(Ye=null)),Ye===null?(Ye=65533,Ke=1):Ye>65535&&(Ye-=65536,ce+=String.fromCharCode(Ye>>>10&1023|55296),Ye=56320|1023&Ye),ce+=String.fromCharCode(Ye),me+=Ke}return ce}(this.buf,J,W)},readBytes:function(){var W=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,W);return this.pos=W,J},readPackedVarint:function(W,J){if(this.type!==e.Bytes)return W.push(this.readVarint(J));var Z=h(this);for(W=W||[];this.pos<Z;)W.push(this.readVarint(J));return W},readPackedSVarint:function(W){if(this.type!==e.Bytes)return W.push(this.readSVarint());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readSVarint());return W},readPackedBoolean:function(W){if(this.type!==e.Bytes)return W.push(this.readBoolean());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readBoolean());return W},readPackedFloat:function(W){if(this.type!==e.Bytes)return W.push(this.readFloat());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readFloat());return W},readPackedDouble:function(W){if(this.type!==e.Bytes)return W.push(this.readDouble());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readDouble());return W},readPackedFixed32:function(W){if(this.type!==e.Bytes)return W.push(this.readFixed32());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readFixed32());return W},readPackedSFixed32:function(W){if(this.type!==e.Bytes)return W.push(this.readSFixed32());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readSFixed32());return W},readPackedFixed64:function(W){if(this.type!==e.Bytes)return W.push(this.readFixed64());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readFixed64());return W},readPackedSFixed64:function(W){if(this.type!==e.Bytes)return W.push(this.readSFixed64());var J=h(this);for(W=W||[];this.pos<J;)W.push(this.readSFixed64());return W},skip:function(W){var J=7&W;if(J===e.Varint)for(;this.buf[this.pos++]>127;);else if(J===e.Bytes)this.pos=this.readVarint()+this.pos;else if(J===e.Fixed32)this.pos+=4;else{if(J!==e.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(W,J){this.writeVarint(W<<3|J)},realloc:function(W){for(var J=this.length||16;J<this.pos+W;)J*=2;if(J!==this.length){var Z=new Uint8Array(J);Z.set(this.buf),this.buf=Z,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(W){this.realloc(4),Y(this.buf,W,this.pos),this.pos+=4},writeSFixed32:function(W){this.realloc(4),Y(this.buf,W,this.pos),this.pos+=4},writeFixed64:function(W){this.realloc(8),Y(this.buf,-1&W,this.pos),Y(this.buf,Math.floor(W*r),this.pos+4),this.pos+=8},writeSFixed64:function(W){this.realloc(8),Y(this.buf,-1&W,this.pos),Y(this.buf,Math.floor(W*r),this.pos+4),this.pos+=8},writeVarint:function(W){(W=+W||0)>268435455||W<0?function(J,Z){var ee,pe;if(J>=0?(ee=J%4294967296|0,pe=J/4294967296|0):(pe=~(-J/4294967296),4294967295^(ee=~(-J%4294967296))?ee=ee+1|0:(ee=0,pe=pe+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),function(ce,me,we){we.buf[we.pos++]=127&ce|128,ce>>>=7,we.buf[we.pos++]=127&ce|128,ce>>>=7,we.buf[we.pos++]=127&ce|128,ce>>>=7,we.buf[we.pos++]=127&ce|128,we.buf[we.pos]=127&(ce>>>=7)}(ee,0,Z),function(ce,me){var we=(7&ce)<<4;me.buf[me.pos++]|=we|((ce>>>=3)?128:0),ce&&(me.buf[me.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(me.buf[me.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(me.buf[me.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(me.buf[me.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(me.buf[me.pos++]=127&ce)))))}(pe,Z)}(W,this):(this.realloc(4),this.buf[this.pos++]=127&W|(W>127?128:0),W<=127||(this.buf[this.pos++]=127&(W>>>=7)|(W>127?128:0),W<=127||(this.buf[this.pos++]=127&(W>>>=7)|(W>127?128:0),W<=127||(this.buf[this.pos++]=W>>>7&127))))},writeSVarint:function(W){this.writeVarint(W<0?2*-W-1:2*W)},writeBoolean:function(W){this.writeVarint(!!W)},writeString:function(W){W=String(W),this.realloc(4*W.length),this.pos++;var J=this.pos;this.pos=function(ee,pe,ce){for(var me,we,Le=0;Le<pe.length;Le++){if((me=pe.charCodeAt(Le))>55295&&me<57344){if(!we){me>56319||Le+1===pe.length?(ee[ce++]=239,ee[ce++]=191,ee[ce++]=189):we=me;continue}if(me<56320){ee[ce++]=239,ee[ce++]=191,ee[ce++]=189,we=me;continue}me=we-55296<<10|me-56320|65536,we=null}else we&&(ee[ce++]=239,ee[ce++]=191,ee[ce++]=189,we=null);me<128?ee[ce++]=me:(me<2048?ee[ce++]=me>>6|192:(me<65536?ee[ce++]=me>>12|224:(ee[ce++]=me>>18|240,ee[ce++]=me>>12&63|128),ee[ce++]=me>>6&63|128),ee[ce++]=63&me|128)}return ce}(this.buf,W,this.pos);var Z=this.pos-J;Z>=128&&g(J,Z,this),this.pos=J-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(W){this.realloc(4),n.write(this.buf,W,this.pos,!0,23,4),this.pos+=4},writeDouble:function(W){this.realloc(8),n.write(this.buf,W,this.pos,!0,52,8),this.pos+=8},writeBytes:function(W){var J=W.length;this.writeVarint(J),this.realloc(J);for(var Z=0;Z<J;Z++)this.buf[this.pos++]=W[Z]},writeRawMessage:function(W,J){this.pos++;var Z=this.pos;W(J,this);var ee=this.pos-Z;ee>=128&&g(Z,ee,this),this.pos=Z-1,this.writeVarint(ee),this.pos+=ee},writeMessage:function(W,J,Z){this.writeTag(W,e.Bytes),this.writeRawMessage(J,Z)},writePackedVarint:function(W,J){J.length&&this.writeMessage(W,y,J)},writePackedSVarint:function(W,J){J.length&&this.writeMessage(W,w,J)},writePackedBoolean:function(W,J){J.length&&this.writeMessage(W,S,J)},writePackedFloat:function(W,J){J.length&&this.writeMessage(W,k,J)},writePackedDouble:function(W,J){J.length&&this.writeMessage(W,A,J)},writePackedFixed32:function(W,J){J.length&&this.writeMessage(W,E,J)},writePackedSFixed32:function(W,J){J.length&&this.writeMessage(W,D,J)},writePackedFixed64:function(W,J){J.length&&this.writeMessage(W,R,J)},writePackedSFixed64:function(W,J){J.length&&this.writeMessage(W,F,J)},writeBytesField:function(W,J){this.writeTag(W,e.Bytes),this.writeBytes(J)},writeFixed32Field:function(W,J){this.writeTag(W,e.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(W,J){this.writeTag(W,e.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(W,J){this.writeTag(W,e.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(W,J){this.writeTag(W,e.Fixed64),this.writeSFixed64(J)},writeVarintField:function(W,J){this.writeTag(W,e.Varint),this.writeVarint(J)},writeSVarintField:function(W,J){this.writeTag(W,e.Varint),this.writeSVarint(J)},writeStringField:function(W,J){this.writeTag(W,e.Bytes),this.writeString(J)},writeFloatField:function(W,J){this.writeTag(W,e.Fixed32),this.writeFloat(J)},writeDoubleField:function(W,J){this.writeTag(W,e.Fixed64),this.writeDouble(J)},writeBooleanField:function(W,J){this.writeVarintField(W,!!J)}},J1}var Ng=Go(R2());const G1=3;function C6(n,e,i){e.glyphs=[],n===1&&i.readMessage(D6,e)}function D6(n,e,i){if(n===3){const{id:r,bitmap:s,width:h,height:d,left:g,top:y,advance:w}=i.readMessage(I6,{});e.glyphs.push({id:r,bitmap:new Ql({width:h+2*G1,height:d+2*G1},s),metrics:{width:h,height:d,left:g,top:y,advance:w}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function I6(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const z6=G1,fr={horizontal:1,vertical:2,horizontalOnly:3};class dm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const r=new dm;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new dm;return i.image=e,i}}class nd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,r){const s=new nd;for(let h=0;h<e.sections.length;h++){const d=e.sections[h];d.image?s.addImageSection(d,r):s.addTextSection(d,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,r){let s="";for(let h=0;h<i.length;h++){const d=i.charCodeAt(h+1)||null,g=i.charCodeAt(h-1)||null;s+=!r&&(d&&Zf(d)&&!hm[i[h+1]]||g&&Zf(g)&&!hm[i[h-1]])||!hm[i[h]]?i[h]:hm[i[h]]}return s}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Fg[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Fg[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new nd;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(dm.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(r)}addImageSection(e,i){const r=e.image?e.image.getPrimary():null;if(!r)return void ai("Can't add FormattedSection with an empty image.");r.scaleSelf(i);const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(dm.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ai("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Y1(n,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R=1){const F=nd.fromFeature(n,s,R);A===fr.vertical&&F.verticalizePunctuation(S);let j=[];const Y=function(ee,pe,ce,me,we,Le){if(!ee)return[];const Ze=[],Ve=function(qe,De,Re,tt,nt,Lt){let At=0;for(let ct=0;ct<qe.length();ct++){const et=qe.getSection(ct);At+=B2(qe.getCodePoint(ct),et,tt,nt,De,Lt)}return At/Math.max(1,Math.ceil(At/Re))}(ee,pe,ce,me,we,Le),Ye=ee.text.indexOf("​")>=0;let Ke=0;for(let qe=0;qe<ee.length();qe++){const De=ee.getSection(qe),Re=ee.getCodePoint(qe);if(Fg[Re]||(Ke+=B2(Re,De,me,we,pe,Le)),qe<ee.length()-1){const tt=!((Be=Re)<11904||!(Wt["Bopomofo Extended"](Be)||Wt.Bopomofo(Be)||Wt["CJK Compatibility Forms"](Be)||Wt["CJK Compatibility Ideographs"](Be)||Wt["CJK Compatibility"](Be)||Wt["CJK Radicals Supplement"](Be)||Wt["CJK Strokes"](Be)||Wt["CJK Symbols and Punctuation"](Be)||Wt["CJK Unified Ideographs Extension A"](Be)||Wt["CJK Unified Ideographs"](Be)||Wt["Enclosed CJK Letters and Months"](Be)||Wt["Halfwidth and Fullwidth Forms"](Be)||Wt.Hiragana(Be)||Wt["Ideographic Description Characters"](Be)||Wt["Kangxi Radicals"](Be)||Wt["Katakana Phonetic Extensions"](Be)||Wt.Katakana(Be)||Wt["Vertical Forms"](Be)||Wt["Yi Radicals"](Be)||Wt["Yi Syllables"](Be)));(L6[Re]||tt||De.image)&&Ze.push(N2(qe+1,Ke,Ve,Ze,R6(Re,ee.getCodePoint(qe+1),tt&&Ye),!1))}}var Be;return F2(N2(ee.length(),Ke,Ve,Ze,0,!0))}(F,w,h,e,r,E),{processBidirectionalText:H,processStyledBidirectionalText:W}=To;if(H&&F.sections.length===1){const ee=H(F.toString(),Y);for(const pe of ee){const ce=new nd;ce.text=pe,ce.sections=F.sections;for(let me=0;me<pe.length;me++)ce.sectionIndex.push(0);j.push(ce)}}else if(W){const ee=W(F.text,F.sectionIndex,Y);for(const pe of ee){const ce=new nd;ce.text=pe[0],ce.sectionIndex=pe[1],ce.sections=F.sections,j.push(ce)}}else j=function(ee,pe){const ce=[],me=ee.text;let we=0;for(const Le of pe)ce.push(ee.substring(we,Le)),we=Le;return we<me.length&&ce.push(ee.substring(we,me.length)),ce}(F,Y);const J=[],Z={positionedLines:J,text:F.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ee,pe,ce,me,we,Le,Ze,Ve,Ye,Ke,Be,qe){let De=0,Re=0,tt=0;const nt=Ve==="right"?1:Ve==="left"?0:.5;let Lt=!1;for(const Pt of we){const Ut=Pt.getSections();for(const ni of Ut){if(ni.image)continue;const ii=pe[ni.fontStack];if(ii&&(Lt=ii.ascender!==void 0&&ii.descender!==void 0,!Lt))break}if(!Lt)break}let At=0;for(const Pt of we){Pt.trim();const Ut=Pt.getMaxScale(),ni=(Ut-1)*ha,ii={positionedGlyphs:[],lineOffset:0};ee.positionedLines[At]=ii;const fi=ii.positionedGlyphs;let li=0;if(!Pt.length()){Re+=Le,++At;continue}let gi=0,Fi=0;for(let X=0;X<Pt.length();X++){const te=Pt.getSection(X),We=Pt.getSectionIndex(X),rt=Pt.getCodePoint(X);let ht=te.scale,ut=null,xt=null,$t=null,xi=ha,ki=0;Ye===fr.vertical&&((ct=rt)===12312||ct===12313||ct===12316||ct===12540||ct===12448)&&(Ye=fr.horizontal);const ui=!(Ye===fr.horizontal||!Be&&!Tp(rt)||Be&&(Fg[rt]||o1(rt)));if(te.image){const Vi=me.get(te.image.toString());if(!Vi)continue;$t=te.image,ee.iconsInText=ee.iconsInText||!0,xt=Vi.paddedRect;const en=Vi.displaySize;ht=ht*ha/qe,ut={width:en[0],height:en[1],left:0,top:-3,advance:ui?en[1]:en[0],localGlyph:!1},ki=Lt?-ut.height*ht:Ut*ha-17-en[1]*ht,xi=ut.advance;const Ai=(ui?en[0]:en[1])*ht-ha*Ut;Ai>0&&Ai>li&&(li=Ai)}else{const Vi=ce[te.fontStack];if(!Vi)continue;Vi[rt]&&(xt=Vi[rt]);const en=pe[te.fontStack];if(!en)continue;const Ai=en.glyphs[rt];if(!Ai)continue;if(ut=Ai.metrics,xi=rt!==8203?ha:0,Lt){const Pn=en.ascender!==void 0?Math.abs(en.ascender):0,sn=en.descender!==void 0?Math.abs(en.descender):0,Oi=(Pn+sn)*ht;gi<Oi&&(gi=Oi,Fi=(Pn-sn)/2*ht),ki=-Pn*ht}else ki=(Ut-ht)*ha-17}ui?(ee.verticalizable=!0,fi.push({glyph:rt,image:$t,x:De,y:Re+ki,vertical:ui,scale:ht,localGlyph:ut.localGlyph,fontStack:te.fontStack,sectionIndex:We,metrics:ut,rect:xt}),De+=xi*ht+Ke):(fi.push({glyph:rt,image:$t,x:De,y:Re+ki,vertical:ui,scale:ht,localGlyph:ut.localGlyph,fontStack:te.fontStack,sectionIndex:We,metrics:ut,rect:xt}),De+=ut.advance*ht+Ke)}fi.length!==0&&(tt=Math.max(De-Ke,tt),Lt?O2(fi,nt,li,Fi,Le*Ut/2):O2(fi,nt,li,0,Le/2)),De=0;const on=Le*Ut+li;ii.lineOffset=Math.max(li,ni),Re+=on,++At}var ct;const et=Re,{horizontalAlign:Kt,verticalAlign:kt}=H1(Ze);(function(Pt,Ut,ni,ii,fi,li){const gi=(Ut-ni)*fi,Fi=-li*ii;for(const on of Pt)for(const X of on.positionedGlyphs)X.x+=gi,X.y+=Fi})(ee.positionedLines,nt,Kt,kt,tt,et),ee.top+=-kt*et,ee.bottom=ee.top+et,ee.left+=-Kt*tt,ee.right=ee.left+tt,ee.hasBaseline=Lt}(Z,e,i,r,j,d,g,y,A,w,S,D),!function(ee){for(const pe of ee)if(pe.positionedGlyphs.length!==0)return!1;return!0}(J))return Z}const Fg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},L6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function B2(n,e,i,r,s,h){if(e.image){const d=r.get(e.image.toString());return d?d.displaySize[0]*e.scale*ha/h+s:0}{const d=i[e.fontStack],g=d&&d.glyphs[n];return g?g.metrics.advance*e.scale+s:0}}function W2(n,e,i,r){const s=Math.pow(n-e,2);return r?n<e?s/2:2*s:s+Math.abs(i)*i}function R6(n,e,i){let r=0;return n===10&&(r-=1e4),i&&(r+=150),n!==40&&n!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function N2(n,e,i,r,s,h){let d=null,g=W2(e,i,s,h);for(const y of r){const w=W2(e-y.x,i,s,h)+y.badness;w<=g&&(d=y,g=w)}return{index:n,x:e,priorBreak:d,badness:g}}function F2(n){return n?F2(n.priorBreak).concat(n.index):[]}function H1(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function O2(n,e,i,r,s){if(!(e||i||r||s))return;const h=n.length-1,d=n[h],g=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=h;y++)n[y].x-=g,n[y].y+=i+r+s}function $2(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function B6(n,e,i,r){const{horizontalAlign:s,verticalAlign:h}=H1(r),d=i[0]-n.displaySize[0]*s,g=i[1]-n.displaySize[1]*h;return{imagePrimary:n,imageSecondary:e,top:g,bottom:g+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function j2(n,e,i,r,s,h){const d=n.imagePrimary;let g;if(d.content){const F=d.content,j=d.pixelRatio||1;g=[F[0]/j,F[1]/j,d.displaySize[0]-F[2]/j,d.displaySize[1]-F[3]/j]}const y=e.left*h,w=e.right*h;let k,A,S,E;i==="width"||i==="both"?(E=s[0]+y-r[3],A=s[0]+w+r[1]):(E=s[0]+(y+w-d.displaySize[0])/2,A=E+d.displaySize[0]);const D=e.top*h,R=e.bottom*h;return i==="height"||i==="both"?(k=s[1]+D-r[0],S=s[1]+R+r[2]):(k=s[1]+(D+R-d.displaySize[1])/2,S=k+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:k,right:A,bottom:S,left:E,collisionPadding:g}}function V2(n){return!n.imagePrimary.stretchX}function U2(n){return!n.imagePrimary.stretchY}function J2(n){return{width:n.right-n.left,height:n.bottom-n.top}}const gs=128;function q2(n,e,i){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Yi(n+1,{worldview:i}))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:h}=r;let d=0;for(;d<s.length&&s[d]<=n;)d++;d=Math.max(0,d-1);let g=d;for(;g<s.length&&s[g]<n+1;)g++;g=Math.min(s.length-1,g);const y=s[d],w=s[g];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:w,minSize:r.evaluate(new Yi(y,{worldview:i})),maxSize:r.evaluate(new Yi(w,{worldview:i})),interpolationType:h}}}function Z1(n,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:s}){return n.kind==="source"?r/gs:n.kind==="composite"?Vt(r/gs,s/gs,i):e}function pm(n,e,i=1){let r=0,s=0;if(n.kind==="constant")s=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:h,minZoom:d,maxZoom:g}=n,y=h?oe(pr.interpolationFactor(h,e,d,g),0,1):0;n.kind==="camera"?s=Vt(n.minSize,n.maxSize,y)*i:r=y*i}return{uSizeT:r,uSize:s}}class Xs extends st{constructor(e,i,r,s,h){super(e,i),this.angle=s,this.z=r,h!==void 0&&(this.segment=h)}clone(){return new Xs(this.x,this.y,this.z,this.angle,this.segment)}}function G2(n,e,i,r,s){if(e.segment===void 0)return!0;let h=e,d=e.segment+1,g=0;for(;g>-i/2;){if(d--,d<0)return!1;g-=n[d].dist(h),h=n[d]}g+=n[d].dist(n[d+1]),d++;const y=[];let w=0;for(;g<i/2;){const k=n[d],A=n[d+1];if(!A)return!1;let S=n[d-1].angleTo(k)-k.angleTo(A);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:S}),w+=S;g-y[0].distance>r;)w-=y.shift().angleDelta;if(w>s)return!1;d++,g+=k.dist(A)}return!0}function Y2(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function H2(n,e,i){return n?.6*e*i:0}function Z2(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function W6(n,e,i,r,s,h){const d=H2(i,s,h),g=Z2(i,r)*h;let y=0;const w=Y2(n)/2;for(let k=0;k<n.length-1;k++){const A=n[k],S=n[k+1],E=A.dist(S);if(y+E>w){const D=(w-y)/E,R=Vt(A.x,S.x,D),F=Vt(A.y,S.y,D),j=new Xs(R,F,0,S.angleTo(A),k);return!d||G2(n,j,g,d,e)?j:void 0}y+=E}}function N6(n,e,i,r,s,h,d,g,y){const w=H2(r,h,d),k=Z2(r,s),A=k*d,S=n[0].x===0||n[0].x===y||n[0].y===0||n[0].y===y;return e-A<e/4&&(e=A+e/4),K2(n,S?e/2*g%e:(k/2+2*h)*d*g%e,e,w,i,A,S,!1,y)}function K2(n,e,i,r,s,h,d,g,y){const w=h/2,k=Y2(n);let A=0,S=e-i,E=[];for(let D=0;D<n.length-1;D++){const R=n[D],F=n[D+1],j=R.dist(F),Y=F.angleTo(R);for(;S+i<A+j;){S+=i;const H=(S-A)/j,W=Vt(R.x,F.x,H),J=Vt(R.y,F.y,H);if(W>=0&&W<y&&J>=0&&J<y&&S-w>=0&&S+w<=k){const Z=new Xs(W,J,0,Y,D);r&&!G2(n,Z,h,r,s)||E.push(Z)}}A+=j}return g||E.length||d||(E=K2(n,A/2,i,r,s,h,d,!0,y)),E}function X2(n){let e=0,i=0;for(const d of n)e+=d.w*d.h,i=Math.max(i,d.w);n.sort((d,g)=>g.h-d.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let s=0,h=0;for(const d of n)for(let g=r.length-1;g>=0;g--){const y=r[g];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,h=Math.max(h,d.y+d.h),s=Math.max(s,d.x+d.w),d.w===y.w&&d.h===y.h){const w=r.pop();g<r.length&&(r[g]=w)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(r.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:s,h,fill:e/(s*h)||0}}yt(Xs,"Anchor");const Ec=1;class mm{static getImagePositionScale(e,i,r){if(i&&e&&e.options&&e.options.transform){const s=e.options.transform;return{x:s.a,y:s.d}}return{x:r,y:r}}constructor(e,i,r,s){this.paddedRect=e;const{pixelRatio:h,version:d,stretchX:g,stretchY:y,content:w,sdf:k,usvg:A}=i;this.pixelRatio=h,this.stretchX=g,this.stretchY=y,this.content=w,this.version=d,this.padding=r,this.sdf=k,this.usvg=A,this.scale=mm.getImagePositionScale(s,A,h)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function K1(n,e,i){const r=bo.parse(n),s=function(h,d,g=[1,1]){return{x:0,y:0,w:(h.data?h.data.width:h.width*g[0])+2*d,h:(h.data?h.data.height:h.height*g[1])+2*d}}(e,i,[r.options.transform.a,r.options.transform.d]);return{bin:s,imagePosition:new mm(s,e,i,r),imageVariant:r}}class Q2{constructor(e,i,r){const s=new Map,h=new Map;this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,Ec,d),this.addImages(i,h,2,d);const{w:g,h:y}=X2(d),w=new wa({width:g||1,height:y||1});for(const[k,A]of e.entries()){const S=s.get(k).paddedRect;wa.copy(A.data,w,{x:0,y:0},{x:S.x+Ec,y:S.y+Ec},A.data,r,A.sdf)}for(const[k,A]of i.entries()){const S=h.get(k),E=S.paddedRect;let D=S.padding;const R=E.x+D,F=E.y+D,j=A.data.width,Y=A.data.height;D=D>1?D-1:D,wa.copy(A.data,w,{x:0,y:0},{x:R,y:F},A.data,r),wa.copy(A.data,w,{x:0,y:Y-D},{x:R,y:F-D},{width:j,height:D},r),wa.copy(A.data,w,{x:0,y:0},{x:R,y:F+Y},{width:j,height:D},r),wa.copy(A.data,w,{x:j-D,y:0},{x:R-D,y:F},{width:D,height:Y},r),wa.copy(A.data,w,{x:0,y:0},{x:R+j,y:F},{width:D,height:Y},r),wa.copy(A.data,w,{x:j-D,y:Y-D},{x:R-D,y:F-D},{width:D,height:D},r),wa.copy(A.data,w,{x:0,y:Y-D},{x:R+j,y:F-D},{width:D,height:D},r),wa.copy(A.data,w,{x:0,y:0},{x:R+j,y:F+Y},{width:D,height:D},r),wa.copy(A.data,w,{x:j-D,y:0},{x:R-D,y:F+Y},{width:D,height:D},r)}this.lut=r,this.image=w,this.iconPositions=s,this.patternPositions=h}addImages(e,i,r,s){for(const[h,d]of e.entries()){const{bin:g,imagePosition:y,imageVariant:w}=K1(h,d,r);i.set(h,y),s.push(g),d.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,i,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const s of e.getUpdatedImages(r)){for(const h of this.iconPositions.keys()){const d=bo.parse(h);if(er.isEqual(d.id,s)){const g=e.getImage(s,r);this.patchUpdatedImage(this.iconPositions.get(h),g,i)}}for(const h of this.patternPositions.keys()){const d=bo.parse(h);if(er.isEqual(d.id,s)){const g=e.getImage(s,r);this.patchUpdatedImage(this.patternPositions.get(h),g,i)}}}}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[s,h]=e.tl,d=e.sdf;if(this.lut||d){const g={width:i.data.width,height:i.data.height},y=new wa(g);wa.copy(i.data,y,{x:0,y:0},{x:0,y:0},g,this.lut,d),r.update(y,{position:{x:s,y:h}})}else r.update(i.data,{position:{x:s,y:h}})}}yt(mm,"ImagePosition"),yt(Q2,"ImageAtlas");const Og=1e20;function ex(n,e,i,r,s,h,d,g,y){for(let w=e;w<e+r;w++)tx(n,i*h+w,h,s,d,g,y);for(let w=i;w<i+s;w++)tx(n,w*h+e,1,r,d,g,y)}function tx(n,e,i,r,s,h,d){h[0]=0,d[0]=-1e20,d[1]=Og,s[0]=n[e];for(let g=1,y=0,w=0;g<r;g++){s[g]=n[e+g*i];const k=g*g;do{const A=h[y];w=(s[g]-s[A]+k-A*A)/(g-A)/2}while(w<=d[y]&&--y>-1);y++,h[y]=g,d[y]=w,d[y+1]=Og}for(let g=0,y=0;g<r;g++){for(;d[y+1]<g;)y++;const w=h[y],k=g-w;n[e+g*i]=s[w]+k*k}}const Do=2,X1={none:0,ideographs:1,all:2};class ad{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,r){const s=[],h=this.urls[i]||pa.GLYPHS_URL;for(const d in e)for(const g of e[d])s.push({stack:d,id:g});ye(s,({stack:d,id:g},y)=>{let w=this.entries[d];w||(w=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=w.glyphs[g];if(k!==void 0)return void y(null,{stack:d,id:g,glyph:k});if(k=this._tinySDF(w,d,g),k)return w.glyphs[g]=k,void y(null,{stack:d,id:g,glyph:k});const A=Math.floor(g/256);if(256*A>65535)return ai("glyphs > 65535 not supported"),void y(null,{stack:d,id:g,glyph:k});if(w.ranges[A])return void y(null,{stack:d,id:g,glyph:k});let S=w.requests[A];S||(S=w.requests[A]=[],ad.loadGlyphRange(d,A,h,this.requestManager,(E,D)=>{if(D){w.ascender=D.ascender,w.descender=D.descender;for(const R in D.glyphs)this._doesCharSupportLocalGlyph(+R)||(w.glyphs[+R]=D.glyphs[+R]);w.ranges[A]=!0}for(const R of S)R(E,D);delete w.requests[A]})),S.push((E,D)=>{E?y(E):D&&y(null,{stack:d,id:g,glyph:D.glyphs[g]||null})})},(d,g)=>{if(d)r(d);else if(g){const y={};for(const{stack:w,id:k,glyph:A}of g)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[k]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;r(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==X1.none&&(this.localGlyphMode===X1.all?!!this.localFontFamily:!!this.localFontFamily&&(Wt["CJK Unified Ideographs"](e)||Wt["Hangul Syllables"](e)||Wt.Hiragana(e)||Wt.Katakana(e)||Wt["CJK Symbols and Punctuation"](e)||Wt["CJK Unified Ideographs Extension A"](e)||Wt["CJK Unified Ideographs Extension B"](e)||Wt.Osage(e)))}_tinySDF(e,i,r){const s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(r))return;let h=e.tinySDF;if(!h){let R="400";/bold/i.test(i)?R="900":/medium/i.test(i)?R="500":/light/i.test(i)&&(R="200"),h=e.tinySDF=new ad.TinySDF({fontFamily:s,fontWeight:R,fontSize:24*Do,buffer:3*Do,radius:8*Do}),h.fontWeight=R}if(this.localGlyphs[h.fontWeight][r])return this.localGlyphs[h.fontWeight][r];const d=String.fromCodePoint(r),{data:g,width:y,height:w,glyphWidth:k,glyphHeight:A,glyphLeft:S,glyphTop:E,glyphAdvance:D}=h.draw(d);return this.localGlyphs[h.fontWeight][r]={id:r,bitmap:new Ql({width:y,height:w},g),metrics:{width:k/Do,height:A/Do,left:S/Do,top:E/Do-27,advance:D/Do,localGlyph:!0}}}}ad.loadGlyphRange=function(n,e,i,r,s){const h=256*e,d=h+255,g=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${h}-${d}`),Bu.Glyphs);Wu(g,(y,w)=>{if(y)s(y);else if(w){const k={},A=function(S){return new Ng(S).readFields(C6,{})}(w);for(const S of A.glyphs)k[S.id]=S;s(null,{glyphs:k,ascender:A.ascender,descender:A.descender})}})},ad.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:h="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const g=this.size=n+4*e,y=this._createCanvas(g),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${d} ${h} ${n}px ${s}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:h}=this.ctx.measureText(n),d=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-s))),y=Math.min(this.size-this.buffer,d+Math.ceil(r)),w=g+2*this.buffer,k=y+2*this.buffer,A=Math.max(w*k,0),S=new Uint8ClampedArray(A),E={data:S,width:w,height:k,glyphWidth:g,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return E;const{ctx:D,buffer:R,gridInner:F,gridOuter:j}=this;D.clearRect(R,R,g,y),D.fillText(n,R,R+d);const Y=D.getImageData(R,R,g,y);j.fill(Og,0,A),F.fill(0,0,A);for(let H=0;H<y;H++)for(let W=0;W<g;W++){const J=Y.data[4*(H*g+W)+3]/255;if(J===0)continue;const Z=(H+R)*w+W+R;if(J===1)j[Z]=0,F[Z]=Og;else{const ee=.5-J;j[Z]=ee>0?ee*ee:0,F[Z]=ee<0?ee*ee:0}}ex(j,0,0,w,k,w,this.f,this.v,this.z),ex(F,R,R,g,y,w,this.f,this.v,this.z);for(let H=0;H<A;H++){const W=Math.sqrt(j[H])-Math.sqrt(F[H]);S[H]=Math.round(255-255*(W/this.radius+this.cutoff))}return E}};const Cc=Ec;function ix(n,e){return n+e[1]-e[0]}function nx(n,e,i,r,s=1){const h=[],d=n.imagePrimary,g=d.pixelRatio,y=d.paddedRect.w-2*Cc,w=d.paddedRect.h-2*Cc,k=(n.right-n.left)*s,A=(n.bottom-n.top)*s,S=d.stretchX||[[0,y]],E=d.stretchY||[[0,w]],D=S.reduce(ix,0),R=E.reduce(ix,0),F=y-D,j=w-R;let Y=0,H=D,W=0,J=R,Z=0,ee=F,pe=0,ce=j;if(d.content&&r){const we=d.content;Y=$g(S,0,we[0]),W=$g(E,0,we[1]),H=$g(S,we[0],we[2]),J=$g(E,we[1],we[3]),Z=we[0]-Y,pe=we[1]-W,ee=we[2]-we[0]-H,ce=we[3]-we[1]-J}const me=(we,Le,Ze,Ve)=>{const Ye=jg(we.stretch-Y,H,k,n.left*s),Ke=Vg(we.fixed-Z,ee,we.stretch,D),Be=jg(Le.stretch-W,J,A,n.top*s),qe=Vg(Le.fixed-pe,ce,Le.stretch,R),De=jg(Ze.stretch-Y,H,k,n.left*s),Re=Vg(Ze.fixed-Z,ee,Ze.stretch,D),tt=jg(Ve.stretch-W,J,A,n.top*s),nt=Vg(Ve.fixed-pe,ce,Ve.stretch,R),Lt=new st(Ye,Be),At=new st(De,Be),ct=new st(De,tt),et=new st(Ye,tt),Kt=new st(Ke/g,qe/g),kt=new st(Re/g,nt/g),Pt=e*Math.PI/180;if(Pt){const gi=Math.sin(Pt),Fi=Math.cos(Pt),on=[Fi,-gi,gi,Fi];Lt._matMult(on),At._matMult(on),et._matMult(on),ct._matMult(on)}const Ut=we.stretch+we.fixed,ni=Ze.stretch+Ze.fixed,ii=Le.stretch+Le.fixed,fi=Ve.stretch+Ve.fixed,li=n.imageSecondary;return{tl:Lt,tr:At,bl:et,br:ct,texPrimary:{x:d.paddedRect.x+Cc+Ut,y:d.paddedRect.y+Cc+ii,w:ni-Ut,h:fi-ii},texSecondary:li?{x:li.paddedRect.x+Cc+Ut,y:li.paddedRect.y+Cc+ii,w:ni-Ut,h:fi-ii}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kt,pixelOffsetBR:kt,minFontScaleX:ee/g/k,minFontScaleY:ce/g/A,isSDF:i}};if(r&&(d.stretchX||d.stretchY)){const we=ax(S,F,D),Le=ax(E,j,R);for(let Ze=0;Ze<we.length-1;Ze++){const Ve=we[Ze],Ye=we[Ze+1];for(let Ke=0;Ke<Le.length-1;Ke++)h.push(me(Ve,Le[Ke],Ye,Le[Ke+1]))}}else h.push(me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:w+1}));return h}function $g(n,e,i){let r=0;for(const s of n)r+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return r}function ax(n,e,i){const r=[{fixed:-1,stretch:0}];for(const[s,h]of n){const d=r[r.length-1];r.push({fixed:s-d.stretch,stretch:d.stretch}),r.push({fixed:s-d.stretch,stretch:d.stretch+(h-s)})}return r.push({fixed:e+Cc,stretch:i}),r}function jg(n,e,i,r){return n/e*i+r}function Vg(n,e,i,r){return n-e*i/r}function F6(n,e,i,r){const s=e+n.positionedLines[r].lineOffset;return r===0?i+s/2:i+(s+(e+n.positionedLines[r-1].lineOffset))/2}function O6(n,e=1,i=!1){let r=1/0,s=1/0,h=-1/0,d=-1/0;const g=n[0];for(let E=0;E<g.length;E++){const D=g[E];(!E||D.x<r)&&(r=D.x),(!E||D.y<s)&&(s=D.y),(!E||D.x>h)&&(h=D.x),(!E||D.y>d)&&(d=D.y)}const y=Math.min(h-r,d-s);let w=y/2;const k=new hh([],$6);if(y===0)return new st(r,s);for(let E=r;E<h;E+=y)for(let D=s;D<d;D+=y)k.push(new rd(E+w,D+w,w,n));let A=function(E){let D=0,R=0,F=0;const j=E[0];for(let Y=0,H=j.length,W=H-1;Y<H;W=Y++){const J=j[Y],Z=j[W],ee=J.x*Z.y-Z.x*J.y;R+=(J.x+Z.x)*ee,F+=(J.y+Z.y)*ee,D+=3*ee}return new rd(R/D,F/D,0,E)}(n),S=k.length;for(;k.length;){const E=k.pop();(E.d>A.d||!A.d)&&(A=E,i&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,S)),E.max-A.d<=e||(w=E.h/2,k.push(new rd(E.p.x-w,E.p.y-w,w,n)),k.push(new rd(E.p.x+w,E.p.y-w,w,n)),k.push(new rd(E.p.x-w,E.p.y+w,w,n)),k.push(new rd(E.p.x+w,E.p.y+w,w,n)),S+=4)}return i&&(console.log(`num probes: ${S}`),console.log(`best distance: ${A.d}`)),A.p}function $6(n,e){return e.max-n.max}class rd{constructor(e,i,r,s){this.p=new st(e,i),this.h=r,this.d=function(h,d){let g=!1,y=1/0;for(let w=0;w<d.length;w++){const k=d[w];for(let A=0,S=k.length,E=S-1;A<S;E=A++){const D=k[A],R=k[E];D.y>h.y!=R.y>h.y&&h.x<(R.x-D.x)*(h.y-D.y)/(R.y-D.y)+D.x&&(g=!g),y=Math.min(y,Yh(h,D,R))}}return(g?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}const j6=Object.keys,Q1=Number.POSITIVE_INFINITY,V6=Math.sqrt(2);function rx(n,[e,i]){let r=0,s=0;if(i===Q1){e<0&&(e=0);const h=e/V6;switch(n){case"top-right":case"top-left":s=h-7;break;case"bottom-right":case"bottom-left":s=7-h;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(n){case"top-right":case"bottom-right":r=-h;break;case"top-left":case"bottom-left":r=h;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":s=i-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-i}switch(n){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,s]}function Ug(n,e,i,r,s,h,d,g,y){if(!e||!e.usvg)return;const w=J2(r),k=J2(s),A=h!=="both"&&h!=="width"||!V2(r)?1:k.width/w.width,S=h!=="both"&&h!=="height"||!U2(r)?1:k.height/w.height;i.scaleSelf(A,S);const E=i.toString();d.set(E,i),g.set(E,e);const{imagePosition:D}=K1(E,e,Ec);y.set(E,D)}function ox(n,e,i,r,s,h,d,g,y){if(!n)return;const w=function(k,A,S,E,D,R){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const F=A.possiblyEvaluate(new Yi(k.maxZoom,{worldview:R}),S).evaluate(D,{},S),j=A.possiblyEvaluate(new Yi(k.minZoom,{worldview:R}),S).evaluate(D,{},S);return Math.max(F,j)}return A.possiblyEvaluate(new Yi(E,{worldview:R})).evaluate(D,{},S)}(e,i,r,s,h,y);return n.scaleSelf(w*g*d)}function sx(n,e,i,r,s,h,d,g,y){return{iconPrimary:ox(n.getPrimary(),e,i,r,s,h,d,g,y),iconSecondary:ox(n.getSecondary(),e,i,r,s,h,d,g,y)}}function U6(n,e,i){if(!e)return;const r=i.get(n.toString()),s=i.get(e.toString());s&&(r.paddedRect.w===s.paddedRect.w&&r.paddedRect.h===s.paddedRect.h||ai(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),r.usvg!==s.usvg&&ai(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function lx(n,e,i,r){if(!n)return;const s=e.get(i.toString());if(n.imagePrimary=s,r){const h=e.get(r.toString());n.imageSecondary=h}}function J6(n,e){for(const i in n.horizontal)ux(n.horizontal[i],e);ux(n.vertical,e)}function ux(n,e){if(n){for(const i of n.positionedLines)for(const r of i.positionedGlyphs)if(r.image!==null){const s=r.image.toString();r.rect=e.get(s).paddedRect}}}function e0(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q6(n,e,i,r,s,h,d,g,y){const w=t0(h.horizontal)||h.vertical,k=i.get("icon-text-fit-padding").evaluate(r,{},s);let A,S=e;return e&&y!=="none"&&(n.allowVerticalPlacement&&h.vertical&&(A=j2(e,h.vertical,y,k,g,d)),w&&(S=j2(e,w,y,k,g,d))),{defaultShapedIcon:S,verticallyShapedIcon:A}}function G6(n,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j,Y,H){let W=d.textMaxSize.evaluate(e,{},S);W===void 0?W=g*d.textScaleFactor:W*=d.textScaleFactor;const J=n.layers[0].layout,Z=t0(i.horizontal)||i.vertical,ee=E.name==="globe",pe=ha,ce=n.tilePixelRatio*W/pe,me=(Ke=n.overscaling,n.zoom>18&&Ke>2&&(Ke>>=1),Math.max(lt/(512*Ke),1)*J.get("symbol-spacing")),we=J.get("text-padding")*n.tilePixelRatio,Le=J.get("icon-padding")*n.tilePixelRatio,Ze=Ci(J.get("text-max-angle")),Ve=J.get("icon-rotation-alignment")==="map"&&H!=="point",Ye=me/2;var Ke;n.hasAnyIconTextFit===!1&&F!=="none"&&(n.hasAnyIconTextFit=!0);const Be=e.properties?+e.properties[vi]:null,qe=Be&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Be):65535,De=(Re,tt,nt)=>{if(tt.x<0||tt.x>=lt||tt.y<0||tt.y>=lt)return;let Lt=null;if(ee){const{x:At,y:ct,z:et}=E.projectTilePoint(tt.x,tt.y,nt);Lt={anchor:new Xs(At,ct,et,0,void 0),up:E.upVector(nt,tt.x,tt.y)}}(function(At,ct,et,Kt,kt,Pt,Ut,ni,ii,fi,li,gi,Fi,on,X,te,We,rt,ht,ut,xt,$t,xi,ki,ui,Vi,en,Ai,Pn){const sn=At.addToLineVertexArray(ct,Kt);let Oi,On,dn,tn,ln,Gi,di,Hi=0,Mn=0,Nt=0,Pi=0,pn=-1,Ln=-1;const bn={};let Zn=Fu("");const Zi=et?et.anchor:ct,Yn=Ai!=="none";let ar=0,ba=0;if(ii._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Kn=ii.layout.get("text-offset").evaluate(xt,{},ui);ar=Kn[0]*ha,ba=Kn[1]*ha}else ar=ii.layout.get("text-radial-offset").evaluate(xt,{},ui)*ha,ba=Q1;if(At.allowVerticalPlacement&&kt.vertical){const Kn=kt.vertical;if(X)Gi=i0(Kn),ni&&(di=i0(ni));else{const na=ii.layout.get("text-rotate").evaluate(xt,{},ui)+90;dn=Jg(fi,Zi,ct,li,gi,Fi,Kn,on,na,te),ni&&(tn=Jg(fi,Zi,ct,li,gi,Fi,ni,rt,na))}}if(Pt){const Kn=At.iconSizeData,na=ii.layout.get("icon-rotate").evaluate(xt,{},ui),va=nx(Pt,na,xi,Yn,$t.iconScaleFactor),Fa=ni?nx(ni,na,xi,Yn,$t.iconScaleFactor):void 0;On=Jg(fi,Zi,ct,li,gi,Fi,Pt,rt,na,null),Hi=4*va.length;let Ma=null;Kn.kind==="source"?(Ma=[gs*ii.layout.get("icon-size").evaluate(xt,{},ui)*$t.iconScaleFactor],Ma[0]>tu&&ai(`${At.layerIds[0]}: Value for "icon-size" is >= ${fm}. Reduce your "icon-size".`)):Kn.kind==="composite"&&(Ma=[gs*$t.compositeIconSizes[0].evaluate(xt,{},ui)*$t.iconScaleFactor,gs*$t.compositeIconSizes[1].evaluate(xt,{},ui)*$t.iconScaleFactor],(Ma[0]>tu||Ma[1]>tu)&&ai(`${At.layerIds[0]}: Value for "icon-size" is >= ${fm}. Reduce your "icon-size".`)),At.addSymbols(At.icon,va,Ma,ut,ht,xt,void 0,et,ct,sn.lineStartIndex,sn.lineLength,-1,ki,ui,Vi,en),pn=At.icon.placedSymbolArray.length-1,Fa&&(Mn=4*Fa.length,At.addSymbols(At.icon,Fa,Ma,ut,ht,xt,fr.vertical,et,ct,sn.lineStartIndex,sn.lineLength,-1,ki,ui,Vi,en),Ln=At.icon.placedSymbolArray.length-1)}for(const Kn in kt.horizontal){const na=Kn,va=kt.horizontal[na];Oi||(Zn=Fu(va.text),X?ln=i0(va):Oi=Jg(fi,Zi,ct,li,gi,Fi,va,on,ii.layout.get("text-rotate").evaluate(xt,{},ui),te));const Fa=va.positionedLines.length===1;if(Nt+=cx(At,et,ct,va,Ut,ii,X,xt,te,sn,kt.vertical?fr.horizontal:fr.horizontalOnly,Fa?j6(kt.horizontal):[na],bn,pn,$t,ki,ui,Vi),Fa)break}kt.vertical&&(Pi+=cx(At,et,ct,kt.vertical,Ut,ii,X,xt,te,sn,fr.vertical,["vertical"],bn,Ln,$t,ki,ui,Vi));let _a=-1;const rr=(Kn,na)=>Kn?Math.max(Kn,na):na;_a=rr(ln,_a),_a=rr(Gi,_a),_a=rr(di,_a);const _s=_a>-1?1:0;At.glyphOffsetArray.length>=65535&&ai("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xt.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,xt.sortKey),At.symbolInstances.emplaceBack(ct.x,ct.y,Zi.x,Zi.y,Zi.z,bn.right>=0?bn.right:-1,bn.center>=0?bn.center:-1,bn.left>=0?bn.left:-1,bn.vertical>=0?bn.vertical:-1,pn,Ln,Zn,Oi!==void 0?Oi:At.collisionBoxArray.length,Oi!==void 0?Oi+1:At.collisionBoxArray.length,dn!==void 0?dn:At.collisionBoxArray.length,dn!==void 0?dn+1:At.collisionBoxArray.length,On!==void 0?On:At.collisionBoxArray.length,On!==void 0?On+1:At.collisionBoxArray.length,tn||At.collisionBoxArray.length,tn?tn+1:At.collisionBoxArray.length,li,Nt,Pi,Hi,Mn,_s,0,ar,ba,_a,0,Yn?1:0,Pn)})(n,tt,Lt,Re,i,r,h,s,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,we,Y,w,0,Le,Ve,j,e,d,k,A,S,D,R,F,qe)};if(H==="line")for(const Re of Lg(e.geometry,0,0,lt,lt)){const tt=N6(Re,me,Ze,i.vertical||Z,r,pe,ce,n.overscaling,lt);for(const nt of tt)Z&&Y6(n,Z.text,Ye,nt)||De(Re,nt,S)}else if(H==="line-center"){for(const Re of e.geometry)if(Re.length>1){const tt=W6(Re,Ze,i.vertical||Z,r,pe,ce);tt&&De(Re,tt,S)}}else if(e.type==="Polygon")for(const Re of Mg(e.geometry,0)){const tt=O6(Re,16);De(Re[0],new Xs(tt.x,tt.y,0,0,void 0),S)}else if(e.type==="LineString")for(const Re of e.geometry)De(Re,new Xs(Re[0].x,Re[0].y,0,0,void 0),S);else if(e.type==="Point")for(const Re of e.geometry)for(const tt of Re)De([tt],new Xs(tt.x,tt.y,0,0,void 0),S)}const fm=255,tu=fm*gs;function cx(n,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F,j){const Y=function(J,Z,ee,pe,ce,me,we,Le){const Ze=[];if(Z.positionedLines.length===0)return Ze;const Ve=pe.layout.get("text-rotate").evaluate(me,{})*Math.PI/180,Ye=function(Re){const tt=Re[0],nt=Re[1],Lt=tt*nt;return Lt>0?[tt,-nt]:Lt<0?[-tt,nt]:tt===0?[nt,tt]:[nt,-tt]}(ee);let Ke=Math.abs(Z.top-Z.bottom);for(const Re of Z.positionedLines)Ke-=Re.lineOffset;const Be=Z.positionedLines.length,qe=Ke/Be;let De=Z.top-ee[1];for(let Re=0;Re<Be;++Re){const tt=Z.positionedLines[Re];De=F6(Z,qe,De,Re);for(const nt of tt.positionedGlyphs){if(!nt.rect)continue;const Lt=nt.rect||{};let At=z6+1,ct=!0,et=1,Kt=0;if(nt.image){const xt=we.get(nt.image.toString());if(!xt)continue;if(xt.sdf){ai("SDF images are not supported in formatted text and will be ignored.");continue}ct=!1,et=xt.pixelRatio,At=Ec/et}const kt=(ce||Le)&&nt.vertical,Pt=nt.metrics.advance*nt.scale/2,Ut=nt.metrics,ni=nt.rect;if(ni===null)continue;Le&&Z.verticalizable&&(Kt=nt.image?Pt-nt.metrics.width*nt.scale/2:0);const ii=ce?[nt.x+Pt,nt.y]:[0,0];let fi=[0,0],li=[0,0],gi=!1;ce||(kt?(li=[nt.x+Pt+Ye[0],nt.y+Ye[1]-Kt],gi=!0):fi=[nt.x+Pt+ee[0],nt.y+ee[1]-Kt]);const Fi=ni.w*nt.scale/(et*(nt.localGlyph?Do:1)),on=ni.h*nt.scale/(et*(nt.localGlyph?Do:1));let X,te,We,rt;if(kt){const xt=nt.y-De,$t=new st(-Pt,Pt-xt),xi=-Math.PI/2,ki=new st(...li);X=new st(-Pt+fi[0],fi[1]),X._rotateAround(xi,$t)._add(ki),X.x+=-xt+Pt,X.y-=(Ut.left-At)*nt.scale;const ui=nt.image?Ut.advance*nt.scale:ha*nt.scale,Vi=String.fromCodePoint(nt.glyph);P6(Vi)?X.x+=(1-At)*nt.scale:M6(Vi)?X.x+=ui-Ut.height*nt.scale+(-At-1)*nt.scale:X.x+=nt.image||Ut.width+2*At===ni.w&&Ut.height+2*At===ni.h?(ui-on)/2:(ui-(Ut.height+2*At)*nt.scale)/2,te=new st(X.x,X.y-Fi),We=new st(X.x+on,X.y),rt=new st(X.x+on,X.y-Fi)}else{const xt=(Ut.left-At)*nt.scale-Pt+fi[0],$t=(-Ut.top-At)*nt.scale+fi[1],xi=xt+Fi,ki=$t+on;X=new st(xt,$t),te=new st(xi,$t),We=new st(xt,ki),rt=new st(xi,ki)}if(Ve){let xt;xt=ce?new st(0,0):gi?new st(Ye[0],Ye[1]):new st(ee[0],ee[1]),X._rotateAround(Ve,xt),te._rotateAround(Ve,xt),We._rotateAround(Ve,xt),rt._rotateAround(Ve,xt)}const ht=new st(0,0),ut=new st(0,0);Ze.push({tl:X,tr:te,bl:We,br:rt,texPrimary:Lt,texSecondary:void 0,writingMode:Z.writingMode,glyphOffset:ii,sectionIndex:nt.sectionIndex,isSDF:ct,pixelOffsetTL:ht,pixelOffsetBR:ut,minFontScaleX:0,minFontScaleY:0})}}return Ze}(0,r,y,h,d,g,s,n.allowVerticalPlacement),H=n.textSizeData;let W=null;H.kind==="source"?(W=[gs*h.layout.get("text-size").evaluate(g,{},F)*D.textScaleFactor],W[0]>tu&&ai(`${n.layerIds[0]}: Value for "text-size" is >= ${fm}. Reduce your "text-size".`)):H.kind==="composite"&&(W=[gs*D.compositeTextSizes[0].evaluate(g,{},F)*D.textScaleFactor,gs*D.compositeTextSizes[1].evaluate(g,{},F)*D.textScaleFactor],(W[0]>tu||W[1]>tu)&&ai(`${n.layerIds[0]}: Value for "text-size" is >= ${fm}. Reduce your "text-size".`)),n.addSymbols(n.text,Y,W,y,d,g,k,e,i,w.lineStartIndex,w.lineLength,E,R,F,j,!1);for(const J of A)S[J]=n.text.placedSymbolArray.length-1;return 4*Y.length}function t0(n){for(const e in n)return n[e];return null}function Jg(n,e,i,r,s,h,d,g,y,w){let k=d.top,A=d.bottom,S=d.left,E=d.right;if($2(d)&&d.collisionPadding){const D=d.collisionPadding;S-=D[0],k-=D[1],E+=D[2],A+=D[3]}if(y){const D=new st(S,k),R=new st(E,k),F=new st(S,A),j=new st(E,A),Y=Ci(y);let H=new st(0,0);w&&(H=new st(w[0],w[1])),D._rotateAround(Y,H),R._rotateAround(Y,H),F._rotateAround(Y,H),j._rotateAround(Y,H),S=Math.min(D.x,R.x,F.x,j.x),E=Math.max(D.x,R.x,F.x,j.x),k=Math.min(D.y,R.y,F.y,j.y),A=Math.max(D.y,R.y,F.y,j.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,S,k,E,A,g,r,s,h),n.length-1}function i0(n){$2(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function Y6(n,e,i,r){const s=n.compareText;if(e in s){const h=s[e];for(let d=h.length-1;d>=0;d--)if(r.dist(h[d])<i)return!0}else s[e]=[];return s[e].push(r),!1}function hx(n,e){const i=n.fovAboveCenter,r=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,s=(n._camera.position[2]*n.worldSize-r)/Math.cos(n._pitch),h=Math.sin(i)*s/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let d=Math.sin(n._pitch)*h+s;const g=s*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let y=Math.max(n.zoom-17,0);n.isOrthographic&&(y/=10),d*=1+y}return Math.min(1.01*d,g)}function gm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),r=n.x*i,s=(n.x+1)*i,h=n.y*i,d=(n.y+1)*i,g=he(r),y=he(s),w=xe(h),k=xe(d),A=e.project(g,w),S=e.project(y,w),E=e.project(y,k),D=e.project(g,k);let R=Math.min(A.x,S.x,E.x,D.x),F=Math.min(A.y,S.y,E.y,D.y),j=Math.max(A.x,S.x,E.x,D.x),Y=Math.max(A.y,S.y,E.y,D.y);const H=i/16;function W(Z,ee,pe,ce,me,we){const Le=(pe+me)/2,Ze=(ce+we)/2,Ve=e.project(he(Le),xe(Ze)),Ye=Math.max(0,R-Ve.x,F-Ve.y,Ve.x-j,Ve.y-Y);R=Math.min(R,Ve.x),j=Math.max(j,Ve.x),F=Math.min(F,Ve.y),Y=Math.max(Y,Ve.y),Ye>H&&(W(Z,Ve,pe,ce,Le,Ze),W(Ve,ee,Le,Ze,me,we))}W(A,S,r,h,s,h),W(S,E,s,h,s,d),W(E,D,s,d,r,d),W(D,A,r,d,r,h),R-=H,F-=H,j+=H,Y+=H;const J=1/Math.max(j-R,Y-F);return{scale:J,x:R*J,y:F*J,x2:j*J,y2:Y*J,projection:e}}function dx(n,{x:e,y:i},r=0){return new st(((e-r)*n.scale-n.x)*lt,(i*n.scale-n.y)*lt)}const H6=He(new Float32Array(16));class iu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new q(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r,s=!0){return e._coordinatePoint(e.locationCoordinate(i,r),s)}pixelsPerMeter(e,i){return ue(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return hx(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,s){const h=e.horizonLineFromTop(!1),d=new st(i,Math.max(h,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,s))}pointCoordinate3D(e,i,r){const s=new st(i,r);if(e.elevation)return e.elevation.pointCoordinate(s);{const h=this.pointCoordinate(e,s.x,s.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return H6}createTileMatrix(e,i,r){let s,h,d;const g=r.canonical,y=He(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=gm(g,this);s=1,h=w.x+r.wrap*w.scale,d=w.y,Oe(y,y,[s/w.scale,s/w.scale,e.pixelsPerMeter/i])}else s=i/e.zoomScale(g.z),h=(g.x+Math.pow(2,g.z)*r.wrap)*s,d=g.y*s;return Ae(y,y,[h,d,0]),Oe(y,y,[s/lt,s/lt,1]),y}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class Z6 extends iu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(Ci(i));this.n=(s+Math.sin(Ci(r)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:s,r0:h}=this,d=Ci(e-this.center[0]),g=Ci(i),y=Math.sqrt(s-2*r*Math.sin(g))/r;return{x:y*Math.sin(d*r),y:y*Math.cos(d*r)-h,z:0}}unproject(e,i){const{n:r,c:s,r0:h}=this,d=h+i;let g=Math.atan2(e,Math.abs(d))*Math.sign(d);d*r<0&&(g-=Math.PI*Math.sign(e)*Math.sign(d));const y=Ci(this.center[0])*r;g=Se(g,-Math.PI-y,Math.PI-y);const w=oe(Me(g/r)+this.center[0],-180,180),k=Math.asin(oe((s-(e*e+d*d)*r*r)/(2*r),-1,1)),A=oe(Me(k),-85.051129,Ne);return new q(w,A)}}const _m=1.340264,ym=-.081106,wm=893e-6,bm=.003796,qg=Math.sqrt(3)/2;class K6 extends iu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(qg*Math.sin(i)),s=r*r,h=s*s*s;return{x:.5*(e*Math.cos(r)/(qg*(_m+3*ym*s+h*(7*wm+9*bm*s)))/Math.PI+.5),y:1-.5*(r*(_m+ym*s+h*(wm+bm*s))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,s=r*r,h=s*s*s;for(let k,A,S,E=0;E<12&&(A=r*(_m+ym*s+h*(wm+bm*s))-i,S=_m+3*ym*s+h*(7*wm+9*bm*s),k=A/S,r=oe(r-k,-Math.PI/3,Math.PI/3),s=r*r,h=s*s*s,!(Math.abs(k)<1e-12));++E);const d=qg*e*(_m+3*ym*s+h*(7*wm+9*bm*s))/Math.cos(r),g=Math.asin(Math.sin(r)/qg),y=oe(180*d/Math.PI,-180,180),w=oe(180*g/Math.PI,-85.051129,Ne);return new q(y,w)}}class X6 extends iu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),s=oe(360*(.5-i),-85.051129,Ne);return new q(r,s)}}const od=Math.PI/2;function Gg(n){return Math.tan((od+n)/2)}class Q6 extends iu{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let s=Ci(i),h=Ci(r);this.southernCenter=s+h<0,this.southernCenter&&(s=-s,h=-h);const d=Math.cos(s),g=Gg(s);this.n=s===h?Math.sin(s):Math.log(d/Math.cos(h))/Math.log(Gg(h)/g),this.f=d*Math.pow(Gg(s),this.n)/this.n}project(e,i){i=Ci(i),this.southernCenter&&(i=-i),e=Ci(e-this.center[0]);const r=1e-6,{n:s,f:h}=this;h>0?i<-od+r&&(i=-od+r):i>od-r&&(i=od-r);const d=h/Math.pow(Gg(i),s);let g=d*Math.sin(s*e),y=h-d*Math.cos(s*e);return g=.5*(g/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:g,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:s}=this,h=s-i,d=Math.sign(h),g=Math.sign(r)*Math.sqrt(e*e+h*h);let y=Math.atan2(e,Math.abs(h))*d;h*r<0&&(y-=Math.PI*Math.sign(e)*d);const w=oe(Me(y/r)+this.center[0],-180,180),k=oe(Me(2*Math.atan(Math.pow(s/g,1/r))-od),-85.051129,Ne);return new q(w,this.southernCenter?-k:k)}}class px extends iu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:re(e),y:ae(i),z:0}}unproject(e,i){const r=he(e),s=xe(i);return new q(r,s)}}const mx=Ci(Ne);class eS extends iu{project(e,i){const r=(i=Ci(i))*i,s=r*r;return{x:.5*((e=Ci(e))*(.8707-.131979*r+s*(s*(.003971*r-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,s=25,h=0,d=r*r;do{d=r*r;const w=d*d;h=(r*(1.007226+d*(.015085+w*(.028874*d-.044475-.005916*w)))-i)/(1.007226+d*(.045255+w*(.259866*d-.311325-.005916*11*w))),r=oe(r-h,-mx,mx)}while(Math.abs(h)>1e-6&&--s>0);d=r*r;const g=oe(Me(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=Me(r);return new q(g,y)}}const fx=Ci(Ne);class tS extends iu{project(e,i){i=Ci(i),e=Ci(e);const r=Math.cos(i),s=2/Math.PI,h=Math.acos(r*Math.cos(e/2)),d=Math.sin(h)/h,g=.5*(e*s+2*r*Math.sin(e/2)/d)||0,y=.5*(i+Math.sin(i)/d)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,s=i=(2*(1-i)-1)*Math.PI,h=25;const d=1e-6;let g=0,y=0;do{const w=Math.cos(s),k=Math.sin(s),A=2*k*w,S=k*k,E=w*w,D=Math.cos(r/2),R=Math.sin(r/2),F=2*D*R,j=R*R,Y=1-E*D*D,H=Y?1/Y:0,W=Y?Math.acos(w*D)*Math.sqrt(1/Y):0,J=.5*(2*W*w*R+2*r/Math.PI)-e,Z=.5*(W*k+s)-i,ee=.5*H*(E*j+W*w*D*S)+1/Math.PI,pe=H*(F*A/4-W*k*R),ce=.125*H*(A*R-W*k*E*F),me=.5*H*(S*D+W*j*w)+.5,we=pe*ce-me*ee;g=(Z*pe-J*me)/we,y=(J*ce-Z*ee)/we,r=oe(r-g,-Math.PI,Math.PI),s=oe(s-y,-fx,fx)}while((Math.abs(g)>d||Math.abs(y)>d)&&--h>0);return new q(Me(r),Me(s))}}class gx extends iu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ci(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:s}=this;return{x:Ci(e)*s*r+.5,y:-Math.sin(Ci(i))/s*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:s}=this,h=-(i-.5)/r,d=oe(Me((e-.5)/r)/s,-180,180),g=Math.asin(oe(h*s,-1,1)),y=oe(Me(g),-85.051129,Ne);return new q(d,y)}}class iS extends px{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const s=Hp(e,i,r);return fn(s,s,Sg(ms(r))),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,i,r){const s=N(i.lat,i.lng),h=mn([],s),d=r?e._centerAltitude+r:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;vn(s,s,h,ue(1,0)*lt*d);const g=He(new Float64Array(16));return Ee(g,e.pixelMatrix,e.globeMatrix),fn(s,s,g),new st(s[0],s[1])}pixelsPerMeter(e,i){return ue(1,0)*i}pixelSpaceConversion(e,i,r){const s=ue(1,e)*i,h=Vt(ue(1,45)*i,s,r);return this.pixelsPerMeter(e,i)/h}createTileMatrix(e,i,r){const s=w1(ms(r.canonical));return Ee(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,i){const{center:r}=e,s=Sg(ms(i));return Ot(s,s,Ci(r.lng)),vt(s,s,Ci(r.lat)),Oe(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,i,r,s){return Xb(e,i,r,!0)||new fe(0,0)}pointCoordinate3D(e,i,r){const s=this.pointCoordinate(e,i,r,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,i){return!Xb(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(s,h){const d=s.cameraToCenterDistance,g=s._centerAltitude*h,y=s._camera,w=s._camera.forward(),k=wi([],Ht([],w,-d),[0,0,g]),A=s.worldSize/(2*Math.PI),S=[0,0,-A],E=s.width/s.height,D=Math.tan(s.fovAboveCenter),R=Ht([],y.up(),D),F=Ht([],y.right(),D*E),j=mn([],wi([],wi([],w,R),F)),Y=[];let H;if(new cn(k,j).closestPointOnSphere(S,A,Y)){const W=wi([],Y,S),J=Jn([],W,k);H=Math.cos(s.fovAboveCenter)*Ki(J)}else{const W=Jn([],k,S),J=Jn([],S,k);mn(J,J);const Z=Ki(W)-A;H=Math.sqrt(Z*(Z+2*A));const ee=Math.acos(H/(A+Z))-Math.acos(An(w,J));H*=Math.cos(ee)}return 1.01*H}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Xl(e.zoom);if(r>0){const s=hx(e,ue(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Vt(i,s+h*(1-Math.cos(d)),Math.pow(r,10))}return i}upVector(e,i,r){return Hp(i,r,e,1)}upVectorScale(e){return{metersToTile:xg(Ag(ms(e)))}}}function _x(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new px(n);case"equirectangular":return new X6(n);case"naturalEarth":return new eS(n);case"equalEarth":return new K6(n);case"winkelTripel":return new tS(n);case"albers":return i?new gx(n):new Z6(n);case"lambertConformalConic":return i?new gx(n):new Q6(n);case"globe":return new iS(n)}throw new Error(`Invalid projection name: ${n.name}`)}const nS=hi.VectorTileFeature.types,aS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yg(n,e,i,r,s,h,d,g,y,w,k,A,S){const E=g?Math.min(tu,Math.round(g[0])):0,D=g?Math.min(tu,Math.round(g[1])):0;n.emplaceBack(e,i,Math.round(32*r),Math.round(32*s),h,d,(E<<1)+(y?1:0),D,16*w,16*k,256*A,256*S)}function Hg(n,e,i){n.emplaceBack(e,i)}function Zg(n,e,i,r,s,h,d){n.emplaceBack(e,i,r,s,h,d)}const Kg=(n,e,i,r)=>{for(let s=0;s<e;s++)n.emplaceBack(i[0],i[1],i[2],r[0],r[1],r[2])};function Xg(n,e,i,r,s){n.emplaceBack(e,i,r,s),n.emplaceBack(e,i,r,s),n.emplaceBack(e,i,r,s),n.emplaceBack(e,i,r,s)}function rS(n){for(const e of n.sections)if(l1(e.text))return!0;return!1}class n0{constructor(e){this.layoutVertexArray=new Vl,this.indexArray=new fa,this.programConfigurations=e,this.segments=new In,this.dynamicLayoutVertexArray=new ma,this.opacityVertexArray=new Jl,this.placedSymbolArray=new lg,this.iconTransitioningVertexArray=new us,this.globeExtVertexArray=new Ul,this.zOffsetVertexArray=new ss,this.orientationVertexArray=new Np}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,r,s,h){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_6.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,w6.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,aS,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,x6.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,y6.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,b6.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,v6.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}yt(n0,"SymbolBuffers");class a0{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new In,this.collisionVertexArray=new dc,this.collisionVertexArrayExt=new ma}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,k6.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,A6.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yt(a0,"CollisionBuffers");class Qg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=He([]),this.placementViewportMatrix=He([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=q2(this.zoom,i["text-size"],this.worldview),this.iconSizeData=q2(this.zoom,i["icon-size"],this.worldview);const r=this.layers[0].layout,s=r.get("symbol-sort-key"),h=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(d=>fr[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new n0(new l(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new n0(new l(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new jp,this.lineVertexArray=new hg,this.symbolInstances=new cg}calculateGlyphDependencies(e,i,r,s,h){for(const d of e){const g=d.codePointAt(0);if(g===void 0)break;if(i[g]=!0,s&&h&&g<=65535){const y=hm[d];y&&(i[y.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!I1(this.activeReplacements,r)&&(this.activeReplacements=r,!0)}populate(e,i,r,s){const h=this.layers[0],d=h.layout,g=this.projection.name==="globe",y=d.get("text-font"),w=d.get("text-field"),k=d.get("icon-image"),[A,S]=d.get("icon-size-scale-range"),E=oe(i.scaleFactor||1,A,S),D=(w.value.kind!=="constant"||w.value.value instanceof Ra&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),R=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,F=d.get("symbol-sort-key");if(this.features=[],!D&&!R)return;const j=i.iconDependencies,Y=i.glyphDependencies,H=i.availableImages,W=new Yi(this.zoom,{worldview:this.worldview});for(const{feature:J,id:Z,index:ee,sourceLayerIndex:pe}of e){const ce=h._featureFilter.needGeometry,me=ft(J,ce);if(!h._featureFilter.filter(W,me,r))continue;if(ce||(me.geometry=bt(J,r,s)),g&&J.type!==1&&r.z<=5){const Ye=me.geometry,Ke=.98078528056,Be=(qe,De)=>An(Hp(qe.x,qe.y,r,1),Hp(De.x,De.y,r,1))<Ke;for(let qe=0;qe<Ye.length;qe++)Ye[qe]=at(Ye[qe],Be)}let we,Le;if(D){const Ye=h.getValueAndResolveTokens("text-field",me,r,H),Ke=Ra.factory(Ye);rS(Ke)&&(this.hasRTLText=!0),(!this.hasRTLText||Nl()==="unavailable"||this.hasRTLText&&To.isParsed())&&(we=T6(Ke,h,me))}if(R){const Ye=h.getValueAndResolveTokens("icon-image",me,r,H);Le=typeof Ye=="string"?Ua.build(Ye):Ye}if(!we&&!Le)continue;const Ze=this.sortFeaturesByKey?F.evaluate(me,{},r):void 0,Ve={id:Z,text:we,icon:Le,index:ee,sourceLayerIndex:pe,geometry:me.geometry,properties:J.properties,type:nS[J.type],sortKey:Ze};if(this.features.push(Ve),Le){const Ye=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ke,iconSecondary:Be}=sx(Le,this.iconSizeData,Ye["icon-size"],r,this.zoom,Ve,this.pixelRatio,E,this.worldview),qe=Ke.id.toString();if(j.has(qe)?j.get(qe).push(Ke):j.set(qe,[Ke]),Be){const De=Be.id.toString();j.has(De)?j.get(De).push(Be):j.set(De,[Be])}}if(we){const Ye=y.evaluate(me,{},r).join(","),Ke=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fr.vertical)>=0;for(const Be of we.sections)if(Be.image){const qe=Be.image.getPrimary().scaleSelf(this.pixelRatio),De=qe.id.toString(),Re=j.get(De)||[];Re.push(qe),j.set(De,Re)}else{const qe=oc(we.toString()),De=Be.fontStack||Ye,Re=Y[De]=Y[De]||{};this.calculateGlyphDependencies(Be.text,Re,Ke,this.allowVerticalPlacement,qe)}}}if(d.get("symbol-placement")==="line"&&(this.features=function(J){const Z={},ee={},pe=[];let ce=0;function me(Ve){pe.push(J[Ve]),ce++}function we(Ve,Ye,Ke){const Be=ee[Ve];return delete ee[Ve],ee[Ye]=Be,pe[Be].geometry[0].pop(),pe[Be].geometry[0]=pe[Be].geometry[0].concat(Ke[0]),Be}function Le(Ve,Ye,Ke){const Be=Z[Ye];return delete Z[Ye],Z[Ve]=Be,pe[Be].geometry[0].shift(),pe[Be].geometry[0]=Ke[0].concat(pe[Be].geometry[0]),Be}function Ze(Ve,Ye,Ke){const Be=Ke?Ye[0][Ye[0].length-1]:Ye[0][0];return`${Ve}:${Be.x}:${Be.y}`}for(let Ve=0;Ve<J.length;Ve++){const Ye=J[Ve],Ke=Ye.geometry,Be=Ye.text?Ye.text.toString():null;if(!Be){me(Ve);continue}const qe=Ze(Be,Ke),De=Ze(Be,Ke,!0);if(qe in ee&&De in Z&&ee[qe]!==Z[De]){const Re=Le(qe,De,Ke),tt=we(qe,De,pe[Re].geometry);delete Z[qe],delete ee[De],ee[Ze(Be,pe[tt].geometry,!0)]=tt,pe[Re].geometry=null}else qe in ee?we(qe,De,Ke):De in Z?Le(qe,De,Ke):(me(Ve),Z[qe]=ce-1,ee[De]=ce-1)}return pe.filter(Ve=>Ve.geometry)}(this.features)),d.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const J of i.elevationFeatures)this.elevationFeatureIdToIndex.set(J.id,this.elevationFeatures.length),this.elevationFeatures.push(J)}}else d.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((J,Z)=>J.sortKey-Z.sortKey)}update(e,i,r,s,h,d,g){this.text.programConfigurations.updatePaintArrays(e,i,h,r,s,d,g,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,h,r,s,d,g,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const r=ze(e),s=1/r;let h=!1,d=!1;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),w=It(1,0,0),k=It(0,1,0),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:S,numIconVertices:E,numVerticalIconVertices:D}=y,R=A>0||S>0,F=E>0,j=this.elevationFeatures[y.elevationFeatureIndex];if(j){const Y=new st(y.tileAnchorX,y.tileAnchorY),H=.075+j.pointElevation(Y);y.zOffset!==H&&(i=!0,y.zOffset=H);const W=j.computeSlopeNormal(Y,s),J=pl(Ka(),It(0,0,1),W);po(w,w,J),po(k,k,J),w[2]*=r,k[2]*=r,w[0]===1&&w[1]===0&&w[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(h=h||R,d=d||F)}if(R&&(Kg(this.text.orientationVertexArray,A,w,k),Kg(this.text.orientationVertexArray,S,w,k)),F){const{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:H}=y;Y>=0&&Kg(this.icon.orientationVertexArray,E,w,k),H>=0&&Kg(this.icon.orientationVertexArray,D,w,k)}}h||(this.text.orientationVertexArray=void 0),d||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(h,d,g)=>{r+=d,r>h.length&&h.resize(r);for(let y=-d;y<0;y++)h.emplace(y+r,g)},i=(h,d,g)=>{s+=d,s>h.length&&h.resize(s);for(let y=-d;y<0;y++)h.emplace(y+s,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,s=0;for(let h=0;h<this.symbolInstances.length;h++){const d=this.symbolInstances.get(h),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:y,numIconVertices:w}=d,k=d.zOffset,A=w>0;if((g>0||y>0)&&(e(this.text.zOffsetVertexArray,g,k),e(this.text.zOffsetVertexArray,y,k)),A){const{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:E}=d;S>=0&&i(this.icon.zOffsetVertexArray,w,k),E>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_x(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:s,y:h}of i)this.lineVertexArray.emplaceBack(s,h);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,s,h,d,g,y,w,k,A,S,E,D,R,F){const j=e.indexArray,Y=e.layoutVertexArray,H=e.globeExtVertexArray,W=e.segments.prepareSegment(4*i.length,Y,j,this.canOverlap?d.sortKey:void 0),J=this.glyphOffsetArray.length,Z=W.vertexLength,ee=this.allowVerticalPlacement&&g===fr.vertical?Math.PI/2:0,pe=d.text&&d.text.sections;for(let me=0;me<i.length;me++){const{tl:we,tr:Le,bl:Ze,br:Ve,texPrimary:Ye,texSecondary:Ke,pixelOffsetTL:Be,pixelOffsetBR:qe,minFontScaleX:De,minFontScaleY:Re,glyphOffset:tt,isSDF:nt,sectionIndex:Lt}=i[me],At=W.vertexLength,ct=tt[1];if(Yg(Y,w.x,w.y,we.x,ct+we.y,Ye.x,Ye.y,r,nt,Be.x,Be.y,De,Re),Yg(Y,w.x,w.y,Le.x,ct+Le.y,Ye.x+Ye.w,Ye.y,r,nt,qe.x,Be.y,De,Re),Yg(Y,w.x,w.y,Ze.x,ct+Ze.y,Ye.x,Ye.y+Ye.h,r,nt,Be.x,qe.y,De,Re),Yg(Y,w.x,w.y,Ve.x,ct+Ve.y,Ye.x+Ye.w,Ye.y+Ye.h,r,nt,qe.x,qe.y,De,Re),y){const{x:et,y:Kt,z:kt}=y.anchor,[Pt,Ut,ni]=y.up;Zg(H,et,Kt,kt,Pt,Ut,ni),Zg(H,et,Kt,kt,Pt,Ut,ni),Zg(H,et,Kt,kt,Pt,Ut,ni),Zg(H,et,Kt,kt,Pt,Ut,ni),Xg(e.dynamicLayoutVertexArray,et,Kt,kt,ee)}else Xg(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ee);if(F){const et=Ke||Ye;Hg(e.iconTransitioningVertexArray,et.x,et.y),Hg(e.iconTransitioningVertexArray,et.x+et.w,et.y),Hg(e.iconTransitioningVertexArray,et.x,et.y+et.h),Hg(e.iconTransitioningVertexArray,et.x+et.w,et.y+et.h)}j.emplaceBack(At,At+1,At+2),j.emplaceBack(At+1,At+2,At+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),me!==i.length-1&&Lt===i[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,d,d.index,{},E,D,R,pe&&pe[Lt],this.worldview)}const ce=y?y.anchor:w;e.placedSymbolArray.emplaceBack(ce.x,ce.y,ce.z,w.x,w.y,J,this.glyphOffsetArray.length-J,Z,k,A,w.segment,r?r[0]:0,r?r[1]:0,s[0],s[1],g,0,0,0,S,0)}_commitLayoutVertex(e,i,r,s,h,d,g){e.emplaceBack(i,r,s,h,d,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,r,s,h,d,g){const y=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),w=y.vertexLength,k=g.tileAnchorX,A=g.tileAnchorY;for(let E=0;E<4;E++)r.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(r.layoutVertexArray,s,h,d,k,A,new st(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,s,h,d,k,A,new st(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,s,h,d,k,A,new st(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,s,h,d,k,A,new st(e.x1,e.y2)),y.vertexLength+=4;const S=r.indexArray;S.emplaceBack(w,w+1),S.emplaceBack(w+1,w+2),S.emplaceBack(w+2,w+3),S.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,s,h,d){for(let g=s;g<h;g++){const y=r.get(g),w=this.getSymbolInstanceTextSize(e,d,i,g);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,r,s,h,d){for(let g=s;g<h;g++){const y=r.get(g),w=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new a0(Fh,I2.members,us),this.iconCollisionBox=new a0(Fh,I2.members,us);const s=pm(this.iconSizeData,e),h=pm(this.textSizeData,e,r);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(h,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,r,s){const h=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:s),d=Z1(this.textSizeData,e,h)/ha;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,r){const s=this.icon.placedSymbolArray.get(r),h=Z1(this.iconSizeData,e,s);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,i,r,s){e.emplaceBack(i,-r,-r,s),e.emplaceBack(i,r,-r,s),e.emplaceBack(i,r,r,s),e.emplaceBack(i,-r,r,s)}_updateTextDebugCollisionBoxes(e,i,r,s,h,d,g){for(let y=s;y<h;y++){const w=r.get(y),k=this.getSymbolInstanceTextSize(e,d,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,w.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,r,s,h,d,g){for(let y=s;y<h;y++){const w=r.get(y),k=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,w.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,r,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=pm(this.iconSizeData,e,s),d=pm(this.textSizeData,e,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(d,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y,r),this._updateTextDebugCollisionBoxes(d,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y,r),this._updateIconDebugCollisionBoxes(h,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y,s),this._updateIconDebugCollisionBoxes(h,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y,s)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,s,h,d,g,y,w){const k={};if(i<r){const{x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W,featureIndex:J}=e.get(i);k.textBox={x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W},k.textFeatureIndex=J}if(s<h){const{x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W,featureIndex:J}=e.get(s);k.verticalTextBox={x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W},k.verticalTextFeatureIndex=J}if(d<g){const{x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W,featureIndex:J}=e.get(d);k.iconBox={x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W},k.iconFeatureIndex=J}if(y<w){const{x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W,featureIndex:J}=e.get(y);k.verticalIconBox={x1:A,y1:S,x2:E,y2:D,padding:R,projectedAnchorX:F,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:H,tileAnchorY:W},k.verticalIconFeatureIndex=J}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),s=r.vertexStartIndex+4*r.numGlyphs;for(let h=r.vertexStartIndex;h<s;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),s=[],h=[],d=[];for(let g=0;g<this.symbolInstances.length;++g){d.push(g);const y=this.symbolInstances.get(g);s.push(0|Math.round(i*y.tileAnchorX+r*y.tileAnchorY)),h.push(y.featureIndex)}return d.sort((g,y)=>s[g]-s[y]||h[y]-h[g]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:w}=r;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),h>=0&&h!==s&&this.addIndicesForPlacedSymbol(this.text,h),d>=0&&d!==h&&d!==s&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yx,wx,r0;yt(Qg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qg.addDynamicAttributes=Xg;class bx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:bl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt(bx,"FormatSectionOverride",{omit:["defaultValue"]});const o0=()=>r0||(r0={layout:yx||(yx=new Cn({"symbol-placement":new Qe(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Qe(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qe(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qe(ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Qe(ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Qe(ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Qe(ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qe(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qe(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qe(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new mt(ve.layout_symbol["icon-size"]),"icon-size-scale-range":new Qe(ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new mt(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mt(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new mt(ve.layout_symbol["icon-image"]),"icon-rotate":new mt(ve.layout_symbol["icon-rotate"]),"icon-padding":new Qe(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Qe(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new mt(ve.layout_symbol["icon-offset"]),"icon-anchor":new mt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qe(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qe(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qe(ve.layout_symbol["text-rotation-alignment"]),"text-field":new mt(ve.layout_symbol["text-field"]),"text-font":new mt(ve.layout_symbol["text-font"]),"text-size":new mt(ve.layout_symbol["text-size"]),"text-size-scale-range":new Qe(ve.layout_symbol["text-size-scale-range"]),"text-max-width":new mt(ve.layout_symbol["text-max-width"]),"text-line-height":new mt(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new mt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new mt(ve.layout_symbol["text-justify"]),"text-radial-offset":new mt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qe(ve.layout_symbol["text-variable-anchor"]),"text-anchor":new mt(ve.layout_symbol["text-anchor"]),"text-max-angle":new Qe(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Qe(ve.layout_symbol["text-writing-mode"]),"text-rotate":new mt(ve.layout_symbol["text-rotate"]),"text-padding":new Qe(ve.layout_symbol["text-padding"]),"text-keep-upright":new Qe(ve.layout_symbol["text-keep-upright"]),"text-transform":new mt(ve.layout_symbol["text-transform"]),"text-offset":new mt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new Qe(ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qe(ve.layout_symbol["text-ignore-placement"]),"text-optional":new Qe(ve.layout_symbol["text-optional"]),visibility:new Qe(ve.layout_symbol.visibility)})),paint:wx||(wx=new Cn({"icon-opacity":new mt(ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new mt(ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new mt(ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new mt(ve.paint_symbol["text-emissive-strength"]),"icon-color":new mt(ve.paint_symbol["icon-color"]),"icon-halo-color":new mt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new mt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Qe(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qe(ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Qe(ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new mt(ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new mt(ve.paint_symbol["text-occlusion-opacity"]),"text-color":new mt(ve.paint_symbol["text-color"],{runtimeType:tr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new mt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new mt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new mt(ve.paint_symbol["text-halo-blur"]),"text-translate":new Qe(ve.paint_symbol["text-translate"]),"text-translate-anchor":new Qe(ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Qe(ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Qe(ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Qe(ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Qe(ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new mt(ve.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},r0);class e_ extends Pa{constructor(e,i,r,s){super(e,o0(),i,r,s),this._colorAdjustmentMatrix=He([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const s=[];for(const h of r)s.indexOf(h)<0&&s.push(h);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,r,s){return this._saturation===e&&this._contrast===i&&this._brightnessMin===r&&this._brightnessMax===s||(this._colorAdjustmentMatrix=function(h,d,g,y){h=Aa(h),d=ja(d);const w=St(),k=h/3,A=1-2*k,S=[A,k,k,0,k,A,k,0,k,k,A,0,0,0,0,1],E=.5-.5*d,D=y-g;return Ee(w,[D,0,0,0,0,D,0,0,0,0,D,0,g,g,g,1],[d,0,0,0,0,d,0,0,0,0,d,0,E,E,E,1]),Ee(w,w,S),w}(e,i,r,s),this._saturation=e,this._contrast=i,this._brightnessMin=r,this._brightnessMax=s),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,r,s){const h=this.layout.get(e).evaluate(i,{},r,s),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Eh(d.value)||!h?h:function(g,y){return y.replace(/{([^{}]+)}/g,(w,k)=>k in g?String(g[k]):"")}(i.properties,h)}createBucket(e){return new Qg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of o0().paint.overridableProperties){if(!e_.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new bx(i),s=new Rl(r,i.property.specification,this.scope,this.options);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new ac("source",s):new rc("composite",s,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Fl(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&e_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),s=o0().paint.properties[i];let h=!1;const d=g=>{for(const y of g)if(s.overrides&&s.overrides.hasOverride(y))return void(h=!0)};if(r.value.kind==="constant"&&r.value.value instanceof Ra)d(r.value.value.sections);else if(r.value.kind==="source"){const g=w=>{h||(w instanceof Gt&&_t(w.value)===$u?d(w.value.sections):w instanceof xl?d(w.sections):w.eachChild(g))},y=r.value;y._styleExpression&&g(y._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,r){return{config:new Hl(this,{zoom:i,lut:r}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let vx,xx,kx,Ax;var s0=Ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function l0(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function u0(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class c0{constructor(e,i,r,s){this.context=e,this.format=r,this.useMipmap=s&&s.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:s&&s.premultiply})}update(e,i){const r=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,s=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:h}=this,{gl:d}=h,{x:g,y}=i&&i.position?i.position:{x:0,y:0},w=g+r,k=y+s;!this.size||this.size[0]===w&&this.size[1]===k||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const A=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&w>0&&k>0){const S=this.useMipmap?Math.floor(Math.log2(Math.max(w,k)))+1:1;d.texStorage2D(d.TEXTURE_2D,S,this.format,w,k),this.size=[w,k]}if(this.size)if(A)d.texSubImage2D(d.TEXTURE_2D,0,g,y,l0(this.format),u0(this.format),e);else{const S=e.data;S&&d.texSubImage2D(d.TEXTURE_2D,0,g,y,r,s,l0(this.format),u0(this.format),S)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,r=!1){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,r,s,h){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),this.wrapS=r),s!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrapT=s),h!==this.compareMode&&(h?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.COMPARE_REF_TO_TEXTURE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_FUNC,h)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.NONE),this.compareMode=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class t_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:r}=this,{gl:s}=r;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrapS=i)}}function i_(n,e,i,r,s,h,d,g){const y=[n,e,1,i,r,1,s,h,1],w=[d,g,1],k=Xe([],y),[A,S,E]=ul(w,w,k);return zt(y,y,[A,0,0,0,S,0,0,0,E])}function Sx(n,e,i,r,s,h,d,g){const y=function(w,k,A,S,E,D,R,F){const j=i_(0,0,1,0,1,1,0,1),Y=i_(w,k,A,S,E,D,R,F);return zt(Y,Y,Xe([],j))}(n,e,i,r,s,h,d,g);return[y[2]/y[8]/lt,y[5]/y[8]/lt]}function n_(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ne)]}class Tx extends zs{constructor(e,i,r,s){super(),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Is("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=qd(this.map._requestManager.transformRequest(this.url,Bu.Image),(r,s)=>{this._imageRequest=null,this._loaded=!0,r?this.fire(new ih(r)):s&&(this.image=s instanceof HTMLImageElement?Wr.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new t_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Is("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof t_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],r=e[0][1];for(const h of e)h[1]>r&&(r=h[1]),h[1]<i&&(i=h[1]);const s=(r+i)/2;if(s>Ne?this.onNorthPole=!0:s<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=e.map(fe.fromLngLat);this.tileID=function(d){let g=1/0,y=1/0,w=-1/0,k=-1/0;for(const R of d)g=Math.min(g,R.x),y=Math.min(y,R.y),w=Math.max(w,R.x),k=Math.max(k,R.y);const A=Math.max(w-g,k-y),S=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),E=Math.pow(2,S);let D=Math.floor((g+w)/2*E);return D>1&&(D-=1),new Ac(S,D,Math.floor((y+k)/2*E))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Is("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const Y=this.tiles[j];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=gm(new Ac(0,0,0),this.map.transform.projection),r=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const Y=j[1].x-j[0].x,H=j[1].y-j[0].y,W=j[2].x-j[1].x,J=j[2].y-j[1].y,Z=j[3].x-j[2].x,ee=j[3].y-j[2].y,pe=j[0].x-j[3].x,ce=j[0].y-j[3].y,me=Y*J-W*H,we=W*ee-Z*J,Le=Z*ce-pe*ee,Ze=pe*H-Y*ce;return me>0&&we>0&&Le>0&&Ze>0||me<0&&we<0&&Le<0&&Ze<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const s=gm(this.tileID,this.map.transform.projection),[h,d,g,y]=this.coordinates.map(j=>{const Y=s.projection.project(j[0],j[1]);return dx(s,Y)._round()});this.perspectiveTransform=Sx(h.x,h.y,d.x,d.y,g.x,g.y,y.x,y.y);const w=this._boundsArray=new $l;w.emplaceBack(h.x,h.y,0,0),w.emplaceBack(d.x,d.y,lt,0),w.emplaceBack(y.x,y.y,0,lt),w.emplaceBack(g.x,g.y,lt,lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,s0.members),this.boundsSegments=In.simpleSegment(0,0,4,2);const k=[],A=[n_((S=this.coordinates)[0]),n_(S[1]),n_(S[2]),n_(S[3])];var S;const[E,D,R,F]=function(j){let Y=j[0][0],H=Y,W=j[0][1],J=W;for(let Z=1;Z<j.length;Z++)j[Z][0]<Y?Y=j[Z][0]:j[Z][0]>H&&(H=j[Z][0]),j[Z][1]<W?W=j[Z][1]:j[Z][1]>J&&(J=j[Z][1]);return[Y,W,H-Y,J-W]}(A);{const j=new $l,[Y,H,W,J]=function(Be){let qe=Be[0].x,De=qe,Re=Be[0].y,tt=Re;for(let nt=1;nt<Be.length;nt++)Be[nt].x<qe?qe=Be[nt].x:Be[nt].x>De&&(De=Be[nt].x),Be[nt].y<Re?Re=Be[nt].y:Be[nt].y>tt&&(tt=Be[nt].y);return[qe,Re,De-qe,tt-Re]}(r),Z=Be=>[(Be.x-Y)/W,(Be.y-H)/J],[ee,pe,ce,me]=r.map(Z),we=function(Be,qe,De,Re,tt,nt,Lt,At){const ct=i_(0,0,1,0,1,1,0,1);return zt(ct,ct,Xe([],i_(Be,qe,De,Re,tt,nt,Lt,At)))}(ee[0],ee[1],pe[0],pe[1],ce[0],ce[1],me[0],me[1]);this.elevatedGlobePerspectiveTransform=Sx(ee[0],ee[1],pe[0],pe[1],ce[0],ce[1],me[0],me[1]);const Le=(Be,qe)=>{k.push(Be.lng);const De=Math.round((Be.lng-E)/R*lt),Re=Math.round((Be.lat-D)/F*lt),tt=Z(qe),nt=ul([],[tt[0],tt[1],1],we),Lt=Math.round(nt[0]/nt[2]*lt),At=Math.round(nt[1]/nt[2]*lt);j.emplaceBack(De,Re,Lt,At)},Ze=r[3].x-r[0].x,Ve=r[3].y-r[0].y,Ye=r[2].x-r[1].x,Ke=r[2].y-r[1].y;for(let Be=0;Be<65;Be++){const qe=Be/64,De=[r[0].x+qe*Ze,r[0].y+qe*Ve],Re=[r[1].x+qe*Ye,r[1].y+qe*Ke],tt=Re[0]-De[0],nt=Re[1]-De[1];for(let Lt=0;Lt<65;Lt++){const At=Lt/64,ct={x:De[0]+tt*At,y:De[1]+nt*At};Le(i.projection.unproject(ct.x,ct.y),ct)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,s0.members)}{this.maxLongitudeTriangleSize=0;let j=[],Y=new fa;const H=(W,J,Z)=>{Y.emplaceBack(W,J,Z);const ee=k[W],pe=k[J],ce=k[Z],me=Math.min(Math.min(ee,pe),ce),we=Math.max(Math.max(ee,pe),ce)-me;we>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=we),j.push(me+we/2)};for(let W=0;W<64;W++)for(let J=0;J<64;J++){const Z=65*W+J,ee=Z+1,pe=Z+65,ce=pe+1;H(Z,pe,ee),H(ee,pe,ce)}[j,Y]=function(W,J){const Z=Array.from({length:W.length},(ce,me)=>me);Z.sort((ce,me)=>W[ce]-W[me]);const ee=[],pe=new fa;for(let ce=0;ce<Z.length;ce++){const me=Z[ce];ee.push(W[me]);const we=3*me,Le=we+1;pe.emplaceBack(J.uint16[we],J.uint16[Le],J.uint16[Le+1])}return[ee,pe]}(j,Y),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Y)}this.elevatedGlobeSegments=In.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/lt,0,F/lt,0,0,D,E,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,r=i.gl;!this._dirty||this.texture instanceof t_||(this.texture?this.texture.update(this.image):(this.texture=new c0(i,this.image,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let s=(h=e+180)+360*Math.round((r[0]-h)/360);var h;const d=new In,g=(A,S)=>{d.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:i.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-s)<=y){const A=ua(r,0,r.length,s+y);return A===r.length||g(A,Sn(r,A+1,r.length,s+360-y)-A),d}s<r[0]&&(s+=360);const w=Sn(r,0,r.length,s-y);if(w===r.length)return g(0,r.length),d;g(0,w-0);const k=ua(r,w+1,r.length,s+y);return k!==r.length&&g(k,r.length-k),d}}const oS=(Math.pow(256,2)-1)/16907520;class Px extends Pa{constructor(e,i,r,s){super(e,{layout:kx||(kx=new Cn({visibility:new Qe(ve.layout_raster.visibility)})),paint:Ax||(Ax=new Cn({"raster-opacity":new Qe(ve.paint_raster["raster-opacity"]),"raster-color":new Gs(ve.paint_raster["raster-color"]),"raster-color-mix":new Qe(ve.paint_raster["raster-color-mix"]),"raster-color-range":new Qe(ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new Qe(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qe(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qe(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Qe(ve.paint_raster["raster-saturation"]),"raster-contrast":new Qe(ve.paint_raster["raster-contrast"]),"raster-resampling":new Qe(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Qe(ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Qe(ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new Qe(ve.paint_raster["raster-array-band"]),"raster-elevation":new Qe(ve.paint_raster["raster-elevation"]),"raster-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},i,r,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Tx&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[r,s]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(s)||r===this._curRampRange[0]&&s===this._curRampRange[1]||(this.colorRamp=Zp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:s}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,s])}}let Mx,Ex,Cx,Dx,Ix;class zx extends Pa{constructor(e,i,r,s){super(e,{layout:Mx||(Mx=new Cn({visibility:new Qe(ve["layout_raster-particle"].visibility)})),paint:Ex||(Ex=new Cn({"raster-particle-array-band":new Qe(ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Qe(ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gs(ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Qe(ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Qe(ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Qe(ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Qe(ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Qe(ve["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},i,r,s),this._updateColorRamp(),this.lastInvalidatedAt=Wr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Zp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Wr.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class sS extends Pa{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function h0(n,e,i){const r=[0,0,1],s=jo([]);return Uo(s,s,i?-Ci(n)+Math.PI:Ci(n)),Vo(s,s,-Ci(e)),po(r,r,s),mn(r,r)}function Lx(n,e){const i=a_(n.projection,n.zoom,n.width,n.height),r=function(h,d,g,y,w){const k=new q(g.lng-180*nu,g.lat),A=new q(g.lng+180*nu,g.lat),S=h.project(k.lng,k.lat),E=h.project(A.lng,A.lat),D=-Math.atan2(E.y-S.y,E.x-S.x),R=fe.fromLngLat(g);R.y=oe(R.y,-1+nu,1-nu);const F=R.toLngLat(),j=h.project(F.lng,F.lat),Y=fe.fromLngLat(F);Y.x+=nu;const H=Y.toLngLat(),W=h.project(H.lng,H.lat),J=Bx(W.x-j.x,W.y-j.y,D),Z=fe.fromLngLat(F);Z.y+=nu;const ee=Z.toLngLat(),pe=h.project(ee.lng,ee.lat),ce=Bx(pe.x-j.x,pe.y-j.y,D),me=Math.abs(J.x)/Math.abs(ce.y),we=He([]);Qt(we,we,-D*(1-(w?0:y)));const Le=He([]);return Oe(Le,Le,[1,1-(1-me)*y,1]),Le[4]=-ce.x/ce.y*y,Qt(Le,Le,D),Ee(Le,we,Le),Le}(n.projection,0,n.center,i,e),s=Rx(n);return Oe(r,r,[s,s,1]),r}function Rx(n){const e=n.projection,i=a_(n.projection,n.zoom,n.width,n.height),r=d0(e,n.center),s=d0(e,q.convert(e.center));return Math.pow(2,r*i+(1-i)*s)}function a_(n,e,i,r,s=1/0){const h=n.range;if(!h)return 0;const d=Math.min(s,Math.max(i,r)),g=Math.log(d/1024)/Math.LN2;return ge(h[0]+g,h[1]+g,e)}const nu=1/4e4;function d0(n,e){const i=oe(e.lat,-85.051129,Ne),r=new q(e.lng-180*nu,i),s=new q(e.lng+180*nu,i),h=n.project(r.lng,i),d=n.project(s.lng,i),g=fe.fromLngLat(r),y=fe.fromLngLat(s),w=d.x-h.x,k=d.y-h.y,A=y.x-g.x,S=y.y-g.y,E=Math.sqrt((A*A+S*S)/(w*w+k*k));return Math.log(E)/Math.LN2}function Bx(n,e,i){const r=Math.cos(i),s=Math.sin(i);return{x:n*r-e*s,y:n*s+e*r}}function Wx(n,e,i){He(n),Qt(n,n,Ci(e[2])),vt(n,n,Ci(e[0])),Ot(n,n,Ci(e[1])),Oe(n,n,i),Ee(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function r_(n,e,i,r,s,h,d,g){const y=[i[0]-e[0],i[1]-e[1],0],w=[r[0]-e[0],r[1]-e[1],0];if(Ki(y)<1e-12||Ki(w)<1e-12)return jo(n);const k=Un([],y,w);mn(k,k),Ui(w,r,e),y[2]=(h-s)*g,w[2]=(d-s)*g;const A=y;return Un(A,y,w),mn(A,A),pl(n,k,A)}function p0(n,e,i=!1){const r=Xl(e.zoom),s=function(h,d,g){const y=d.worldSize,w=[h[12],h[13],h[14]],k=xe(w[1]/y),A=he(w[0]/y),S=He([]),E=ue(1,k)*y,D=ue(1,0)*y*Ge(k,d.zoom),R=1/b1(y);let F=D*R;if(g){const W=a_(d.projection,d.zoom,d.width,d.height,1024);F=R*d.projection.pixelSpaceConversion(d.center.lat,y,W)}const j=N(k,A);wi(j,j,Ht([],mn([],j),E*F*w[2]));const Y=function(W){const J=[W[0],W[1],W[2]];let Z=[0,1,0];const ee=Un([],Z,J);return Un(Z,J,ee),Rr(Z)===0&&(Z=[0,1,0],Un(ee,J,Z)),mn(ee,ee),mn(Z,Z),mn(J,J),[ee[0],ee[1],ee[2],0,Z[0],Z[1],Z[2],0,J[0],J[1],J[2],0,W[0],W[1],W[2],1]}(j);Oe(S,S,[F,F,F*E]),Ae(S,S,[-w[0],-w[1],-w[2]]);const H=Ee([],d.globeMatrix,Y);return Ee(H,H,S),Ee(H,H,h),H}(n,e,i);if(r>0){const h=function(d,g){const y=g.worldSize,w=ue(1,0)*y*Ge(g.center.lat,g.zoom)/b1(y),k=ue(1,g.center.lat)*y,A=He([]);return Ot(A,A,Ci(g.center.lng)),vt(A,A,Ci(g.center.lat)),Ae(A,A,[0,0,_]),Oe(A,A,[w,w,w*k]),Ae(A,A,[g.point.x-.5*y,g.point.y-.5*y,0]),Ee(A,A,d),Ee(A,g.globeMatrix,A)}(n,e);return function(d,g,y){const w=(D,R,F)=>{const j=Ki(D),Y=Ki(R),H=Ks(D,R,F);return Ht(H,H,1/Ki(H)*Vt(j,Y,F))},k=w([d[0],d[1],d[2]],[g[0],g[1],g[2]],y),A=w([d[4],d[5],d[6]],[g[4],g[5],g[6]],y),S=w([d[8],d[9],d[10]],[g[8],g[9],g[10]],y),E=Ks([d[12],d[13],d[14]],[g[12],g[13],g[14]],y);return[k[0],k[1],k[2],0,A[0],A[1],A[2],0,S[0],S[1],S[2],0,E[0],E[1],E[2],1]}(s,h,r)}return s}function Nx(n,e,i,r){const s=Di.projectAabbCorners(r,i);let h=Number.MAX_VALUE,d=-1;for(let w=0;w<s.length;++w){const k=s[w];k[0]=(.5*k[0]+.5)*e.width,k[1]=(.5-.5*k[1])*e.height,k[2]<h&&(d=w,h=k[2])}const g=w=>new st(s[w][0],s[w][1]);let y;switch(d){case 0:case 6:y=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:y=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:y=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:y=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(qa(n,y))return h}const lS=Ei([{name:"a_pos_3f",components:3,type:"Float32"}]),uS=Ei([{name:"a_color_3f",components:3,type:"Float32"}]),cS=Ei([{name:"a_color_4f",components:4,type:"Float32"}]),hS=Ei([{name:"a_uv_2f",components:2,type:"Float32"}]),dS=Ei([{name:"a_normal_3f",components:3,type:"Float32"}]),pS=Ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),mS=Ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Fx={None:0,Model:1,Symbol:2,FillExtrusion:4};class o_{constructor(e,i,r,s){this.message=(e?`${e}: `:"")+r,s&&(this.identifier=s),i!=null&&i.__line__&&(this.line=i.__line__)}}function m0(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Ox{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $x{constructor(){this.instancedDataArray=new ql,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class f0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,r,s){this.tileToMeter=ze(r);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:g,index:y,sourceLayerIndex:w}of e){const k=g??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),A=ft(d,h);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview}),A,r))continue;const S={id:k,sourceLayerIndex:w,index:y,geometry:h?A.geometry:bt(d,r,s),properties:d.properties,type:d.type,patterns:{}},E=this.addFeature(S,S.geometry,A);E&&i.featureIndex.insert(d,S.geometry,y,w,this.index,this.instancesPerModel[E].instancedDataArray.length,lt/32)}this.lookup=null}update(e,i,r,s){for(const h in this.instancesPerModel){const d=this.instancesPerModel[h];for(const g in e)d.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(d.features[d.idToFeaturesIndex[g]],e[g],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const s of r.features){const h=this.layers[0],d=s.feature,g=this.canonical,y=h.paint.get("model-rotation").evaluate(d,{},g),w=h.paint.get("model-scale").evaluate(d,{},g),k=h.paint.get("model-translation").evaluate(d,{},g);Br(s.rotation,y)&&Br(s.scale,w)&&Br(s.translation,k)||(this.evaluate(s,s.featureStates,r,!0),e=!0)}}return e}updateReplacement(e,i,r,s){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(I1(this.activeReplacements,h))return!1;this.activeReplacements=h;let d=!1;for(const g in this.instancesPerModel){const y=this.instancesPerModel[g],w=y.instancedDataArray;for(const k of y.features){const A=k.instancedDataOffset,S=k.instancedDataCount;for(let E=0;E<S;E++){const D=16*(E+A);let R=w.float32[D+0];const F=R>lt;R=F?R-lt:R;const j=Math.floor(R),Y=w.float32[D+1];let H=!1;for(const W of this.activeReplacements)if(!zv(W,r,Fx.Model,s)&&!(W.min.x>j||j>W.max.x||W.min.y>Y||Y>W.max.y)&&(H=Fv(Nv(j,Y,e.canonical,W.footprintTileId.canonical),W.footprint),H))break;w.float32[D]=H?R+lt:R,d=d||H!==F}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];r.instancedDataArray.length<0||r.instancedDataArray.length===0||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,pS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];r.instancedDataArray.length!==0&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,r){const s=this.layers[0],h=s.layout.get("model-id").evaluate(r,{},this.canonical);if(!h)return ai(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),h;(m0(h,!1)||this.styleDefinedModelURLs[h]!==void 0)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new $x);const d=this.instancesPerModel[h],g=d.instancedDataArray,y=new Ox(r,g.length);for(const w of i)for(const k of w){if(k.x<0||k.x>=lt||k.y<0||k.y>=lt)continue;const A=(this.lookupDim-1)/lt,S=this.lookupDim*(k.y*A|0)+k.x*A|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;const E=g.length;g.resize(E+1),d.instancesEvaluatedElevation.push(0),g.float32[16*E]=k.x,g.float32[16*E+1]=k.y}return y.instancedDataCount=d.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(y),this.evaluate(y,{},d,!1)),h}getModelUris(){return this.modelUris}evaluate(e,i,r,s){const h=this.layers[0],d=e.feature,g=this.canonical,y=e.rotation=h.paint.get("model-rotation").evaluate(d,i,g),w=e.scale=h.paint.get("model-scale").evaluate(d,i,g),k=e.translation=h.paint.get("model-translation").evaluate(d,i,g),A=h.paint.get("model-color").evaluate(d,i,g);A.a=h.paint.get("model-color-mix-intensity").evaluate(d,i,g);const S=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),Wx(S,y,w);const E=Math.round(100*A.a)+A.b/1.05;for(let D=0;D<e.instancedDataCount;++D){const R=e.instancedDataOffset+D,F=16*R,j=r.instancedDataArray.float32;let Y=0;s&&(Y=j[F+6]-r.instancesEvaluatedElevation[R]);const H=0|j[F+1];j[F]=(0|j[F])+A.r/1.05,j[F+1]=H+A.g/1.05,j[F+2]=E,j[F+3]=1/(g.z>10?this.tileToMeter:ze(g,H)),j[F+4]=k[0],j[F+5]=k[1],j[F+6]=k[2]+Y,j[F+7]=S[0],j[F+8]=S[1],j[F+9]=S[2],j[F+10]=S[4],j[F+11]=S[5],j[F+12]=S[6],j[F+13]=S[8],j[F+14]=S[9],j[F+15]=S[10],r.instancesEvaluatedElevation[R]=k[2]}}}let jx,Vx;yt(f0,"ModelBucket",{omit:["layers"]}),yt($x,"PerModelAttributes"),yt(Ox,"ModelFeature");const Dc=64,sd={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Ux(n,e,i,r,s,h,d,g,y,w=!1){const k=i.zoom,A=i.project(r),S=Ge(r.lat,k),E=1/S;He(n),Ae(n,n,[A.x+d[0]*E,A.y+d[1]*E,d[2]]);let D=1,R=1;const F=i.worldSize;if(w){if(i.projection.name==="mercator"){let W=0;i.elevation&&(W=i.elevation.getAtPointOrZero(new fe(A.x/F,A.y/F),0));const J=Ia([],[A.x,A.y,W,1],i.projMatrix)[3]/i.cameraToCenterDistance;D=J,R=J*Ge(i.center.lat,k)}else if(i.projection.name==="globe"){const W=p0(n,i),J=[0,0,0,1];Ia(J,J,Ee([],i.projMatrix,W));const Z=J[3]/i.cameraToCenterDistance,ee=Xl(k),pe=i.projection.pixelsPerMeter(r.lat,F)*Ge(r.lat,k),ce=i.projection.pixelsPerMeter(i.center.lat,F)*Ge(i.center.lat,k);D=Z/Vt(pe,Fe(i.center.lat),ee),R=Z*S/pe,D*=ce,R*=ce}}else D=E;Oe(n,n,[D,D,R]);const j=[...n],Y=e.orientation,H=[];if(Wx(H,[Y[0]+s[0],Y[1]+s[1],Y[2]+s[2]],h),Ee(n,j,H),g&&i.elevation){let W=0;const J=[];if(y&&i.elevation){W=function(ee,pe,ce,me,we){const Le=pe.elevation;if(!Le)return 0;const Ze=Di.projectAabbCorners(ce,me),Ve=ue(1,we.lat)*pe.worldSize,Ye=function(et,Kt){const kt=[0,0,1],Pt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ut of Pt){const ni=et[Ut.corners[0]],ii=et[Ut.corners[1]],fi=et[Ut.corners[2]],li=[ii[0]-ni[0],ii[1]-ni[1],Kt*(ii[2]-ni[2])],gi=Un(li,li,[fi[0]-ni[0],fi[1]-ni[1],Kt*(fi[2]-ni[2])]);mn(gi,gi),Ut.dotProductWithUp=An(gi,kt)}return Pt.sort((Ut,ni)=>Ut.dotProductWithUp-ni.dotProductWithUp),Pt[0].corners}(Ze,Ve),Ke=Ze[Ye[0]],Be=Ze[Ye[1]],qe=Ze[Ye[2]],De=Ze[Ye[3]],Re=Le.getAtPointOrZero(new fe(Ke[0]/pe.worldSize,Ke[1]/pe.worldSize),0),tt=Le.getAtPointOrZero(new fe(Be[0]/pe.worldSize,Be[1]/pe.worldSize),0),nt=Le.getAtPointOrZero(new fe(qe[0]/pe.worldSize,qe[1]/pe.worldSize),0),Lt=Le.getAtPointOrZero(new fe(De[0]/pe.worldSize,De[1]/pe.worldSize),0),At=(Re+Lt)/2,ct=(tt+nt)/2;return At>ct?tt<nt?r_(ee,Be,De,Ke,tt,Lt,Re,Ve):r_(ee,qe,Ke,De,nt,Re,Lt,Ve):Re<Lt?r_(ee,Ke,Be,qe,Re,tt,nt,Ve):r_(ee,De,qe,Be,Lt,nt,tt,Ve),Math.max(At,ct)}(J,i,e.aabb,n,r);const Z=Ee([],oi([],J),H);Ee(n,j,Z)}else W=i.elevation.getAtPointOrZero(new fe(A.x/F,A.y/F),0);W!==0&&(n[14]+=W)}}function vm(n,e,i=!1){n.uploaded||(n.gfxTexture=new c0(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function fS(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,lS.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,dS.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,hS.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?uS:cS).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,mS.members,!0)),n.segments=In.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const r=n.material;r.pbrMetallicRoughness.baseColorTexture&&vm(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&vm(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&vm(r.normalTexture,e),r.occlusionTexture&&vm(r.occlusionTexture,e,i),r.emissionTexture&&vm(r.emissionTexture,e)}function g0(n,e,i){if(n.meshes)for(const r of n.meshes)fS(r,e,i);if(n.children)for(const r of n.children)g0(r,e,i)}function s_(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)s_(e)}function _0(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)_0(i)}class ld{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const s=r||e.findDEMTileFor(i);if(!s||!s.dem)return;const h=s.dem,d=s.tileID,g=1<<i.canonical.z-d.canonical.z;return new ld(s,h.dim/lt/g,[(i.canonical.x/g-d.canonical.x)*h.dim,(i.canonical.y/g-d.canonical.y)*h.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(r);return new st(s,h)}getElevationAt(e,i,r,s){const h=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],g=Math.floor(h),y=Math.floor(d),w=this._dem;return s=!!s,r?Vt(Vt(w.get(g,y,s),w.get(g,y+1,s),d-y),Vt(w.get(g+1,y,s),w.get(g+1,y+1,s),d-y),h-g):w.get(g,y,s)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ue(1,e)*this._dem.stride}}const y0=new Float32Array(262144),Ic=new Uint8Array(262144);function Jx(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,Jx(i));return e}function qx(n,e,i){if(n.meshes)for(const r of n.meshes){if(r.aabb.min[0]===1/0)continue;const s=Di.applyTransform(r.aabb,n.matrix);i.insert(e,s.min[0],s.min[1],s.max[0],s.max[1])}if(n.children)for(const r of n.children)qx(r,e,i)}const Gx=["","wall","door","roof","window","lamp","logo"];class Yx{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Jx(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&(r.transformedAabb=Di.applyTransformFast(r.aabb,this.node.matrix),i.encapsulate(r.transformedAabb)),e++;this.aabb=i}return this.aabb}}class l_{constructor(e,i,r,s,h,d,g,y){this.id=r,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=sd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=sd.HasMapboxMeshFeatures),h&&(this.modelTraits|=sd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.worldview=y,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const w of i)this.nodesInfo.push(new Yx(w)),qx(w,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const r of this.getNodesInfo()){const s=r.node;s.footprint&&i.push({footprint:s.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const r=i?this.stateDependentLayers:this.layers;if(!fo(e,this.states))for(const s of r)this.evaluate(s,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const r of i){const s=r.node;this.uploaded?this.updatePbrBuffer(s):g0(s,e,!0)}for(const r of i)s_(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),i=!0);return i}needsReEvaluation(e,i,r){const s=e.transform.projectionOptions,h=e.style.getBrightness(),d=this.brightness!==h;if(!this.uploaded||this.dirty||s.name!==this.projection.name||xm(r.paint.get("model-color").value,d)||xm(r.paint.get("model-color-mix-intensity").value,d)||xm(r.paint.get("model-roughness").value,d)||xm(r.paint.get("model-emissive-strength").value,d)||xm(r.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=s,this.brightness=h;const g=this.getNodesInfo();for(const y of g)y.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),s=this.id.canonical;for(const h of r){const d=h.feature;h.evaluatedTranslation=i.paint.get("model-translation").evaluate(d,{},s),h.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},s)}}evaluate(e,i){const r=this.getNodesInfo();for(const s of r){if(!s.node.meshes)continue;const h=s.feature,d=i&&i[h.id];if(fo(d,s.state))continue;s.state=structuredClone(d);const g=s.node.meshes&&s.node.meshes[0].featureData,y=s.evaluatedColor[2],w=s.evaluatedRMEA[2],k=this.id.canonical;if(s.hasTranslucentParts=!1,g){for(let A=0;A<Gx.length;A++){const S=Gx[A];S.length&&(h.properties.part=S);const E=e.paint.get("model-color").evaluate(h,d,k).toPremultipliedRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(h,d,k);s.evaluatedColor[A]=[E.r,E.g,E.b,D],s.evaluatedRMEA[A][0]=e.paint.get("model-roughness").evaluate(h,d,k),s.evaluatedRMEA[A][2]=e.paint.get("model-emissive-strength").evaluate(h,d,k),s.evaluatedRMEA[A][3]=E.a,s.emissionHeightBasedParams[A]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,d,k),!s.hasTranslucentParts&&E.a<1&&(s.hasTranslucentParts=!0)}delete h.properties.part,_S(s,y!==s.evaluatedColor[2]||w!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,d,k);s.evaluatedTranslation=e.paint.get("model-translation").evaluate(h,d,k),s.evaluatedScale=e.paint.get("model-scale").evaluate(h,d,k),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,r,s){const h=e.findDEMTileFor(r);if(h&&(h.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const d=ld.create(e,r,h);if(!d)return;this.modelTraits&sd.HasMapboxMeshFeatures&&this.updateDEM(e,d,r,s);for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const w=y.footprint.vertices;let k=d.getElevationAt(w[0].x,w[0].y,!0,!0);for(let A=1;A<w.length;A++)k=Math.min(k,d.getElevationAt(w[A].x,w[A].y,!0,!0));y.elevation=k}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,r,s){let h=i._dem._modifiedForSources[s];if(h===void 0&&(i._dem._modifiedForSources[s]=[],h=i._dem._modifiedForSources[s]),h.includes(r.canonical))return;const d=i._dem.dim;h.push(r.canonical);let g=!1;for(const y of this.getNodesInfo()){const w=y.node;if(!w.footprint||!w.footprint.grid)continue;const k=w.footprint.grid,A=i.tileCoordToPixel(k.min.x,k.min.y),S=i.tileCoordToPixel(k.max.x,k.max.y),E=Math.min(Math.min(d-S.y,A.x),Math.min(A.y,d-S.x));if(E<0)continue;const D=oe(E,2,5);let R=Math.max(0,A.x-D),F=Math.max(0,A.y-D),j=Math.min(S.x+D,d-1),Y=Math.min(S.y+D,d-1);for(let Z=F;Z<=Y;++Z)for(let ee=R;ee<=j;++ee)Ic[Z*d+ee]=255;let H=0,W=0;for(let Z=0;Z<k.cellsY;++Z)for(let ee=0;ee<k.cellsX;++ee){if(!k.cells[Z*k.cellsX+ee])continue;const pe=i.tileCoordToPixel(k.min.x+ee/k.xScale,k.min.y+Z/k.yScale),ce=i.tileCoordToPixel(k.min.x+(ee+1)/k.xScale,k.min.y+(Z+1)/k.yScale);for(let me=pe.y;me<=Math.min(ce.y+1,d-1);++me)for(let we=pe.x;we<=Math.min(ce.x+1,d-1);++we)Ic[me*d+we]===255&&(Ic[me*d+we]=0,H+=i.getElevationAtPixel(we,me),W++)}const J=H/W;R=Math.max(1,A.x-D),F=Math.max(1,A.y-D),j=Math.min(S.x+D,d-2),Y=Math.min(S.y+D,d-2),g=!0;for(let Z=F;Z<=Y;++Z)for(let ee=R;ee<=j;++ee)Ic[Z*d+ee]===0&&(y0[Z*d+ee]=i._dem.set(ee,Z,J));for(let Z=1;Z<D;++Z){R=Math.max(1,A.x-Z),F=Math.max(1,A.y-Z),j=Math.min(S.x+Z,d-2),Y=Math.min(S.y+Z,d-2);for(let ee=F;ee<=Y;++ee)for(let pe=R;pe<=j;++pe){const ce=ee*d+pe;if(Ic[ce]===255){let me=0,we=0,Le=-1,Ze=-1;for(let Ve=-1;Ve<=1;++Ve)for(let Ye=-1;Ye<=1;++Ye){const Ke=(ee+Ve)*d+pe+Ye;if(Ic[Ke]>=Z)continue;const Be=y0[Ke],qe=Math.abs(Be);qe>we&&(me=Be,we=qe,Le=Ye,Ze=Ve)}if(we>.1){const Ve=1-(Z+.5*Math.abs(Le*Ze))/D;let Ye=i._dem.get(pe,ee)+me*Ve;const Ke=i._dem.get(pe+Le,ee+Ze),Be=i._dem.get(pe-Le,ee-Ze,!0);(Ye-Ke)*(Ye-Be)>0&&(Ye=(Ke+Be)/2),y0[ce]=i._dem.set(pe,ee,Ye),Ic[ce]=Z}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Wr.now())}setFilter(e){this.filter=e?Mp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Yi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)s_(i.node),_0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(e.toUnwrapped());for(const s of this.getNodesInfo()){const h=s.node.footprint;s.hiddenByReplacement=!!h&&!r.find(d=>d.footprint===h)}}getHeightAtTileCoord(e,i){const r=[],s=[0,0,0],h=He([]);for(const d of this.getNodesInfo()){const g=d.node.meshes[0],y=g.transformedAabb;if(e<y.min[0]||i<y.min[1]||e>y.max[0]||i>y.max[1])continue;if(d.node.hidden===!0)return{height:1/0,maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};yi(h,d.node.matrix),s[0]=e,s[1]=i,fn(s,s,h);const w=(s[0]-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*Dc|0,k=Math.min(63,(s[1]-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*Dc|0)*Dc+Math.min(63,w),A=g.heightmap[k];if(!(A<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:A,maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new st(e,i),new st(e,i),r),r.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function xm(n,e){return n instanceof ac&&!n.isLightConstant&&e}function gS(n,e,i,r,s,h,d,g){let y=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,k=240&e|(240&e)>>4;i[3]>0&&(y=Vt(y,255*i[0],i[3]),w=Vt(w,255*i[1],i[3]),k=Vt(k,255*i[2],i[3]));const A=y<<8|w,S=k<<8|Math.floor(255*r[3]),E=function(Z){const ee=oe(Z,0,2);return Math.min(Math.round(.5*ee*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],D=oe(s[0],0,1),R=oe(s[1],0,1),F=oe(s[2],0,1),j=oe(s[3],0,1);let Y,H,W,J;if(D!==R&&d!==h&&R!==D){const Z=d-h;H=1/(Z*(R-D)),W=-(h+Z*D)/(Z*(R-D));const ee=oe(s[4],-1,1);J=Math.pow(10,ee),Y=255*F<<8|255*j}else Y=65535,H=0,W=1,J=1;if(n.emplaceBack(A,S,E,Y,H,W,J),g){const Z=g.length;g.clear();for(let ee=0;ee<Z;ee++)g.emplaceBack(A,S,E,Y,H,W,J)}}function _S(n,e,i){const r=n.node;let s=0;const h=i&sd.HasMeshoptCompression;for(const d of r.meshes){if(r.lights&&r.lightMeshIndex===s||!d.featureData)continue;d.featureArray=new gc,d.featureArray.reserve(d.featureData.length);let g=e;for(const y of d.featureData){const w=h?65535&y:y>>16&65535,k=h?y>>16&65535:65535&y,A=(15&k)<8?15&k:0,S=n.evaluatedRMEA[A],E=n.evaluatedColor[A],D=n.emissionHeightBasedParams[A];let R;if(g&&A===2&&r.lights&&(R=new gc,R.resize(10*r.lights.length)),gS(d.featureArray,w,E,S,D,d.aabb.min[2],d.aabb.max[2],R),R&&g){g=!1;const F=r.meshes[r.lightMeshIndex];F.featureArray=R,F.featureArray._trim()}}d.featureArray._trim(),s++}}function Hx(n,e,i,r){const s=1<<n.z;e.lat=xe((r/lt+n.y)/s),e.lng=he((i/lt+n.x)/s)}function yS(n,e,i,r){const s=n.getNodesInfo()[e];if(!s||s.hiddenByReplacement||!s.node.meshes)return;let h=Number.MAX_VALUE;const d=s.node,g=i.tile,y=r.calculatePosMatrix(g.tileID.toUnwrapped(),r.worldSize),w=s.evaluatedScale;let k=0;r.elevation&&d.elevation&&(k=d.elevation*r.elevation.exaggeration()),Ae(y,y,[(d.anchor?d.anchor[0]:0)*(w[0]-1),(d.anchor?d.anchor[1]:0)*(w[1]-1),k]),Oe(y,y,w);const A=i.queryGeometry,S=A.isPointQuery()?A.screenBounds:A.screenGeometry,E=function(R){const F=Ee([],y,R.matrix);Ee(F,r.expandedFarZProjMatrix,F);for(let j=0;j<R.meshes.length;++j){const Y=R.meshes[j];if(j===R.lightMeshIndex)continue;const H=Nx(S,r,F,Y.aabb);H!=null&&(h=Math.min(H,h))}if(R.children)for(const j of R.children)E(j)};if(E(d),h===Number.MAX_VALUE)return;const D=new q(0,0);return Hx(g.tileID.canonical,D,s.node.anchor[0],s.node.anchor[1]),{intersectionZ:h,position:D,feature:s.feature}}yt(l_,"Tiled3dModelBucket",{omit:["layers"]}),yt(Yx,"Tiled3dModelFeature");const wS={circle:class extends Pa{constructor(n,e,i,r){super(n,{layout:Gb||(Gb=new Cn({"circle-sort-key":new mt(ve.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Qe(ve.layout_circle["circle-elevation-reference"]),visibility:new Qe(ve.layout_circle.visibility)})),paint:Yb||(Yb=new Cn({"circle-radius":new mt(ve.paint_circle["circle-radius"]),"circle-color":new mt(ve.paint_circle["circle-color"]),"circle-blur":new mt(ve.paint_circle["circle-blur"]),"circle-opacity":new mt(ve.paint_circle["circle-opacity"]),"circle-translate":new Qe(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Qe(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qe(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qe(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mt(ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Qe(ve.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r)}createBucket(n){return new Mr(n)}queryRadius(n){const e=n;return Zh("circle-radius",this,e)+Zh("circle-stroke-width",this,e)+bg(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,r,s,h,d,g){const y=qb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return sv(n,r,h,d,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const r=ov(this);return{config:new Hl(this,{zoom:e,lut:i}),defines:r,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Pa{createBucket(n){return new uv(n)}constructor(n,e,i,r){super(n,{layout:cv||(cv=new Cn({visibility:new Qe(ve.layout_heatmap.visibility)})),paint:hv||(hv=new Cn({"heatmap-radius":new mt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qe(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gs(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qe(ve.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Zh("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,r,s,h,d,g){const y=this.paint.get("heatmap-radius").evaluate(e,i);return sv(n,r,h,d,g,!0,!0,new st(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Hl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Pa{constructor(n,e,i,r){super(n,{layout:dv||(dv=new Cn({visibility:new Qe(ve.layout_hillshade.visibility)})),paint:pv||(pv=new Cn({"hillshade-illumination-direction":new Qe(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qe(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qe(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qe(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qe(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qe(ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Qe(ve.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends Pa{constructor(n,e,i,r){super(n,{layout:Mv||(Mv=new Cn({"fill-sort-key":new mt(ve.layout_fill["fill-sort-key"]),visibility:new Qe(ve.layout_fill.visibility),"fill-elevation-reference":new Qe(ve.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new mt(ve.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Ev||(Ev=new Cn({"fill-antialias":new Qe(ve.paint_fill["fill-antialias"]),"fill-opacity":new mt(ve.paint_fill["fill-opacity"]),"fill-color":new mt(ve.paint_fill["fill-color"]),"fill-outline-color":new mt(ve.paint_fill["fill-outline-color"]),"fill-translate":new Qe(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Qe(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new mt(ve.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Qe(ve.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Qe(ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new mt(ve.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new mt(ve.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new mt(ve.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Hl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new E1(n)}queryRadius(){return bg(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,r,s,h){return!n.queryGeometry.isAboveHorizon&&Ur(Jb(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),r)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Pa{constructor(n,e,i,r){super(n,{layout:e2||(e2=new Cn({visibility:new Qe(ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Qe(ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:t2||(t2=new Cn({"fill-extrusion-opacity":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mt(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new mt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new mt(ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new mt(ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new mt(ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new mt(ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Qe(ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new zg(n)}queryRadius(){return bg(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,r,s,h,d,g,y){const w=qb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),S=[0,0],E=g&&h.elevation,D=h.elevation?h.elevation.exaggeration():1,R=n.tile.getBucket(this);if(E&&R instanceof zg){const W=R.centroidVertexArray,J=y+1;J<W.length&&(S[0]=W.geta_centroid_pos0(J),S[1]=W.geta_centroid_pos1(J))}if(S[0]===0&&S[1]===1)return!1;h.projection.name==="globe"&&(r=Qv([r],[new st(0,0),new st(lt,lt)],n.tileID.canonical).map(W=>W.polygon).flat());const F=E?g:null,[j,Y]=function(W,J,Z,ee,pe,ce,me,we,Le,Ze,Ve){return W.projection.name==="globe"?function(Ye,Ke,Be,qe,De,Re,tt,nt,Lt,At,ct){const et=[],Kt=[],kt=Ye.projection.upVectorScale(ct,Ye.center.lat,Ye.worldSize).metersToTile,Pt=[0,0,0,1],Ut=[0,0,0,1],ni=(fi,li,gi,Fi)=>{fi[0]=li,fi[1]=gi,fi[2]=Fi,fi[3]=1},ii=Xv();Be>0&&(Be+=ii),qe+=ii;for(const fi of Ke){const li=[],gi=[];for(const Fi of fi){const on=Fi.x+De.x,X=Fi.y+De.y,te=Ye.projection.projectTilePoint(on,X,ct),We=Ye.projection.upVector(ct,Fi.x,Fi.y);let rt=Be,ht=qe;if(tt){const ut=s2(on,X,Be,qe,tt,nt,Lt,At);rt+=ut.base,ht+=ut.top}Be!==0?ni(Pt,te.x+We[0]*kt*rt,te.y+We[1]*kt*rt,te.z+We[2]*kt*rt):ni(Pt,te.x,te.y,te.z),ni(Ut,te.x+We[0]*kt*ht,te.y+We[1]*kt*ht,te.z+We[2]*kt*ht),fn(Pt,Pt,Re),fn(Ut,Ut,Re),li.push(new Pc(Pt[0],Pt[1],Pt[2])),gi.push(new Pc(Ut[0],Ut[1],Ut[2]))}et.push(li),Kt.push(gi)}return[et,Kt]}(W,J,Z,ee,pe,ce,me,we,Le,Ze,Ve):me?function(Ye,Ke,Be,qe,De,Re,tt,nt,Lt){const At=[],ct=[],et=[0,0,0,1];for(const Kt of Ye){const kt=[],Pt=[];for(const Ut of Kt){const ni=Ut.x+qe.x,ii=Ut.y+qe.y,fi=s2(ni,ii,Ke,Be,Re,tt,nt,Lt);et[0]=ni,et[1]=ii,et[2]=fi.base,et[3]=1,Ia(et,et,De),et[3]=Math.max(et[3],1e-5);const li=new Pc(et[0]/et[3],et[1]/et[3],et[2]/et[3]);et[0]=ni,et[1]=ii,et[2]=fi.top,et[3]=1,Ia(et,et,De),et[3]=Math.max(et[3],1e-5);const gi=new Pc(et[0]/et[3],et[1]/et[3],et[2]/et[3]);kt.push(li),Pt.push(gi)}At.push(kt),ct.push(Pt)}return[At,ct]}(J,Z,ee,pe,ce,me,we,Le,Ze):function(Ye,Ke,Be,qe,De){const Re=[],tt=[],nt=De[8]*Ke,Lt=De[9]*Ke,At=De[10]*Ke,ct=De[11]*Ke,et=De[8]*Be,Kt=De[9]*Be,kt=De[10]*Be,Pt=De[11]*Be;for(const Ut of Ye){const ni=[],ii=[];for(const fi of Ut){const li=fi.x+qe.x,gi=fi.y+qe.y,Fi=De[0]*li+De[4]*gi+De[12],on=De[1]*li+De[5]*gi+De[13],X=De[2]*li+De[6]*gi+De[14],te=De[3]*li+De[7]*gi+De[15],We=Fi+nt,rt=on+Lt,ht=X+At,ut=Math.max(te+ct,1e-5),xt=Fi+et,$t=on+Kt,xi=X+kt,ki=Math.max(te+Pt,1e-5);ni.push(new Pc(We/ut,rt/ut,ht/ut)),ii.push(new Pc(xt/ki,$t/ki,xi/ki))}Re.push(ni),tt.push(ii)}return[Re,tt]}(J,Z,ee,pe,ce)}(h,r,A,k,w,d,F,S,D,h.center.lat,n.tileID.canonical),H=n.queryGeometry;return function(W,J,Z){let ee=1/0;Ur(Z,J)&&(ee=o2(Z,J[0]));for(let pe=0;pe<J.length;pe++){const ce=J[pe],me=W[pe];for(let we=0;we<ce.length-1;we++){const Le=ce[we],Ze=[Le,ce[we+1],me[we+1],me[we],Le];qa(Z,Ze)&&(ee=Math.min(ee,o2(Z,Ze)))}}return ee!==1/0&&ee}(j,Y,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},building:class extends Pa{constructor(n,e,i,r){super(n,{layout:w2||(w2=new Cn({visibility:new Qe(ve.layout_building.visibility),"building-roof-shape":new mt(ve.layout_building["building-roof-shape"]),"building-height":new mt(ve.layout_building["building-height"]),"building-base":new mt(ve.layout_building["building-base"])})),paint:b2||(b2=new Cn({"building-opacity":new Qe(ve.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Qe(ve.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Qe(ve.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Qe(ve.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Qe(ve.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Qe(ve.paint_building["building-vertical-scale"]),"building-cast-shadows":new Qe(ve.paint_building["building-cast-shadows"]),"building-color":new mt(ve.paint_building["building-color"]),"building-emissive-strength":new mt(ve.paint_building["building-emissive-strength"]),"building-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new y2(n)}},line:class extends Pa{constructor(n,e,i,r){const s=C2();super(n,s,e,i,r),s.layout&&(this.layout=new qs(s.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ku,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(cm)return cm;const i=C2();return cm=new g6(i.paint.properties["line-width"].specification),cm.useIntegerZoom=!0,cm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new j1(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const r=M2(this);return{config:new Hl(this,{zoom:e,lut:i}),defines:r,overrideFog:!1}}queryRadius(n){const e=n,i=D2(Zh("line-width",this,e),Zh("line-gap-width",this,e)),r=Zh("line-offset",this,e);return i/2+Math.abs(r)+bg(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,r,s,h){if(n.queryGeometry.isAboveHorizon)return!1;const d=Jb(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),g=n.pixelToTileUnitsFactor/2*D2(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(r=function(w,k){const A=[],S=new st(0,0);for(let E=0;E<w.length;E++){const D=w[E],R=[];for(let F=0;F<D.length;F++){const j=D[F],Y=D[F+1],H=F===0?S:j.sub(D[F-1])._unit()._perp(),W=F===D.length-1?S:Y.sub(j)._unit()._perp(),J=H._add(W)._unit();J._mult(1/(J.x*W.x+J.y*W.y)),R.push(J._mult(k)._add(j))}A.push(R)}return A}(r,y*n.pixelToTileUnitsFactor)),function(w,k,A){for(let S=0;S<k.length;S++){const E=k[S];if(w.length>=3){for(let D=0;D<E.length;D++)if(ao(w,E[D]))return!0}if(ds(w,E,A))return!0}return!1}(d,r,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:e_,background:class extends Pa{constructor(n,e,i,r){super(n,{layout:vx||(vx=new Cn({visibility:new Qe(ve.layout_background.visibility)})),paint:xx||(xx=new Cn({"background-pitch-alignment":new Qe(ve.paint_background["background-pitch-alignment"]),"background-color":new Qe(ve.paint_background["background-color"]),"background-pattern":new Qe(ve.paint_background["background-pattern"]),"background-opacity":new Qe(ve.paint_background["background-opacity"]),"background-emissive-strength":new Qe(ve.paint_background["background-emissive-strength"]),"background-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Px,"raster-particle":zx,sky:class extends Pa{constructor(n,e,i,r){super(n,{layout:Cx||(Cx=new Cn({visibility:new Qe(ve.layout_sky.visibility)})),paint:Dx||(Dx=new Cn({"sky-type":new Qe(ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new Qe(ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Qe(ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Qe(ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Qe(ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gs(ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Qe(ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Qe(ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Qe(ve.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),s=!r,h=n.style.light,d=h.properties.get("position");return s&&h.properties.get("anchor")==="viewport"&&ai("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?h0(d.azimuthal,90-d.polar,e):h0(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return h0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends Pa{constructor(n,e,i,r){super(n,{paint:Ix||(Ix=new Cn({}))},e,null)}},model:class extends Pa{constructor(n,e,i,r){super(n,{layout:jx||(jx=new Cn({visibility:new Qe(ve.layout_model.visibility),"model-id":new mt(ve.layout_model["model-id"])})),paint:Vx||(Vx=new Cn({"model-opacity":new mt(ve.paint_model["model-opacity"]),"model-rotation":new mt(ve.paint_model["model-rotation"]),"model-scale":new mt(ve.paint_model["model-scale"]),"model-translation":new mt(ve.paint_model["model-translation"]),"model-color":new mt(ve.paint_model["model-color"]),"model-color-mix-intensity":new mt(ve.paint_model["model-color-mix-intensity"]),"model-type":new Qe(ve.paint_model["model-type"]),"model-cast-shadows":new Qe(ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new Qe(ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Qe(ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new mt(ve.paint_model["model-emissive-strength"]),"model-roughness":new mt(ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new mt(ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Qe(ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Qe(ve.paint_model["model-front-cutoff"]),"model-color-use-theme":new mt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new f0(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof l_?lt-1:0}queryIntersectsFeature(n,e,i,r,s,h){if(!this.modelManager)return!1;const d=this.modelManager,g=n.tile.getBucket(this);if(!(g&&g instanceof f0))return!1;for(const y in g.instancesPerModel){const w=g.instancesPerModel[y],k=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(k)){const A=w.features[w.idToFeaturesIndex[k]],S=d.getModel(y,this.scope);if(!S)return!1;let E=St();const D=new q(0,0),R=g.canonical;let F=Number.MAX_VALUE;for(let j=0;j<A.instancedDataCount;++j){const Y=16*(A.instancedDataOffset+j),H=w.instancedDataArray.float32,W=[H[Y+4],H[Y+5],H[Y+6]];Hx(R,D,H[Y],0|H[Y+1]),Ux(E,S,h,D,A.rotation,A.scale,W,!1,!1,!1),h.projection.name==="globe"&&(E=p0(E,h));const J=Ee([],h.projMatrix,E),Z=n.queryGeometry,ee=Nx(Z.isPointQuery()?Z.screenBounds:Z.screenGeometry,h,J,S.aabb);ee!=null&&(F=Math.min(ee,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof rc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Pa{constructor(n,e,i,r){super(n,{layout:Cv||(Cv=new Cn({"clip-layer-types":new Qe(ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new Qe(ve.layout_clip["clip-layer-scope"])})),paint:Dv||(Dv=new Cn({}))},e,i,r)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new Iv(n)}is3D(n){return!0}}},w0=new Bi(0,0,0),b0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},v0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},u_={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},bS={PAINT_ORDER_FILL_AND_STROKE:1},km={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Zx={MASK_TYPE_LUMINANCE:1};function vS(n,e,i){n===1&&e.icons.push(function(r,s){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:d}=h;if(d.content_area){const{content_area:g}=d;g.top==null&&(g.top=g.left),g.width==null&&(g.width=h.usvg_tree.width),g.height==null&&(g.height=g.width)}return d.stretch_x&&d.stretch_x.length&&Kx(d,"x"),d.stretch_y&&d.stretch_y.length&&Kx(d,"y"),h}(r.readFields(xS,{name:void 0},s))}(i,i.readVarint()+i.pos))}function Kx(n,e){const i=[],r=n[`stretch_${e}`];let s=null;for(let h=0;h<r.length;h++)s===null?s=i.length===0?r[0]:i[i.length-1][1]+r[h]:(i.push([s,s+r[h]]),s=null);n[`stretch_${e}_areas`]=i}function xS(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(r,s){return r.readFields(kS,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},s)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(r,s){return r.readFields(TS,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},s)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function kS(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(r,s){return r.readFields(AS,{left:0},s)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(r,s){return r.readFields(SS,{name:void 0},s)}(i,i.readVarint()+i.pos))}function AS(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function SS(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=d_(i.readVarint()),e.value="rgb_color")}function TS(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(c_(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(r,s){return r.readFields(zS,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},s)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(r,s){return r.readFields(RS,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},s)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(r,s){return r.readFields(BS,{children:[]},s)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(r,s){const h=r.readFields(WS,{left:0,width:20,mask_type:Zx.MASK_TYPE_LUMINANCE,children:[]},s);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(i,i.readVarint()+i.pos))}function c_(n,e){return n.readFields(PS,{},e)}function PS(n,e,i){n===1?(e.group=function(r,s){return r.readFields(MS,{opacity:255,children:[]},s)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(r,s){return r.readFields(CS,{paint_order:1,commands:[],step:1,diffs:[],rule:b0.PATH_RULE_NON_ZERO},s)}(i,i.readVarint()+i.pos),e.node="path")}function MS(n,e,i){n===1?e.transform=h_(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(c_(i,i.readVarint()+i.pos))}function h_(n,e){return n.readFields(ES,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function ES(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function CS(n,e,i){n===1?e.fill=function(r,s){return r.readFields(DS,{rgb_color:w0,paint:"rgb_color",opacity:255},s)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(r,s){return r.readFields(IS,{rgb_color:w0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},s)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function DS(n,e,i){n===1?(e.rgb_color=d_(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function d_(n){return new Bi((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function IS(n,e,i){n===1?(e.rgb_color=d_(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function zS(n,e,i){n===1?e.transform=h_(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(Xx(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function Xx(n,e){return n.readFields(LS,{offset:0,opacity:255,rgb_color:w0},e)}function LS(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=d_(i.readVarint()))}function RS(n,e,i){n===1?e.transform=h_(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(Xx(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function BS(n,e,i){n===1?e.transform=h_(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(c_(i,i.readVarint()+i.pos))}function WS(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(c_(i,i.readVarint()+i.pos))}class NS{static calculate(e={},i=[]){const r=new Map,s=new Map;if(Object.keys(e).length===0)return r;i.forEach(h=>{s.set(h.name,h.rgb_color||new Bi(0,0,0))});for(const[h,d]of Object.entries(e))s.has(h)?r.set(s.get(h).toString(),d):console.warn(`Ignoring unknown image variable "${h}"`);return r}}function ud(n,e=255,i){const r=e/255,s=n.toString(),h=i.has(s)?i.get(s).clone():n.clone();return h.a*=r,h.toString()}function Am(n,e){if(!Xc()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function FS(n,e){const i=NS.calculate(e.params,n.metadata?n.metadata.variables:[]),r=n.usvg_tree,s=r.width,h=r.height,d=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(s*d.a)),y=Math.max(1,Math.round(h*d.d)),w=new DOMMatrix([g/s,0,0,y/h,0,0]),k=Am(g,y).getContext("2d");return x0(k,w,r,r,i),k.getImageData(0,0,g,y)}function x0(n,e,i,r,s){for(const h of r.children)Qx(n,e,i,h,s)}function Qx(n,e,i,r,s){r.group?(n.save(),function(h,d,g,y,w){const k=y.mask_idx!=null?g.masks[y.mask_idx]:null,A=y.clip_path_idx!=null?g.clip_paths[y.clip_path_idx]:null;if(y.transform&&(d=cd(y.transform).preMultiplySelf(d)),!function(D,R,F){return D.opacity!==255||R||F}(y,A!=null,k!=null))return void x0(h,d,g,y,w);const S=Am(h.canvas.width,h.canvas.height),E=S.getContext("2d");x0(E,d,g,y,w),A&&ok(E,d,g,A),k&&sk(E,d,g,k,w),h.globalAlpha=y.opacity/255,h.drawImage(S,0,0)}(n,e,i,r.group,s),n.restore()):r.path&&(n.save(),function(h,d,g,y,w){h.setTransform(d),y.paint_order===bS.PAINT_ORDER_FILL_AND_STROKE?(ek(h,g,y,w),ik(h,g,y,w)):(ik(h,g,y,w),ek(h,g,y,w))}(n,e,i,r.path,s),n.restore())}function ek(n,e,i,r){const s=i.fill;if(!s)return;const h=s.opacity/255;switch(n.save(),n.beginPath(),lk(i,n),s.paint){case"rgb_color":n.fillStyle=ud(s.rgb_color,s.opacity,r);break;case"linear_gradient_idx":{const d=e.linear_gradients[s.linear_gradient_idx];d.transform&&n.setTransform(cd(d.transform).preMultiplySelf(n.getTransform())),n.fillStyle=nk(n,d,h,r);break}case"radial_gradient_idx":{const d=e.radial_gradients[s.radial_gradient_idx];d.transform&&n.setTransform(cd(d.transform).preMultiplySelf(n.getTransform())),n.fillStyle=ak(n,d,h,r)}}n.fill(tk(i)),n.restore()}function tk(n){return n.rule===b0.PATH_RULE_NON_ZERO?"nonzero":n.rule===b0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function ik(n,e,i,r){const s=i.stroke;if(!s)return;const h=uk(i);n.lineWidth=s.width,n.miterLimit=s.miterlimit,n.setLineDash(s.dasharray),n.lineDashOffset=s.dashoffset;const d=s.opacity/255;switch(s.paint){case"rgb_color":n.strokeStyle=ud(s.rgb_color,s.opacity,r);break;case"linear_gradient_idx":n.strokeStyle=nk(n,e.linear_gradients[s.linear_gradient_idx],d,r,!0);break;case"radial_gradient_idx":n.strokeStyle=ak(n,e.radial_gradients[s.radial_gradient_idx],d,r,!0)}switch(s.linejoin){case u_.LINE_JOIN_MITER_CLIP:case u_.LINE_JOIN_MITER:n.lineJoin="miter";break;case u_.LINE_JOIN_ROUND:n.lineJoin="round";break;case u_.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(s.linecap){case v0.LINE_CAP_BUTT:n.lineCap="butt";break;case v0.LINE_CAP_ROUND:n.lineCap="round";break;case v0.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(h)}function nk(n,e,i,r,s=!1){if(e.stops.length===1){const S=e.stops[0];return ud(S.rgb_color,S.opacity*i,r)}const{x1:h,y1:d,x2:g,y2:y}=e;let w=new DOMPoint(h,d),k=new DOMPoint(g,y);if(s){const S=cd(e.transform);w=S.transformPoint(w),k=S.transformPoint(k)}const A=n.createLinearGradient(w.x,w.y,k.x,k.y);for(const S of e.stops)A.addColorStop(S.offset,ud(S.rgb_color,S.opacity*i,r));return A}function ak(n,e,i,r,s=!1){if(e.stops.length===1){const j=e.stops[0];return ud(j.rgb_color,j.opacity*i,r)}const h=cd(e.transform),{fx:d,fy:g,fr:y,cx:w,cy:k,r:A}=e;let S=new DOMPoint(d,g),E=new DOMPoint(w,k),D=y,R=A;if(s){S=h.transformPoint(S),E=h.transformPoint(E);const j=(h.a+h.d)/2;D=y*j,R=e.r*j}const F=n.createRadialGradient(S.x,S.y,D,E.x,E.y,R);for(const j of e.stops)F.addColorStop(j.offset,ud(j.rgb_color,j.opacity*i,r));return F}function rk(n,e,i,r){const s=r.transform?cd(r.transform).preMultiplySelf(e):e,h=Am(n.canvas.width,n.canvas.height),d=h.getContext("2d");for(const y of r.children)if(y.group)rk(d,s,i,y.group);else if(y.path){const w=y.path,k=new Path2D;k.addPath(uk(w),s),d.fill(k,tk(w))}const g=r.clip_path_idx!=null?i.clip_paths[r.clip_path_idx]:null;g&&ok(d,s,i,g),n.globalCompositeOperation="source-over",n.drawImage(h,0,0)}function ok(n,e,i,r){const s=Am(n.canvas.width,n.canvas.height);rk(s.getContext("2d"),e,i,r),n.globalCompositeOperation="destination-in",n.drawImage(s,0,0)}function sk(n,e,i,r,s){if(r.children.length===0)return;const h=r.mask_idx!=null?i.masks[r.mask_idx]:null;h&&sk(n,e,i,h,s);const d=n.canvas.width,g=n.canvas.height,y=Am(d,g),w=y.getContext("2d"),k=r.width,A=r.height,S=r.left,E=r.top,D=new Path2D,R=new Path2D;R.rect(S,E,k,A),D.addPath(R,e),w.clip(D);for(const Y of r.children)Qx(w,e,i,Y,s);const F=w.getImageData(0,0,d,g),j=F.data;if(r.mask_type===Zx.MASK_TYPE_LUMINANCE)for(let Y=0;Y<j.length;Y+=4)j[Y+3]=j[Y+3]/255*(.2126*j[Y]+.7152*j[Y+1]+.0722*j[Y+2]);w.putImageData(F,0,0),n.globalCompositeOperation="destination-in",n.drawImage(y,0,0)}function cd(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function lk(n,e){const i=n.step;let r=n.diffs[0]*i,s=n.diffs[1]*i;e.moveTo(r,s);for(let h=0,d=2;h<n.commands.length;h++)switch(n.commands[h]){case km.PATH_COMMAND_MOVE:r+=n.diffs[d++]*i,s+=n.diffs[d++]*i,e.moveTo(r,s);break;case km.PATH_COMMAND_LINE:r+=n.diffs[d++]*i,s+=n.diffs[d++]*i,e.lineTo(r,s);break;case km.PATH_COMMAND_QUAD:{const g=r+n.diffs[d++]*i,y=s+n.diffs[d++]*i;r=g+n.diffs[d++]*i,s=y+n.diffs[d++]*i,e.quadraticCurveTo(g,y,r,s);break}case km.PATH_COMMAND_CUBIC:{const g=r+n.diffs[d++]*i,y=s+n.diffs[d++]*i,w=g+n.diffs[d++]*i,k=y+n.diffs[d++]*i;r=w+n.diffs[d++]*i,s=k+n.diffs[d++]*i,e.bezierCurveTo(g,y,w,k,r,s);break}case km.PATH_COMMAND_CLOSE:e.closePath()}return e}function uk(n){return lk(n,new Path2D)}class p_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}yt(p_,"LRUCache");class k0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new wa(e,e.data)}getFromCache(e,i,r){return this.cacheMap.has(r)||this.cacheMap.set(r,new p_(150)),this.cacheMap.get(r).get(Ys(e.toString(),i))}setInCache(e,i,r,s){this.cacheDependenciesMap.has(s)||this.cacheDependenciesMap.set(s,new Map),this.cacheMap.has(s)||this.cacheMap.set(s,new p_(150));const h=this.cacheDependenciesMap.get(s),d=Ys(e.id.toString(),r);h.get(d)||h.set(d,new Set);const g=this.cacheMap.get(s),y=e.toString();h.get(d).add(y),g.put(Ys(e.toString(),r),i)}removeImagesFromCacheByIds(e,i,r=0){if(!this.cacheMap.has(r)||!this.cacheDependenciesMap.has(r))return;const s=this.cacheMap.get(r),h=this.cacheDependenciesMap.get(r);for(const d of e){const g=Ys(d.toString(),i);if(h.has(g)){for(const y of h.get(g))s.delete(y);h.delete(g)}}}rasterize(e,i,r,s,h=FS){const d=this.getFromCache(e,r,s);if(d)return d.clone();const g=h(i.icon,e.options),y=k0._getImage(g);return this.setInCache(e,y,r,s),y.clone()}}class ck{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function hk(n,e,i,r){let s=0,h=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(r[d])<1e-15){if(i[d]<n[d]||i[d]>e[d])return null}else{const g=1/r[d];let y=(n[d]-i[d])*g,w=(e[d]-i[d])*g;if(y>w){const k=y;y=w,w=k}if(y>s&&(s=y),w<h&&(h=w),s>h)return null}return s}function dk(n,e,i,r,s,h,d,g,y,w,k){const A=r-n,S=s-e,E=h-i,D=d-n,R=g-e,F=y-i,j=k[1]*F-k[2]*R,Y=k[2]*D-k[0]*F,H=k[0]*R-k[1]*D,W=A*j+S*Y+E*H;if(Math.abs(W)<1e-15)return null;const J=1/W,Z=w[0]-n,ee=w[1]-e,pe=w[2]-i,ce=(Z*j+ee*Y+pe*H)*J;if(ce<0||ce>1)return null;const me=ee*E-pe*S,we=pe*A-Z*E,Le=Z*S-ee*A,Ze=(k[0]*me+k[1]*we+k[2]*Le)*J;return Ze<0||ce+Ze>1?null:(D*me+R*we+F*Le)*J}function pk(n,e,i){return(n-e)/(i-e)}function mk(n,e,i,r,s,h,d,g,y){const w=1<<i,k=h-r,A=d-s,S=(n+1)/w*k+r,E=(e+0)/w*A+s,D=(e+1)/w*A+s;g[0]=(n+0)/w*k+r,g[1]=E,y[0]=S,y[1]=D}class fk{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(h){const d=Math.ceil(Math.log2(h.dim/8)),g=[];let y=Math.ceil(Math.pow(2,d));const w=1/y,k=(E,D,R,F,j)=>{const Y=F?1:0,H=(E+1)*R-Y,W=D*R,J=(D+1)*R-Y;j[0]=E*R,j[1]=W,j[2]=H,j[3]=J};let A=new ck(y);const S=[];for(let E=0;E<y*y;E++){k(E%y,Math.floor(E/y),w,!1,S);const D=au(S[0],S[1],h),R=au(S[2],S[1],h),F=au(S[2],S[3],h),j=au(S[0],S[3],h);A.minimums.push(Math.min(D,R,F,j)),A.maximums.push(Math.max(D,R,F,j)),A.leaves.push(1)}for(g.push(A),y/=2;y>=1;y/=2){const E=g[g.length-1];A=new ck(y);for(let D=0;D<y*y;D++){k(D%y,Math.floor(D/y),2,!0,S);const R=E.getElevation(S[0],S[1]),F=E.getElevation(S[2],S[1]),j=E.getElevation(S[2],S[3]),Y=E.getElevation(S[0],S[3]),H=E.isLeaf(S[0],S[1]),W=E.isLeaf(S[2],S[1]),J=E.isLeaf(S[2],S[3]),Z=E.isLeaf(S[0],S[3]),ee=Math.min(R.min,F.min,j.min,Y.min),pe=Math.max(R.max,F.max,j.max,Y.max),ce=H&&W&&J&&Z;A.maximums.push(pe),A.minimums.push(ee),A.leaves.push(pe-ee<=5&&ce?1:0)}g.push(A)}return g}(this.dem),r=i.length-1,s=i[r];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,s,h,d,g=1){return hk([e,i,-100],[r,s,this.maximums[0]*g],h,d)}raycast(e,i,r,s,h,d,g=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,i,r,s,h,d,g);if(y==null)return null;const w=[],k=[],A=[],S=[],E=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:D,t:R,nodex:F,nodey:j,depth:Y}=E.pop();if(this.leaves[D]){mk(F,j,Y,e,i,r,s,A,S);const W=1<<Y,J=(F+0)/W,Z=(F+1)/W,ee=(j+0)/W,pe=(j+1)/W,ce=au(J,ee,this.dem)*g,me=au(Z,ee,this.dem)*g,we=au(Z,pe,this.dem)*g,Le=au(J,pe,this.dem)*g,Ze=dk(A[0],A[1],ce,S[0],A[1],me,S[0],S[1],we,h,d),Ve=dk(S[0],S[1],we,A[0],S[1],Le,A[0],A[1],ce,h,d),Ye=Math.min(Ze!==null?Ze:Number.MAX_VALUE,Ve!==null?Ve:Number.MAX_VALUE);if(Ye!==Number.MAX_VALUE)return Ye;{const Ke=vn([],h,d,R);if(gk(ce,me,Le,we,pk(Ke[0],A[0],S[0]),pk(Ke[1],A[1],S[1]))>=Ke[2])return R}continue}let H=0;for(let W=0;W<this._siblingOffset.length;W++){mk((F<<1)+this._siblingOffset[W][0],(j<<1)+this._siblingOffset[W][1],Y+1,e,i,r,s,A,S),A[2]=-100,S[2]=this.maximums[this.childOffsets[D]+W]*g;const J=hk(A,S,h,d);if(J!=null){const Z=J;w[W]=Z;let ee=!1;for(let pe=0;pe<H&&!ee;pe++)Z>=w[k[pe]]&&(k.splice(pe,0,W),ee=!0);ee||(k[H]=W),H++}}for(let W=0;W<H;W++){const J=k[W];E.push({idx:this.childOffsets[D]+J,t:w[J],nodex:(F<<1)+this._siblingOffset[J][0],nodey:(j<<1)+this._siblingOffset[J][1],depth:Y+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,s,h){if(e[s].isLeaf(i,r)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const d=s-1,g=e[d];let y=0,w=0;for(let k=0;k<this._siblingOffset.length;k++){const A=2*i+this._siblingOffset[k][0],S=2*r+this._siblingOffset[k][1],E=g.getElevation(A,S),D=g.isLeaf(A,S),R=this._addNode(E.min,E.max,D);D&&(y|=1<<k),w||(w=R)}for(let k=0;k<this._siblingOffset.length;k++)y&1<<k||this._construct(e,2*i+this._siblingOffset[k][0],2*r+this._siblingOffset[k][1],d,w+k)}}function gk(n,e,i,r,s,h){return Vt(Vt(n,i,h),Vt(e,r,h),s)}function au(n,e,i){const r=i.dim,s=oe(n*r-.5,0,r-1),h=oe(e*r-.5,0,r-1),d=Math.floor(s),g=Math.floor(h),y=Math.min(d+1,r-1),w=Math.min(g+1,r-1);return gk(i.get(d,g),i.get(y,g),i.get(d,w),i.get(y,w),s-d,h-g)}const OS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function $S(n,e,i){return(256*n*256+256*e+i)/10-1e4}function jS(n,e,i){return 256*n+e+i/256-32768}class m_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,s=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return void ai(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=s,this._modifiedForSources={},!s){for(let y=0;y<h;y++)d[this._idx(-1,y)]=d[this._idx(0,y)],d[this._idx(h,y)]=d[this._idx(h-1,y)],d[this._idx(y,-1)]=d[this._idx(y,0)],d[this._idx(y,h)]=d[this._idx(y,h-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(h,-1)]=d[this._idx(h-1,0)],d[this._idx(-1,h)]=d[this._idx(0,h-1)],d[this._idx(h,h)]=d[this._idx(h-1,h-1)]}const g=r==="terrarium"?jS:$S;for(let y=0;y<d.length;++y){const w=4*y;this.floatView[y]=g(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Wr.now()}_buildQuadTree(){this._tree=new fk(this)}get(e,i,r=!1){r&&(e=oe(e,-1,this.dim),i=oe(i,-1,this.dim));const s=this._idx(e,i);return this.floatView[s]}set(e,i,r){const s=this._idx(e,i),h=this.floatView[s];return this.floatView[s]=r,r-h}static getUnpackVector(e){return OS[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const r=[0,0,0,0],s=m_.getUnpackVector(i);let h=Math.floor((e+s[3])/s[2]);return r[2]=h%256,h=Math.floor(h/256),r[1]=h%256,h=Math.floor(h/256),r[0]=h,r}getPixels(){return new gv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=i*this.dim,h=i*this.dim+this.dim,d=r*this.dim,g=r*this.dim+this.dim;switch(i){case-1:s=h-1;break;case 1:h=s+1}switch(r){case-1:d=g-1;break;case 1:g=d+1}const y=-i*this.dim,w=-r*this.dim;for(let k=d;k<g;k++)for(let A=s;A<h;A++){const S=4*this._idx(A,k),E=4*this._idx(A+y,k+w);this.pixels[S+0]=e.pixels[E+0],this.pixels[S+1]=e.pixels[E+1],this.pixels[S+2]=e.pixels[E+2],this.pixels[S+3]=e.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function VS(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(r,s){return r.readFields(YS,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},s)}(i,i.readVarint()+i.pos))}function US(n,e,i){n===1?(e.delta_filter=function(r,s){return r.readFields(JS,{blockSize:0},s)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function JS(n,e,i){n===1&&(e.blockSize=i.readVarint())}function qS(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function GS(n,e,i){let r=0,s=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(h,d){return h.readFields(US,{},d)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(h,d){return h.readFields(qS,{},d)}(i,i.readVarint()+i.pos):n===5?s=i.readFloat():n===6?r=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=s),e.scale===0&&(e.scale=r)}function YS(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(r,s){return r.readFields(GS,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},s)}(i,i.readVarint()+i.pos))}function HS(n,e,i){if(n===2)(function(r,s,h){r.readFields(ZS,h,s)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function ZS(n,e,i){if(n===1){let r=0;const s=i.readVarint()+i.pos;for(;i.pos<s;)e[r++]=i.readVarint()}}function KS(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let r=2;r>=1;r--){const s=r===1?1:0,h=r===2?1:0;for(let d=0;d<e[0];d++){const g=e[1]*d;for(let y=s;y<e[1];y++){const w=e[2]*(y+g);for(let k=h;k<e[2];k++){const A=e[3]*(k+w);for(let S=0;S<e[3];S++){const E=A+S;n[E]+=n[E-i]}}}}i*=e[r]}return n}function XS(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function QS(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const r=n[i],s=n[i+1];n[i]=(240&r)>>4|(61440&r)>>8|(240&s)<<4|61440&s,n[i+1]=15&r|(3840&r)>>4|(15&s)<<8|(3840&s)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const r=n[i],s=n[i+1],h=n[i+2],d=n[i+3];n[i+0]=(192&r)>>6|(192&s)>>4|(192&h)>>2|192&d,n[i+1]=(48&r)>>4|(48&s)>>2|48&h|(48&d)<<2,n[i+2]=(12&r)>>2|12&s|(12&h)<<2|(12&d)<<4,n[i+3]=3&r|(3&s)<<2|(3&h)<<4|(3&d)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}yt(m_,"DEMData"),yt(fk,"DemMinMaxQuadTree",{omit:["dem"]});var Jr=Uint8Array,Sm=Uint16Array,e7=Int32Array,_k=new Jr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yk=new Jr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),t7=new Jr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wk=function(n,e){for(var i=new Sm(31),r=0;r<31;++r)i[r]=e+=1<<n[r-1];var s=new e7(i[30]);for(r=1;r<30;++r)for(var h=i[r];h<i[r+1];++h)s[h]=h-i[r]<<5|r;return{b:i,r:s}},bk=wk(_k,2),vk=bk.b,i7=bk.r;vk[28]=258,i7[258]=28;for(var n7=wk(yk,0).b,xk=new Sm(32768),Qn=0;Qn<32768;++Qn){var hd=(43690&Qn)>>1|(21845&Qn)<<1;xk[Qn]=((65280&(hd=(61680&(hd=(52428&hd)>>2|(13107&hd)<<2))>>4|(3855&hd)<<4))>>8|(255&hd)<<8)>>1}var Tm=function(n,e,i){for(var r=n.length,s=0,h=new Sm(e);s<r;++s)n[s]&&++h[n[s]-1];var d,g=new Sm(e);for(s=1;s<e;++s)g[s]=g[s-1]+h[s-1]<<1;d=new Sm(1<<e);var y=15-e;for(s=0;s<r;++s)if(n[s])for(var w=s<<4|n[s],k=e-n[s],A=g[n[s]-1]++<<k,S=A|(1<<k)-1;A<=S;++A)d[xk[A]>>y]=w;return d},Pm=new Jr(288);for(Qn=0;Qn<144;++Qn)Pm[Qn]=8;for(Qn=144;Qn<256;++Qn)Pm[Qn]=9;for(Qn=256;Qn<280;++Qn)Pm[Qn]=7;for(Qn=280;Qn<288;++Qn)Pm[Qn]=8;var kk=new Jr(32);for(Qn=0;Qn<32;++Qn)kk[Qn]=5;var a7=Tm(Pm,9),r7=Tm(kk,5),A0=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Io=function(n,e,i){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(7&e)&i},S0=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},o7=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],zo=function(n,e,i){var r=new Error(e||o7[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,zo),!i)throw r;return r},s7=new Jr(0),l7=typeof TextDecoder<"u"&&new TextDecoder;try{l7.decode(s7,{stream:!0})}catch{}const u7={gzip_data:"gzip"};class ro extends Error{constructor(e){super(e),this.name="MRTError"}}const c7={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Ak={uint32:1,uint16:2,uint8:4},h7={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let T0;class f_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new ro(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),r=new DataView(e);if(i[0]!==13)throw new ro("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),r=this.getHeaderLength(e);if(i.length<r)throw new ro(`Expected header with length >= ${r} but got buffer of length ${i.length}`);const s=function(h,d){return h.readFields(VS,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new T0(i.subarray(0,r)));if(!isNaN(this.x)&&(this.x!==s.x||this.y!==s.y||this.z!==s.z))throw new ro(`Invalid attempt to parse header ${s.z}/${s.x}/${s.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=s.x,this.y=s.y,this.z=s.z;for(const h of s.layers)this.layers[h.name]=new Sk(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],r=this.getLayer(e.layerName);for(let s of e.blockIndices){const h=r.dataIndex[s],d=h.firstByte-e.firstByte,g=h.lastByte-e.firstByte;if(r._blocksInProgress.has(s))continue;const y={layerName:r.name,firstByte:d,lastByte:g,pixelFormat:r.pixelFormat,blockIndex:s,blockShape:[h.bands.length].concat(r.bandShape),buffer:r.buffer,codec:h.codec.codec,filters:h.filters.map(w=>w.filter)};r._blocksInProgress.add(s),i.push(y)}return new Tk(i,()=>{i.forEach(s=>r._blocksInProgress.delete(s.blockIndex))},(s,h)=>{if(i.forEach(d=>r._blocksInProgress.delete(d.blockIndex)),s)throw s;h.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class Sk{constructor({version:e,name:i,units:r,tileSize:s,pixelFormat:h,buffer:d,dataIndex:g},y){if(this.version=e,this.version!==1)throw new ro(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=r,this.tileSize=s,this.buffer=d,this.pixelFormat=c7[h],this.dataIndex=g,this.bandShape=[s+2*d,s+2*d,Ak[this.pixelFormat]],this._decodedBlocks=new p_(y?y.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Ak[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[r,s]of this.dataIndex.entries()){for(const[h,d]of s.bands.entries())if(d===e)return{bandIndex:i+h,blockIndex:r,blockBandIndex:h};i+=s.bands.length}break;case"number":for(const[r,s]of this.dataIndex.entries()){if(e>=i&&e<i+s.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-i};i+=s.bands.length}break;default:throw new ro(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,r=-1/0;const s=[],h=new Set;for(const d of e){const{blockIndex:g}=this.getBlockForBand(d);if(g<0)throw new ro(`Invalid band: ${JSON.stringify(d)}`);const y=this.dataIndex[g];s.includes(g)||s.push(g),h.add(g),i=Math.min(i,y.firstByte),r=Math.max(r,y.lastByte)}if(h.size>this.cacheSize)throw new ro(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:r,blockIndices:s}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:r}=this.getBlockForBand(e);if(i<0)throw new ro(`Band not found: ${JSON.stringify(e)}`);const s=this._decodedBlocks.get(i.toString());if(!s)throw new ro(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[i],d=this.bandShape.reduce((w,k)=>w*k,1),g=r*d,y=s.subarray(g,g+d);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}f_.setPbf=function(n){T0=n};class Tk{constructor(e,i,r){this.tasks=e,this._onCancel=i,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function zc(n,e){const i=n.json.bufferViews[e.bufferView],r=Bg[e.componentType];return new r(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==um[e.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:um[e.type]))}function P0(n,e,i,r){const s=Bg[e.componentType],h=function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(s),d=n.json.bufferViews[e.bufferView],g=d.byteStride?d.byteStride/s.BYTES_PER_ELEMENT:um[e.type],y=i.float32,w=y.length/i.capacity;for(let k=0,A=0;k<e.count*g;k+=g,A+=w)for(let S=0;S<w;S++)y[A+S]=r[k+S]*h;i._trim()}function d7(n,e,i){const r=n.indices,s=n.attributes,h={};h.indexArray=new fa;const d=e.json.accessors[r],g=d.count/3;h.indexArray.reserve(g);const y=zc(e,d);for(let S=0;S<g;S++)h.indexArray.emplaceBack(y[3*S],y[3*S+1],y[3*S+2]);h.indexArray._trim(),h.vertexArray=new to;const w=e.json.accessors[s.POSITION];h.vertexArray.reserve(w.count);const k=zc(e,w);for(let S=0;S<w.count;S++)h.vertexArray.emplaceBack(k[3*S],k[3*S+1],k[3*S+2]);if(h.vertexArray._trim(),h.aabb=new Di(w.min,w.max),h.centroid=function(S,E){const D=[0,0,0],R=S.length;if(R>0){for(let F=0;F<R;F++){const j=3*S[F];D[0]+=E[j],D[1]+=E[j+1],D[2]+=E[j+2]}D[0]/=R,D[1]/=R,D[2]/=R}return D}(y,k),s.COLOR_0!==void 0){const S=e.json.accessors[s.COLOR_0],E=um[S.type],D=zc(e,S);h.colorArray=E===3?new to:new ma,h.colorArray.resize(S.count),P0(e,S,h.colorArray,D)}if(s.NORMAL!==void 0){h.normalArray=new to;const S=e.json.accessors[s.NORMAL];h.normalArray.resize(S.count);const E=zc(e,S);P0(e,S,h.normalArray,E)}if(s.TEXCOORD_0!==void 0&&i.length>0){h.texcoordArray=new Hs;const S=e.json.accessors[s.TEXCOORD_0];h.texcoordArray.resize(S.count);const E=zc(e,S);P0(e,S,h.texcoordArray,E)}if(s._FEATURE_ID_RGBA4444!==void 0){const S=e.json.accessors[s._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=zc(e,S))}s._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(zc(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer));const A=n.material;return h.material=function(S,E){const{emissiveFactor:D=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:F=.5,normalTexture:j,occlusionTexture:Y,emissiveTexture:H,doubleSided:W}=S,{baseColorFactor:J=[1,1,1,1],metallicFactor:Z=1,roughnessFactor:ee=1,baseColorTexture:pe,metallicRoughnessTexture:ce}=S.pbrMetallicRoughness||{},me=Y?E[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&me){const we=Y.extensions.KHR_texture_transform;me.offsetScale=[we.offset[0],we.offset[1],we.scale[0],we.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Bi(...J),metallicFactor:Z,roughnessFactor:ee,baseColorTexture:pe?E[pe.index]:void 0,metallicRoughnessTexture:ce?E[ce.index]:void 0},doubleSided:W,emissiveFactor:new Bi(...D),alphaMode:R,alphaCutoff:F,normalTexture:j?E[j.index]:void 0,occlusionTexture:me,emissionTexture:H?E[H.index]:void 0,defined:S.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},i),h}function Pk(n,e,i){const{matrix:r,rotation:s,translation:h,scale:d,mesh:g,extras:y,children:w}=n,k={};if(k.matrix=r||function(A,S,E,D){var R=S[0],F=S[1],j=S[2],Y=S[3],H=R+R,W=F+F,J=j+j,Z=R*H,ee=R*W,pe=R*J,ce=F*W,me=F*J,we=j*J,Le=Y*H,Ze=Y*W,Ve=Y*J,Ye=D[0],Ke=D[1],Be=D[2];return A[0]=(1-(ce+we))*Ye,A[1]=(ee+Ve)*Ye,A[2]=(pe-Ze)*Ye,A[3]=0,A[4]=(ee-Ve)*Ke,A[5]=(1-(Z+we))*Ke,A[6]=(me+Le)*Ke,A[7]=0,A[8]=(pe+Ze)*Be,A[9]=(me-Le)*Be,A[10]=(1-(Z+ce))*Be,A[11]=0,A[12]=E[0],A[13]=E[1],A[14]=E[2],A[15]=1,A}([],s||[0,0,0,1],h||[0,0,0],d||[1,1,1]),g!==void 0){k.meshes=i[g];const A=k.anchor=[0,0];for(const S of k.meshes){const{min:E,max:D}=S.aabb;A[0]+=E[0]+D[0],A[1]+=E[1]+D[1]}A[0]=Math.floor(A[0]/k.meshes.length/2),A[1]=Math.floor(A[1]/k.meshes.length/2)}if(y&&(y.id&&(k.id=y.id),y.lights&&(k.lights=function(A){if(!A.length)return[];const S=function(j){const Y=atob(j),H=new Uint8Array(Y.length);for(let W=0;W<Y.length;W++)H[W]=Y.codePointAt(W);return H}(A),E=[],D=S.length/24,R=new Uint16Array(S.buffer),F=new Float32Array(S.buffer);for(let j=0;j<D;j++){const Y=R[2*j*6]/30,H=R[2*j*6+1]/30,W=R[2*j*6+10]/100,J=F[6*j+1],Z=F[6*j+2],ee=F[6*j+3],pe=F[6*j+4],ce=ee-J,me=pe-Z,we=Math.hypot(ce,me);E.push({pos:[J+.5*ce,Z+.5*me,H],normal:[me/we,-ce/we,0],width:we,height:Y,depth:W,points:[J,Z,ee,pe]})}return E}(y.lights))),w){const A=[];for(const S of w)A.push(Pk(e.json.nodes[S],e,i));k.children=A}return k}function p7(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new C1(n.vertices,n.indices,8,256),[i,r]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:r}}function m7(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const r=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const g=d[0],y=d[1];typeof g=="number"&&typeof y=="number"&&r.push(new st(g,y))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let s=0;for(let d=0;d<r.length;d++){const g=r[d],y=r[(d+1)%r.length],w=r[(d+2)%r.length];s+=(g.x-y.x)*(w.y-y.y)-(w.x-y.x)*(g.y-y.y)}s>0&&r.reverse();const h=Kp(r.flatMap(d=>[d.x,d.y]),[]);return h.length===0?null:{vertices:r,indices:h}}function f7(n,e){const i=[],r=[];let s=0;const h=[];for(const d of n){s=i.length;const g=d.vertexArray.float32,y=d.indexArray.uint16;for(let w=0;w<d.vertexArray.length;w++)h[0]=g[3*w+0],h[1]=g[3*w+1],h[2]=g[3*w+2],fn(h,h,e),i.push(new st(h[0],h[1]));for(let w=0;w<3*d.indexArray.length;w++)r.push(y[w]+s)}if(r.length%3!=0)return null;for(let d=0;d<r.length;d+=3){const g=i[r[d+0]],y=i[r[d+1]],w=i[r[d+2]];(g.x-y.x)*(w.y-y.y)-(w.x-y.x)*(g.y-y.y)>0&&([r[d+1],r[d+2]]=[r[d+2],r[d+1]])}return{vertices:i,indices:r}}function Mk(n){const e=function(y,w){const k=[],A=WebGL2RenderingContext;if(y.json.textures)for(const S of y.json.textures){const E={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};S.sampler!==void 0&&Object.assign(E,y.json.samplers[S.sampler]),k.push({image:w[S.source],sampler:E,uploaded:!1})}return k}(n,n.images),i=function(y,w){const k=[];for(const A of y.json.meshes){const S=[];for(const E of A.primitives)S.push(d7(E,y,w));k.push(S)}return k}(n,e),{scenes:r,scene:s,nodes:h}=n.json,d=r?r[s||0].nodes:h,g=[];for(const y of d)g.push(Pk(h[y],n,i));return function(y,w,k){const A={},S=new Set;for(let E=0;E<y.length;E++){const D=k[w[E]];if(!D.extras)continue;const R=D.extras["mapbox:footprint:version"],F=D.extras["mapbox:footprint:id"];(R||F)&&S.add(E),R==="1.0.0"&&F&&(A[F]=E)}for(let E=0;E<y.length;E++){if(S.has(E))continue;const D=y[E],R=k[w[E]];if(!R.extras)continue;let F=null;D.id in A&&(F=f7(y[A[D.id]].meshes,D.matrix)),F||(F=m7(R)),F&&(D.footprint=p7(F))}if(S.size>0){const E=Array.from(S.values()).sort((D,R)=>D-R);for(let D=E.length-1;D>=0;D--)y.splice(E[D],1)}}(g,d,n.json.nodes),g}function g7(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,r=n.aabb.min[1]-1,s=Dc/(n.aabb.max[0]-i+2),h=Dc/(n.aabb.max[1]-r+2);for(let d=0;d<e.length;d+=3){const g=e[d+2],y=(e[d+0]-i)*s|0,w=(e[d+1]-r)*h|0;g>n.heightmap[w*Dc+y]&&(n.heightmap[w*Dc+y]=g)}}function _7(n,e){const i={};i.indexArray=new fa,i.indexArray.reserve(4*n.length),i.vertexArray=new to,i.vertexArray.reserve(10*n.length),i.colorArray=new ma,i.vertexArray.reserve(10*n.length);let r=0;for(const d of n){const g=Math.min(10,Math.max(4,1.3*d.height))*e,y=[-d.normal[1],d.normal[0],0],w=Math.min(.29,.1*d.width/d.depth),k=d.width-2*d.depth*e*(w+.01),A=vn([],d.pos,y,k/2),S=vn([],d.pos,y,-k/2),E=[A[0],A[1],A[2]+d.height],D=[S[0],S[1],S[2]+d.height],R=vn([],d.normal,y,w);Ht(R,R,g);const F=vn([],d.normal,y,-w);Ht(F,F,g),wi(R,A,R),wi(F,S,F),A[2]+=.1,S[2]+=.1,i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]);const j=k/g/2;i.colorArray.emplaceBack(-j-w,-1,j,.8),i.colorArray.emplaceBack(j+w,-1,j,.8),i.colorArray.emplaceBack(-j,0,j,1.3),i.colorArray.emplaceBack(j,0,j,1.3),i.colorArray.emplaceBack(j+w,-.8,j,.7),i.colorArray.emplaceBack(j+w,-.8,j,.7),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(j+w,-1.2,j,.8),i.colorArray.emplaceBack(j+w,-1.2,j,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const s={defined:!0};s.emissiveFactor=Bi.black;const h={};return h.baseColorFactor=Bi.white,s.pbrMetallicRoughness=h,i.material=s,i.aabb=new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}f_.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(r=>{const{layerName:s,firstByte:h,lastByte:d,pixelFormat:g,blockShape:y,blockIndex:w,filters:k,codec:A}=r,S=i.subarray(h,d+1),E=new Uint32Array(y[0]*y[1]*y[2]);let D;if(A!=="gzip_data")throw new ro(`Unhandled codec: ${A}`);return D=function(R,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((W=function(ee){ee[0]==31&&ee[1]==139&&ee[2]==8||zo(6,"invalid gzip data");var pe=ee[3],ce=10;4&pe&&(ce+=2+(ee[10]|ee[11]<<8));for(var me=(pe>>3&1)+(pe>>4&1);me>0;me-=!ee[ce++]);return ce+(2&pe)}(H=R))+8>H.length&&zo(6,"invalid gzip data"),function(ee,pe,ce,me){var we=ee.length;if(!we||pe.f&&!pe.l)return ce||new Jr(0);var Le=!ce,Ze=Le||pe.i!=2,Ve=pe.i;Le&&(ce=new Jr(3*we));var Ye,Ke,Be=function(On){var dn=ce.length;if(On>dn){var tn=new Jr(Math.max(2*dn,On));tn.set(ce),ce=tn}},qe=pe.f||0,De=pe.p||0,Re=pe.b||0,tt=pe.l,nt=pe.d,Lt=pe.m,At=pe.n,ct=8*we;do{if(!tt){qe=Io(ee,De,1);var et=Io(ee,De+1,3);if(De+=3,!et){var Kt=ee[(X=4+((De+7)/8|0))-4]|ee[X-3]<<8,kt=X+Kt;if(kt>we){Ve&&zo(0);break}Ze&&Be(Re+Kt),ce.set(ee.subarray(X,kt),Re),pe.b=Re+=Kt,pe.p=De=8*kt,pe.f=qe;continue}if(et==1)tt=a7,nt=r7,Lt=9,At=5;else if(et==2){var Pt=Io(ee,De,31)+257,Ut=Io(ee,De+10,15)+4,ni=Pt+Io(ee,De+5,31)+1;De+=14;for(var ii=new Jr(ni),fi=new Jr(19),li=0;li<Ut;++li)fi[t7[li]]=Io(ee,De+3*li,7);De+=3*Ut;var gi=A0(fi),Fi=(1<<gi)-1,on=Tm(fi,gi);for(li=0;li<ni;){var X,te=on[Io(ee,De,Fi)];if(De+=15&te,(X=te>>4)<16)ii[li++]=X;else{var We=0,rt=0;for(X==16?(rt=3+Io(ee,De,3),De+=2,We=ii[li-1]):X==17?(rt=3+Io(ee,De,7),De+=3):X==18&&(rt=11+Io(ee,De,127),De+=7);rt--;)ii[li++]=We}}var ht=ii.subarray(0,Pt),ut=ii.subarray(Pt);Lt=A0(ht),At=A0(ut),tt=Tm(ht,Lt),nt=Tm(ut,At)}else zo(1);if(De>ct){Ve&&zo(0);break}}Ze&&Be(Re+131072);for(var xt=(1<<Lt)-1,$t=(1<<At)-1,xi=De;;xi=De){var ki=(We=tt[S0(ee,De)&xt])>>4;if((De+=15&We)>ct){Ve&&zo(0);break}if(We||zo(2),ki<256)ce[Re++]=ki;else{if(ki==256){xi=De,tt=null;break}var ui=ki-254;ki>264&&(ui=Io(ee,De,(1<<(Ai=_k[li=ki-257]))-1)+vk[li],De+=Ai);var Vi=nt[S0(ee,De)&$t],en=Vi>>4;if(Vi||zo(3),De+=15&Vi,ut=n7[en],en>3){var Ai=yk[en];ut+=S0(ee,De)&(1<<Ai)-1,De+=Ai}if(De>ct){Ve&&zo(0);break}Ze&&Be(Re+131072);var Pn=Re+ui;if(Re<ut){var sn=0-ut,Oi=Math.min(ut,Pn);for(sn+Re<0&&zo(3);Re<Oi;++Re)ce[Re]=(void 0)[sn+Re]}for(;Re<Pn;++Re)ce[Re]=ce[Re-ut]}}pe.l=tt,pe.p=xi,pe.b=Re,pe.f=qe,tt&&(qe=1,pe.m=Lt,pe.d=nt,pe.n=At)}while(!qe);return Re!=ce.length&&Le?(Ye=ce,((Ke=Re)==null||Ke>Ye.length)&&(Ke=Ye.length),new Jr(Ye.subarray(0,Ke))):ce.subarray(0,Re)}(H.subarray(W,-8),{i:2},new Jr(((j=H)[(Y=j.length)-4]|j[Y-3]<<8|j[Y-2]<<16|j[Y-1]<<24)>>>0))));var j,Y,H,W;const J=u7[F];if(!J)throw new Error(`Unhandled codec: ${F}`);const Z=new globalThis.DecompressionStream(J);return new Response(new Blob([R]).stream().pipeThrough(Z)).arrayBuffer().then(ee=>new Uint8Array(ee))}(S,A).then(R=>(function(F,j){F.readFields(HS,j)}(new T0(R),E),new h7[g](E.buffer))),D.then(R=>{for(let F=k.length-1;F>=0;F--)switch(k[F]){case"delta_filter":KS(R,y);break;case"zigzag_filter":XS(R);break;case"bitshuffle_filter":QS(R,g);break;default:throw new ro(`Unhandled filter "${k[F]}"`)}return{layerName:s,blockIndex:w,data:R}}).catch(R=>{throw R})}))},yt(Tk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),yt(f_,"MapboxRasterTile"),yt(Sk,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Ek{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const y7=["id","tile","layer","source","sourceLayer","state"];class dd{constructor(e,i,r,s,h){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=s,this.properties=e.properties,this.id=h}clone(){const e=new dd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of y7)this[i]!==void 0&&(e[i]=this[i]);return e}}class Ck{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ko(lt,16,0),this.featureIndexArray=new pg,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,r,s,h,d=0,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,s,h,d);const w=this.grid;for(let k=0;k<i.length;k++){const A=i[k],S=[1/0,1/0,-1/0,-1/0];for(let E=0;E<A.length;E++){const D=A[E];S[0]=Math.min(S[0],D.x),S[1]=Math.min(S[1],D.y),S[2]=Math.max(S[2],D.x),S[3]=Math.max(S[3],D.y)}g!==0&&(S[0]-=g,S[1]-=g,S[2]+=g,S[3]+=g),S[0]<lt&&S[1]<lt&&S[2]>=0&&S[3]>=0&&w.insert(y,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hi.VectorTile(new Ng(this.rawTileData)).layers,this.sourceLayerCoder=new Ek(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:r,transform:s,tileTransform:h,pixelPosMatrix:d,availableImages:g,worldview:y}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const w=r.bufferedTilespaceBounds,k=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(D,R,F,j)=>Kl(r.bufferedTilespaceGeometry,D,R,F,j));k.sort(w7);let A=null;s.elevation&&k.length>0&&(A=ld.create(s.elevation,this.tileID));const S={};let E;for(let D=0;D<k.length;D++){const R=k[D];if(R===E)continue;E=R;const F=this.featureIndexArray.get(R);let j=null;this.is3DTile?this.loadMatchingModelFeature(S,F,e,r,s,y):this.loadMatchingFeature(S,F,e,g,y,(Y,H,W,J=0)=>(j||(j=bt(Y,this.tileID.canonical,h)),H.queryIntersectsFeature(r,Y,W,j,this.z,s,d,A,J)))}return S}loadMatchingFeature(e,i,r,s,h,d){const{featureIndex:g,bucketIndex:y,sourceLayerIndex:w,layoutVertexArrayOffset:k}=i,A=this.bucketLayerIDs[y],S=r.layers,E=Object.keys(S);if(E.length&&!Xt(E,A))return;const D=r.sourceCache,R=this.sourceLayerCoder.decode(w),F=this.vtLayers[R].feature(g),j=this.getId(F,R);for(let Y=0;Y<A.length;Y++){const H=A[Y];if(!S[H])continue;const{styleLayer:W,targets:J}=S[H];let Z={};j!==void 0&&(Z=D.getFeatureState(W.sourceLayer,j));const ee=!d||d(F,W,Z,k);if(!ee)continue;const pe=new dd(F,this.z,this.x,this.y,j);pe.tile=this.tileID.canonical,pe.state=Z;let ce=this.serializedLayersCache.get(H);ce||(ce=W.serialize(),ce.id=H,this.serializedLayersCache.set(H,ce)),pe.source=ce.source,pe.sourceLayer=ce["source-layer"],pe.layer=Te({},ce),pe.layer.paint=Dk(ce.paint,W.paint,F,Z,s),pe.layer.layout=Dk(ce.layout,W.layout,F,Z,s);let me=!1;for(const we of J){this.updateFeatureProperties(pe,we);const{filter:Le}=we;if(Le){if(F.properties=pe.properties,Le.needGeometry){const Ze=ft(F,!0);if(!Le.filter(new Yi(this.tileID.overscaledZ,{worldview:h}),Ze,this.tileID.canonical))continue}else if(!Le.filter(new Yi(this.tileID.overscaledZ,{worldview:h}),F))continue}me=!0,we.targetId&&this.addFeatureVariant(pe,we)}me&&this.appendToResult(e,H,g,pe,ee)}}loadMatchingModelFeature(e,i,r,s,h,d){const{featureIndex:g,bucketIndex:y}=i,w=this.bucketLayerIDs[y],k=r.layers,A=Object.keys(k);if(!A.length||Xt(A,w))for(let S=0;S<w.length;S++){const E=w[S],{styleLayer:D,targets:R}=k[E];if(D.type!=="model")continue;const F=s.tile,j=F.getBucket(D);if(!(j&&j instanceof l_))continue;const Y=yS(j,g,s,h);if(!Y)continue;const{z:H,x:W,y:J}=F.tileID.canonical,{feature:Z,intersectionZ:ee,position:pe}=Y;let ce={};Z.id!==void 0&&(ce=r.sourceCache.getFeatureState(D.sourceLayer,Z.id));const me=new dd({},H,W,J,Z.id);me.tile=this.tileID.canonical,me.state=ce,me.properties=Z.properties,me.geometry={type:"Point",coordinates:[pe.lng,pe.lat]};let we=this.serializedLayersCache.get(E);we||(we=D.serialize(),we.id=E,this.serializedLayersCache.set(E,we)),me.source=we.source,me.sourceLayer=we["source-layer"],me.layer=Te({},we);let Le=!1;for(const Ze of R){this.updateFeatureProperties(me,Ze);const{filter:Ve}=Ze;if(Ve){if(Z.properties=me.properties,Ve.needGeometry){if(!Ve.filter(new Yi(this.tileID.overscaledZ,{worldview:d}),Z,this.tileID.canonical))continue}else if(!Ve.filter(new Yi(this.tileID.overscaledZ,{worldview:d}),Z))continue}Le=!0,Ze.targetId&&this.addFeatureVariant(me,Ze)}Le&&this.appendToResult(e,E,g,me,ee)}}updateFeatureProperties(e,i,r){if(i.properties){const s={};for(const h in i.properties){const d=i.properties[h].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,r);d!=null&&(s[h]=d)}e.properties=s}}addFeatureVariant(e,i,r){const s={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(s.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(s)}appendToResult(e,i,r,s,h){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:r,feature:s,intersectionZ:h})}lookupSymbolFeatures(e,i,r,s,h,d){const g={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(g,{bucketIndex:i,sourceLayerIndex:r,featureIndex:y,layoutVertexArrayOffset:0},s,h,d);return g}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const s=this.sourceLayerCoder.decode(r),h=this.vtFeatures[s];if(h[i])return h[i];const d=this.vtLayers[s].feature(i);return h[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const s=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(s!=null)if(Array.isArray(s)){if(!this.promoteIdExpression){const h=xo(s);if(h.result!=="success"){const d=h.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void ai(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new qu),r=this.promoteIdExpression.evaluate({zoom:0},e)}else r=e.properties[s];typeof r=="boolean"&&(r=Number(r))}return r}}function Dk(n,e,i,r,s){return Mt(n,(h,d)=>{const g=e instanceof qs?e.get(d):null;return g&&g.evaluate?g.evaluate(i,r,void 0,s):g})}function w7(n,e){return e-n}yt(Ck,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ik=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class M0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const s=r>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);const h=Ik[15&r];if(!h)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new M0(g,d,h,e)}constructor(e,i=64,r=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Ik.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-g%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${r}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+g+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return E0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:d,nodeSize:g}=this,y=[0,h.length-1,0],w=[];for(;y.length;){const k=y.pop()||0,A=y.pop()||0,S=y.pop()||0;if(A-S<=g){for(let F=S;F<=A;F++){const j=d[2*F],Y=d[2*F+1];j>=e&&j<=r&&Y>=i&&Y<=s&&w.push(h[F])}continue}const E=S+A>>1,D=d[2*E],R=d[2*E+1];D>=e&&D<=r&&R>=i&&R<=s&&w.push(h[E]),(k===0?e<=D:i<=R)&&(y.push(S),y.push(E-1),y.push(1-k)),(k===0?r>=D:s>=R)&&(y.push(E+1),y.push(A),y.push(1-k))}return w}within(e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:h,nodeSize:d}=this,g=[0,s.length-1,0],y=[],w=r*r;for(;g.length;){const k=g.pop()||0,A=g.pop()||0,S=g.pop()||0;if(A-S<=d){for(let F=S;F<=A;F++)Lk(h[2*F],h[2*F+1],e,i)<=w&&y.push(s[F]);continue}const E=S+A>>1,D=h[2*E],R=h[2*E+1];Lk(D,R,e,i)<=w&&y.push(s[E]),(k===0?e-r<=D:i-r<=R)&&(g.push(S),g.push(E-1),g.push(1-k)),(k===0?e+r>=D:i+r>=R)&&(g.push(E+1),g.push(A),g.push(1-k))}return y}}function E0(n,e,i,r,s,h){if(s-r<=i)return;const d=r+s>>1;zk(n,e,d,r,s,h),E0(n,e,i,r,d-1,1-h),E0(n,e,i,d+1,s,1-h)}function zk(n,e,i,r,s,h){for(;s>r;){if(s-r>600){const w=s-r+1,k=i-r+1,A=Math.log(w),S=.5*Math.exp(2*A/3),E=.5*Math.sqrt(A*S*(w-S)/w)*(k-w/2<0?-1:1);zk(n,e,i,Math.max(r,Math.floor(i-k*S/w+E)),Math.min(s,Math.floor(i+(w-k)*S/w+E)),h)}const d=e[2*i+h];let g=r,y=s;for(Mm(n,e,r,i),e[2*s+h]>d&&Mm(n,e,r,s);g<y;){for(Mm(n,e,g,y),g++,y--;e[2*g+h]<d;)g++;for(;e[2*y+h]>d;)y--}e[2*r+h]===d?Mm(n,e,r,y):(y++,Mm(n,e,y,s)),y<=i&&(r=y+1),i<=y&&(s=y-1)}}function Mm(n,e,i,r){C0(n,i,r),C0(e,2*i,2*r),C0(e,2*i+1,2*r+1)}function C0(n,e,i){const r=n[e];n[e]=n[i],n[i]=r}function Lk(n,e,i,r){const s=n-i,h=e-r;return s*s+h*h}o.$=ca,o.A=Is,o.B=bo,o.C=Ys,o.D=Qh,o.E=zs,o.F=2,o.G=mm,o.H=X2,o.I=er,o.J=Ko,o.K=class extends o_{},o.L=Rs,o.M=$r,o.N=ic,o.O=tc,o.P=st,o.Q=xp,o.R=Bu,o.S=Eh,o.T=c0,o.U=zh,o.V=o_,o.W=Gf,o.X=xo,o.Y=gh,o.Z=Il,o._=Dl,o.a=function(n){return pa.API_CDN_URL_REGEX.test(n)},o.a$=Ce,o.a0=Ls,o.a1=Lh,o.a2=nc,o.a3=vp,o.a4=function(n){const e=n.value;let i=[];if(!e)return i;const r=Ko(e);return r!=="string"?(i=i.concat([new o_(n.key,e,`string expected, "${r}" found`)]),i):(m0(e,!0)||(i=i.concat([new o_(n.key,e,`invalid url "${e}"`)])),i)},o.a5=ve,o.a6=Qf,o.a7=Cn,o.a8=Qe,o.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return _n(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Vt(n.x,e.x,i),y:Vt(n.y,e.y,i),z:Vt(n.z,e.z,i),azimuthal:Vt(n.azimuthal,e.azimuthal,i),polar:Vt(n.polar,e.polar,i)}}},o.aA=Ia,o.aB=_,o.aC=ao,o.aD=re,o.aE=Pe,o.aF=function(n,e){const i={};for(let r=0;r<e.length;r++){const s=e[r];s in n&&(i[s]=n[s])}return i},o.aG=Q,o.aH=ae,o.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,r){const s=this.entries[n]=this.entries[n]||{callbacks:[]};if(s.result){const[h,d]=s.result;return this.scheduler?this.scheduler.add(()=>{r(h,d)},e):r(h,d),()=>{}}return s.callbacks.push(r),s.cancel||(s.cancel=i((h,d)=>{s.result=[h,d];for(const g of s.callbacks)this.scheduler?this.scheduler.add(()=>{g(h,d)},e):g(h,d);setTimeout(()=>delete this.entries[n],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(h=>h!==r),s.callbacks.length||(s.cancel(),delete this.entries[n]))}}},o.aJ=function(n,e,i){const r=JSON.stringify(n.request);return n.data&&(this.deduped.entries[r]={result:[null,n.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},s=>{const h=Wu(n.request,(d,g,y,w)=>{d?s(d):g&&s(null,{vectorTile:i?void 0:new hi.VectorTile(new Ng(g)),rawData:g,cacheControl:y,expires:w})});return()=>{h.cancel(),s()}},e)},o.aK=function(n){Ud++,Ud>_o&&(n.getActor().send("enforceCacheSizeLimit",Nr),Ud=0)},o.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},o.aM=Na,o.aN=Px,o.aO=zx,o.aP=Tx,o.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<n.length;r++){const s=document.createElement("source");Iy(n[r])||(i.crossOrigin="Anonymous"),s.src=n[r],i.appendChild(s)}return{cancel:()=>{}}},o.aR=t_,o.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>_2(e,0,n))},o.aT=Mk,o.aU=class{constructor(n,e,i,r){this.id=n,this.position=e!=null?new q(e[0],e[1]):new q(0,0),this.orientation=i??[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(Ee(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const r=Di.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(r)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=He([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,r,s,h,d=!1){Ux(this.matrix,this,n.transform,this.position,e,i,r,s,h,d)}upload(n){if(!this.uploaded){for(const e of this.nodes)g0(e,n);for(const e of this.nodes)s_(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)_0(n)}},o.aV=Tt,o.aW=gm,o.aX=he,o.aY=xe,o.aZ=$l,o.a_=fa,o.aa=Yi,o.ab=rc,o.ac=fe,o.ad=fn,o.ae=Ki,o.af=ge,o.ag=qs,o.ah=Xl,o.ai=Vt,o.aj=lt,o.ak=ah,o.al=Ci,o.am=Bi,o.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,r]){const s=_n([1,i,r]);return{x:s.x,y:s.y,z:s.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Vt(n.x,e.x,i),y:Vt(n.y,e.y,i),z:Vt(n.z,e.z,i)}}},o.ao=function(n,e,i=0,r=!0){const s=new st(i,i),h=n.sub(s),d=e.add(s),g=[h,new st(d.x,h.y),d,new st(h.x,d.y)];return r&&g.push(h.clone()),g},o.ap=function(n,e){const i=[];for(let r=0;r<n.length;r++){const s=Se(r-1,-1,n.length-1),h=Se(r+1,-1,n.length-1),d=n[r],g=n[h],y=n[s].sub(d).unit(),w=g.sub(d).unit(),k=w.angleWithSep(y.x,y.y),A=y.add(w).unit().mult(-1*e/Math.sin(k/2));i.push(d.add(A))}return i},o.aq=dx,o.ar=Kl,o.as=function(n,e,i=0){return It(((e.x-i)*n.scale-n.x)*lt,(e.y*n.scale-n.y)*lt,ke(e.z,e.y))},o.at=Jn,o.au=mn,o.av=cn,o.aw=A2,o.ax=function(n){let e=1/0,i=1/0,r=-1/0,s=-1/0;for(const h of n)e=Math.min(e,h.x),i=Math.min(i,h.y),r=Math.max(r,h.x),s=Math.max(s,h.y);return{min:new st(e,i),max:new st(r,s)}},o.ay=oe,o.az=Ee,o.b=function(n){return pa.API_FONTS_REGEX.test(n)},o.b$=function(n,e,i){i*=.5;var r=e[0],s=e[1],h=e[2],d=e[3],g=Math.sin(i),y=Math.cos(i);return n[0]=r*y+s*g,n[1]=s*y-r*g,n[2]=h*y+d*g,n[3]=d*y-h*g,n},o.b0=jh,o.b1=Qg,o.b2=function(){To.isLoading()||To.isLoaded()||Nl()!=="deferred"||Xf()},o.b3=Mp,o.b4=ft,o.b5=dd,o.b6=Ii,o.b7=j1,o.b8=E1,o.b9=bt,o.bA=function(n,e){const{x:i,y:r}=n.point,s=nv(i,r,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Ee(s,s,w1(ms(e)))},o.bB=pt,o.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},o.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},o.bE=vn,o.bF=Un,o.bG=An,o.bH=pm,o.bI=fr,o.bJ=Z1,o.bK=function(n,e,i,r,s){const h=5*e+2;n.float32[h+0]=i,n.float32[h+1]=r,n.float32[h+2]=s},o.bL=Xg,o.bM=Lg,o.bN=qa,o.bO=ha,o.bP=zv,o.bQ=Fx,o.bR=Nv,o.bS=Fv,o.bT=H1,o.bU=rx,o.bV=e0,o.bW=M0,o.bX=Se,o.bY=Ht,o.bZ=$o,o.b_=jo,o.ba=Po,o.bb=fc,o.bc=Kb,o.bd=In,o.be=Kp,o.bf=s0,o.bg=function(n,e){const i=Xl(e.zoom);if(i===0)return ms(n);const r=kg(n),s=y1(r),h=re(r.getWest())*e.worldSize,d=re(r.getEast())*e.worldSize,g=ae(r.getNorth())*e.worldSize,y=ae(r.getSouth())*e.worldSize,w=[h,g,0],k=[d,g,0],A=[h,y,0],S=[d,y,0],E=yi([],e.globeMatrix);return fn(w,w,E),fn(k,k,E),fn(A,A,E),fn(S,S,E),s[0]=Ks(s[0],A,i),s[1]=Ks(s[1],S,i),s[2]=Ks(s[2],k,i),s[3]=Ks(s[3],w,i),Di.fromPoints(s)},o.bh=Sg,o.bi=yi,o.bj=Hp,o.bk=Ks,o.bl=cc,o.bm=u5,o.bn=ti,o.bo=Ae,o.bp=f_,o.bq=Ng,o.br=Wu,o.bs=function(n,e){const i=[];for(const r in n)r in e||i.push(r);return i},o.bt=ye,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=fo,o.bw=function(n){var e=new Ie(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},o.bx=He,o.by=Qt,o.bz=St,o.c=Hc,o.c$=Rg,o.c0=Vo,o.c1=En,o.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},o.c3=oi,o.c4=function(n,e,i,r,s){var h,d=1/Math.tan(e/2);return n[0]=d/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0?(n[10]=(s+r)*(h=1/(r-s)),n[14]=2*s*r*h):(n[10]=-1,n[14]=-2*r),n},o.c5=function(n,e,i,r,s,h,d){var g=1/(e-i),y=1/(r-s),w=1/(h-d);return n[0]=-2*g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+i)*g,n[13]=(s+r)*y,n[14]=(d+h)*w,n[15]=1,n},o.c6=ue,o.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},o.c8=qh,o.c9=wc,o.cA=a_,o.cB=Yt,o.cC=Lx,o.cD=function(n){const e=Lx(n,!0);return pt([],[e[0],e[1],e[4],e[5]])},o.cE=Oe,o.cF=Qi,o.cG=vt,o.cH=function(n){const{x:e,y:i}=n.point,{lng:r,lat:s}=n._center;return nv(e,i,n.worldSize,r,s)},o.cI=nn,o.cJ=Me,o.cK=Kh,o.cL=b,o.cM=function(n,e,i){let r=0;for(let s=0;s<2;++s)n[s]>0&&(r+=(n[s]-0)*(n[s]-0)),e[s]<0&&(r+=(0-e[s])*(0-e[s]));return r},o.cN=function(n){return n*n*n*n*n},o.cO=se,o.cP=45,o.cQ=Gh,o.cR=function(n,e,i){const r=Math.sqrt(n*n+e*e+i*i),s=r>0?Math.acos(i/r)*Mu:0;let h=n!==0||e!==0?Math.atan2(-e,-n)*Mu+90:0;return h<0&&(h+=360),[r,h,s]},o.cS=It,o.cT=_n,o.cU=ze,o.cV=wi,o.cW=Di,o.cX=Ui,o.cY=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},o.cZ=m0,o.c_=function(n,e){return n.readFields(vS,{icons:[]},e)},o.ca=$n,o.cb=io,o.cc=Gl,o.cd=q,o.ce=_x,o.cf=function(){var n=new Ie(4);return Ie!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},o.cg=function(n,e,i){var r=e[0],s=e[1],h=e[2],d=e[3],g=Math.sin(i),y=Math.cos(i);return n[0]=r*y+h*g,n[1]=s*y+d*g,n[2]=r*-g+h*y,n[3]=s*-g+d*y,n},o.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},o.ci=Br,o.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},o.ck=mo,o.cl=po,o.cm=Zb,o.cn=wn,o.co=Rx,o.cp=Ac,o.cq=ev,o.cr=function(n,e,i,r,s,h,d,g,y){if(y.name==="globe")return ev(n,e,new Ac(i,r,s),!1);const w=gm({z:i,x:r,y:s},y);return new Di([(h+w.x/w.scale)*e,e*(w.y/w.scale),d],[(h+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},o.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},o.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},o.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return V[e]},o.cv=Ne,o.cw=ks,o.cx=x,o.cy=function(n){const e=He(new Float64Array(16));Ee(e,n.pixelMatrix,n.globeMatrix);const i=[0,C,0],r=[0,z,0];return fn(i,i,e),fn(r,r,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!v1(n,new q(n.center.lat,90)),r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!v1(n,new q(n.center.lat,-90))]},o.cz=function(n,e){const{scale:i}=n.tileTransform,r=i*lt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(s,h,d){var g=h[1],y=h[2],w=h[3],k=d[0],A=d[1];return s[0]=h[0]*k,s[1]=g*k,s[2]=y*A,s[3]=w*A,s}(new Float32Array(4),e.inverseAdjustmentMatrix,[r,r])},o.d=function(n){return pa.API_TILEJSON_REGEX.test(n)},o.d$=$p,o.d0=ad,o.d1=X1,o.d2=Qc,o.d3=Js,o.d4=xr,o.d5=Fu,o.d6=Zt,o.d7=function(n){const e=n.indexOf(lc);return e>=0?n.slice(0,e):n},o.d8=function(n){return n.indexOf(lc)>=0},o.d9=function(n){const e=n.lastIndexOf(lc);return e>=0?n.slice(e+1):""},o.dA=iv,o.dB=ja,o.dC=Aa,o.dD=256,o.dE=function(n,e){const i=[0,0,0];return fn(i,i,Sg(ms(e.canonical))),fn(i,i,n),i},o.dF=n=>({u_matrix:new Gl(n),u_texsize:new io(n),u_pixels_to_tile_units:new bc(n),u_device_pixel_ratio:new $n(n),u_width_scale:new $n(n),u_floor_width_scale:new $n(n),u_image:new qh(n),u_units_to_pixels:new io(n),u_tile_units_to_pixels:new $n(n),u_alpha_discard_threshold:new $n(n),u_trim_offset:new io(n),u_trim_fade_range:new io(n),u_trim_color:new Gh(n),u_emissive_strength:new $n(n),u_zbias_factor:new $n(n),u_tile_to_meter:new $n(n),u_ground_shadow_factor:new wc(n),u_pattern_transition:new $n(n)}),o.dG=n=>({u_matrix:new Gl(n),u_pixels_to_tile_units:new bc(n),u_device_pixel_ratio:new $n(n),u_width_scale:new $n(n),u_floor_width_scale:new $n(n),u_units_to_pixels:new io(n),u_dash_image:new qh(n),u_gradient_image:new qh(n),u_image_height:new $n(n),u_texsize:new io(n),u_tile_units_to_pixels:new $n(n),u_alpha_discard_threshold:new $n(n),u_trim_offset:new io(n),u_trim_fade_range:new io(n),u_trim_color:new Gh(n),u_emissive_strength:new $n(n),u_zbias_factor:new $n(n),u_tile_to_meter:new $n(n),u_ground_shadow_factor:new wc(n)}),o.dH=n=>({u_camera_to_center_distance:new $n(n),u_extrude_scale:new bc(n),u_device_pixel_ratio:new $n(n),u_matrix:new Gl(n),u_inv_rot_matrix:new Gl(n),u_merc_center:new io(n),u_tile_id:new wc(n),u_zoom_transition:new $n(n),u_up_dir:new wc(n),u_emissive_strength:new $n(n)}),o.dI=Bp,o.dJ=S6,o.dK=ov,o.dL=(n,e,i,r,s,h)=>{const d=n.transform,g=d.projection.name==="globe";let y;if(h.paint.get("circle-pitch-alignment")==="map")if(g){const k=iv(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;y=Float32Array.from([k,0,0,k])}else y=d.calculatePixelsToTileUnitsMatrix(i);else y=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(d.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Wr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:m5,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(g){w.u_inv_rot_matrix=r,w.u_merc_center=s,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Xl(d.zoom);const k=s[0]*lt,A=s[1]*lt;w.u_up_dir=d.projection.upVector(new Ac(0,0,0),k,A)}return w},o.dM=M2,o.dN=Ua,o.dO=(n,e,i,r,s,h,d,g,y,w)=>{const k=n.transform,A=k.pitch<15?S2(.07,.7,oe((14-k.zoom)/5,0,1)):.07,S=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:P2(n,e,i,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_width_scale:h,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:T2(e,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(S?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:ze(e.tileID.canonical,0),u_ground_shadow_factor:y,u_pattern_transition:w}},o.dP=(n,e,i,r,s,h,d,g,y,w)=>{const k=n.transform,A=k.calculatePixelsToTileUnitsMatrix(e),S=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",E=k.pitch<15?S2(.07,.7,oe((14-k.zoom)/5,0,1)):.07;return{u_matrix:P2(n,e,i,r),u_pixels_to_tile_units:A,u_device_pixel_ratio:h,u_width_scale:d,u_floor_width_scale:g,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:E2(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:T2(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(S?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:E,u_tile_to_meter:ze(e.tileID.canonical,0),u_ground_shadow_factor:w}},o.dQ=ot,o.dR=Zp,o.dS=ke,o.dT=s5,o.dU=zg,o.dV=Xv,o.dW=eu,o.dX=450,o.dY=7,o.dZ=oS,o.d_=Ei,o.da=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.db=function(n,e,i,r){return n.type==="custom"?new sS(n,e):new wS[n.type](n,e,i,r)},o.dc=qt,o.dd=function(n){const e=n.indexOf(lc);return e>=0?n.slice(e+1):""},o.de=class extends dd{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},o.df=Ih,o.dg=yl,o.dh=function(n){return n({pluginStatus:Wa,pluginURL:So}),Ih.on("pluginStateChange",n),n},o.di=wg,o.dj=class extends Mo{constructor(n){super(n),this.current=Jp}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dk=G,o.dl=function(n,e,i){const r=Xl(i.zoom),s=n.style.map._antialias,h=n.terrain&&n.terrain.exaggeration()>0;return r===0&&!s&&!h},o.dm=function(n){const e=n.pixelsPerMeter,i=e/ue(1,n.center.lat),r=He(new Float64Array(16));return Ae(r,r,[n.point.x,n.point.y,0]),Oe(r,r,[i,i,e]),Float32Array.from(r)},o.dn=kg,o.dp=function(n){const e=Ne-5;n=oe(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ci(n))),3);return Math.round(i*(I.length-1))},o.dq=function(n,e,i,r){const s=e.getNorth(),h=e.getSouth(),d=e.getWest(),g=e.getEast(),y=1<<n.z,w=g-d,k=s-h,A=w/M,S=-k/I[i],E=[0,A,0,S,0,0,s,d,0];if(n.z>0){const D=180/r;zt(E,E,[D/w+1,0,0,0,D/k+1,0,-.5*D/A,.5*D/S,1])}return E[2]=y,E[5]=n.x,E[8]=n.y,E},o.dr=ms,o.ds=function(n,e,i){const r=He(new Float64Array(16)),s=(e/(1<<n)-.5)*Math.PI*2;return Ot(r,i.globeMatrix,s),Float32Array.from(r)},o.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,s=Math.floor(n.x),h=Math.floor((n.x-s)*r),d=Math.floor(n.y*r),g=this.findDEMTileFor(new Na(i,s,i,h,d));return!(!g||!g.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const r=this._source();if(!r||n.y<0||n.y>1)return e;const s=r.getSource().maxzoom,h=1<<s,d=Math.floor(n.x),g=n.x-d,y=new Na(s,d,s,Math.floor(g*h),Math.floor(n.y*h)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;const k=w.dem,A=1<<w.tileID.canonical.z,S=(g*A-w.tileID.canonical.x)*k.dim,E=(n.y*A-w.tileID.canonical.y)*k.dim,D=Math.floor(S),R=Math.floor(E);return(i?this.exaggeration():1)*Vt(Vt(k.get(D,R),k.get(D,R+1),E-R),Vt(k.get(D+1,R),k.get(D+1,R+1),E-R),S-D)}getAtTileOffset(n,e,i){const r=1<<n.canonical.z;return this.getAtPointOrZero(new fe(n.wrap+(n.canonical.x+e/lt)/r,(n.canonical.y+i/lt)/r))}getAtTileOffsetFunc(n,e,i,r){return s=>{const h=this.getAtTileOffset(n,s.x,s.y),d=r.upVector(n.canonical,s.x,s.y);return Ht(d,d,h*r.upVectorScale(n.canonical,e,i).metersToTile),d}}getForTilePoints(n,e,i,r){if(this.isUsingMockSource())return!1;const s=ld.create(this,n,r);return!!s&&(e.forEach(h=>{h[2]=this.exaggeration()*s.getElevationAt(h[0],h[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,s=1<<n.canonical.z-r.canonical.z;let h=n.canonical.x/s-r.canonical.x,d=n.canonical.y/s-r.canonical.y,g=0;for(let y=0;y<n.canonical.z-r.canonical.z&&!i.leaves[g];y++){h*=2,d*=2;const w=2*Math.floor(d)+Math.floor(h);g=i.childOffsets[g]+w,h%=1,d%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const s of n){const h=this.getMinMaxForTile(s.tileID);h&&(i=Math.min(i,h.min),r=Math.max(r,h.max),e=!0)}return e?{min:i,max:r}:null}},o.du=gv,o.dv=xg,o.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},o.dx=dt,o.dy=function(n,e){var i=Math.sin(e),r=Math.cos(e);return n[0]=r,n[1]=i,n[2]=0,n[3]=-i,n[4]=r,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.dz=ul,o.e=pa,o.e$=Ek,o.e0=256,o.e1=w1,o.e2=to,o.e3=Ot,o.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},o.e5=cs,o.e6=mc,o.e7=jf,o.e8=function(n,e,i,r,s){return oe((n-e)/(i-e)*(s-r)+r,r,s)},o.e9=Uo,o.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},o.eB=cl,o.eC=N,o.eD=Rr,o.eE=function(n,e,i,r){return n[0]=e,n[1]=i,n[2]=r,n},o.eF=function([n,e,i]){const r=Math.hypot(n,e,i),s=Math.atan2(n,i),h=.5*Math.PI-Math.acos(-e/r);return new q(Me(s),Me(h))},o.eG=Tu,o.eH=d0,o.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(Nn==null){const r=i.navigator?i.navigator.userAgent:null;Nn=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Nn}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eJ=function(n,e){Nr=n,_o=e},o.eK=v1,o.eL=av,o.eM=function(n){const e=[0,0,0],i=He(new Float64Array(16));return Ee(i,n.pixelMatrix,n.globeMatrix),fn(e,e,i),new st(e[0],e[1])},o.eN=function(){const n=sm;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(B1),sm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.eO=function(){Rg().acquire(B1)},o.eP=Nl,o.eQ=function(n,e,i=!1){if(Wa===ir.deferred||Wa===ir.loading||Wa===ir.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");So=Wr.resolveURL(n),Wa=ir.deferred,Pp=e,Dh(),i||Xf()},o.eR=function(n){ed=Wr.resolveURL(n),td||(td=new Qh(Rg(),new zs)),td.broadcast("setMeshoptUrl",ed)},o.eS=h2,o.eT=function(n){N1=Wr.resolveURL(n),td||(td=new Qh(Rg(),new zs)),td.broadcast("setDracoUrl",N1)},o.eU=c2,o.eV=om,o.eW=function(n){const e=Ms();if(!e)return;const i=e.delete(go);n&&i.then(()=>n()).catch(n)},o.eX=Mc,o.eY=yt,o.eZ=Ql,o.e_=Do,o.ea=function(n,e){var i=e[0],r=e[1],s=e[2],h=e[3],d=e[4],g=e[5],y=e[6],w=e[7],k=e[8],A=k*d-g*w,S=-k*h+g*y,E=w*h-d*y,D=i*A+r*S+s*E;return D?(n[0]=A*(D=1/D),n[1]=(-k*r+s*w)*D,n[2]=(g*r-s*d)*D,n[3]=S*D,n[4]=(k*i-s*y)*D,n[5]=(-g*i+s*h)*D,n[6]=E*D,n[7]=(-w*i+r*y)*D,n[8]=(d*i-r*h)*D,n):null},o.eb=Za,o.ec=Ge,o.ed=p0,o.ee=function(n,e){if(n===e){var i=e[1],r=e[2],s=e[3],h=e[6],d=e[7],g=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=h,n[11]=e[14],n[12]=s,n[13]=d,n[14]=g}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},o.ef=ci,o.eg=[1,1,1],o.eh=class{constructor(n,e,i,r){this.context=n,this.format=r,this.size=i,this.texture=n.gl.createTexture();const[s,h,d]=this.size,{gl:g}=n;g.bindTexture(g.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,s,h,d,0,l0(this.format),u0(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_3D,this.texture),n!==this.minFilter&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},o.ei=ld,o.ej=function(n,e,i,r){var s=new Ie(4);return s[0]=n,s[1]=e,s[2]=i,s[3]=r,s},o.ek=Da,o.el=function(n,e,i,r){var s=e[0],h=e[1],d=e[2],g=e[3];return n[0]=s+r*(i[0]-s),n[1]=h+r*(i[1]-h),n[2]=d+r*(i[2]-d),n[3]=g+r*(i[3]-g),n},o.em=sd,o.en=us,o.eo=Hs,o.ep=function(n,e,i,r,s,h,d,g,y,w,k,A,S,E,D,R){var F=new Ie(16);return F[0]=n,F[1]=e,F[2]=i,F[3]=r,F[4]=s,F[5]=h,F[6]=d,F[7]=g,F[8]=y,F[9]=w,F[10]=k,F[11]=A,F[12]=S,F[13]=E,F[14]=D,F[15]=R,F},o.eq=$,o.er=Oh,o.es=Fp,o.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new st(1/0,1/0),max:new st(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=Rv(new st(0,0),new st(lt,lt),n),r=[];if(e&&!D1(i,this._globalClipBounds))return r;for(const s of this._activeRegions){if(s.hiddenByOverlap||!D1(i,s))continue;const h=j5(s.min,s.max,n);r.push({min:h.min,max:h.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId,order:s.order,clipMask:s.clipMask,clipScope:s.clipScope})}return r}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const r of e.cache.getVisibleCoordinates()){const s=e.cache.getTile(r).buckets[e.layer];s&&s.updateFootprints(r.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),r=n.getClipMask(),s=n.getClipScope();for(const h of e){if(!h.footprint)continue;const d=Rv(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:i,clipMask:r,clipScope:s})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Dg(e.min,i.min)||Dg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(r,s){const h=(d,g)=>d+g;return r.length-s.length||r.reduce(h,"").localeCompare(s.reduce(h,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],r=this._prevRegions[e];n=i.priority!==r.priority||!Lv(i,r)||i.order!==r.order||i.clipMask!==r.clipMask||!fo(i.clipScope,r.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==Cg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const r=this._activeRegions;if(i>=r.length)return i;const s=r[i].priority;for(;i<r.length&&r[i].priority===s;)++i;return i};if(this._sourceIds.length>1){let i=0,r=e(i);for(;i!==r;){let s=i;const h=i;for(;s!==r;){const d=this._activeRegions[s];d.hiddenByOverlap=!1;for(let g=0;g<h;g++){const y=this._activeRegions[g];if(!y.hiddenByOverlap&&d.order===Cg&&D1(d,y)&&(d.hiddenByOverlap=Wv(d.footprint,d.tileId,y.footprint,y.tileId),d.hiddenByOverlap))break}++s}i=r,r=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},o.eu=Cg,o.ev=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Po,r=new fa,s=[],h=n+1+2,d=e[0]+1,g=e[0]+1+(1+e.length),y=(w,k,A)=>{let S=w===h-1?w-2:w===0?w:w-1;return S+=A?24575:0,[S,k]};for(let w=0;w<h;++w)i.emplaceBack(...y(w,0,!0));for(let w=0;w<d;++w)for(let k=0;k<h;++k)i.emplaceBack(...y(k,w,(k===0||k===h-1)&&!0));for(let w=0;w<e.length;++w){const k=e[w];for(let A=0;A<h;++A)i.emplaceBack(...y(A,k,!0))}for(let w=0;w<e.length;++w){const k=r.length,A=e[w]+1+2,S=new fa;for(let R=0;R<A-1;R++){const F=R===A-2,j=F?h*(g-e.length+w-R):h;for(let Y=0;Y<h-1;Y++){const H=R*h+Y;R===0||F||Y===0||Y===h-2?(S.emplaceBack(H+1,H,H+j),S.emplaceBack(H+j,H+j+1,H+1)):(r.emplaceBack(H+1,H,H+j),r.emplaceBack(H+j,H+j+1,H+1))}}const E=In.simpleSegment(0,k,i.length,r.length-k);for(let R=0;R<S.uint16.length;R+=3)r.emplaceBack(S.uint16[R],S.uint16[R+1],S.uint16[R+2]);const D=In.simpleSegment(0,k,i.length,r.length-k);s.push({withoutSkirts:E,withSkirts:D})}return{vertices:i,indices:r,segments:s}}_createGrid(n){const e=this._fillGridMeshWithLods(M,I);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Kb.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new fa;for(let d=0;d<=M;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new cs,r=new cs,s=new cs,h=new cs;this._poleSegments=[];for(let d=0,g=0;d<b;d++){const y=360/(1<<d);i.emplaceBack(0,-_,0,.5,0),r.emplaceBack(0,-_,0,.5,1),s.emplaceBack(0,-_,0,.5,.5),h.emplaceBack(0,-_,0,.5,.5);for(let w=0;w<=M;w++){let k=w/M,A=0;const S=Vt(0,y,k),[E,D,R]=O(d5,p5,S,_);i.emplaceBack(E,D,R,k,A),r.emplaceBack(E,D,R,k,1-A);const F=Ci(S);k=.5+.5*Math.sin(F),A=.5+.5*Math.cos(F),s.emplaceBack(E,D,R,k,A),h.emplaceBack(E,D,R,k,1-A)}this._poleSegments.push(In.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,vg,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(r,vg,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(s,vg,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(h,vg,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},o.ew=ie,o.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.ey=de,o.ez=be,o.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},o.f0=Ck,o.f1=v2,o.f2=vi,o.f3="hd_road_elevation",o.f4=mr,o.f5=Mt,o.f6=Tc,o.f7=K1,o.f8=Ec,o.f9=function(n,e,i,r,s,h,d,g=1,y,w,k){n.createArrays(),n.tilePixelRatio=lt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,S=n.layers[0]._unevaluatedLayout._values,E={};E.scaleFactor=g,E.textSizeScaleRange=A.get("text-size-scale-range"),E.iconSizeScaleRange=A.get("icon-size-scale-range");const[D,R]=E.textSizeScaleRange,[F,j]=E.iconSizeScaleRange;E.textScaleFactor=oe(E.scaleFactor,D,R),E.iconScaleFactor=oe(E.scaleFactor,F,j);const Y=S["text-size"],H=S["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ce,maxZoom:me}=n.textSizeData;E.compositeTextSizes=[Y.possiblyEvaluate(new Yi(ce,{worldview:k}),h),Y.possiblyEvaluate(new Yi(me,{worldview:k}),h)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ce,maxZoom:me}=n.iconSizeData;E.compositeIconSizes=[H.possiblyEvaluate(new Yi(ce,{worldview:k}),h),H.possiblyEvaluate(new Yi(me,{worldview:k}),h)]}E.layoutTextSize=Y.possiblyEvaluate(new Yi(d+1,{worldview:k}),h),E.layoutIconSize=H.possiblyEvaluate(new Yi(d+1,{worldview:k}),h),E.textMaxSize=Y.possiblyEvaluate(new Yi(18,{worldview:k}),h);const W=A.get("symbol-placement"),J=A.get("text-rotation-alignment")==="map"&&W!=="point",Z=A.get("text-size");let ee=!1;const pe=[];for(const ce of n.features){const me=A.get("text-font").evaluate(ce,{},h).join(","),we=Z.evaluate(ce,{},h)*E.textScaleFactor,Le=E.layoutTextSize.evaluate(ce,{},h)*E.textScaleFactor,Ze=E.layoutIconSize.evaluate(ce,{},h)*E.iconScaleFactor,Ve={horizontal:{},vertical:void 0},Ye=ce.text;let Ke,Be=[0,0];if(Ye){const Ut=Ye.toString(),ni=A.get("text-letter-spacing").evaluate(ce,{},h)*ha,ii=A.get("text-line-height").evaluate(ce,{},h)*ha,fi=a1(Ut)?ni:0,li=A.get("text-anchor").evaluate(ce,{},h),gi=A.get("text-variable-anchor");if(!gi){const We=A.get("text-radial-offset").evaluate(ce,{},h);if(We)Be=rx(li,[We*ha,Q1]);else{const rt=A.get("text-offset").evaluate(ce,{},h);Be=[rt[0]*ha,rt[1]*ha]}}let Fi=J?"center":A.get("text-justify").evaluate(ce,{},h);const on=W==="point",X=on?A.get("text-max-width").evaluate(ce,{},h)*ha:1/0,te=We=>{n.allowVerticalPlacement&&oc(Ut)&&(Ve.vertical=Y1(Ye,e,i,s,me,X,ii,li,We,fi,Be,fr.vertical,!0,Le,we,y))};if(!J&&gi){const We=Fi==="auto"?gi.map(ht=>e0(ht)):[Fi];let rt=!1;for(let ht=0;ht<We.length;ht++){const ut=We[ht];if(!Ve.horizontal[ut])if(rt)Ve.horizontal[ut]=Ve.horizontal[0];else{const xt=Y1(Ye,e,i,s,me,X,ii,"center",ut,fi,Be,fr.horizontal,!1,Le,we,y);xt&&(Ve.horizontal[ut]=xt,rt=xt.positionedLines.length===1)}}te("left")}else{if(Fi==="auto"&&(Fi=e0(li)),on||A.get("text-writing-mode").indexOf("horizontal")>=0||!oc(Ut)){const We=Y1(Ye,e,i,s,me,X,ii,li,Fi,fi,Be,fr.horizontal,!1,Le,we,y);We&&(Ve.horizontal[Fi]=We)}te(on?"left":Fi)}}let qe,De,Re,tt,nt,Lt,At=!1;const ct=A.get("icon-text-fit").evaluate(ce,{},h);if(ce.icon&&ce.icon.hasPrimary()){const Ut=sx(ce.icon,n.iconSizeData,S["icon-size"],h,n.zoom,ce,y,E.iconScaleFactor,k);qe=Ut.iconPrimary,Re=Ut.iconSecondary;const ni=qe.toString();if(De=r.get(ni),De&&(nt=A.get("icon-offset").evaluate(ce,{},h),Lt=A.get("icon-anchor").evaluate(ce,{},h),Ke=B6(s.get(ni),Re?s.get(Re.toString()):void 0,nt,Lt),At=De.sdf,n.sdfIcons===void 0?n.sdfIcons=De.sdf:n.sdfIcons!==De.sdf&&ai("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==n.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Re){const ii=Re.toString();tt=r.get(ii)}}ee=ee||!(!ce.icon||!ce.icon.hasSecondary());const et=t0(Ve.horizontal)||Ve.vertical;n.iconsInText||(n.iconsInText=!!et&&et.iconsInText);const Kt=Le*E.textScaleFactor/ha,{defaultShapedIcon:kt,verticallyShapedIcon:Pt}=q6(n,Ke,A,ce,h,Ve,Kt,nt,ct);ct!=="none"&&Ke&&(V2(Ke)||U2(Ke))&&(Ug(0,De,qe,Ke,kt,ct,w,r,s),Ug(0,tt,Re,Ke,kt,ct,w,r,s),Pt&&(Ug(0,De,qe,Ke,Pt,ct,w,r,s),Ug(0,tt,Re,Ke,Pt,ct,w,r,s))),Ke=kt,pe.push({feature:ce,shapedTextOrientations:Ve,shapedText:et,shapedIcon:Ke,iconPrimary:qe,iconSecondary:Re,iconOffset:nt,iconAnchor:Lt,verticallyShapedIcon:Pt,layoutTextSize:Le,layoutIconSize:Ze,textOffset:Be,isSDFIcon:At,iconTextFit:ct})}return{featureData:pe,sizes:E,hasAnySecondaryIcon:ee,textAlongLine:J,symbolPlacement:W}},o.fa=Q2,o.fb=function(n,e,i,r,s,h,d,g,y,w){const{featureData:k,hasAnySecondaryIcon:A,sizes:S,textAlongLine:E,symbolPlacement:D}=e;for(const R of k){const{shapedIcon:F,verticallyShapedIcon:j,feature:Y,shapedTextOrientations:H,shapedText:W,layoutTextSize:J,textOffset:Z,isSDFIcon:ee,iconPrimary:pe,iconSecondary:ce,iconTextFit:me,iconOffset:we}=R;lx(F,w.iconPositions,pe,ce),lx(j,w.iconPositions,pe,ce),J6(H,w.iconPositions),U6(pe,ce,w.iconPositions),(W||F)&&G6(n,Y,H,F,j,y,S,J,0,Z,ee,r,s,d,g,A,me,we,E,D)}i&&n.generateCollisionDebugBuffers(h,n.collisionBoxArray,S.textScaleFactor)},o.fc=hi,o.fd=m_,o.fe=Ts,o.ff=ei,o.fg=R2,o.fh=Go,o.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==p2){const i=new Uint32Array(n,0,7),[,,r,s,h,d]=i;e=i.byteLength+s+h+d+h,(r!==n.byteLength||e>=n.byteLength)&&ai("Invalid b3dm header information.")}return _2(n,e)},o.fj=function(n,e){const i=Mk(n);for(const r of i){for(const s of r.meshes)g7(s);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(_7(r.lights,e)))}return i},o.fk=l_,o.fl=$i,o.fm=l2,o.fn=To,o.fo=ir,o.fp=function(n){gl(),Xr!=null&&Xr.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-n;r++)e.delete(i[r]).catch(s=>ai(s.message))}).catch(i=>ai(i.message))}).catch(e=>ai(e.message))},o.g=function(n,e){return yl(Te(n,{method:"GET"}),e)},o.h=Te,o.i=function(n){return pa.API_STYLE_REGEX.test(n)&&!Hc(n)},o.j=function(n){return n.indexOf("mapbox:")===0},o.k=Yo,o.l=Jd,o.m=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(n,e){return yl(Te(n,{type:"json"}),e)},o.o=qd,o.p=function(n,e){return yl(Te(n,{method:"POST"}),e)},o.q=Wr,o.r=wa,o.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Xc,o.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},o.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},o.w=ai,o.x=function(){return W1||(W1=new Mc),W1},o.y=k0,o.z=ih}),B(["./shared"],function(o){function _e(Me){const V=Me?Me.url.toString():void 0;return V?performance.getEntriesByName(V):[]}function Ie(Me){if(typeof Me=="number"||typeof Me=="boolean"||typeof Me=="string"||Me==null)return JSON.stringify(Me);if(Array.isArray(Me)){let G="[";for(const ie of Me)G+=`${Ie(ie)},`;return`${G}]`}let V="{";for(const G of Object.keys(Me).sort())V+=`${G}:${Ie(Me[G])},`;return`${V}}`}function pt(Me){let V="";for(const G of o.bu)V+=`/${Ie(Me[G])}`;return V}class dt{constructor(V){this.keyCache={},this._layers={},this._layerConfigs={},V&&this.replace(V)}replace(V,G){this._layerConfigs={},this._layers={},this.update(V,[],G)}update(V,G,ie){this._options=ie;for(const oe of V)this._layerConfigs[oe.id]=oe,(this._layers[oe.id]=o.db(oe,this.scope,null,this._options)).compileFilter(ie),this.keyCache[oe.id]&&delete this.keyCache[oe.id];for(const oe of G)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const de=function(oe,ge){const Se={};for(let Te=0;Te<oe.length;Te++){const Ue=oe[Te];let Ce=ge&&ge[Ue.id];Ce||(Ue.type==="symbol"?Ce=Ue.id:(Ce=pt(Ue),Ue.type==="line"&&Ue.paint&&function Tt(Mt){return typeof Mt=="string"&&Mt==="line-progress"||(Array.isArray(Mt)?Mt.some(Tt):!(!Mt||typeof Mt!="object")&&Object.values(Mt).some(Tt))}(Ue.paint["line-width"])&&(Ce+=`/${Ie(Ue.paint["line-width"])}`))),ge&&(ge[Ue.id]=Ce);let ot=Se[Ce];ot||(ot=Se[Ce]=[]),ot.push(Ue)}const ye=[];for(const Te in Se)ye.push(Se[Te]);return ye}(Object.values(this._layerConfigs),this.keyCache);for(const oe of de){const ge=oe.map(ot=>this._layers[ot.id]),Se=ge[0];if(Se.visibility==="none")continue;const ye=Se.source||"";let Te=this.familiesBySource[ye];Te||(Te=this.familiesBySource[ye]={});const Ue=Se.sourceLayer||"_geojsonTileLayer";let Ce=Te[Ue];Ce||(Ce=Te[Ue]=[]),Ce.push(ge)}}}const Xe=1*o.e_;class zt{constructor(V){const G={},ie=[];for(const Se in V){const ye=V[Se],Te=G[Se]={};for(const Ue in ye.glyphs){const Ce=ye.glyphs[+Ue];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const ot=Ce.metrics.localGlyph?Xe:1,Tt={x:0,y:0,w:Ce.bitmap.width+2*ot,h:Ce.bitmap.height+2*ot};ie.push(Tt),Te[Ue]=Tt}}const{w:de,h:oe}=o.H(ie),ge=new o.eZ({width:de||1,height:oe||1});for(const Se in V){const ye=V[Se];for(const Te in ye.glyphs){const Ue=ye.glyphs[+Te];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ce=G[Se][Te],ot=Ue.metrics.localGlyph?Xe:1;o.eZ.copy(Ue.bitmap,ge,{x:0,y:0},{x:Ce.x+ot,y:Ce.y+ot},Ue.bitmap)}}this.image=ge,this.positions=G}}o.eY(zt,"GlyphAtlas");class St{constructor(V){this.tileID=new o.aM(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.lut=V.lut,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.scope=V.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.request&&V.request.collectResourceTiming,this.promoteId=V.promoteId,this.isSymbolTile=V.isSymbolTile,this.tileTransform=o.aW(V.tileID.canonical,V.projection),this.projection=V.projection,this.worldview=V.worldview,this.localizableLayerIds=V.localizableLayerIds,this.brightness=V.brightness,this.extraShadowCaster=!!V.extraShadowCaster,this.tessellationStep=V.tessellationStep,this.scaleFactor=V.scaleFactor,this.worldview=V.worldview}parse(V,G,ie,de,oe,ge){this.status="parsing",this.data=V,this.collisionBoxArray=new o.b0;const Se=new o.e$(Object.keys(V.layers).sort()),ye=new o.f0(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const Te={},Ue=new o.f1(256,256),Ce={featureIndex:ye,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ue,availableImages:ie,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ot=[],Tt=G.familiesBySource[this.source];for(const qt in Tt){const Zt=V.layers[qt];if(!Zt)continue;let Xt=!1,_i=!1,ai=!1;for(const $i of Tt[qt])$i[0].type==="symbol"?Xt=!0:_i=!0,$i[0].is3D()&&$i[0].type!=="model"&&(ai=!0);if(this.extraShadowCaster&&!ai||this.isSymbolTile===!0&&!Xt||this.isSymbolTile===!1&&!_i)continue;Zt.version===1&&o.w(`Vector tile source "${this.source}" layer "${qt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xi=Se.encode(qt),gn=[];let _n=!1;for(let $i=0,Ii=0;$i<Zt.length;$i++){const Nn=Zt.feature($i),En=ye.getId(Nn,qt);if(this.localizableLayerIds&&this.localizableLayerIds.has(qt)){const Sn=Nn.properties?Nn.properties.worldview:null;if(this.worldview&&typeof Sn=="string")if(Sn==="all")Nn.properties.$localized=!0;else{if(!Sn.split(",").includes(this.worldview))continue;Nn.properties.$localized=!0,Nn.properties.worldview=this.worldview}}!_n&&Nn.properties&&Nn.properties.hasOwnProperty(o.f2)&&(_n=!0),gn.push({feature:Nn,id:En,index:Ii,sourceLayerIndex:Xi}),Ii++}_n&&!Ce.elevationFeatures&&V.layers.hasOwnProperty(o.f3)&&(Ce.elevationFeatures=o.f4.parseFrom(V.layers[o.f3],this.canonical));for(const $i of Tt[qt]){const Ii=$i[0];if(this.extraShadowCaster&&(!Ii.is3D()||Ii.type==="model")||this.isSymbolTile!==void 0&&Ii.type==="symbol"!==this.isSymbolTile||Ii.minzoom&&this.zoom<Math.floor(Ii.minzoom)||Ii.maxzoom&&this.zoom>=Ii.maxzoom||Ii.visibility==="none")continue;He($i,this.zoom,Ce.brightness,ie,this.worldview);const Nn=Te[Ii.id]=Ii.createBucket({index:ye.bucketLayerIDs.length,layers:$i,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:de,worldview:this.worldview});ye.bucketLayerIDs.push($i.map(Sn=>o.C(Sn.id,Sn.scope)));let En=Nn.prepare?Nn.prepare():null;En!=null?(En=En.then(()=>Nn.populate(gn,Ce,this.tileID.canonical,this.tileTransform)),ot.push(En)):Nn.populate(gn,Ce,this.tileID.canonical,this.tileTransform)}}const Mt=()=>{let qt,Zt,Xt,_i,ai,Xi;Ue.trim();const gn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_n=()=>{if(qt)return this.status="done",ge(qt);if(this.extraShadowCaster)this.status="done",ge(null,{buckets:Object.values(Te).filter(Ii=>!Ii.isEmpty()),featureIndex:ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ce.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Zt&&Xt&&_i){const Ii=new zt(Zt),Nn=new Map;for(const[ua,ja]of Xt.entries()){const{imagePosition:Aa}=o.f7(ua,ja,o.f8);Nn.set(ua,Aa)}const En={};for(const ua in Te){const ja=Te[ua];ja instanceof o.b1&&(He(ja.layers,this.zoom,Ce.brightness,ie,this.worldview),En[ua]=o.f9(ja,Zt,Ii.positions,Xt,Nn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ai,this.worldview))}const Sn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(oe,Xt,ai,()=>{Sn.iconsPending=!1,$i(En,Ii,Sn)}),this.rasterizeIfNeeded(oe,_i,Xi,()=>{Sn.patternsPending=!1,$i(En,Ii,Sn)})}},$i=(Ii,Nn,En,Sn)=>{if(En.iconsPending||En.patternsPending)return;const ua=new o.fa(Xt,_i,this.lut);for(const ja in Te){const Aa=Te[ja];if(ja in Ii)o.fb(Aa,Ii[ja],this.showCollisionBoxes,ie,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Xt,ua);else if(Aa.hasPattern&&(Aa instanceof o.b7||Aa instanceof o.b8||Aa instanceof o.dU)){He(Aa.layers,this.zoom,Ce.brightness,ie,this.worldview);const Eu=Object.fromEntries(ua.patternPositions);Aa.addFeatures(Ce,this.tileID.canonical,Eu,ie,this.tileTransform,this.brightness)}}this.status="done",ge(null,{buckets:Object.values(Te).filter(ja=>!ja.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nn.image,lineAtlas:Ue,imageAtlas:ua,brightness:Ce.brightness})};if(!this.extraShadowCaster){const Ii=o.f5(Ce.glyphDependencies,Sn=>Object.keys(Sn).map(Number));Object.keys(Ii).length?oe.send("getGlyphs",{uid:this.uid,stacks:Ii,scope:this.scope},(Sn,ua)=>{qt||(qt=Sn,Zt=ua,_n())},void 0,!1,gn):Zt={};const Nn=Array.from(Ce.iconDependencies.keys()).map(Sn=>o.I.parse(Sn));Nn.length?oe.send("getImages",{images:Nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Sn,ua)=>{qt||(qt=Sn,Xt=new Map,ai=this.updateImageMapAndGetImageTaskQueue(Xt,ua,Ce.iconDependencies),_n())},void 0,!1,gn):(Xt=new Map,ai=new Map);const En=Array.from(Ce.patternDependencies.keys()).map(Sn=>o.I.parse(Sn));En.length?oe.send("getImages",{images:En,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Sn,ua)=>{qt||(qt=Sn,_i=new Map,Xi=this.updateImageMapAndGetImageTaskQueue(_i,ua,Ce.patternDependencies),_n())},void 0,!1,gn):(_i=new Map,Xi=new Map)}if(Ce.elevationFeatures&&Ce.elevationFeatures.length>0){const Ii=[];for(const En of Object.values(Te))if(En instanceof o.b8){const Sn=En.getUnevaluatedPortalGraph();Sn&&Ii.push(Sn)}const Nn=o.f6.evaluate(Ii);for(const En of Object.values(Te))if(En instanceof o.b8){const Sn=V.layers[Se.decode(En.sourceLayerIndex)];En.setEvaluatedPortalGraph(Nn,Sn,this.tileID.canonical,Ce.availableImages,Ce.brightness)}}_n()};ot.length>0?Promise.allSettled(ot).then(Mt).catch(ge):Mt()}rasterizeIfNeeded(V,G,ie,de){Array.from(G.values()).some(oe=>oe.usvg)?this.rasterize(V,G,ie,de):de()}updateImageMapAndGetImageTaskQueue(V,G,ie){const de=new Map;for(const oe of G.keys()){const ge=ie.get(oe)||[];for(const Se of ge){const ye=Se.toString(),Te=G.get(Se.id.toString());Te.usvg?de.has(ye)||(de.set(ye,Se),V.set(ye,Object.assign({},Te))):V.set(ye,Te)}}return de}rasterize(V,G,ie,de){this.rasterizeTask=V.send("rasterizeImages",{scope:this.scope,tasks:ie},(oe,ge)=>{if(!oe)for(const[Se,ye]of ge.entries()){const Te=Object.assign(G.get(Se),{data:ye});G.set(Se,Te)}de()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function He(Me,V,G,ie,de){const oe=new o.aa(V,{brightness:G,worldview:de});for(const ge of Me)ge.recalculate(oe,ie)}class yi extends o.E{constructor(V,G,ie,de,oe,ge,Se){super(),this.actor=V,this.layerIndex=G,this.availableImages=ie,this.availableModels=de,this.loadVectorData=ge||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(V.scheduler),this.isSpriteLoaded=oe,this.scheduler=V.scheduler,this.brightness=Se}loadTile(V,G){const ie=V.uid,de=V&&V.request,oe=de&&de.collectResourceTiming,ge=this.loading[ie]=new St(V);ge.abort=this.loadVectorData(V,(Se,ye)=>{const Te=!this.loading[ie];if(delete this.loading[ie],ge.cancelRasterize(),Te||Se||!ye)return ge.status="done",Te||(this.loaded[ie]=ge),G(Se);const Ue=ye.rawData,Ce={};ye.expires&&(Ce.expires=ye.expires),ye.cacheControl&&(Ce.cacheControl=ye.cacheControl),ge.vectorTile=ye.vectorTile||new o.fc.VectorTile(new o.bq(Ue));const ot=()=>{ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Tt,Mt)=>{if(Tt||!Mt)return G(Tt);const qt={};if(oe){const Zt=_e(de);Zt.length>0&&(qt.resourceTiming=JSON.parse(JSON.stringify(Zt)))}G(null,o.h({rawTileData:Ue.slice(0)},Mt,Ce,qt))})};this.isSpriteLoaded?ot():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ot,{type:"parseTile",isSymbolTile:V.isSymbolTile,zoom:V.tileZoom}):ot()}),this.loaded=this.loaded||{},this.loaded[ie]=ge})}reloadTile(V,G){const ie=this.loaded,de=V.uid;if(ie&&ie[de]){const oe=ie[de];oe.scaleFactor=V.scaleFactor,oe.showCollisionBoxes=V.showCollisionBoxes,oe.projection=V.projection,oe.brightness=V.brightness,oe.tileTransform=o.aW(V.tileID.canonical,V.projection),oe.extraShadowCaster=V.extraShadowCaster,oe.lut=V.lut,oe.worldview=V.worldview;const ge=(Se,ye)=>{const Te=oe.reloadCallback;Te&&(delete oe.reloadCallback,oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Te)),G(Se,ye)};oe.status==="parsing"?oe.reloadCallback=ge:oe.status==="done"&&(oe.vectorTile?oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ge):ge())}else G(null,void 0)}abortTile(V,G){const ie=V.uid,de=this.loading[ie];de&&(de.abort&&de.abort(),delete this.loading[ie]),G()}removeTile(V,G){const ie=this.loaded,de=V.uid;ie&&ie[de]&&delete ie[de],G()}}class Ee{loadTile(V,G){const{uid:ie,encoding:de,rawImageData:oe,padding:ge}=V,Se=ImageBitmap&&oe instanceof ImageBitmap?this.getImageData(oe,ge):oe;G(null,new o.fd(ie,Se,de,ge<1))}reloadTile(V,G){G(null,null)}abortTile(V,G){G()}removeTile(V,G){G()}getImageData(V,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ie=this.offscreenCanvasContext.getImageData(-G,-G,V.width+2*G,V.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}o.bp.setPbf(o.bq);class Ae{constructor(V){this._mrt=new o.bp(V.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=V.uid,this.tileID=V.tileID,this.source=V.source}parse(V,G){const ie=this._mrt;this.status="parsing",this._entireBuffer=V;try{ie.parseHeader(V),this._isHeaderLoaded=!0;const de=[];for(const oe in ie.layers){const ge=ie.getLayer(oe),Se=ge.getDataRange(ge.getBandList()),ye=ie.createDecodingTask(Se),Te=V.slice(Se.firstByte,Se.lastByte+1),Ue=o.bp.performDecoding(Te,ye).then(Ce=>ye.complete(null,Ce)).catch(Ce=>ye.complete(Ce,null));de.push(Ue)}Promise.allSettled(de).then(()=>G(null,ie)).catch(oe=>G(oe))}catch(de){G(de)}}}class Oe{constructor(V){this.actor=V,this.loading={},this.loaded={}}loadTile(V,G){const ie=V.uid,de=V.request,oe=this.loading[ie]=new Ae(V),{cancel:ge}=o.br(de,(Se,ye,Te,Ue)=>{const Ce=!this.loading[ie];if(delete this.loading[ie],Ce||Se||!ye)return oe.status="done",Ce||(this.loaded[ie]=oe),G(Se);oe.parse(ye,(ot,Tt)=>{if(ot||!Tt)return G(ot);G(null,Tt,Te,Ue)}),this.loaded[ie]=oe});oe.abort=ge}reloadTile(V,G){G(null,void 0)}abortTile(V,G){const ie=V.uid,de=this.loading[ie];de&&(de.abort&&de.abort(),delete this.loading[ie]),G()}removeTile(V,G){const ie=V.uid;this.loaded[ie]&&delete this.loaded[ie],G()}decodeRasterArray(V,G){o.bp.performDecoding(V.buffer,V.task).then(ie=>G(null,ie)).catch(ie=>G(ie))}}const vt=o.fc.VectorTileFeature.prototype.toGeoJSON;class Ot{constructor(V){this._feature=V,this.extent=o.aj,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const G of this._feature.geometry)V.push([new o.P(G[0],G[1])]);return V}{const V=[];for(const G of this._feature.geometry){const ie=[];for(const de of G)ie.push(new o.P(de[0],de[1]));V.push(ie)}return V}}toGeoJSON(V,G,ie){return vt.call(this,V,G,ie)}}class Qt{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.aj,this.length=V.length,this._features=V}feature(V){return new Ot(this._features[V])}}class ti{constructor(V,G){this.name=V,this.extent=o.aj,this.length=G.length,this._features=G}feature(V){return new Ot(this._features[V])}}class ri extends Qt{constructor(V){super([]),this.layers={};for(const G in V)this.layers[G]=new ti(G,V[G])}}const oi=64/4096,Yt=128;class ci{constructor(){this.features=new Map}clear(){this.features.clear()}load(V=[],G){for(const ie of V){const de=ie.id;if(de==null)continue;let oe=this.features.get(de);oe&&this.updateCache(oe,G),ie.geometry?(oe=Ki(ie),this.updateCache(oe,G),this.features.set(de,oe)):this.features.delete(de),this.updateCache(oe,G)}}updateCache(V,G){for(const{canonical:ie,uid:de}of Object.values(G)){const{z:oe,x:ge,y:Se}=ie;Bn(V,Math.pow(2,oe),ge,Se)&&delete G[de]}}getTile(V,G,ie){const de=Math.pow(2,V),oe=[];for(const ge of this.features.values())Bn(ge,de,G,ie)&&oe.push(nn(ge,de,G,ie));return{features:oe}}getFeatures(){return[...this.features.values()]}}function Bn({minX:Me,minY:V,maxX:G,maxY:ie},de,oe,ge){return Me<(oe+1+oi)/de&&V<(ge+1+oi)/de&&G>(oe-oi)/de&&ie>(ge-oi)/de}function Ki(Me){const{id:V,geometry:G,properties:ie}=Me;if(!G)return;if(G.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:de,coordinates:oe}=G,ge={id:V,type:1,geometry:[],tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Se=ge.geometry;if(de==="Point")It(oe,Se,ge);else if(de==="MultiPoint")for(const ye of oe)It(ye,Se,ge);else if(de==="LineString")ge.type=2,wi(oe,Se,ge);else if(de==="MultiLineString")ge.type=2,Ui(oe,Se,ge);else if(de==="Polygon")ge.type=3,Ui(oe,Se,ge,!0);else{if(de!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ge.type=3;for(const ye of oe)Ui(ye,Se,ge,!0)}return ge}function It([Me,V],G,ie){const de=o.aD(Me);let oe=o.aH(V);oe=oe<0?0:oe>1?1:oe,G.push(de,oe),ie.minX=Math.min(ie.minX,de),ie.minY=Math.min(ie.minY,oe),ie.maxX=Math.max(ie.maxX,de),ie.maxY=Math.max(ie.maxY,oe)}function wi(Me,V,G,ie=!1,de=!1){const oe=[];for(const ge of Me)It(ge,oe,G);V.push(oe),ie&&function(ge,Se){let ye=0;for(let Te=0,Ue=ge.length,Ce=Ue-2;Te<Ue;Ce=Te,Te+=2)ye+=(ge[Te]-ge[Ce])*(ge[Te+1]+ge[Ce+1]);if(ye>0===Se)for(let Te=0,Ue=ge.length;Te<Ue/2;Te+=2){const Ce=ge[Te],ot=ge[Te+1];ge[Te]=ge[Ue-2-Te],ge[Te+1]=ge[Ue-1-Te],ge[Ue-2-Te]=Ce,ge[Ue-1-Te]=ot}}(oe,de)}function Ui(Me,V,G,ie=!1){for(let de=0;de<Me.length;de++)wi(Me[de],V,G,ie,de===0)}function nn(Me,V,G,ie){const{id:de,type:oe,geometry:ge,tags:Se}=Me,ye=[];if(oe===1)(function(Te,Ue,Ce,ot,Tt){for(let Mt=0;Mt<Te.length;Mt+=2){const qt=Math.round(o.aj*(Te[Mt+0]*Ue-Ce)),Zt=Math.round(o.aj*(Te[Mt+1]*Ue-ot));Tt.push([qt,Zt])}})(ge,V,G,ie,ye);else for(const Te of ge)jt(Te,V,G,ie,ye);return{id:de,type:oe,geometry:ye,tags:Se}}function jt(Me,V,G,ie,de){const ge=o.aj+Yt;let Se;for(let ye=0;ye<Me.length-2;ye+=2){let Te=Math.round(o.aj*(Me[ye+0]*V-G)),Ue=Math.round(o.aj*(Me[ye+1]*V-ie)),Ce=Math.round(o.aj*(Me[ye+2]*V-G)),ot=Math.round(o.aj*(Me[ye+3]*V-ie));const Tt=Ce-Te,Mt=ot-Ue;Te<-128&&Ce<-128||(Te<-128?(Ue+=Math.round(Mt*((-128-Te)/Tt)),Te=-128):Ce<-128&&(ot=Ue+Math.round(Mt*((-128-Te)/Tt)),Ce=-128),Ue<-128&&ot<-128||(Ue<-128?(Te+=Math.round(Tt*((-128-Ue)/Mt)),Ue=-128):ot<-128&&(Ce=Te+Math.round(Tt*((-128-Ue)/Mt)),ot=-128),Te>=ge&&Ce>=ge||(Te>=ge?(Ue+=Math.round(Mt*((ge-Te)/Tt)),Te=ge):Ce>=ge&&(ot=Ue+Math.round(Mt*((ge-Te)/Tt)),Ce=ge),Ue>=ge&&ot>=ge||(Ue>=ge?(Te+=Math.round(Tt*((ge-Ue)/Mt)),Ue=ge):ot>=ge&&(Ce=Te+Math.round(Tt*((ge-Ue)/Mt)),ot=ge),Se&&Te===Se[Se.length-1][0]&&Ue===Se[Se.length-1][1]||(Se=[[Te,Ue]],de.push(Se)),Se.push([Ce,ot])))))}}var bi,Ht,vn,Wn={exports:{}},Rr=function(){if(vn)return Wn.exports;vn=1;var Me=o.fg(),V=function(){if(Ht)return bi;Ht=1;var Ue=o.fe(),Ce=o.ff().VectorTileFeature;function ot(Mt,qt){this.options=qt||{},this.features=Mt,this.length=Mt.length}function Tt(Mt,qt){this.id=typeof Mt.id=="number"?Mt.id:void 0,this.type=Mt.type,this.rawGeometry=Mt.type===1?[Mt.geometry]:Mt.geometry,this.properties=Mt.tags,this.extent=qt||4096}return bi=ot,ot.prototype.feature=function(Mt){return new Tt(this.features[Mt],this.options.extent)},Tt.prototype.loadGeometry=function(){var Mt=this.rawGeometry;this.geometry=[];for(var qt=0;qt<Mt.length;qt++){for(var Zt=Mt[qt],Xt=[],_i=0;_i<Zt.length;_i++)Xt.push(new Ue(Zt[_i][0],Zt[_i][1]));this.geometry.push(Xt)}return this.geometry},Tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Mt=this.geometry,qt=1/0,Zt=-1/0,Xt=1/0,_i=-1/0,ai=0;ai<Mt.length;ai++)for(var Xi=Mt[ai],gn=0;gn<Xi.length;gn++){var _n=Xi[gn];qt=Math.min(qt,_n.x),Zt=Math.max(Zt,_n.x),Xt=Math.min(Xt,_n.y),_i=Math.max(_i,_n.y)}return[qt,Xt,Zt,_i]},Tt.prototype.toGeoJSON=Ce.prototype.toGeoJSON,bi}();function G(Ue){var Ce=new Me;return function(ot,Tt){for(var Mt in ot.layers)Tt.writeMessage(3,ie,ot.layers[Mt])}(Ue,Ce),Ce.finish()}function ie(Ue,Ce){var ot;Ce.writeVarintField(15,Ue.version||1),Ce.writeStringField(1,Ue.name||""),Ce.writeVarintField(5,Ue.extent||4096);var Tt={keys:[],values:[],keycache:{},valuecache:{}};for(ot=0;ot<Ue.length;ot++)Tt.feature=Ue.feature(ot),Ce.writeMessage(2,de,Tt);var Mt=Tt.keys;for(ot=0;ot<Mt.length;ot++)Ce.writeStringField(3,Mt[ot]);var qt=Tt.values;for(ot=0;ot<qt.length;ot++)Ce.writeMessage(4,Te,qt[ot])}function de(Ue,Ce){var ot=Ue.feature;ot.id!==void 0&&Ce.writeVarintField(1,ot.id),Ce.writeMessage(2,oe,Ue),Ce.writeVarintField(3,ot.type),Ce.writeMessage(4,ye,ot)}function oe(Ue,Ce){var ot=Ue.feature,Tt=Ue.keys,Mt=Ue.values,qt=Ue.keycache,Zt=Ue.valuecache;for(var Xt in ot.properties){var _i=ot.properties[Xt],ai=qt[Xt];if(_i!==null){ai===void 0&&(Tt.push(Xt),qt[Xt]=ai=Tt.length-1),Ce.writeVarint(ai);var Xi=typeof _i;Xi!=="string"&&Xi!=="boolean"&&Xi!=="number"&&(_i=JSON.stringify(_i));var gn=Xi+":"+_i,_n=Zt[gn];_n===void 0&&(Mt.push(_i),Zt[gn]=_n=Mt.length-1),Ce.writeVarint(_n)}}}function ge(Ue,Ce){return(Ce<<3)+(7&Ue)}function Se(Ue){return Ue<<1^Ue>>31}function ye(Ue,Ce){for(var ot=Ue.loadGeometry(),Tt=Ue.type,Mt=0,qt=0,Zt=ot.length,Xt=0;Xt<Zt;Xt++){var _i=ot[Xt],ai=1;Tt===1&&(ai=_i.length),Ce.writeVarint(ge(1,ai));for(var Xi=Tt===3?_i.length-1:_i.length,gn=0;gn<Xi;gn++){gn===1&&Tt!==1&&Ce.writeVarint(ge(2,Xi-1));var _n=_i[gn].x-Mt,$i=_i[gn].y-qt;Ce.writeVarint(Se(_n)),Ce.writeVarint(Se($i)),Mt+=_n,qt+=$i}Tt===3&&Ce.writeVarint(ge(7,1))}}function Te(Ue,Ce){var ot=typeof Ue;ot==="string"?Ce.writeStringField(1,Ue):ot==="boolean"?Ce.writeBooleanField(7,Ue):ot==="number"&&(Ue%1!=0?Ce.writeDoubleField(3,Ue):Ue<0?Ce.writeSVarintField(6,Ue):Ce.writeVarintField(5,Ue))}return Wn.exports=G,Wn.exports.fromVectorTileJs=G,Wn.exports.fromGeojsonVt=function(Ue,Ce){Ce=Ce||{};var ot={};for(var Tt in Ue)ot[Tt]=new V(Ue[Tt].features,Ce),ot[Tt].name=Tt,ot[Tt].version=Ce.version,ot[Tt].extent=Ce.extent;return G({layers:ot})},Wn.exports.GeoJSONWrapper=V,Wn.exports}(),Za=o.fh(Rr);const mn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},An=Math.fround||(Un=new Float32Array(1),Me=>(Un[0]=+Me,Un[0]));var Un;const br=3,fn=5,ul=6;class po{constructor(V){this.options=Object.assign(Object.create(mn),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:G,minZoom:ie,maxZoom:de}=this.options;G&&console.time("total time");const oe=`prepare ${V.length} points`;G&&console.time(oe),this.points=V;const ge=[];for(let ye=0;ye<V.length;ye++){const Te=V[ye];if(!Te.geometry)continue;const[Ue,Ce]=Te.geometry.coordinates,ot=An(cl(Ue)),Tt=An($o(Ce));ge.push(ot,Tt,1/0,ye,-1,1),this.options.reduce&&ge.push(0)}let Se=this.trees[de+1]=this._createTree(ge);G&&console.timeEnd(oe);for(let ye=de;ye>=ie;ye--){const Te=+Date.now();Se=this.trees[ye]=this._createTree(this._cluster(Se,ye)),G&&console.log("z%d: %d clusters in %dms",ye,Se.numItems,+Date.now()-Te)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let ie=((V[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,V[1]));let oe=V[2]===180?180:((V[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ie=-180,oe=180;else if(ie>oe){const Ce=this.getClusters([ie,de,180,ge],G),ot=this.getClusters([-180,de,oe,ge],G);return Ce.concat(ot)}const Se=this.trees[this._limitZoom(G)],ye=Se.range(cl(ie),$o(ge),cl(oe),$o(de)),Te=Se.data,Ue=[];for(const Ce of ye){const ot=this.stride*Ce;Ue.push(Te[ot+fn]>1?Br(Te,ot,this.clusterProps):this.points[Te[ot+br]])}return Ue}getChildren(V){const G=this._getOriginId(V),ie=this._getOriginZoom(V),de="No cluster with the specified id.",oe=this.trees[ie];if(!oe)throw new Error(de);const ge=oe.data;if(G*this.stride>=ge.length)throw new Error(de);const Se=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ye=oe.within(ge[G*this.stride],ge[G*this.stride+1],Se),Te=[];for(const Ue of ye){const Ce=Ue*this.stride;ge[Ce+4]===V&&Te.push(ge[Ce+fn]>1?Br(ge,Ce,this.clusterProps):this.points[ge[Ce+br]])}if(Te.length===0)throw new Error(de);return Te}getLeaves(V,G,ie){const de=[];return this._appendLeaves(de,V,G=G||10,ie=ie||0,0),de}getTile(V,G,ie){const de=this.trees[this._limitZoom(V)],oe=Math.pow(2,V),{extent:ge,radius:Se}=this.options,ye=Se/ge,Te=(ie-ye)/oe,Ue=(ie+1+ye)/oe,Ce={features:[]};return this._addTileFeatures(de.range((G-ye)/oe,Te,(G+1+ye)/oe,Ue),de.data,G,ie,oe,Ce),G===0&&this._addTileFeatures(de.range(1-ye/oe,Te,1,Ue),de.data,oe,ie,oe,Ce),G===oe-1&&this._addTileFeatures(de.range(0,Te,ye/oe,Ue),de.data,-1,ie,oe,Ce),Ce.features.length?Ce:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){const ie=this.getChildren(V);if(G++,ie.length!==1)break;V=ie[0].properties.cluster_id}return G}_appendLeaves(V,G,ie,de,oe){const ge=this.getChildren(G);for(const Se of ge){const ye=Se.properties;if(ye&&ye.cluster?oe+ye.point_count<=de?oe+=ye.point_count:oe=this._appendLeaves(V,ye.cluster_id,ie,de,oe):oe<de?oe++:V.push(Se),V.length===ie)break}return oe}_createTree(V){const G=new o.bW(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<V.length;ie+=this.stride)G.add(V[ie],V[ie+1]);return G.finish(),G.data=V,G}_addTileFeatures(V,G,ie,de,oe,ge){for(const Se of V){const ye=Se*this.stride,Te=G[ye+fn]>1;let Ue,Ce,ot;if(Te)Ue=Jn(G,ye,this.clusterProps),Ce=G[ye],ot=G[ye+1];else{const qt=this.points[G[ye+br]];Ue=qt.properties;const[Zt,Xt]=qt.geometry.coordinates;Ce=cl(Zt),ot=$o(Xt)}const Tt={type:1,geometry:[[Math.round(this.options.extent*(Ce*oe-ie)),Math.round(this.options.extent*(ot*oe-de))]],tags:Ue};let Mt;Mt=Te||this.options.generateId?G[ye+br]:this.points[G[ye+br]].id,Mt!==void 0&&(Tt.id=Mt),ge.features.push(Tt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){const{radius:ie,extent:de,reduce:oe,minPoints:ge}=this.options,Se=ie/(de*Math.pow(2,G)),ye=V.data,Te=[],Ue=this.stride;for(let Ce=0;Ce<ye.length;Ce+=Ue){if(ye[Ce+2]<=G)continue;ye[Ce+2]=G;const ot=ye[Ce],Tt=ye[Ce+1],Mt=V.within(ye[Ce],ye[Ce+1],Se),qt=ye[Ce+fn];let Zt=qt;for(const Xt of Mt){const _i=Xt*Ue;ye[_i+2]>G&&(Zt+=ye[_i+fn])}if(Zt>qt&&Zt>=ge){let Xt,_i=ot*qt,ai=Tt*qt,Xi=-1;const gn=(Ce/Ue<<5)+(G+1)+this.points.length;for(const _n of Mt){const $i=_n*Ue;if(ye[$i+2]<=G)continue;ye[$i+2]=G;const Ii=ye[$i+fn];_i+=ye[$i]*Ii,ai+=ye[$i+1]*Ii,ye[$i+4]=gn,oe&&(Xt||(Xt=this._map(ye,Ce,!0),Xi=this.clusterProps.length,this.clusterProps.push(Xt)),oe(Xt,this._map(ye,$i)))}ye[Ce+4]=gn,Te.push(_i/Zt,ai/Zt,1/0,gn,-1,Zt),oe&&Te.push(Xi)}else{for(let Xt=0;Xt<Ue;Xt++)Te.push(ye[Ce+Xt]);if(Zt>1)for(const Xt of Mt){const _i=Xt*Ue;if(!(ye[_i+2]<=G)){ye[_i+2]=G;for(let ai=0;ai<Ue;ai++)Te.push(ye[_i+ai])}}}}return Te}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G,ie){if(V[G+fn]>1){const ge=this.clusterProps[V[G+ul]];return ie?Object.assign({},ge):ge}const de=this.points[V[G+br]].properties,oe=this.options.map(de);return ie&&oe===de?Object.assign({},oe):oe}}function Br(Me,V,G){return{type:"Feature",id:Me[V+br],properties:Jn(Me,V,G),geometry:{type:"Point",coordinates:[(ie=Me[V],360*(ie-.5)),Da(Me[V+1])]}};var ie}function Jn(Me,V,G){const ie=Me[V+fn],de=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,oe=Me[V+ul],ge=oe===-1?{}:Object.assign({},G[oe]);return Object.assign(ge,{cluster:!0,cluster_id:Me[V+br],point_count:ie,point_count_abbreviated:de})}function cl(Me){return Me/360+.5}function $o(Me){const V=Math.sin(Me*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Da(Me){const V=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function ks(Me,V,G,ie){let de=ie;const oe=V+(G-V>>1);let ge,Se=G-V;const ye=Me[V],Te=Me[V+1],Ue=Me[G],Ce=Me[G+1];for(let ot=V+3;ot<G;ot+=3){const Tt=Tu(Me[ot],Me[ot+1],ye,Te,Ue,Ce);if(Tt>de)ge=ot,de=Tt;else if(Tt===de){const Mt=Math.abs(ot-oe);Mt<Se&&(ge=ot,Se=Mt)}}de>ie&&(ge-V>3&&ks(Me,V,ge,ie),Me[ge+2]=de,G-ge>3&&ks(Me,ge,G,ie))}function Tu(Me,V,G,ie,de,oe){let ge=de-G,Se=oe-ie;if(ge!==0||Se!==0){const ye=((Me-G)*ge+(V-ie)*Se)/(ge*ge+Se*Se);ye>1?(G=de,ie=oe):ye>0&&(G+=ge*ye,ie+=Se*ye)}return ge=Me-G,Se=V-ie,ge*ge+Se*Se}function Ia(Me,V,G,ie){const de={id:Me??null,type:V,geometry:G,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")Ka(de,G);else if(V==="Polygon")Ka(de,G[0]);else if(V==="MultiLineString")for(const oe of G)Ka(de,oe);else if(V==="MultiPolygon")for(const oe of G)Ka(de,oe[0]);return de}function Ka(Me,V){for(let G=0;G<V.length;G+=3)Me.minX=Math.min(Me.minX,V[G]),Me.minY=Math.min(Me.minY,V[G+1]),Me.maxX=Math.max(Me.maxX,V[G]),Me.maxY=Math.max(Me.maxY,V[G+1])}function jo(Me,V,G,ie){if(!V.geometry)return;const de=V.geometry.coordinates;if(de&&de.length===0)return;const oe=V.geometry.type,ge=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let Se=[],ye=V.id;if(G.promoteId?ye=V.properties[G.promoteId]:G.generateId&&(ye=ie||0),oe==="Point")Vo(de,Se);else if(oe==="MultiPoint")for(const Te of de)Vo(Te,Se);else if(oe==="LineString")Uo(de,Se,ge,!1);else if(oe==="MultiLineString"){if(G.lineMetrics){for(const Te of de)Se=[],Uo(Te,Se,ge,!1),Me.push(Ia(ye,"LineString",Se,V.properties));return}za(de,Se,ge,!1)}else if(oe==="Polygon")za(de,Se,ge,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(const Te of V.geometry.geometries)jo(Me,{id:ye,geometry:Te,properties:V.properties},G,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Te of de){const Ue=[];za(Te,Ue,ge,!0),Se.push(Ue)}}Me.push(Ia(ye,oe,Se,V.properties))}function Vo(Me,V){V.push(hl(Me[0]),dl(Me[1]),0)}function Uo(Me,V,G,ie){let de,oe,ge=0;for(let ye=0;ye<Me.length;ye++){const Te=hl(Me[ye][0]),Ue=dl(Me[ye][1]);V.push(Te,Ue,0),ye>0&&(ge+=ie?(de*Ue-Te*oe)/2:Math.sqrt(Math.pow(Te-de,2)+Math.pow(Ue-oe,2))),de=Te,oe=Ue}const Se=V.length-3;V[2]=1,ks(V,0,Se,G),V[Se+2]=1,V.size=Math.abs(ge),V.start=0,V.end=V.size}function za(Me,V,G,ie){for(let de=0;de<Me.length;de++){const oe=[];Uo(Me[de],oe,G,ie),V.push(oe)}}function hl(Me){return Me/360+.5}function dl(Me){const V=Math.sin(Me*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Xa(Me,V,G,ie,de,oe,ge,Se){if(ie/=V,oe>=(G/=V)&&ge<ie)return Me;if(ge<G||oe>=ie)return null;const ye=[];for(const Te of Me){const Ue=Te.geometry;let Ce=Te.type;const ot=de===0?Te.minX:Te.minY,Tt=de===0?Te.maxX:Te.maxY;if(ot>=G&&Tt<ie){ye.push(Te);continue}if(Tt<G||ot>=ie)continue;let Mt=[];if(Ce==="Point"||Ce==="MultiPoint")Pu(Ue,Mt,G,ie,de);else if(Ce==="LineString")mo(Ue,Mt,G,ie,de,!1,Se.lineMetrics);else if(Ce==="MultiLineString")ka(Ue,Mt,G,ie,de,!1);else if(Ce==="Polygon")ka(Ue,Mt,G,ie,de,!0);else if(Ce==="MultiPolygon")for(const qt of Ue){const Zt=[];ka(qt,Zt,G,ie,de,!0),Zt.length&&Mt.push(Zt)}if(Mt.length){if(Se.lineMetrics&&Ce==="LineString"){for(const qt of Mt)ye.push(Ia(Te.id,Ce,qt,Te.tags));continue}Ce!=="LineString"&&Ce!=="MultiLineString"||(Mt.length===1?(Ce="LineString",Mt=Mt[0]):Ce="MultiLineString"),Ce!=="Point"&&Ce!=="MultiPoint"||(Ce=Mt.length===3?"Point":"MultiPoint"),ye.push(Ia(Te.id,Ce,Mt,Te.tags))}}return ye.length?ye:null}function Pu(Me,V,G,ie,de){for(let oe=0;oe<Me.length;oe+=3){const ge=Me[oe+de];ge>=G&&ge<=ie&&vr(V,Me[oe],Me[oe+1],Me[oe+2])}}function mo(Me,V,G,ie,de,oe,ge){let Se=pl(Me);const ye=de===0?As:Jo;let Te,Ue,Ce=Me.start;for(let Zt=0;Zt<Me.length-3;Zt+=3){const Xt=Me[Zt],_i=Me[Zt+1],ai=Me[Zt+2],Xi=Me[Zt+3],gn=Me[Zt+4],_n=de===0?Xt:_i,$i=de===0?Xi:gn;let Ii=!1;ge&&(Te=Math.sqrt(Math.pow(Xt-Xi,2)+Math.pow(_i-gn,2))),_n<G?$i>G&&(Ue=ye(Se,Xt,_i,Xi,gn,G),ge&&(Se.start=Ce+Te*Ue)):_n>ie?$i<ie&&(Ue=ye(Se,Xt,_i,Xi,gn,ie),ge&&(Se.start=Ce+Te*Ue)):vr(Se,Xt,_i,ai),$i<G&&_n>=G&&(Ue=ye(Se,Xt,_i,Xi,gn,G),Ii=!0),$i>ie&&_n<=ie&&(Ue=ye(Se,Xt,_i,Xi,gn,ie),Ii=!0),!oe&&Ii&&(ge&&(Se.end=Ce+Te*Ue),V.push(Se),Se=pl(Me)),ge&&(Ce+=Te)}let ot=Me.length-3;const Tt=Me[ot],Mt=Me[ot+1],qt=de===0?Tt:Mt;qt>=G&&qt<=ie&&vr(Se,Tt,Mt,Me[ot+2]),ot=Se.length-3,oe&&ot>=3&&(Se[ot]!==Se[0]||Se[ot+1]!==Se[1])&&vr(Se,Se[0],Se[1],Se[2]),Se.length&&V.push(Se)}function pl(Me){const V=[];return V.size=Me.size,V.start=Me.start,V.end=Me.end,V}function ka(Me,V,G,ie,de,oe){for(const ge of Me)mo(ge,V,G,ie,de,oe,!1)}function vr(Me,V,G,ie){Me.push(V,G,ie)}function As(Me,V,G,ie,de,oe){const ge=(oe-V)/(ie-V);return vr(Me,oe,G+(de-G)*ge,1),ge}function Jo(Me,V,G,ie,de,oe){const ge=(oe-G)/(de-G);return vr(Me,V+(ie-V)*ge,oe,1),ge}function Ss(Me,V){const G=[];for(let ie=0;ie<Me.length;ie++){const de=Me[ie],oe=de.type;let ge;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ge=qo(de.geometry,V);else if(oe==="MultiLineString"||oe==="Polygon"){ge=[];for(const Se of de.geometry)ge.push(qo(Se,V))}else if(oe==="MultiPolygon"){ge=[];for(const Se of de.geometry){const ye=[];for(const Te of Se)ye.push(qo(Te,V));ge.push(ye)}}G.push(Ia(de.id,oe,ge,de.tags))}return G}function qo(Me,V){const G=[];G.size=Me.size,Me.start!==void 0&&(G.start=Me.start,G.end=Me.end);for(let ie=0;ie<Me.length;ie+=3)G.push(Me[ie]+V,Me[ie+1],Me[ie+2]);return G}function ml(Me,V){if(Me.transformed)return Me;const G=1<<Me.z,ie=Me.x,de=Me.y;for(const oe of Me.features){const ge=oe.geometry,Se=oe.type;if(oe.geometry=[],Se===1)for(let ye=0;ye<ge.length;ye+=2)oe.geometry.push(xn(ge[ye],ge[ye+1],V,G,ie,de));else for(let ye=0;ye<ge.length;ye++){const Te=[];for(let Ue=0;Ue<ge[ye].length;Ue+=2)Te.push(xn(ge[ye][Ue],ge[ye][Ue+1],V,G,ie,de));oe.geometry.push(Te)}}return Me.transformed=!0,Me}function xn(Me,V,G,ie,de,oe){return[Math.round(G*(Me*ie-de)),Math.round(G*(V*ie-oe))]}function Go(Me,V,G,ie,de){const oe=V===de.maxZoom?0:de.tolerance/((1<<V)*de.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:Me.length,source:null,x:G,y:ie,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Se of Me)fl(ge,Se,oe,de);return ge}function fl(Me,V,G,ie){const de=V.geometry,oe=V.type,ge=[];if(Me.minX=Math.min(Me.minX,V.minX),Me.minY=Math.min(Me.minY,V.minY),Me.maxX=Math.max(Me.maxX,V.maxX),Me.maxY=Math.max(Me.maxY,V.maxY),oe==="Point"||oe==="MultiPoint")for(let Se=0;Se<de.length;Se+=3)ge.push(de[Se],de[Se+1]),Me.numPoints++,Me.numSimplified++;else if(oe==="LineString")Qa(ge,de,Me,G,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(let Se=0;Se<de.length;Se++)Qa(ge,de[Se],Me,G,oe==="Polygon",Se===0);else if(oe==="MultiPolygon")for(let Se=0;Se<de.length;Se++){const ye=de[Se];for(let Te=0;Te<ye.length;Te++)Qa(ge,ye[Te],Me,G,!0,Te===0)}if(ge.length){let Se=V.tags||null;if(oe==="LineString"&&ie.lineMetrics){Se={};for(const Te in V.tags)Se[Te]=V.tags[Te];Se.mapbox_clip_start=de.start/de.size,Se.mapbox_clip_end=de.end/de.size}const ye={geometry:ge,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:Se};V.id!==null&&(ye.id=V.id),Me.features.push(ye)}}function Qa(Me,V,G,ie,de,oe){const ge=ie*ie;if(ie>0&&V.size<(de?ge:ie))return void(G.numPoints+=V.length/3);const Se=[];for(let ye=0;ye<V.length;ye+=3)(ie===0||V[ye+2]>ge)&&(G.numSimplified++,Se.push(V[ye],V[ye+1])),G.numPoints++;de&&function(ye,Te){let Ue=0;for(let Ce=0,ot=ye.length,Tt=ot-2;Ce<ot;Tt=Ce,Ce+=2)Ue+=(ye[Ce]-ye[Tt])*(ye[Ce+1]+ye[Tt+1]);if(Ue>0===Te)for(let Ce=0,ot=ye.length;Ce<ot/2;Ce+=2){const Tt=ye[Ce],Mt=ye[Ce+1];ye[Ce]=ye[ot-2-Ce],ye[Ce+1]=ye[ot-1-Ce],ye[ot-2-Ce]=Tt,ye[ot-1-Ce]=Mt}}(Se,oe),Me.push(Se)}const jd={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Yc{constructor(V,G){const ie=(G=this.options=function(oe,ge){for(const Se in ge)oe[Se]=ge[Se];return oe}(Object.create(jd),G)).debug;if(ie&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(oe,ge){const Se=[];if(oe.type==="FeatureCollection")for(let ye=0;ye<oe.features.length;ye++)jo(Se,oe.features[ye],ge,ye);else jo(Se,oe.type==="Feature"?oe:{geometry:oe},ge);return Se}(V,G);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(oe,ge){const Se=ge.buffer/ge.extent;let ye=oe;const Te=Xa(oe,1,-1-Se,Se,0,-1,2,ge),Ue=Xa(oe,1,1-Se,2+Se,0,-1,2,ge);return(Te||Ue)&&(ye=Xa(oe,1,-Se,1+Se,0,-1,2,ge)||[],Te&&(ye=Ss(Te,1).concat(ye)),Ue&&(ye=ye.concat(Ss(Ue,-1)))),ye}(de,G),de.length&&this.splitTile(de,0,0,0),ie&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,G,ie,de,oe,ge,Se){const ye=[V,G,ie,de],Te=this.options,Ue=Te.debug;for(;ye.length;){de=ye.pop(),ie=ye.pop(),G=ye.pop(),V=ye.pop();const Ce=1<<G,ot=Ts(G,ie,de);let Tt=this.tiles[ot];if(!Tt&&(Ue>1&&console.time("creation"),Tt=this.tiles[ot]=Go(V,G,ie,de,Te),this.tileCoords.push({z:G,x:ie,y:de}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,ie,de,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));const Ii=`z${G}`;this.stats[Ii]=(this.stats[Ii]||0)+1,this.total++}if(Tt.source=V,oe==null){if(G===Te.indexMaxZoom||Tt.numPoints<=Te.indexMaxPoints)continue}else{if(G===Te.maxZoom||G===oe)continue;if(oe!=null){const Ii=oe-G;if(ie!==ge>>Ii||de!==Se>>Ii)continue}}if(Tt.source=null,V.length===0)continue;Ue>1&&console.time("clipping");const Mt=.5*Te.buffer/Te.extent,qt=.5-Mt,Zt=.5+Mt,Xt=1+Mt;let _i=null,ai=null,Xi=null,gn=null,_n=Xa(V,Ce,ie-Mt,ie+Zt,0,Tt.minX,Tt.maxX,Te),$i=Xa(V,Ce,ie+qt,ie+Xt,0,Tt.minX,Tt.maxX,Te);V=null,_n&&(_i=Xa(_n,Ce,de-Mt,de+Zt,1,Tt.minY,Tt.maxY,Te),ai=Xa(_n,Ce,de+qt,de+Xt,1,Tt.minY,Tt.maxY,Te),_n=null),$i&&(Xi=Xa($i,Ce,de-Mt,de+Zt,1,Tt.minY,Tt.maxY,Te),gn=Xa($i,Ce,de+qt,de+Xt,1,Tt.minY,Tt.maxY,Te),$i=null),Ue>1&&console.timeEnd("clipping"),ye.push(_i||[],G+1,2*ie,2*de),ye.push(ai||[],G+1,2*ie,2*de+1),ye.push(Xi||[],G+1,2*ie+1,2*de),ye.push(gn||[],G+1,2*ie+1,2*de+1)}}getTile(V,G,ie){V=+V,G=+G,ie=+ie;const de=this.options,{extent:oe,debug:ge}=de;if(V<0||V>24)return null;const Se=1<<V,ye=Ts(V,G=G+Se&Se-1,ie);if(this.tiles[ye])return ml(this.tiles[ye],oe);ge>1&&console.log("drilling down to z%d-%d-%d",V,G,ie);let Te,Ue=V,Ce=G,ot=ie;for(;!Te&&Ue>0;)Ue--,Ce>>=1,ot>>=1,Te=this.tiles[Ts(Ue,Ce,ot)];return Te&&Te.source?(ge>1&&(console.log("found parent tile z%d-%d-%d",Ue,Ce,ot),console.time("drilling down")),this.splitTile(Te.source,Ue,Ce,ot,V,G,ie),ge>1&&console.timeEnd("drilling down"),this.tiles[ye]?ml(this.tiles[ye],oe):null):null}}function Ts(Me,V,G){return 32*((1<<Me)*G+V)+Me}function st(Me,V){const G=Me.tileID.canonical;if(!this._geoJSONIndex)return void V(null,null);const ie=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!ie)return void V(null,null);const de=ye=>ye.tags&&"3d_elevation_id"in ye.tags&&"source"in ye.tags&&ye.tags.source==="elevation",oe=ie.features.filter(ye=>de(ye));let ge;if(oe.length>0){const ye=ie.features.filter(Te=>!de(Te));ge=new ri({_geojsonTileLayer:ye,hd_road_elevation:oe})}else ge=new Qt(ie.features);let Se=Za(ge);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),V(null,{vectorTile:ge,rawData:Se.buffer})}class fo extends yi{constructor(V,G,ie,de,oe,ge,Se){super(V,G,ie,de,oe,st,Se),ge&&(this.loadGeoJSON=ge),this._dynamicIndex=new ci}loadData(V,G){const ie=V&&V.request,de=ie&&ie.collectResourceTiming;this.loadGeoJSON(V,(oe,ge)=>{if(oe||!ge)return G(oe);if(typeof ge!="object")return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{try{if(V.filter){const ye=o.X(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(Te=>`${Te.key}: ${Te.message}`).join(", "));ge.features=ge.features.filter(Te=>ye.value.evaluate({zoom:0},Te))}V.dynamic?(ge.type==="Feature"&&(ge={type:"FeatureCollection",features:[ge]}),V.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ge.features,this.loaded),V.cluster&&(ge.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=V.cluster?new po(function({superclusterOptions:ye,clusterProperties:Te}){if(!Te||!ye)return ye;const Ue={},Ce={},ot={accumulated:null,zoom:0},Tt={properties:null},Mt=Object.keys(Te);for(const qt of Mt){const[Zt,Xt]=Te[qt],_i=o.X(Xt),ai=o.X(typeof Zt=="string"?[Zt,["accumulated"],["get",qt]]:Zt);Ue[qt]=_i.value,Ce[qt]=ai.value}return ye.map=qt=>{Tt.properties=qt;const Zt={};for(const Xt of Mt)Zt[Xt]=Ue[Xt].evaluate(ot,Tt);return Zt},ye.reduce=(qt,Zt)=>{Tt.properties=Zt;for(const Xt of Mt)ot.accumulated=qt[Xt],qt[Xt]=Ce[Xt].evaluate(ot,Tt)},ye}(V)).load(ge.features):V.dynamic?this._dynamicIndex:function(ye,Te){return new Yc(ye,Te)}(ge,V.geojsonVtOptions)}catch(ye){return G(ye)}const Se={};if(de){const ye=_e(ie);ye&&(Se.resourceTiming={},Se.resourceTiming[V.source]=JSON.parse(JSON.stringify(ye)))}G(null,Se)}})}reloadTile(V,G){const ie=this.loaded;return ie&&ie[V.uid]?V.partial?G(null,void 0):super.reloadTile(V,G):this.loadTile(V,G)}loadGeoJSON(V,G){if(V.request)o.n(V.request,G);else{if(typeof V.data!="string")return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(V.data))}catch{return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ie){G(ie)}}getClusterChildren(V,G){try{G(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ie){G(ie)}}getClusterLeaves(V,G){try{G(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ie){G(ie)}}}class Vd{constructor(V,G,ie){this.tileID=new o.aM(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=V.projection,this.brightness=G,this.worldview=ie}parse(V,G,ie,de){this.status="parsing";const oe=new o.aM(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),ge=[],Se=G.familiesBySource[ie.source],ye=new o.f0(oe,ie.promoteId);ye.bucketLayerIDs=[],ye.is3DTile=!0,o.fi(V).then(Te=>{if(!Te)return de(new Error("Could not parse tile"));const Ue=Te.json.extensionsUsed&&Te.json.extensionsUsed.includes("MAPBOX_mesh_features")||Te.json.asset.extras&&Te.json.asset.extras.MAPBOX_mesh_features,Ce=Te.json.extensionsUsed&&Te.json.extensionsUsed.includes("EXT_meshopt_compression"),ot=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Tt in Se)for(const Mt of Se[Tt]){const qt=Mt[0];ye.bucketLayerIDs.push(Mt.map(_i=>o.C(_i.id,_i.scope))),qt.recalculate(ot,[]);const Zt=o.fj(Te,1/o.cU(ie.tileID.canonical)),Xt=new o.fk(Mt,Zt,oe,Ue,Ce,this.brightness,ye,this.worldview);Ue||(Xt.needsUpload=!0),ge.push(Xt),Xt.evaluate(qt)}this.status="done",de(null,{buckets:ge,featureIndex:ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Te=>de(new Error(Te.message)))}}class Mu{constructor(V,G,ie,de,oe,ge,Se,ye){this.actor=V,this.layerIndex=G,this.availableImages=ie,this.availableModels=de,this.brightness=Se,this.loading={},this.loaded={},this.worldview=ye}loadTile(V,G){const ie=V.uid,de=this.loading[ie]=new Vd(V,this.brightness,this.worldview);o.br(V.request,(oe,ge)=>{const Se=!this.loading[ie];return delete this.loading[ie],Se||oe?(de.status="done",Se||(this.loaded[ie]=de),G(oe)):ge&&ge.byteLength!==0?void de.parse(ge,this.layerIndex,V,(ye,Te)=>{de.status="done",this.loaded=this.loaded||{},this.loaded[ie]=de,ye||!Te?G(ye):G(null,Te)}):(de.status="done",this.loaded[ie]=de,G())})}reloadTile(V,G){const ie=this.loaded,de=V.uid;if(ie&&ie[de]){const oe=ie[de];oe.projection=V.projection,oe.brightness=V.brightness;const ge=(Se,ye)=>{oe.reloadCallback&&(delete oe.reloadCallback,this.loadTile(V,G)),G(Se,ye)};oe.status==="parsing"?oe.reloadCallback=ge:oe.status==="done"&&this.loadTile(V,G)}}abortTile(V,G){const ie=V.uid;this.loading[ie]&&delete this.loading[ie],G()}removeTile(V,G){const ie=this.loaded,de=V.uid;ie&&ie[de]&&delete ie[de],G()}}class Ci{constructor(V){this.self=V,this.actor=new o.fm(V,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.ce({name:"mercator"}),this.workerSourceTypes={vector:yi,geojson:fo,"raster-dem":Ee,"raster-array":Oe,"batched-model":Mu},this.workerSources={},this.self.registerWorkerSource=(G,ie)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=ie},this.self.registerRTLTextPlugin=G=>{if(o.fn.isParsed())throw new Error("RTL text plugin already registered.");o.fn.setState({pluginStatus:o.fo.parsed,pluginURL:o.fn.getPluginURL()}),o.fn.applyArabicShaping=G.applyArabicShaping,o.fn.processBidirectionalText=G.processBidirectionalText,o.fn.processStyledBidirectionalText=G.processStyledBidirectionalText;for(const ie of this.rtlPluginParsingListeners)ie(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(V,G,ie){delete this.layerIndexes[V],delete this.availableImages[V],delete this.availableModels[V],delete this.workerSources[V],ie()}checkIfReady(V,G,ie){ie()}setReferrer(V,G){this.referrer=G}spriteLoaded(V,G){this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={});const{scope:ie,isLoaded:de}=G;if(this.isSpriteLoaded[V][ie]=de,this.workerSources[V]&&this.workerSources[V][ie])for(const oe in this.workerSources[V][ie]){const ge=this.workerSources[V][ie][oe];for(const Se in ge){const ye=ge[Se];ye instanceof yi&&(ye.isSpriteLoaded=de,ye.fire(new o.A("isSpriteLoaded")))}}}setImages(V,G,ie){this.availableImages[V]||(this.availableImages[V]={});const{scope:de,images:oe}=G;if(this.availableImages[V][de]=oe,this.workerSources[V]&&this.workerSources[V][de]){for(const ge in this.workerSources[V][de]){const Se=this.workerSources[V][de][ge];for(const ye in Se)Se[ye].availableImages=oe}ie()}else ie()}setModels(V,{scope:G,models:ie},de){if(this.availableModels[V]||(this.availableModels[V]={}),this.availableModels[V][G]=ie,this.workerSources[V]&&this.workerSources[V][G]){for(const oe in this.workerSources[V][G]){const ge=this.workerSources[V][G][oe];for(const Se in ge)ge[Se].availableModels=ie}de()}else de()}setProjection(V,G){this.projections[V]=o.ce(G)}setBrightness(V,G,ie){this.brightness=G,ie()}setWorldview(V,G,ie){this.worldview=G,ie()}setLayers(V,G,ie){this.getLayerIndex(V,G.scope).replace(G.layers,G.options),ie()}updateLayers(V,G,ie){this.getLayerIndex(V,G.scope).update(G.layers,G.removedIds,G.options),ie()}loadTile(V,G,ie){G.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source,G.scope).loadTile(G,ie)}decodeRasterArray(V,G,ie){this.getWorkerSource(V,G.type,G.source,G.scope).decodeRasterArray(G,ie)}reloadTile(V,G,ie){G.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source,G.scope).reloadTile(G,ie)}abortTile(V,G,ie){this.getWorkerSource(V,G.type,G.source,G.scope).abortTile(G,ie)}removeTile(V,G,ie){this.getWorkerSource(V,G.type,G.source,G.scope).removeTile(G,ie)}removeSource(V,G,ie){if(!(this.workerSources[V]&&this.workerSources[V][G.scope]&&this.workerSources[V][G.scope][G.type]&&this.workerSources[V][G.scope][G.type][G.source]))return;const de=this.workerSources[V][G.scope][G.type][G.source];delete this.workerSources[V][G.scope][G.type][G.source],de.removeSource!==void 0?de.removeSource(G,ie):ie()}loadWorkerSource(V,G,ie){try{this.self.importScripts(G.url),ie()}catch(de){ie(de.toString())}}syncRTLPluginState(V,G,ie){if(o.fn.isParsed())ie(null,!0);else if(o.fn.isParsing())this.rtlPluginParsingListeners.push(ie);else try{o.fn.setState(G);const de=o.fn.getPluginURL();!o.fn.isLoaded()||o.fn.isParsed()||o.fn.isParsing()||de==null||(o.fn.setState({pluginStatus:o.fo.parsing,pluginURL:o.fn.getPluginURL()}),this.self.importScripts(de),o.fn.isParsed()?ie(null,!0):this.rtlPluginParsingListeners.push(ie))}catch(de){ie(de.toString())}}setDracoUrl(V,G){this.dracoUrl=G}getAvailableImages(V,G){this.availableImages[V]||(this.availableImages[V]={});let ie=this.availableImages[V][G];return ie||(ie=[]),ie}getAvailableModels(V,G){this.availableModels[V]||(this.availableModels[V]={});let ie=this.availableModels[V][G];return ie||(ie={}),ie}getLayerIndex(V,G){this.layerIndexes[V]||(this.layerIndexes[V]={});let ie=this.layerIndexes[V][G];return ie||(ie=this.layerIndexes[V][G]=new dt,ie.scope=G),ie}getWorkerSource(V,G,ie,de){const oe=this.workerSources;return oe[V]||(oe[V]={}),oe[V][de]||(oe[V][de]={}),oe[V][de][G]||(oe[V][de][G]={}),this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),oe[V][de][G][ie]||(oe[V][de][G][ie]=new this.workerSourceTypes[G]({send:(ge,Se,ye,Te,Ue,Ce)=>this.actor.send(ge,Se,ye,V,Ue,Ce),scheduler:this.actor.scheduler},this.getLayerIndex(V,de),this.getAvailableImages(V,de),this.getAvailableModels(V,de),this.isSpriteLoaded[V][de],void 0,this.brightness,this.worldview)),oe[V][de][G][ie]}rasterizeImagesWorker(V,G,ie){const de=new Map;for(const[oe,{image:ge,imageVariant:Se}]of G.tasks.entries()){const ye=this.imageRasterizer.rasterize(Se,ge,G.scope,V);de.set(oe,ye)}ie(void 0,de)}removeRasterizedImages(V,G,ie){this.imageRasterizer.removeImagesFromCacheByIds(G.imageIds,G.scope,V),ie()}enforceCacheSizeLimit(V,G){o.fp(G)}getWorkerPerformanceMetrics(V,G,ie){ie(void 0,void 0)}}return o.fl(self)&&(self.worker=new Ci(self)),Ci}),B(["./shared"],function(o){var _e="3.13.0";const Ie={create:"create",load:"load",fullLoad:"fullLoad"},pt={mark(l){performance.mark(l)},measure(l,t,a){performance.measure(l,t,a)}};function dt(l){const t=l.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var Xe,zt={},St=function(){if(Xe)return zt;function l(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,b=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(b);try{_=new Worker(x),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(x),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var b=_.getImageData(0,0,1,1);return b&&b.width===f.width}()?(a[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(a[p]=function(f){var _,b=function(x){var T=document.createElement("canvas"),M=Object.create(l.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=x,T.getContext("webgl2",M)}(f);if(!b)return!1;try{_=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!_||b.isContextLost())&&(b.shaderSource(_,"void main() {}"),b.compileShader(_),b.getShaderParameter(_,b.COMPILE_STATUS)===!0)}(p)),a[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}Xe=1,zt.supported=l,zt.notSupportedReason=t;var a={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},zt}();function He(l,t,a){const u=document.createElement(l);return t!=null&&(u.className=t),a&&a.appendChild(u),u}function yi(l,t,a){const u=document.createElementNS("http://www.w3.org/2000/svg",l);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return a&&a.appendChild(u),u}const Ee=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ae=Ee&&Ee.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Oe;function vt(){Ee&&Ae&&(Oe=Ee[Ae],Ee[Ae]="none")}function Ot(){Ee&&Ae&&(Ee[Ae]=Oe)}function Qt(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Qt,!0)}function ti(){window.addEventListener("click",Qt,!0),window.setTimeout(()=>{window.removeEventListener("click",Qt,!0)},0)}function ri(l,t){const a=l.getBoundingClientRect();return ci(l,a,t)}function oi(l,t){const a=l.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(ci(l,a,t[p]));return u}function Yt(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function ci(l,t,a){const u=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new o.P((a.clientX-t.left)*u,(a.clientY-t.top)*u)}const Bn="01",Ki="NO_ACCESS_TOKEN";class It{constructor(t,a,u){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let a="";for(let u=0;u<10;u++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Bn,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!o.j(t))return t;const u=Ui(t);return u.params.push(`sdk=js-${_e}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!o.j(t))return t;const u=Ui(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||a)}normalizeModelURL(t,a){if(!o.j(t))return t;const u=Ui(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||a)}normalizeSourceURL(t,a,u,p){if(!o.j(t))return t;const f=Ui(t);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),u&&f.params.push(`language=${u}`),p&&f.params.push(`worldview=${p}`),this._makeAPIURL(f,this._customAccessToken||a)}normalizeIconsetURL(t,a){const u=Ui(t);return o.j(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||a)):nn(u)}normalizeSpriteURL(t,a,u,p){const f=Ui(t);return o.j(t)?(f.path=`/styles/v1${f.path}/sprite${a}${u}`,this._makeAPIURL(f,this._customAccessToken||p)):(f.path+=`${a}${u}`,nn(f))}normalizeTileURL(t,a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.j(t))return t;const p=Ui(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||u&&p.authority!=="raster"&&u===512?"@2x":""}${o.l.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${o.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${o.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${o.e.TILE_URL_VERSION}${p.path}`);const f=this._customAccessToken||function(_){for(const b of _){const x=b.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(p.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,f)}canonicalizeTileURL(t,a){const u=Ui(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let f=u.params;return a&&(f=f.filter(_=>!_.match(/^access_token=/))),f.length&&(p+=`?${f.join("&")}`),p}canonicalizeTileset(t,a){const u=!!a&&o.j(a),p=[];for(const f of t.tiles||[])o.k(f)?p.push(this.canonicalizeTileURL(f,u)):p.push(f);return p}_makeAPIURL(t,a){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=Ui(o.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const f=t.params.indexOf("secure");f>=0&&t.params.splice(f,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return nn(t);if(a=a||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(f=>f.indexOf("access_token")===-1),t.params.push(`access_token=${a||""}`),nn(t)}}const wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ui(l){const t=l.match(wi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function nn(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const jt="mapbox.eventData";function bi(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.m(t[1]))}catch{return null}}class Ht{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=bi(o.e.ACCESS_TOKEN);let u="";return u=a&&a.u?o.f(a.u):o.e.ACCESS_TOKEN||"",t?`${jt}.${t}:${u}`:`${jt}:${u}`}fetchEventData(){const t=o.s("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));const f=localStorage.getItem(u);f&&(this.anonId=f)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const t=o.s("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,u,p){if(!o.e.EVENTS_URL)return;const f=Ui(o.e.EVENTS_URL);f.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(t).toISOString()},b=a?o.h(_,a):_,x={url:nn(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=o.p(x,T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(p)})}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const vn=new class extends Ht{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(a=>o.j(a)||o.k(a))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=bi(o.e.ACCESS_TOKEN),a=t?t.u:o.e.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(p),b=(p-this.eventData.lastSuccess)/864e5;u=u||b>=1||b<-1||f.getDate()!==_.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_e,skuId:Bn,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=p,this.eventData.tokenU=a)},l):this.processRequests()}},Wn=vn.postTurnstileEvent.bind(vn),Rr=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,a,u){this.skuToken=t,this.errorCb=u,o.e.EVENTS_URL&&(a||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},a):this.errorCb(new Error(Ki)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_e,skuId:Bn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},Za=Rr.postMapLoadEvent.bind(Rr),mn=new class extends Ht{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=o.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:a,style:u,importedStyles:p}=t;if(!o.e.EVENTS_URL||!l&&!o.e.ACCESS_TOKEN)return;const f=this.getMapInstanceId(a),_={mapInstanceId:f,eventId:this.getEventId(f),style:u};p.length&&(_.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:_},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},l)}},An=mn.postStyleLoadEvent.bind(mn),Un=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),u=function(p){const f=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),b=function(z){const O={};if(z){for(const N in z)if(N!=="other")for(const $ of z[N]){const U=`${N}ResolveRangeMin`,q=`${N}ResolveRangeMax`,Q=`${N}RequestCount`,ne=`${N}RequestCachedCount`;O[U]=Math.min(O[U]||1/0,$.startTime),O[q]=Math.max(O[q]||-1/0,$.responseEnd);const le=se=>{O[se]===void 0&&(O[se]=0),++O[se]};$.transferSize!==void 0&&$.transferSize===0&&le(ne),le(Q)}}return O}(function(z,O){const N={};if(z)for(const $ of z){const U=O($);N[U]===void 0&&(N[U]=[]),N[U].push($)}return N}(f,dt)),x=window.devicePixelRatio,T=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=T?T.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},C=(z,O,N)=>{N!=null&&z.push({name:O,value:N.toString()})};for(const z in b)C(I.counters,z,b[z]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(C(I.counters,"interactionRangeMin",p.interactionRange[0]),C(I.counters,"interactionRangeMax",p.interactionRange[1])),_)for(const z of Object.keys(Ie)){const O=Ie[z],N=_.find($=>$.name===O);N&&C(I.counters,O,N.startTime)}return C(I.counters,"visibilityHidden",p.visibilityHidden),C(I.attributes,"style",function(z){if(z)for(const O of z){const N=O.name.split("?")[0];if(o.i(N)){const $=N.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(f)),C(I.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),C(I.attributes,"fogEnabled",p.fogEnabled?"true":"false"),C(I.attributes,"projection",p.projection),C(I.attributes,"zoom",p.zoom),C(I.metadata,"devicePixelRatio",x),C(I.metadata,"connectionEffectiveType",M),C(I.metadata,"navigatorUserAgent",navigator.userAgent),C(I.metadata,"screenWidth",window.screen.width),C(I.metadata,"screenHeight",window.screen.height),C(I.metadata,"windowWidth",window.innerWidth),C(I.metadata,"windowHeight",window.innerHeight),C(I.metadata,"mapWidth",p.width/x),C(I.metadata,"mapHeight",p.height/x),C(I.metadata,"webglRenderer",p.renderer),C(I.metadata,"webglVendor",p.vendor),C(I.metadata,"sdkVersion",_e),C(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(a);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},l)}},br=Un.postPerformanceEvent.bind(Un),fn=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,a,u){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const p=Ui(o.e.API_URL+o.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||o.e.ACCESS_TOKEN||""}`);const f={url:nn(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(f,_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(u)})}getSessionAPI(l,t,a,u){this.skuToken=t,this.errorCb=u,o.e.SESSION_PATH&&o.e.API_URL&&(a||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},a):this.errorCb(new Error(Ki)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},ul=fn.getSessionAPI.bind(fn),po=new Set;function Br(l,t){t?po.add(l):po.delete(l)}class Jn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function cl(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class $o extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const u of a.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,a,p);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,u){this._validate(t,u)&&this.images.get(a).set(t.toString(),u)}_validate(t,a){let u=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||a<p[1])return!1;u=p[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,u){const p=this.images.get(a).get(t.toString());u.version=p.version+1,this.images.get(a).set(t.toString(),u),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const u=this.images.get(a),p=u.get(t.toString());u.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(a=>o.I.from(a))}getImages(t,a,u){const p=[],f=[],_=this.imageProviders.get(a);for(const M of t){if(!M.iconsetId){p.push(M);continue}const I=_.get(M.iconsetId);I&&(this.getImage(M,a)?f.push(M):I.addPendingRequest(M))}if(p.length===0)return void this._notify(f,a,u);let b=!0;const x=!!this.loaded.get(a),T=this.images.get(a);if(!x)for(const M of p)T.has(M.toString())||(b=!1);x||b?this._notify(p,a,u):this.requestors.push({ids:p,scope:a,callback:u})}rasterizeImages(t,a){const u=new Map,{tasks:p,scope:f}=t;for(const[_,b]of p.entries()){const x=this.getImage(b.id,f);x&&u.set(_,{image:x,imageVariant:b})}this._rasterizeImages(f,u,a)}_rasterizeImages(t,a,u){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},u);else{const p=new Map;for(const[f,{image:_,imageVariant:b}]of a.entries())p.set(f,this.imageRasterizer.rasterize(b,_,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,u){const p=this.images.get(a),f=new Map;for(const _ of t){if(!p.get(_.toString())){if(_.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:_.name}))}const b=p.get(_.toString());if(!b){o.w(`Image "${_.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const x={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)};b.usvg&&Object.assign(x,{width:b.icon.usvg_tree.width,height:b.icon.usvg_tree.height}),f.set(o.I.toString(_),x)}u(null,f)}getPixelSize(t){const{width:a,height:u}=this.atlasImage.get(t);return{width:a,height:u}}getPattern(t,a,u){const p=t.toString(),f=this.patterns.get(a),_=f.get(p),b=this.getImage(t,a);if(!b)return null;if(_){if(_.position.version===b.version)return _.position;_.position.version=b.version}else{if(b.usvg&&!b.data){const x=this.getPatternInFlightId(p,a);if(this.patternsInFlight.has(x))return null;this.patternsInFlight.add(x);const T=new o.B(t).scaleSelf(o.q.devicePixelRatio),M=new Map([[T.toString(),{image:b,imageVariant:T}]]);return this._rasterizeImages(a,M,(I,C)=>this.storePatternImage(T,a,b,u,C)),null}this.storePattern(t,a,b)}return this._updatePatternAtlas(a,u),f.get(p).position}getPatternInFlightId(t,a){return o.C(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,u,p,f){const _=t.toString(),b=f?f.get(_):void 0;b&&(u.data=b,this.storePattern(t.id,a,u),this._updatePatternAtlas(a,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,u){const p={w:u.data.width+2*o.F,h:u.data.height+2*o.F,x:0,y:0},f=new o.G(p,u,o.F);this.patterns.get(a).set(t.toString(),{bin:p,position:f})}bind(t,a){const u=t.gl;let p=this.atlasTexture.get(a);p?this.dirty&&(p.update(this.atlasImage.get(a)),this.dirty=!1):(p=new o.T(t,this.atlasImage.get(a),u.RGBA8),this.atlasTexture.set(a,p)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const u=this.patterns.get(t),p=Array.from(u.values()).map(({bin:T})=>T),{w:f,h:_}=o.H(p),b=this.atlasImage.get(t);b.resize({width:f||1,height:_||1});const x=this.images.get(t);for(const[T,{bin:M,position:I}]of u.entries()){let C=I.padding;const z=M.x+C,O=M.y+C,N=x.get(T).data,$=N.width,U=N.height;C=C>1?C-1:C,o.r.copy(N,b,{x:0,y:0},{x:z,y:O},{width:$,height:U},a),o.r.copy(N,b,{x:0,y:U-C},{x:z,y:O-C},{width:$,height:C},a),o.r.copy(N,b,{x:0,y:0},{x:z,y:O+U},{width:$,height:C},a),o.r.copy(N,b,{x:$-C,y:0},{x:z-C,y:O},{width:C,height:U},a),o.r.copy(N,b,{x:0,y:0},{x:z+$,y:O},{width:C,height:U},a),o.r.copy(N,b,{x:$-C,y:U-C},{x:z-C,y:O-C},{width:C,height:C},a),o.r.copy(N,b,{x:0,y:U-C},{x:z+$,y:O-C},{width:C,height:C},a),o.r.copy(N,b,{x:0,y:0},{x:z+$,y:O+U},{width:C,height:C},a),o.r.copy(N,b,{x:$-C,y:0},{x:z-C,y:O+U},{width:C,height:C},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const u=this.images.get(a);for(const p of t){if(this.callbackDispatchedThisFrame.get(a).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(p.toString());const f=u.get(p.toString());cl(f)&&this.updateImage(p,a,f)}}}function Da(l){const t=l.key,a=l.value,u=l.valueSpec||{},p=l.objectElementValidators||{},f=l.style,_=l.styleSpec;let b=[];const x=o.J(a);if(x!=="object")return[new o.V(t,a,`object expected, ${x} found`)];for(const T in a){const M=T.split(".")[0];let I;p[M]?I=p[M]:u[M]?I=xn:p["*"]?I=p["*"]:u["*"]&&(I=xn),I?b=b.concat(I({key:(t&&`${t}.`)+T,value:a[T],valueSpec:u[M]||u["*"],style:f,styleSpec:_,object:a,objectKey:T},a)):b.push(new o.K(t,a[T],`unknown property "${T}"`))}for(const T in u)p[T]||u[T].required&&u[T].default===void 0&&a[T]===void 0&&b.push(new o.V(t,a,`missing required property "${T}"`));return b}function ks(l){const t=l.value,a=l.valueSpec,u=l.style,p=l.styleSpec,f=l.key,_=l.arrayElementValidator||xn;if(o.J(t)!=="array")return[new o.V(f,t,`array expected, ${o.J(t)} found`)];if(a.length&&t.length!==a.length)return[new o.V(f,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new o.V(f,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let b={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};p.$version<7&&(b.function=a.function),o.J(a.value)==="object"&&(b=a.value);let x=[];for(let T=0;T<t.length;T++)x=x.concat(_({array:t,arrayIndex:T,value:t[T],valueSpec:b,style:u,styleSpec:p,key:`${f}[${T}]`},!0));return x}function Tu(l){const t=l.key,a=l.value,u=l.valueSpec;let p=o.J(a);if(p==="number"&&a!=a&&(p="NaN"),p!=="number")return[new o.V(t,a,`number expected, ${p} found`)];if("minimum"in u){let f=u.minimum;if(o.J(u.minimum)==="array"&&(f=u.minimum[l.arrayIndex]),a<f)return[new o.V(t,a,`${a} is less than the minimum value ${f}`)]}if("maximum"in u){let f=u.maximum;if(o.J(u.maximum)==="array"&&(f=u.maximum[l.arrayIndex]),a>f)return[new o.V(t,a,`${a} is greater than the maximum value ${f}`)]}return[]}function Ia(l){const t=l.valueSpec,a=o.M(l.value.type);let u,p,f,_={};const b=a!=="categorical"&&l.value.property===void 0,x=!b,T=o.J(l.value.stops)==="array"&&o.J(l.value.stops[0])==="array"&&o.J(l.value.stops[0][0])==="object",M=Da({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(z){if(a==="identity")return[new o.V(z.key,z.value,'identity function may not have a "stops" property')];let O=[];const N=z.value;return O=O.concat(ks({key:z.key,value:N,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:I})),o.J(N)==="array"&&N.length===0&&O.push(new o.V(z.key,N,"array must have at least one stop")),O},default:function(z){return xn({key:z.key,value:z.value,valueSpec:t,style:z.style,styleSpec:z.styleSpec})}}});return a==="identity"&&b&&M.push(new o.V(l.key,l.value,'missing required property "property"')),a==="identity"||l.value.stops||M.push(new o.V(l.key,l.value,'missing required property "stops"')),a==="exponential"&&l.valueSpec.expression&&!o.N(l.valueSpec)&&M.push(new o.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(x&&!o.O(l.valueSpec)?M.push(new o.V(l.key,l.value,"property functions not supported")):b&&!o.Q(l.valueSpec)&&M.push(new o.V(l.key,l.value,"zoom functions not supported"))),a!=="categorical"&&!T||l.value.property!==void 0||M.push(new o.V(l.key,l.value,'"property" property is required')),M;function I(z){let O=[];const N=z.value,$=z.key;if(o.J(N)!=="array")return[new o.V($,N,`array expected, ${o.J(N)} found`)];if(N.length!==2)return[new o.V($,N,`array length 2 expected, length ${N.length} found`)];if(T){if(o.J(N[0])!=="object")return[new o.V($,N,`object expected, ${o.J(N[0])} found`)];if(N[0].zoom===void 0)return[new o.V($,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new o.V($,N,"object stop key must have value")];const U=o.M(N[0].zoom);if(typeof U!="number")return[new o.V($,N[0].zoom,"stop zoom values must be numbers")];if(f&&f>U)return[new o.V($,N[0].zoom,"stop zoom values must appear in ascending order")];U!==f&&(f=U,p=void 0,_={}),O=O.concat(Da({key:`${$}[0]`,value:N[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Tu,value:C}}))}else O=O.concat(C({key:`${$}[0]`,value:N[0],style:z.style,styleSpec:z.styleSpec},N));return o.S(o.U(N[1]))?O.concat([new o.V(`${$}[1]`,N[1],"expressions are not allowed in function stops.")]):O.concat(xn({key:`${$}[1]`,value:N[1],valueSpec:t,style:z.style,styleSpec:z.styleSpec}))}function C(z,O){const N=o.J(z.value),$=o.M(z.value),U=z.value!==null?z.value:O;if(u){if(N!==u)return[new o.V(z.key,U,`${N} stop domain type must match previous stop domain type ${u}`)]}else u=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new o.V(z.key,U,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&a!=="categorical"){let q=`number expected, ${N} found`;return o.O(t)&&a===void 0&&(q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(z.key,U,q)]}return a!=="categorical"||N!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?a!=="categorical"&&N==="number"&&typeof $=="number"&&typeof p=="number"&&p!==void 0&&$<p?[new o.V(z.key,U,"stop domain values must appear in ascending order")]:(p=$,a==="categorical"&&$ in _?[new o.V(z.key,U,"stop domain values must be unique")]:(_[$]=!0,[])):[new o.V(z.key,U,`integer expected, found ${String($)}`)]}}function Ka(l){const t=(l.expressionContext==="property"?o.W:o.X)(o.U(l.value),l.valueSpec);if(t.result==="error")return t.value.map(u=>new o.V(`${l.key}${u.key}`,l.value,u.message));const a=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!a.outputDefined())return[new o.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!o.Y(a))return[new o.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return jo(a,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!o.Z(a,["zoom","feature-state"]))return[new o.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!o._(a))return[new o.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jo(l,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)a.delete(p);if(a.size===0)return[];const u=[];return l instanceof o.$&&a.has(l.name)?[new o.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(p=>{u.push(...jo(p,t))}),u)}function Vo(l){const t=l.key,a=l.value,u=l.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(o.M(a))===-1&&p.push(new o.V(t,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(u.values).indexOf(o.M(a))===-1&&p.push(new o.V(t,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function Uo(l){return o.a1(o.U(l.value))?Ka(o.L({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):za(l)}function za(l){const t=l.value,a=l.key;if(o.J(t)!=="array")return[new o.V(a,t,`array expected, ${o.J(t)} found`)];const u=l.styleSpec;let p,f=[];if(t.length<1)return[new o.V(a,t,"filter array must have at least 1 element")];switch(f=f.concat(Vo({key:`${a}[0]`,value:t[0],valueSpec:u.filter_operator,style:l.style,styleSpec:l.styleSpec})),o.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.M(t[1])==="$type"&&f.push(new o.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new o.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=o.J(t[1]),p!=="string"&&f.push(new o.V(`${a}[1]`,t[1],`string expected, ${p} found`)));for(let _=2;_<t.length;_++)p=o.J(t[_]),o.M(t[1])==="$type"?f=f.concat(Vo({key:`${a}[${_}]`,value:t[_],valueSpec:u.geometry_type,style:l.style,styleSpec:l.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&f.push(new o.V(`${a}[${_}]`,t[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)f=f.concat(za({key:`${a}[${_}]`,value:t[_],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":p=o.J(t[1]),t.length!==2?f.push(new o.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&f.push(new o.V(`${a}[1]`,t[1],`string expected, ${p} found`))}return f}function hl(l,t){const a=l.key,u=l.style,p=l.layer,f=l.styleSpec,_=l.value,b=l.objectKey,x=f[`${t}_${l.layerType}`];if(!x)return[];const T=b.match(/^(.*)-use-theme$/);if(t==="paint"&&T&&x[T[1]])return o.S(_)?[].concat(xn({key:l.key,value:_,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:b})):xn({key:a,value:_,valueSpec:{type:"string"},style:u,styleSpec:f});const M=b.match(/^(.*)-transition$/);if(t==="paint"&&M&&x[M[1]]&&x[M[1]].transition)return xn({key:a,value:_,valueSpec:f.transition,style:u,styleSpec:f});const I=l.valueSpec||x[b];if(!I)return[new o.K(a,_,`unknown property "${b}"`)];let C;if(o.J(_)==="string"&&o.O(I)&&!I.tokens&&(C=/^{([^}]+)}$/.exec(_))){const O=`\`{ "type": "identity", "property": ${C?JSON.stringify(C[1]):'"_"'} }\``;return[new o.V(a,_,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const z=[];if(l.layerType==="symbol")b!=="text-field"||!u||u.glyphs||u.imports||z.push(new o.V(a,_,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&o.a2(o.U(_))&&o.M(_.type)==="identity"&&z.push(new o.V(a,_,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&o.O(I)&&(o.a3(I)||o.Q(I))){const O=o.W(o.U(_),I),N=O.value.expression||O.value._styleExpression.expression;N&&!o.Z(N,["measure-light"])&&(b==="model-emissive-strength"&&o._(N)&&o.Y(N)||z.push(new o.V(a,_,`${b} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(xn({key:l.key,value:_,valueSpec:I,style:u,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:b}))}function dl(l){return hl(l,"paint")}function Xa(l){return hl(l,"layout")}function Pu(l){let t=[];const a=l.value,u=l.key,p=l.style,f=l.styleSpec;a.type||a.ref||t.push(new o.V(u,a,'either "type" or "ref" is required'));let _=o.M(a.type);const b=o.M(a.ref);if(a.id){const x=o.M(a.id);for(let T=0;T<l.arrayIndex;T++){const M=p.layers[T];o.M(M.id)===x&&t.push(new o.V(u,a.id,`duplicate layer id "${a.id}", previously used at line ${M.id.__line__}`))}}if("ref"in a){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in a&&t.push(new o.V(u,a[T],`"${T}" is prohibited for ref layers`))}),p.layers.forEach(T=>{o.M(T.id)===b&&(x=T)}),x?x.ref?t.push(new o.V(u,a.ref,"ref cannot reference another ref layer")):_=o.M(x.type):typeof b=="string"&&t.push(new o.V(u,a.ref,`ref layer "${b}" not found`))}else if(_!=="background"&&_!=="sky"&&_!=="slot")if(a.source){const x=p.sources&&p.sources[a.source],T=x&&o.M(x.type);x?T==="vector"&&_==="raster"?t.push(new o.V(u,a.source,`layer "${a.id}" requires a raster source`)):T==="raster"&&_!=="raster"?t.push(new o.V(u,a.source,`layer "${a.id}" requires a vector source`)):T!=="vector"||a["source-layer"]?T==="raster-dem"&&_!=="hillshade"?t.push(new o.V(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="raster-array"||["raster","raster-particle"].includes(_)?_==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&T==="geojson"&&!x.lineMetrics?t.push(new o.V(u,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):_==="raster-particle"&&T!=="raster-array"&&t.push(new o.V(u,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new o.V(u,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(u,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new o.V(u,a.source,`source "${a.source}" not found`))}else t.push(new o.V(u,a,'missing required property "source"'));return t=t.concat(Da({key:u,value:a,valueSpec:f.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xn({key:`${u}.type`,value:a.type,valueSpec:f.layer.type,style:l.style,styleSpec:l.styleSpec,object:a,objectKey:"type"}),filter:x=>Uo(o.L({layerType:_},x)),layout:x=>Da({layer:a,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":T=>Xa(o.L({layerType:_},T))}}),paint:x=>Da({layer:a,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":T=>dl(o.L({layerType:_,layer:a},T))}})}})),t}function mo(l){const t=l.value,a=l.key,u=o.J(t);return u!=="string"?[new o.V(a,t,`string expected, ${u} found`)]:[]}const pl={promoteId:function l({key:t,value:a}){if(o.J(a)==="string")return mo({key:t,value:a});if(Array.isArray(a)){const u=[],p=o.U(a),f=o.X(p);return f.result==="error"&&f.value.forEach(_=>{u.push(new o.V(`${t}${_.key}`,null,`${_.message}`))}),o.Z(f.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in a)u.push(...l({key:`${t}.${p}`,value:a[p]}));return u}}};function ka(l){const t=l.value,a=l.key,u=l.styleSpec,p=l.style;if(!t.type)return[new o.V(a,t,'"type" is required')];const f=o.M(t.type);let _=[];switch(["vector","raster","raster-dem","raster-array"].includes(f)&&(t.url||t.tiles||_.push(new o.K(a,t,'Either "url" or "tiles" is required.'))),f){case"vector":case"raster":case"raster-dem":case"raster-array":return _=_.concat(Da({key:a,value:t,valueSpec:u[`source_${f.replace("-","_")}`],style:l.style,styleSpec:u,objectElementValidators:pl})),_;case"geojson":if(_=Da({key:a,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:pl}),t.cluster)for(const b in t.clusterProperties){const[x,T]=t.clusterProperties[b],M=typeof x=="string"?[x,["accumulated"],["get",b]]:x;_.push(...Ka({key:`${a}.${b}.map`,value:T,expressionContext:"cluster-map"})),_.push(...Ka({key:`${a}.${b}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return _;case"video":return Da({key:a,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Da({key:a,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new o.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vo({key:`${a}.type`,value:t.type,valueSpec:{values:vr(u)}})}}function vr(l){return l.source.reduce((t,a)=>{const u=l[a];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function As(l){const t=l.value,a=l.styleSpec,u=a.light,p=l.style;let f=[];const _=o.J(t);if(t===void 0)return f;if(_!=="object")return f=f.concat([new o.V("light",t,`object expected, ${_} found`)]),f;for(const b in t){const x=b.match(/^(.*)-transition$/),T=b.match(/^(.*)-use-theme$/);f=f.concat(T&&u[T[1]]?xn({key:b,value:t[b],valueSpec:{type:"string"},style:p,styleSpec:a}):x&&u[x[1]]&&u[x[1]].transition?xn({key:b,value:t[b],valueSpec:a.transition,style:p,styleSpec:a}):u[b]?xn({key:b,value:t[b],valueSpec:u[b],style:p,styleSpec:a}):[new o.V(b,t[b],`unknown property "${b}"`)])}return f}function Jo(l){const t=l.value;let a=[];if(!t)return a;const u=o.J(t);if(u!=="object")return a=a.concat([new o.V("light-3d",t,`object expected, ${u} found`)]),a;const p=l.styleSpec,f=p["light-3d"],_=l.key,b=l.style,x=l.style.lights;for(const I of["type","id"])if(!(I in t))return a=a.concat([new o.V("light-3d",t,`missing property ${I} on light`)]),a;if(t.type&&x)for(let I=0;I<l.arrayIndex;I++){const C=o.M(t.type),z=x[I];o.M(z.type)===C&&a.push(new o.V(_,t.id,`duplicate light type "${t.type}", previously defined at line ${z.id.__line__}`))}const T=`properties_light_${t.type}`;if(!(T in p))return a=a.concat([new o.V("light-3d",t,`Invalid light type ${t.type}`)]),a;const M=p[T];for(const I in t)if(I==="properties"){const C=t[I],z=o.J(C);if(z!=="object")return a=a.concat([new o.V("properties",C,`object expected, ${z} found`)]),a;for(const O in C){const N=O.match(/^(.*)-transition$/),$=O.match(/^(.*)-use-theme$/);a=a.concat($&&M[$[1]]?xn({key:I,value:C[O],valueSpec:{type:"string"},style:b,styleSpec:p}):N&&M[N[1]]&&M[N[1]].transition?xn({key:I,value:t[I],valueSpec:p.transition,style:b,styleSpec:p}):M[O]?xn({key:O,value:C[O],valueSpec:M[O],style:b,styleSpec:p}):[new o.K(l.key,C[O],`unknown property "${O}"`)])}}else a=a.concat(f[I]?xn({key:I,value:t[I],valueSpec:f[I],style:b,styleSpec:p}):[new o.K(I,t[I],`unknown property "${I}"`)]);return a}function Ss(l){const t=l.value,a=l.key,u=l.style,p=l.styleSpec,f=p.terrain;let _=[];const b=o.J(t);if(t===void 0||b==="null")return _;if(b!=="object")return _=_.concat([new o.V("terrain",t,`object expected, ${b} found`)]),_;for(const x in t){const T=x.match(/^(.*)-transition$/),M=x.match(/^(.*)-use-theme$/);_=_.concat(M&&f[M[1]]?xn({key:x,value:t[x],valueSpec:{type:"string"},style:u,styleSpec:p}):T&&f[T[1]]&&f[T[1]].transition?xn({key:x,value:t[x],valueSpec:p.transition,style:u,styleSpec:p}):f[x]?xn({key:x,value:t[x],valueSpec:f[x],style:u,styleSpec:p}):[new o.K(x,t[x],`unknown property "${x}"`)])}if(t.source){const x=u.sources&&u.sources[t.source],T=x&&o.M(x.type);x?T!=="raster-dem"&&_.push(new o.V(a,t.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):_.push(new o.V(a,t.source,`source "${t.source}" not found`))}else _.push(new o.V(a,t,'terrain is missing required property "source"'));return _}function qo(l){const t=l.value,a=l.style,u=l.styleSpec,p=u.fog;let f=[];const _=o.J(t);if(t===void 0)return f;if(_!=="object")return f=f.concat([new o.V("fog",t,`object expected, ${_} found`)]),f;for(const b in t){const x=b.match(/^(.*)-transition$/),T=b.match(/^(.*)-use-theme$/);f=f.concat(T&&p[T[1]]?xn({key:b,value:t[b],valueSpec:{type:"string"},style:a,styleSpec:u}):x&&p[x[1]]&&p[x[1]].transition?xn({key:b,value:t[b],valueSpec:u.transition,style:a,styleSpec:u}):p[b]?xn({key:b,value:t[b],valueSpec:p[b],style:a,styleSpec:u}):[new o.K(b,t[b],`unknown property "${b}"`)])}return f}const ml={"*":()=>[],array:ks,boolean:function(l){const t=l.value,a=l.key,u=o.J(t);return u!=="boolean"?[new o.V(a,t,`boolean expected, ${u} found`)]:[]},number:Tu,color:function(l){const t=l.key,a=l.value,u=o.J(a);return u!=="string"?[new o.V(t,a,`color expected, ${u} found`)]:o.a0.parseCSSColor(a)===null?[new o.V(t,a,`color expected, "${a}" found`)]:[]},enum:Vo,filter:Uo,function:Ia,layer:Pu,object:Da,source:ka,model:o.a4,light:As,"light-3d":Jo,terrain:Ss,fog:qo,string:mo,formatted:function(l){return mo(l).length===0?[]:Ka(l)},resolvedImage:function(l){return mo(l).length===0?[]:Ka(l)},projection:function(l){const t=l.value,a=l.styleSpec,u=a.projection,p=l.style;let f=[];const _=o.J(t);if(_==="object")for(const b in t)f=f.concat(xn({key:b,value:t[b],valueSpec:u[b],style:p,styleSpec:a}));else _!=="string"&&(f=f.concat([new o.V("projection",t,`object or string expected, ${_} found`)]));return f},import:function(l){const{value:t,styleSpec:a}=l,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let f=Da(o.L({},l,{value:p,valueSpec:a.import}));return o.M(p.id)===""&&f.push(new o.V(`${l.key}.id`,p,"import id can't be an empty string")),u&&(f=f.concat(fl(u,a,{key:`${l.key}.data`}))),f},iconset:function(l){const t=l.value,a=l.key,u=l.styleSpec,p=l.style;if(!t.type)return[new o.V(a,t,'"type" is required')];const f=o.M(t.type);let _=[];if(_=_.concat(Da({key:a,value:t,valueSpec:u[`iconset_${f}`],style:p,styleSpec:u})),f==="source"&&t.source){const b=p.sources&&p.sources[t.source],x=b&&o.M(b.type);b?x!=="raster-array"&&_.push(new o.V(a,t.source,`iconset cannot be used with a source of type ${String(x)}, it only be used with a "raster-array" source type`)):_.push(new o.V(a,t.source,`source "${t.source}" not found`))}return _}};function xn(l,t=!1){const a=l.value,u=l.valueSpec,p=l.styleSpec;if(u.expression&&o.a2(o.M(a)))return Ia(l);if(u.expression&&o.S(o.U(a)))return Ka(l);if(u.type&&ml[u.type]){const f=ml[u.type](l);return t===!0&&f.length>0&&o.J(l.value)==="array"?Ka(l):f}return Da(o.L({},l,{valueSpec:u.type?p[u.type]:u}))}function Go(l){const t=l.value,a=l.key,u=mo(l);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new o.V(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new o.V(a,t,'"glyphs" url must include a "{range}" token'))),u}function fl(l,t=o.a5,a={}){return xn({key:a.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:Go,"*":()=>[]}})}function Qa(l,t=o.a5){return de(fl(l,t))}const jd=l=>de(ka(l)),Yc=l=>de(As(l)),Ts=l=>de(Jo(l)),st=l=>de(Ss(l)),fo=l=>de(qo(l)),Vd=l=>de(function(t){const a=t.value,u=t.style,p=t.styleSpec,f=p.snow;let _=[];const b=o.J(a);if(a===void 0)return _;if(b!=="object")return _=_.concat([new o.V("snow",a,`object expected, ${b} found`)]),_;for(const x in a){const T=x.match(/^(.*)-transition$/);_=_.concat(T&&f[T[1]]&&f[T[1]].transition?xn({key:x,value:a[x],valueSpec:p.transition,style:u,styleSpec:p}):f[x]?xn({key:x,value:a[x],valueSpec:f[x],style:u,styleSpec:p}):[new o.K(x,a[x],`unknown property "${x}"`)])}return _}(l)),Mu=l=>de(function(t){const a=t.value,u=t.style,p=t.styleSpec,f=p.rain;let _=[];const b=o.J(a);if(a===void 0)return _;if(b!=="object")return _=_.concat([new o.V("rain",a,`object expected, ${b} found`)]),_;for(const x in a){const T=x.match(/^(.*)-transition$/);_=_.concat(T&&f[T[1]]&&f[T[1]].transition?xn({key:x,value:a[x],valueSpec:p.transition,style:u,styleSpec:p}):f[x]?xn({key:x,value:a[x],valueSpec:f[x],style:u,styleSpec:p}):[new o.K(x,a[x],`unknown property "${x}"`)])}return _}(l)),Ci=l=>de(Pu(l)),Me=l=>de(Uo(l)),V=l=>de(dl(l)),G=l=>de(Xa(l)),ie=l=>de(o.a4(l));function de(l){return l.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function oe(l,t){let a=!1;if(t&&t.length)for(const u of t)u instanceof o.K?o.w(u.message):(l.fire(new o.z(new Error(u.message))),a=!0);return a}let ge;class Se extends o.E{constructor(t,a="flat"){super(),this._transitionable=new o.a6(ge||(ge=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,u={}){this._validate(Yc,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&oe(this,t.call(Qa,o.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let ye=class extends o.E{constructor(l,t,a,u,p){super(),this.scope=a,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),a,u),this._transitionable.setTransitionOrValue(l,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=p}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new o.aa(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let a=-1,u=-1,p=1;for(const f of t.zoomStops)p=t.evaluate(new o.aa(f,{worldview:this.worldview})),p>.01?(a=f,u=-1):u=f;return p<.01&&a>0&&u>a?[a,u]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof o.ab}};const Te=45,Ue=65,Ce=.05;function ot(l,t,a,u){const p=o.af(Te,Ue,a),[f,_]=Tt(l,u);let b=1-Math.min(1,Math.exp((t-f)/(_-f)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*p*l.alpha}function Tt(l,t){const a=.5/Math.tan(.5*t);return[l.range[0]+a,l.range[1]+a]}function Mt(l,t,a,u,p){const f=o.ad([],[t,a,u],p.mercatorFogMatrix);return ot(l,o.ae(f),p.pitch,p._fov)}function qt(l,t,a,u,p,f,_){const b=[[a,u,0],[p,u,0],[p,f,0],[a,f,0]];let x=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(const M of b){const I=o.ad([],M,t),C=o.ae(I);x=Math.min(x,C),T=Math.max(T,C)}return[ot(l,x,_.pitch,_._fov),ot(l,T,_.pitch,_._fov)]}class Zt extends o.E{constructor(t,a,u,p){super();const f=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(f,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new o.ag(f),this.scope=u}get state(){const t=this._transform,a=t.projection.name==="globe",u=o.ah(t.zoom),p=this.properties.get("range"),f=[.5,3];return{range:a?[o.ai(f[0],p[0],u),o.ai(f[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,u={}){if(this._validate(fo,t,u))return;const p=o.h({},t);for(const f of Object.keys(o.a5.fog))p[f]===void 0&&(p[f]=o.a5.fog[f].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(Te,Ue,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(u,p,f){const _=o.ac.fromLngLat(p),b=f.elevation?f.elevation.getAtPointOrZero(_):0;return Mt(u,_.x,_.y,b,f)}(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return qt(this.state,a,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(t,a,u,p,f){return this._transform.projection.supportsFog?qt(this.state,t,a,u,p,f,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Tt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const u of a){const p=t.points[u];let f;if(p[2]>=0)f=p;else{const _=t.points[u-4];f=o.ak(_,p,_[2]/(_[2]-p[2]))}if(Mt(this.state,f[0],f[1],0,this._transform)>=Ce)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&oe(this,t.call(Qa,o.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Xt,_i,ai,Xi,gn=class extends o.E{constructor(l,t,a,u){super();const p=Xt||(Xt=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(p,a,new Map(u)),this.set(l,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(p),this.scope=a}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),u=o.al(a[0]),p=-Math.max(o.al(a[1]),.01),f=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],_=this.properties.get("vignette"),b=this.properties.get("vignette-color");return b.a=_,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(t.r,t.g,t.b,t.a*l),direction:f,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(l,t,a={}){if(this._validate(Vd,l,a))return;const u=o.h({},l);for(const p of Object.keys(o.a5.snow))u[p]===void 0&&(u[p]=o.a5.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,a){return(!a||a.validate!==!1)&&oe(this,l.call(Qa,o.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},_n=class extends o.E{constructor(l,t,a,u){super();const p=_i||(_i=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(p,a,new Map(u)),this.set(l,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(p),this.scope=a}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),u=o.al(a[0]),p=-Math.max(o.al(a[1]),.01),f=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],_=this.properties.get("vignette-color");return _.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(t.r,t.g,t.b,t.a*l),direction:f,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:_}}get(){return this._transitionable.serialize()}set(l,t,a={}){if(this._validate(Mu,l,a))return;const u=o.h({},l);for(const p of Object.keys(o.a5.rain))u[p]===void 0&&(u[p]=o.a5.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,a){return(!a||a.validate!==!1)&&oe(this,l.call(Qa,o.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class $i extends o.E{constructor(t,a,u,p){super(),this.scope=u,this._options=t,this.properties=new o.ag(a),this._transitionable=new o.a6(a,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ii{constructor(t,a,u,p){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,a){let u,p;if(t instanceof o.P||typeof t[0]=="number"){const f=o.P.convert(t);u=[f],p=a.isPointAboveHorizon(f)}else{const f=o.P.convert(t[0]),_=o.P.convert(t[1]),b=f.add(_)._div(2);u=[f,_],p=o.ao(f,_).every(x=>a.isPointAboveHorizon(x))&&a.isPointAboveHorizon(b)}return new Ii(u,a.getCameraPoint(),p,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.ao(a,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(p[3]=this.cameraPoint)),o.ap(p,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.ao(a,u,t),f=this.cameraPoint.clone();switch(3*((f.y>a.y)+(f.y>u.y))+((f.x>a.x)+(f.x>u.x))){case 0:p[0]=f,p[4]=f.clone();break;case 1:p.splice(1,0,f);break;case 2:p[1]=f;break;case 3:p.splice(4,0,f);break;case 5:p.splice(2,0,f);break;case 6:p[3]=f;break;case 7:p.splice(3,0,f);break;case 8:p[2]=f}return p}containsTile(t,a,u,p=0){const f=t.queryPadding/a._pixelsPerMercatorPixel+1,_=u?this._bufferedCameraMercator(f,a):this._bufferedScreenMercator(f,a);let b=t.tileID.wrap+(_.unwrapped?p:0);const x=_.polygon.map($=>o.aq(t.tileTransform,$,b));if(!o.ar(x,0,0,o.aj,o.aj))return;b=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const T=this.screenGeometryMercator.polygon.map($=>o.as(t.tileTransform,$,b)),M=T.map($=>new o.P($[0],$[1])),I=a.getFreeCameraOptions().position||new o.ac(0,0,0),C=o.as(t.tileTransform,I,b),z=T.map($=>{const U=o.at($,$,C);return o.au(U,U),new o.av(C,U)}),O=o.aw(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:z,bufferedTilespaceGeometry:x,bufferedTilespaceBounds:(N=o.ax(x),N.min.x=o.ay(N.min.x,0,o.aj),N.min.y=o.ay(N.min.y,0,o.aj),N.max.x=o.ay(N.max.x,0,o.aj),N.max.y=o.ay(N.max.y,0,o.aj),N),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:O};var N}_bufferedScreenMercator(t,a){const u=Sn(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(f=>a.pointCoordinate3D(f)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,a){const u=Sn(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(f=>a.pointCoordinate3D(f)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,a){const u=function(f,_){const b=o.az([],_.pixelMatrix,_.globeMatrix),x=[0,-o.aB,0,1],T=[0,o.aB,0,1],M=[0,0,0,1];o.aA(x,x,b),o.aA(T,T,b),o.aA(M,M,b);const I=new o.P(x[0]/x[3],x[1]/x[3]),C=new o.P(T[0]/T[3],T[1]/T[3]),z=o.aC(f,I)&&x[3]<M[3],O=o.aC(f,C)&&T[3]<M[3];if(!z&&!O)return null;const N=function(re,ae,ue){for(let he=1;he<re.length;he++){const xe=En(ae.pointCoordinate3D(re[he-1]).x),ke=En(ae.pointCoordinate3D(re[he]).x);if(ue<0){if(xe<ke)return{idx:he,t:-xe/(ke-1-xe)}}else if(ke<xe)return{idx:he,t:(1-xe)/(ke+1-xe)}}return null}(f,_,z?-1:1);if(!N)return null;const{idx:$,t:U}=N;let q=$>1?Nn(f.slice(0,$),_):[],Q=$<f.length?Nn(f.slice($),_):[];q=q.map(re=>new o.P(En(re.x),re.y)),Q=Q.map(re=>new o.P(En(re.x),re.y));const ne=[...q];ne.length===0&&ne.push(Q[Q.length-1]);const le=o.ai(ne[ne.length-1].y,(Q.length===0?q[0]:Q[0]).y,U);let se;return se=z?[new o.P(0,le),new o.P(0,0),new o.P(1,0),new o.P(1,le)]:[new o.P(1,le),new o.P(1,1),new o.P(0,1),new o.P(0,le)],ne.push(...se),Q.length===0?ne.push(q[0]):ne.push(...Q),{polygon:ne.map(re=>new o.ac(re.x,re.y)),unwrapped:!1}}(t,a);if(u)return u;const p=function(f,_){let b=!1,x=-1/0,T=0;for(let I=0;I<f.length-1;I++)f[I].x>x&&(x=f[I].x,T=I);for(let I=0;I<f.length-1;I++){const C=(T+I)%(f.length-1),z=f[C],O=f[C+1];Math.abs(z.x-O.x)>.5&&(z.x<O.x?(z.x+=1,C===0&&(f[f.length-1].x+=1)):(O.x+=1,C+1===f.length-1&&(f[0].x+=1)),b=!0)}const M=o.aD(_.center.lng);return b&&M<Math.abs(M-1)&&f.forEach(I=>{I.x-=1}),{polygon:f,unwrapped:b}}(Nn(t,a).map(f=>new o.P(En(f.x),f.y)),a);return{polygon:p.polygon.map(f=>new o.ac(f.x,f.y)),unwrapped:p.unwrapped}}}function Nn(l,t){return o.aE(l,a=>{const u=t.pointCoordinate3D(a);a.x=u.x,a.y=u.y},1/256)}function En(l){return l<0?1+l%1:l%1}function Sn(l){return 100*l|0}function ua(l,t,a,u,p){const f=function(b,x){if(b)return p(b);if(x){if(l.url&&x.tiles&&l.tiles&&delete l.tiles,x.variants){if(!Array.isArray(x.variants))return p(new Error("variants must be an array"));for(const M of x.variants){if(M==null||typeof M!="object"||M.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(M.capabilities))return p(new Error("capabilities must be an array"));if(M.capabilities.length===1&&M.capabilities[0]==="meshopt"){x=o.h(x,M);break}}}const T=o.aF(o.h({},x,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);T.tiles=t.canonicalizeTileset(T,l.url),p(null,T)}},_=function(b,x,T){if(!b)return null;if(!x&&!T)return b;T=T||b.worldview_default;const M=Object.values(b.language||{});if(M.length===0)return null;const I=Object.values(b.worldview||{});if(I.length===0)return null;const C=M.every(O=>O===x),z=I.every(O=>O===T);return C&&z?b:x in(b.language_options||{})||T in(b.worldview_options||{})?null:b.language_options&&b.worldview_options?b:null}(l.data,a,u);return _?o.q.frame(()=>f(null,_)):l.url?o.n(t.transformRequest(t.normalizeSourceURL(l.url,null,a,u),o.R.Source),f):o.q.frame(()=>{const{data:b,...x}=l;f(null,x)})}function ja(l,t){const a=Math.pow(2,t.z),u=Math.floor(o.aD(l.getWest())*a),p=Math.floor(o.aH(l.getNorth())*a),f=Math.ceil(o.aD(l.getEast())*a),_=Math.ceil(o.aH(l.getSouth())*a);return t.x>=u&&t.x<f&&t.y>=p&&t.y<_}class Aa{constructor(t,a,u){this.bounds=t?o.aG.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(o.aG.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!ja(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(ja(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new Aa(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class Eu extends o.E{constructor(t,a,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(a,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.aI}load(t){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=ua(this._options,this.map._requestManager,a,u,(p,f)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.z(p));else if(f){if(o.h(this,f),this.hasWorldviews=!!f.worldview_options,f.worldview_default&&(this.worldviewDefault=f.worldview_default),f.vector_layers){this.vectorLayers=f.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const _ of f.vector_layers)this.vectorLayerIds.push(_.id),f.worldview&&f.worldview[_.source]&&this.localizableLayerIds.add(_.id)}this.tileBounds=Aa.fromTileJSON(f),Wn(f.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),f=this.map._requestManager.transformRequest(p,o.R.Tile),_=this.map.style?this.map.style.getLut(this.scope):null,b=_?{image:_.image.clone()}:null,x={request:f,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:b,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(u)&&(x.localizableLayerIds=this.localizableLayerIds),x.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",x,T.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",x,T.bind(this),void 0,!0);else{const M=o.aJ.call({deduped:this._deduped},x,(I,C)=>{I||!C?T.call(this,I):(x.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},t.actor&&t.actor.send("loadTile",x,T.bind(this),void 0,!0))},!0);t.request={cancel:M}}function T(M,I){return delete t.request,t.aborted?a(null):M&&M.status!==404?a(M):(I&&I.resourceTiming&&(t.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&t.setExpiryData(I),t.loadVectorData(I,this.map.painter),o.aK(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pa extends o.E{constructor(t,a,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},a),o.h(this,o.aF(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=ua(this._options,this.map._requestManager,null,a,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new o.z(u)):p&&(o.h(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(f=>f.id)),this.tileBounds=Aa.fromTileJSON(p),Wn(p.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(u)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const u=o.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=o.o(this.map._requestManager.transformRequest(p,o.R.Tile),(f,_,b,x)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):f?(t.state="errored",a(f)):_?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:b,expires:x}),t.setTexture(_,this.map.painter),t.state="loaded",o.aK(this.dispatcher),void a(null)):a(null)))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof o.T?(t.destroy(!0),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Yo extends pa{constructor(t,a,u,p){super(t,a,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);a&&a.enabled&&u&&a._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,o.R.Tile),f={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const _=(b,x,T,M)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(b)return b.name==="AbortError"?void 0:(t.state="errored",a(b));if(this.map._refreshExpiredTiles&&x&&t.setExpiryData({cacheControl:T,expires:M}),this.partial)t.state="empty";else{if(!x)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=x}a(null)};t.request=this.partial?t.fetchHeader(void 0,_.bind(this)):t.actor.send("loadTile",f,_.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const u=t.texture;u&&u instanceof o.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,a,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(a,u,(p,f)=>{if(p)return t.state="errored",this.fire(new o.z(p)),void this.triggerRepaint(t);f&&(t._isHeaderLoaded=!0,t.setTexture(f,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:f})=>f===t),u=a&&a.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,a,u){if(!t)return;const p=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let f=null;a instanceof o.aN?f=a.paint.get("raster-array-band"):a instanceof o.aO&&(f=a.paint.get("raster-particle-array-band"));const _=f||this.getInitialBand(p);if(_!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,_)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,_)}getImages(t,a){const u=new Map;for(const p of t)for(const f of a){const[_,b]=f.split("/"),x=p.getLayer(_);if(!x||!x.hasBand(b)||!x.hasDataForBand(b))continue;const{bytes:T,tileSize:M,buffer:I}=x.getBandView(b),C=M+2*I,z={data:new o.r({width:C,height:C},T),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(f,z)}return u}}const Hc={vector:Eu,raster:pa,"raster-dem":class extends pa{constructor(l,t,a,u){super(l,t,a,u),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const a=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,f){p&&(l.state="errored",t(p)),f&&(l.dem=f,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=o.o(this.map._requestManager.transformRequest(a,o.R.Tile),(function(p,f,_,b){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(p)l.state="errored",t(p);else if(f){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:_,expires:b});const x=ImageBitmap&&f instanceof ImageBitmap&&o.t(),T=1-(f.width-o.aL(f.width))/2;T<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const M=x?f:o.q.getImageData(f,T),I={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:M,encoding:this.encoding,padding:T};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",I,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,a=Math.pow(2,t.z),u=(t.x-1+a)%a,p=t.x===0?l.wrap-1:l.wrap,f=(t.x+1+a)%a,_=t.x+1===a?l.wrap+1:l.wrap,b={};return b[new o.aM(l.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},b[new o.aM(l.overscaledZ,_,t.z,f,t.y).key]={backfilled:!1},t.y>0&&(b[new o.aM(l.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},b[new o.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new o.aM(l.overscaledZ,_,t.z,f,t.y-1).key]={backfilled:!1}),t.y+1<a&&(b[new o.aM(l.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},b[new o.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new o.aM(l.overscaledZ,_,t.z,f,t.y+1).key]={backfilled:!1}),b}},"raster-array":Yo,geojson:class extends o.E{constructor(l,t,a,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(u),this._data=t.data,this._options=o.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of l.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,a,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:a},u),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=o.h({append:l},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(o.q.resolveURL(a),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new o.z(u));else{const f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(f.resourceTiming=p.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new o.A("data",f)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const l=o.C(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const a=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,f=this._partialReload,_={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:f,worldview:this.map.getWorldview()};l.request=this.actor.send(a,_,(b,x)=>f&&!x?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):b?t(b):(l.loadVectorData(x,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(l,t,a,u){super(l,t,a,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aQ(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new o.z(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(l,t,a,u){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const a=this._options.models[t],u=o.aS(this.map._requestManager.transformRequest(a.uri,o.R.Model).url).then(p=>{if(!p)return;const f=o.aT(p),_=new o.aU(t,a.position,a.orientation,f);_.computeBoundsAndApplyParent(),this.models.push(_)}).catch(p=>{this.fire(new o.z(new Error(`Could not load model ${t} from ${a.uri}: ${p.message}`)))});l.push(u)}Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(l,t,a,u){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=ua(this._options,this.map._requestManager,t,a,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new o.z(u))):p&&(o.h(this,p),p.bounds&&(this.tileBounds=new Aa(p.bounds,this.minzoom,this.maxzoom)),Wn(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const a=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(a,o.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const f=Object.values(l.buckets);for(const _ of f)_.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",u,p.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(f,_){return l.aborted?t(null):f&&f.status!==404?t(f):(this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadModelData(_,this.map.painter),l.state="loaded",void t(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(l,t,a,u){super(l,t,a,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(f=>typeof f!="number"))||this.fire(new o.z(new o.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.E{constructor(l,t,a,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Aa(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:a,z:u}=l.canonical;return this._implementation.hasTile({x:t,y:a,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:a,y:u,z:p}=l.tileID.canonical,f=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:a,y:u,z:p},{signal:f.signal})).then((function(_){return delete l.request,l.aborted?(l.state="unloaded",t(null)):_===void 0?(l.state="errored",t(null)):_===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(b){return b instanceof ImageData||b instanceof HTMLCanvasElement||b instanceof ImageBitmap||b instanceof HTMLImageElement}(_)?(this.loadTileData(l,_),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(_=>{_.name!=="AbortError"&&(l.state="errored",t(_))}),l.request.cancel=()=>f.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof o.T?(l.destroy(!0),l.texture&&l.texture instanceof o.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:a,y:u,z:p}=l.tileID.canonical;this._implementation.unloadTile({x:a,y:u,z:p})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=o.C(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},Cu=function(l,t,a,u){const p=new Hc[t.type](l,t,a,u);if(p.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${p.id}`);return o.aV(["load","abort","unload","serialize","prepare"],p),p};function Du(l,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:f}=u;return`featureset:${p}${f?`:import:${f}`:""}`}}(l.target)}`}function Zc(l,t,a,u=""){if(l.uniqueFeatureID){const p=Du(l,t,u);if(a.has(p))return!0;a.add(p)}return!1}function Kc(l,t,a,u,p=!1){const f=t.sourceCache.transform,_=t.sourceCache.tilesIn(l,t.has3DLayers,p);_.sort(Xc);const b=[];for(const x of _){const T=x.tile.queryRenderedFeatures(t,x,a,u,f,p);Object.keys(T).length&&b.push({wrappedTileID:x.tile.tileID.wrapped().key,queryResults:T})}return b.length===0?{}:function(x){const T={},M={};for(const I of x){const C=I.queryResults,z=I.wrappedTileID,O=M[z]=M[z]||{};for(const N in C){const $=C[N],U=O[N]=O[N]||{},q=T[N]=T[N]||[];for(const Q of $)U[Q.featureIndex]||(U[Q.featureIndex]=!0,q.push(Q))}}return T}(b)}function Ps(l,t,a,u,p,f){const _={},b=u.queryRenderedSymbols(l),x=[];for(const T of Object.keys(b).map(Number))x.push(p[T]);x.sort(Xc);for(const T of x){const M=T.featureIndex.lookupSymbolFeatures(b[T.bucketInstanceId],T.bucketIndex,T.sourceLayerIndex,t,a,f);for(const I in M){const C=_[I]=_[I]||[],z=M[I];z.sort((O,N)=>{const $=T.featureSortOrder;if($){const U=$.indexOf(O.featureIndex);return $.indexOf(N.featureIndex)-U}return N.featureIndex-O.featureIndex});for(const O of z)C.push(O)}}return _}function Iu(l,t){const a=l.getRenderableIds().map(f=>l.getTileByID(f)),u=[],p={};for(let f=0;f<a.length;f++){const _=a[f],b=_.tileID.canonical.key;p[b]||(p[b]=!0,_.querySourceFeatures(u,t))}return u}function Xc(l,t){const a=l.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function Wr(l,t){const a={};if(!t)return a;for(const u of l){const p=u.layerIds.map(f=>t.getLayer(f)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(f=>p.filter(_=>_.id===f)[0]));for(const f of p)a[f.fqid]=u}}return a}const cr=32,xr=33,go=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,a=0,u=0,p=0,f=0,_=0,b=0;for(1&t?p=f=_=cr:a=u=b=cr;(t>>=1)>1;){const T=a+p>>1,M=u+f>>1;1&t?(p=a,f=u,a=_,u=b):(a=p,u=f,p=_,f=b),_=T,b=M}const x=4*l;go[x+0]=a,go[x+1]=u,go[x+2]=p,go[x+3]=f}const Nr=new Uint16Array(2178),_o=new Uint8Array(1089),zu=new Uint16Array(1089);function Xr(l){return l===0?-.03125:l===32?.03125:0}const Lu={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class Ms{constructor(t,a,u,p,f,_){this.tileID=t,this.uid=o.a$(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection),this.worldview=_}registerFadeDuration(t){const a=t+this.timeAdded;a<o.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Wr(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const f=this.buckets[p];if(f instanceof o.b1){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const f=this.buckets[p];if(f instanceof o.b1&&f.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const p in this.buckets){const f=this.buckets[p],_=a.style.getOwnLayer(p);if(!_)continue;const b=_.queryRadius(f);this.queryPadding=Math.max(this.queryPadding,b)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Wr(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const f=this.buckets[p];f.uploadPending()&&f.upload(t)}const a=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new o.T(t,u.image,a.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=a.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,a,u,p,f,_){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const b=function(x,T){const M=o.bn([],[.5*x.width,.5*-x.height,1]);return o.bo(M,M,[1,-1,0]),o.az(M,M,x.calculateProjMatrix(T.toUnwrapped())),Float32Array.from(M)}(f,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:b,transform:p,availableImages:u,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),f=a?a.sourceLayer:"",_=p._geojsonTileLayer||p[f];if(!_)return;const b=o.b3(a&&a.filter),{z:x,x:T,y:M}=this.tileID.canonical,I={z:x,x:T,y:M};for(let C=0;C<_.length;C++){const z=_.feature(C);if(b.needGeometry){const $=o.b4(z,!0);if(!b.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),$,this.tileID.canonical))continue}else if(!b.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),z))continue;const O=u.getId(z,f),N=new o.b5(z,x,T,M,O);N.tile=I,t.push(N)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=o.b6(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const f=this.expirationTime-a;f?this.expirationTime=u+Math.max(f,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),f=t.style.getBrightness();for(const _ in this.buckets){if(!t.style.hasLayer(_))continue;const b=this.buckets[_],x=b.layers[0],T=x.sourceLayer||"_geojsonTileLayer",M=u[T],I=t.style.getLayerSourceCache(x);let C={};I&&(C=I._state.getState(T,void 0));const z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},O=Object.keys(C).length>0&&!a;O&&!b.stateDependentLayers.length&&!a||b.update(C,M,p,z,O?b.stateDependentLayers:b.layers,a,f),(b instanceof o.b7||b instanceof o.b8)&&t._terrain&&t._terrain.enabled&&I&&b.uploadPending()&&t._terrain._clearRenderCacheForTile(I.id,this.tileID);const N=t&&t.style&&t.style.getOwnLayer(_);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.q.now()+t}setTexture(t,a){const u=a.context,p=u.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,a){const u={};for(const p of a)u[p]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const p=this.dependencies[u];if(p){for(const f of a)if(p[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const u=o.b9(Lu,this.tileID.canonical,this.tileTransform)[0],p=new o.ba,f=new o.bb;for(let _=0;_<u.length;_++){const{x:b,y:x}=u[_];p.emplaceBack(b,x),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(p,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,p.length,f.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const u=o.b9(Lu,this.tileID.canonical,this.tileTransform)[0];let p,f;if(this.isRaster){const _=function(b,x){const T=o.aW(b,x),M=Math.pow(2,b.z);for(let $=0;$<xr;$++)for(let U=0;U<xr;U++){const q=o.aX((b.x+(U+Xr(U))/cr)/M),Q=o.aY((b.y+($+Xr($))/cr)/M),ne=x.project(q,Q),le=$*xr+U;Nr[2*le+0]=Math.round((ne.x*T.scale-T.x)*o.aj),Nr[2*le+1]=Math.round((ne.y*T.scale-T.y)*o.aj)}_o.fill(0),zu.fill(0);for(let $=2045;$>=0;$--){const U=4*$,q=go[U+0],Q=go[U+1],ne=go[U+2],le=go[U+3],se=q+ne>>1,re=Q+le>>1,ae=se+re-Q,ue=re+q-se,he=Q*xr+q,xe=le*xr+ne,ke=re*xr+se,Ne=Math.hypot((Nr[2*he+0]+Nr[2*xe+0])/2-Nr[2*ke+0],(Nr[2*he+1]+Nr[2*xe+1])/2-Nr[2*ke+1])>=16;_o[ke]=_o[ke]||(Ne?1:0),$<1022&&(_o[ke]=_o[ke]||_o[(Q+ue>>1)*xr+(q+ae>>1)]||_o[(le+ue>>1)*xr+(ne+ae>>1)])}const I=new o.aZ,C=new o.a_;let z=0;function O($,U){const q=U*xr+$;return zu[q]===0&&(I.emplaceBack(Nr[2*q+0],Nr[2*q+1],$*o.aj/cr,U*o.aj/cr),zu[q]=++z),zu[q]-1}function N($,U,q,Q,ne,le){const se=$+q>>1,re=U+Q>>1;if(Math.abs($-ne)+Math.abs(U-le)>1&&_o[re*xr+se])N(ne,le,$,U,se,re),N(q,Q,ne,le,se,re);else{const ae=O($,U),ue=O(q,Q),he=O(ne,le);C.emplaceBack(ae,ue,he)}}return N(0,0,cr,cr,cr,0),N(cr,cr,0,0,0,cr),{vertices:I,indices:C}}(this.tileID.canonical,a);p=_.vertices,f=_.indices}else{p=new o.aZ,f=new o.a_;for(const{x:b,y:x}of u)p.emplaceBack(b,x,0,0);const _=o.be(p.int16.subarray(0,4*p.length),void 0,4);for(let b=0;b<_.length;b+=3)f.emplaceBack(_[b],_[b+1],_[b+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,o.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(f),this._tileBoundsSegments=o.bd.simpleSegment(0,0,p.length,f.length)}_makeGlobeTileDebugBuffers(t,a){const u=a.projection;if(!u||u.name!=="globe"||a.freezeTileCoverage)return;const p=this.tileID.canonical,f=o.bg(p,a),_=o.bh(f),b=o.ah(a.zoom);let x;b>0&&(x=o.bi(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,a,_,x,b),this._makeGlobeTileDebugTextBuffer(t,p,a,_,x,b)}_globePoint(t,a,u,p,f,_,b){let x=o.bj(t,a,u);if(_){const T=1<<u.z,M=o.aD(p.center.lng),I=o.aH(p.center.lat),C=(u.x+.5)/T-M;let z=0;C>.5?z=-1:C<-.5&&(z=1);let O=(t/o.aj+u.x)/T+z,N=(a/o.aj+u.y)/T;O=(O-M)*p._pixelsPerMercatorPixel+M,N=(N-I)*p._pixelsPerMercatorPixel+I;const $=[O*p.worldSize,N*p.worldSize,0];o.ad($,$,_),x=o.bk(x,$,b)}return o.ad(x,x,f)}_makeGlobeTileDebugBorderBuffer(t,a,u,p,f,_){const b=new o.ba,x=new o.bb,T=new o.bl,M=(C,z,O,N,$)=>{const U=(O-C)/($-1),q=(N-z)/($-1),Q=b.length;for(let ne=0;ne<$;ne++){const le=C+ne*U,se=z+ne*q;b.emplaceBack(le,se);const re=this._globePoint(le,se,a,u,p,f,_);T.emplaceBack(re[0],re[1],re[2]),x.emplaceBack(Q+ne)}},I=o.aj;M(0,0,I,0,16),M(I,0,I,I,16),M(I,I,0,I,16),M(0,I,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(x),this._tileDebugBuffer=t.createVertexBuffer(b,o.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(T,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,b.length,x.length)}_makeGlobeTileDebugTextBuffer(t,a,u,p,f,_){const b=o.aj/4,x=new o.ba,T=new o.a_,M=new o.bl,I=25;T.reserve(32),x.reserve(I),M.reserve(I);const C=(z,O)=>I*z+O;for(let z=0;z<I;z++){const O=z*b;for(let N=0;N<I;N++){const $=N*b;x.emplaceBack($,O);const U=this._globePoint($,O,a,u,p,f,_);M.emplaceBack(U[0],U[1],U[2])}}for(let z=0;z<4;z++)for(let O=0;O<4;O++){const N=C(z,O),$=C(z,O+1),U=C(z+1,O),q=C(z+1,O+1);T.emplaceBack(N,$,U),T.emplaceBack(U,$,q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(T),this._tileDebugTextBuffer=t.createVertexBuffer(x,o.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(M,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,I,32)}destroy(t=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class gl extends Ms{constructor(t,a,u,p,f){super(t,a,u,p,f),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,a){const u=a.context,p=u.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t,{premultiply:!1}):this.texture=new o.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,a){const u=this._mrt=new o.bp(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.br(p,(f,_,b,x)=>{if(f)a(f);else try{const T=u.getHeaderLength(_);if(T>t)return void(this.request=this.fetchHeader(T,a));u.parseHeader(_),this._isHeaderLoaded=!0;let M=0;for(const I of Object.values(u.layers))M=Math.max(M,I.dataIndex[I.dataIndex.length-1].lastByte);_.byteLength>=M&&(this.entireBuffer=_),a(null,this.entireBuffer||_,b,x)}catch(T){a(T)}}),this.request}fetchBand(t,a,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const f=this.actor;if(!f)return void u(new Error("Can't fetch tile band without an actor"));let _;const b=(I,C)=>{_.complete(I,C),I?u(I):(this.updateTextureDescriptor(t,a),u(null,this.textureDescriptor&&this.textureDescriptor.img))},x=(I,C)=>{if(I)return u(I);const z=f.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:C,task:_},b,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),_.cancel()})},T=p.getLayer(t);if(!T)return void u(new Error(`Unknown sourceLayer "${t}"`));if(T.hasDataForBand(a))return this.updateTextureDescriptor(t,a),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const M=T.getDataRange([a]);if(_=p.createDecodingTask(M),!_||_.tasks.length)if(this.flushQueues(),this.entireBuffer)x(null,this.entireBuffer.slice(M.firstByte,M.lastByte+1));else{const I=Object.assign({},this.requestParams,{headers:{Range:`bytes=${M.firstByte}-${M.lastByte}`}}),C=o.br(I,x);this._fetchQueue.push(()=>{C.cancel(),_.cancel()})}else u(null)}updateNeeded(t,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,a){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(a)||!u.hasDataForBand(a))return;const{bytes:p,tileSize:f,buffer:_,offset:b,scale:x}=u.getBandView(a),T=f+2*_,M=new o.r({width:T,height:T},p),I=this.texture;I&&I instanceof o.T&&I.update(M,{premultiply:!1}),this.textureDescriptor={layer:t,band:a,img:M,buffer:_,offset:b,tileSize:f,format:u.pixelFormat,mix:[x,256*x,65536*x,16777216*x]}}}class Ud{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const f={value:a,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},u)),this.data[p].push(f),this.order.push(p),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const u=t.wrapped().key,p=a===void 0?0:this.data[u].indexOf(a),f=this.data[u][p];return this.data[u].splice(p,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||a.push(p);for(const u of a)this.remove(u.value.tileID,u)}}class Jd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,u){const p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},o.h(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==p&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const f in this.state[t][p])u[f]||(this.deletedStates[t][p][f]=null)}else for(const f in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][f]===null&&delete this.deletedStates[t][p][f]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,a){const u=this.state[t]||{},p=this.stateChanges[t]||{},f=this.deletedStates[t];if(f===null)return{};if(a!==void 0){const b=String(a),x=o.h({},u[b],p[b]);if(f){const T=f[a];if(T===null)return{};for(const M in T)delete x[M]}return x}const _=o.h({},u,p);if(f)for(const b in f)delete _[b];return _}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const f={};for(const _ in this.stateChanges[p])this.state[p][_]||(this.state[p][_]={}),o.h(this.state[p][_],this.stateChanges[p][_]),f[_]=this.state[p][_];u[p]=f}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const f={};if(this.deletedStates[p]===null)for(const _ in this.state[p])f[_]={},this.state[p][_]={};else for(const _ in this.deletedStates[p]){if(this.deletedStates[p][_]===null)this.state[p][_]={};else if(this.state[p][_])for(const b of Object.keys(this.deletedStates[p][_]))delete this.state[p][_][b];f[_]=this.state[p][_]}u[p]=u[p]||{},o.h(u[p],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(a)}}class Va extends o.E{constructor(t,a,u){super(),this.id=t,this._onlySymbols=u,a.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Ud(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Jd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Es).map(t=>t.key)}getRenderableIds(t,a){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,a)&&u.push(this._tiles[p]);return t?u.sort((p,f)=>{const _=p.tileID,b=f.tileID,x=new o.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),T=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-b.overscaledZ||T.y-x.y||T.x-x.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(Es).map(p=>p.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,t,a)))}_tileLoaded(t,a,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new o.z(p,{tile:t}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=o.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const a=this.getRenderableIds();for(let p=0;p<a.length;p++){const f=a[p];if(t.neighboringTiles&&t.neighboringTiles[f]){const _=this.getTileByID(f);u(t,_),u(_,t)}}function u(p,f){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-p.tileID.canonical.x;const b=f.tileID.canonical.y-p.tileID.canonical.y,x=Math.pow(2,p.tileID.canonical.z),T=f.tileID.key;_===0&&b===0||Math.abs(b)>1||(Math.abs(_)>1&&(Math.abs(_+x)===1?_+=x:Math.abs(_-x)===1&&(_-=x)),f.dem&&p.dem&&(p.dem.backfillBorder(f.dem,_,b),p.neighboringTiles&&p.neighboringTiles[T]&&(p.neighboringTiles[T].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,u,p){for(const f in this._tiles){let _=this._tiles[f];if(p[f]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>u)continue;let b=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(b=T)}let x=b;for(;x.overscaledZ>a;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){p[b.key]=b;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=t.overscaledZ-1;u>=a;u--){const p=t.scaledTo(u),f=this._getLoadedTile(p);if(f)return f}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const u=Math.ceil(t.width/a)+1,p=Math.ceil(t.height/a)+1,f=Math.floor(u*p*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(b)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const u={};for(const p in this._tiles){const f=this._tiles[p];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+a),u[f.tileID.key]=f}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,a,u,p,f){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let b,x=this._source.maxzoom;const T=this.map&&this.map.painter?this.map.painter._terrain:null;if(T&&T.sourceCache===this&&T.attenuationRange()){const C=T.attenuationRange()[0],z=Math.floor(C)-Math.log2(T.getDemUpscale());x>z&&(x=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new o.aM(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y));else if(this.tileCoverLift!==0){const C=t.clone();C.tileCoverLift=this.tileCoverLift,b=C.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:x,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new o.aM(1,0,1,0,0)),b.push(new o.aM(1,0,1,1,0)),b.push(new o.aM(1,0,1,0,1)),b.push(new o.aM(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:x,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const C=this._source.hasTile.bind(this._source);b=b.filter(z=>C(z))}}else b=[];if(b.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ru(this._source.type)){const C=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),z=Math.min(C,this._source.maxzoom);if(_){const O=t.extendTileCover(b,z);for(const N of O)b.push(N)}else if(f){const O=t.extendTileCover(b,z,this.transform._camera.forward());for(const N of O)b.push(N)}else if(this.castsShadows&&p){const O=t.extendTileCover(b,z,p);for(const N of O)this._shadowCasterTiles[N.key]=!0,b.push(N)}}const M=this._updateRetainedTiles(b);if(Ru(this._source.type)&&b.length!==0){const C={},z={},O=Object.keys(M);for(const $ of O){const U=M[$],q=this._tiles[$];if(!q||q.fadeEndTime&&q.fadeEndTime<=o.q.now())continue;const Q=this.findLoadedParent(U,Math.max(U.overscaledZ-Va.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),C[Q.tileID.key]=Q.tileID),z[$]=U}const N=b[b.length-1].overscaledZ;for(const $ in this._tiles){const U=this._tiles[$];if(M[$]||!U.hasData())continue;let q=U.tileID;for(;q.overscaledZ>N;){q=q.scaledTo(q.overscaledZ-1);const Q=this._tiles[q.key];if(Q&&Q.hasData()&&z[q.key]){M[$]=U.tileID;break}}}for(const $ in C)M[$]||(this._coveredTiles[$]=!0,M[$]=C[$])}for(const C in M)this._tiles[C].clearFadeHold();const I=o.bs(this._tiles,M);for(const C of I){const z=this._tiles[C];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const u={},p=t.reduce((T,M)=>Math.min(T,M.overscaledZ),1/0),f=t[0].overscaledZ,_=Math.max(f-Va.maxOverzooming,this._source.minzoom),b=Math.max(f+Va.maxUnderzooming,this._source.minzoom),x={};for(const T of t){const M=this._addTile(T);a[T.key]=T,M.hasData()||p<this._source.maxzoom&&(x[T.key]=T)}this._retainLoadedChildren(x,p,b,a);for(const T of t){let M=this._tiles[T.key];if(M.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const C=T.children(this._source.maxzoom)[0],z=this.getTile(C);if(z&&z.hasData()){a[C.key]=C;continue}}else{const C=T.children(this._source.maxzoom);if(a[C[0].key]&&a[C[1].key]&&a[C[2].key]&&a[C[3].key])continue}let I=M.wasRequested();for(let C=T.overscaledZ-1;C>=_;--C){const z=T.scaledTo(C);if(u[z.key]||(u[z.key]=!0,M=this.getTile(z),!M&&I&&(M=this._addTile(z)),M&&(a[z.key]=z,I=M.wasRequested(),M.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}a.push(p.key);const f=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;p=f}for(const f of a)this._loadedParentTiles[f]=u}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const u=!!a;if(!u){const p=this.map?this.map.painter:null,f=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new gl(t,f,this.transform.tileZoom,p,this._isRaster):new Ms(t,f,this.transform.tileZoom,p,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,u||this._source.fire(new o.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,u){const p=[],f=this.transform;if(!f)return p;const _=f.projection.name==="globe",b=o.aD(f.center.lng);for(const x in this._tiles){const T=this._tiles[x];if(u&&T.clearQueryDebugViz(),T.holdingForFade())continue;let M;if(_){const I=T.tileID.canonical;if(I.z===0){const C=[Math.abs(o.ay(b,..._l(I,-1))-b),Math.abs(o.ay(b,..._l(I,1))-b)];M=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(o.ay(b,..._l(I,-1))-b),Math.abs(o.ay(b,..._l(I,0))-b),Math.abs(o.ay(b,..._l(I,1))-b)];M=[C.indexOf(Math.min(...C))-1]}}else M=[0];for(const I of M){const C=t.containsTile(T,f,a,I);C&&p.push(C)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const u=this.getRenderableIds(t,a).map(f=>this._tiles[f].tileID),p=this.transform.projection.name==="globe";for(const f of u)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped()),f.expandedProjMatrix=p?this.transform.calculateProjMatrix(f.toUnwrapped(),!1,!0):f.projMatrix;return u}sortCoordinatesByDistance(t){const a=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),f={};for(const _ of a){const b=1/(1<<_.canonical.z);f[_.key]=((_.canonical.x+.5)*b+_.wrap-u[0])*p[0]+((_.canonical.y+.5)*b-u[1])*p[1]-u[2]*p[2]}return a.sort((_,b)=>f[_.key]-f[b.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Ru(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(t,a,u){this._state.updateState(t=t||"_geojsonTileLayer",a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,u)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,u){const p=this._tiles[t];p&&p.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u in this._tiles)this._tiles[u].hasDependency(t,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(t,a))};return void this._source.on("data",x)}const u=new Map,p=Array.isArray(t)?t:[t],f=this.map.painter.terrain,_=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const x of p){const T=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of T)u.set(M.key,M);this.usedForTerrain&&x.updateElevation(!1)}const b=Array.from(u.values());o.bt(b,(x,T)=>{const M=new Ms(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(M,I=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),T(I,M)})},a)}}function Es(l,t){const a=Math.abs(2*l.wrap)-+(l.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||u-a||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function Ru(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function _l(l,t){const a=1<<l.z;return[l.x/a+t,(l.x+1)/a+t]}Va.maxOverzooming=10,Va.maxUnderzooming=3;class bf{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion"||p.type==="building")this.layers.push({layer:p,visible:t,visibilityChanged:a});else if(p.type==="model"){const f=this.style.getLayerSource(p);f&&f.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const u=a.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="building"?p=!u.isHidden(t)&&u.paint.get("building-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&a.visible,a.visible=p}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const p of this.layers){const f=p.layer,_=this.style.getLayerSourceCache(f);let b=1;f.type==="fill-extrusion"?b=p.visible?f.paint.get("fill-extrusion-vertical-scale"):0:f.type==="building"&&(b=p.visible?f.paint.get("building-vertical-scale"):0);let x=_?_.getTile(a):null;if(!x&&_&&a.canonical.z>_.getSource().minzoom){let T=a.scaledTo(Math.min(_.getSource().maxzoom,a.overscaledZ-1));for(;T.overscaledZ>=_.getSource().minzoom&&(x=_.getTile(T),!x&&T.overscaledZ!==0);)T=T.scaledTo(T.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:x?x.getBucket(f):null,tileID:x?x.tileID:a,verticalScale:b})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const f=t.symbolInstances.get(p),_=f.zOffset,b=this._getHeightAtTileOffset(a,f.tileAnchorX,f.tileAnchorY);f.zOffset=b!==Number.NEGATIVE_INFINITY?b:_,u||_===f.zOffset||(u=!0),t.hasAnyZOffset||f.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,u,p){let f=a,_=u;if(t.canonical.z!==p.canonical.z){const b=p.canonical,x=1/(1<<t.canonical.z-b.z);f=(a+t.canonical.x*o.aj)*x-b.x*o.aj|0,_=(u+t.canonical.y*o.aj)*x-b.y*o.aj|0}return{tileX:f,tileY:_}}_getHeightAtTileOffset(t,a,u){let p,f;for(let _=0;_<this.layers.length;++_){const b=this.layers[_].layer;if(b.type!=="fill-extrusion"&&b.type!=="building")continue;const{bucket:x,tileID:T,verticalScale:M}=this.currentBuildingBuckets[_];if(!x)continue;const{tileX:I,tileY:C}=this._mapCoordToOverlappingTile(t,a,u,T),z=x.getHeightAtTileCoord(I,C);z&&z.height!==void 0&&(z.hidden?p=z.height:f=Math.max(z.height*M,f||0))}if(f!==void 0)return f;for(let _=0;_<this.layers.length;++_){const b=this.layers[_];if(b.layer.type!=="model"||!b.visible)continue;const{bucket:x,tileID:T}=this.currentBuildingBuckets[_];if(!x)continue;const{tileX:M,tileY:I}=this._mapCoordToOverlappingTile(t,a,u,T),C=x.getHeightAtTileCoord(M,I);if(C&&!C.hidden)return C.height===void 0&&p!==void 0?Math.min(C.maxHeight,p)*C.verticalScale:C.height?C.height*C.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vf(l,t){const a={};for(const u in l)u!=="ref"&&(a[u]=l[u]);return o.bu.forEach(u=>{u in t&&(a[u]=t[u])}),a}function Bu(l){l=l.slice();const t=Object.create(null);for(let a=0;a<l.length;a++)t[l[a].id]=l[a];for(let a=0;a<l.length;a++)"ref"in l[a]&&(l[a]=vf(l[a],t[l[a].ref]));return l}const Mi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Qc(l,t,a){a.push({command:Mi.addSource,args:[l,t[l]]})}function yl(l,t,a){t.push({command:Mi.removeSource,args:[l]}),a[l]=!0}function Wu(l,t,a,u){yl(l,a,u),Qc(l,t,a)}function Iy(l,t,a){let u;for(u in l[a])if(l[a].hasOwnProperty(u)&&u!=="data"&&!o.bv(l[a][u],t[a][u]))return!1;for(u in t[a])if(t[a].hasOwnProperty(u)&&u!=="data"&&!o.bv(l[a][u],t[a][u]))return!1;return!0}function Nu(l,t,a,u,p,f){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(o.bv(l[_],t[_])||a.push({command:f,args:[u,_,t[_],p]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(o.bv(l[_],t[_])||a.push({command:f,args:[u,_,t[_],p]}))}function Cs(l){return l.id}function Ho(l,t){return l[t.id]=t,l}class qd{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ay(t,0,1);let a=1,u=this._distances[a];const p=t*this.paddedLength+this.padding;for(;u<p&&a<this._distances.length;)u=this._distances[++a];const f=a-1,_=this._distances[f],b=u-_,x=b>0?(p-_)/b:0;return this.points[f].mult(1-x).add(this.points[a].mult(x))}}class Gd{constructor(t,a,u){const p=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let _=0;_<this.xCellCount*this.yCellCount;_++)p.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,p,f){this._forEachCell(a,u,p,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(f)}insertCircle(t,a,u,p){this._forEachCell(a-p,u-p,a+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,a,u,p,f,_){this.boxCells[f].push(_)}_insertCircleCell(t,a,u,p,f,_){this.circleCells[f].push(_)}_query(t,a,u,p,f,_){if(u<0||t>this.width||p<0||a>this.height)return!f&&[];const b=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=p){if(f)return!0;for(let x=0;x<this.boxKeys.length;x++)b.push({key:this.boxKeys[x],x1:this.bboxes[4*x],y1:this.bboxes[4*x+1],x2:this.bboxes[4*x+2],y2:this.bboxes[4*x+3]});for(let x=0;x<this.circleKeys.length;x++){const T=this.circles[3*x],M=this.circles[3*x+1],I=this.circles[3*x+2];b.push({key:this.circleKeys[x],x1:T-I,y1:M-I,x2:T+I,y2:M+I})}return _?b.filter(_):b}return this._forEachCell(t,a,u,p,this._queryCell,b,{hitTest:f,seenUids:{box:{},circle:{}}},_),f?b.length>0:b}_queryCircle(t,a,u,p,f){const _=t-u,b=t+u,x=a-u,T=a+u;if(b<0||_>this.width||T<0||x>this.height)return!p&&[];const M=[];return this._forEachCell(_,x,b,T,this._queryCellCircle,M,{hitTest:p,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},f),p?M.length>0:M}query(t,a,u,p,f){return this._query(t,a,u,p,!1,f)}hitTest(t,a,u,p,f){return this._query(t,a,u,p,!0,f)}hitTestCircle(t,a,u,p){return this._queryCircle(t,a,u,!0,p)}_queryCell(t,a,u,p,f,_,b,x){const T=b.seenUids,M=this.boxCells[f];if(M!==null){const C=this.bboxes;for(const z of M)if(!T.box[z]){T.box[z]=!0;const O=4*z;if(t<=C[O+2]&&a<=C[O+3]&&u>=C[O+0]&&p>=C[O+1]&&(!x||x(this.boxKeys[z]))){if(b.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[z],x1:C[O],y1:C[O+1],x2:C[O+2],y2:C[O+3]})}}}const I=this.circleCells[f];if(I!==null){const C=this.circles;for(const z of I)if(!T.circle[z]){T.circle[z]=!0;const O=3*z;if(this._circleAndRectCollide(C[O],C[O+1],C[O+2],t,a,u,p)&&(!x||x(this.circleKeys[z]))){if(b.hitTest)return _.push(!0),!0;{const N=C[O],$=C[O+1],U=C[O+2];_.push({key:this.circleKeys[z],x1:N-U,y1:$-U,x2:N+U,y2:$+U})}}}}}_queryCellCircle(t,a,u,p,f,_,b,x){const T=b.circle,M=b.seenUids,I=this.boxCells[f];if(I!==null){const z=this.bboxes;for(const O of I)if(!M.box[O]){M.box[O]=!0;const N=4*O;if(this._circleAndRectCollide(T.x,T.y,T.radius,z[N+0],z[N+1],z[N+2],z[N+3])&&(!x||x(this.boxKeys[O])))return _.push(!0),!0}}const C=this.circleCells[f];if(C!==null){const z=this.circles;for(const O of C)if(!M.circle[O]){M.circle[O]=!0;const N=3*O;if(this._circlesCollide(z[N],z[N+1],z[N+2],T.x,T.y,T.radius)&&(!x||x(this.circleKeys[O])))return _.push(!0),!0}}}_forEachCell(t,a,u,p,f,_,b,x){const T=this._convertToXCellCoord(t),M=this._convertToYCellCoord(a),I=this._convertToXCellCoord(u),C=this._convertToYCellCoord(p);for(let z=T;z<=I;z++)for(let O=M;O<=C;O++)if(f.call(this,t,a,u,p,this.xCellCount*O+z,_,b,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,p,f,_){const b=p-t,x=f-a,T=u+_;return T*T>b*b+x*x}_circleAndRectCollide(t,a,u,p,f,_,b){const x=(_-p)/2,T=Math.abs(t-(p+x));if(T>x+u)return!1;const M=(b-f)/2,I=Math.abs(a-(f+M));if(I>M+u)return!1;if(T<=x||I<=M)return!0;const C=T-x,z=I-M;return C*C+z*z<=u*u}}const Ds={unknown:0,flipRequired:1,flipNotRequired:2},xf=Math.tan(85*Math.PI/180);function yo(l,t,a,u,p,f,_){const b=o.bz();if(a)if(f.name==="globe"){const x=o.bA(p,t);o.az(b,b,x)}else{const x=o.bB([],_);b[0]=x[0],b[1]=x[1],b[4]=x[2],b[5]=x[3],u||o.by(b,b,p.angle)}else o.az(b,p.labelPlaneMatrix,l);return b}function eh(l,t,a,u,p,f,_){const b=yo(l,t,a,u,p,f,_);return f.name==="globe"&&a||(b[2]=b[6]=b[10]=b[14]=0),b}function th(l,t,a,u,p,f,_){if(a){if(f.name==="globe"){const b=yo(l,t,a,u,p,f,_);return o.bi(b,b),o.az(b,l,b),b}{const b=o.bw(l),x=o.bx([]);return x[0]=_[0],x[1]=_[1],x[4]=_[2],x[5]=_[3],o.az(b,b,x),u||o.by(b,b,-p.angle),b}}return p.glCoordMatrix}function Fr(l,t,a,u){const p=[l,t,a,1];a?o.aA(p,p,u):Bi(p,p,u);const f=p[3];return p[0]/=f,p[1]/=f,p[2]/=f,p}function Fu(l,t){return Math.min(.5+l/t*.5,1.5)}function Is(l,t){const a=l[0]/l[3],u=l[1]/l[3];return a>=-t[0]&&a<=t[0]&&u>=-t[1]&&u<=t[1]}function ih(l,t,a,u,p,f,_,b,x,T){const M=a.transform,I=u?l.textSizeData:l.iconSizeData,C=o.bH(I,a.transform.zoom),z=M.projection.name==="globe",O=[256/a.width*2+1,256/a.height*2+1],N=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;N.clear();let $=null;z&&($=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const U=l.lineVertexArray,q=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,Q=a.transform.width/a.transform.height;let ne,le=!1;for(let se=0;se<q.length;se++){const re=q.get(se),{numGlyphs:ae,writingMode:ue}=re;if(ue!==o.bI.vertical||le||ne===o.bI.horizontal||(le=!0),ne=ue,(re.hidden||ue===o.bI.vertical)&&!le){Ls(ae,N);continue}le=!1;const he=new o.P(re.tileAnchorX,re.tileAnchorY);let{x:xe,y:ke,z:Ne}=M.projection.projectTilePoint(he.x,he.y,T.canonical);if(x){const[wt,bt,ft]=x(he);xe+=wt,ke+=bt,Ne+=ft}const Fe=[xe,ke,Ne,1];if(o.aA(Fe,Fe,t),!Is(Fe,O)){Ls(ae,N);continue}const Ge=Fe[3],be=Fu(a.transform.getCameraToCenterDistance(M.projection),Ge),ze=o.bJ(I,C,re),fe=_?ze/be:ze*be,je=Fr(xe,ke,Ne,p);if(je[3]<=0){Ls(ae,N);continue}let Pe={};const Je=o.al(l.layers[0].layout.get("text-max-angle")),at=Math.cos(Je),$e=_?null:x,it=zs(re,fe,!1,b,t,p,f,l.glyphOffsetArray,U,N,$,je,he,Pe,Q,$e,M.projection,T,_,at);le=it.useVertical,$e&&it.needsFlipping&&(Pe={}),(it.notEnoughRoom||le||it.needsFlipping&&zs(re,fe,!0,b,t,p,f,l.glyphOffsetArray,U,N,$,je,he,Pe,Q,$e,M.projection,T,_,at).notEnoughRoom)&&Ls(ae,N)}u?(l.text.dynamicLayoutVertexBuffer.updateData(N),$&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData($)):(l.icon.dynamicLayoutVertexBuffer.updateData(N),$&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData($))}function Yd(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$){const{lineStartIndex:U,glyphStartIndex:q,segment:Q}=b,ne=q+b.numGlyphs,le=U+b.lineLength,se=t.getoffsetX(q),re=t.getoffsetX(ne-1),ae=wl(l*se,a,u,p,f,_,Q,U,le,x,T,M,I,C,!0,z,O,N,$);if(!ae)return null;const ue=wl(l*re,a,u,p,f,_,Q,U,le,x,T,M,I,C,!0,z,O,N,$);return ue?{first:ae,last:ue}:null}function nh(l,t,a,u){return l===o.bI.horizontal&&Math.abs(u)>Math.abs(a)?{useVertical:!0}:l===o.bI.vertical?u>0?{needsFlipping:!0}:null:t!==Ds.unknown&&function(p,f){return p===0||Math.abs(f/p)>xf}(a,u)?t===Ds.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function zs(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U,q,Q){const ne=t/24,le=l.lineOffsetX*ne,se=l.lineOffsetY*ne,{lineStartIndex:re,glyphStartIndex:ae,numGlyphs:ue,segment:he,writingMode:xe,flipState:ke}=l,Ne=re+l.lineLength,Fe=Ge=>{if(M){const[je,Pe,Je]=Ge.up,at=T.length;o.bK(M,at+0,je,Pe,Je),o.bK(M,at+1,je,Pe,Je),o.bK(M,at+2,je,Pe,Je),o.bK(M,at+3,je,Pe,Je)}const[be,ze,fe]=Ge.point;o.bL(T,be,ze,fe,Ge.angle)};if(ue>1){const Ge=Yd(ne,b,le,se,a,I,C,l,x,f,z,N,!1,$,U,q,Q);if(!Ge)return{notEnoughRoom:!0};if(u&&!a){let[be,ze,fe]=Ge.first.point,[je,Pe,Je]=Ge.last.point;[be,ze]=Fr(be,ze,fe,_),[je,Pe]=Fr(je,Pe,Je,_);const at=nh(xe,ke,(je-be)*O,Pe-ze);if(l.flipState=at&&at.needsFlipping?Ds.flipRequired:Ds.flipNotRequired,at)return at}Fe(Ge.first);for(let be=ae+1;be<ae+ue-1;be++){const ze=wl(ne*b.getoffsetX(be),le,se,a,I,C,he,re,Ne,x,f,z,N,!1,!1,$,U,q,Q);if(!ze)return T.length-=4*(be-ae),{notEnoughRoom:!0};Fe(ze)}Fe(Ge.last)}else{if(u&&!a){const be=Fr(C.x,C.y,0,p),ze=re+he+1,fe=new o.P(x.getx(ze),x.gety(ze)),je=Fr(fe.x,fe.y,0,p),Pe=je[3]>0?je:Hd(C,fe,be,1,p,void 0,$,U.canonical),Je=nh(xe,ke,(Pe[0]-be[0])*O,Pe[1]-be[1]);if(l.flipState=Je&&Je.needsFlipping?Ds.flipRequired:Ds.flipNotRequired,Je)return Je}const Ge=wl(ne*b.getoffsetX(ae),le,se,a,I,C,he,re,Ne,x,f,z,N,!1,!1,$,U,q,Q);if(!Ge)return{notEnoughRoom:!0};Fe(Ge)}return{}}function er(l,t,a,u,p){const{x:f,y:_,z:b}=u.projectTilePoint(l.x,l.y,t);if(!p)return Fr(f,_,b,a);const[x,T,M]=p(l);return Fr(f+x,_+T,b+M,a)}function Hd(l,t,a,u,p,f,_,b){const x=er(l.sub(t)._unit()._add(l),b,p,_,f);return o.at(x,a,x),o.au(x,x),o.bE(x,a,x,u)}function wl(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U,q){const Q=u?l-t:l+t;let ne=Q>0?1:-1,le=0;u&&(ne*=-1,le=Math.PI),ne<0&&(le+=Math.PI);let se=b+_+(ne>0?0:1)|0,re=p,ae=p,ue=0,he=0;const xe=Math.abs(Q),ke=[],Ne=[];let Fe=f,Ge=Fe,be=o.bC([]);const ze=()=>Hd(Ge,Fe,ae,xe-ue+1,M,C,N,$.canonical);for(;ue+he<=xe;){if(se+=ne,se<b||se>=x)return null;if(ae=re,Ge=Fe,ke.push(ae),z&&Ne.push(Ge),Fe=new o.P(T.getx(se),T.gety(se)),re=I[se],!re){const ft=er(Fe,$.canonical,M,N,C);re=ft[3]>0?I[se]=ft:ze()}ue+=he;const wt=o.at([],re,ae),bt=o.bD(ae,re);if(a&&bt>0&&he>0&&o.bG(be,wt)/(he*bt)<q)return null;he=bt,be=wt}O&&C&&(I[se]&&(re=ze(),he=o.bD(ae,re),be=o.at([],re,ae)),I[se]=re);const fe=(xe-ue)/he,je=Fe.sub(Ge)._mult(fe)._add(Ge),Pe=o.bE([],ae,be,fe);let Je=[0,0,1],at=be[0],$e=be[1];if(U&&(Je=N.upVector($.canonical,je.x,je.y),Je[0]!==0||Je[1]!==0||Je[2]!==1)){const wt=[Je[2],0,-Je[0]],bt=o.bF([],Je,wt);o.au(wt,wt),o.au(bt,bt),at=o.bG(be,wt),$e=o.bG(be,bt)}if(a){const wt=o.bF([],Je,be);o.au(wt,wt),o.bE(Pe,Pe,wt,a*ne)}const it=le+Math.atan2($e,at);return ke.push(Pe),z&&Ne.push(je),{point:Pe,angle:it,path:ke,tilePath:Ne,up:Je}}function Ls(l,t){const a=t.length,u=a+4*l;t.resize(u),t.float32.fill(-1/0,4*a,4*u)}function Bi(l,t,a){const u=t[0],p=t[1];return l[0]=a[0]*u+a[4]*p+a[12],l[1]=a[1]*u+a[5]*p+a[13],l[3]=a[3]*u+a[7]*p+a[15],l}const Or=100;class zy{constructor(t,a,u=new Gd(t.width+200,t.height+200,25),p=new Gd(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Or,this.screenBottomBoundary=t.height+Or,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,u,p,f,_,b,x){let T=u.projectedAnchorX,M=u.projectedAnchorY,I=u.projectedAnchorZ;const C=u.elevation,z=u.tileID,O=t.getProjection();if(C&&z){const[se,re,ae]=O.upVector(z.canonical,u.tileAnchorX,u.tileAnchorY),ue=O.upVectorScale(z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;T+=se*C*ue,M+=re*C*ue,I+=ae*C*ue}const N=this.projectAndGetPerspectiveRatio(b,T,M,I,u.tileID,O.name==="globe"||!!C||this.transform.pitch>0,O),$=_*N.perspectiveRatio,U=(u.x1*a+p.x-u.padding)*$+N.point.x,q=(u.y1*a+p.y-u.padding)*$+N.point.y,Q=(u.x2*a+p.x+u.padding)*$+N.point.x,ne=(u.y2*a+p.y+u.padding)*$+N.point.y,le=N.perspectiveRatio<=.55||N.occluded;return!this.isInsideGrid(U,q,Q,ne)||!f&&this.grid.hitTest(U,q,Q,ne,x)||le?{box:[],offscreen:!1,occluded:N.occluded}:{box:[U,q,Q,ne],offscreen:this.isOffscreen(U,q,Q,ne),occluded:!1}}placeCollisionCircles(t,a,u,p,f,_,b,x,T,M,I,C,z,O,N){const $=[],U=this.transform.elevation,q=t.getProjection(),Q=U?U.getAtTileOffsetFunc(N,this.transform.center.lat,this.transform.worldSize,q):null,ne=new o.P(u.tileAnchorX,u.tileAnchorY);let{x:le,y:se,z:re}=q.projectTilePoint(ne.x,ne.y,N.canonical);if(Q){const[Je,at,$e]=Q(ne);le+=Je,se+=at,re+=$e}const ae=q.name==="globe",ue=this.projectAndGetPerspectiveRatio(b,le,se,re,N,ae||!!U||this.transform.pitch>0,q),{perspectiveRatio:he}=ue,xe=(I?_/he:_*he)/o.bO,ke=Fr(le,se,re,x),Ne=u.lineOffsetX*xe,Fe=u.lineOffsetY*xe,Ge=o.al(t.layers[0].layout.get("text-max-angle")),be=Math.cos(Ge),ze=ue.signedDistanceFromCamera>0?Yd(xe,f,Ne,Fe,!1,ke,ne,u,p,x,{},U&&!I?Q:null,I&&!!U,q,N,I,be):null;let fe=!1,je=!1,Pe=!0;if(ze&&!ue.occluded){const Je=.5*z*he+O,at=new o.P(-100,-100),$e=new o.P(this.screenRightBoundary,this.screenBottomBoundary),it=new qd,{first:wt,last:bt}=ze,ft=wt.path.length;let Et=[];for(let Jt=ft-1;Jt>=1;Jt--)Et.push(wt.path[Jt]);for(let Jt=1;Jt<bt.path.length;Jt++)Et.push(bt.path[Jt]);const Dt=2.5*Je;T&&(Et=Et.map(([Jt,si,Ni],an)=>(Q&&!ae&&(Ni=Q(an<ft-1?wt.tilePath[ft-1-an]:bt.tilePath[an-ft+2])[2]),Fr(Jt,si,Ni,T))),Et.some(Jt=>Jt[3]<=0)&&(Et=[]));let Rt=[];if(Et.length>0){let Jt=1/0,si=-1/0,Ni=1/0,an=-1/0;for(const ji of Et)Jt=Math.min(Jt,ji[0]),Ni=Math.min(Ni,ji[1]),si=Math.max(si,ji[0]),an=Math.max(an,ji[1]);si>=at.x&&Jt<=$e.x&&an>=at.y&&Ni<=$e.y&&(Rt=[Et.map(ji=>new o.P(ji[0],ji[1]))],(Jt<at.x||si>$e.x||Ni<at.y||an>$e.y)&&(Rt=o.bM(Rt,at.x,at.y,$e.x,$e.y)))}for(const Jt of Rt){it.reset(Jt,.25*Je);let si=0;si=it.length<=.5*Je?1:Math.ceil(it.paddedLength/Dt)+1;for(let Ni=0;Ni<si;Ni++){const an=Ni/Math.max(si-1,1),ji=it.lerp(an),qi=ji.x+Or,Fn=ji.y+Or;$.push(qi,Fn,Je,0);const ei=qi-Je,hi=Fn-Je,vi=qi+Je,un=Fn+Je;if(Pe=Pe&&this.isOffscreen(ei,hi,vi,un),je=je||this.isInsideGrid(ei,hi,vi,un),!a&&this.grid.hitTestCircle(qi,Fn,Je,C)&&(fe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:fe,occluded:!1}}}}return{circles:!M&&fe||!je?[]:$,offscreen:Pe,collisionDetected:fe,occluded:ue.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let u=1/0,p=1/0,f=-1/0,_=-1/0;for(const M of t){const I=new o.P(M.x+Or,M.y+Or);u=Math.min(u,I.x),p=Math.min(p,I.y),f=Math.max(f,I.x),_=Math.max(_,I.y),a.push(I)}const b=this.grid.query(u,p,f,_).concat(this.ignoredGrid.query(u,p,f,_)),x={},T={};for(const M of b){const I=M.key;if(x[I.bucketInstanceId]===void 0&&(x[I.bucketInstanceId]={}),x[I.bucketInstanceId][I.featureIndex])continue;const C=[new o.P(M.x1,M.y1),new o.P(M.x2,M.y1),new o.P(M.x2,M.y2),new o.P(M.x1,M.y2)];o.bN(a,C)&&(x[I.bucketInstanceId][I.featureIndex]=!0,T[I.bucketInstanceId]===void 0&&(T[I.bucketInstanceId]=[]),T[I.bucketInstanceId].push(I.featureIndex))}return T}insertCollisionBox(t,a,u,p,f){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:f},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,p,f){const _=a?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:p,collisionGroupID:f};for(let x=0;x<t.length;x+=4)_.insertCircle(b,t[x],t[x+1],t[x+2])}projectAndGetPerspectiveRatio(t,a,u,p,f,_,b){const x=[a,u,p,1];let T=!1;p||this.transform.pitch>0?(o.aA(x,x,t),this.fogState&&f&&b.name!=="globe"&&(T=function(C,z,O,N,$,U){const q=U.calculateFogTileMatrix($),Q=[z,O,N];return o.ad(Q,Q,q),ot(C,o.ae(Q),U.pitch,U._fov)}(this.fogState,a,u,p,f.toUnwrapped(),this.transform)>.9)):Bi(x,x,t);const M=x[3];return{point:new o.P((x[0]/M+1)/2*this.transform.width+Or,(-x[1]/M+1)/2*this.transform.height+Or),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/M*.5,1.5),signedDistanceFromCamera:M,occluded:_&&x[2]>M||T}}isOffscreen(t,a,u,p){return u<Or||t>=this.screenRightBoundary||p<Or||a>this.screenBottomBoundary}isInsideGrid(t,a,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=o.bx([]);return o.bo(t,t,[-100,-100,0]),t}}function Zd(l,t,a){const u=t.createTileMatrix(l,l.worldSize,a.toUnwrapped());return o.az(new Float32Array(16),l.projMatrix,u)}function Vt(l,t,a){if(t.projection.name===a.projection.name)return l.projMatrix;const u=a.clone();return u.setProjection(t.projection),Zd(u,t.getProjection(),l)}function ah(l,t,a){return t.name===a.projection.name?l.projMatrix:Zd(a,t,l)}class Ou{constructor(t,a,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Rs{constructor(t,a,u,p,f,_=!1){this.text=new Ou(t?t.text:null,a,u,f),this.icon=new Ou(t?t.icon:null,a,p,f),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hr{constructor(t,a,u,p=!1){this.text=t,this.icon=a,this.skipFade=u,this.clipped=p}}class Kd{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class bl{constructor(t,a,u,p,f){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=f}}class Ct{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function Ji(l,t,a,u,p){const{horizontalAlign:f,verticalAlign:_}=o.bT(l),b=-(f-.5)*t,x=-(_-.5)*a,T=o.bU(l,u);return new o.P(b+T[0]*p,x+T[1]*p)}function Li(l,t,a,u,p){const f=new o.P(l,t);return a&&f._rotate(u?p:-p),f}class tr{constructor(t,a,u,p,f,_){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new zy(this.transform,f),this.buildingIndex=_,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Ct(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,u,p,f=1){const _=u.getBucket(a),b=u.latestFeatureIndex;if(!_||!b||a.fqid!==_.layerIds[0])return;const x=_.layers[0].layout,T=_.layers[0].paint,M=u.collisionBoxArray,I=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),C=u.tileSize/o.aj,z=u.tileID.toUnwrapped();this.transform.setProjection(_.projection);const O=(N=u.tileID,$=_.getProjection(),U=this.transform,$.name===this.projection?U.calculateProjMatrix(N.toUnwrapped()):Zd(U,$,N));var N,$,U;const q=x.get("text-pitch-alignment")==="map",Q=x.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const ne=a.dynamicFilter(),le=a.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(u),re=eh(O,u.tileID.canonical,q,Q,this.transform,_.getProjection(),se);let ae=null;if(q){const ze=th(O,u.tileID.canonical,q,Q,this.transform,_.getProjection(),se);ae=o.az([],this.transform.labelPlaneMatrix,ze)}let ue=null;ne&&u.latestFeatureIndex&&(ue={unwrappedTileID:z,dynamicFilter:ne,dynamicFilterNeedsFeature:le}),this.retainedQueryData[_.bucketInstanceId]=new bl(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,u.tileID);const[he,xe]=_.layers[0].layout.get("text-size-scale-range"),ke=o.ay(f,he,xe),[Ne,Fe]=x.get("icon-size-scale-range"),Ge=o.ay(f,Ne,Fe),be={bucket:_,layout:x,paint:T,posMatrix:O,textLabelPlaneMatrix:re,labelToScreenMatrix:ae,clippingData:ue,scale:I,textPixelRatio:C,holdingForFade:u.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.bH(_.textSizeData,this.transform.zoom,ke),partiallyEvaluatedIconSize:o.bH(_.iconSizeData,this.transform.zoom,Ge),collisionGroup:this.collisionGroups.get(_.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const ze of _.sortKeyRanges){const{sortKey:fe,symbolInstanceStart:je,symbolInstanceEnd:Pe}=ze;t.push({sortKey:fe,symbolInstanceStart:je,symbolInstanceEnd:Pe,parameters:be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:be})}attemptAnchorPlacement(t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U,q){const{textOffset0:Q,textOffset1:ne,crossTileID:le}=C,se=[Q,ne],re=Ji(t,u,p,se,f),ae=this.collisionIndex.placeCollisionBox(O,f,a,Li(re.x,re.y,_,b,this.transform.angle),I,x,T,M.predicate);if($){const ue=O.getSymbolInstanceIconSize(q,this.transform.zoom,C.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(O,ue,$,Li(re.x,re.y,_,b,this.transform.angle),I,x,T,M.predicate).box.length===0)return}if(ae.box.length>0){let ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[le]&&this.prevPlacement.placements[le]&&this.prevPlacement.placements[le].text&&(ue=this.prevPlacement.variableOffsets[le].anchor),this.variableOffsets[le]={textOffset:se,width:u,height:p,anchor:t,textScale:f,prevAnchor:ue},this.markUsedJustification(O,t,C,N),O.allowVerticalPlacement&&(this.markUsedOrientation(O,N,C),this.placedOrientations[le]=N),{shift:re,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,a,u,p,f=1){const{bucket:_,layout:b,paint:x,posMatrix:T,textLabelPlaneMatrix:M,labelToScreenMatrix:I,clippingData:C,textPixelRatio:z,holdingForFade:O,collisionBoxArray:N,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:U,collisionGroup:q,latestFeatureIndex:Q}=t.parameters,ne=b.get("text-optional"),le=b.get("icon-optional"),se=b.get("text-allow-overlap"),re=b.get("icon-allow-overlap"),ae=b.get("text-rotation-alignment")==="map",ue=b.get("text-pitch-alignment")==="map",he=x.get("symbol-z-offset"),xe=b.get("symbol-elevation-reference")==="sea",[ke,Ne]=b.get("text-size-scale-range"),[Fe,Ge]=b.get("icon-size-scale-range"),be=o.ay(f,ke,Ne),ze=o.ay(f,Fe,Ge);this.transform.setProjection(_.projection);let fe=se&&(re||!_.hasIconData()||le),je=re&&(se||!_.hasTextData()||ne);const Pe=!he.isConstant();!_.collisionArrays&&N&&_.deserializeCollisionBoxes(N),u&&p&&_.updateCollisionDebugBuffers(this.transform.zoom,N,be,ze);const Je=($e,it,wt)=>{const{crossTileID:bt,numVerticalGlyphVertices:ft}=$e;let Et=null;if(C&&C.dynamicFilterNeedsFeature||Pe){const Qi=this.retainedQueryData[_.bucketInstanceId];Et=Q.loadFeature({featureIndex:$e.featureIndex,bucketIndex:Qi.bucketIndex,sourceLayerIndex:Qi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(C&&!(0,C.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Et,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.P($e.tileAnchorX,$e.tileAnchorY),this.transform.calculateDistanceTileData(C.unwrappedTileID)))return this.placements[bt]=new hr(!1,!1,!1,!0),void a.add(bt);const Dt=he.evaluate(Et,{});if(a.has(bt))return;if(O)return void(this.placements[bt]=new hr(!1,!1,!1));let Rt=!1,Jt=!1,si=!0,Ni=!1,an=!1,ji=null,qi={box:null,offscreen:null,occluded:null},Fn={box:null},ei=null,hi=null,vi=null,un=0,Gn=0,rn=0;wt.textFeatureIndex?un=wt.textFeatureIndex:$e.useRuntimeCollisionCircles&&(un=$e.featureIndex),wt.verticalTextFeatureIndex&&(Gn=wt.verticalTextFeatureIndex);const zi=Qi=>{Qi.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const hn=this.transform.elevation;Qi.elevation=xe?Dt:Dt+(hn?hn.getAtTileOffset(Qi.tileID,Qi.tileAnchorX,Qi.tileAnchorY):0),Qi.elevation+=$e.zOffset},Dn=wt.textBox;if(Dn){zi(Dn);const Qi=Ri=>{let zn=o.bI.horizontal;if(_.allowVerticalPlacement&&!Ri&&this.prevPlacement){const ga=this.prevPlacement.placedOrientations[bt];ga&&(this.placedOrientations[bt]=ga,zn=ga,this.markUsedOrientation(_,zn,$e))}return zn},hn=(Ri,zn)=>{if(_.allowVerticalPlacement&&ft>0&&wt.verticalTextBox){for(const ga of _.writingModes)if(ga===o.bI.vertical?(qi=zn(),Fn=qi):qi=Ri(),qi&&qi.box&&qi.box.length)break}else qi=Ri()};if(b.get("text-variable-anchor")){let Ri=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[bt]){const wn=this.prevPlacement.variableOffsets[bt];Ri.indexOf(wn.anchor)>0&&(Ri=Ri.filter(Di=>Di!==wn.anchor),Ri.unshift(wn.anchor))}const zn=(wn,Di,nr)=>{const Ja=_.getSymbolInstanceTextSize($,$e,this.transform.zoom,it),mr=(wn.x2-wn.x1)*Ja+2*wn.padding,Vr=(wn.y2-wn.y1)*Ja+2*wn.padding,Mr=$e.hasIconTextFit&&!re?Di:null;Mr&&zi(Mr);let qa={box:[],offscreen:!1,occluded:!1};const hs=se?2*Ri.length:Ri.length;for(let Ur=0;Ur<hs;++Ur){const ds=this.attemptAnchorPlacement(Ri[Ur%Ri.length],wn,mr,Vr,Ja,ae,ue,z,T,q,Ur>=Ri.length,$e,it,_,nr,Mr,$,U);if(ds&&(qa=ds.placedGlyphBoxes,qa&&qa.box&&qa.box.length)){Rt=!0,ji=ds.shift;break}}return qa};hn(()=>zn(Dn,wt.iconBox,o.bI.horizontal),()=>{const wn=wt.verticalTextBox;return wn&&zi(wn),_.allowVerticalPlacement&&!(qi&&qi.box&&qi.box.length)&&ft>0&&wn?zn(wn,wt.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),qi&&(Rt=qi.box,si=qi.offscreen,Ni=qi.occluded);const ga=Qi(!(!qi||!qi.box));if(!Rt&&this.prevPlacement){const wn=this.prevPlacement.variableOffsets[bt];wn&&(this.variableOffsets[bt]=wn,this.markUsedJustification(_,wn.anchor,$e,ga))}}else{const Ri=(zn,ga)=>{const wn=_.getSymbolInstanceTextSize($,$e,this.transform.zoom,it,f),Di=this.collisionIndex.placeCollisionBox(_,wn,zn,new o.P(0,0),se,z,T,q.predicate);return Di&&Di.box&&Di.box.length&&(this.markUsedOrientation(_,ga,$e),this.placedOrientations[bt]=ga),Di};hn(()=>Ri(Dn,o.bI.horizontal),()=>{const zn=wt.verticalTextBox;return _.allowVerticalPlacement&&ft>0&&zn?(zi(zn),Ri(zn,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Qi(!!(qi&&qi.box&&qi.box.length))}}if(ei=qi,Rt=ei&&ei.box&&ei.box.length>0,si=ei&&ei.offscreen,Ni=ei&&ei.occluded,$e.useRuntimeCollisionCircles){const Qi=_.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex>=0?$e.centerJustifiedTextSymbolIndex:$e.verticalPlacedTextSymbolIndex),hn=o.bJ(_.textSizeData,$,Qi),Ri=b.get("text-padding");hi=this.collisionIndex.placeCollisionCircles(_,se,Qi,_.lineVertexArray,_.glyphOffsetArray,hn,T,M,I,u,ue,q.predicate,$e.collisionCircleDiameter*hn/o.bO,Ri,this.retainedQueryData[_.bucketInstanceId].tileID),Rt=se||hi.circles.length>0&&!hi.collisionDetected,si=si&&hi.offscreen,Ni=hi.occluded}if(wt.iconFeatureIndex&&(rn=wt.iconFeatureIndex),wt.iconBox){const Qi=hn=>{zi(hn);const Ri=$e.hasIconTextFit&&ji?Li(ji.x,ji.y,ae,ue,this.transform.angle):new o.P(0,0),zn=_.getSymbolInstanceIconSize(U,this.transform.zoom,$e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,zn,hn,Ri,re,z,T,q.predicate)};Fn&&Fn.box&&Fn.box.length&&wt.verticalIconBox?(vi=Qi(wt.verticalIconBox),Jt=vi.box.length>0):(vi=Qi(wt.iconBox),Jt=vi.box.length>0),si=si&&vi.offscreen,an=vi.occluded}const Ti=ne||$e.numHorizontalGlyphVertices===0&&ft===0,jn=le||$e.numIconVertices===0;if(Ti||jn?jn?Ti||(Jt=Jt&&Rt):Rt=Jt&&Rt:Jt=Rt=Jt&&Rt,Rt&&ei&&ei.box&&this.collisionIndex.insertCollisionBox(ei.box,b.get("text-ignore-placement"),_.bucketInstanceId,Fn&&Fn.box&&Gn?Gn:un,q.ID),Jt&&vi&&this.collisionIndex.insertCollisionBox(vi.box,b.get("icon-ignore-placement"),_.bucketInstanceId,rn,q.ID),hi&&(Rt&&this.collisionIndex.insertCollisionCircles(hi.circles,b.get("text-ignore-placement"),_.bucketInstanceId,un,q.ID),u)){const Qi=_.bucketInstanceId;let hn=this.collisionCircleArrays[Qi];hn===void 0&&(hn=this.collisionCircleArrays[Qi]=new Kd);for(let Ri=0;Ri<hi.circles.length;Ri+=4)hn.circles.push(hi.circles[Ri+0]),hn.circles.push(hi.circles[Ri+1]),hn.circles.push(hi.circles[Ri+2]),hn.circles.push(hi.collisionDetected?1:0)}const cn=_.projection.name!=="globe";fe=fe&&(cn||!Ni),je=je&&(cn||!an),this.placements[bt]=new hr(Rt||fe,Jt||je,si||_.justReloaded),a.add(bt)},at=this.retainedQueryData[_.bucketInstanceId].tileID;if(_.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(_,at),_.elevationType==="road"&&_.updateRoadElevation(at.canonical),_.updateZOffset(),_.sortFeaturesByY){const $e=_.getSortedSymbolIndexes(this.transform.angle);for(let it=$e.length-1;it>=0;--it){const wt=$e[it];Je(_.symbolInstances.get(wt),wt,_.collisionArrays[wt])}_.hasAnyZOffset&&o.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const $e=_.getSortedIndexesByZOffset();for(let it=0;it<$e.length;++it){const wt=$e[it];Je(_.symbolInstances.get(wt),wt,_.collisionArrays[wt])}}else for(let $e=t.symbolInstanceStart;$e<t.symbolInstanceEnd;$e++)Je(_.symbolInstances.get($e),$e,_.collisionArrays[$e]);if(u&&_.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[_.bucketInstanceId];o.bi($e.invProjMatrix,T),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,a,u,p){const{leftJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:x,crossTileID:T}=u,M=o.bV(a),I=p===o.bI.vertical?x:M==="left"?f:M==="center"?_:M==="right"?b:-1;f>=0&&(t.text.placedSymbolArray.get(f).crossTileID=I>=0&&f!==I?0:T),_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=I>=0&&_!==I?0:T),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=I>=0&&b!==I?0:T),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=I>=0&&x!==I?0:T)}markUsedOrientation(t,a,u){const p=a===o.bI.horizontal||a===o.bI.horizontalOnly?a:0,f=a===o.bI.vertical?a:0,{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:T}=u,M=t.text.placedSymbolArray;_>=0&&(M.get(_).placedOrientation=p),b>=0&&(M.get(b).placedOrientation=p),x>=0&&(M.get(x).placedOrientation=p),T>=0&&(M.get(T).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(t):1,f=a?a.opacities:{},_=a?a.variableOffsets:{},b=a?a.placedOrientations:{};for(const x in this.placements){const T=this.placements[x],M=f[x];M?(this.opacities[x]=new Rs(M,p,T.text,T.icon,null,T.clipped),u=u||T.text!==M.text.placed||T.icon!==M.icon.placed):(this.opacities[x]=new Rs(null,p,T.text,T.icon,T.skipFade,T.clipped),u=u||T.text||T.icon)}for(const x in f){const T=f[x];if(!this.opacities[x]){const M=new Rs(T,p,!1,!1);M.isHidden()||(this.opacities[x]=M,u=u||T.text.placed||T.icon.placed)}}for(const x in _)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=_[x]);for(const x in b)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=b[x]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,u,p){const f=new Set;for(const _ of a){const b=_.getBucket(t);b&&_.latestFeatureIndex&&t.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,f,_,_.collisionBoxArray,u,p,_.tileID,t.scope),b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,_.tileID),b.elevationType==="road"&&b.updateRoadElevation(_.tileID.canonical),b.updateZOffset())}}updateBucketOpacities(t,a,u,p,f,_,b,x){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const T=t.layers[0].layout,M=t.layers[0].paint,I=!!t.layers[0].dynamicFilter(),C=new Rs(null,0,!1,!1,!0),z=T.get("text-allow-overlap"),O=T.get("icon-allow-overlap"),N=T.get("text-variable-anchor"),$=T.get("text-rotation-alignment")==="map",U=T.get("text-pitch-alignment")==="map",q=M.get("symbol-z-offset"),Q=T.get("symbol-elevation-reference")==="sea",ne=!q.isConstant(),le=new Rs(null,0,z&&(O||!t.hasIconData()||T.get("icon-optional")),O&&(z||!t.hasTextData()||T.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const se=(ae,ue,he)=>{for(let xe=0;xe<ue/4;xe++)ae.opacityVertexArray.emplaceBack(he)};let re=0;_&&t.updateReplacement(b,_);for(let ae=0;ae<t.symbolInstances.length;ae++){const ue=t.symbolInstances.get(ae),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:xe,crossTileID:ke,numIconVertices:Ne,tileAnchorX:Fe,tileAnchorY:Ge}=ue;let be=null;const ze=this.retainedQueryData[t.bucketInstanceId];ne&&ue&&ze&&(be=u.latestFeatureIndex.loadFeature({featureIndex:ue.featureIndex,bucketIndex:ze.bucketIndex,sourceLayerIndex:ze.sourceLayerIndex,layoutVertexArrayOffset:0}));const fe=q.evaluate(be,{}),je=a.has(ke);let Pe=this.opacities[ke];je?Pe=C:Pe||(Pe=le,this.opacities[ke]=Pe),a.add(ke);const Je=he>0||xe>0,at=Ne>0,$e=this.placedOrientations[ke],it=$e===o.bI.vertical,wt=$e===o.bI.horizontal||$e===o.bI.horizontalOnly;!Je&&!at||Pe.isHidden()||re++;let bt=!1;if((Je||at)&&_)for(const ft of t.activeReplacements){if(o.bP(ft,f,o.bQ.Symbol,x)||ft.min.x>Fe||Fe>ft.max.x||ft.min.y>Ge||Ge>ft.max.y)continue;const Et=o.bR(Fe,Ge,b.canonical,ft.footprintTileId.canonical);if(bt=o.bS(Et,ft.footprint),bt)break}if(Je){const ft=bt?Zo:vl(Pe.text);se(t.text,he,it?Zo:ft),se(t.text,xe,wt?Zo:ft);const Et=Pe.text.isHidden(),{leftJustifiedTextSymbolIndex:Dt,centerJustifiedTextSymbolIndex:Rt,rightJustifiedTextSymbolIndex:Jt,verticalPlacedTextSymbolIndex:si}=ue,Ni=t.text.placedSymbolArray,an=Et||it?1:0;Dt>=0&&(Ni.get(Dt).hidden=an),Rt>=0&&(Ni.get(Rt).hidden=an),Jt>=0&&(Ni.get(Jt).hidden=an),si>=0&&(Ni.get(si).hidden=Et||wt?1:0);const ji=this.variableOffsets[ke];ji&&this.markUsedJustification(t,ji.anchor,ue,$e);const qi=this.placedOrientations[ke];qi&&(this.markUsedJustification(t,"left",ue,qi),this.markUsedOrientation(t,qi,ue))}if(at){const ft=bt?Zo:vl(Pe.icon),{placedIconSymbolIndex:Et,verticalPlacedIconSymbolIndex:Dt}=ue,Rt=t.icon.placedSymbolArray,Jt=Pe.icon.isHidden()?1:0;Et>=0&&(se(t.icon,Ne,it?Zo:ft),Rt.get(Et).hidden=Jt),Dt>=0&&(se(t.icon,ue.numVerticalIconVertices,wt?Zo:ft),Rt.get(Dt).hidden=Jt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ft=t.collisionArrays[ae];if(ft){let Et=new o.P(0,0),Dt=!0;if(ft.textBox||ft.verticalTextBox){if(N){const Jt=this.variableOffsets[ke];Jt?(Et=Ji(Jt.anchor,Jt.width,Jt.height,Jt.textOffset,Jt.textScale),$&&Et._rotate(U?this.transform.angle:-this.transform.angle)):Dt=!1}I&&(Dt=!Pe.clipped),ft.textBox&&wo(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!Dt||it,fe,Q,Et.x,Et.y),ft.verticalTextBox&&wo(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!Dt||wt,fe,Q,Et.x,Et.y)}const Rt=Dt&&!!(!wt&&ft.verticalIconBox);ft.iconBox&&wo(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,Rt,fe,Q,ue.hasIconTextFit?Et.x:0,ue.hasIconTextFit?Et.y:0),ft.verticalIconBox&&wo(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,!Rt,fe,Q,ue.hasIconTextFit?Et.x:0,ue.hasIconTextFit?Et.y:0)}}}if(t.fullyClipped=re===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ae.invProjMatrix,t.placementViewportMatrix=ae.viewportMatrix,t.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function wo(l,t,a,u,p,f,_){l.emplaceBack(t?1:0,a?1:0,f||0,_||0,u,p?1:0),l.emplaceBack(t?1:0,a?1:0,f||0,_||0,u,p?1:0),l.emplaceBack(t?1:0,a?1:0,f||0,_||0,u,p?1:0),l.emplaceBack(t?1:0,a?1:0,f||0,_||0,u,p?1:0)}const Wi=Math.pow(2,25),rh=Math.pow(2,24),$u=Math.pow(2,17),ju=Math.pow(2,16),La=Math.pow(2,9),Hn=Math.pow(2,8),Ly=Math.pow(2,1);function vl(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,a=Math.floor(127*l.opacity);return a*Wi+t*rh+a*$u+t*ju+a*La+t*Hn+a*Ly+t}const Zo=0;class Vu{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,u,p,f,_){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(b,p,t[this._currentTileIndex],this._sortAcrossTiles,_),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((x,T)=>x.sortKey-T.sortKey));this._currentPartIndex<b.length;){const x=b[this._currentPartIndex];if(a.placeLayerBucketPart(x,this._seenCrossTileIDs,u,x.symbolInstanceStart===0,_),this._currentPartIndex++,f())return!0}return!1}}class oh{constructor(t,a,u,p,f,_,b,x,T){this.placement=new tr(t,f,_,b,x,T),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u,p,f){const _=o.q.now(),b=()=>{const x=o.q.now()-_;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=a[t[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=T)&&(!x.maxzoom||x.maxzoom>T)){const M=x,I=M.layout.get("symbol-z-elevate"),C=M.layout.get("symbol-sort-key").constantOr(1)!==void 0,z=M.layout.get("symbol-z-order"),O=z==="viewport-y"||z==="auto"&&!(z!=="viewport-y"&&C),N=M.layout.get("text-allow-overlap")||M.layout.get("icon-allow-overlap")||M.layout.get("text-ignore-placement")||M.layout.get("icon-ignore-placement"),$=O&&N,U=this._inProgressLayer=this._inProgressLayer||new Vu(M),q=o.C(x.source,x.scope);if(U.continuePlacement(I||$?p[q]:u[q],this.placement,this._showCollisionBoxes,x,b,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Uu=512/o.aj/2;class sh{constructor(t,a,u){this.tileID=t,this.bucketInstanceId=u,this.index=new o.bW(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*o.aj,f=t.canonical.y*o.aj;for(let _=0;_<a.length;_++){const{key:b,crossTileID:x,tileAnchorX:T,tileAnchorY:M}=a.get(_),I=Math.floor((p+T)*Uu),C=Math.floor((f+M)*Uu);this.index.add(I,C),this.keys.push(b),this.crossTileIDs.push(x)}this.index.finish()}findMatches(t,a,u){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),f=Uu/Math.pow(2,a.canonical.z-this.tileID.canonical.z),_=a.canonical.x*o.aj,b=a.canonical.y*o.aj;for(let x=0;x<t.length;x++){const T=t.get(x);if(T.crossTileID)continue;const{key:M,tileAnchorX:I,tileAnchorY:C}=T,z=Math.floor((_+I)*f),O=Math.floor((b+C)*f),N=this.index.range(z-p,O-p,z+p,O+p).sort(($,U)=>$-U);for(const $ of N){const U=this.crossTileIDs[$];if(this.keys[$]===M&&!u.has(U)){u.add(U),T.crossTileID=U;break}}}}}class Ra{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const p=this.indexes[u],f={};for(const _ in p){const b=p[_];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),f[b.tileID.key]=b}this.indexes[u]=f}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<a.symbolInstances.length;f++)a.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const _=this.indexes[f];if(Number(f)>t.overscaledZ)for(const b in _){const x=_[b];x.tileID.isChildOf(t)&&x.findMatches(a.symbolInstances,t,p)}else{const b=_[t.scaledTo(Number(f)).key];b&&b.findMatches(a.symbolInstances,t,p)}}for(let f=0;f<a.symbolInstances.length;f++){const _=a.symbolInstances.get(f);_.crossTileID||(_.crossTileID=u.generate(),p.add(_.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new sh(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u of a.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const p=this.indexes[u];for(const f in p)t[p[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[f]),delete p[f],a=!0)}return a}}class Ua{constructor(){this.layerIndexes={},this.crossTileIDs=new Ra,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u,p){let f=this.layerIndexes[t.fqid];f===void 0&&(f=this.layerIndexes[t.fqid]=new bo);let _=!1;const b={};p.name!=="globe"&&f.handleWrapJump(u);for(const x of a){const T=x.getBucket(t);T&&t.fqid===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(x.tileID,T,this.crossTileIDs)&&(_=!0),b[T.bucketInstanceId]=!0)}return f.removeStaleBuckets(b)&&(_=!0),_}pruneUnusedLayers(t){const a={};t.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}const Bs=771;class mi{constructor(t,a,u,p){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=u,this.blendEquation=p}}mi.Replace=[1,0,1,0],mi.disabled=new mi(mi.Replace,o.am.transparent,[!1,!1,!1,!1]),mi.unblended=new mi(mi.Replace,o.am.transparent,[!0,!0,!0,!0]),mi.alphaBlended=new mi([1,Bs,1,Bs],o.am.transparent,[!0,!0,!0,!0]),mi.alphaBlendedNonPremultiplied=new mi([770,Bs,770,Bs],o.am.transparent,[!0,!0,!0,!0]),mi.multiply=new mi([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class _t{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}_t.ReadOnly=!1,_t.ReadWrite=!0,_t.disabled=new _t(519,_t.ReadOnly,[0,1]);const kr=7680;class Gt{constructor(t,a,u,p,f,_){this.test=t,this.ref=a,this.mask=u,this.fail=p,this.depthFail=f,this.pass=_}}Gt.disabled=new Gt({func:519,mask:0},0,0,kr,kr,kr);const qn=1029,Ju=2305;class Ft{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}function xl(l,t){const a=o.c1(l,3);o.c3(l,t),o.c7(l,3,a)}function kl(l,t){const a=o.b_([]);return o.b$(a,a,-t),o.c0(a,a,-l),a}function Ko(l,t){const a=[l[0],l[1],0],u=[t[0],t[1],0];if(o.ae(a)>=1e-15){const _=o.au([],a);o.bY(u,_,o.bG(u,_)),t[0]=u[0],t[1]=u[1]}const p=o.bF([],t,l);if(o.bZ(p)<1e-15)return null;const f=Math.atan2(-p[1],p[0]);return kl(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),f)}Ft.disabled=new Ft(!1,qn,Ju),Ft.backCCW=new Ft(!0,qn,Ju),Ft.backCW=new Ft(!0,qn,2304),Ft.frontCW=new Ft(!0,1028,2304),Ft.frontCCW=new Ft(!0,1028,Ju);class kf{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof o.ac?t:new o.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=o.bX(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(t)):0,f=o.ac.fromLngLat(t,p),_=[f.x-u.x,f.y-u.y,f.z-u.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ko(_,a)}setPitchBearing(t,a){this.orientation=kl(o.al(t),o.al(-a))}}class Ar{constructor(t,a){this._transform=o.bx([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new o.ac(t[0],t[1],t[2])}get position(){const t=o.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&o.c7(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.b_([]),t&&xl(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=kl(t,a),xl(this._transform,this._orientation)}forward(){const t=o.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const u=new Float64Array(16);return o.bi(u,this.getWorldToCamera(t,a)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,u){const p=this.position;o.bY(p,p,-t);const f=new Float64Array(16);return o.bn(f,[u,u,u]),o.bo(f,f,p),f[10]*=a,f}getWorldToCamera(t,a){const u=new Float64Array(16),p=new Float64Array(4),f=this.position;return o.c2(p,this._orientation),o.bY(f,f,-t),o.c3(u,p),o.bo(u,u,f),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=a,u[9]*=a,u[10]*=a,u[11]*=a,u}getCameraToClipPerspective(t,a,u,p){const f=new Float64Array(16);return o.c4(f,t,a,u,p),f}getCameraToClipOrthographic(t,a,u,p,f,_){const b=new Float64Array(16);return o.c5(b,t,a,u,p,f,_),b}getDistanceToElevation(t,a=!1){const u=t===0?0:o.c6(t,a?o.aY(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new Ar([...this.position],[...this.orientation])}}const Ba={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class qu{constructor(t=0,a=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=p}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=o.ai(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=o.ai(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=o.ai(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=o.ai(t.right,a.right,u)),this}getCenter(t,a){const u=o.ay((this.left+t-this.right)/2,0,t),p=o.ay((this.top+a-this.bottom)/2,0,a);return new o.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new qu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ca=15;class Xd{constructor(t,a,u,p,f,_,b){this.tileSize=512,this._renderWorldCopies=f===void 0||f,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(_),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new o.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ar,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Xd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ca}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=o.ce(this.projectionOptions);const u=this.getProjection(),p=!o.bv(a,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.ce({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=o.cf(),o.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=o.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,f=0;for(let _=0;_<a.length;_++){const b=new o.P(a[_][0]*this.width,u+a[_][1]*(this.height-u)),x=t.pointCoordinate(b);if(!x)continue;const T=1/Math.hypot(x[0]-this._camera.position[0],x[1]-this._camera.position[1]);p+=x[3]*T,f+=T}return f===0?NaN:p/f}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*a,p=this._mercatorZfromZoom(t),f=this._mercatorZfromZoom(this._maxZoom),_=Math.max(p-u,f);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const p=o.ae(o.at([],this._camera.position,u));return o.ay(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!o.ch(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];o.ci(u,this._camera.position)||(this._setCameraPosition(u),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new kf;return a.position=new o.ac(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!o.cj(t))return!1;o.ck(t,t);const a=o.cl([],[0,0,-1],t),u=o.cl([],[0,-1,0],t);if(u[2]<0)return!1;const p=Ko(a,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=o.ay(t[2],p/u,p/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new o.cm(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),f=this.pointCoordinate(new o.P(this.width,this.height)),_=this.pointCoordinate(new o.P(0,this.height)),b=Math.floor(Math.min(u.x,p.x,f.x,_.x)),x=Math.floor(Math.max(u.x,p.x,f.x,_.x)),T=1;for(let M=b-T;M<=x+T;M++)M!==0&&a.push(new o.cm(M,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,u){let p=[];const f=u!=null,_=!f;if(_&&this.zoom<a||f&&u[0]===0&&u[1]===0)return p;const b=new Set,x=(M,I,C,z,O)=>{const N=o.cK(I,M,C,z,O);b.has(N)||(p.push(new o.aM(M,I,C,z,O)),b.add(N))};for(let M=0;M<t.length;M++){const I=t[M];if(_&&I.canonical.z!==a)continue;const C=I.canonical,z=I.overscaledZ,O=I.wrap,N=1<<C.z,$=C.x+1<N,U=C.x>0,q=C.y+1<N,Q=C.y>0,ne=I.wrap-(U?0:1),le=I.wrap+($?0:1),se=U?C.x-1:N-1,re=$?C.x+1:0;if(f)u[0]<0?(x(z,le,C.z,re,C.y),u[1]<0&&q&&(x(z,O,C.z,C.x,C.y+1),x(z,le,C.z,re,C.y+1)),u[1]>0&&Q&&(x(z,O,C.z,C.x,C.y-1),x(z,le,C.z,re,C.y-1))):u[0]>0?(x(z,ne,C.z,se,C.y),u[1]<0&&q&&(x(z,O,C.z,C.x,C.y+1),x(z,ne,C.z,se,C.y+1)),u[1]>0&&Q&&(x(z,O,C.z,C.x,C.y-1),x(z,ne,C.z,se,C.y-1))):u[1]<0&&q?x(z,O,C.z,C.x,C.y+1):Q&&x(z,O,C.z,C.x,C.y-1);else{const ae=I.visibleQuadrants;1&ae&&(x(z,ne,C.z,se,C.y),Q&&(x(z,O,C.z,C.x,C.y-1),x(z,ne,C.z,se,C.y-1))),2&ae&&(x(z,le,C.z,re,C.y),Q&&(x(z,O,C.z,C.x,C.y-1),x(z,le,C.z,re,C.y-1))),4&ae&&(x(z,ne,C.z,se,C.y),q&&(x(z,O,C.z,C.x,C.y+1),x(z,ne,C.z,se,C.y+1))),8&ae&&(x(z,le,C.z,re,C.y),q&&(x(z,O,C.z,C.x,C.y+1),x(z,le,C.z,re,C.y+1)))}}const T=[];for(const M of p)p.some(I=>M.isChildOf(I))||T.push(M);if(p=T.filter(M=>!t.some(I=>!!(M.overscaledZ<a&&I.isChildOf(M))||M.equals(I)||M.isChildOf(I))),_){const M=1<<a,I=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),C=[M*I.x,M*I.y],z=4,O=z*z;p=p.filter(N=>{const $=N.canonical.x+.5-C[0],U=N.canonical.y+.5-C[1];return $*$+U*U<O})}return p}coveringTiles(t){let a=this.coveringZoomLevel(t);const u=a,p=this.elevation&&this.elevation.exaggeration(),f=p&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const b=this.locationCoordinate(this.center),x=this.center.lat,T=1<<a,M=[T*b.x,T*b.y,0],I=this.projection.name==="globe",C=!I,z=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,C),O=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=T*o.c6(1,this.center.lat),$=this._camera.position[2]/o.c6(1,this.center.lat),U=[T*O.x,T*O.y,$*(C?1:N)],q=I||p,Q=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ne=this.isLODDisabled(!0)?a:0;let le;if(this._elevation&&t.isTerrainDEM)le=1e4*this._elevation.exaggeration();else if(this._elevation){const fe=this._elevation.getMinMaxForVisibleTiles();le=fe?fe.max:this._centerAltitude}else le=this._centerAltitude;const se=t.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,re=this.projection.isReprojectedInTileSpace?o.co(this):1,ae=fe=>{const Pe=new o.ac(fe.x+25e-6,fe.y,fe.z),Je=new o.ac(fe.x,fe.y+25e-6,fe.z),at=fe.toLngLat(),$e=Pe.toLngLat(),it=Je.toLngLat(),wt=this.locationCoordinate(at),bt=this.locationCoordinate($e),ft=this.locationCoordinate(it),Et=Math.hypot(bt.x-wt.x,bt.y-wt.y),Dt=Math.hypot(ft.x-wt.x,ft.y-wt.y);return Math.sqrt(Et*Dt)*re/25e-6},ue=fe=>{const je=le,Pe=se;return{aabb:o.cr(this,T,0,0,0,fe,Pe,je,this.projection),zoom:0,x:0,y:0,minZ:Pe,maxZ:je,wrap:fe,fullyVisible:!1}},he=[];let xe=[];const ke=a,Ne=t.reparseOverscaled?u:a,Fe=($-this._centerAltitude)*N,Ge=fe=>{if(!this._elevation||!fe.tileID||!_)return;const je=this._elevation.getMinMaxForTile(fe.tileID),Pe=fe.aabb;je?(Pe.min[2]=je.min,Pe.max[2]=je.max,Pe.center[2]=(Pe.min[2]+Pe.max[2])/2):(fe.shouldSplit=ze(fe),fe.shouldSplit||(Pe.min[2]=Pe.max[2]=Pe.center[2]=this._centerAltitude))},be=(fe,je)=>{if(.707*je<fe)return 1;const Pe=je/fe;return Pe/(1.4144271570014144+(Math.pow(1.1,Pe-1.4144271570014144+1)-1)/(1.1-1)-1)},ze=fe=>{if(fe.zoom<ne)return!0;if(fe.zoom===ke)return!1;if(fe.shouldSplit!=null)return fe.shouldSplit;const je=fe.aabb.distanceX(U),Pe=fe.aabb.distanceY(U);let Je=Fe,at=1;if(I){Je=fe.aabb.distanceZ(U);const Dt=Math.pow(2,fe.zoom),Rt=o.aY((fe.y+1)/Dt),Jt=o.aY(fe.y/Dt),si=Math.min(Math.max(x,Rt),Jt),Ni=o.cO(si)/o.cO(x);if(at=si===x?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ni/this._mercatorScaleRatio),this.zoom<=o.cL&&fe.zoom===ke-1&&Ni>=.9)return!0}else if(f&&(Je=fe.aabb.distanceZ(U)*N),this.projection.isReprojectedInTileSpace&&u<=5){const Dt=Math.pow(2,fe.zoom),Rt=ae(new o.ac((fe.x+.5)/Dt,(fe.y+.5)/Dt));at=Rt>.85?1:Rt}if(!_){const Dt=Math.sqrt(je*je+Pe*Pe+Je*Je);let Rt=(1<<ke-fe.zoom)*Q*at;return Rt*=be(Math.max(Je,Fe),Dt),Dt<Rt}let $e=Number.MAX_VALUE,it=0;const wt=fe.aabb.getCorners(),bt=[];for(const Dt of wt){o.at(bt,Dt,U),I||(f?bt[2]*=N:bt[2]=Fe);const Rt=o.bG(bt,this._camera.forward());Rt<$e&&($e=Rt,it=Math.abs(bt[2]))}let ft=(1<<ke-fe.zoom)*Q*at;if(ft*=be(Math.max(it,Fe),$e),$e<ft)return!0;const Et=fe.aabb.closestPoint(M);return Et[0]===M[0]&&Et[1]===M[1]};if(this.renderWorldCopies)for(let fe=1;fe<=3;fe++)he.push(ue(-fe)),he.push(ue(fe));for(he.push(ue(0));he.length>0;){const fe=he.pop(),je=fe.x,Pe=fe.y;let Je=fe.fullyVisible;const at=()=>this.projection.name==="globe"&&(fe.y===0||fe.y===(1<<fe.zoom)-1);if(!Je){let $e=q?fe.aabb.intersects(z):fe.aabb.intersectsFlat(z);if($e===0&&at()){const it=new o.cp(fe.zoom,je,Pe);$e=o.cq(this,T,it,!0).intersects(z)}if($e===0)continue;Je=$e===2}if(fe.zoom!==ke&&ze(fe))for(let $e=0;$e<4;$e++){const it=(je<<1)+$e%2,wt=(Pe<<1)+($e>>1),bt={aabb:_?fe.aabb.quadrant($e):o.cr(this,T,fe.zoom+1,it,wt,fe.wrap,fe.minZ,fe.maxZ,this.projection),zoom:fe.zoom+1,x:it,y:wt,wrap:fe.wrap,fullyVisible:Je,tileID:void 0,shouldSplit:void 0,minZ:fe.minZ,maxZ:fe.maxZ};f&&!I&&(bt.tileID=new o.aM(fe.zoom+1===ke?Ne:fe.zoom+1,fe.wrap,fe.zoom+1,it,wt),Ge(bt)),he.push(bt)}else{const $e=fe.zoom===ke?Ne:fe.zoom;if(t.minzoom&&t.minzoom>$e)continue;let it=0;if(!Je){let Et=q?fe.aabb.intersectsPrecise(z):fe.aabb.intersectsPreciseFlat(z);if(Et===0&&at()){const Dt=new o.cp(fe.zoom,je,Pe);Et=o.cq(this,T,Dt,!0).intersectsPrecise(z)}if(Et===0)continue;if(t.calculateQuadrantVisibility)if(z.containsPoint(fe.aabb.center))it=15;else for(let Dt=0;Dt<4;Dt++)fe.aabb.quadrant(Dt).intersects(z)!==0&&(it|=1<<Dt)}const wt=M[0]-(.5+je+(fe.wrap<<fe.zoom))*(1<<a-fe.zoom),bt=M[1]-.5-Pe,ft=fe.tileID?fe.tileID:new o.aM($e,fe.wrap,fe.zoom,je,Pe);t.calculateQuadrantVisibility&&(ft.visibleQuadrants=it),xe.push({tileID:ft,distanceSq:wt*wt+bt*bt})}}if(this.fogCullDistSq){const fe=this.fogCullDistSq,je=this.horizonLineFromTop();xe=xe.filter(Pe=>{const Je=[0,0,0,1],at=[o.aj,o.aj,0,1],$e=this.calculateFogTileMatrix(Pe.tileID.toUnwrapped());o.aA(Je,Je,$e),o.aA(at,at,$e);const it=o.cs([],Je,at),wt=o.ct([],Je,at),bt=o.cM(it,wt);if(bt===0)return!0;let ft=!1;const Et=this._elevation;if(Et&&bt>fe&&je!==0){const Dt=this.calculateProjMatrix(Pe.tileID.toUnwrapped());let Rt;t.isTerrainDEM||(Rt=Et.getMinMaxForTile(Pe.tileID)),Rt||(Rt={min:se,max:le});const Jt=o.cu(this.rotation),si=[Jt[0]*o.aj,Jt[1]*o.aj,Rt.max];o.ad(si,si,Dt),ft=(1-si[1])*this.height*.5<je}return bt<fe||ft})}return xe.sort((fe,je)=>fe.distanceSq-je.distanceSq).map(fe=>fe.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=o.ay(t.lat,-85.051129,o.cv),u=this.projection.project(t.lng,a);return new o.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let u,p;const f=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;u=(a.x-f.x)/b,p=(a.y-f.y)/b}else{const b=this.pointCoordinate(a),x=this.pointCoordinate(f);u=b.x-x.x,p=b.y-x.y}const _=this.locationCoordinate(t);this.setLocation(new o.ac(_.x-u,_.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const u=a?o.c6(a,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new o.ac(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const u=a??this._centerAltitude,p=[t.x,t.y,0,1],f=[t.x,t.y,1,1];o.aA(p,p,this.pixelMatrixInverse),o.aA(f,f,this.pixelMatrixInverse);const _=f[3];o.cw(p,p,1/p[3]),o.cw(f,f,1/_);const b=p[2],x=f[2];return{p0:p,p1:f,t:b===x?0:(u-b)/(x-b)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return o.aA(a,a,this.pixelMatrixInverse),o.aA(u,u,this.pixelMatrixInverse),o.cw(a,a,1/a[3]),o.cw(u,u,1/u[3]),a[2]=o.c6(a[2],this._center.lat)*this.worldSize,u[2]=o.c6(u[2],this._center.lat)*this.worldSize,o.cw(a,a,1/this.worldSize),o.cw(u,u,1/this.worldSize),new o.av([a[0],a[1],a[2]],o.au([],o.at([],u,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:u,t:p}=t,f=o.c6(a[2],this._center.lat),_=o.c6(u[2],this._center.lat);return new o.ac(o.ai(a[0],u[0],p)/this.worldSize,o.ai(a[1],u[1],p)/this.worldSize,o.ai(f,_,p))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new o.ac(u[0],u[1],u[2]);let p=0,f=this.horizonLineFromTop();if(t.y>f)return this.pointCoordinate(t,a);const _=.02*f,b=t.clone();for(let x=0;x<10&&f-p>_;x++){b.y=o.ai(p,f,.66);const T=this.projection.pointCoordinate3D(this,b.x,b.y);T?(f=b.y,u=T):p=b.y}return u?new o.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cx)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const u=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return o.aA(p,p,this.pixelMatrix),p[3]>0?new o.P(p[0]/p[3],p[1]/p[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,f=this.pointLocation3D(new o.P(a,t)),_=this.pointLocation3D(new o.P(p,t)),b=this.pointLocation3D(new o.P(p,u)),x=this.pointLocation3D(new o.P(a,u));let T=Math.min(f.lng,_.lng,b.lng,x.lng),M=Math.max(f.lng,_.lng,b.lng,x.lng),I=Math.min(f.lat,_.lat,b.lat,x.lat),C=Math.max(f.lat,_.lat,b.lat,x.lat);const z=Math.pow(2,-this.zoom)/16*270,O=this.projection.name==="globe"?1:4,N=($,U,q,Q,ne)=>{const le=($+q)/2,se=(U+Q)/2,re=new o.P(le,se),{lng:ae,lat:ue}=this.pointLocation3D(re),he=Math.max(0,T-ae,I-ue,ae-M,ue-C);T=Math.min(T,ae),M=Math.max(M,ae),I=Math.min(I,ue),C=Math.max(C,ue),(ne<O||he>z)&&(N($,U,le,se,ne+1),N(le,se,q,Q,ne+1))};if(N(a,t,p,t,1),N(p,t,p,u,1),N(p,u,a,u,1),N(a,u,a,t,1),this.projection.name==="globe"){const[$,U]=o.cy(this);$?(C=90,M=180,T=-180):U&&(I=-90,M=180,T=-180)}return new o.aG(new o.cd(T,I),new o.cd(M,C))}_getBoundsRectangular(t,a){const{top:u,left:p}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,b=new o.P(p,u),x=new o.P(_,u),T=new o.P(_,f),M=new o.P(p,f);let I=this.pointCoordinate(b,t),C=this.pointCoordinate(x,t);const z=this.pointCoordinate(T,a),O=this.pointCoordinate(M,a),N=($,U)=>(U.y-$.y)/(U.x-$.x);return I.y>1&&C.y>=0?I=new o.ac((1-O.y)/N(O,I)+O.x,1):I.y<0&&C.y<=1&&(I=new o.ac(-O.y/N(O,I)+O.x,0)),C.y>1&&I.y>=0?C=new o.ac((1-z.y)/N(z,C)+z.x,1):C.y<0&&I.y<=1&&(C=new o.ac(-z.y/N(z,C)+z.x,0)),new o.aG().extend(this.coordinateLocation(I)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(z))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const f=p.dem.tree;u.min=Math.min(u.min,f.minimums[0]),u.max=Math.max(u.max,f.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=o.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,u=this._distanceTileDataCache;if(u[a])return u[a];const p=t.canonical,f=1/this.height,_=this.cameraWorldSize,b=_/this.zoomScale(p.z),x=(p.x+Math.pow(2,p.z)*t.wrap)*b,T=p.y*b,M=this.point;M.x*=_/this.worldSize,M.y*=_/this.worldSize;const I=this.angle,C=Math.sin(-I),z=-Math.cos(-I);return u[a]={bearing:[C,z],center:[(M.x-x)*f,(M.y-T)*f],scale:b/o.aj*f},u[a]}calculateFogTileMatrix(t){const a=t.key,u=this._fogTileMatrixCache;if(u[a])return u[a];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.az(p,this.worldToFogMatrix,p),u[a]=new Float32Array(p),u[a]}calculateProjMatrix(t,a=!1,u=!1){const p=t.key;let f;if(f=u?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,f[p])return f[p];const _=this.calculatePosMatrix(t,this.worldSize);let b;return b=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,o.az(_,b,_),f[p]=new Float32Array(_),f[p]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[a])return u[a];const p=o.cz(t,this);return u[a]=p,u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=o.bn([],[t,t,t]);return o.az(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=o.c6(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(a),p=this._camera.forward(),f=o.c6(1,this._center.lat);u[2]/=f,p[2]/=f,o.au(p,p);const _=t.raycast(u,p,t.exaggeration());if(_){const b=o.bE([],u,p,_),x=new o.ac(b[0],b[1],o.c6(b[2],o.aY(b[1]))),T=(x.z+o.ae([x.x-u[0],x.y-u[1],x.z-u[2]*f]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(T),this._centerAltitude=x.toAltitude(),this._center=this.coordinateLocation(x),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,u=o.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),f=a.getAtPointOrZero(new o.ac(...p)),_=this.pixelsPerMeter/this.worldSize*f,b=this._minimumHeightOverTerrain(),x=p[2]-_;if(x<=b)if(x<0||t){const T=this.locationCoordinate(this._center,this._centerAltitude),M=[p[0],p[1],T.z-p[2]],I=o.ae(M);M[2]-=(b-x)/this._pixelsPerMercatorPixel;const C=o.ae(M);if(C===0)return;o.bY(M,M,I/C*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],T.z*this._pixelsPerMercatorPixel-M[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const C=this.center;return C.lat=o.ay(C.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(C.lng=o.ay(C.lng,this.minLng,this.maxLng)),this.center=C,void(this._constraining=!1)}const a=this._unmodified,{x:u,y:p}=this.point;let f=0,_=u,b=p;const x=this.width/2,T=this.height/2,M=this.worldMinY*this.scale,I=this.worldMaxY*this.scale;if(p-T<M&&(b=M+T),p+T>I&&(b=I-T),I-M<this.height&&(f=Math.max(f,this.height/(I-M)),b=(I+M)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const C=this.worldMinX*this.scale,z=this.worldMaxX*this.scale,O=this.worldSize/2-(C+z)/2;_=(u+O+this.worldSize)%this.worldSize-O,_-x<C&&(_=C+x),_+x>z&&(_=z-x),z-C<this.width&&(f=Math.max(f,this.width/(z-C)),_=(z+C)/2)}_===u&&b===p||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(_,b))),f&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(f)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.c6(1,this.center.lat)/o.c6(1,o.cP));const p=o.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const f=this.projection.zAxisUnit==="meters"?u:1,_=this._camera.getWorldToCamera(this.worldSize,f);let b;const x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(x[8]=2*-t.x/this.width,x[9]=2*t.y/this.height,this.isOrthographic){let ue=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),he=ue*this.aspect,xe=-he,ke=-ue;he-=t.x,xe-=t.x,ue+=t.y,ke+=t.y,b=this._camera.getCameraToClipOrthographic(xe,he,ke,ue,this._nearZ,this._farZ),((Ne,Fe,Ge,be)=>{for(let ze=0;ze<16;ze++)Ne[ze]=o.ai(Fe[ze],Ge[ze],be)})(b,b,x,o.cN(this.pitch>=ca?1:this.pitch/ca))}else b=x;const T=o.cB([],x,_);let M=o.cB([],b,_);if(this.projection.isReprojectedInTileSpace){const ue=this.locationCoordinate(this.center),he=o.bx([]);o.bo(he,he,[ue.x*this.worldSize,ue.y*this.worldSize,0]),o.az(he,he,o.cC(this)),o.bo(he,he,[-ue.x*this.worldSize,-ue.y*this.worldSize,0]),o.az(M,M,he),o.az(T,T,he),this.inverseAdjustmentMatrix=o.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cE([],M,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=M,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),a){const ue=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ue[8]=2*-t.x/this.width,ue[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cB([],ue,_)}else this.expandedFarZProjMatrix=this.projMatrix;const I=o.bi([],b);this.frustumCorners=o.cF.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const C=new Float32Array(16);o.bx(C),o.cE(C,C,[1,-1,1]),o.cG(C,C,this._pitch),o.by(C,C,this.angle);const z=o.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(z);const O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-t.x/this.width,z[9]=2*(t.y+O)/this.height,this.skyboxMatrix=o.az(C,z,C);const N=this.point,$=N.x,U=N.y,q=this.width%2/2,Q=this.height%2/2,ne=Math.cos(this.angle),le=Math.sin(this.angle),se=$-Math.round($)+ne*q+le*Q,re=U-Math.round(U)+ne*Q+le*q,ae=new Float64Array(M);if(o.bo(ae,ae,[se>.5?se-1:se,re>.5?re-1:re,0]),this.alignedProjMatrix=ae,M=o.bz(),o.cE(M,M,[this.width/2,-this.height/2,1]),o.bo(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=o.bz(),o.cE(M,M,[1,-1,1]),o.bo(M,M,[-1,-1,0]),o.cE(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,T),this._calcFogMatrices(),this._distanceTileDataCache={},M=o.bi(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cH(this);const ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(ue,ue,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,f=[t,t,a];o.bY(f,f,p),o.bY(u,u,-1),o.cI(u,u,f);const _=o.bz();o.bo(_,_,u),o.cE(_,_,f),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,p)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,f=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*f,p.y/this.worldSize-u[1]*f,t/this.worldSize*this._centerAltitude-u[2]*f]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let f=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(f=Math.min((a-u)/p,1)),this._camera.position=o.bE([],this._camera.position,t,f),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),f=o.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),b=Math.max((t[2]-f)/Math.cos(u),_),x=this._zoomFromMercatorZ(b);o.bE(t,t,a,b),this._pitch=o.ay(u,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bX(p,-Math.PI,Math.PI),this._setZoom(o.ay(x,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,u=o.cx,p=0,f=1/0;for(;u-a>1e-6&&u>a;){const _=a+.5*(u-a),b=this.tileSize*Math.pow(2,_),x=this.getCameraToCenterDistance(this.projection,_,b),T=this.scaleZoom(x/(Math.max(0,t)*this.tileSize)),M=Math.abs(_-T);M<f&&(f=M,p=_),_<T?a=_:u=_}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const u=Math.min(t.x,a.x),p=Math.max(t.x,a.x),f=Math.min(t.y,a.y),_=Math.max(t.y,a.y);if(f<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new o.P(u,f),new o.P(p,_),new o.P(u,_),new o.P(p,f)],x=this.renderWorldCopies?-3:0,T=this.renderWorldCopies?4:1;for(const M of b){const I=this.pointRayIntersection(M);if(I.t<0)return!0;const C=this.rayIntersectionCoordinate(I);if(C.x<x||C.y<0||C.x>T||C.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,a){const u=o.ae(o.at([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+a;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([a,u,p],f){const _=[a,u,p,1];o.aA(_,_,f);const b=_[3]=Math.max(_[3],1e-6);return _[0]/=b,_[1]/=b,_[2]/=b,_}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,u=this.worldSize){const p=o.cA(t,a,this.width,this.height,1024),f=t.pixelSpaceConversion(this.center.lat,u,p);let _=.5/Math.tan(.5*this._fov)*this.height*f;return this.isOrthographic&&(_=o.ai(1,_,o.cN(this.pitch>=ca?1:this.pitch/ca))),_}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(t,t,this.globeMatrix),t}getFrustum(t){return o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Qr=(l,t)=>{if(t>0&&l.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=l.transform,u=Math.max(Math.abs(a._zoom-(l.minCutoffZoom-1)),1),p=a.isLODDisabled(!1)?o.af(60,45,a.pitch):o.af(30,15,a.pitch),f=a._farZ-a._nearZ,_=t*a.height,b=((1-(x=p))*a.cameraToCenterDistance+x*(a._farZ+_))*u;var x;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(b-a._nearZ)/f,(b-_-a._nearZ)/f]}}},Sa={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Gu{constructor(t,a){this.aabb=t,this.lastCascade=a}}class Ry{add(t,a){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],a.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],a.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],a.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],a.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],a.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],a.max[2])):this.receivers[t.key]=new Gu(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,u){const p=o.cW.fromPoints(t.points);let f=0;for(const _ in this.receivers){const b=this.receivers[_];if(!b||!p.intersectsAabb(b.aabb))continue;b.aabb.min=p.closestPoint(b.aabb.min),b.aabb.max=p.closestPoint(b.aabb.max);const x=b.aabb.getCorners();for(let T=0;T<u.length;T++){let M=!0;for(const I of x){const C=[I[0]*a,I[1]*a,I[2]];if(o.ad(C,C,u[T].matrix),C[0]<-1||C[0]>1||C[1]<-1||C[1]>1){M=!1;break}}if(b.lastCascade=T,f=Math.max(f,T),M)break}}return f+1}}class By{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ry,this._depthMode=new _t(t.context.gl.LEQUAL,_t.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Sa,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Sa,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Sa,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const p=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((O,N)=>{const $=u.style._mergedLayers[N];return O+($.hasShadowPass()&&!$.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const f=u.context,_=Sa.shadowMapResolution,b=Sa.shadowMapResolution;if(this._cascades.length===0||Sa.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let O=0;O<Sa.cascadeCount;++O){const N=u._shadowMapDebug,$=f.gl,U=f.createFramebuffer(_,b,N,"texture"),q=new o.T(f,{width:_,height:b,data:null},$.DEPTH_COMPONENT16);if(U.depthAttachment.set(q.texture),N){const Q=new o.T(f,{width:_,height:b,data:null},$.RGBA8);U.colorAttachment.set(Q.texture)}this._cascades.push({framebuffer:U,texture:q,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cn,scale:0})}}this.shadowDirection=Al(a);let x=0;if(t.elevation){const O=t.elevation,N=[1e4,-1e4];O.visibleDemTiles.filter($=>$.dem).forEach($=>{const U=$.dem.tree;N[0]=Math.min(N[0],U.minimums[0]),N[1]=Math.max(N[1],U.maximums[0])}),N[0]!==1e4&&(x=(N[1]-N[0])*O.exaggeration())}const T=1.5*t.cameraToCenterDistance,M=3*T,I=new Float64Array(16);for(let O=0;O<this._cascades.length;++O){const N=this._cascades[O];let $=t.height/50,U=1;Sa.cascadeCount===1?U=M:O===0?U=T:($=T,U=M);const[q,Q]=Sl(t,this.shadowDirection,$,U,Sa.shadowMapResolution,x);N.scale=t.scale,N.matrix=q,N.boundingSphereRadius=Q,o.bi(I,N.matrix),N.frustum=o.cn.fromInvProjectionMatrix(I,1,0,!0),N.far=U}const C=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[C].far,this._cascades[C].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Sa.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Sa.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ba.ShadowMap0,this._uniformValues.u_shadowmap_1=Ba.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const z=u.transform.elevation;for(const O of this._groundShadowTiles){let N={min:0,max:0};if(z){const $=z.getMinMaxForTile(O);$&&(N=$)}this.addShadowReceiver(O.toUnwrapped(),N.min,N.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,Sa.shadowMapResolution,Sa.shadowMapResolution]);for(let f=0;f<this._numCascadesToRender;++f){u.currentShadowCascade=f,p.bindFramebuffer.set(this._cascades[f].framebuffer.framebuffer),p.clear({color:o.am.white,depth:1});for(const _ of t.order){const b=t._mergedLayers[_];if(!b.hasShadowPass()||b.isHidden(u.transform.zoom))continue;const x=t.getLayerSourceCache(b),T=x?a[x.id]:void 0;(b.type==="model"||T&&T.length)&&u.renderLayer(u,x,b,T)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,u=t.context,p=u.gl,f=a.directionalLight,_=a.ambientLight;if(!f||!_)return;const b=[],x=Qr(t,t.longestCutoffRange);x.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");const T=Ws(a,f,_),M=new _t(p.LEQUAL,_t.ReadOnly,t.depthRangeFor3D),I=new Gt({func:p.EQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.KEEP);for(const C of this._groundShadowTiles){const z=C.toUnwrapped(),O=t.isTileAffectedByFog(C),N=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:O});this.setupShadows(z,N),t.uploadCommonUniforms(u,N,z,null,x);const $={u_matrix:t.transform.calculateProjMatrix(z),u_ground_shadow_factor:T};N.draw(t,p.TRIANGLES,M,I,mi.multiply,Ft.disabled,$,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?mi.unblended:mi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,u=a.calculatePosMatrix(t,a.worldSize);return o.az(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return o.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,a,u,p=0){if(!this.enabled)return;const f=this.painter.transform,_=this.painter.context,b=_.gl,x=this._uniformValues,T=new Float64Array(16),M=f.calculatePosMatrix(t,f.worldSize);for(let I=0;I<this._cascades.length;I++)o.az(T,this._cascades[I].matrix,M),x[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),_.activeTexture.set(b.TEXTURE0+Ba.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!u,this.useNormalOffset){const I=o.cU(t.canonical),C=2/f.tileSize*o.aj/Sa.shadowMapResolution,z=C*this._cascades[0].boundingSphereRadius,O=C*this._cascades[this._cascades.length-1].boundingSphereRadius,N=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-f.zoom+Math.floor(f.zoom)));x.u_shadow_normal_offset=[I,z*N,O*N],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(_,x)}setupShadowsFromMatrix(t,a,u=!1){if(!this.enabled)return;const p=this.painter.context,f=p.gl,_=this._uniformValues,b=new Float64Array(16);for(let x=0;x<Sa.cascadeCount;x++)o.az(b,this._cascades[x].matrix,t),_[x===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),p.activeTexture.set(f.TEXTURE0+Ba.ShadowMap0+x),this._cascades[x].texture.bindExtraParam(f.LINEAR,f.LINEAR,f.CLAMP_TO_EDGE,f.CLAMP_TO_EDGE,f.GREATER);if(this.useNormalOffset=u,u){const x=Sa.normalOffset;_.u_shadow_normal_offset=[1,x,x],_.u_shadow_bias=[6e-5,.0012,.012]}else _.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(p,_)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,u,p){if(p[2]>=0)return{};const f=function(x,T,M){const I=M/(1<<x.canonical.z);return new o.cW([x.canonical.x*I+x.wrap*M,x.canonical.y*I+x.wrap*M,0],[(x.canonical.x+1)*I+x.wrap*M,(x.canonical.y+1)*I+x.wrap*M,T])}(t,a,u).getCorners(),_=a/-p[2];p[0]<0?(o.cV(f[0],f[0],[p[0]*_,0,0]),o.cV(f[3],f[3],[p[0]*_,0,0])):p[0]>0&&(o.cV(f[1],f[1],[p[0]*_,0,0]),o.cV(f[2],f[2],[p[0]*_,0,0])),p[1]<0?(o.cV(f[0],f[0],[0,p[1]*_,0]),o.cV(f[1],f[1],[0,p[1]*_,0])):p[1]>0&&(o.cV(f[2],f[2],[0,p[1]*_,0]),o.cV(f[3],f[3],[0,p[1]*_,0]));const b={};return b.vertices=f,b.planes=[Xo(f[1],f[0],f[4]),Xo(f[2],f[1],f[5]),Xo(f[3],f[2],f[6]),Xo(f[0],f[3],f[7])],b}addShadowReceiver(t,a,u){this._receivers.add(t,o.cW.fromTileIdAndHeight(t,a,u))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function Xo(l,t,a){const u=o.at([],a,t),p=o.at([],l,t),f=o.bF([],u,p),_=o.ae(f);return _===0?[0,0,1,0]:(o.bY(f,f,1/_),[f[0],f[1],f[2],-o.bG(f,t)])}function Al(l){const t=l.properties.get("direction"),a=o.cR(t.x,t.y,t.z);a[2]=o.ay(a[2],0,75);const u=o.cT([a[0],a[1],a[2]]);return o.cS(u.x,u.y,u.z)}function Ws(l,t,a){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),f=t.properties.get("intensity"),_=t.properties.get("direction"),b=[_.x,_.y,_.z],x=a.properties.get("color-use-theme")==="none",T=a.properties.get("color"),M=a.properties.get("intensity"),I=Math.max(o.bG([0,0,1],b),0),C=[0,0,0];o.bY(C,T.toPremultipliedRenderColor(x?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),M);const z=[0,0,0];return o.bY(z,p.toPremultipliedRenderColor(u?null:l.getLut(a.scope)).toArray01Linear().slice(0,3),I*f),o.cY([C[0]>0?C[0]/(C[0]+z[0]):0,C[1]>0?C[1]/(C[1]+z[1]):0,C[2]>0?C[2]/(C[2]+z[2]):0])}function Sl(l,t,a,u,p,f){const _=l.zoom,b=l.scale,x=l.worldSize,T=1/x,M=l.aspect,I=Math.sqrt(1+M*M)*Math.tan(.5*l.fovX),C=I*I,z=u-a,O=u+a;let N,$;C>z/O?(N=u,$=u*I):(N=.5*O*(1+C),$=.5*Math.sqrt(z*z+2*(u*u+a*a)*C+O*O*C*C));const U=l.projection.pixelsPerMeter(l.center.lat,x),q=l._camera.getCameraToWorldMercator(),Q=[0,0,-N*T];o.ad(Q,Q,q);let ne=$*T;const le=l._edgeInsets;if(!(le.left===0&&le.top===0&&le.right===0&&le.bottom===0||le.left===le.right&&le.top===le.bottom)){const Je=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?U:1),at=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,a,u);at[8]=2*-l.centerOffset.x/l.width,at[9]=2*l.centerOffset.y/l.height;const $e=new Float64Array(16);o.cB($e,at,Je);const it=new Float64Array(16);o.bi(it,$e);const wt=o.cn.fromInvProjectionMatrix(it,x,_,!0);for(const bt of wt.points){const ft=((se=bt)[0]/=b,se[1]/=b,se[2]=o.c6(se[2],l._center.lat),se);ne=Math.max(ne,o.bZ(o.cX([],Q,ft)))}}var se;ne*=p/(p-1);const re=Math.acos(t[2]),ae=Math.atan2(-t[0],-t[1]),ue=new Ar;ue.position=Q,ue.setPitchBearing(re,ae);const he=ue.getWorldToCamera(x,U),xe=ne*x,ke=Math.min(l._mercatorZfromZoom(17)*x*-2,-2*xe),Ne=ue.getCameraToClipOrthographic(-xe,xe,-xe,xe,ke,(xe+f*U)/t[2]),Fe=new Float64Array(16);o.az(Fe,Ne,he);const Ge=o.cS(Math.floor(1e6*Q[0])/1e6*x,Math.floor(1e6*Q[1])/1e6*x,0),be=.5*p,ze=[0,0,0];o.ad(ze,Ge,Fe),o.bY(ze,ze,be);const fe=[Math.floor(ze[0]),Math.floor(ze[1]),Math.floor(ze[2])],je=[0,0,0];o.at(je,ze,fe),o.bY(je,je,-1/be);const Pe=new Float64Array(16);return o.bx(Pe),o.bo(Pe,Pe,je),o.az(Fe,Pe,Fe),[Fe,xe]}class Af extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return o.aS(this.requestManager.transformRequest(a,o.R.Model).url).then(u=>{if(!u)return;const p=o.aT(u),f=new o.aU(t,void 0,void 0,p);return f.computeBoundsAndApplyParent(),f}).catch(u=>{if(u&&u.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${t} from ${a}: ${u.message}`)))})}load(t,a,u={forceReload:!1}){this.models[a]||(this.models[a]={});const p=Object.keys(t),f=[],_=[];for(const b of p){const x=t[b];this.hasURLBeenRequested(x)&&!u.forceReload||(this.modelByURL[x]={modelId:b,scope:a},f.push(this.loadModel(b,x)),_.push(b)),this.models[a][b]||(this.models[a][b]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+_.length,Promise.allSettled(f).then(b=>{for(let x=0;x<b.length;x++){const{status:T}=b[x];if(T==="rejected")continue;const{value:M}=b[x];this.models[a][_[x]]||(this.models[a][_[x]]={model:null,numReferences:1}),this.models[a][_[x]].model=M}this.numModelsLoading[a]-=_.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(b=>{this.fire(new o.z(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===p)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(p)){const{scope:f,modelId:_}=this.modelByURL[p];this.models[f][_].numReferences++}else this.modelUris[u][t]=p,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const u=this.modelUris[a];for(const p in t)u[p]=this.requestManager.normalizeModelURL(t[p])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const u={};for(const p of t)this.hasModel(p,a,{exactIdMatch:!0})||this.hasURLBeenRequested(p)?this.models[a][p].numReferences++:this.modelUris[a][p]&&!this.hasURLBeenRequested(p)?u[p]=this.modelUris[a][p]:!this.hasURLBeenRequested(p)&&o.cZ(p,!1)&&(this.modelUris[a][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[a][p]);this.load(u,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,u=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0)){const p=this.modelUris[a][t];u||delete this.modelUris[a][t],delete this.modelByURL[p];const f=this.models[a][t].model;if(!f)return;delete this.models[a][t],f.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const u=this.models[t][a].model;delete this.models[t][a],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const u in this.models[a])this.models[a][u].model&&this.models[a][u].model.upload(t.context)}}const lh=new o.a7({data:new o.a8(o.a5.colorTheme.data)}),Qd={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function vo(l){return l=l||{},Object.assign(l,Qd)}class Wy extends o.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},o.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new o.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=this._map.transform.width,p=this._map.transform.height,f=u*(2/3),_=p*(2/3),b=.5*(u-f),x=.5*(p-_),T=[new o.P(b,x),new o.P(b+f,x+_)],M=this._map.queryRenderedFeatures(T,a);M.length>0?this._selectedFloorplan&&M[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=M[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,a=t?this._indoorData.buildings.find(b=>b.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,u=this._floorplanStates[this._indoorData.id].selectedLevel,p=this._indoorData.levels.find(b=>b.id===u),f=this._indoorData.levels.find(b=>!(!a||!a.levels)&&Number(b.levelOrder)===0&&a.levels.includes(b.id)),_=p?p.id:f?f.id:void 0;this.fire(new o.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:_})),a&&this._buildingSelected(a,!1),_&&this._levelSelected(_)}_buildingSelected(t,a){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");a&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new o.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){const a=this._indoorData.levels.find(u=>u.id===t);a?(this._updateLevels(a,!0),this.fire(new o.A("levelselected",{levelId:a.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,a){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function u(T){const M=T.indexOf("/floor/");if(M===-1)return T;const I=M+7,C=T.indexOf("/",I);return C===-1?T.slice(I):T.slice(I,C)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const p=[],f={},_={},b={},x={};for(const T of this._indoorData.levels){if(p.push(T.id),f[T.id]=T.levelOrder>=0?3*Math.abs(T.levelOrder+1):3*Math.abs(T.levelOrder),_[T.id]=T.levelOrder>=0?3*T.levelOrder:0,this.mergeFloors){const M=u(t.id),I=u(T.id);b[T.id]=I===M?"true":"false"}else b[T.id]=T.id===t.id?"true":"false";x[T.id]=T.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",f]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,a);if(p.length>0){for(const f of p)if(JSON.parse(f.properties["indoor-data"]).id===t){this._selectedFloorplan=f,this._floorplanSelected();break}}}selectBuilding(t){const a=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(a,!0)}selectLevel(t){this._levelSelected(t)}}function Ny(l){if(!l.metadata||!l.metadata.content_area)return;const t=o.q.devicePixelRatio,{left:a,top:u,width:p,height:f}=l.metadata.content_area,_=a*t,b=u*t;return[_,b,_+p*t,b+f*t]}function Sf(l){if(l)return l.map(([t,a])=>[t*o.q.devicePixelRatio,a*o.q.devicePixelRatio])}class Tf{constructor(t,a,u){this.id=t,this.scope=a,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof Yo))return t;const p=a.map(_=>this.sourceCache.getTile(_)),f=u.getImages(p,Array.from(this.pendingRequests));for(const[_,b]of f)t.set(o.I.from({name:_,iconsetId:this.id}),b),this.pendingRequests.delete(_);for(const _ of this.pendingRequests)this.missingRequests.add(_);return this.pendingRequests.clear(),t}}const Ns=(l,t)=>oe(l,t&&t.filter(a=>a.identifier!=="source.canvas")),ep=o.aF(Mi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Pf=o.aF(Mi,["setCenter","setZoom","setBearing","setPitch"]),uh=new Set(["background","sky","slot","custom"]),tp={version:8,layers:[],sources:{}},ip={duration:300,delay:0};class Ta extends o.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=o.h({},ip),this._buildingIndex=new bf(this),this.crossTileSymbolIndex=new Ua,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Jn,this.dispatcher=a.dispatcher?a.dispatcher:new o.D(o.c$(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new $o(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new o.d0(t._requestManager,a.localFontFamily?o.d1.all:a.localIdeographFontFamily?o.d1.ideographs:o.d1.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Af(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",o.d2());const u=this;this._rtlTextPluginCallback=Ta.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(f,_)=>{if(o.d3(f),_&&_.every(b=>b))for(const b in u._sourceCaches){const x=u._sourceCaches[b],T=x.getSource().type;T!=="vector"&&T!=="geojson"||x.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const f=this.getOwnSource(p.sourceId);if(f&&f.vectorLayerIds)for(const _ in this._layers){const b=this._layers[_];b.source===f.id&&this._validateLayer(b)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.j(t))return t;const a=o.d4(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${o.d5(JSON.stringify(t))}`}_diffStyle(t,a,u){this.globalId=this._getGlobalId(t);const p=(f,_)=>{try{_(null,this.setState(f,u))}catch(b){_(b,!1)}};if(typeof t=="string"){const f=this.map._requestManager.normalizeStyleURL(t),_=this.map._requestManager.transformRequest(f,o.R.Style);o.n(_,(b,x)=>{b?this.fire(new o.z(b)):x&&p(x,a)})}else typeof t=="object"&&p(t,a)}loadURL(t,a={}){this.fire(new o.A("dataloading",{dataType:"style"}));const u=typeof a.validate=="boolean"?a.validate:!o.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const f=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.n(f,(_,b)=>{if(this._request=null,_)this.fire(new o.z(_));else if(b)return this.importsCache.set(t,b),this._load(b,u)})}loadJSON(t,a={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.q.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(tp,!1)}_loadImports(t,a,u){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const f of t){const _=this._createFragmentStyle(f),b=new Promise(M=>{_.once("style.import.load",M),_.once("error",M)}).then(()=>this.mergeAll());if(p.push(b),this.resolvedImports.has(f.url)){_.loadEmpty();continue}const x=f.data||this.importsCache.get(f.url);x?(_.loadJSON(x,{validate:a}),this._isInternalStyle(x)&&(_.globalId=null)):f.url?_.loadURL(f.url,{validate:a}):_.loadEmpty();const T={style:_,id:f.id,config:f.config};if(u){const M=this.fragments.findIndex(({id:I})=>I===u);this.fragments=this.fragments.slice(0,M).concat(T).concat(this.fragments.slice(M))}else this.fragments.push(T)}return Promise.allSettled(p)}getImportGlobalIds(t=this,a=new Set){for(const u of t.fragments)u.style.globalId&&a.add(u.style.globalId),this.getImportGlobalIds(u.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?o.C(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[a];(t.config||p)&&(u=o.h({},t.config,p));const f=new Ta(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return f.setEventedParent(this.map,{style:f}),f}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){const u=t.indoor?vo(t.schema):t.schema;if(this._isInternalStyle(t)){const _=o.h({},tp,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(_,a)}if(this.updateConfig(this._config,u),a&&Ns(this,Qa(t)))return;this._loaded=!0,this.stylesheet=o.d6(t);const p=()=>{for(const T in t.sources)this.addSource(T,t.sources[T],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const T in t.iconsets)this.addIconset(T,t.iconsets[T]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const _=Bu(this.stylesheet.layers);if(this._order=_.map(T=>T.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const T=this.stylesheet.lights[0];this.light=new Se(T.properties,T.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Se(this.stylesheet.light)),this._layers={};for(const T of _){const M=o.db(T,this.scope,this._styleColorTheme.lut,this.options);M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;const I=this.getOwnLayerSourceCache(M),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&M.canCastShadows()&&C&&(I.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const x=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then(()=>{this._reloadImports(),this.fire(new o.A(x?"style.load":"style.import.load"))}).catch(T=>{this.fire(new o.z(new Error("Failed to load imports",T))),this.fire(new o.A(x?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(x?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(f){const _=this._evaluateColorThemeData(f);this._loadColorTheme(_).then(()=>{p()}).catch(b=>{o.w(`Couldn't load color theme from the stylesheet: ${b}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,a,u,p,f,_,b,x,T,M;const I={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(C=>{if(C.stylesheet){if(C.light!=null&&(t=C.light),C.stylesheet.lights)for(const z of C.stylesheet.lights)z.type==="ambient"&&C.ambientLight!=null&&(a=C.ambientLight),z.type==="directional"&&C.directionalLight!=null&&(u=C.directionalLight);p=this._prioritizeTerrain(p,C.terrain,C.stylesheet.terrain),C.stylesheet.fog&&C.fog!=null&&(f=C.fog),C.stylesheet.snow&&C.snow!=null&&(_=C.snow),C.stylesheet.rain&&C.rain!=null&&(b=C.rain),C.stylesheet.camera!=null&&(M=C.stylesheet.camera),C.stylesheet.projection!=null&&(x=C.stylesheet.projection),C.stylesheet.transition!=null&&(T=C.stylesheet.transition),I[C.scope]=C._styleColorTheme}}),this.light=t,this.ambientLight=a,this.directionalLight=u,this.fog=f,this.snow=_,this.rain=b,this._styleColorThemeForScope=I,p===null?delete this.terrain:this.terrain=p,this.camera=M||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=o.h({},ip,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const a=u=>{for(const p of u.fragments)a(p.style);t(u)};a(this)}_prioritizeTerrain(t,a,u){const p=t&&t.drapeRenderMode===0;return u===null?a&&a.drapeRenderMode===0?a:p?t:null:a!=null&&(!t||p||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},u={};this.forEachFragmentStyle(p=>{for(const f in p._sourceCaches){const _=o.C(f,p.scope);t[_]=p._sourceCaches[f]}for(const f in p._otherSourceCaches){const _=o.C(f,p.scope);a[_]=p._otherSourceCaches[f]}for(const f in p._symbolSourceCaches){const _=o.C(f,p.scope);u[_]=p._symbolSourceCaches[f]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},a=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(f=>{for(const _ of f._order){const b=f._layers[_];if(b.type==="slot"){const x=o.d7(_);if(t[x])continue;t[x]=[]}b.slot&&t[b.slot]?t[b.slot].push(b):a.push(b)}}),this._mergedOrder=[];const p=(f=[])=>{for(const _ of f)if(_.type==="slot"){const b=o.d7(_.id);t[b]&&p(t[b]),this._mergedSlots.push(b)}else{const b=o.C(_.id,_.scope);this._mergedOrder.push(b),u[b]=_,_.is3D(!!this.terrain)&&(this._has3DLayers=!0),_.type==="circle"&&(this._hasCircleLayers=!0),_.type==="symbol"&&(this._hasSymbolLayers=!0),_.type==="clip"&&(this._clipLayerPresent=!0)}};p(a),this._mergedOrder.sort((f,_)=>{const b=u[f],x=u[_];return b.hasInitialOcclusionOpacityProperties?x.is3D(!!this.terrain)?1:0:b.is3D(!!this.terrain)&&x.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=o.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(a,u,p,f){const _=o.h({},u);for(const x of Object.keys(o.a5.colorTheme))_[x]===void 0&&(_[x]=o.a5.colorTheme[x].default);const b=new o.a6(lh,a,new Map(p));return b.setTransitionOrValue(_,p),b.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const f="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let _=t;_.startsWith(f)||(_=f+_);const b=o.I.from("mapbox-reserved-lut"),x=new Image;x.src=_,x.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},x.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void u();this._styleColorTheme.lutLoading=!1;const{width:T,height:M,data:I}=o.q.getImageData(x);if(M>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(T!==M*M)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(b)&&this.removeImage(b),this.addImage(b,{data:new o.r({width:T,height:M},I),pixelRatio:1,sdf:!1,usvg:!1,version:0});const C=this.imageManager.getImage(b,this.scope);C?(this._styleColorTheme.lut={image:C.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(a,u,p){let f,_,b;const x=o.q.devicePixelRatio>1?"@2x":"";let T=o.n(u.transformRequest(u.normalizeSpriteURL(a,x,".json"),o.R.SpriteJSON),(C,z)=>{T=null,b||(b=C,f=z,I())}),M=o.o(u.transformRequest(u.normalizeSpriteURL(a,x,".png"),o.R.SpriteImage),(C,z)=>{M=null,b||(b=C,_=z,I())});function I(){if(b)p(b);else if(f&&_){const C=o.q.getImageData(_),z={};for(const O in f){const{width:N,height:$,x:U,y:q,sdf:Q,pixelRatio:ne,stretchX:le,stretchY:se,content:re}=f[O],ae=new o.r({width:N,height:$});o.r.copy(C,ae,{x:U,y:q},{x:0,y:0},{width:N,height:$},null),z[O]={data:ae,pixelRatio:ne,sdf:Q,stretchX:le,stretchY:se,content:re,usvg:!1}}p(null,z)}}return{cancel(){T&&(T.cancel(),T=null),M&&(M.cancel(),M=null)}}}(t,this.map._requestManager,(a,u)=>{if(this._spriteRequest=null,a)this.fire(new o.z(a));else if(u){const p=new Map;for(const f in u)p.set(o.I.from(f),u[f]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const u=this.getOwnSourceCache(a.source);if(!u)return void this.fire(new o.z(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=u.getSource();if(p.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const f=new Tf(t,this.scope,u);this.imageManager.addImageProvider(f,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(f,_)=>{if(this._spriteRequest=null,f)a?this._loadSprite(t):this.fire(new o.z(f));else if(_){const b=new Map;for(const x in _)b.set(o.I.from(x),_[x]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),o.R.Iconset),(f,_)=>{if(f)return void p(f);const b={},x=o.c_(new o.bq(_));for(const T of x.icons){const M={version:1,pixelRatio:o.q.devicePixelRatio,content:Ny(T),stretchX:T.metadata?Sf(T.metadata.stretch_x_areas):void 0,stretchY:T.metadata?Sf(T.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:T};b[T.name]=M}p(null,b)}))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const u=t.sourceLayer;u&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.z(new Error(`Source layer "${u}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,a)=>{const u=this.fragments[a];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const a in this._sourceCaches){const u=this._sourceCaches[a].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const a=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&a.push(p.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new o.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new o.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const f=t.getProgramIds();if(f)for(const _ of f){const b=t.getDefaultProgramParams(_,a.zoom,this._styleColorTheme.lut);b&&(u.style=this,this.fog&&(u._fogVisible=!0,b.overrideFog=!0,u.getOrCreateProgram(_,b)),u._fogVisible=!1,b.overrideFog=!1,u.getOrCreateProgram(_,b),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(b.overrideRtt=!0,u.getOrCreateProgram(_,b)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const x in b){const{updatedIds:T,removedIds:M}=b[x];(T||M)&&(this._updateWorkerLayers(x,T,M),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const f={};for(const b in this._mergedSourceCaches){const x=this._mergedSourceCaches[b];f[b]=x.used,x.used=!1,x.tileCoverLift=0}for(const b of this._mergedOrder){const x=this._mergedLayers[b];if(x.recalculate(t,this._availableImages),!x.isHidden(t.zoom)){const T=this.getLayerSourceCache(x);T&&(T.used=!0,T.tileCoverLift=Math.max(T.tileCoverLift,x.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(x,t)}):this.precompilePrograms(x,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const _=this.imageManager.getPendingImageProviders();for(const b of _)b.sourceCache.used=!0;for(const b in f){const x=this._mergedSourceCaches[b];f[b]!==x.used&&x.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const u=a.resolvePendingRequests(),p=this.getFragmentStyle(a.scope);p&&p.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const u=this._mergedSourceCaches[a].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:a?p._serializeLayers(a):[],scope:t,removedIds:u||[],options:p.options})}setState(t,a){if(this._checkLoaded(),Ns(this,Qa(t)))return!1;(t=o.d6(t)).layers=Bu(t.layers);const u=function(_,b){if(!_)return[{command:Mi.setStyle,args:[b]}];let x=[];try{if(!o.bv(_.version,b.version))return[{command:Mi.setStyle,args:[b]}];if(o.bv(_.center,b.center)||x.push({command:Mi.setCenter,args:[b.center]}),o.bv(_.zoom,b.zoom)||x.push({command:Mi.setZoom,args:[b.zoom]}),o.bv(_.bearing,b.bearing)||x.push({command:Mi.setBearing,args:[b.bearing]}),o.bv(_.pitch,b.pitch)||x.push({command:Mi.setPitch,args:[b.pitch]}),o.bv(_.sprite,b.sprite)||x.push({command:Mi.setSprite,args:[b.sprite]}),o.bv(_.glyphs,b.glyphs)||x.push({command:Mi.setGlyphs,args:[b.glyphs]}),o.bv(_.imports,b.imports)||function(z=[],O=[],N){O=O||[];const $=(z=z||[]).map(Cs),U=O.map(Cs),q=z.reduce(Ho,{}),Q=O.reduce(Ho,{}),ne=$.slice();let le,se,re,ae;for(le=0,se=0;le<$.length;le++)re=$[le],Q.hasOwnProperty(re)?se++:(N.push({command:Mi.removeImport,args:[re]}),ne.splice(ne.indexOf(re,se),1));for(le=0,se=0;le<U.length;le++)re=U[U.length-1-le],ne[ne.length-1-le]!==re&&(q.hasOwnProperty(re)?(N.push({command:Mi.removeImport,args:[re]}),ne.splice(ne.lastIndexOf(re,ne.length-se),1)):se++,ae=ne[ne.length-le],N.push({command:Mi.addImport,args:[Q[re],ae]}),ne.splice(ne.length-le,0,re));for(const ue of O){const he=q[ue.id];he&&(delete he.data,o.bv(he,ue)||N.push({command:Mi.updateImport,args:[ue.id,ue]}))}}(_.imports,b.imports,x),o.bv(_.transition,b.transition)||x.push({command:Mi.setTransition,args:[b.transition]}),o.bv(_.light,b.light)||x.push({command:Mi.setLight,args:[b.light]}),o.bv(_.fog,b.fog)||x.push({command:Mi.setFog,args:[b.fog]}),o.bv(_.snow,b.snow)||x.push({command:Mi.setSnow,args:[b.snow]}),o.bv(_.rain,b.rain)||x.push({command:Mi.setRain,args:[b.rain]}),o.bv(_.projection,b.projection)||x.push({command:Mi.setProjection,args:[b.projection]}),o.bv(_.lights,b.lights)||x.push({command:Mi.setLights,args:[b.lights]}),o.bv(_.camera,b.camera)||x.push({command:Mi.setCamera,args:[b.camera]}),o.bv(_.iconsets,b.iconsets)||function(z,O,N){let $;for($ in O=O||{},z=z||{})z.hasOwnProperty($)&&(O.hasOwnProperty($)||N.push({command:Mi.removeIconset,args:[$]}));for($ in O){if(!O.hasOwnProperty($))continue;const U=O[$];z.hasOwnProperty($)?o.bv(z[$],U)||(N.push({command:Mi.removeIconset,args:[$]}),N.push({command:Mi.addIconset,args:[$,U]})):N.push({command:Mi.addIconset,args:[$,U]})}}(_.iconsets,b.iconsets,x),!o.bv(_["color-theme"],b["color-theme"]))return[{command:Mi.setStyle,args:[b]}];const T={},M=[];(function(z,O,N,$){let U;for(U in O=O||{},z=z||{})z.hasOwnProperty(U)&&(O.hasOwnProperty(U)||yl(U,N,$));for(U in O){if(!O.hasOwnProperty(U))continue;const q=O[U];z.hasOwnProperty(U)?o.bv(z[U],q)||(z[U].type==="geojson"&&q.type==="geojson"&&Iy(z,O,U)?N.push({command:Mi.setGeoJSONSourceData,args:[U,q.data]}):Wu(U,O,N,$)):Qc(U,O,N)}})(_.sources,b.sources,M,T);const I=[];_.layers&&_.layers.forEach(z=>{z.source&&T[z.source]?x.push({command:Mi.removeLayer,args:[z.id]}):I.push(z)});let C=_.terrain;C&&T[C.source]&&(x.push({command:Mi.setTerrain,args:[void 0]}),C=void 0),x=x.concat(M),o.bv(C,b.terrain)||x.push({command:Mi.setTerrain,args:[b.terrain]}),function(z,O,N){O=O||[];const $=(z=z||[]).map(Cs),U=O.map(Cs),q=z.reduce(Ho,{}),Q=O.reduce(Ho,{}),ne=$.slice(),le=Object.create(null);let se,re,ae,ue,he,xe,ke;for(se=0,re=0;se<$.length;se++)ae=$[se],Q.hasOwnProperty(ae)?re++:(N.push({command:Mi.removeLayer,args:[ae]}),ne.splice(ne.indexOf(ae,re),1));for(se=0,re=0;se<U.length;se++)ae=U[U.length-1-se],ne[ne.length-1-se]!==ae&&(q.hasOwnProperty(ae)?(N.push({command:Mi.removeLayer,args:[ae]}),ne.splice(ne.lastIndexOf(ae,ne.length-re),1)):re++,xe=ne[ne.length-se],N.push({command:Mi.addLayer,args:[Q[ae],xe]}),ne.splice(ne.length-se,0,ae),le[ae]=!0);for(se=0;se<U.length;se++)if(ae=U[se],ue=q[ae],he=Q[ae],!le[ae]&&!o.bv(ue,he))if(o.bv(ue.source,he.source)&&o.bv(ue["source-layer"],he["source-layer"])&&o.bv(ue.type,he.type)){for(ke in Nu(ue.layout,he.layout,N,ae,null,Mi.setLayoutProperty),Nu(ue.paint,he.paint,N,ae,null,Mi.setPaintProperty),o.bv(ue.slot,he.slot)||N.push({command:Mi.setSlot,args:[ae,he.slot]}),o.bv(ue.filter,he.filter)||N.push({command:Mi.setFilter,args:[ae,he.filter]}),o.bv(ue.minzoom,he.minzoom)&&o.bv(ue.maxzoom,he.maxzoom)||N.push({command:Mi.setLayerZoomRange,args:[ae,he.minzoom,he.maxzoom]}),ue)ue.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?Nu(ue[ke],he[ke],N,ae,ke.slice(6),Mi.setPaintProperty):o.bv(ue[ke],he[ke])||N.push({command:Mi.setLayerProperty,args:[ae,ke,he[ke]]}));for(ke in he)he.hasOwnProperty(ke)&&!ue.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?Nu(ue[ke],he[ke],N,ae,ke.slice(6),Mi.setPaintProperty):o.bv(ue[ke],he[ke])||N.push({command:Mi.setLayerProperty,args:[ae,ke,he[ke]]}))}else N.push({command:Mi.removeLayer,args:[ae]}),xe=ne[ne.lastIndexOf(ae)+1],N.push({command:Mi.addLayer,args:[he,xe]})}(I,b.layers,x)}catch(T){console.warn("Unable to compute style diff:",T),x=[{command:Mi.setStyle,args:[b]}]}return x}(this.serialize(),t).filter(_=>!(_.command in Pf));if(u.length===0)return!1;const p=u.filter(_=>!(_.command in ep));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);const f=[];return u.forEach(_=>{f.push(this[_.command](..._.args))}),a&&Promise.all(f).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[a,u]of t.entries()){if(this.getImage(a))return this.fire(new o.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,u),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new o.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(t,a,u=!1){this.imageManager.updateImage(t,this.scope,a),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(t,a,u={}){return this._checkLoaded(),this._validate(ie,`models.${t}`,a,null,u)||(this.modelManager.addModel(t,a,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(jd,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=Cu(t,a,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const f=_=>{const b=(_?"symbol:":"other:")+p.id,x=o.C(b,this.scope),T=this._sourceCaches[b]=new Va(x,p,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=T,T.onAdd(this.map)};f(!1),a.type!=="vector"&&a.type!=="geojson"||f(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find(([f,_])=>_.type==="source"&&_.source===t);if(p)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const p of u){const f=o.d7(p.id);delete this._sourceCaches[f],this._changes.discardSourceCacheUpdate(p.id),p.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const u=this.getOwnSourceCache(a);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const u=t[a]._tiles;for(const p in u){const f=u[p];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const f of t){if(this._validate(Ts,"lights",f))return;switch(f.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(f),_.updateTransitions(a)}else this.ambientLight=new $i(f,ai||(ai=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(f),_.updateTransitions(a)}else this.directionalLight=new $i(f,Xi||(Xi=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=Object.assign(a,{worldview:this.map.getWorldview()}),p=new o.aa(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const u=C=>.2126*(C[0]<=.03928?C[0]/12.92:Math.pow((C[0]+.055)/1.055,2.4))+.7152*(C[1]<=.03928?C[1]/12.92:Math.pow((C[1]+.055)/1.055,2.4))+.0722*(C[2]<=.03928?C[2]/12.92:Math.pow((C[2]+.055)/1.055,2.4)),p=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),f=t.properties.get("intensity"),_=t.properties.get("direction"),b=1-o.cR(_.x,_.y,_.z)[2]/90,x=u(p)*f*b,T=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=a.properties.get("intensity"),I=u(T)*M;return Number(((x+I)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.d8(t)){const a=o.d9(t),u=this.fragments.find(({id:f})=>f===a);if(!u)return;const p=o.d7(t);return u.style.getFragmentStyle(p)}{const a=this.fragments.find(({id:u})=>u===t);return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},u=(p,f="")=>`${p}::${f}`;this._featuresetSelectors={};for(const p in t){const f=this._featuresetSelectors[p]=[];for(const _ of t[p].selectors){if(_.featureNamespace){const x=this.getOwnLayer(_.layer);if(!x){o.w(`Layer is undefined for selector: ${_.layer}`);continue}const T=u(x.source,x.sourceLayer);if(T in a&&a[T]!==_.featureNamespace){o.w(`"featureNamespace ${_.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}a[T]=_.featureNamespace}let b;if(_.properties)for(const x in _.properties){const T=o.X(_.properties[x]);T.result==="success"&&(b=b||{},b[x]=T.value)}f.push({layerId:_.layer,namespace:_.featureNamespace,properties:b,uniqueFeatureID:_._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const u=[];for(const p in a.stylesheet.featuresets)u.push({featuresetId:p,importId:a.scope?a.scope:void 0});return u}getFeaturesetLayers(t,a){const u=this.getFragmentStyle(a),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new o.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const f=[];for(const _ of p[t].selectors){const b=u.getOwnLayer(_.layer);b&&f.push(b)}return f}getConfigProperty(t,a){const u=this.getFragmentStyle(t);if(!u)return null;const p=o.C(a,u.scope),f=u.options.get(p),_=f?f.value||f.default:null;return _?_.serialize():null}setConfigProperty(t,a,u){const p=this.getFragmentStyle(t);if(!p)return;const f=p.stylesheet.indoor?vo(p.stylesheet.schema):p.stylesheet.schema;if(!f||!f[a])return;const _=o.X(u);if(_.result!=="success")return void Ns(this,_.value);const b=_.value.expression,x=o.C(a,p.scope),T=p.options.get(x);if(!T)return;let M;const{minValue:I,maxValue:C,stepValue:z,type:O,values:N}=f[a],$=o.X(f[a].default);$.result==="success"&&(M=$.value.expression),M?(this.options.set(x,Object.assign({},T,{value:b,default:M,minValue:I,maxValue:C,stepValue:z,type:O,values:N})),this.updateConfigDependencies(a)):this.fire(new o.z(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const u=a.stylesheet.schema;if(!u)return null;const p={};for(const f in u){const _=o.C(f,a.scope),b=a.options.get(_),x=b?b.value||b.default:null;p[f]=x?x.serialize():null}return p}setConfig(t,a){const u=this.getFragmentStyle(t);u&&(u.updateConfig(a,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=a,u.updateConfig(u._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const u in a){let p,f;const _=o.X(a[u].default);if(_.result==="success"&&(p=_.value.expression),t&&t[u]!==void 0){const C=o.X(t[u]);C.result==="success"&&(f=C.value.expression)}const{minValue:b,maxValue:x,stepValue:T,type:M,values:I}=a[u];if(p){const C=o.C(u,this.scope);this.options.set(C,{default:p,value:f,minValue:b,maxValue:x,stepValue:T,type:M,values:I})}else this.fire(new o.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const a of this._configDependentLayers){const u=this.getLayer(a);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const u=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(u){const p=a._evaluateColorThemeData(u);(!a._styleColorTheme.lut&&p!==""||a._styleColorTheme.lut&&p!==a._styleColorTheme.lut.data)&&a.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,a,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new o.z(new Error(`Layer with id "${p}" already exists on this map`)));let f;if(t.type==="custom"){if(Ns(this,o.da(t)))return;f=o.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=o.d6(t),t=o.h(t,{source:p})),this._validate(Ci,`layers.${p}`,t,{arrayIndex:-1},u))return;f=o.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(f),f.setEventedParent(this,{layer:{id:p}})}f.configDependencies.size!==0&&this._configDependentLayers.add(f.fqid);let _=this._order.length;if(a){const M=this._order.indexOf(a);if(M===-1)return void this.fire(new o.z(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?_=M:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,p),this._layerOrderChanged=!0,this._layers[p]=f;const b=this.getOwnLayerSourceCache(f),x=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&f.canCastShadows()&&x&&(b.castsShadows=!0);const T=this._changes.getRemovedLayer(f);if(T&&f.source&&b&&f.type!=="custom"){this._changes.discardLayerRemoval(f);const M=o.C(f.source,f.scope);T.type!==f.type?this._changes.updateSourceCache(M,"clear"):(this._changes.updateSourceCache(M,"reload"),b.pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map),f.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===a)return;const p=this._order.indexOf(t);this._order.splice(p,1);let f=this._order.length;if(a){const _=this._order.indexOf(a);if(_===-1)return void this.fire(new o.z(new Error(`Layer with id "${a}" does not exist on this map.`)));u.slot===this._layers[a].slot?f=_:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(f,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const p=this.getOwnLayerSourceCache(a);if(p&&p.castsShadows){let f=!1;for(const _ in this._layers)if(this._layers[_].source===a.source&&this._layers[_].canCastShadows()){f=!0;break}p.castsShadows=f}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===a&&p.maxzoom===u||(a!=null&&(p.minzoom=a),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==a&&(u.slot=a,this._updateLayer(u))}setFilter(t,a,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!o.bv(p.filter,a))return a==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Me,`layers.${p.id}.filter`,a,{layerType:p.type},u)||(p.filter=o.d6(a),this._updateLayer(p)))}getFilter(t){const a=this._checkLayer(t);if(a)return o.d6(a.filter)}setLayoutProperty(t,a,u,p={}){this._checkLoaded();const f=this._checkLayer(t);if(f&&!o.bv(f.getLayoutProperty(a),u)){if(u!=null&&(!p||p.validate!==!1)&&Ns(f,G.call(Qa,{key:`layers.${t}.layout.${a}`,layerType:f.type,objectKey:a,value:u,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;f.setLayoutProperty(a,u),f.configDependencies.size!==0&&this._configDependentLayers.add(f.fqid),this._updateLayer(f)}}getLayoutProperty(t,a){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(a)}setPaintProperty(t,a,u,p={}){this._checkLoaded();const f=this._checkLayer(t);if(!f||o.bv(f.getPaintProperty(a),u)||u!=null&&(!p||p.validate!==!1)&&Ns(f,V.call(Qa,{key:`layers.${t}.paint.${a}`,layerType:f.type,objectKey:a,value:u,styleSpec:o.a5})))return;const _=f.setPaintProperty(a,u);f.configDependencies.size!==0&&this._configDependentLayers.add(f.fqid),_&&this._updateLayer(f),this._changes.updatePaintProperties(f)}getPaintProperty(t,a){const u=this._checkLayer(t);if(u)return u.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:x,importId:T}=t.target,M=this.getFragmentStyle(T),I=M.getFeaturesetLayers(x);for(const{source:C,sourceLayer:z}of I)M.setFeatureState({id:t.id,source:C,sourceLayer:z},a)}else if("layerId"in t.target){const{layerId:x}=t.target,T=this.getLayer(x);this.setFeatureState({id:t.id,source:T.source,sourceLayer:T.sourceLayer},a)}return}const u=t.source,p=t.sourceLayer,f=this._checkSource(u);if(!f)return;const _=f.type;if(_==="geojson"&&p)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!p)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const b=this.getOwnSourceCaches(u);for(const x of b)x.setFeatureState(p,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:x,importId:T}=t.target,M=this.getFragmentStyle(T),I=M.getFeaturesetLayers(x);for(const{source:C,sourceLayer:z}of I)M.removeFeatureState({id:t.id,source:C,sourceLayer:z},a)}else if("layerId"in t.target){const{layerId:x}=t.target,T=this.getLayer(x);this.removeFeatureState({id:t.id,source:T.source,sourceLayer:T.sourceLayer},a)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const f=p.type,_=f==="vector"?t.sourceLayer:void 0;if(f==="vector"&&!_)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const b=this.getOwnSourceCaches(u);for(const x of b)x.removeFeatureState(_,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let f;if("featuresetId"in t.target){const{featuresetId:_,importId:b}=t.target,x=this.getFragmentStyle(b),T=x.getFeaturesetLayers(_);for(const{source:M,sourceLayer:I}of T){const C=x.getFeatureState({id:t.id,source:M,sourceLayer:I});if(C&&!f)f=C;else if(!o.bv(f,C))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:_}=t.target,b=this.getLayer(_);f=this.getFeatureState({id:t.id,source:b.source,sourceLayer:b.sourceLayer})}return f}const a=t.source,u=t.sourceLayer,p=this._checkSource(a);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(u,t.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=o.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),u=o.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=b=>this._mergedLayers[b].is3D(!!this.terrain),u=this.order,p={},f=[];for(let b=u.length-1;b>=0;b--){const x=u[b];if(a(x)){p[x]=b;for(const T of t){const M=T[x];if(M)for(const I of M)f.push(I)}}}f.sort((b,x)=>x.intersectionZ-b.intersectionZ);const _=[];for(let b=u.length-1;b>=0;b--){const x=u[b];if(a(x))for(let T=f.length-1;T>=0;T--){const M=f[T].feature;if(M.layer&&p[M.layer.id]<b)break;_.push(M),f.pop()}else for(const T of t){const M=T[x];if(M)for(const I of M)_.push(I.feature)}}return _}queryRenderedFeatures(t,a,u){let p;a&&!Array.isArray(a)&&a.filter&&(this._validate(Me,"queryRenderedFeatures.filter",a.filter,null,a),p=o.b3(a.filter));const f={},_=M=>{if(uh.has(M.type))return;const I=this.getOwnLayerSourceCache(M),C=f[I.id]=f[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};M.is3D(!!this.terrain)&&(C.has3DLayers=!0),C.layers[M.fqid]=C.layers[M.fqid]||{styleLayer:M,targets:[]},C.layers[M.fqid].targets.push({filter:p})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const M of a.layers){const I=this._layers[M];if(!I)return this.fire(new o.z(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_(I)}}else for(const M in this._layers)_(this._layers[M]);const b=this._queryRenderedFeatures(t,f,u),x=this._flattenAndSortRenderedFeatures(b),T=[];for(const M of x)o.dd(M.layer.id)===this.scope&&T.push(M);return T}queryRenderedFeatureset(t,a,u){let p;a&&!Array.isArray(a)&&a.filter&&(this._validate(Me,"queryRenderedFeatures.filter",a.filter,null,a),p=o.b3(a.filter));const f="mock",_=[];if(a&&a.target)_.push(Object.assign({},a,{targetId:f,filter:p}));else{const M=this.getFeaturesetDescriptors();for(const I of M)_.push({targetId:f,filter:p,target:I});for(const{style:I}of this.fragments){const C=I.getFeaturesetDescriptors();for(const z of C)_.push({targetId:f,filter:p,target:z})}}const b=this.queryRenderedTargets(t,_,u),x=[],T=new Set;for(const M of b)for(const I of M.variants[f])Zc(I,M,T)||x.push(new o.de(M,I));return x}queryRenderedTargets(t,a,u){const p={},f=(b,x,T,M)=>{const I=p[x.id]=p[x.id]||{sourceCache:x,layers:{},has3DLayers:!1};if(I.layers[b.fqid]=I.layers[b.fqid]||{styleLayer:b,targets:[]},b.is3D(!!this.terrain)&&(I.has3DLayers=!0),!M)return T.uniqueFeatureID=!1,void I.layers[b.fqid].targets.push(T);I.layers[b.fqid].targets.push(Object.assign({},T,{namespace:M.namespace,properties:M.properties,uniqueFeatureID:M.uniqueFeatureID}))};for(const b of a)if("featuresetId"in b.target){const{featuresetId:x,importId:T}=b.target,M=this.getFragmentStyle(T);if(!M||!M._featuresetSelectors)continue;const I=M._featuresetSelectors[x];if(!I){this.fire(new o.z(new Error(`The featureset '${x}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const C of I){const z=M.getOwnLayer(C.layerId);z&&!uh.has(z.type)&&f(z,M.getOwnLayerSourceCache(z),b,C)}}else if("layerId"in b.target){const{layerId:x}=b.target,T=this.getLayer(x);if(!T||uh.has(T.type))continue;f(T,this.getLayerSourceCache(T),b)}const _=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(_)}_queryRenderedFeatures(t,a,u){const p=[],f=!!this.map._showQueryGeometry,_=Ii.createFromScreenPoints(t,u);for(const b in a){const x=Kc(_,a[b],this._availableImages,u,f);Object.keys(x).length&&p.push(x)}if(this.placement)for(const b in a){if(!a[b].sourceCache._onlySymbols)continue;const x=Ps(_.screenGeometry,a[b],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(x).length&&p.push(x)}return p}querySourceFeatures(t,a){const u=a&&a.filter;u&&this._validate(Me,"querySourceFeatures.filter",u,null,a);let p=[];const f=this.getOwnSourceCaches(t);for(const _ of f)p=p.concat(Iu(_,a));return p}addSourceType(t,a,u){return Ta.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Ta.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,u={}){this._checkLoaded();const p=this.light.getLight();let f=!1;for(const b in t)if(!o.bv(t[b],p[b])){f=!0;break}if(!f)return;const _=this._getTransitionParameters();this.light.setLight(t,a,u),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const b="terrain-dem-src";this.addSource(b,u.source),u=o.d6(u),u=o.h(u,{source:b})}const f=o.h({},u),_={};if(this.terrain&&p){f.source=this.terrain.get().source;const b=this.terrain?this.getFragmentStyle(this.terrain.scope):null;b&&(_.style=b.serialize())}if(this._validate(st,"terrain",f,_))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&a!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,a),this.fire(new o.A("data",{dataType:"style"}))}else{const f=this.terrain,_=f.get();for(const b of Object.keys(o.a5.terrain))!u.hasOwnProperty(b)&&o.a5.terrain[b].default&&(u[b]=o.a5.terrain[b].default);for(const b in t)if(!o.bv(t[b],_[b])){f.set(t,this.options),this.stylesheet.terrain=t;const x=this._getTransitionParameters({duration:0});f.updateTransitions(x),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Zt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}_createSnow(t){const a=this.snow=new gn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}_createRain(t){const a=this.rain=new _n(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!o.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!o.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!o.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(a);this._loadColorTheme(u).then(()=>{this.fire(new o.A("colorthemeset")),t()}).catch(p=>{o.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=a,u._reloadColorTheme())}_getTransitionParameters(t){return{now:o.q.now(),transition:o.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):a.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const u=this.terrain=new ye(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,u,p,f={}){if(f&&f.validate===!1)return!1;const _=o.h({},this.serialize());return Ns(this,t.call(Qa,o.h({key:a,style:_,value:u,styleSpec:o.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const u of a)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const a=this.getSourceCaches(t);for(const u of a)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let a;this.directionalLight&&(a=Al(this.directionalLight));const u=new Set;for(const p in this._mergedLayers){const f=this._mergedLayers[p];f.hasElevation()&&!u.has(f.source)&&u.add(f.source)}for(const p in this._mergedSourceCaches){const f=this._mergedSourceCaches[p],_=u.has(f._source.id);f.update(t,void 0,void 0,a,_)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,u,p,f,_,b=!1){let x=!1,T=!1;const M={},I={};for(const C of this._mergedOrder){const z=this._mergedLayers[C];if(z.type!=="symbol")continue;const O=o.C(z.source,z.scope);let N=M[O];if(!N){const U=this.getLayerSourceCache(z);if(!U)continue;const q=U.getRenderableIds(!0).map(Q=>U.getTileByID(Q));I[O]=q.slice(),N=M[O]=q.sort((Q,ne)=>ne.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(ne.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(z,N,a.center.lng,a.projection);x=x||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),a.zoom))&&(this.pauseablePlacement=new oh(a,this._mergedOrder,b,u,p,f,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,I,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),T=!0),x&&this.pauseablePlacement.placement.setStale()),T||x){this._buildingIndex.onNewFrame(a.zoom);for(let C=0;C<this._mergedOrder.length;C++){const z=this._mergedLayers[this._mergedOrder[C]];if(z.type!=="symbol")continue;const O=this.isLayerClipped(z);this.placement.updateLayerOpacities(z,M[o.C(z.source,z.scope)],C,O?_:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:f})=>f===t.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:f})=>f===a);return p===-1&&this.fire(new o.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==u[p].url&&this.setImportUrl(t,a.url),o.bv(a.config,u[p].config)||this.setImportConfig(t,a.config,a.data.schema),o.bv(a.data,u[p].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const f=this.getImportIndex(a);if(f===-1)return this;const _=u[p],b=this.fragments[p];return u=u.filter(({id:x})=>x!==t),this.fragments=this.fragments.filter(({id:x})=>x!==t),this.stylesheet.imports=u.slice(0,f).concat(_).concat(u.slice(f)),this.fragments=this.fragments.slice(0,f).concat(b).concat(this.fragments.slice(f)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=a;const f=this.fragments[p];return f.style=this._createFragmentStyle(u[p]),f.style.on("style.import.load",()=>this.mergeAll()),f.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:a?(this.fragments[u].style.setState(a),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,a,u){this._checkLoaded();const p=this.getImportIndex(t),f=this.stylesheet.imports||[];if(p===-1)return this;a?f[p].config=a:delete f[p].config;const _=this.fragments[p];u&&_.style.stylesheet&&(_.style.stylesheet.schema=u);const b=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=a,_.style.updateConfig(a,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(a.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return a===-1&&this.fire(new o.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[a];u&&t.push(u.getSource())}return t}getSource(t,a){const u=this.getSourceCache(t,a);return u&&u.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const u=o.C(t,a);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const a=o.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const u=t[a];u==="reload"?this.reloadSource(a):u==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const u of a){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,a,u){this.imageManager.getImages(a.images,a.scope,u),this._updateTilesForChangedImages();const p=_=>{if(_){const b=a.images.map(x=>o.I.toString(x));_.setDependencies(a.tileID.key,a.type,b)}},f=o.C(a.source,a.scope);p(this._mergedOtherSourceCaches[f]),p(this._mergedSymbolSourceCaches[f])}rasterizeImages(t,a,u){this.imageManager.rasterizeImages(a,u)}getGlyphs(t,a,u){this.glyphManager.getGlyphs(a.stacks,a.scope,u)}getResource(t,a,u){return o.dg(a,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${t}'`))),!1):a.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building",p=t.type==="building";if(t.is3D(!!this.terrain)){if(u||p||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ta.getSourceType=function(l){return Hc[l]},Ta.setSourceType=function(l,t){Hc[l]=t},Ta.registerForPluginStateChange=o.dh;var Yu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,np=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ap=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Tl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,rp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ch=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,dr=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,lt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,op=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ml=[];Sr(Yu,Ml),Sr(ap,Ml),Sr(np,Ml);const El={"_prelude_fog.vertex.glsl":rp,"_prelude_terrain.vertex.glsl":Pl,"_prelude_shadow.vertex.glsl":lt,"_prelude_fog.fragment.glsl":ch,"_prelude_shadow.fragment.glsl":op,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":dr,"_prelude_raster_particle.glsl":hh},Hu={};Si("",Pl),Si(ch,rp),Si(op,lt),Si(dr,""),Si(hh,"");const Zu=Si(np,ap),eo=Yu;var dh={background:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Si("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Si(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Si("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Si("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Si("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Si(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Si(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Si(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Si(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Si(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Si("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Si("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Si(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Si(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Si("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Si(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Tl),skyboxGradient:Si(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Tl),skyboxCapture:Si(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Si(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Si(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Si("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Si("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Si("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Si("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Sr(l,t){const a=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of a)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const f of p)t.includes(f)||t.push(f)}}function Si(l,t){const a=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(T=>{const M=T.split(" ");return M[M.length-1]}),p=[...new Set(p)]);const f={},_=[],b=[];if(l=l.replace(a,(T,M)=>(b.push(M),"")),(t=t.replace(a,(T,M)=>(_.push(M),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let x=[...Ml];Sr(l,x),Sr(t,x);for(const T of[..._,...b])El[T]||console.error(`Undefined include: ${T}`),Hu[T]||(Hu[T]=[],Sr(El[T],Hu[T])),x=[...x,...Hu[T]];return{fragmentSource:l=l.replace(u,(T,M,I,C,z)=>(f[z]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${I} ${C} ${z};
#else
uniform ${I} ${C} u_${z};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${I} ${C} ${z} = u_${z};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${I} ${C} ${z};
#endif
`:M==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(T,M,I,C,z)=>{const O=C==="float"?"vec2":C,N=z.match(/color/)?"color":O;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${I} ${C} a_${z};
#endif
`:f[z]?M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${I} ${O} a_${z};
out ${I} ${C} ${z};
#else
uniform ${I} ${C} u_${z};
#endif
`:M==="initialize"?N==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${I} ${C} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${N}(a_${z}, u_${z}_t);
#else
    ${I} ${C} ${z} = u_${z};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${I} ${C} a_${z};
    out ${I} ${C} ${z};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${I} ${O} a_${z};
#else
uniform ${I} ${C} u_${z};
#endif
`:M==="define-instanced"?N==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${I} ${C} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${O} a_${z};
#else
uniform ${I} ${C} u_${z};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${I} ${C} ${z} = a_${z};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${I} ${C} ${z} = a_${z};
#else
    ${I} ${C} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${I} ${C} ${z} = unpack_mix_${N}(a_${z}, u_${z}_t);
#else
    ${I} ${C} ${z} = u_${z};
#endif
`}),staticAttributes:p,usedDefines:x,vertexIncludes:_,fragmentIncludes:b}}class Cl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,u,p,f,_,b,x){this.context=t;let T=this.boundPaintVertexBuffers.length!==p.length;for(let I=0;!T&&I<p.length;I++)this.boundPaintVertexBuffers[I]!==p[I]&&(T=!0);let M=this.boundDynamicVertexBuffers.length!==b.length;for(let I=0;!M&&I<b.length;I++)this.boundDynamicVertexBuffers[I]!==b[I]&&(M=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||T||M||this.boundIndexBuffer!==f||this.boundVertexOffset!==_)this.freshBind(a,u,p,f,_,b,x);else{t.bindVertexArrayOES.set(this.vao);for(const I of b)I&&(I.bind(),x&&I.instanceCount&&I.setVertexAttribDivisor(t.gl,a,x));f&&f.dynamicDraw&&f.bind()}}freshBind(t,a,u,p,f,_,b){const x=t.numAttributes,T=this.context,M=T.gl;this.vao&&this.destroy(),this.vao=T.gl.createVertexArray(),T.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=f,this.boundDynamicVertexBuffers=_,a.enableAttributes(M,t),a.bind(),a.setVertexAttribPointers(M,t,f);for(const I of u)I.enableAttributes(M,t),I.bind(),I.setVertexAttribPointers(M,t,f);for(const I of _)I&&(I.enableAttributes(M,t),I.bind(),I.setVertexAttribPointers(M,t,f),b&&I.instanceCount&&I.setVertexAttribDivisor(M,t,b));p&&p.bind(),T.currentNumAttributes=x}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Fy(l,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new o.ac(0,u/a).toLngLat().lat,new o.ac(0,(u+1)/a).toLngLat().lat]}function Oy(l,t,a,u,p,f,_){const b=l.context,x=b.gl,T=a.hillshadeFBO;if(!T)return;l.prepareDrawTile();const M=l.isTileAffectedByFog(t),I=l.getOrCreateProgram("hillshade",{overrideFog:M});b.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,T.colorAttachment.get());const C=(($,U,q,Q)=>{const ne=q.paint.get("hillshade-shadow-color"),le=q.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",se=q.paint.get("hillshade-highlight-color"),re=q.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ae=q.paint.get("hillshade-accent-color"),ue=q.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",he=q.paint.get("hillshade-emissive-strength");let xe=o.al(q.paint.get("hillshade-illumination-direction"));if(q.paint.get("hillshade-illumination-anchor")==="viewport")xe-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){const Ne=$.style.directionalLight.properties.get("direction"),Fe=o.cR(Ne.x,Ne.y,Ne.z);xe=o.al(Fe[1])}const ke=!$.options.moving;return{u_matrix:Q||$.transform.calculateProjMatrix(U.tileID.toUnwrapped(),ke),u_image:0,u_latrange:Fy(0,U.tileID),u_light:[q.paint.get("hillshade-exaggeration"),xe],u_shadow:ne.toPremultipliedRenderColor(le?null:q.lut),u_highlight:se.toPremultipliedRenderColor(re?null:q.lut),u_emissive_strength:he,u_accent:ae.toPremultipliedRenderColor(ue?null:q.lut)}})(l,a,u,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(b,I,t.toUnwrapped());const{tileBoundsBuffer:z,tileBoundsIndexBuffer:O,tileBoundsSegments:N}=l.getTileBoundsBuffers(a);I.draw(l,x.TRIANGLES,p,f,_,Ft.disabled,C,u.id,z,O,N)}function ph(l,t,a){if(!t.needsDEMTextureUpload)return;const u=l.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(a.stride);const f=a.getPixels();t.demTexture?t.demTexture.update(f,{premultiply:!1}):t.demTexture=new o.T(u,f,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function $y(l,t,a){const u=l.context,p=u.gl;if(!t.dem)return;const f=t.dem;if(u.activeTexture.set(p.TEXTURE1),ph(l,t,f),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const _=f.dim;u.activeTexture.set(p.TEXTURE0);let b=t.hillshadeFBO;if(!b){const C=new o.T(u,{width:_,height:_,data:null},p.RGBA8);C.bind(p.LINEAR,p.CLAMP_TO_EDGE),b=t.hillshadeFBO=u.createFramebuffer(_,_,!0,"renderbuffer"),b.colorAttachment.set(C.texture)}u.bindFramebuffer.set(b.framebuffer),u.viewport.set([0,0,_,_]);const{tileBoundsBuffer:x,tileBoundsIndexBuffer:T,tileBoundsSegments:M}=l.getMercatorTileBoundsBuffers(),I=[];l.linearFloatFilteringSupported()&&I.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:I}).draw(l,p.TRIANGLES,_t.disabled,Gt.disabled,mi.unblended,Ft.disabled,((C,z)=>{const O=z.stride,N=o.bz();return o.c5(N,0,o.aj,-8192,0,0,1),o.bo(N,N,[0,-8192,0]),{u_matrix:N,u_image:1,u_dimension:[O,O],u_zoom:C.overscaledZ}})(t.tileID,f),a.id,x,T,M),t.needsHillshadePrepare=!1}class Tn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mf extends Tn{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sp extends Tn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class jy extends Tn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Vy extends Tn{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Uy extends Tn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Jy extends Tn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ef extends Tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class qy extends Tn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class mh extends Tn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Gy extends Tn{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Cf extends Tn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class lp extends Tn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class fh extends Tn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class up extends Tn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Fs extends Tn{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Dl extends Tn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class gh extends Tn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class _h extends Tn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Il extends Tn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Df=class extends Tn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class cp extends Tn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class If extends Tn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zl extends Tn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class yh extends Tn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wh extends Tn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class hp extends Tn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class bh extends Tn{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ku extends Tn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class zf extends Tn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Lf extends Tn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Rf extends Tn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Qo extends Tn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Bf extends Qo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Wf extends Qo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yy extends Qo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Hy extends Wf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const dp=(l,t,a)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),vh=(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:a,u_zoom_transition:p,u_merc_center:f,u_image0:0,u_frustum_tl:_,u_frustum_tr:b,u_frustum_br:x,u_frustum_bl:T,u_globe_pos:M,u_globe_radius:I,u_viewport:C,u_grid_matrix:N?Float32Array.from(N):new Float32Array(9),u_skirt_height:z,u_far_z_cutoff:O});function xh(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const es=new class{constructor(){this.operations={}}newMorphing(l,t,a,u,p){if(l in this.operations){const f=this.operations[l];f.to.tileID.key!==a.tileID.key&&(f.queued=a)}else this.operations[l]={startTime:u,phase:0,duration:p,from:t,to:a,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const a=this.operations[t];for(a.phase=(l-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},pp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function mp(l,t,a){if(t===0)return 0;const u=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*u}function Zy(l,t){const a=1<<l.z;return!t&&(l.x===0||l.x===a-1)||l.y===0||l.y===a-1}const Os=l=>({u_matrix:l});function $s(l,t,a,u,p){if(p>0){const f=o.q.now(),_=(f-l.timeAdded)/p,b=t?(f-t.timeAdded)/p:-1,x=a.getSource(),T=u.coveringZoomLevel({tileSize:x.tileSize,roundZoom:x.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-T)>Math.abs(l.tileID.overscaledZ-T),I=M&&l.refreshedUponExpiration?1:o.ay(M?_:1-b,0,1);return l.refreshedUponExpiration&&_>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-I}:{opacity:I,mix:0}}return{opacity:1,mix:0}}class Nf extends Va{constructor(t){const a={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new o.D(o.c$(),null),p=Cu("mock-dem",a,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class pr extends Va{constructor(t){const a=Cu("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new o.D(o.c$(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((f,_)=>{if(f[_.key]="",!this._tiles[_.key]){const b=new Ms(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);b.state="loaded",this._tiles[_.key]=b}return f},{});for(const f in this._tiles)f in p||(this.freeFBO(f),this._tiles[f].unloadVectorData(),delete this._tiles[f])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const u=Object.values(a);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kh extends o.aM{constructor(t,a,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=u}}class Xu extends o.dt{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,f]=function(x){const T=new o.ba,M=new o.a_,I=131;T.reserve(17161),M.reserve(33800);const C=o.aj/128,z=o.aj+C/2,O=z+C;for(let $=-64;$<O;$+=C)for(let U=-64;U<O;U+=C){const q=U<0||U>z||$<0||$>z?24575:0,Q=o.ay(Math.round(U),0,o.aj),ne=o.ay(Math.round($),0,o.aj);T.emplaceBack(Q+q,ne)}const N=($,U)=>{const q=U*I+$;M.emplaceBack(q+1,q,q+I),M.emplaceBack(q+I,q+I+1,q+1)};for(let $=1;$<129;$++)for(let U=1;U<129;U++)N(U,$);return[0,129].forEach($=>{for(let U=0;U<130;U++)N(U,$),N($,U)}),[T,M,32768]}(),_=t.context;this.gridBuffer=_.createVertexBuffer(u,o.bc.members),this.gridIndexBuffer=_.createIndexBuffer(p),this.gridSegments=o.bd.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,u.length,f),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pr(a.map),this.orthoMatrix=o.bz(),o.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const b=_.gl;this._overlapStencilMode=new Gt({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nf(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,f=t.terrain.drapeRenderMode===0,_=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const b=t.terrain&&t.terrain.scope,x=p.get("source"),T=f?this._mockSourceCache:t.getSourceCache(x,b);if(!T)return void o.w(`Couldn't find terrain source "${x}".`);if(this.sourceCache=T,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=_?this.calculateExaggeration(a):p.get("exaggeration"),!a.projection.requiresDraping&&_&&this._exaggeration===0)return void this._disable();this.enabled=!0;const M=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(a,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),a.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=a!=null?u-a:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const f=t.zoom,_=this._style.terrain;if(!this._previousUpdateTimestamp)return _.getExaggeration(f);let b=f-this._previousZoom;const x=this._previousUpdateTimestamp;let T=f;this._evaluationZoom!=null&&(T=this._evaluationZoom,Math.abs(f-T)>.5&&(b=.5*(f-T+b)),b*p<0&&(T+=b)),this._evaluationZoom=T;const M=_.getExaggeration(T),I=M===_.getExaggeration(Math.max(0,T-.1));if(I&&Math.abs(M-this._exaggeration)<.01)return M;let C=Math.min(.1,.00375*(this._updateTimestamp-x));return(I||M<.1||Math.abs(b)<1e-4)&&(C=Math.min(.2,4*C)),o.ai(this._exaggeration,M,C)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=a.getIds().map(x=>{const T=a.getTileByID(x).tileID;return T.projMatrix=u.calculateProjMatrix(T.toUnwrapped()),T});(function(x,T){const M=T.transform.pointCoordinate(T.transform.getCameraPoint()),I=new o.P(M.x,M.y);x.sort((C,z)=>{if(z.overscaledZ-C.overscaledZ)return z.overscaledZ-C.overscaledZ;const O=new o.P(C.canonical.x+(1<<C.canonical.z)*C.wrap,C.canonical.y),N=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),$=I.mult(1<<C.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(O)-$.distSqr(N)})})(p,this.painter);const f=this.proxyToSource||{};this.proxyToSource={},p.forEach(x=>{this.proxyToSource[x.key]={}}),this.terrainTileForTile={};const _=this._style._mergedSourceCaches;for(const x in _){const T=_[x];if(!T.used||(T!==this.sourceCache&&this.resetTileLookupCache(T.id),this._setupProxiedCoordsForOrtho(T,t[x],f),T.usedForTerrain))continue;const M=t[x];T.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[a.id]=p.map(x=>new kh(x,x.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(f),this.renderingToTexture=!1;const b={};this._visibleDemTiles=[];for(const x of this.proxyCoords){const T=this.terrainTileForTile[x.key];if(!T)continue;const M=T.tileID.key;M in b||(this._visibleDemTiles.push(T),b[M]=M)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const u=this._findTileCoveringTileID(a,this.sourceCache);u&&(this.terrainTileForTile[a.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],f=p.dem;!f||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),ph(this.painter,p,f))}}_prepareDemTileUniforms(t,a,u,p){if(!a||a.demTexture==null)return!1;const f=t.tileID.canonical,_=Math.pow(2,a.tileID.canonical.z-f.z),b=p||"";return u[`u_dem_tl${b}`]=[f.x*_%1,f.y*_%1],u[`u_dem_scale${b}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const f=p.dem.tree.minimums[0];return f>0&&t++,u+f},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new o.du({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let f=this._emptyDEMTexture;return f?f.update(p,{premultiply:!1}):f=this._emptyDEMTexture=new o.T(t,p,a.R32F,{premultiply:!1}),f}setupElevationDraw(t,a,u){const p=this.painter.context,f=p.gl,_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};_.u_exaggeration=this.exaggeration();let b=null,x=null,T=1;if(u&&u.morphing&&this._useVertexMorphing){const z=u.morphing.srcDemTile,O=u.morphing.dstDemTile;T=u.morphing.phase,z&&O&&(this._prepareDemTileUniforms(t,z,_,"_prev")&&(x=z),this._prepareDemTileUniforms(t,O,_)&&(b=O))}const M=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?f.LINEAR:f.NEAREST;let I=null;var C;if(this.enabled?x&&b?(I=b.demTexture,p.activeTexture.set(f.TEXTURE4),x.demTexture.bind(M(x),f.CLAMP_TO_EDGE),_.u_dem_lerp=T):(b=this.terrainTileForTile[t.tileID.key],I=this._prepareDemTileUniforms(t,b,_)?b.demTexture:this.emptyDEMTexture):I=this.emptyDEMTexture,p.activeTexture.set(f.TEXTURE2),I&&(_.u_dem_size=(C=I).size[0]===1?1:C.size[0]-2,I.bind(M(b),f.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,a,_),u&&u.useMeterToDem&&b){const z=(1<<b.tileID.canonical.z)*o.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=z}if(u&&u.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),a.setTerrainUniformValues(p,_),this.painter.transform.projection.name==="globe"){const z=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);a.setGlobeUniformValues(p,z)}}globeUniformValues(t,a,u){const p=t.projection;return{u_tile_tl_up:p.upVector(a,0,0),u_tile_tr_up:p.upVector(a,o.aj,0),u_tile_br_up:p.upVector(a,o.aj,o.aj),u_tile_bl_up:p.upVector(a,0,o.aj),u_tile_up_scale:u?o.dv(1):p.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,f,_,b,x){if(p.transform.projection.name==="globe")(function(T,M,I,C,z){const O=T.context,N=O.gl;let $,U;const q=T.transform,Q=o.dl(T,O,q),ne=(Ne,Fe)=>{if(U===Fe)return;const Ge=[pp[Fe],"PROJECTION_GLOBE_VIEW"];Q&&Ge.push("CUSTOM_ANTIALIASING");const be=T.isTileAffectedByFog(Ne);$=T.getOrCreateProgram("globeRaster",{defines:Ge,overrideFog:be}),U=Fe},le=T.colorModeForRenderPass(),se=new _t(N.LEQUAL,_t.ReadWrite,T.depthRangeFor3D);es.update(z);const re=o.dm(q),ae=[o.aD(q.center.lng),o.aH(q.center.lat)],ue=T.globeSharedBuffers,he=[q.width*o.q.devicePixelRatio,q.height*o.q.devicePixelRatio],xe=Float32Array.from(q.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const Ne=T.transform,Fe=mp(Ne.zoom,M.exaggeration(),M.sourceCache._source.tileSize);U=-1;const Ge=N.TRIANGLES;for(const be of C){const ze=I.getTile(be),fe=Gt.disabled,je=M.prevTerrainTileForTile[be.key],Pe=M.terrainTileForTile[be.key];xh(je,Pe)&&es.newMorphing(be.key,je,Pe,z,250),O.activeTexture.set(N.TEXTURE0),ze.texture&&ze.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Je=es.getMorphValuesForProxy(be.key),at=Je?1:0;Je&&o.L(ke,{morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:o.dk(Je.phase)}});const $e=o.dn(be.canonical),it=o.dp($e.getCenter().lat),wt=o.dq(be.canonical,$e,it,Ne.worldSize/Ne._pixelsPerMercatorPixel),bt=o.bh(o.dr(be.canonical)),ft=vh(Ne.expandedFarZProjMatrix,xe,re,bt,o.ah(Ne.zoom),ae,Ne.frustumCorners.TL,Ne.frustumCorners.TR,Ne.frustumCorners.BR,Ne.frustumCorners.BL,Ne.globeCenterInViewSpace,Ne.globeRadius,he,Fe,Ne._farZ,wt);if(ne(be,at),$&&(M.setupElevationDraw(ze,$,ke),T.uploadCommonUniforms(O,$,be.toUnwrapped()),ue)){const[Et,Dt,Rt]=ue.getGridBuffers(it,Fe!==0);$.draw(T,Ge,se,fe,le,Ft.backCCW,ft,"globe_raster",Et,Dt,Rt)}}}if(ue&&(T.renderDefaultNorthPole||T.renderDefaultSouthPole)){const Ne=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Q&&Ne.push("CUSTOM_ANTIALIASING"),$=T.getOrCreateProgram("globeRaster",{defines:Ne});for(const Fe of C){const{x:Ge,y:be,z:ze}=Fe.canonical,fe=be===0,je=be===(1<<ze)-1,[Pe,Je,at,$e]=ue.getPoleBuffers(ze,!1);if($e&&(fe||je)){const it=I.getTile(Fe);O.activeTexture.set(N.TEXTURE0),it.texture&&it.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let wt=o.ds(ze,Ge,q);const bt=o.bh(o.dr(Fe.canonical)),ft=(Et,Dt)=>Et.draw(T,N.TRIANGLES,se,Gt.disabled,le,Ft.disabled,vh(q.expandedFarZProjMatrix,wt,wt,bt,0,ae,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,he,0,q._farZ),"globe_pole_raster",Dt,at,$e);M.setupElevationDraw(it,$,ke),T.uploadCommonUniforms(O,$,Fe.toUnwrapped()),fe&&T.renderDefaultNorthPole&&ft($,Pe),je&&T.renderDefaultSouthPole&&(wt=o.cE(o.bz(),wt,[1,-1,1]),ft($,Je))}}}})(p,f,_,b,x);else{const T=p.context,M=T.gl;let I,C;const z=p.shadowRenderer,O=Qr(p,p.longestCutoffRange),N=le=>{if(C===le)return;const se=[];se.push(pp[le]),O.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),z&&(se.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&se.push("NORMAL_OFFSET")),I=p.getOrCreateProgram("terrainRaster",{defines:se}),C=le},$=p.colorModeForRenderPass(),U=new _t(M.LEQUAL,_t.ReadWrite,p.depthRangeFor3D);es.update(x);const q=p.transform,Q=mp(q.zoom,f.exaggeration(),f.sourceCache._source.tileSize);let ne=[0,0,0];if(z){const le=p.style.directionalLight,se=p.style.ambientLight;le&&se&&(ne=Ws(p.style,le,se))}{C=-1;const le=M.TRIANGLES,[se,re]=[f.gridIndexBuffer,f.gridSegments];for(const ae of b){const ue=_.getTile(ae),he=Gt.disabled,xe=f.prevTerrainTileForTile[ae.key],ke=f.terrainTileForTile[ae.key];xh(xe,ke)&&es.newMorphing(ae.key,xe,ke,x,250),T.activeTexture.set(M.TEXTURE0),ue.texture&&ue.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const Ne=es.getMorphValuesForProxy(ae.key),Fe=Ne?1:0;let Ge;Ne&&(Ge={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:o.dk(Ne.phase)}});const be=dp(ae.projMatrix,Zy(ae.canonical,q.renderWorldCopies)?Q/10:Q,ne);if(N(Fe),!I)continue;f.setupElevationDraw(ue,I,Ge);const ze=ae.toUnwrapped();z&&z.setupShadows(ze,I),p.uploadCommonUniforms(T,I,ze,null,O),I.draw(p,le,U,he,$,Ft.backCCW,be,"terrain_raster",f.gridBuffer,se,re)}}}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,u=this.painter.context,p=this.proxySourceCache,f=this.proxiedCoords[p.id],_=this._drapedRenderBatches.shift(),b=a.style.order,x=[];let T=0;for(const M of f){const I=p.getTileByID(M.proxyTileKey),C=p.proxyCachedFBO[M.key]?p.proxyCachedFBO[M.key][t]:void 0,z=C!==void 0?p.renderCache[C]:this.pool[T++],O=C!==void 0;if(I.texture=z.tex,O&&!z.dirty){x.push(I.tileID);continue}let N;u.bindFramebuffer.set(z.fb.framebuffer),this.renderedToTile=!1,z.dirty&&(u.clear({color:o.am.transparent,stencil:0}),z.dirty=!1);for(let $=_.start;$<=_.end;++$){const U=a.style._mergedLayers[b[$]];if(U.isHidden(a.transform.zoom))continue;const q=a.style.getLayerSourceCache(U),Q=q?this.proxyToSource[M.key][q.id]:[M];if(!Q)continue;const ne=Q;u.viewport.set([0,0,z.fb.width,z.fb.height]),N!==(q?q.id:null)&&(this._setupStencil(z,Q,U,q),N=q?q.id:null),a.renderLayer(a,q,U,ne)}if(this._drapedRenderBatches.length===0)for(const $ of this._pendingGroundEffectLayers){const U=a.style._mergedLayers[b[$]];if(U.isHidden(a.transform.zoom))continue;const q=a.style.getLayerSourceCache(U),Q=q?this.proxyToSource[M.key][q.id]:[M];if(!Q)continue;const ne=Q;u.viewport.set([0,0,z.fb.width,z.fb.height]),N!==(q?q.id:null)&&(this._setupStencil(z,Q,U,q),N=q?q.id:null),a.renderLayer(a,q,U,ne)}this.renderedToTile?(z.dirty=!0,x.push(I.tileID)):O||--T,T===5&&(T=0,this.renderToBackBuffer(x))}return this.renderToBackBuffer(x),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,a.width,a.height]),_.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let u=-1,p=a;for(let f=0;f<a;++f)this._style.isLayerDraped(t._mergedLayers[t.order[f]])?u=Math.max(u,f):p=Math.min(p,f);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(f=>f.dem).map(f=>{const _=f.tileID,b=1<<_.overscaledZ,{x,y:T}=_.canonical,M=x/b,I=(x+1)/b,C=T/b,z=(T+1)/b;return{minx:M,miny:C,maxx:I,maxy:z,t:f.dem.tree.raycastRoot(M,C,I,z,t,a,u),tile:f}});p.sort((f,_)=>(f.t!==null?f.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE));for(const f of p){if(f.t==null)return null;const _=f.tile.dem.tree.raycast(f.minx,f.miny,f.maxx,f.maxy,t,a,u);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,a=t.gl,u=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const p=new o.T(t,{width:u[0],height:u[1],data:null},a.RGBA8);p.bind(a.LINEAR,a.CLAMP_TO_EDGE);const f=t.createFramebuffer(u[0],u[1],!0,null);return f.colorAttachment.set(p.texture),f.depthAttachment=new Hy(t,f.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,f.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):f.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:f,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._mergedLayers[t],u=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!u&&a.shouldRedrape():!u&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Eu){t=!0;break}if(!t)return;const a={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],f=this._style.getLayerSourceCache(p);if(f&&!a[f.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof o.ab){a[f.id]=!0;for(const _ of this.proxyCoords){const b=this.proxyToSource[_.key][f.id];if(b)for(const x of b)this._clearRenderCacheForTile(f.id,x)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof pa){t=!0;break}if(!t)return;const a={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],f=this._style.getLayerSourceCache(p);if(!f||a[f.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const _=p.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const x=this.proxyToSource[b.key][f.id];if(x)for(const T of x){const M=$s(f.getTile(T),f.findLoadedParent(T,0),f,this.painter.transform,_);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(f.id,T)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,f=0,_=this._style._mergedLayers[t[f]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++f<a;)_=this._style._mergedLayers[t[f]];for(;f<a;++f){const b=this._style._mergedLayers[t[f]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?p===void 0&&(p=f):(b.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(f),p!==void 0&&(u.push({start:p,end:f-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:f-1}),u.length!==0){const b=u[u.length-1];this._pendingGroundEffectLayers.every(x=>x>b.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const _=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let b=0;b<_.length;++b){const x=Object.values(_[b]);a.renderCachePool.push(...x)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let _=u.length-1;_>=0;_--){const b=u[_];if(a.getTileByID(b.key),a.proxyCachedFBO[b.key]!==void 0){const x=t[b.key],T=this.proxyToSource[b.key];let M=0;for(const I in T){const C=T[I],z=x[I];if(!z||z.length!==C.length||C.some((O,N)=>O!==z[N]||p[I]&&p[I].hasOwnProperty(O.key))){M=-1;break}++M}for(const I in a.proxyCachedFBO[b.key])a.renderCache[a.proxyCachedFBO[b.key][I]].dirty=M<0||M!==Object.values(x).length}}const f=[...this._drapedRenderBatches];f.sort((_,b)=>b.end-b.start-(_.end-_.start));for(const _ of f)for(const b of u){if(a.proxyCachedFBO[b.key])continue;let x=a.renderCachePool.pop();x===void 0&&a.renderCache.length<50&&(x=a.renderCache.length,a.renderCache.push(this._createFBO())),x!==void 0&&(a.proxyCachedFBO[b.key]={},a.proxyCachedFBO[b.key][_.start]=x,a.renderCache[x].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const f=this.painter.context,_=f.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let b;if(u.isTileClipped())b=a.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(f.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Gt.disabled}_renderTileClippingMasks(t,a){const u=this.painter,p=this.painter.context,f=p.gl;u._tileClippingMaskIDs={},p.setColorMode(mi.disabled),p.setDepthMode(_t.disabled);const _=u.getOrCreateProgram("clippingMask");for(const b of t){const x=u._tileClippingMaskIDs[b.key]=--a;_.draw(u,f.TRIANGLES,_t.disabled,new Gt({func:f.ALWAYS,mask:0},x,255,f.KEEP,f.KEEP,f.REPLACE),mi.disabled,Ft.disabled,Os(b.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const u=[t.x,t.y,1,1];o.aA(u,u,a.pixelMatrixInverse),o.cw(u,u,1/u[3]),u[0]/=a.worldSize,u[1]/=a.worldSize;const p=a._camera.position,f=o.c6(1,a.center.lat),_=[p[0],p[1],p[2]/f,0],b=o.cX([],u.slice(0,3),_);o.au(b,b);const x=this.raycast(_,b,this._exaggeration);return x!==null&&x?(o.bE(_,_,b,x),_[3]=_[2],_[2]*=f,_):null}_setupProxiedCoordsForOrtho(t,a,u){if(t.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(t,a,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],f=this.proxyCoords;for(let x=0;x<f.length;x++){const T=f[x],M=this._findTileCoveringTileID(T,t);if(M){const I=this._createProxiedId(T,M,u[T.key]&&u[T.key][t.id]);p.push(I),this.proxyToSource[T.key][t.id]=[I]}}let _=!1;const b=new Set;for(let x=0;x<a.length;x++){const T=t.getTile(a[x]);if(!T||!T.hasData())continue;const M=this._findTileCoveringTileID(T.tileID,this.proxySourceCache);if(M&&M.tileID.canonical.z!==T.tileID.canonical.z){const I=this.proxyToSource[M.tileID.key][t.id],C=this._createProxiedId(M.tileID,T,u[M.tileID.key]&&u[M.tileID.key][t.id]);I?I.splice(I.length-1,0,C):this.proxyToSource[M.tileID.key][t.id]=[C];const z=this.proxyToSource[M.tileID.key][t.id];b.has(z)||b.add(z),p.push(C),_=!0}}if(this._sourceTilesOverlap[t.id]=_,_&&this._debugParams.sortTilesHiZFirst)for(const x of b)x.sort((T,M)=>M.overscaledZ-T.overscaledZ)}_setupProxiedCoordsForImageSource(t,a,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],f=this.proxyCoords,_=t.getSource(),b=_.tileID;if(!b)return;const x=new o.P(b.x,b.y)._div(1<<b.z),T=_.coordinates.map(o.ac.fromLngLat).reduce((I,C)=>(I.min.x=Math.min(I.min.x,C.x-x.x),I.min.y=Math.min(I.min.y,C.y-x.y),I.max.x=Math.max(I.max.x,C.x-x.x),I.max.y=Math.max(I.max.y,C.y-x.y),I),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),M=(I,C)=>{const z=I.wrap+I.canonical.x/(1<<I.canonical.z),O=I.canonical.y/(1<<I.canonical.z),N=o.aj/(1<<I.canonical.z),$=C.wrap+C.canonical.x/(1<<C.canonical.z),U=C.canonical.y/(1<<C.canonical.z);return z+N<$+T.min.x||z>$+T.max.x||O+N<U+T.min.y||O>U+T.max.y};for(let I=0;I<f.length;I++){const C=f[I];for(let z=0;z<a.length;z++){const O=t.getTile(a[z]);if(!O||!O.hasData()||M(C,O.tileID))continue;const N=this._createProxiedId(C,O,u[C.key]&&u[C.key][t.id]),$=this.proxyToSource[C.key][t.id];$?$.push(N):this.proxyToSource[C.key][t.id]=[N],p.push(N)}}}_createProxiedId(t,a,u){let p=this.orthoMatrix;if(u){const f=u.find(_=>_.key===a.tileID.key);if(f)return f}if(a.tileID.key!==t.key){const f=t.canonical.z-a.tileID.canonical.z;let _,b,x;p=o.bz();const T=a.tileID.wrap-t.wrap<<t.overscaledZ;f>0?(_=o.aj>>f,b=_*((a.tileID.canonical.x<<f)-t.canonical.x+T),x=_*((a.tileID.canonical.y<<f)-t.canonical.y)):(_=o.aj<<-f,b=o.aj*(a.tileID.canonical.x-(t.canonical.x+T<<-f)),x=o.aj*(a.tileID.canonical.y-(t.canonical.y<<-f))),o.c5(p,0,_,0,_,0,1),o.bo(p,p,[b,x,0])}return new kh(a.tileID,t.key,p)}_findTileCoveringTileID(t,a){let u=a.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[a.id],f=p[t.key];if(u=f?a.getTileByID(f):null,u&&u.hasData()||f===null)return u;let _=u?u.tileID:t,b=_.overscaledZ;const x=a.getSource().minzoom,T=[];if(!f){const I=a.getSource().maxzoom;if(t.canonical.z>=I){const C=t.canonical.z-I;a.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,a.transform.tileZoom),_=new o.aM(b,t.wrap,I,t.canonical.x>>C,t.canonical.y>>C)):C!==0&&(b=I,_=new o.aM(b,t.wrap,I,t.canonical.x>>C,t.canonical.y>>C))}_.key!==t.key&&(T.push(_.key),u=a.getTile(_))}const M=I=>{T.forEach(C=>{p[C]=I}),T.length=0};for(b-=1;b>=x&&(!u||!u.hasData());b--){u&&M(u.tileID.key);const I=_.calculateScaledKey(b);if(u=a.getTileByID(I),u&&u.hasData())break;const C=p[I];if(C===null)break;C===void 0?T.push(I):u=a.getTileByID(C)}return M(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[a.key]=!0}}function Ah(l,t,a){const u=function(b,x,T){const M=o.bG(x,b),I=o.bG(T,[.2126,.7152,.0722]),C=(O,N,$)=>(1-$)*O+$*N,z=C(1-.3*Math.min(I,1),1,Math.min(M+1,1));return C(.92,1,Math.asin(o.ay(x[2],-1,1))/Math.PI+.5)*z}(l,[0,0,1],t),p=[0,0,0];o.bY(p,a.slice(0,3),u);const f=[0,0,0];o.bY(f,t.slice(0,3),l[2]);const _=[0,0,0];return o.cV(_,p,f),o.cY(_)}const fp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],gp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Sh{static cacheKey(t,a,u,p){let f=`${a}${p?p.cacheKey:""}`;for(const _ of u)t.usedDefines.includes(_)&&(f+=`/${_}`);return f}constructor(t,a,u,p,f,_){const b=t.gl;this.program=b.createProgram(),this.configuration=p,this.name=a,this.fixedDefines=[..._];const x=p?p.getBinderAttributes():[],T=(u.staticAttributes||[]).concat(x);let M=p?p.defines():[];M=M.concat(_.map($=>`#define ${$}`));const I=`#version 300 es
`;let C=I+M.concat("precision mediump float;",eo,Zu.fragmentSource).join(`
`);for(const $ of u.fragmentIncludes)C+=`
${El[$]}`;C+=`
${u.fragmentSource}`;let z=I+M.concat("precision highp float;",eo,Zu.vertexSource).join(`
`);for(const $ of u.vertexIncludes)z+=`
${El[$]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(z+=`
uniform int u_instanceID;
`),z+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(z=z.replaceAll("gl_InstanceID","u_instanceID"));const O=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(O,C),b.compileShader(O),b.attachShader(this.program,O);const N=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(N,z),b.compileShader(N),b.attachShader(this.program,N),this.attributes={},this.numAttributes=T.length;for(let $=0;$<this.numAttributes;$++)if(T[$]){const U=T[$].startsWith("a_")?T[$]:`a_${T[$]}`;b.bindAttribLocation(this.program,$,U),this.attributes[U]=$}b.linkProgram(this.program),b.deleteShader(N),b.deleteShader(O),this.fixedUniforms=f(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=($=>({u_instanceID:new o.c8($)}))(t)),(_.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=($=>({u_dem:new o.c8($),u_dem_prev:new o.c8($),u_dem_tl:new o.cb($),u_dem_scale:new o.ca($),u_dem_tl_prev:new o.cb($),u_dem_scale_prev:new o.ca($),u_dem_size:new o.ca($),u_dem_lerp:new o.ca($),u_exaggeration:new o.ca($),u_depth:new o.c8($),u_depth_size_inv:new o.cb($),u_depth_range_unpack:new o.cb($),u_occluder_half_size:new o.ca($),u_occlusion_depth_offset:new o.ca($),u_meter_to_dem:new o.ca($),u_label_plane_matrix_inv:new o.cc($)}))(t)),_.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new o.c9($),u_tile_tr_up:new o.c9($),u_tile_br_up:new o.c9($),u_tile_bl_up:new o.c9($),u_tile_up_scale:new o.ca($)}))(t)),_.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new o.cc($),u_fog_range:new o.cb($),u_fog_color:new o.cQ($),u_fog_horizon_blend:new o.ca($),u_fog_vertical_limit:new o.cb($),u_fog_temporal_offset:new o.ca($),u_frustum_tl:new o.c9($),u_frustum_tr:new o.c9($),u_frustum_br:new o.c9($),u_frustum_bl:new o.c9($),u_globe_pos:new o.c9($),u_globe_radius:new o.ca($),u_globe_transition:new o.ca($),u_is_globe:new o.c8($),u_viewport:new o.cb($)}))(t)),_.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new o.cQ($)}))(t)),_.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new o.c9($),u_lighting_directional_dir:new o.c9($),u_lighting_directional_color:new o.c9($),u_ground_radiance:new o.c9($)}))(t)),_.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new o.cc($),u_light_matrix_1:new o.cc($),u_fade_range:new o.cb($),u_shadow_normal_offset:new o.c9($),u_shadow_intensity:new o.ca($),u_shadow_texel_size:new o.ca($),u_shadow_map_resolution:new o.ca($),u_shadow_direction:new o.c9($),u_shadow_bias:new o.c9($),u_shadowmap_0:new o.c8($),u_shadowmap_1:new o.c8($)}))(t))}}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p]&&u[p].set(this.program,p,a[p])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p]&&u[p].set(this.program,p,a[p])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}_drawDebugWireframe(t,a,u,p,f,_,b,x,T,M){const I=t.options.wireframe;if(I.terrain===!1&&I.layers2D===!1&&I.layers3D===!1)return;const C=t.context;if(!(!(!I.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!I.layers2D||t._terrain&&t._terrain.renderingToTexture||!fp.includes(this.name))||!(!I.layers3D||!gp.includes(this.name))))return;const z=C.gl,O=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,f,C);if(!O)return;const N=[...this.fixedDefines];N.push("DEBUG_WIREFRAME");const $=t.getOrCreateProgram(this.name,{config:this.configuration,defines:N});C.program.set($.program);const U=(ne,le,se)=>{if(le[ne]&&se[ne])for(const re in le[ne])se[ne][re]&&se[ne][re].set(se.program,re,le[ne][re].current)};T&&T.setUniforms($.program,C,$.binderUniforms,b,{zoom:x}),U("fixedUniforms",this,$),U("terrainUniforms",this,$),U("globeUniforms",this,$),U("fogUniforms",this,$),U("lightsUniforms",this,$),U("shadowUniforms",this,$),O.bind(),C.setColorMode(new mi([z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ZERO,z.ONE],o.am.transparent,[!0,!0,!0,!1])),C.setDepthMode(new _t(a.func===z.LESS?z.LEQUAL:a.func,_t.ReadOnly,a.range)),C.setStencilMode(Gt.disabled);const q=3*_.primitiveLength*2,Q=3*_.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ne=M||1;for(let le=0;le<ne;++le)$.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",le),z.drawElements(z.LINES,q,z.UNSIGNED_SHORT,Q)}else M&&M>1?z.drawElementsInstanced(z.LINES,q,z.UNSIGNED_SHORT,Q,M):z.drawElements(z.LINES,q,z.UNSIGNED_SHORT,Q);f.bind(),C.program.set(this.program),C.setDepthMode(a),C.setStencilMode(u),C.setColorMode(p)}checkUniforms(t,a,u){if(this.fixedDefines.includes(a)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${a} being defined`)}}draw(t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$){const U=t.context,q=U.gl;if(this.failedToCreate)return;U.program.set(this.program),U.setDepthMode(u),U.setStencilMode(p),U.setColorMode(f),U.setCullFace(_);for(const le of Object.keys(this.fixedUniforms))this.fixedUniforms[le].set(this.program,le,b[le]);O&&O.setUniforms(this.program,U,this.binderUniforms,C,{zoom:z});const Q={[q.POINTS]:1,[q.LINES]:2,[q.TRIANGLES]:3,[q.LINE_STRIP]:1}[a];this.checkUniforms(x,"RENDER_SHADOWS",this.shadowUniforms);const ne=$&&$>0?1:void 0;for(const le of I.get()){const se=le.vaos||(le.vaos={});if((se[x]||(se[x]=new Cl)).bind(U,this,T,O?O.getPaintVertexBuffers():[],M,le.vertexOffset,N||[],ne),this.forceManualRenderingForInstanceIDShaders){const re=$||1;for(let ae=0;ae<re;++ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ae),M?q.drawElements(a,le.primitiveLength*Q,q.UNSIGNED_SHORT,le.primitiveOffset*Q*2):q.drawArrays(a,le.vertexOffset,le.vertexLength)}else $&&$>1?q.drawElementsInstanced(a,le.primitiveLength*Q,q.UNSIGNED_SHORT,le.primitiveOffset*Q*2,$):M?q.drawElements(a,le.primitiveLength*Q,q.UNSIGNED_SHORT,le.primitiveOffset*Q*2):q.drawArrays(a,le.vertexOffset,le.vertexLength);a===q.TRIANGLES&&M&&this._drawDebugWireframe(t,u,p,f,M,le,C,z,O,$)}}}function Qu(l,t,a=0){const u=Math.pow(2,t.tileID.overscaledZ),p=t.tileSize*Math.pow(2,l.transform.tileZoom)/u,f=p*(t.tileID.canonical.x+t.tileID.wrap*u),_=p*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(t,1,l.transform.tileZoom),u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_],u_pattern_transition:a}}const Ll={terrain:0,flat:1},_p=o.bz(),ec=(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U)=>{const q=t.style.light,Q=q.properties.get("position"),ne=[Q.x,Q.y,Q.z],le=o.dx();q.properties.get("anchor")==="viewport"&&(o.dy(le,-t.transform.angle),o.dz(ne,ne,le));const se=q.properties.get("color").toPremultipliedRenderColor(null),re=t.transform,ae={u_matrix:l,u_lightpos:ne,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_vertical_gradient:+a,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_p,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ll[T],u_base_type:Ll[M],u_ao:p,u_edge_radius:f,u_width_scale:_,u_flood_light_color:O,u_vertical_scale:N,u_flood_light_intensity:$,u_ground_shadow_factor:U};return re.projection.name==="globe"&&(ae.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],ae.u_zoom_transition=I,ae.u_inv_rot_matrix=z,ae.u_merc_center=C,ae.u_up_dir=re.projection.upVector(new o.cp(0,0,0),C[0]*o.aj,C[1]*o.aj),ae.u_height_lift=x),ae},Ff=(l,t,a,u,p,f)=>({u_matrix:l,u_edge_radius:t,u_width_scale:a,u_vertical_scale:u,u_height_type:Ll[p],u_base_type:Ll[f]}),Of=(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U)=>{const q=ec(l,t,a,u,p,f,_,b,T,M,I,C,z,O,N,$,1,[0,0,0]),Q={u_height_factor:-Math.pow(2,b.overscaledZ)/x.tileSize/8};return o.h(q,Qu(t,x,U),Q)},js=(l,t,a)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:a}),$f=(l,t,a,u,p,f=0)=>o.h(js(l,t,p),Qu(a,u,f)),Ky=(l,t,a,u)=>({u_matrix:l,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:u}),Xy=(l,t,a,u,p,f,_=0)=>o.h($f(l,t,a,u,f,_),{u_world:p}),Qy=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),Th=(l,t,a,u,p)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:u,u_reset_depth:p}),e1=(l,t,a,u)=>{const p=o.aj/a.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},Ph=(l,t,a=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:a}),yp=o.bz(),jf=(l,t,a,u,p,f,_)=>{const b=l.transform,x=b.projection.name==="globe",T=x?o.dA(b.zoom,t.canonical)*b._pixelsPerMercatorPixel:o.aw(a,1,f),M={u_matrix:t.projMatrix,u_extrude_scale:T,u_intensity:_,u_inv_rot_matrix:yp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(x){M.u_inv_rot_matrix=u,M.u_merc_center=p,M.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],M.u_zoom_transition=o.ah(b.zoom);const I=p[0]*o.aj,C=p[1]*o.aj;M.u_up_dir=b.projection.upVector(new o.cp(0,0,0),I,C)}return M};function Vs(l,[t,a,u,p],[f,_]){if(f===_)return[0,0,0,0];const b=255*(l-1)/(l*(_-f));return[t*b,a*b,u*b,p*b]}function wp(l,t,[a,u]){return a===u?0:.5/l+(t-a)*(l-1)/(l*(u-a))}const bp=(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U,q,Q,ne)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:f,u_scale_parent:T,u_fade_t:M.mix,u_opacity:M.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:o.dC(I.paint.get("raster-saturation")),u_contrast_factor:o.dB(I.paint.get("raster-contrast")),u_spin_weights:Vf(I.paint.get("raster-hue-rotate")),u_perspective_transform:C,u_raster_elevation:z,u_zoom_transition:_,u_merc_center:b,u_cutoff_params:x,u_colorization_mix:Vs(o.dD,N,U),u_colorization_offset:wp(o.dD,$,U),u_color_ramp:O,u_texture_offset:[Q/(q+2*Q),q/(q+2*Q)],u_texture_res:[q+2*Q,q+2*Q],u_emissive_strength:ne});function Vf(l){l*=Math.PI/180;const t=Math.sin(l),a=Math.cos(l);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ts=.05,Us=(l,t,a,u,p,f,_,b,x,T,M,I)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:f,u_scale_parent:T,u_fade_t:M.mix,u_opacity:M.opacity,u_image0:0,u_image1:1,u_raster_elevation:I,u_zoom_transition:_,u_merc_center:b,u_cutoff_params:x}),Uf=(l,t,a,u,p,f,_,b,x,T)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:u,u_color_ramp:f,u_velocity_res:p,u_max_speed:_,u_uv_offset:b,u_data_scale:[255*x[0],255*x[1]],u_data_offset:T,u_particle_pos_scale:1.1,u_particle_pos_offset:[ts,ts]}),is=(l,t,a,u,p,f,_,b,x,T)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:u,u_max_speed:p,u_speed_factor:f,u_reset_rate:_,u_rand_seed:Math.random(),u_uv_offset:b,u_data_scale:[255*x[0],255*x[1]],u_data_offset:T,u_particle_pos_scale:1.1,u_particle_pos_offset:[ts,ts]}),Mh=o.bz(),tc=(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U,q,Q,ne,le,se,re)=>{const ae=p.transform,ue={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ae.getCameraToCenterDistance(q),u_rotate_symbol:+a,u_aspect_ratio:ae.width/ae.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:_,u_coord_matrix:b,u_is_text:+T,u_elevation_from_sea:x?1:0,u_pitch_with_map:+u,u_texsize:M,u_texsize_icon:I,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mh,u_up_vector:[0,-1,0],u_color_adj_mat:le,u_icon_transition:se||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(q)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:re||1,u_ground_shadow_factor:Q,u_inv_matrix:o.bi(o.bz(),_),u_normal_scale:ne};return q.name==="globe"&&(ue.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],ue.u_zoom_transition=O,ue.u_inv_rot_matrix=$,ue.u_merc_center=N,ue.u_camera_forward=ae._camera.forward(),ue.u_ecef_origin=o.dE(ae.globeMatrix,z.toUnwrapped()),ue.u_tile_matrix=Float32Array.from(ae.globeMatrix),ue.u_up_vector=U),ue},vp=(l,t,a,u)=>({u_matrix:l,u_emissive_strength:t,u_opacity:a,u_color:u}),xp=(l,t,a,u,p,f,_,b,x)=>o.h(function(T,M,I,C,z,O){const{width:N,height:$}=C.imageManager.getPixelSize(M),U=Math.pow(2,O.tileID.overscaledZ),q=O.tileSize*Math.pow(2,C.transform.tileZoom)/U,Q=q*(O.tileID.canonical.x+O.tileID.wrap*U),ne=q*O.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[N,$],u_pattern_size:I.displaySize,u_pattern_units_to_pixels:z?[C.transform.width,-1*C.transform.height]:[1/o.aw(O,1,C.transform.tileZoom),1/o.aw(O,1,C.transform.tileZoom)],u_pixel_coord_upper:[Q>>16,ne>>16],u_pixel_coord_lower:[65535&Q,65535&ne]}}(0,f,_,u,b,x),{u_matrix:l,u_emissive_strength:t,u_opacity:a}),ic=new Float32Array(o.bx([])),nc=(l,t,a,u,p,f,_,b,x,T,M,I,C,z=[0,0,0],O)=>{const N=p.style.light,$=N.properties.get("position"),U=[-$.x,-$.y,$.z],q=o.dx();N.properties.get("anchor")==="viewport"&&(o.dy(q,-p.transform.angle),o.dz(U,U,q));const Q=M.alphaMode==="MASK",ne=N.properties.get("color").toNonPremultipliedRenderColor(null),le=C.paint.get("model-ambient-occlusion-intensity"),se=C.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return se.a=C.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:u||ic,u_lightpos:U,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:z,u_opacity:f,u_baseTextureIsAlpha:0,u_alphaMask:+Q,u_alphaCutoff:M.alphaCutoff,u_baseColorFactor:_.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:x,u_roughnessFactor:T,u_baseColorTexture:Ba.BaseColor,u_metallicRoughnessTexture:Ba.MetallicRoughness,u_normalTexture:Ba.Normal,u_occlusionTexture:Ba.Occlusion,u_emissionTexture:Ba.Emission,u_lutTexture:Ba.LUT,u_color_mix:se.toArray01(),u_aoIntensity:le,u_emissive_strength:I,u_occlusionTextureTransform:O||[0,0,0,0]}},Jf=(l,t=ic,a=ic)=>({u_matrix:l,u_instance:t,u_node_matrix:a}),qf={fillExtrusion:l=>({u_matrix:new o.cc(l),u_lightpos:new o.c9(l),u_lightintensity:new o.ca(l),u_lightcolor:new o.c9(l),u_vertical_gradient:new o.ca(l),u_opacity:new o.ca(l),u_edge_radius:new o.ca(l),u_width_scale:new o.ca(l),u_ao:new o.cb(l),u_height_type:new o.c8(l),u_base_type:new o.c8(l),u_tile_id:new o.c9(l),u_zoom_transition:new o.ca(l),u_inv_rot_matrix:new o.cc(l),u_merc_center:new o.cb(l),u_up_dir:new o.c9(l),u_height_lift:new o.ca(l),u_flood_light_color:new o.c9(l),u_vertical_scale:new o.ca(l),u_flood_light_intensity:new o.ca(l),u_ground_shadow_factor:new o.c9(l)}),fillExtrusionDepth:l=>({u_matrix:new o.cc(l),u_edge_radius:new o.ca(l),u_width_scale:new o.ca(l),u_vertical_scale:new o.ca(l),u_height_type:new o.c8(l),u_base_type:new o.c8(l)}),fillExtrusionPattern:l=>({u_matrix:new o.cc(l),u_lightpos:new o.c9(l),u_lightintensity:new o.ca(l),u_lightcolor:new o.c9(l),u_vertical_gradient:new o.ca(l),u_height_factor:new o.ca(l),u_edge_radius:new o.ca(l),u_width_scale:new o.ca(l),u_ao:new o.cb(l),u_height_type:new o.c8(l),u_base_type:new o.c8(l),u_tile_id:new o.c9(l),u_zoom_transition:new o.ca(l),u_inv_rot_matrix:new o.cc(l),u_merc_center:new o.cb(l),u_up_dir:new o.c9(l),u_height_lift:new o.ca(l),u_image:new o.c8(l),u_texsize:new o.cb(l),u_pixel_coord_upper:new o.cb(l),u_pixel_coord_lower:new o.cb(l),u_tile_units_to_pixels:new o.ca(l),u_opacity:new o.ca(l),u_pattern_transition:new o.ca(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new o.cc(l),u_opacity:new o.ca(l),u_ao_pass:new o.ca(l),u_meter_to_tile:new o.ca(l),u_ao:new o.cb(l),u_flood_light_intensity:new o.ca(l),u_flood_light_color:new o.c9(l),u_attenuation:new o.ca(l),u_edge_radius:new o.ca(l),u_fb:new o.c8(l),u_fb_size:new o.ca(l),u_dynamic_offset:new o.ca(l)}),fill:l=>({u_matrix:new o.cc(l),u_emissive_strength:new o.ca(l),u_ground_shadow_factor:new o.c9(l)}),fillPattern:l=>({u_matrix:new o.cc(l),u_emissive_strength:new o.ca(l),u_image:new o.c8(l),u_texsize:new o.cb(l),u_pixel_coord_upper:new o.cb(l),u_pixel_coord_lower:new o.cb(l),u_tile_units_to_pixels:new o.ca(l),u_ground_shadow_factor:new o.c9(l),u_pattern_transition:new o.ca(l)}),fillOutline:l=>({u_matrix:new o.cc(l),u_emissive_strength:new o.ca(l),u_world:new o.cb(l),u_ground_shadow_factor:new o.c9(l)}),fillOutlinePattern:l=>({u_matrix:new o.cc(l),u_emissive_strength:new o.ca(l),u_world:new o.cb(l),u_image:new o.c8(l),u_texsize:new o.cb(l),u_pixel_coord_upper:new o.cb(l),u_pixel_coord_lower:new o.cb(l),u_tile_units_to_pixels:new o.ca(l),u_ground_shadow_factor:new o.c9(l),u_pattern_transition:new o.ca(l)}),building:l=>({u_matrix:new o.cc(l),u_normal_matrix:new o.cc(l),u_opacity:new o.ca(l)}),buildingDepth:l=>({u_matrix:new o.cc(l)}),elevatedStructuresDepth:l=>({u_matrix:new o.cc(l),u_depth_bias:new o.ca(l)}),elevatedStructures:l=>({u_matrix:new o.cc(l),u_ground_shadow_factor:new o.c9(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new o.cc(l),u_camera_pos:new o.c9(l),u_depth_bias:new o.ca(l),u_height_scale:new o.ca(l),u_reset_depth:new o.ca(l)}),circle:o.dH,collisionBox:l=>({u_matrix:new o.cc(l),u_camera_to_center_distance:new o.ca(l),u_extrude_scale:new o.cb(l)}),collisionCircle:l=>({u_matrix:new o.cc(l),u_inv_matrix:new o.cc(l),u_camera_to_center_distance:new o.ca(l),u_viewport_size:new o.cb(l)}),debug:l=>({u_color:new o.di(l),u_matrix:new o.cc(l),u_overlay:new o.c8(l),u_overlay_scale:new o.ca(l)}),clippingMask:l=>({u_matrix:new o.cc(l)}),heatmap:l=>({u_extrude_scale:new o.ca(l),u_intensity:new o.ca(l),u_matrix:new o.cc(l),u_inv_rot_matrix:new o.cc(l),u_merc_center:new o.cb(l),u_tile_id:new o.c9(l),u_zoom_transition:new o.ca(l),u_up_dir:new o.c9(l)}),heatmapTexture:l=>({u_image:new o.c8(l),u_color_ramp:new o.c8(l),u_opacity:new o.ca(l)}),hillshade:l=>({u_matrix:new o.cc(l),u_image:new o.c8(l),u_latrange:new o.cb(l),u_light:new o.cb(l),u_shadow:new o.di(l),u_highlight:new o.di(l),u_emissive_strength:new o.ca(l),u_accent:new o.di(l)}),hillshadePrepare:l=>({u_matrix:new o.cc(l),u_image:new o.c8(l),u_dimension:new o.cb(l),u_zoom:new o.ca(l)}),line:o.dG,linePattern:o.dF,raster:l=>({u_matrix:new o.cc(l),u_normalize_matrix:new o.cc(l),u_globe_matrix:new o.cc(l),u_merc_matrix:new o.cc(l),u_grid_matrix:new o.dj(l),u_tl_parent:new o.cb(l),u_scale_parent:new o.ca(l),u_fade_t:new o.ca(l),u_opacity:new o.ca(l),u_image0:new o.c8(l),u_image1:new o.c8(l),u_brightness_low:new o.ca(l),u_brightness_high:new o.ca(l),u_saturation_factor:new o.ca(l),u_contrast_factor:new o.ca(l),u_spin_weights:new o.c9(l),u_perspective_transform:new o.cb(l),u_raster_elevation:new o.ca(l),u_zoom_transition:new o.ca(l),u_merc_center:new o.cb(l),u_cutoff_params:new o.cQ(l),u_colorization_mix:new o.cQ(l),u_colorization_offset:new o.ca(l),u_color_ramp:new o.c8(l),u_texture_offset:new o.cb(l),u_texture_res:new o.cb(l),u_emissive_strength:new o.ca(l)}),rasterParticle:l=>({u_matrix:new o.cc(l),u_normalize_matrix:new o.cc(l),u_globe_matrix:new o.cc(l),u_merc_matrix:new o.cc(l),u_grid_matrix:new o.dj(l),u_tl_parent:new o.cb(l),u_scale_parent:new o.ca(l),u_fade_t:new o.ca(l),u_opacity:new o.ca(l),u_image0:new o.c8(l),u_image1:new o.c8(l),u_raster_elevation:new o.ca(l),u_zoom_transition:new o.ca(l),u_merc_center:new o.cb(l),u_cutoff_params:new o.cQ(l)}),rasterParticleTexture:l=>({u_texture:new o.c8(l),u_opacity:new o.ca(l)}),rasterParticleDraw:l=>({u_particle_texture:new o.c8(l),u_particle_texture_side_len:new o.ca(l),u_tile_offset:new o.cb(l),u_velocity:new o.c8(l),u_color_ramp:new o.c8(l),u_velocity_res:new o.cb(l),u_max_speed:new o.ca(l),u_uv_offset:new o.cb(l),u_data_scale:new o.cb(l),u_data_offset:new o.ca(l),u_particle_pos_scale:new o.ca(l),u_particle_pos_offset:new o.cb(l)}),rasterParticleUpdate:l=>({u_particle_texture:new o.c8(l),u_particle_texture_side_len:new o.ca(l),u_velocity:new o.c8(l),u_velocity_res:new o.cb(l),u_max_speed:new o.ca(l),u_speed_factor:new o.ca(l),u_reset_rate:new o.ca(l),u_rand_seed:new o.ca(l),u_uv_offset:new o.cb(l),u_data_scale:new o.cb(l),u_data_offset:new o.ca(l),u_particle_pos_scale:new o.ca(l),u_particle_pos_offset:new o.cb(l)}),symbol:l=>({u_is_size_zoom_constant:new o.c8(l),u_is_size_feature_constant:new o.c8(l),u_size_t:new o.ca(l),u_size:new o.ca(l),u_camera_to_center_distance:new o.ca(l),u_rotate_symbol:new o.c8(l),u_aspect_ratio:new o.ca(l),u_fade_change:new o.ca(l),u_matrix:new o.cc(l),u_label_plane_matrix:new o.cc(l),u_coord_matrix:new o.cc(l),u_is_text:new o.c8(l),u_elevation_from_sea:new o.c8(l),u_pitch_with_map:new o.c8(l),u_texsize:new o.cb(l),u_texsize_icon:new o.cb(l),u_texture:new o.c8(l),u_texture_icon:new o.c8(l),u_gamma_scale:new o.ca(l),u_device_pixel_ratio:new o.ca(l),u_tile_id:new o.c9(l),u_zoom_transition:new o.ca(l),u_inv_rot_matrix:new o.cc(l),u_merc_center:new o.cb(l),u_camera_forward:new o.c9(l),u_tile_matrix:new o.cc(l),u_up_vector:new o.c9(l),u_ecef_origin:new o.c9(l),u_is_halo:new o.c8(l),u_icon_transition:new o.ca(l),u_color_adj_mat:new o.cc(l),u_scale_factor:new o.ca(l),u_ground_shadow_factor:new o.c9(l),u_inv_matrix:new o.cc(l),u_normal_scale:new o.ca(l)}),background:l=>({u_matrix:new o.cc(l),u_emissive_strength:new o.ca(l),u_opacity:new o.ca(l),u_color:new o.di(l)}),backgroundPattern:l=>({u_matrix:new o.cc(l),u_emissive_strength:new o.ca(l),u_opacity:new o.ca(l),u_image:new o.c8(l),u_pattern_tl:new o.cb(l),u_pattern_br:new o.cb(l),u_texsize:new o.cb(l),u_pattern_size:new o.cb(l),u_pixel_coord_upper:new o.cb(l),u_pixel_coord_lower:new o.cb(l),u_pattern_units_to_pixels:new o.cb(l)}),terrainRaster:l=>({u_matrix:new o.cc(l),u_image0:new o.c8(l),u_skirt_height:new o.ca(l),u_ground_shadow_factor:new o.c9(l)}),skybox:l=>({u_matrix:new o.cc(l),u_sun_direction:new o.c9(l),u_cubemap:new o.c8(l),u_opacity:new o.ca(l),u_temporal_offset:new o.ca(l)}),skyboxGradient:l=>({u_matrix:new o.cc(l),u_color_ramp:new o.c8(l),u_center_direction:new o.c9(l),u_radius:new o.ca(l),u_opacity:new o.ca(l),u_temporal_offset:new o.ca(l)}),skyboxCapture:l=>({u_matrix_3f:new o.dj(l),u_sun_direction:new o.c9(l),u_sun_intensity:new o.ca(l),u_color_tint_r:new o.cQ(l),u_color_tint_m:new o.cQ(l),u_luminance:new o.ca(l)}),globeRaster:l=>({u_proj_matrix:new o.cc(l),u_globe_matrix:new o.cc(l),u_normalize_matrix:new o.cc(l),u_merc_matrix:new o.cc(l),u_zoom_transition:new o.ca(l),u_merc_center:new o.cb(l),u_image0:new o.c8(l),u_grid_matrix:new o.dj(l),u_skirt_height:new o.ca(l),u_far_z_cutoff:new o.ca(l),u_frustum_tl:new o.c9(l),u_frustum_tr:new o.c9(l),u_frustum_br:new o.c9(l),u_frustum_bl:new o.c9(l),u_globe_pos:new o.c9(l),u_globe_radius:new o.ca(l),u_viewport:new o.cb(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.c9(l),u_frustum_tr:new o.c9(l),u_frustum_br:new o.c9(l),u_frustum_bl:new o.c9(l),u_horizon:new o.ca(l),u_transition:new o.ca(l),u_fadeout_range:new o.ca(l),u_color:new o.cQ(l),u_high_color:new o.cQ(l),u_space_color:new o.cQ(l),u_temporal_offset:new o.ca(l),u_horizon_angle:new o.ca(l)}),model:l=>({u_matrix:new o.cc(l),u_lighting_matrix:new o.cc(l),u_normal_matrix:new o.cc(l),u_node_matrix:new o.cc(l),u_lightpos:new o.c9(l),u_lightintensity:new o.ca(l),u_lightcolor:new o.c9(l),u_camera_pos:new o.c9(l),u_opacity:new o.ca(l),u_baseColorFactor:new o.cQ(l),u_emissiveFactor:new o.cQ(l),u_metallicFactor:new o.ca(l),u_roughnessFactor:new o.ca(l),u_baseTextureIsAlpha:new o.c8(l),u_alphaMask:new o.c8(l),u_alphaCutoff:new o.ca(l),u_baseColorTexture:new o.c8(l),u_metallicRoughnessTexture:new o.c8(l),u_normalTexture:new o.c8(l),u_occlusionTexture:new o.c8(l),u_emissionTexture:new o.c8(l),u_lutTexture:new o.c8(l),u_color_mix:new o.cQ(l),u_aoIntensity:new o.ca(l),u_emissive_strength:new o.ca(l),u_occlusionTextureTransform:new o.cQ(l)}),modelDepth:l=>({u_matrix:new o.cc(l),u_instance:new o.cc(l),u_node_matrix:new o.cc(l)}),groundShadow:l=>({u_matrix:new o.cc(l),u_ground_shadow_factor:new o.c9(l)}),stars:l=>({u_matrix:new o.cc(l),u_up:new o.c9(l),u_right:new o.c9(l),u_intensity_multiplier:new o.ca(l)}),snowParticle:l=>({u_modelview:new o.cc(l),u_projection:new o.cc(l),u_time:new o.ca(l),u_cam_pos:new o.c9(l),u_velocityConeAperture:new o.ca(l),u_velocity:new o.ca(l),u_horizontalOscillationRadius:new o.ca(l),u_horizontalOscillationRate:new o.ca(l),u_boxSize:new o.ca(l),u_billboardSize:new o.ca(l),u_simpleShapeParameters:new o.cb(l),u_screenSize:new o.cb(l),u_thinningCenterPos:new o.cb(l),u_thinningShape:new o.c9(l),u_thinningAffectedRatio:new o.ca(l),u_thinningParticleOffset:new o.ca(l),u_particleColor:new o.cQ(l),u_direction:new o.c9(l)}),rainParticle:l=>({u_modelview:new o.cc(l),u_projection:new o.cc(l),u_time:new o.ca(l),u_cam_pos:new o.c9(l),u_texScreen:new o.c8(l),u_velocityConeAperture:new o.ca(l),u_velocity:new o.ca(l),u_boxSize:new o.ca(l),u_rainDropletSize:new o.cb(l),u_distortionStrength:new o.ca(l),u_rainDirection:new o.c9(l),u_color:new o.cQ(l),u_screenSize:new o.cb(l),u_thinningCenterPos:new o.cb(l),u_thinningShape:new o.c9(l),u_thinningAffectedRatio:new o.ca(l),u_thinningParticleOffset:new o.ca(l),u_shapeDirectionalPower:new o.ca(l),u_shapeNormalPower:new o.ca(l),u_mode:new o.ca(l)}),vignette:l=>({u_vignetteShape:new o.c9(l),u_vignetteColor:new o.cQ(l)}),occlusion:l=>({u_matrix:new o.cc(l),u_anchorPos:new o.c9(l),u_screenSizePx:new o.cb(l),u_occluderSizePx:new o.cb(l),u_color:new o.cQ(l)})};class Tr{constructor(t,a,u,p){this.id=Tr.uniqueIdxCounter,Tr.uniqueIdxCounter++,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||p||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Tr.uniqueIdxCounter,Tr.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Tr.uniqueIdxCounter=0;const t1={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class i1{constructor(t,a,u,p,f,_){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.instanceCount=_,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||f||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const p=a.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,a,u){for(let p=0;p<this.attributes.length;p++){const f=this.attributes[p],_=a.attributes[f.name];_!==void 0&&t.vertexAttribPointer(_,f.components,t[t1[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,a,u){for(let p=0;p<this.attributes.length;p++){const f=a.attributes[this.attributes[p].name];f!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(f,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class kp{constructor(t,a,u,p,f){this.context=t,this.width=a,this.height=u;const _=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new Bf(t,_)),f&&(this.depthAttachmentType=f,this.depthAttachment=f==="renderbuffer"?new Wf(t,_):new Yy(t,_))}destroy(){const t=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class n1{constructor(t,a){this.gl=t,this.clearColor=new Mf(this),this.clearDepth=new sp(this),this.clearStencil=new jy(this),this.colorMask=new Vy(this),this.depthMask=new Uy(this),this.stencilMask=new Jy(this),this.stencilFunc=new Ef(this),this.stencilOp=new qy(this),this.stencilTest=new mh(this),this.depthRange=new Gy(this),this.depthTest=new Cf(this),this.depthFunc=new lp(this),this.blend=new fh(this),this.blendFunc=new up(this),this.blendColor=new Fs(this),this.blendEquation=new Dl(this),this.cullFace=new gh(this),this.cullFaceSide=new _h(this),this.frontFace=new Il(this),this.program=new Df(this),this.activeTexture=new cp(this),this.viewport=new If(this),this.bindFramebuffer=new zl(this),this.bindRenderbuffer=new yh(this),this.bindTexture=new wh(this),this.bindVertexBuffer=new hp(this),this.bindElementBuffer=new bh(this),this.bindVertexArrayOES=new Ku(this),this.pixelStoreUnpack=new zf(this),this.pixelStoreUnpackPremultiplyAlpha=new Lf(this),this.pixelStoreUnpackFlipY=new Rf(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,u){return new Tr(this,t,a,u)}createVertexBuffer(t,a,u,p,f){return new i1(this,t,a,u,p,f)}createRenderbuffer(t,a,u){const p=this.gl,f=p.createRenderbuffer();return this.bindRenderbuffer.set(f),p.renderbufferStorage(p.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),f}createFramebuffer(t,a,u,p){return new kp(this,t,a,u,p)}clear({color:t,depth:a,stencil:u,colorMask:p}){const f=this.gl;let _=0;t&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(p||[!0,!0,!0,!0])),a!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),f.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bv(t.blendFunction,mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Rl;function Eh(l,t,a,u,p,f,_){const b=l.context,x=b.gl,T=l.transform,M=l.getOrCreateProgram("collisionBox"),I=[];let C=0,z=0;for(let ne=0;ne<u.length;ne++){const le=u[ne],se=t.getTile(le),re=se.getBucket(a);if(!re)continue;const ae=Vt(le,re,T);let ue=ae;p[0]===0&&p[1]===0||(ue=l.translatePosMatrix(ae,se,p,f));const he=_?re.textCollisionBox:re.iconCollisionBox,xe=re.collisionCircleArray;if(xe.length>0){const ke=o.bz(),Ne=ue;o.cB(ke,re.placementInvProjMatrix,T.glCoordMatrix),o.cB(ke,ke,re.placementViewportMatrix),I.push({circleArray:xe,circleOffset:z,transform:Ne,invTransform:ke,projection:re.getProjection()}),C+=xe.length/4,z=C}he&&(l.terrain&&l.terrain.setupElevationDraw(se,M),M.draw(l,x.LINES,_t.disabled,Gt.disabled,l.colorModeForRenderPass(),Ft.disabled,e1(ue,T,se,re.getProjection()),a.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,T.zoom,null,[he.collisionVertexBuffer,he.collisionVertexBufferExt]))}if(!_||!I.length)return;const O=l.getOrCreateProgram("collisionCircle"),N=new o.dI;N.resize(4*C),N._trim();let $=0;for(const ne of I)for(let le=0;le<ne.circleArray.length/4;le++){const se=4*le,re=ne.circleArray[se+0],ae=ne.circleArray[se+1],ue=ne.circleArray[se+2],he=ne.circleArray[se+3];N.emplace($++,re,ae,ue,he,0),N.emplace($++,re,ae,ue,he,1),N.emplace($++,re,ae,ue,he,2),N.emplace($++,re,ae,ue,he,3)}(!Rl||Rl.length<2*C)&&(Rl=function(ne){const le=2*ne,se=new o.a_;se.resize(le),se._trim();for(let re=0;re<le;re++){const ae=6*re;se.uint16[ae+0]=4*re+0,se.uint16[ae+1]=4*re+1,se.uint16[ae+2]=4*re+2,se.uint16[ae+3]=4*re+2,se.uint16[ae+4]=4*re+3,se.uint16[ae+5]=4*re+0}return se}(C));const U=b.createIndexBuffer(Rl,!0),q=b.createVertexBuffer(N,o.dJ.members,!0);for(const ne of I){const le={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(Q=T).getCameraToCenterDistance(ne.projection),u_viewport_size:[Q.width,Q.height]};O.draw(l,x.TRIANGLES,_t.disabled,Gt.disabled,l.colorModeForRenderPass(),Ft.disabled,le,a.id,q,U,o.bd.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,T.zoom)}var Q;q.destroy(),U.destroy()}const xo=o.bz();function ac(l){const t=l._camera.getWorldToCamera(l.worldSize,1),a=o.az([],t,l.globeMatrix);o.bi(a,a);const u=[0,0,0],p=[0,1,0,0];return o.aA(p,p,a),u[0]=p[0],u[1]=p[1],u[2]=p[2],o.au(u,u),u}function rc({width:l,height:t,anchor:a,textOffset:u,textScale:p},f){const{horizontalAlign:_,verticalAlign:b}=o.bT(a),x=-(_-.5)*l,T=-(b-.5)*t,M=o.bU(a,u);return new o.P((x/p+M[0])*f,(T/p+M[1])*f)}function Gf(l,t,a,u,p,f,_,b,x,T){const M=l.text.placedSymbolArray,I=l.text.dynamicLayoutVertexArray,C=l.icon.dynamicLayoutVertexArray,z={},O=l.getProjection(),N=ah(_,O,p),$=p.elevation,U=O.upVectorScale(_.canonical,p.center.lat,p.worldSize).metersToTile;I.clear();for(let q=0;q<M.length;q++){const Q=M.get(q),{tileAnchorX:ne,tileAnchorY:le,numGlyphs:se}=Q,re=Q.hidden||!Q.crossTileID||l.allowVerticalPlacement&&!Q.placedOrientation?null:u[Q.crossTileID];if(re){let ae=0,ue=0,he=0;if($){const je=$?$.getAtTileOffset(_,ne,le):0,[Pe,Je,at]=O.upVector(_.canonical,ne,le);ae=je*Pe*U,ue=je*Je*U,he=je*at*U}let[xe,ke,Ne,Fe]=Fr(Q.projectedAnchorX+ae,Q.projectedAnchorY+ue,Q.projectedAnchorZ+he,a?N:f);const Ge=Fu(p.getCameraToCenterDistance(O),Fe);let be=o.bJ(l.textSizeData,x,Q)*Ge/o.bO;a&&(be*=l.tilePixelRatio/b);const ze=rc(re,be);a?({x:xe,y:ke,z:Ne}=O.projectTilePoint(ne+ze.x,le+ze.y,_.canonical),[xe,ke,Ne]=Fr(xe+ae,ke+ue,Ne+he,f)):(t&&ze._rotate(-p.angle),xe+=ze.x,ke+=ze.y,Ne=0);const fe=l.allowVerticalPlacement&&Q.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let je=0;je<se;je++)o.bL(I,xe,ke,Ne,fe);T&&Q.associatedIconIndex>=0&&(z[Q.associatedIconIndex]={x:xe,y:ke,z:Ne,angle:fe})}else Ls(se,I)}if(T){C.clear();const q=l.icon.placedSymbolArray;for(let Q=0;Q<q.length;Q++){const ne=q.get(Q),{numGlyphs:le}=ne,se=z[Q];if(ne.hidden||!se)Ls(le,C);else{const{x:re,y:ae,z:ue,angle:he}=se;for(let xe=0;xe<le;xe++)o.bL(C,re,ae,ue,he)}}l.icon.dynamicLayoutVertexBuffer.updateData(C)}l.text.dynamicLayoutVertexBuffer.updateData(I)}function Bl(l,t,a,u,p,f,_={}){const b=a.paint.get("icon-translate"),x=a.paint.get("text-translate"),T=a.paint.get("icon-translate-anchor"),M=a.paint.get("text-translate-anchor"),I=a.layout.get("icon-rotation-alignment"),C=a.layout.get("text-rotation-alignment"),z=a.layout.get("icon-pitch-alignment"),O=a.layout.get("text-pitch-alignment"),N=a.layout.get("icon-keep-upright"),$=a.layout.get("text-keep-upright"),U=a.paint.get("icon-color-saturation"),q=a.paint.get("icon-color-contrast"),Q=a.paint.get("icon-color-brightness-min"),ne=a.paint.get("icon-color-brightness-max"),le=a.layout.get("symbol-elevation-reference")==="sea",se=l.context,re=se.gl,ae=l.transform,ue=I==="map",he=C==="map",xe=z==="map",ke=O==="map",Ne=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Fe=!1;const Ge=l.depthModeForSublayer(0,_t.ReadOnly),be=new _t(l.context.gl.LEQUAL,_t.ReadOnly,l.depthRangeFor3D),ze=[o.aD(ae.center.lng),o.aH(ae.center.lat)],fe=a.layout.get("text-variable-anchor"),je=ae.projection.name==="globe",Pe=[],Je=[0,-1,0];for(const at of u){const $e=t.getTile(at),it=$e.getBucket(a);if(!it||it.projection.name==="mercator"&&je||it.fullyClipped)continue;const wt=it.projection.name==="globe",bt=wt?o.ah(ae.zoom):0,ft=ah(at,it.getProjection(),ae),Et=ae.calculatePixelsToTileUnitsMatrix($e),Dt=fe&&it.hasTextData(),Rt=it.hasIconTextFit()&&Dt&&it.hasIconData(),Jt=it.getProjection().createInversionMatrix(ae,at.canonical),si=(1<<$e.tileID.canonical.z)*o.aj/l.transform.worldSize,Ni=rn=>{let zi=[0,0,0];if(rn){const Dn=l.style.directionalLight,Ti=l.style.ambientLight;Dn&&Ti&&(zi=Ws(l.style,Dn,Ti))}return zi},an=rn=>{ae.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||l.terrain)&&(rn.push("DEPTH_D24"),rn.push("DEPTH_OCCLUSION"))},ji=()=>{const rn=ue&&a.layout.get("symbol-placement")!=="point",zi=[];an(zi);const Dn=rn||Rt,Ti=it.elevationType==="road"&&xe,jn=l.shadowRenderer,cn=Ti&&!!jn&&jn.enabled,Qi=Ni(cn),hn=Ti?be:Ge,Ri=a.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&xe&&zi.push("PITCH_WITH_MAP_TERRAIN"),wt&&(zi.push("PROJECTION_GLOBE_VIEW"),Dn&&zi.push("PROJECTED_POS_ON_VIEWPORT")),Ri>0&&zi.push("ICON_TRANSITION"),it.icon.zOffsetVertexBuffer&&zi.push("Z_OFFSET"),U===0&&q===0&&Q===0&&ne===1||zi.push("COLOR_ADJUSTMENT"),it.sdfIcons&&zi.push("RENDER_SDF"),cn&&zi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ti&&it.icon.orientationVertexBuffer&&zi.push("ELEVATED_ROADS");const zn=it.icon.programConfigurations.get(a.id),ga=l.getOrCreateProgram("symbol",{config:zn,defines:zi}),wn=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Di=it.iconSizeData,nr=o.bH(Di,ae.zoom),Ja=xe||!ae.isOrthographic,mr=yo(ft,$e.tileID.canonical,xe,ue,ae,it.getProjection(),Et),Vr=th(ft,$e.tileID.canonical,xe,ue,ae,it.getProjection(),Et),Mr=l.translatePosMatrix(Vr,$e,b,T,!0),qa=l.translatePosMatrix(ft,$e,b,T),hs=Dn?xo:mr,Ur=ue&&!xe&&!rn;let ds=Je;!je&&!ae.mercatorFromTransition||ue||(ds=ac(ae));const xc=wt?ds:Je,Gp=a.getColorAdjustmentMatrix(U,q,Q,ne),Zl=tc(Di.kind,nr,Ur,xe,l,qa,hs,Mr,le,!1,wn,[0,0],0,at,bt,ze,Jt,xc,it.getProjection(),Qi,si,Gp,Ri,null),Yp=$e.imageAtlasTexture?$e.imageAtlasTexture:null,kc=a.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear,Yh=it.sdfIcons||l.options.rotating||l.options.zooming||kc||Ja?re.LINEAR:re.NEAREST,Hh=it.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,ao=l.terrain&&xe&&rn?o.bi(o.bz(),mr):xo;if(rn&&it.icon){const Kl=ae.elevation,Zs=Kl?Kl.getAtTileOffsetFunc(at,ae.center.lat,ae.worldSize,it.getProjection()):null,ps=eh(ft,$e.tileID.canonical,xe,ue,ae,it.getProjection(),Et);ih(it,ft,l,!1,ps,Vr,xe,N,Zs,at)}return{program:ga,buffers:it.icon,uniformValues:Zl,atlasTexture:Yp,atlasTextureIcon:null,atlasInterpolation:Yh,atlasInterpolationIcon:null,isSDF:it.sdfIcons,hasHalo:Hh,depthMode:hn,tile:$e,renderWithShadows:cn,labelPlaneMatrixInv:ao}},qi=()=>{const rn=he&&a.layout.get("symbol-placement")!=="point",zi=[],Dn=rn||fe||Rt,Ti=it.elevationType==="road"&&ke,jn=l.shadowRenderer,cn=Ti&&!!jn&&jn.enabled,Qi=Ni(cn),hn=Ti?be:Ge;l.terrainRenderModeElevated()&&ke&&zi.push("PITCH_WITH_MAP_TERRAIN"),wt&&(zi.push("PROJECTION_GLOBE_VIEW"),Dn&&zi.push("PROJECTED_POS_ON_VIEWPORT")),it.text.zOffsetVertexBuffer&&zi.push("Z_OFFSET"),it.iconsInText&&zi.push("RENDER_TEXT_AND_SYMBOL"),zi.push("RENDER_SDF"),cn&&zi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ti&&it.text.orientationVertexBuffer&&zi.push("ELEVATED_ROADS"),an(zi);const Ri=it.text.programConfigurations.get(a.id),zn=l.getOrCreateProgram("symbol",{config:Ri,defines:zi});let ga,wn=[0,0],Di=null;const nr=it.textSizeData;it.iconsInText&&(wn=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Di=$e.imageAtlasTexture?$e.imageAtlasTexture:null,ga=ke||!ae.isOrthographic||l.options.rotating||l.options.zooming||nr.kind==="composite"||nr.kind==="camera"?re.LINEAR:re.NEAREST);const Ja=$e.glyphAtlasTexture?$e.glyphAtlasTexture.size:[0,0],mr=a.layout.get("text-size-scale-range"),Vr=o.ay(l.scaleFactor,mr[0],mr[1]),Mr=o.bH(nr,ae.zoom,Vr),qa=yo(ft,$e.tileID.canonical,ke,he,ae,it.getProjection(),Et),hs=th(ft,$e.tileID.canonical,ke,he,ae,it.getProjection(),Et),Ur=l.translatePosMatrix(hs,$e,x,M,!0),ds=l.translatePosMatrix(ft,$e,x,M),xc=Dn?xo:qa,Gp=he&&!ke&&!rn;let Zl=Je;!je&&!ae.mercatorFromTransition||he||(Zl=ac(ae));const Yp=tc(nr.kind,Mr,Gp,ke,l,ds,xc,Ur,le,!0,Ja,wn,0,at,bt,ze,Jt,wt?Zl:Je,it.getProjection(),Qi,si,null,null,Vr),kc=$e.glyphAtlasTexture?$e.glyphAtlasTexture:null,Yh=re.LINEAR,Hh=a.paint.get("text-halo-width").constantOr(1)!==0,ao=l.terrain&&ke&&rn?o.bi(o.bz(),qa):xo;if(rn&&it.text){const Kl=ae.elevation,Zs=Kl?Kl.getAtTileOffsetFunc(at,ae.center.lat,ae.worldSize,it.getProjection()):null,ps=eh(ft,$e.tileID.canonical,ke,he,ae,it.getProjection(),Et);ih(it,ft,l,!0,ps,hs,ke,$,Zs,at)}return{program:zn,buffers:it.text,uniformValues:Yp,atlasTexture:kc,atlasTextureIcon:Di,atlasInterpolation:Yh,atlasInterpolationIcon:ga,isSDF:!0,hasHalo:Hh,depthMode:hn,tile:$e,renderWithShadows:cn,labelPlaneMatrixInv:ao}},Fn=it.icon.segments.get().length,ei=it.text.segments.get().length,hi=Fn&&!_.onlyText?ji():null,vi=ei&&!_.onlyIcons?qi():null,un=a.paint.get("icon-opacity").constantOr(1),Gn=a.paint.get("text-opacity").constantOr(1);if(Ne&&it.canOverlap){Fe=!0;const rn=un&&!_.onlyText?it.icon.segments.get():[],zi=Gn&&!_.onlyIcons?it.text.segments.get():[];for(const Dn of rn)Pe.push({segments:new o.bd([Dn]),sortKey:Dn.sortKey,state:hi});for(const Dn of zi)Pe.push({segments:new o.bd([Dn]),sortKey:Dn.sortKey,state:vi})}else _.onlyText||Pe.push({segments:un?it.icon.segments:new o.bd([]),sortKey:0,state:hi}),_.onlyIcons||Pe.push({segments:Gn?it.text.segments:new o.bd([]),sortKey:0,state:vi})}Fe&&Pe.sort((at,$e)=>at.sortKey-$e.sortKey);for(const at of Pe){const $e=at.state;if($e)if(l.terrain?l.terrain.setupElevationDraw($e.tile,$e.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$e.labelPlaneMatrixInv}):l.setupDepthForOcclusion(ae.depthOcclusionForSymbolsAndCircles,$e.program),se.activeTexture.set(re.TEXTURE0),$e.atlasTexture&&$e.atlasTexture.bind($e.atlasInterpolation,re.CLAMP_TO_EDGE,!0),$e.atlasTextureIcon&&(se.activeTexture.set(re.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),$e.renderWithShadows&&l.shadowRenderer.setupShadows($e.tile.tileID.toUnwrapped(),$e.program,"vector-tile",$e.tile.tileID.overscaledZ),l.uploadCommonLightUniforms(l.context,$e.program),$e.hasHalo){const it=$e.uniformValues;it.u_is_halo=1,Wl($e.buffers,at.segments,a,l,$e.program,$e.depthMode,p,f,it,2),it.u_is_halo=0}else{if($e.isSDF){const it=$e.uniformValues;$e.hasHalo&&(it.u_is_halo=1,Wl($e.buffers,at.segments,a,l,$e.program,$e.depthMode,p,f,it,1)),it.u_is_halo=0}Wl($e.buffers,at.segments,a,l,$e.program,$e.depthMode,p,f,$e.uniformValues,1)}}}function Wl(l,t,a,u,p,f,_,b,x,T){const M=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,f,_,b,Ft.disabled,x,a.id,l.layoutVertexBuffer,l.indexBuffer,t,a.paint,u.transform.zoom,l.programConfigurations.get(a.id),M,T)}function Ch(l,t){const a=1<<l.canonical.z,u=(t.x*a-l.canonical.x-l.wrap*a)*o.aj,p=(t.y*a-l.canonical.y)*o.aj,f=o.dS(t.z,t.y);return o.cS(u,p,f)}function Ap(l,t,a,u,p){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const f=l.context.gl,_=new _t(l.context.gl.LEQUAL,_t.ReadWrite,l.depthRangeFor3D),b=new _t(l.context.gl.GREATER,_t.ReadWrite,l.depthRangeFor3D),x=function(z){const O=o.cJ(z.pitch);let N=.01;return z.isOrthographic&&(N=o.ai(1e-4,N,o.cN(O>=ca?1:O/ca))),2*N}(l.transform),T=l.transform.getFreeCameraOptions().position,M="elevatedStructuresDepthReconstruct",I=l.getOrCreateProgram(M,{defines:["DEPTH_RECONSTRUCTION"]}),C=l.getOrCreateProgram(M);for(const z of u){const O=t.getTile(z),N=O.getBucket(a);if(!N)continue;const $=N.elevatedStructures;if(!$)continue;const U=N.elevationBufferData.heightRange,q=Ch(z.toUnwrapped(),T),Q=l.translatePosMatrix(z.projMatrix,O,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let ne,le,se,re;if(p==="initialize"){if(!U||U.min>=1||$.depthSegments.segments[0].primitiveLength===0)continue;ne=Th(Q,q,x,1,0),le=_,se=$.depthSegments,re=I}else if(p==="reset"){if(!U||U.min>=0||$.maskSegments.segments[0].primitiveLength===0)continue;ne=Th(Q,q,0,0,1),le=b,se=$.maskSegments,re=I}else if(p==="geometry"){if($.depthSegments.segments[0].primitiveLength===0)continue;ne=Th(Q,q,x,1,0),le=_,se=$.depthSegments,re=C}re.draw(l,f.TRIANGLES,le,Gt.disabled,mi.disabled,Ft.disabled,ne,a.id,$.vertexBuffer,$.indexBuffer,se,a.paint,l.transform.zoom)}}function Sp(l,t,a){const{painter:u,sourceCache:p,layer:f,coords:_,colorMode:b,elevationType:x,terrainEnabled:T,pass:M}=l,I=u.context.gl,C=f.paint.get("fill-pattern"),z=f.paint.get("fill-pattern-cross-fade"),O=C.constantOr(null);let N=x;x!=="road"||t&&!T||(N="none");const $=N==="road",U=l.painter.shadowRenderer,q=$&&!!U&&U.enabled,Q=new _t(u.context.gl.LEQUAL,_t.ReadOnly,u.depthRangeFor3D);let ne=[0,0,0];if(q){const re=u.style.directionalLight,ae=u.style.ambientLight;re&&ae&&(ne=Ws(u.style,re,ae))}const le=C&&C.constantOr(1),se=(re,ae)=>{let ue,he,xe,ke,Ne;ae?(ue=le&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",xe=I.LINES):(ue=le?"fillPattern":"fill",xe=I.TRIANGLES);for(const Fe of _){const Ge=p.getTile(Fe);if(le&&!Ge.patternsLoaded())continue;const be=Ge.getBucket(f);if(!be)continue;const ze=t?be.elevationBufferData:be.bufferData;if(ze.isEmpty())continue;u.prepareDrawTile();const fe=ze.programConfigurations.get(f.id),je=u.isTileAffectedByFog(Fe),Pe=[],Je=[];$&&(Pe.push("ELEVATED_ROADS"),Je.push(ze.elevatedLayoutVertexBuffer)),q&&Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),le&&(u.context.activeTexture.set(I.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),fe.updatePaintBuffers());let at=!1;if(O&&Ge.imageAtlas){const ft=Ge.imageAtlas,Et=o.dN.from(O),Dt=Et.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Rt=Et.getSecondary(),Jt=ft.patternPositions.get(Dt),si=Rt?ft.patternPositions.get(Rt.scaleSelf(o.q.devicePixelRatio).toString()):null;at=!!Jt&&!!si,Jt&&fe.setConstantPatternPositions(Jt,si)}z>0&&(at||fe.getPatternTransitionVertexBuffer("fill-pattern"))&&Pe.push("FILL_PATTERN_TRANSITION");const $e=u.getOrCreateProgram(ue,{config:fe,overrideFog:je,defines:Pe}),it=u.translatePosMatrix(Fe.projMatrix,Ge,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));q&&U.setupShadows(Ge.tileID.toUnwrapped(),$e,"vector-tile",Ge.tileID.overscaledZ);const wt=f.paint.get("fill-emissive-strength");if(ae){ke=ze.lineIndexBuffer,Ne=ze.lineSegments;const ft=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];he=ue==="fillOutlinePattern"&&le?Xy(it,wt,u,Ge,ft,ne,z):Ky(it,wt,ft,ne)}else ke=ze.indexBuffer,Ne=ze.triangleSegments,he=le?$f(it,wt,u,Ge,ne,z):js(it,wt,ne);u.uploadCommonUniforms(u.context,$e,Fe.toUnwrapped());let bt=re;(x==="road"&&!T||x==="offset")&&(bt=Q),$e.draw(u,xe,bt,a||u.stencilModeForClipping(Fe),b,Ft.disabled,he,f.id,ze.layoutVertexBuffer,ke,Ne,f.paint,u.transform.zoom,fe,Je)}};u.renderPass===M&&se(u.depthModeForSublayer(1,u.renderPass==="opaque"?_t.ReadWrite:_t.ReadOnly),!1),N==="none"&&u.renderPass==="translucent"&&f.paint.get("fill-antialias")&&se(u.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,_t.ReadOnly),!0)}function ko(l,t,a,u,p,f,_,b){a.resetLayerRenderingStats(l);const x=l.context,T=x.gl,M=l.transform,I=a.paint.get("fill-extrusion-pattern"),C=a.paint.get("fill-extrusion-pattern-cross-fade"),z=I.constantOr(null),O=I.constantOr(1),N=a.paint.get("fill-extrusion-opacity"),$=l.style.enable3dLights(),U=a.paint.get($&&!O?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],Q=a.layout.get("fill-extrusion-edge-radius"),ne=Q>0&&!a.paint.get("fill-extrusion-rounded-roof"),le=ne?0:Q,se=M.projection.name==="globe"?o.dV():0,re=M.projection.name==="globe",ae=re?o.ah(M.zoom):0,ue=[o.aD(M.center.lng),o.aH(M.center.lat)],he=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",xe=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(he?null:a.lut).toArray01().slice(0,3),ke=a.paint.get("fill-extrusion-flood-light-intensity"),Ne=a.paint.get("fill-extrusion-vertical-scale"),Fe=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ge=a.paint.get("fill-extrusion-height-alignment"),be=a.paint.get("fill-extrusion-base-alignment"),ze=Qr(l,a.paint.get("fill-extrusion-cutoff-fade-range")),fe=[];let je;re&&fe.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&fe.push("FAUX_AO"),ne&&fe.push("ZERO_ROOF_RADIUS"),b&&fe.push("HAS_CENTROID"),ke>0&&fe.push("FLOOD_LIGHT"),ze.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),Fe&&fe.push("RENDER_WALL_MODE");const Pe=l.renderPass==="shadow",Je=l.shadowRenderer,at=Pe&&!!Je,$e=Pe?Ft.disabled:Ft.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let it=[0,0,0];if(Je){const ft=l.style.directionalLight,Et=l.style.ambientLight;ft&&Et&&(it=Ws(l.style,ft,Et)),Pe||(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Je.useNormalOffset&&fe.push("NORMAL_OFFSET")),je=fe.concat(["SHADOWS_SINGLE_CASCADE"])}const wt=at?"fillExtrusionDepth":O?"fillExtrusionPattern":"fillExtrusion",bt=a.getLayerRenderingStats();for(const ft of u){const Et=t.getTile(ft),Dt=Et.getBucket(a);if(!Dt||Dt.projection.name!==M.projection.name)continue;let Rt=!1;Je&&(Rt=Je.getMaxCascadeForTile(ft.toUnwrapped())===0);const Jt=l.isTileAffectedByFog(ft),si=Dt.programConfigurations.get(a.id);let Ni=!1;if(z&&Et.imageAtlas){const vi=Et.imageAtlas,un=o.dN.from(z),Gn=un.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),rn=un.getSecondary(),zi=vi.patternPositions.get(Gn),Dn=rn?vi.patternPositions.get(rn.scaleSelf(o.q.devicePixelRatio).toString()):null;Ni=!!zi&&!!Dn,zi&&si.setConstantPatternPositions(zi,Dn)}C>0&&(Ni||si.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&fe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const an=l.getOrCreateProgram(wt,{config:si,defines:Rt?je:fe,overrideFog:Jt});if(l.terrain&&l.terrain.setupElevationDraw(Et,an,{useMeterToDem:!0}),!Dt.centroidVertexBuffer){const vi=an.attributes.a_centroid_pos;vi!==void 0&&T.vertexAttrib2f(vi,0,0)}!Pe&&Je&&Je.setupShadows(Et.tileID.toUnwrapped(),an,"vector-tile",Et.tileID.overscaledZ),O&&(l.context.activeTexture.set(T.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),si.updatePaintBuffers());const ji=a.paint.get("fill-extrusion-vertical-gradient"),qi=1/Dt.tileToMeter;let Fn;if(Pe&&Je){if(as(Et.tileID,Dt,l))continue;const vi=Je.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());Fn=Ff(vi,le,qi,Ne,Ge,be)}else{const vi=l.translatePosMatrix(ft.expandedProjMatrix,Et,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),un=M.projection.createInversionMatrix(M,ft.canonical);Fn=O?Of(vi,l,ji,N,q,le,qi,ft,Et,se,Ge,be,ae,ue,un,xe,Ne,C):ec(vi,l,ji,N,q,le,qi,ft,se,Ge,be,ae,ue,un,xe,Ne,ke,it)}l.uploadCommonUniforms(x,an,ft.toUnwrapped(),null,ze);let ei=Dt.segments;if(M.projection.name==="mercator"&&!Pe&&(ei=Dt.getVisibleSegments(Et.tileID,l.terrain,l.transform.getFrustum(0)),!ei.get().length))continue;if(bt)if(Pe)for(const vi of ei.get())bt.numRenderedVerticesInShadowPass+=vi.primitiveLength;else for(const vi of ei.get())bt.numRenderedVerticesInTransparentPass+=vi.primitiveLength;const hi=[];(l.terrain||b)&&hi.push(Dt.centroidVertexBuffer),re&&hi.push(Dt.layoutVertexExtBuffer),Fe&&hi.push(Dt.wallVertexBuffer),an.draw(l,x.gl.TRIANGLES,p,f,_,$e,Fn,a.id,Dt.layoutVertexBuffer,Dt.indexBuffer,ei,a.paint,l.transform.zoom,si,hi)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function Ao(l,t,a,u,p,f,_,b,x,T,M,I,C,z,O,N,$,U,q){const Q=l.context,ne=Q.gl,le=l.transform,se=l.transform.zoom,re=[],ae=Qr(l,a.paint.get("fill-extrusion-cutoff-fade-range"));T==="clear"?(re.push("CLEAR_SUBPASS"),q&&(re.push("CLEAR_FROM_TEXTURE"),Q.activeTexture.set(ne.TEXTURE0),q.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):T==="sdf"&&re.push("SDF_SUBPASS"),$&&re.push("HAS_CENTROID"),ae.shouldRenderCutoff&&re.push("RENDER_CUTOFF");const ue=a.layout.get("fill-extrusion-edge-radius"),he=(xe,ke,Ne,Fe,Ge)=>{const be=ke.programConfigurations.get(a.id),ze=l.isTileAffectedByFog(xe),fe=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:be,defines:re,overrideFog:ze}),je=((Je,at,$e,it,wt,bt,ft,Et,Dt,Rt,Jt)=>({u_matrix:at,u_opacity:$e,u_ao_pass:it?1:0,u_meter_to_tile:wt,u_ao:bt,u_flood_light_intensity:ft,u_flood_light_color:Et,u_attenuation:Dt,u_edge_radius:Rt,u_fb:0,u_fb_size:Jt,u_dynamic_offset:1}))(0,Fe,M,x,Ge,[I,C*Ge],z,O,N,se>=17?0:ue*Ge,q?q.size[0]:0),Pe=[];$&&Pe.push(ke.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(Q,fe,xe.toUnwrapped(),null,ae),fe.draw(l,Q.gl.TRIANGLES,p,f,_,b,je,a.id,ke.vertexBuffer,ke.indexBuffer,Ne,a.paint,se,be,Pe)};for(const xe of u){const ke=t.getTile(xe),Ne=ke.getBucket(a);if(!Ne||Ne.projection.name!==le.projection.name||!Ne.groundEffect||Ne.groundEffect&&!Ne.groundEffect.hasData())continue;const Fe=Ne.groundEffect,Ge=1/Ne.tileToMeter;{const be=l.translatePosMatrix(xe.projMatrix,ke,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ze=Fe.getDefaultSegment();he(xe,Fe,ze,be,Ge)}if(U)for(let be=0;be<4;be++){const ze=o.dT[be](xe),fe=t.getTile(ze);if(!fe)continue;const je=fe.getBucket(a);if(!je||je.projection.name!==le.projection.name||!je.groundEffect||je.groundEffect&&!je.groundEffect.hasData())continue;const Pe=je.groundEffect;let Je,at;be===0?(Je=[-8192,0,0],at=1):be===1?(Je=[o.aj,0,0],at=0):be===2?(Je=[0,-8192,0],at=3):(Je=[0,o.aj,0],at=2);const $e=Pe.regionSegments[at];if(!$e)continue;const it=new Float32Array(16);o.bo(it,xe.projMatrix,Je),he(xe,Pe,$e,l.translatePosMatrix(it,ke,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ge)}}}function yt(l,t,a,u,p,f,_){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const b=f?f.findDEMTileFor(a):null;if(!(b&&b.dem||_))return;f&&b&&b.dem&&u.selfDEMTileTimestamp!==b.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=b.dem._timestamp);const x=U=>new o.P(Math.ceil((U+o.dX)*o.dY),0),T=U=>{const q=t.getSource().minzoom,Q=le=>{const se=t.getTileByID(le);if(se&&se.hasData())return se.getBucket(p)},ne=[0,-1,1];for(const le of ne){if(U.overscaledZ+le<q)continue;const se=Q(U.calculateScaledKey(U.overscaledZ+le));if(se)return se}},M=[0,0,0],I=(U,q)=>(M[0]=Math.min(U.min.y,q.min.y),M[1]=Math.max(U.max.y,q.max.y),M[2]=o.aj-q.min.x>U.max.x?q.min.x-o.aj:U.max.x,M),C=(U,q)=>(M[0]=Math.min(U.min.x,q.min.x),M[1]=Math.max(U.max.x,q.max.x),M[2]=o.aj-q.min.y>U.max.y?q.min.y-o.aj:U.max.y,M),z=[(U,q)=>I(U,q),(U,q)=>I(q,U),(U,q)=>C(U,q),(U,q)=>C(q,U)],O=(U,q,Q,ne,le,se,re)=>{if(!f)return 0;const ae=[[se?Q:U,se?U:Q,0],[se?Q:q,se?q:Q,0]],ue=re<0?o.aj+re:re,he=[se?ue:(U+q)/2,se?(U+q)/2:ue,0];return Q===0&&re<0||Q!==0&&re>0?f.getForTilePoints(le,[he],!0,ne):ae.push(he),f.getForTilePoints(a,ae,!0,b),Math.max(ae[0][2],ae[1][2],he[2])/f.exaggeration()};for(let U=0;U<4;U++){const q=u.borderFeatureIndices[U];if(q.length===0)continue;const Q=o.dT[U](a),ne=T(Q);if(!(ne&&ne instanceof o.dU))continue;const le=f?f.findDEMTileFor(Q):null;if(!(le&&le.dem||_)||(f&&le&&le.dem&&u.borderDEMTileTimestamp[U]!==le.dem._timestamp&&(u.borderDoneWithNeighborZ[U]=-1,u.borderDEMTileTimestamp[U]=le.dem._timestamp),u.borderDoneWithNeighborZ[U]===ne.canonical.z))continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();const se=(U<2?1:5)-U,re=ne.borderDoneWithNeighborZ[se]!==u.canonical.z,ae=ne.borderFeatureIndices[se];let ue=0;if(u.canonical.z!==ne.canonical.z){for(const he of q)u.showCentroid(u.featuresOnBorder[he]);if(re)for(const he of ae)ne.showCentroid(ne.featuresOnBorder[he]);u.borderDoneWithNeighborZ[U]=ne.canonical.z,ne.borderDoneWithNeighborZ[se]=u.canonical.z}for(const he of q){const xe=u.featuresOnBorder[he],ke=u.centroidData[xe.centroidDataIndex],Ne=xe.borders[U];let Fe;for(;ue<ae.length;){Fe=ne.featuresOnBorder[ae[ue]];const Ge=Fe.borders[se];if(Ge[1]>Ne[0]+3||Ge[0]>Ne[0]-3)break;ne.showCentroid(Fe),ue++}if(Fe&&ue<ae.length){const Ge=ue;let be=0;for(;!(Fe.borders[se][0]>Ne[1]-3)&&(be++,++ue!==ae.length);)Fe=ne.featuresOnBorder[ae[ue]];Fe=ne.featuresOnBorder[ae[Ge]];let ze=!1;if(be>=1){const Pe=Fe.borders[se];Math.abs(Ne[0]-Pe[0])<3&&Math.abs(Ne[1]-Pe[1])<3&&(be=1,ze=!0,ue=Ge+1)}else if(be===0){u.showCentroid(xe);continue}const fe=ne.centroidData[Fe.centroidDataIndex];_&&ze&&(((N=ke).flags|($=fe).flags)&o.dW?(N.flags|=o.dW,$.flags|=o.dW):(N.flags&=2147483647,$.flags&=2147483647));const je=xe.intersectsCount()>1||Fe.intersectsCount()>1;if(be>1)ue=Ge,ke.centroidXY=fe.centroidXY=new o.P(0,0);else if(le&&le.dem&&!je){const Pe=z[U](ke,fe),Je=U%2?o.aj-1:0,at=O(Pe[0],Math.min(o.aj-1,Pe[1]),Je,le,Q,U<2,Pe[2]);ke.centroidXY=fe.centroidXY=x(at)}else je?ke.centroidXY=fe.centroidXY=new o.P(0,0):(ke.centroidXY=u.encodeBorderCentroid(xe),fe.centroidXY=ne.encodeBorderCentroid(Fe));u.writeCentroidToBuffer(ke),ne.writeCentroidToBuffer(fe)}else u.showCentroid(xe)}u.borderDoneWithNeighborZ[U]=ne.canonical.z,ne.borderDoneWithNeighborZ[se]=u.canonical.z}var N,$;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(l)}const Yf=[1,0,0],Hf=[0,1,0],ns=[0,0,1];function as(l,t,a){const u=a.transform,p=a.shadowRenderer;if(!p)return!0;const f=l.toUnwrapped(),_=u.tileSize*p._cascades[a.currentShadowCascade].scale;let b=t.maxHeight;if(u.elevation){const N=u.elevation.getMinMaxForTile(l);N&&(b+=N.max)}const x=[...p.shadowDirection];x[2]=-x[2];const T=p.computeSimplifiedTileShadowVolume(f,b,_,x);if(!T)return!1;const M=[Yf,Hf,ns,x,[x[0],0,x[2]],[0,x[1],x[2]]],I=u.projection.name==="globe",C=u.scaleZoom(_),z=o.cn.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,C,!I),O=p.getCurrentCascadeFrustum();return z.intersectsPrecise(T.vertices,T.planes,M)===0||O.intersectsPrecise(T.vertices,T.planes,M)===0}function Wt(l){return[l[0]*o.dZ,l[1]*o.dZ,l[2]*o.dZ,0]}function oc(l,t,a,u,p,f,_,b,x){const T=u.getSource(),M=a.globeSharedBuffers;if(!M)return;let I,C,z;if(t&&(I=u.getTile(t)),T instanceof o.aP?(C=T.texture,z=o.ds(0,0,a.transform)):I&&t&&(C=I.texture,z=o.ds(t.canonical.z,t.canonical.x,a.transform)),!C||!z)return;l||(z=o.cE(o.bz(),z,[1,-1,1]));const O=a.context,N=O.gl,$=p.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR,U=a.colorModeForDrapableLayerRenderPass(f),q=_.defines;q.push("GLOBE_POLES");const Q=new _t(N.LEQUAL,_t.ReadWrite,a.depthRangeFor3D),ne=Float32Array.from(a.transform.expandedFarZProjMatrix),le=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),O.activeTexture.set(N.TEXTURE0),C.bind($,N.CLAMP_TO_EDGE),O.activeTexture.set(N.TEXTURE1),C.bind($,N.CLAMP_TO_EDGE),"useMipmap"in C&&O.extTextureFilterAnisotropic&&a.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const[se,re,ae,ue]=t?M.getPoleBuffers(t.canonical.z,!1):M.getPoleBuffers(0,!0),he=p.paint.get("raster-elevation");let xe;l?(xe=se,a.renderDefaultNorthPole=he!==0):(xe=re,a.renderDefaultSouthPole=he!==0);const ke=Wt(_.mix),Ne=((Ge,be,ze,fe,je,Pe,Je,at,$e,it,wt,bt,ft)=>bp(Ge,be,ze,new Float32Array(16),new Float32Array(9),[0,0],fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Pe,[0,0],at,2,it,wt,bt,1,0,ft))(ne,le,z,o.ah(a.transform.zoom),0,p,0,he,0,ke,_.offset,_.range,f),Fe=a.getOrCreateProgram("raster",{defines:q});a.uploadCommonUniforms(O,Fe,null),Fe.draw(a,N.TRIANGLES,Q,x,U,b,Ne,p.id,xe,ae,ue)}function a1(l){const t=l._nearZ,a=l.projection.farthestPixelDistance(l),u=a-t,p=.2*l.height,f=t+p;return[t,a,(f-p-t)/u,(f-t)/u]}function r1(l,t,a,u){if(l)return t instanceof Yo&&l instanceof gl?t.getTextureDescriptor(l,a,!0):{texture:l.texture,mix:Wt(u.mix),offset:u.offset,buffer:0,tileSize:1}}var Tp=o.d_([{name:"a_index",type:"Int16",components:1}]);class Zf{constructor(t,a,u,p){const f={width:u[0],height:u[1],data:null},_=t.gl;this.targetColorTexture=new o.T(t,f,_.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,f,_.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,p),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=a.width*a.height;this.particleTexture0=new o.T(this.context,a,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,a,u.RGBA8,{premultiply:!1,useMipmap:!1});const f=new o.d$;f.reserve(p);for(let _=0;_<p;_++)f.emplaceBack(_);this.particleIndexBuffer=this.context.createVertexBuffer(f,Tp.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function o1(l,t,a){if(!l)return null;const u=t.getTextureDescriptor(l,a,!0);if(!u)return null;let{texture:p,mix:f,offset:_,tileSize:b,buffer:x,format:T}=u;if(!p||!T)return null;let M=!1;return T==="uint32"&&(M=!0,f[3]=0,f=Vs(o.e0,f,[0,a.paint.get("raster-particle-max-speed")]),_=wp(o.e0,_,[0,a.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[x/(b+2*x),b/(b+2*x)],tileSize:b,scalarData:M,scale:f,offset:_,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[T]]}}function Kf(l){const t=l._nearZ,a=l.projection.farthestPixelDistance(l),u=a-t,p=.2*l.height,f=t+p;return[t,a,(f-p-t)/u,(f-t)/u]}const s1=new o.am(1,0,0,1),l1=new o.am(0,1,0,1),ir=new o.am(0,0,1,1),Pp=new o.am(1,0,1,1),Wa=new o.am(0,1,1,1);function So(l,t,a,u,p,f){for(let _=0;_<a.length;_++)if(p){const T=new o.am(u.r*.8,u.g*.8,u.b*.8,1);Js(l,t,a[_],u,-1,-1,f),Js(l,t,a[_],u,-1,1,f),Js(l,t,a[_],u,1,1,f),Js(l,t,a[_],u,1,-1,f),Js(l,t,a[_],T,0,0,f)}else Js(l,t,a[_],u,0,0,f)}function Js(l,t,a,u,p,f,_){const b=l.context,x=l.transform,T=b.gl,M=x.projection.name==="globe",I=M?["PROJECTION_GLOBE_VIEW"]:[];let C=o.bw(a.projMatrix);if(M&&o.ah(x.zoom)>0){const ke=o.bg(a.canonical,x),Ne=o.e1(ke);C=o.az(new Float32Array(16),x.globeMatrix,Ne),o.az(C,x.projMatrix,C)}const z=o.bz();z[12]+=2*p/(o.q.devicePixelRatio*x.width),z[13]+=2*f/(o.q.devicePixelRatio*x.height),o.az(C,z,C);const O=l.getOrCreateProgram("debug",{defines:I}),N=t.getTileByID(a.key);l.terrain&&l.terrain.setupElevationDraw(N,O);const $=_t.disabled,U=Gt.disabled,q=l.colorModeForRenderPass(),Q="$debug";b.activeTexture.set(T.TEXTURE0),l.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),M?N._makeGlobeTileDebugBuffers(l.context,x):N._makeDebugTileBoundsBuffers(l.context,x.projection);const ne=N._tileDebugBuffer||l.debugBuffer,le=N._tileDebugIndexBuffer||l.debugIndexBuffer,se=N._tileDebugSegments||l.debugSegments;if(O.draw(l,T.LINE_STRIP,$,U,q,Ft.disabled,Ph(C,u.toPremultipliedRenderColor(null)),Q,ne,le,se,null,null,null,[N._globeTileDebugBorderBuffer]),_){const ke=N.latestRawTileData,Ne=Math.floor((ke&&ke.byteLength||0)/1024);let Fe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Fe+=` => ${a.overscaledZ}`),Fe+=` ${N.state}`,Fe+=` ${Ne}kb`,function(Ge,be){Ge.initDebugOverlayCanvas();const ze=Ge.debugOverlayCanvas,fe=Ge.context.gl,je=Ge.debugOverlayCanvas.getContext("2d");je.clearRect(0,0,ze.width,ze.height),je.shadowColor="white",je.shadowBlur=2,je.lineWidth=1.5,je.strokeStyle="white",je.textBaseline="top",je.font="bold 36px Open Sans, sans-serif",je.fillText(be,5,5),je.strokeText(be,5,5),Ge.debugOverlayTexture.update(ze),Ge.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(l,Fe)}const re=t.getTile(a).tileSize,ae=512/Math.min(re,512)*(a.overscaledZ/x.zoom)*.5,ue=N._tileDebugTextBuffer||l.debugBuffer,he=N._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,xe=N._tileDebugTextSegments||l.debugSegments;O.draw(l,T.TRIANGLES,$,U,mi.alphaBlended,Ft.disabled,Ph(C,o.am.transparent.toPremultipliedRenderColor(null),ae),Q,ue,he,xe,null,null,null,[N._globeTileDebugTextBuffer])}function Dh(l,t,a,u){Nl(l,0,t+a/2,l.transform.width,a,u)}function Ih(l,t,a,u){Nl(l,t-a/2,0,a,l.transform.height,u)}function Nl(l,t,a,u,p,f){const _=l.context,b=_.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*o.q.devicePixelRatio,a*o.q.devicePixelRatio,u*o.q.devicePixelRatio,p*o.q.devicePixelRatio),_.clear({color:f}),b.disable(b.SCISSOR_TEST)}const Xf=o.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:To}=Xf;function Yi(l,t,a,u){l.emplaceBack(t,a,u)}class sc{constructor(t){this.vertexArray=new o.e2,this.indices=new o.a_,Yi(this.vertexArray,-1,-1,1),Yi(this.vertexArray,1,-1,1),Yi(this.vertexArray,-1,1,1),Yi(this.vertexArray,1,1,1),Yi(this.vertexArray,-1,-1,-1),Yi(this.vertexArray,1,-1,-1),Yi(this.vertexArray,-1,1,-1),Yi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,To),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function rs(l,t,a,u,p,f){const _=l.context.gl,b=t.paint.get("sky-atmosphere-color"),x=t.paint.get("sky-atmosphere-halo-color"),T=t.paint.get("sky-atmosphere-sun-intensity"),M=((I,C,z,O,N)=>({u_matrix_3f:I,u_sun_direction:C,u_sun_intensity:z,u_color_tint_r:[O.r,O.g,O.b,O.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(o.e4(o.dx(),u),p,T,b.toPremultipliedRenderColor(null),x.toPremultipliedRenderColor(null));_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+f,t.skyboxTexture,0),a.draw(l,_.TRIANGLES,_t.disabled,Gt.disabled,mi.unblended,Ft.frontCW,M,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Qf=o.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class eg{constructor(t){const a=new o.e5;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const u=new o.a_;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,Qf.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const tg=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class u1{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Fl{constructor(t){this.colorModeAlphaBlendedWriteRGB=new mi([1,Bs,1,Bs],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new mi([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new u1,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new eg(a);const u=this.params.sizeRange,p=this.params.intensityRange,f=function(M){const I=o.e7(30),C=[];for(let z=0;z<M;++z){const O=2*Math.PI*I(),N=Math.acos(1-2*I())-.5*Math.PI;C.push(o.cS(Math.cos(N)*Math.cos(O),Math.cos(N)*Math.sin(O),Math.sin(N)))}return C}(this.params.starsCount),_=o.e7(300),b=new o.e6,x=new o.a_;let T=0;for(let M=0;M<f.length;++M){const I=o.bY([],f[M],200),C=Math.max(0,1+.01*u*(1*_()-.5)),z=Math.max(0,1+.01*p*(1*_()-.5));b.emplaceBack(I[0],I[1],I[2],-1,-1,C,z),b.emplaceBack(I[0],I[1],I[2],1,-1,C,z),b.emplaceBack(I[0],I[1],I[2],1,1,C,z),b.emplaceBack(I[0],I[1],I[2],-1,1,C,z),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.starsVx=a.createVertexBuffer(b,tg.members),this.starsIdx=a.createIndexBuffer(x),this.starsSegments=o.bd.simpleSegment(0,0,b.length,x.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const u=t.context,p=u.gl,f=t.transform,_=new _t(p.LEQUAL,_t.ReadOnly,[0,1]),b=o.ah(f.zoom),x=t.style.getLut(a.scope),T=a.properties.get("color-use-theme")==="none",M=a.properties.get("color").toNonPremultipliedRenderColor(T?null:x).toArray01(),I=a.properties.get("high-color-use-theme")==="none",C=a.properties.get("high-color").toNonPremultipliedRenderColor(I?null:x).toArray01(),z=a.properties.get("space-color-use-theme")==="none",O=a.properties.get("space-color").toNonPremultipliedRenderColor(z?null:x).toArray01(),N=5e-4,$=o.e8(a.properties.get("horizon-blend"),0,1,N,.25),U=o.dl(t,u,f)&&$===N?f.worldSize/(2*Math.PI*1.025)-1:f.globeRadius,q=t.frameCounter/1e3%1,Q=o.ae(f.globeCenterInViewSpace),ne=Math.sqrt(Math.pow(Q,2)-Math.pow(U,2)),le=Math.acos(ne/Q),se=re=>{const ae=f.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&ae.push("ALPHA_PASS");const ue=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),he=((ke,Ne,Fe,Ge,be,ze,fe,je,Pe,Je,at,$e)=>({u_frustum_tl:ke,u_frustum_tr:Ne,u_frustum_br:Fe,u_frustum_bl:Ge,u_horizon:be,u_transition:ze,u_fadeout_range:fe,u_color:je,u_high_color:Pe,u_space_color:Je,u_temporal_offset:at,u_horizon_angle:$e}))(f.frustumCorners.TL,f.frustumCorners.TR,f.frustumCorners.BR,f.frustumCorners.BL,f.frustumCorners.horizon,b,$,M,C,O,q,le);t.uploadCommonUniforms(u,ue);const xe=this.atmosphereBuffer;xe&&ue.draw(t,p.TRIANGLES,_,Gt.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ft.backCW,he,re?"atmosphere_glow_alpha":"atmosphere_glow",xe.vertexBuffer,xe.indexBuffer,xe.segments)};se(!1),se(!0)}drawStars(t,a){const u=o.ay(a.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,f=p.gl,_=t.transform,b=t.getOrCreateProgram("stars"),x=o.b_([]);o.c0(x,x,-_._pitch),o.b$(x,x,-_.angle),o.c0(x,x,o.al(_._center.lat)),o.e9(x,x,-o.al(_._center.lng));const T=o.c3(new Float32Array(16),x),M=o.az([],_.starsProjMatrix,T),I=o.e4([],T),C=o.ea([],I),z=[0,1,0];o.dz(z,z,C),o.bY(z,z,this.params.sizeMultiplier);const O=[1,0,0];o.dz(O,O,C),o.bY(O,O,this.params.sizeMultiplier);const N=($=z,U=O,q=u,{u_matrix:Float32Array.from(M),u_up:$,u_right:U,u_intensity_multiplier:q});var $,U,q;t.uploadCommonUniforms(p,b),this.starsVx&&this.starsIdx&&b.draw(t,f.TRIANGLES,_t.disabled,Gt.disabled,this.colorModeAlphaBlendedWriteRGB,Ft.disabled,N,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function qs(l,t){const a=[...l],u=t.cameraWorldSizeForFog/t.worldSize,p=o.bx([]);return o.cE(p,p,[u,u,1]),o.az(a,p,a),o.az(a,t.worldToFogMatrix,a),a}function Qe(l,t,a,u,p){const f=a.material,_=u.context,{baseColorTexture:b,metallicRoughnessTexture:x}=f.pbrMetallicRoughness,{normalTexture:T,occlusionTexture:M,emissionTexture:I}=f;function C(O,N,$){if(O&&(l.push(N),_.activeTexture.set(_.gl.TEXTURE0+$),O.gfxTexture)){const{minFilter:U,magFilter:q,wrapS:Q,wrapT:ne}=O.sampler;O.gfxTexture.bindExtraParam(U,q,Q,ne)}}C(b,"HAS_TEXTURE_u_baseColorTexture",Ba.BaseColor),C(x,"HAS_TEXTURE_u_metallicRoughnessTexture",Ba.MetallicRoughness),C(T,"HAS_TEXTURE_u_normalTexture",Ba.Normal),C(M,"HAS_TEXTURE_u_occlusionTexture",Ba.Occlusion),C(I,"HAS_TEXTURE_u_emissionTexture",Ba.Emission),p&&(p.texture||(p.texture=new o.eh(u.context,p.image,[p.image.height,p.image.height,p.image.height],_.gl.RGBA8)),_.activeTexture.set(_.gl.TEXTURE0+Ba.LUT),p.texture&&p.texture.bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(l.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),f.alphaMode!=="OPAQUE"&&f.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),f.defined||l.push("DIFFUSE_SHADED");const z=u.shadowRenderer;z&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&l.push("NORMAL_OFFSET"))}function mt(l,t,a,u,p,f){const _=a.paint.get("model-opacity").constantOr(1),b=t.context,x=new _t(t.context.gl.LEQUAL,_t.ReadWrite,t.depthRangeFor3D),T=t.transform,M=l.mesh,I=M.material,C=I.pbrMetallicRoughness,z=t.style.fog;let O;O=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:o.az([],u.zScaleMatrix,l.nodeModelMatrix),o.az(O,u.negCameraPosMatrix,O);const N=o.bi([],O);o.ee(N,N);const $=a.paint.get("model-color-use-theme").constantOr("default")==="none",U=a.paint.get("model-emissive-strength").constantOr(0),q=nc(new Float32Array(l.worldViewProjection),new Float32Array(O),new Float32Array(N),null,t,_,C.baseColorFactor,I.emissiveFactor,C.metallicFactor,C.roughnessFactor,I,U,a),Q={defines:[]},ne=[],le=t.shadowRenderer;le&&(le.useNormalOffset=!1),Qe(Q.defines,ne,M,t,$?null:a.lut);let se=null;if(z){const ue=qs(l.nodeModelMatrix,t.transform);if(se=new Float32Array(ue),T.projection.name!=="globe"){const he=M.aabb.min,xe=M.aabb.max,[ke,Ne]=z.getOpacityForBounds(ue,he[0],he[1],xe[0],xe[1]);Q.overrideFog=ke>=Ce||Ne>=Ce}}const re=Qr(t,a.paint.get("model-cutoff-fade-range"));re.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");const ae=t.getOrCreateProgram("model",Q);t.uploadCommonUniforms(b,ae,null,se,re),t.renderPass!=="shadow"&&le&&le.setupShadowsFromMatrix(l.nodeModelMatrix,ae),ae.draw(t,b.gl.TRIANGLES,x,p,f,M.material.doubleSided?Ft.disabled:Ft.backCCW,q,a.id,M.vertexBuffer,M.indexBuffer,M.segments,a.paint,t.transform.zoom,void 0,ne)}function Gs(l,t,a,u,p,f,_){let b;b=l.projection.name==="globe"?o.ed(a,l):[...a],o.az(b,b,t.matrix);const x=o.az([],u,b);if(t.meshes)for(const T of t.meshes){if(T.material.alphaMode!=="BLEND"){_.push({mesh:T,depth:0,modelIndex:p,worldViewProjection:x,nodeModelMatrix:b});continue}const M=o.ad([],T.centroid,x);!l.isOrthographic&&M[2]<=0||f.push({mesh:T,depth:M[2],modelIndex:p,worldViewProjection:x,nodeModelMatrix:b})}if(t.children)for(const T of t.children)Gs(l,T,a,u,p,f,_)}function Cn(l,t,a,u){const p=a.shadowRenderer;if(!p)return;const f=p.getShadowPassDepthMode(),_=p.getShadowPassColorMode(),b=p.calculateShadowPassMatrixFromMatrix(t),x=Jf(b);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,f,Gt.disabled,_,Ft.backCCW,x,u.id,l.vertexBuffer,l.indexBuffer,l.segments,u.paint,a.transform.zoom,void 0,void 0)}function ve(l,t,a){const u=t.updateZoomBasedPaintProperties(),p=function(f,_,b){let x,T,M,I=f.terrain?f.terrain.exaggeration():0;if(f.terrain&&I>0){const C=f.terrain,z=C.findDEMTileFor(b);z&&z.dem?x=o.ei.create(C,b,z):I=0}if(I===0&&(_.terrainElevationMin=0,_.terrainElevationMax=0),I===_.validForExaggeration&&(I===0||x&&x._demTile&&x._demTile.tileID===_.validForDEMTile.id&&x._dem._timestamp===_.validForDEMTile.timestamp))return!1;for(const C in _.instancesPerModel){const z=_.instancesPerModel[C];for(let O=0;O<z.instancedDataArray.length;++O){const N=(x?I*x.getElevationAt(0|z.instancedDataArray.float32[16*O],0|z.instancedDataArray.float32[16*O+1],!0,!0):0)+z.instancesEvaluatedElevation[O];z.instancedDataArray.float32[16*O+6]=N,T=T?Math.min(_.terrainElevationMin,N):N,M=M?Math.max(_.terrainElevationMax,N):N}}return _.terrainElevationMin=T||0,_.terrainElevationMax=M||0,_.validForExaggeration=I,_.validForDEMTile=x&&x._demTile?{id:x._demTile.tileID,timestamp:x._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,a);(u||p)&&(t.uploaded=!1,t.upload(l.context))}const $r={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.cW([0,0,0],[o.aj,o.aj,0])};function zh(l,t){const a=1<<l.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,f=l.canonical.x/a,_=(l.canonical.x+1)/a,b=l.canonical.y/a,x=(l.canonical.y+1)/a;let T=t._centerAltitude;if(p){const z=p.getMinMaxForTile(l);z&&z.max>T&&(T=z.max)}const M=o.ay(u.x,f,_)-u.x,I=o.ay(u.y,b,x)-u.y,C=o.c6(T,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(M*M+I*I+C*C))}function Lh(l,t,a,u,p,f,_){const b=l.context,x=l.renderPass==="shadow",T=l.shadowRenderer,M=x&&T?T.getShadowPassDepthMode():new _t(b.gl.LEQUAL,_t.ReadWrite,l.depthRangeFor3D),I=l.isTileAffectedByFog(f);if(a.meshes)for(const C of a.meshes){const z=["MODEL_POSITION_ON_GPU"],O=[];let N,$,U;u.instancedDataArray.length>20&&z.push("INSTANCED_ARRAYS");const q=Qr(l,t.paint.get("model-cutoff-fade-range"));if(q.shouldRenderCutoff&&z.push("RENDER_CUTOFF"),x&&T)N=l.getOrCreateProgram("modelDepth",{defines:z}),$=Jf(_.shadowTileMatrix,_.shadowTileMatrix,Float32Array.from(a.matrix)),U=T.getShadowPassColorMode();else{Qe(z,O,C,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),N=l.getOrCreateProgram("model",{defines:z,overrideFog:I});const ne=C.material,le=ne.pbrMetallicRoughness,se=t.paint.get("model-opacity").constantOr(1),re=t.paint.get("model-emissive-strength").constantOr(0);$=nc(f.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,l,se,le.baseColorFactor,ne.emissiveFactor,le.metallicFactor,le.roughnessFactor,ne,re,t,p),T&&(_.shadowUniformsInitialized?N.setShadowUniformValues(b,T.getShadowUniformValues()):(T.setupShadows(f.toUnwrapped(),N,"model-tile",f.overscaledZ),_.shadowUniformsInitialized=!0)),U=q.shouldRenderCutoff||se<1||ne.alphaMode!=="OPAQUE"?mi.alphaBlended:mi.unblended}l.uploadCommonUniforms(b,N,f.toUnwrapped(),null,q);const Q=C.material.doubleSided?Ft.disabled:Ft.backCCW;if(u.instancedDataArray.length>20)O.push(u.instancedDataBuffer),N.draw(l,b.gl.TRIANGLES,M,Gt.disabled,U,Q,$,t.id,C.vertexBuffer,C.indexBuffer,C.segments,t.paint,l.transform.zoom,void 0,O,u.instancedDataArray.length);else{const ne=x?"u_instance":"u_normal_matrix";for(let le=0;le<u.instancedDataArray.length;++le)$[ne]=new Float32Array(u.instancedDataArray.arrayBuffer,64*le,16),N.draw(l,b.gl.TRIANGLES,M,Gt.disabled,U,Q,$,t.id,C.vertexBuffer,C.indexBuffer,C.segments,t.paint,l.transform.zoom,void 0,O)}}if(a.children)for(const C of a.children)Lh(l,t,C,u,p,f,_)}const Mp=[1,-1,1];function ig(l,t,a,u){if(!a.modelManager)return!0;const p=a.modelManager;if(!a.shadowRenderer)return!0;const f=a.shadowRenderer,_=t.aabb;let b=!0,x=l.maxHeight;if(x===0){let M=0;for(const I in l.instancesPerModel){const C=p.getModel(I,u);C?M=Math.max(M,Math.max(Math.max(C.aabb.max[0],C.aabb.max[1]),C.aabb.max[2])):b=!1}x=l.maxScale*M*1.41+l.maxVerticalOffset,b&&(l.maxHeight=x)}_.max[2]=x,_.min[2]+=l.terrainElevationMin,_.max[2]+=l.terrainElevationMax,o.ad(_.min,_.min,t.tileMatrix),o.ad(_.max,_.max,t.tileMatrix);const T=_.intersects(f.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=T===2),T===0}function ng(l,t){const a=l.uniformValues.u_cutoff_params[0],u=l.uniformValues.u_cutoff_params[1],p=l.uniformValues.u_cutoff_params[2],f=l.uniformValues.u_cutoff_params[3];return u===a||f===p?1:o.ay(((t-a)/(u-a)-p)/(f-p),0,1)}function Ol(l,t,a,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();o.az(p,p,l);const f=o.ej(a.min[0],a.min[1],a.min[2],1);let _=o.aA(o.ek(),f,p),b=_,x=_;f[1]=a.max[1],_=o.aA(o.ek(),f,p),b=_[1]<b[1]?_:b,x=_[1]>x[1]?_:x,f[0]=a.max[0],_=o.aA(o.ek(),f,p),b=_[1]<b[1]?_:b,x=_[1]>x[1]?_:x,f[1]=a.min[1],_=o.aA(o.ek(),f,p),b=_[1]<b[1]?_:b,x=_[1]>x[1]?_:x;const T=o.ay(u[0],0,1),M=100*t.pixelsPerMeter*o.ay(u[1],0,1),I=o.ay(u[2],0,1),C=o.el(o.ek(),b,x,T),z=Math.tan(.5*t.fovX),O=-C[2]*z;if(M===0)return C[1]<-Math.abs(O)?I:1;const N=(-Math.abs(O)-C[1])/M,$=(q,Q,ne)=>(1-ne)*q+ne*Q,U=o.ay($(1,I,N),I,1);return $(1,U,o.ay((t.pitch-20)/20,0,1))}class c1{}class h1{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,u){{const I=this._storage.get(a.id);if(I)return I.lastUsedFrameIdx=t,I.buf}const p=u.gl,f=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),_=new ArrayBuffer(f),b=new Int16Array(_);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(_));const x=new o.en;for(let I=0;I<f/2;I+=3){const C=b[I],z=b[I+1],O=b[I+2];x.emplaceBack(C,z),x.emplaceBack(z,O),x.emplaceBack(O,C)}const T=u.bindVertexArrayOES.current,M=new c1;return M.buf=new Tr(u,x),M.lastUsedFrameIdx=t,this._storage.set(a.id,M),u.bindVertexArrayOES.set(T),M.buf}update(t){for(const[a,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class ag{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Rh=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ep{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Cp{constructor(t,a){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const rg=o.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Bh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const _=new o.eo,b=new o.a_;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(1,1),_.emplaceBack(-1,1),b.emplaceBack(0,1,2),b.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(_,rg.members),this.vignetteIdx=t.context.createIndexBuffer(b)}const p=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const _={u_vignetteShape:(f={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:f.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,_t.disabled,Gt.disabled,mi.alphaBlended,Ft.disabled,_,"vignette",this.vignetteVx,this.vignetteIdx,p)}var f}}class lc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),f=u.toLngLat(),_=o.al(f.lng),b=o.al(f.lat),x=t.pixelsPerMeter/a,T=_*o.eq,M=o.eq*Math.log(Math.tan(Math.PI/4+b/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const I=-this._offsetYPrev+M,C=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+T)*x,this._accumulatedOffsetY+=I*x,this._accumulatedElevation+=C*x,this._offsetXPrev=T,this._offsetYPrev=M,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ys(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Dp(l){const t=o.e7(1323123451230),a=[];for(let u=0;u<l;++u){const p=2*t()-1,f=2*t()-1,_=2*t()-1;a.push(o.cS(p,f,_))}return a}function os(l,t,a,u,p){const f=o.ay((p-a)/(u-a),0,1);return(1-f)*l+f*t}class Pa{constructor(t){this._movement=new lc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Bh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,f=o.b_([]);o.c0(f,f,o.al(90)-u._pitch),o.b$(f,f,-u.angle);const _=o.c3(new Float32Array(16),f),b=o.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),x=o.ee([],b),T=o.az([],x,_),M=Date.now()/1e3;return this._accumulatedTimeFromStart+=(M-this._prevTime)*a,this._prevTime=M,{projectionMatrix:p,modelviewMatrix:T}}}class d1 extends Pa{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Cp(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const u=Dp(this.particlesCount),p=new o.er,f=new o.a_;let _=0;const b=o.e7(1323123451230);for(let x=0;x<u.length;++x){const T=u[x],M=[2*b()-1,b(),b(),b()];p.emplaceBack(T[0],T[1],T[2],-1,-1,...M),p.emplaceBack(T[0],T[1],T[2],1,-1,...M),p.emplaceBack(T[0],T[1],T[2],1,1,...M),p.emplaceBack(T[0],T[1],T[2],-1,1,...M),f.emplaceBack(_+0,_+1,_+2),f.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=a.createVertexBuffer(p,Rh.members),this.particlesIdx=a.createIndexBuffer(f)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(a.revealStart>u)return;const p=os(0,1,a.revealStart,a.revealStart+a.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const f=structuredClone(this._params);let _=[-f.direction.x,f.direction.y,-100];o.au(_,_);const b=structuredClone(this._vignetteParams);b.strength*=p,f.overrideStyleParameters||(f.intensity=t.style.rain.state.density,f.timeFactor=t.style.rain.state.intensity,f.color=structuredClone(t.style.rain.state.color),_=structuredClone(t.style.rain.state.direction),f.screenThinning.intensity=t.style.rain.state.centerThinning,f.dropletSizeX=t.style.rain.state.dropletSize[0],f.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],f.distortionStrength=100*t.style.rain.state.distortionStrength,b.strength=1,b.color=structuredClone(t.style.rain.state.vignetteColor));const x=this.updateOnRender(t,f.timeFactor),T=t.context,M=T.gl,I=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(T,{width:t.width,height:t.height,data:null},M.RGBA8)),f.distortionStrength>0&&(T.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const C=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(T,C),T.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const z=[f.color.r,f.color.g,f.color.b,f.color.a],O=(N,$)=>{const U=Ys(this._movement.getPosition(),N),q=f.dropletSizeX,Q=f.dropletSizeX*f.dropletSizeYScale,ne=t.width/2,le=t.height/2,se=os(0,f.screenThinning.start,0,1,f.screenThinning.intensity),re=os(.001,f.screenThinning.range,0,1,f.screenThinning.intensity),ae=os(0,f.screenThinning.particleOffset,0,1,f.screenThinning.intensity),ue=(he={modelview:x.modelviewMatrix,projection:x.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:U,velocityConeAperture:f.velocityConeAperture,velocity:f.velocity,boxSize:N,rainDropletSize:[q,Q],distortionStrength:f.distortionStrength,rainDirection:_,color:z,screenSize:[I.width,I.height],thinningCenterPos:[ne,le],thinningShape:[se,re,Math.pow(10,f.screenThinning.fadePower)],thinningAffectedRatio:f.screenThinning.affectedRatio,thinningParticleOffset:ae,shapeDirectionalPower:f.shapeDirPower,shapeNormalPower:f.shapeNormalPower,mode:$?0:1},{u_modelview:Float32Array.from(he.modelview),u_projection:Float32Array.from(he.projection),u_time:he.time,u_cam_pos:he.camPos,u_texScreen:0,u_velocityConeAperture:he.velocityConeAperture,u_velocity:he.velocity,u_boxSize:he.boxSize,u_rainDropletSize:he.rainDropletSize,u_distortionStrength:he.distortionStrength,u_rainDirection:he.rainDirection,u_color:he.color,u_screenSize:he.screenSize,u_thinningCenterPos:he.thinningCenterPos,u_thinningShape:he.thinningShape,u_thinningAffectedRatio:he.thinningAffectedRatio,u_thinningParticleOffset:he.thinningParticleOffset,u_shapeDirectionalPower:he.shapeDirectionalPower,u_shapeNormalPower:he.shapeNormalPower,u_mode:he.mode});var he;const xe=Math.round(f.intensity*this.particlesCount),ke=o.bd.simpleSegment(0,0,4*xe,2*xe);C.draw(t,M.TRIANGLES,_t.disabled,Gt.disabled,mi.alphaBlended,Ft.disabled,ue,"rain_particles",this.particlesVx,this.particlesIdx,ke)};f.distortionStrength>0&&O(f.boxSize,!0),O(f.boxSize,!1),this._vignette.draw(t,b)}}const uc=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class yn extends Pa{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Cp(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const u=Dp(this.particlesCount),p=new o.es,f=new o.a_;let _=0;const b=o.e7(1323123451230);for(let x=0;x<u.length;++x){const T=u[x],M=b(),I=b(),C=b(),z=[x/u.length,M,I,C],O=[b(),b()];p.emplaceBack(T[0],T[1],T[2],-1,-1,...z,...O),p.emplaceBack(T[0],T[1],T[2],1,-1,...z,...O),p.emplaceBack(T[0],T[1],T[2],1,1,...z,...O),p.emplaceBack(T[0],T[1],T[2],-1,1,...z,...O),f.emplaceBack(_+0,_+1,_+2),f.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=a.createVertexBuffer(p,uc.members),this.particlesIdx=a.createIndexBuffer(f)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let u=[-a.direction.x,a.direction.y,-100];o.au(u,u);const p=structuredClone(this._vignetteParams),f=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=t.transform.zoom;if(f.revealStart>_)return;const b=os(0,1,f.revealStart,f.revealStart+f.revealRange,_);p.strength*=b,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const x=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const T=t.context,M=T.gl,I=t.transform,C=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(T,C),((z,O,N)=>{const $=Ys(this._movement.getPosition(),z),U=I.width/2,q=I.height/2,Q=os(0,N.screenThinning.start,0,1,N.screenThinning.intensity),ne=os(.001,N.screenThinning.range,0,1,N.screenThinning.intensity),le=os(0,N.screenThinning.particleOffset,0,1,N.screenThinning.intensity),se=(re={modelview:x.modelviewMatrix,projection:x.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$,velocityConeAperture:N.velocityConeAperture,velocity:N.velocity,horizontalOscillationRadius:N.horizontalOscillationRadius,horizontalOscillationRate:N.horizontalOscillationRate,boxSize:z,billboardSize:1*N.billboardSize,simpleShapeParameters:[N.shapeFadeStart,N.shapeFadePower],screenSize:[I.width,I.height],thinningCenterPos:[U,q],thinningShape:[Q,ne,Math.pow(10,N.screenThinning.fadePower)],thinningAffectedRatio:N.screenThinning.affectedRatio,thinningParticleOffset:le,color:[N.color.r,N.color.g,N.color.b,N.color.a],direction:u},{u_modelview:Float32Array.from(re.modelview),u_projection:Float32Array.from(re.projection),u_time:re.time,u_cam_pos:re.camPos,u_velocityConeAperture:re.velocityConeAperture,u_velocity:re.velocity,u_horizontalOscillationRadius:re.horizontalOscillationRadius,u_horizontalOscillationRate:re.horizontalOscillationRate,u_boxSize:re.boxSize,u_billboardSize:re.billboardSize,u_simpleShapeParameters:re.simpleShapeParameters,u_screenSize:re.screenSize,u_thinningCenterPos:re.thinningCenterPos,u_thinningShape:re.thinningShape,u_thinningAffectedRatio:re.thinningAffectedRatio,u_thinningParticleOffset:re.thinningParticleOffset,u_particleColor:re.color,u_direction:re.direction});var re;const ae=Math.round(N.intensity*this.particlesCount),ue=o.bd.simpleSegment(0,0,4*ae,2*ae);this.particlesVx&&this.particlesIdx&&C.draw(t,M.TRIANGLES,_t.disabled,Gt.disabled,mi.alphaBlended,Ft.disabled,se,"snow_particles",this.particlesVx,this.particlesIdx,ue)})(a.boxSize,0,a),this._vignette.draw(t,p)}}const Ei={symbol:function(l,t,a,u,p){if(l.renderPass!=="translucent")return;const f=Gt.disabled,_=l.colorModeForRenderPass(),b=a.layout.get("text-variable-anchor"),x=a.layout.get("text-size-scale-range"),T=o.ay(l.scaleFactor,x[0],x[1]);b&&function(C,z,O,N,$,U,q,Q){const ne=z.transform,le=$==="map",se=U==="map";for(const re of C){const ae=N.getTile(re),ue=ae.getBucket(O);if(!ue||!ue.text||!ue.text.segments.get().length)continue;const he=o.bH(ue.textSizeData,ne.zoom,Q),xe=ah(re,ue.getProjection(),ne),ke=ne.calculatePixelsToTileUnitsMatrix(ae),Ne=yo(xe,ae.tileID.canonical,se,le,ne,ue.getProjection(),ke),Fe=ue.hasIconTextFit()&&ue.hasIconData();he&&Gf(ue,le,se,q,ne,Ne,re,Math.pow(2,ne.zoom-ae.tileID.overscaledZ),he,Fe)}}(u,l,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),p,T);const M=a.paint.get("icon-opacity").constantOr(1)!==0,I=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(M||I)?Bl(l,t,a,u,f,_):(M&&Bl(l,t,a,u,f,_,{onlyIcons:!0}),I&&Bl(l,t,a,u,f,_,{onlyText:!0})),t.map.showCollisionBoxes&&(Eh(l,t,a,u,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Eh(l,t,a,u,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,a,u){if(l.renderPass!=="translucent")return;const p=a.paint.get("circle-opacity"),f=a.paint.get("circle-stroke-width"),_=a.paint.get("circle-stroke-opacity"),b=a.layout.get("circle-sort-key").constantOr(1)!==void 0,x=a.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(f.constantOr(1)===0||_.constantOr(1)===0))return;const T=l.context,M=T.gl,I=l.transform,C=!(!l.terrain||!l.terrain.enabled),z=a.layout.get("circle-elevation-reference"),O=l.depthModeForSublayer(0,_t.ReadOnly),N=new _t(l.context.gl.LEQUAL,_t.ReadOnly,l.depthRangeFor3D),$=z==="none"||C?O:N,U=Gt.disabled,q=l.colorModeForDrapableLayerRenderPass(x),Q=I.projection.name==="globe",ne=[o.aD(I.center.lng),o.aH(I.center.lat)],le=[];for(let re=0;re<u.length;re++){const ae=u[re],ue=t.getTile(ae),he=ue.getBucket(a);if(!he||he.projection.name!==I.projection.name)continue;const xe=he.programConfigurations.get(a.id),ke=he.layoutVertexBuffer,Ne=he.globeExtVertexBuffer,Fe=he.indexBuffer,Ge=o.dK(a),be=[Ne],ze=l.isTileAffectedByFog(ae);Q&&Ge.push("PROJECTION_GLOBE_VIEW"),Ge.push("DEPTH_D24"),l.terrain&&I.depthOcclusionForSymbolsAndCircles&&Ge.push("DEPTH_OCCLUSION"),he.hasElevation&&(Ge.push("ELEVATED_ROADS"),be.push(he.elevatedLayoutVertexBuffer));const fe=l.getOrCreateProgram("circle",{config:xe,defines:Ge,overrideFog:ze}),je=I.projection.createInversionMatrix(I,ae.canonical),Pe={programConfiguration:xe,program:fe,layoutVertexBuffer:ke,dynamicBuffers:be,indexBuffer:Fe,uniformValues:o.dL(l,ae,ue,je,ne,a),tile:ue};if(b){const Je=he.segments.get();for(const at of Je)le.push({segments:new o.bd([at]),sortKey:at.sortKey,state:Pe})}else le.push({segments:he.segments,sortKey:0,state:Pe})}b&&le.sort((re,ae)=>re.sortKey-ae.sortKey);const se={useDepthForOcclusion:I.depthOcclusionForSymbolsAndCircles};for(const re of le){const{programConfiguration:ae,program:ue,layoutVertexBuffer:he,dynamicBuffers:xe,indexBuffer:ke,uniformValues:Ne,tile:Fe}=re.state,Ge=re.segments;l.terrain&&l.terrain.setupElevationDraw(Fe,ue,se),l.uploadCommonUniforms(T,ue,Fe.tileID.toUnwrapped()),ue.draw(l,M.TRIANGLES,$,U,q,Ft.disabled,Ne,a.id,he,ke,Ge,a.paint,I.zoom,ae,xe)}},heatmap:function(l,t,a,u){if(a.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const p=l.context,f=p.gl,_=Gt.disabled,b=new mi([f.ONE,f.ONE,f.ONE,f.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(z,O,N,$){const U=z.gl,q=O.width*$,Q=O.height*$;z.activeTexture.set(U.TEXTURE1),z.viewport.set([0,0,q,Q]);let ne=N.heatmapFbo;if(!ne||ne&&(ne.width!==q||ne.height!==Q)){ne&&ne.destroy();const le=U.createTexture();U.bindTexture(U.TEXTURE_2D,le),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ne=N.heatmapFbo=z.createFramebuffer(q,Q,!0,null),function(se,re,ae,ue,he,xe){const ke=se.gl;ke.texImage2D(ke.TEXTURE_2D,0,se.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,he,xe,0,ke.RGBA,se.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),ue.colorAttachment.set(ae)}(z,0,le,ne,q,Q)}else U.bindTexture(U.TEXTURE_2D,ne.colorAttachment.get()),z.bindFramebuffer.set(ne.framebuffer)})(p,l,a,l.transform.projection.name==="globe"?.5:.25),p.clear({color:o.am.transparent});const x=l.transform,T=x.projection.name==="globe",M=T?["PROJECTION_GLOBE_VIEW"]:[],I=T?Ft.frontCCW:Ft.disabled,C=[o.aD(x.center.lng),o.aH(x.center.lat)];for(let z=0;z<u.length;z++){const O=u[z];if(t.hasRenderableParent(O))continue;const N=t.getTile(O),$=N.getBucket(a);if(!$||$.projection.name!==x.projection.name)continue;const U=l.isTileAffectedByFog(O),q=$.programConfigurations.get(a.id),Q=l.getOrCreateProgram("heatmap",{config:q,defines:M,overrideFog:U}),{zoom:ne}=l.transform;l.terrain&&l.terrain.setupElevationDraw(N,Q),l.uploadCommonUniforms(p,Q,O.toUnwrapped());const le=x.projection.createInversionMatrix(x,O.canonical);Q.draw(l,f.TRIANGLES,_t.disabled,_,b,I,jf(l,O,N,le,C,ne,a.paint.get("heatmap-intensity")),a.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,a.paint,l.transform.zoom,q,T?[$.globeExtVertexBuffer]:null)}p.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(p,f){const _=p.context,b=_.gl,x=f.heatmapFbo;if(!x)return;_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,x.colorAttachment.get()),_.activeTexture.set(b.TEXTURE1);let T=f.colorRampTexture;T||(T=f.colorRampTexture=new o.T(_,f.colorRamp,b.RGBA8)),T.bind(b.LINEAR,b.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,b.TRIANGLES,_t.disabled,Gt.disabled,p.colorModeForRenderPass(),Ft.disabled,((M,I,C,z)=>({u_image:0,u_color_ramp:1,u_opacity:I.paint.get("heatmap-opacity")}))(0,f),f.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,f.paint,p.transform.zoom)}(l,a))},line:function(l,t,a,u){if(l.renderPass!=="translucent")return;const p=a.paint.get("line-opacity"),f=a.paint.get("line-width");if(p.constantOr(1)===0||f.constantOr(1)===0)return;const _=a.paint.get("line-emissive-strength"),b=a.paint.get("line-occlusion-opacity"),x=a.layout.get("line-elevation-reference"),T=a.layout.get("line-width-unit")==="meters",M=x==="sea",I=!(!l.terrain||!l.terrain.enabled),C=l.context,z=C.gl;if(a.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const O=a.layout.get("line-cross-slope"),N=O!==void 0,$=O<1,U=l.colorModeForDrapableLayerRenderPass(_),q=l.terrain&&l.terrain.renderingToTexture,Q=q?1:o.q.devicePixelRatio,ne=a.paint.get("line-dasharray"),le=ne.constantOr(1),se=a.layout.get("line-cap"),re=ne.constantOr(null),ae=se.constantOr(null),ue=a.paint.get("line-pattern"),he=ue.constantOr(1),xe=a.paint.get("line-pattern-cross-fade"),ke=ue.constantOr(null),Ne=a.paint.get("line-opacity").constantOr(1);let Fe=!he&&Ne!==1||l.depthOcclusion&&b>0&&b<1;const Ge=a.paint.get("line-gradient"),be=he?"linePattern":"line",ze=o.dM(a);let fe;if(q&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Fe=!1),b!==0&&l.depthOcclusion){const at=a.paint._values["line-opacity"];at&&at.value&&at.value.kind==="constant"?fe=at.value:o.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}f.value.kind!=="constant"&&f.value.isLineProgressConstant===!1&&ze.push("VARIABLE_LINE_WIDTH");const je=(at,$e,it,wt,bt,ft)=>{for(const Et of at){const Dt=t.getTile(Et);if(he&&!Dt.patternsLoaded())continue;const Rt=Dt.getBucket(a);if(!Rt||Rt.elevationType!=="none"&&!bt||Rt.elevationType==="none"&&bt)continue;l.prepareDrawTile();const Jt=[...$e],si=l.shadowRenderer,Ni=Rt.elevationType==="road"&&!!si&&si.enabled;let an=[0,0,0];if(Ni){const Ti=l.style.directionalLight,jn=l.style.ambientLight;Ti&&jn&&(an=Ws(l.style,Ti,jn)),Jt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const ji=Rt.programConfigurations.get(a.id);let qi=!1;if(ke&&Dt.imageAtlas){const Ti=o.dN.from(ke),jn=Ti.getPrimary().scaleSelf(Q).toString(),cn=Dt.imageAtlas.patternPositions.get(jn),Qi=Ti.getSecondary(),hn=Qi?Dt.imageAtlas.patternPositions.get(Qi.scaleSelf(Q).toString()):null;qi=!!cn&&!!hn,cn&&ji.setConstantPatternPositions(cn,hn)}xe>0&&(qi||ji.getPatternTransitionVertexBuffer("line-pattern"))&&Jt.push("LINE_PATTERN_TRANSITION");const Fn=l.isTileAffectedByFog(Et),ei=l.getOrCreateProgram(be,{config:ji,defines:Jt,overrideFog:Fn,overrideRtt:!bt&&void 0});if(!he&&re&&ae&&Dt.lineAtlas){const Ti=Dt.lineAtlas.getDash(re,ae);Ti&&ji.setConstantPatternPositions(Ti)}Ni&&si.setupShadows(Dt.tileID.toUnwrapped(),ei,"vector-tile",Dt.tileID.overscaledZ);let[hi,vi]=a.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&hi!==vi&&(hi===0&&(hi-=1),vi===1&&(vi+=1));const un=q?Et.projMatrix:null,Gn=T?1/Rt.tileToMeter/o.aw(Dt,1,l.transform.zoom):1,rn=T?1/Rt.tileToMeter/o.aw(Dt,1,Math.floor(l.transform.zoom)):1,zi=he?o.dO(l,Dt,a,un,Q,Gn,rn,[hi,vi],an,xe):o.dP(l,Dt,a,un,Rt.lineClipsArray.length,Q,Gn,rn,[hi,vi],an);if(Ge){const Ti=Rt.gradients[a.id];let jn=Ti.texture;if(a.gradientVersion!==Ti.version){let cn=256;if(a.stepInterpolant){const Qi=t.getSource().maxzoom,hn=Et.canonical.z===Qi?Math.ceil(1<<l.transform.maxZoom-Et.canonical.z):1;cn=o.ay(o.dQ(Rt.maxLineLength/o.aj*1024*hn),256,C.maxTextureSize)}Ti.gradient=o.dR({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:cn,image:Ti.gradient||void 0,clips:Rt.lineClipsArray}),Ti.texture?Ti.texture.update(Ti.gradient):Ti.texture=new o.T(C,Ti.gradient,z.RGBA8),Ti.version=a.gradientVersion,jn=Ti.texture}C.activeTexture.set(z.TEXTURE1),jn.bind(a.stepInterpolant?z.NEAREST:z.LINEAR,z.CLAMP_TO_EDGE)}le&&(C.activeTexture.set(z.TEXTURE0),Dt.lineAtlasTexture&&Dt.lineAtlasTexture.bind(z.LINEAR,z.REPEAT),ji.updatePaintBuffers()),he&&(C.activeTexture.set(z.TEXTURE0),Dt.imageAtlasTexture&&Dt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ji.updatePaintBuffers()),bt&&!M&&l.terrain.setupElevationDraw(Dt,ei),l.uploadCommonUniforms(C,ei,Et.toUnwrapped());const Dn=Ti=>{fe!=null&&(fe.value=Ne*b),ei.draw(l,z.TRIANGLES,it,Ti,U,Ft.disabled,zi,a.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,a.paint,l.transform.zoom,ji,[Rt.layoutVertexBuffer2,Rt.patternVertexBuffer,Rt.zOffsetVertexBuffer]),fe!=null&&(fe.value=Ne)};if(Fe&&!bt){const Ti=l.stencilModeForClipping(Et).ref;Ti===0&&q&&C.clear({stencil:0});const jn={func:z.EQUAL,mask:255};zi.u_alpha_discard_threshold=.8,Dn(new Gt(jn,Ti,255,z.KEEP,z.KEEP,z.INVERT)),zi.u_alpha_discard_threshold=0,Dn(new Gt(jn,Ti,255,z.KEEP,z.KEEP,z.KEEP))}else zi.u_alpha_discard_threshold=Fe&&bt&&ft?.8:0,Dn(bt?wt:l.stencilModeForClipping(Et))}};let Pe=l.depthModeForSublayer(0,_t.ReadOnly);const Je=new _t(l.depthOcclusion?z.GREATER:z.LEQUAL,_t.ReadOnly,l.depthRangeFor3D);if(a.hasNonElevatedBuckets){const at=!q&&l.terrain;b!==0&&at?o.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):at?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):je(u,ze,Pe,Gt.disabled,!1,!0)}if(a.hasElevatedBuckets){x==="hd-road-markup"?I||(Pe=Je,ze.push("ELEVATED_ROADS")):(ze.push("ELEVATED"),Pe=Je,N&&ze.push($?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),M&&ze.push("ELEVATION_REFERENCE_SEA"));const at=Fe?l.stencilModeFor3D():Gt.disabled;l.forceTerrainMode=!0,je(u,ze,Pe,at,!0,!0),Fe&&je(u,ze,Pe,at,!0,!1),l.forceTerrainMode=!1}Fe&&(l.resetStencilClippingMasks(),q&&C.clear({stencil:0})),b===0||l.depthOcclusion||q||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,a,u){const p=a.paint.get("fill-color"),f=a.paint.get("fill-opacity");if(f.constantOr(1)===0)return;const _=a.paint.get("fill-emissive-strength"),b=l.colorModeForDrapableLayerRenderPass(_),x=a.paint.get("fill-pattern"),T=l.opaquePassEnabledForLayer()&&!x.constantOr(1)&&p.constantOr(o.am.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";let M="none";a.layout.get("fill-elevation-reference")!=="none"?M="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(M="offset");const I=!(!l.terrain||!l.terrain.enabled),C={painter:l,sourceCache:t,layer:a,coords:u,colorMode:b,elevationType:M,terrainEnabled:I,pass:T};if(l.renderPass!=="shadow")if(M!=="offset"){if(Sp(C,!1),M==="road"){const z=!I&&l.renderPass==="translucent";z&&Ap(l,t,a,u,"geometry"),Sp(C,!0,Gt.disabled),z&&function(O){const{painter:N,sourceCache:$,layer:U,coords:q,colorMode:Q}=O,ne=N.context.gl,le=O.painter.shadowRenderer,se=!!le&&le.enabled,re=new _t(N.context.gl.LEQUAL,_t.ReadOnly,N.depthRangeFor3D);let ae=[0,0,0];if(se){const he=N.style.directionalLight,xe=N.style.ambientLight;he&&xe&&(ae=Ws(N.style,he,xe))}const ue=he=>{for(const xe of q){const ke=$.getTile(xe),Ne=ke.getBucket(U);if(!Ne)continue;const Fe=Ne.elevatedStructures;if(!Fe)continue;let Ge,be;if(he?(Ge=Fe.renderableBridgeSegments,be=Fe.bridgeProgramConfigurations.get(U.id)):(Ge=Fe.renderableTunnelSegments,be=Fe.tunnelProgramConfigurations.get(U.id)),!Ge||Ge.segments[0].primitiveLength===0)continue;be.updatePaintBuffers(),N.prepareDrawTile();const ze=N.isTileAffectedByFog(xe),fe=[];se&&fe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const je=N.getOrCreateProgram("elevatedStructures",{config:be,overrideFog:ze,defines:fe}),Pe=N.translatePosMatrix(xe.projMatrix,ke,U.paint.get("fill-translate"),U.paint.get("fill-translate-anchor"));se&&le.setupShadows(ke.tileID.toUnwrapped(),je,"vector-tile",ke.tileID.overscaledZ);const Je=Qy(Pe,ae);N.uploadCommonUniforms(N.context,je,xe.toUnwrapped()),je.draw(N,ne.TRIANGLES,re,Gt.disabled,Q,Ft.backCCW,Je,U.id,Fe.vertexBuffer,Fe.indexBuffer,Ge,U.paint,N.transform.zoom,be,[Fe.vertexBufferNormal])}};ue(!0),ue(!1)}(C)}}else Sp(C,!1,l.stencilModeFor3D());else l.shadowRenderer&&M==="road"&&!I&&function(z){const{painter:O,sourceCache:N,layer:$,coords:U}=z,q=O.context.gl,Q=z.painter.shadowRenderer;for(const ne of U){const le=N.getTile(ne),se=le.getBucket($);if(!se)continue;const re=se.elevatedStructures;if(!re||!re.shadowCasterSegments||re.shadowCasterSegments.segments[0].primitiveLength===0)continue;O.prepareDrawTile();const ae=se.bufferData.programConfigurations.get($.id),ue=O.isTileAffectedByFog(ne),he=O.getOrCreateProgram("elevatedStructuresDepth",{config:ae,overrideFog:ue}),xe=Q.calculateShadowPassMatrixFromTile(le.tileID.toUnwrapped());O.uploadCommonUniforms(O.context,he,ne.toUnwrapped());const ke={u_matrix:xe,u_depth_bias:.001};he.draw(O,q.TRIANGLES,Q.getShadowPassDepthMode(),Gt.disabled,Q.getShadowPassColorMode(),Ft.disabled,ke,$.id,re.vertexBuffer,re.indexBuffer,re.shadowCasterSegments,$.paint,O.transform.zoom,ae)}}(C)},"fill-extrusion":function(l,t,a,u){const p=a.paint.get("fill-extrusion-opacity"),f=l.context,_=f.gl,b=l.terrain,x=b&&b.renderingToTexture;if(p===0)return;const T=l.conflationActive&&l.style.isLayerClipped(a,t.getSource()),M=l.style.order.indexOf(a.fqid);if(T&&function(I,C,z,O,N){for(const $ of O){const U=C.getTile($).getBucket(z);U&&(U.updateReplacement($,I.replacementSource,N),U.uploadCentroid(I.context))}}(l,t,a,u,M),b||T)for(const I of u){const C=t.getTile(I).getBucket(a);C&&yt(l.context,t,I,C,a,b,T)}if(l.renderPass==="shadow"&&l.shadowRenderer){const I=l.shadowRenderer;if(b&&p<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const C=I.getShadowPassDepthMode(),z=I.getShadowPassColorMode();ko(l,t,a,u,C,Gt.disabled,z,T)}else if(l.renderPass==="translucent"){const I=!a.paint.get("fill-extrusion-pattern").constantOr(1),C=a.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!x&&C.a!==0){const z=new _t(l.context.gl.LEQUAL,_t.ReadWrite,l.depthRangeFor3D);p===1&&I?ko(l,t,a,u,z,Gt.disabled,mi.unblended,T):(ko(l,t,a,u,z,Gt.disabled,mi.disabled,T),ko(l,t,a,u,z,l.stencilModeFor3D(),l.colorModeForRenderPass(),T),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&I&&(!b&&l.transform.projection.name!=="globe"||x)){const z=a.paint.get("fill-extrusion-opacity"),O=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),N=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),$=a.paint.get("fill-extrusion-flood-light-intensity"),U=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",q=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(U?null:a.lut).toArray01().slice(0,3),Q=O>0&&N>0,ne=$>0,le=(re,ae,ue)=>(1-ue)*re+ue*ae,se=re=>{const ae=l.depthModeForSublayer(1,_t.ReadOnly,_.LEQUAL,!0),ue=a.paint.get(re?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),he=le(.1,3,ue),xe=l._showOverdrawInspector;if(!xe){const ke=new Gt({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),Ne=new mi([_.ONE,_.ONE,_.ONE,_.ONE],o.am.transparent,[!1,!1,!1,!0],_.MIN);Ao(l,t,a,u,ae,ke,Ne,Ft.disabled,re,"sdf",z,O,N,$,q,he,T,!1)}{const ke=xe?Gt.disabled:new Gt({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),Ne=xe?l.colorModeForRenderPass():new mi([_.ONE_MINUS_DST_ALPHA,_.DST_ALPHA,_.ONE,_.ONE],o.am.transparent,[!0,!0,!0,!0]);Ao(l,t,a,u,ae,ke,Ne,Ft.disabled,re,"color",z,O,N,$,q,he,T,!1)}};if(x){const re=(ae,ue,he)=>{const xe=l.depthModeForSublayer(1,_t.ReadOnly,_.LEQUAL,!1),ke=a.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=le(.1,3,ke);{const Fe=new mi([_.ONE,_.ONE,_.ONE,_.ONE],o.am.transparent,[!1,!1,!1,!0]);Ao(l,t,a,u,xe,Gt.disabled,Fe,Ft.disabled,ae,"clear",z,O,N,$,q,Ne,T,ue)}{const Fe=new Gt({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),Ge=new mi([_.ONE,_.ONE,_.ONE,_.ONE],o.am.transparent,[!1,!1,!1,!0],_.MIN);Ao(l,t,a,u,xe,Fe,Ge,Ft.disabled,ae,"sdf",z,O,N,$,q,Ne,T,ue)}{const Fe=ae?_.ZERO:_.ONE_MINUS_DST_ALPHA,Ge=new Gt({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),be=new mi([Fe,_.DST_ALPHA,_.ONE_MINUS_DST_ALPHA,_.ZERO],o.am.transparent,[!0,!0,!0,!0]);Ao(l,t,a,u,xe,Ge,be,Ft.disabled,ae,"color",z,O,N,$,q,Ne,T,ue)}{const Fe=new mi([_.ONE,_.ONE,_.ONE,ae?_.ZERO:_.ONE],o.am.transparent,[!1,!1,!1,!0],ae?_.FUNC_ADD:_.MAX);Ao(l,t,a,u,xe,Gt.disabled,Fe,Ft.disabled,ae,"clear",z,O,N,$,q,Ne,T,ue,he)}};if(Q||ne){let ae;if(l.prepareDrawTile(),b){const ue=b.drapeBufferSize[0],he=b.drapeBufferSize[1];ae=b.framebufferCopyTexture,ae&&(!ae||ae.size[0]===ue&&ae.size[1]===he)||(ae&&ae.destroy(),ae=b.framebufferCopyTexture=new o.T(f,new o.r({width:ue,height:he}),_.RGBA8)),ae.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,0,0,ue,he)}Q&&re(!0,!1,ae),ne&&re(!1,!0,ae)}}else Q&&se(!0),ne&&se(!1),(Q||ne)&&l.resetStencilClippingMasks()}}},building:function(l,t,a,u){},hillshade:function(l,t,a,u){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const p=l.context,f=l.terrain&&l.terrain.renderingToTexture,[_,b]=l.renderPass!=="translucent"||f?[{},u]:l.stencilConfigForOverlap(u);for(const x of b){const T=t.getTile(x);if(T.needsHillshadePrepare&&l.renderPass==="offscreen")$y(l,T,a);else if(l.renderPass==="translucent"){const M=l.depthModeForSublayer(0,_t.ReadOnly),I=a.paint.get("hillshade-emissive-strength"),C=l.colorModeForDrapableLayerRenderPass(I),z=f&&l.terrain?l.terrain.stencilModeForRTTOverlap(x):_[x.overscaledZ];Oy(l,x,T,a,M,z,C)}}p.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,a,u,p,f){if(l.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const _=l.transform.projection.name==="globe",b=a.paint.get("raster-elevation")!==0,x=b&&_;if(l.renderElevatedRasterBackface&&!x)return;const T=l.context,M=T.gl,I=t.getSource(),C=function(se,re,ae,ue){const he=re.paint.get("raster-color"),xe=se.type==="raster-array",ke=[],Ne=re.paint.get("raster-resampling"),Fe=re.paint.get("raster-color-mix");let Ge=re.paint.get("raster-color-range");const be=[Fe[0],Fe[1],Fe[2],0],ze=Fe[3];let fe=Ne==="nearest"?ue.NEAREST:ue.LINEAR;if(xe&&(ke.push("RASTER_ARRAY"),he||ke.push("RASTER_COLOR"),Ne==="linear"&&ke.push("RASTER_ARRAY_LINEAR"),fe=ue.NEAREST,!Ge&&se.rasterLayers)){const je=se.rasterLayers.find(({id:Pe})=>Pe===re.sourceLayer);je&&je.fields&&je.fields.range&&(Ge=je.fields.range)}if(Ge=Ge||[0,1],he){ke.push("RASTER_COLOR"),ae.activeTexture.set(ue.TEXTURE2),re.updateColorRamp(Ge);let je=re.colorRampTexture;je||(je=re.colorRampTexture=new o.T(ae,re.colorRamp,ue.RGBA8)),je.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}return{mix:be,range:Ge,offset:ze,defines:ke,resampling:fe}}(I,a,T,M);if(I instanceof o.aP&&!u.length&&!_)return;const z=a.paint.get("raster-emissive-strength"),O=l.colorModeForDrapableLayerRenderPass(z),N=l.terrain&&l.terrain.renderingToTexture,$=!l.options.moving,U=a.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;if(I instanceof o.aP&&!u.length&&(I.onNorthPole||I.onSouthPole)){const se=b?l.stencilModeFor3D():Gt.disabled;return void oc(!!I.onNorthPole,null,l,t,a,z,C,Ft.disabled,se)}if(!u.length)return;const[q,Q]=I instanceof o.aP||N?[{},u]:l.stencilConfigForOverlap(u),ne=Q[Q.length-1].overscaledZ;x&&C.defines.push("PROJECTION_GLOBE_VIEW"),b&&C.defines.push("RENDER_CUTOFF");const le=(se,re,ae)=>{for(const ue of se){const he=ue.toUnwrapped(),xe=t.getTile(ue);if(N&&(!xe||!xe.hasData()))continue;T.activeTexture.set(M.TEXTURE0);const ke=r1(xe,I,a,C);if(!ke||!ke.texture)continue;const{texture:Ne,mix:Fe,offset:Ge,tileSize:be,buffer:ze}=ke;let fe,je;N?(fe=_t.disabled,je=ue.projMatrix):b?(fe=new _t(M.LEQUAL,_t.ReadWrite,l.depthRangeFor3D),je=_?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(he,$)):(fe=l.depthModeForSublayer(ue.overscaledZ-ne,a.paint.get("raster-opacity")===1?_t.ReadWrite:_t.ReadOnly,M.LESS),je=l.transform.calculateProjMatrix(he,$));const Pe=l.terrain&&N?l.terrain.stencilModeForRTTOverlap(ue):q[ue.overscaledZ],Je=f?0:a.paint.get("raster-fade-duration");xe.registerFadeDuration(Je);const at=t.findLoadedParent(ue,0),$e=$s(xe,at,t,l.transform,Je);let it,wt;l.terrain&&l.terrain.prepareDrawTile(),T.activeTexture.set(M.TEXTURE0),Ne.bind(U,M.CLAMP_TO_EDGE),T.activeTexture.set(M.TEXTURE1),at?(at.texture&&at.texture.bind(U,M.CLAMP_TO_EDGE),it=Math.pow(2,at.tileID.overscaledZ-xe.tileID.overscaledZ),wt=[xe.tileID.canonical.x*it%1,xe.tileID.canonical.y*it%1]):Ne.bind(U,M.CLAMP_TO_EDGE),"useMipmap"in Ne&&T.extTextureFilterAnisotropic&&l.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const bt=l.transform;let ft;const Et=b?a1(bt):[0,0,0,0];let Dt,Rt,Jt,si,Ni,an=0;if(x&&I instanceof o.aP&&I.coordinates.length>3)Dt=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0)))),Rt=Float32Array.from(bt.globeMatrix),Jt=Float32Array.from(o.dm(bt)),si=[o.aD(bt.center.lng),o.aH(bt.center.lat)],ft=I.elevatedGlobePerspectiveTransform,Ni=I.elevatedGlobeGridMatrix||new Float32Array(9);else if(x){const ei=o.dn(ue.canonical);an=o.dp(ei.getCenter().lat),Dt=Float32Array.from(o.bh(o.dr(ue.canonical))),Rt=Float32Array.from(bt.globeMatrix),Jt=Float32Array.from(o.dm(bt)),si=[o.aD(bt.center.lng),o.aH(bt.center.lat)],ft=[0,0],Ni=Float32Array.from(o.dq(ue.canonical,ei,an,bt.worldSize/bt._pixelsPerMercatorPixel))}else ft=I instanceof o.aP?I.perspectiveTransform:[0,0],Dt=new Float32Array(16),Rt=new Float32Array(9),Jt=new Float32Array(16),si=[0,0],Ni=new Float32Array(9);const ji=bp(je,Dt,Rt,Jt,Ni,wt||[0,0],o.ah(l.transform.zoom),si,Et,it||1,$e,a,ft,b?a.paint.get("raster-elevation"):0,2,Fe,Ge,C.range,be,ze,z),qi=l.isTileAffectedByFog(ue),Fn=l.getOrCreateProgram("raster",{defines:C.defines,overrideFog:qi});if(l.uploadCommonUniforms(T,Fn,he),I instanceof o.aP){const ei=I.elevatedGlobeVertexBuffer,hi=I.elevatedGlobeIndexBuffer;if(N||!_)I.boundsBuffer&&I.boundsSegments&&Fn.draw(l,M.TRIANGLES,fe,Gt.disabled,O,Ft.disabled,ji,a.id,I.boundsBuffer,l.quadTriangleIndexBuffer,I.boundsSegments);else if(ei&&hi){const vi=bt.zoom<=o.cL?I.elevatedGlobeSegments:I.getSegmentsForLongitude(bt.center.lng);vi&&Fn.draw(l,M.TRIANGLES,fe,Gt.disabled,O,re,ji,a.id,ei,hi,vi)}}else if(x){fe=new _t(M.LEQUAL,_t.ReadOnly,l.depthRangeFor3D);const ei=l.globeSharedBuffers;if(ei){const[hi,vi,un]=ei.getGridBuffers(an,!1);Fn.draw(l,M.TRIANGLES,fe,ae||Pe,l.colorModeForRenderPass(),re,ji,a.id,hi,vi,un)}}else{const{tileBoundsBuffer:ei,tileBoundsIndexBuffer:hi,tileBoundsSegments:vi}=l.getTileBoundsBuffers(xe);Fn.draw(l,M.TRIANGLES,fe,Pe,O,Ft.disabled,ji,a.id,ei,hi,vi)}}if(!(I instanceof o.aP)&&x)for(const ue of se){const he=ue.canonical.y===(1<<ue.canonical.z)-1;ue.canonical.y===0&&oc(!0,ue,l,t,a,z,C,re,ae||Gt.disabled),he&&oc(!1,ue,l,t,a,z,C,re===Ft.frontCW?Ft.backCW:Ft.frontCW,ae||Gt.disabled)}};x?le(Q,l.renderElevatedRasterBackface?Ft.backCW:Ft.frontCW,l.stencilModeFor3D()):le(Q,Ft.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,a,u,p,f){l.renderPass==="offscreen"&&function(_,b,x,T){if(!T.length)return;const M=_.context,I=M.gl,C=b.getSource();if(!(C instanceof Yo))return;const z=Math.ceil(Math.sqrt(x.paint.get("raster-particle-count")));let O=x.particlePositionRGBAImage;if(!O||O.width!==z){const Q=function(ne){const le=ne*ne,se=new Uint8Array(4*le),re=function(ue){return ue|=0,ue=Math.imul(2747636419^ue,2654435769),ue=Math.imul(ue^ue>>>16,2654435769),((ue=Math.imul(ue^ue>>>16,2654435769))>>>0)/4294967296},ae=1/1.1;for(let ue=0;ue<le;ue++){const he=ae*(re(2*ue+0)+ts),xe=ae*(re(2*ue+1)+ts),ke=255*he%1,Ne=255*xe%1,Fe=ke,Ge=xe-Ne/255,be=Ne;se[4*ue+0]=255*(he-ke/255),se[4*ue+1]=255*Fe,se[4*ue+2]=255*Ge,se[4*ue+3]=255*be}return se}(z);O=x.particlePositionRGBAImage=new o.r({width:z,height:z},Q)}let N=x.particleFramebuffer;N?N.width!==z&&(N.destroy(),N=x.particleFramebuffer=M.createFramebuffer(z,z,!0,null)):N=x.particleFramebuffer=M.createFramebuffer(z,z,!0,null);const $=[];for(const Q of T){const ne=b.getTile(Q);if(!(ne instanceof gl))continue;const le=o1(ne,C,x);if(!le)continue;const se=[ne.tileSize,ne.tileSize];let re=x.tileFramebuffer;re||(re=x.tileFramebuffer=M.createFramebuffer(se[0],se[1],!0,null));let ae=ne.rasterParticleState;ae||(ae=ne.rasterParticleState=new Zf(M,Q,se,O));const ue=ae.update(x.lastInvalidatedAt);ae.particleTextureDimension!==z&&ae.updateParticleTexture(Q,O);const he=ae.targetColorTexture;ae.targetColorTexture=ae.backgroundColorTexture,ae.backgroundColorTexture=he;const xe=ae.particleTexture0;ae.particleTexture0=ae.particleTexture1,ae.particleTexture1=xe,$.push([Q,le,ae,ue])}if($.length===0)return;const U=o.q.now(),q=x.previousDrawTimestamp?.001*(U-x.previousDrawTimestamp):.0167;if(x.previousDrawTimestamp=U,x.hasColorMap()){M.activeTexture.set(I.TEXTURE0+2);let Q=x.colorRampTexture;Q||(Q=x.colorRampTexture=new o.T(M,x.colorRamp,I.RGBA8)),Q.bind(I.LINEAR,I.CLAMP_TO_EDGE)}M.bindFramebuffer.set(x.tileFramebuffer.framebuffer),function(Q,ne,le){const se=Q.context,re=se.gl,ae=ne.tileFramebuffer;se.activeTexture.set(re.TEXTURE0);const ue={u_texture:0,u_opacity:1.05*(xe=ne.paint.get("raster-particle-fade-opacity-factor"))/(xe+.05)},he=Q.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var xe;for(const ke of le){const[,,Ne,Fe]=ke;ae.colorAttachment.set(Ne.targetColorTexture.texture),se.viewport.set([0,0,ae.width,ae.height]),se.clear({color:o.am.transparent}),Fe&&(Ne.backgroundColorTexture.bind(re.NEAREST,re.CLAMP_TO_EDGE),he.draw(Q,re.TRIANGLES,_t.disabled,Gt.disabled,mi.alphaBlended,Ft.disabled,ue,ne.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments))}}(_,x,$),function(Q,ne,le,se){const re=Q.context,ae=re.gl,ue=le.tileFramebuffer,he=Q.transform.projection.name==="globe",xe=le.paint.get("raster-particle-max-speed");for(const ke of se){const[Ne,Fe,Ge]=ke;re.activeTexture.set(ae.TEXTURE0+0),Fe.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ue.colorAttachment.set(Ge.targetColorTexture.texture);const be=Q.getOrCreateProgram("rasterParticleDraw",{defines:Fe.defines,overrideFog:!1});re.activeTexture.set(ae.TEXTURE0+1);const ze=Fe.scalarData?[]:[0,1,2,3].map(Pe=>o.dT[Pe](Ne));ze.push(Ne);const fe=Ne.canonical.x,je=Ne.canonical.y;for(const Pe of ze){const Je=ne.getTile(he?Pe.wrapped():Pe);if(!Je)continue;const at=Je.rasterParticleState;if(!at)continue;const $e=Pe.canonical.x+(1<<Pe.canonical.z)*(Pe.wrap-Ne.wrap),it=Pe.canonical.y;at.particleTexture0.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const wt=Uf(1,at.particleTexture0.size[0],[$e-fe,it-je],0,Fe.texture.size,2,xe,Fe.textureOffset,Fe.scale,Fe.offset);be.draw(Q,ae.POINTS,_t.disabled,Gt.disabled,mi.alphaBlended,Ft.disabled,wt,le.id,at.particleIndexBuffer,void 0,at.particleSegment)}}}(_,b,x,$),M.bindFramebuffer.set(x.particleFramebuffer.framebuffer),function(Q,ne,le,se){const re=Q.context,ae=re.gl,ue=ne.paint.get("raster-particle-max-speed"),he=se*ne.paint.get("raster-particle-speed-factor")*.15,xe=function(Ne){return Math.pow(Ne,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),ke=ne.particleFramebuffer;re.viewport.set([0,0,ke.width,ke.height]);for(const Ne of le){const[,Fe,Ge]=Ne;re.activeTexture.set(ae.TEXTURE0+0),Fe.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),re.activeTexture.set(ae.TEXTURE0+1);const be=Ge.particleTexture0;be.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const ze=is(1,be.size[0],0,Fe.texture.size,ue,he,xe,Fe.textureOffset,Fe.scale,Fe.offset);ke.colorAttachment.set(Ge.particleTexture1.texture),re.clear({color:o.am.transparent}),Q.getOrCreateProgram("rasterParticleUpdate",{defines:Fe.defines}).draw(Q,ae.TRIANGLES,_t.disabled,Gt.disabled,mi.unblended,Ft.disabled,ze,ne.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments)}}(_,x,$,q)}(l,t,a,u),l.renderPass==="translucent"&&(function(_,b,x,T,M){const I=_.context,C=I.gl,z=b.getSource().tileSize,O=5*(1-o.af(o.cx,o.cx+1,_.transform.zoom))*z+x.paint.get("raster-particle-elevation"),N=!_.options.moving,$=_.transform.projection.name==="globe";if(!T.length)return;const[U,q]=_.stencilConfigForOverlap(T),Q=[];$&&Q.push("PROJECTION_GLOBE_VIEW");const ne=_.stencilModeFor3D();for(const le of q){const se=le.toUnwrapped(),re=b.getTile(le);if(!re.rasterParticleState)continue;const ae=re.rasterParticleState,ue=100;re.registerFadeDuration(ue);const he=b.findLoadedParent(le,0),xe=$s(re,he,b,_.transform,ue);let ke,Ne;_.terrain&&_.terrain.prepareDrawTile(),I.activeTexture.set(C.TEXTURE0),ae.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),he&&he.rasterParticleState?(he.rasterParticleState.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ke=Math.pow(2,he.tileID.overscaledZ-re.tileID.overscaledZ),Ne=[re.tileID.canonical.x*ke%1,re.tileID.canonical.y*ke%1]):ae.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const Fe=$?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(se,N),Ge=_.transform,be=Kf(Ge),ze=o.dn(le.canonical),fe=o.dp(ze.getCenter().lat);let je,Pe,Je,at,$e;$?(je=Float32Array.from(o.bh(o.dr(le.canonical))),Pe=Float32Array.from(Ge.globeMatrix),Je=Float32Array.from(o.dm(Ge)),at=[o.aD(Ge.center.lng),o.aH(Ge.center.lat)],$e=Float32Array.from(o.dq(le.canonical,ze,fe,Ge.worldSize/Ge._pixelsPerMercatorPixel))):(je=new Float32Array(16),Pe=new Float32Array(9),Je=new Float32Array(16),at=[0,0],$e=new Float32Array(9));const it=Us(Fe,je,Pe,Je,$e,Ne||[0,0],o.ah(_.transform.zoom),at,be,ke||1,xe,O),wt=_.isTileAffectedByFog(le),bt=_.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:wt});if(_.uploadCommonUniforms(I,bt,se),$){const ft=new _t(C.LEQUAL,_t.ReadOnly,_.depthRangeFor3D),Et=0,Dt=_.globeSharedBuffers;if(Dt){const[Rt,Jt,si]=Dt.getGridBuffers(fe,Et!==0);bt.draw(_,C.TRIANGLES,ft,ne,mi.alphaBlended,_.renderElevatedRasterBackface?Ft.frontCCW:Ft.backCCW,it,x.id,Rt,Jt,si)}}else{const ft=_.depthModeForSublayer(0,_t.ReadOnly),Et=U[le.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:Rt,tileBoundsSegments:Jt}=_.getTileBoundsBuffers(re);bt.draw(_,C.TRIANGLES,ft,Et,mi.alphaBlended,Ft.disabled,it,x.id,Dt,Rt,Jt)}}_.resetStencilClippingMasks()}(l,t,a,u),l.style.map.triggerRepaint())},background:function(l,t,a,u){const p=a.paint.get("background-color"),f=a.paint.get("background-color-use-theme").constantOr("default")==="none",_=a.paint.get("background-opacity"),b=a.paint.get("background-emissive-strength"),x=a.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const T=l.context,M=T.gl,I=l.transform,C=I.tileSize,z=a.paint.get("background-pattern");let O;if(z!==void 0&&(z===null||(O=l.imageManager.getPattern(o.I.from(z.toString()),a.scope,l.style.getLut(a.scope)),!O)))return;const N=!z&&p.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==N)return;const $=Gt.disabled,U=l.depthModeForSublayer(0,N==="opaque"?_t.ReadWrite:_t.ReadOnly),q=l.colorModeForDrapableLayerRenderPass(b),Q=z?"backgroundPattern":"background";let ne,le=u;if(le||(ne=l.getBackgroundTiles(),le=Object.values(ne).map(se=>se.tileID)),z&&(T.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context,a.scope)),x){const se=l.getOrCreateProgram(Q,{overrideFog:!1,overrideRtt:!0}),re=new Float32Array(o.bx([])),ae=new o.aM(0,0,0,0,0),ue=z?xp(re,b,_,l,0,a.scope,O,x,{tileID:ae,tileSize:C}):vp(re,b,_,p.toPremultipliedRenderColor(f?null:a.lut));se.draw(l,M.TRIANGLES,U,$,q,Ft.disabled,ue,a.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const se of le){const re=l.isTileAffectedByFog(se),ae=l.getOrCreateProgram(Q,{overrideFog:re}),ue=se.toUnwrapped(),he=u?se.projMatrix:l.transform.calculateProjMatrix(ue);l.prepareDrawTile();const xe=t?t.getTile(se):ne?ne[se.key]:new Ms(se,C,I.zoom,l),ke=z?xp(he,b,_,l,0,a.scope,O,x,{tileID:se,tileSize:C}):vp(he,b,_,p.toPremultipliedRenderColor(f?null:a.lut));l.uploadCommonUniforms(T,ae,ue);const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:Fe,tileBoundsSegments:Ge}=l.getTileBoundsBuffers(xe);ae.draw(l,M.TRIANGLES,U,$,q,Ft.disabled,ke,a.id,Ne,Fe,Ge)}},sky:function(l,t,a){const u=l._atmosphere?o.ah(l.transform.zoom):1,p=a.paint.get("sky-opacity")*u;if(p===0)return;const f=l.context,_=a.paint.get("sky-type"),b=new _t(f.gl.LEQUAL,_t.ReadOnly,[0,1]),x=l.frameCounter/1e3%1;_==="atmosphere"?l.renderPass==="offscreen"?a.needsSkyboxCapture(l)&&(function(T,M,I,C){const z=T.context,O=z.gl;let N=M.skyboxFbo;if(!N){N=M.skyboxFbo=z.createFramebuffer(32,32,!0,null),M.skyboxGeometry=new sc(z),M.skyboxTexture=z.gl.createTexture(),O.bindTexture(O.TEXTURE_CUBE_MAP,M.skyboxTexture),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,O.LINEAR);for(let Q=0;Q<6;++Q)O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,O.RGBA,32,32,0,O.RGBA,O.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(N.framebuffer),z.viewport.set([0,0,32,32]);const $=M.getCenter(T,!0),U=T.getOrCreateProgram("skyboxCapture"),q=new Float64Array(16);o.bx(q),o.e3(q,q,.5*-Math.PI),rs(T,M,U,q,$,0),o.bx(q),o.e3(q,q,.5*Math.PI),rs(T,M,U,q,$,1),o.bx(q),o.cG(q,q,.5*-Math.PI),rs(T,M,U,q,$,2),o.bx(q),o.cG(q,q,.5*Math.PI),rs(T,M,U,q,$,3),o.bx(q),rs(T,M,U,q,$,4),o.bx(q),o.e3(q,q,Math.PI),rs(T,M,U,q,$,5),z.viewport.set([0,0,T.width,T.height])}(l,a),a.markSkyboxValid(l)):l.renderPass==="sky"&&function(T,M,I,C,z){const O=T.context,N=O.gl,$=T.transform,U=T.getOrCreateProgram("skybox");O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_CUBE_MAP,M.skyboxTexture);const q=((Q,ne,le,se,re)=>({u_matrix:Q,u_sun_direction:ne,u_cubemap:0,u_opacity:se,u_temporal_offset:re}))($.skyboxMatrix,M.getCenter(T,!1),0,C,z);T.uploadCommonUniforms(O,U),U.draw(T,N.TRIANGLES,I,Gt.disabled,T.colorModeForRenderPass(),Ft.backCW,q,"skybox",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(l,a,b,p,x):_==="gradient"&&l.renderPass==="sky"&&function(T,M,I,C,z){const O=T.context,N=O.gl,$=T.transform,U=T.getOrCreateProgram("skyboxGradient");M.skyboxGeometry||(M.skyboxGeometry=new sc(O)),O.activeTexture.set(N.TEXTURE0);let q=M.colorRampTexture;q||(q=M.colorRampTexture=new o.T(O,M.colorRamp,N.RGBA8)),q.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Q=((ne,le,se,re,ae)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:le,u_radius:o.al(se),u_opacity:re,u_temporal_offset:ae}))($.skyboxMatrix,M.getCenter(T,!1),M.paint.get("sky-gradient-radius"),C,z);T.uploadCommonUniforms(O,U),U.draw(T,N.TRIANGLES,I,Gt.disabled,T.colorModeForRenderPass(),Ft.backCW,Q,"skyboxGradient",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(l,a,b,p,x)},custom:function(l,t,a,u){const p=l.context,f=a.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&a.isDraped(t)){if(l.renderPass==="offscreen"){const _=f.prerender;if(_){if(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const b=l.transform.pointMerc;_.call(f,p.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.ah(l.transform.zoom),[b.x,b.y],l.transform.pixelsPerMeterRatio)}else _.call(f,p.gl,l.transform.customLayerMatrix());p.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const b=f.renderToTile;if(b){const x=u[0].canonical,T={x:x.x+u[0].wrap*(f.wrapTileId?0:1<<x.z),y:x.y,z:x.z};p.setDepthMode(_t.disabled),p.setStencilMode(Gt.disabled),p.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),b.call(f,p.gl,T),p.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(Gt.disabled);const _=f.renderingMode==="3d"?new _t(l.context.gl.LEQUAL,_t.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,_t.ReadOnly);if(p.setDepthMode(_),l.transform.projection.name==="globe"){const b=l.transform.pointMerc;f.render(p.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.ah(l.transform.zoom),[b.x,b.y],l.transform.pixelsPerMeterRatio)}else f.render(p.gl,l.transform.customLayerMatrix());p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,a,u){if(l.renderPass==="opaque")return;const p=a.paint.get("model-opacity").constantOr(1);if(p===0)return;const f=a.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!f||l.terrain&&p<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const _=l.shadowRenderer,b=a.paint.get("model-receive-shadows");_&&(_.useNormalOffset=!0,b||(_.enabled=!1));const x=()=>{_&&(_.useNormalOffset=!0,b||(_.enabled=!0))},T=t.getSource();if(l.renderPass==="light-beam"&&T.type!=="batched-model")return;if(T.type==="vector"||T.type==="geojson")return function(U,q,Q,ne,le){const se=U.transform;if(se.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${se.projection.name} projection is not yet implemented`);const re=se.getFreeCameraOptions().position;if(!U.modelManager)return;const ae=U.modelManager;Q.modelManager=ae;const ue=U.shadowRenderer;if(!Q._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const he=Q._unevaluatedLayout._values["model-id"],xe=Object.assign({},Q.layout.get("model-id").parameters),ke=U.style.order.indexOf(Q.fqid);for(const Ne of ne){const Fe=q.getTile(Ne).getBucket(Q);if(!Fe||Fe.projection.name!==se.projection.name)continue;const Ge=Fe.getModelUris();Ge&&!Fe.modelsRequested&&(ae.addModelsFromBucket(Ge,le),Fe.modelsRequested=!0);const be=zh(Ne,se);xe.zoom=be;const ze=he.possiblyEvaluate(xe);if(ve(U,Fe,Ne),$r.shadowUniformsInitialized=!1,$r.useSingleShadowCascade=!!ue&&ue.getMaxCascadeForTile(Ne.toUnwrapped())===0,U.renderPass==="shadow"&&ue){if(U.currentShadowCascade===1&&Fe.isInsideFirstShadowMapFrustum)continue;const Pe=se.calculatePosMatrix(Ne.toUnwrapped(),se.worldSize);if($r.tileMatrix.set(Pe),$r.shadowTileMatrix=Float32Array.from(ue.calculateShadowPassMatrixFromMatrix(Pe)),$r.aabb.min.fill(0),$r.aabb.max[0]=$r.aabb.max[1]=o.aj,$r.aabb.max[2]=0,ig(Fe,$r,U,Q.scope))continue}const fe=1<<Ne.canonical.z,je=[((re.x-Ne.wrap)*fe-Ne.canonical.x)*o.aj,(re.y*fe-Ne.canonical.y)*o.aj,re.z*fe*o.aj];U.conflationActive&&Object.keys(Fe.instancesPerModel).length>0&&U.style.isLayerClipped(Q,q.getSource())&&Fe.updateReplacement(Ne,U.replacementSource,ke,le)&&(Fe.uploaded=!1,Fe.upload(U.context));for(let Pe in Fe.instancesPerModel){const Je=Fe.instancesPerModel[Pe];Je.features.length>0&&(Pe=ze.evaluate(Je.features[0].feature,{}));const at=ae.getModel(Pe,le);if(at||ae.hasURLBeenRequested(Pe)||Fe.modelUris.includes(Pe)||(Fe.modelUris.push(Pe),Fe.modelsRequested=!1),at&&at.uploaded)for(const $e of at.nodes)Lh(U,Q,$e,Je,je,Ne,$r)}}}(l,t,a,u,T.type==="vector"?a.scope:""),void x();if(!T.loaded())return;if(T.type==="batched-model")return function(U,q,Q,ne){Q.resetLayerRenderingStats(U);const le=U.context,se=U.transform,re=U.style.fog,ae=U.shadowRenderer;if(se.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${se.projection.name} projection is not yet implemented`);const ue=U.transform.getFreeCameraOptions().position,he=o.bY([],[ue.x,ue.y,ue.z],U.transform.worldSize),xe=o.eb([],he),ke=o.bx([]),Ne=o.ec(se.center.lat,se.zoom),Fe=o.bn([],[1,1,1/Ne]);o.bo(ke,ke,xe);const Ge=Q.paint.get("model-opacity").constantOr(1),be=new _t(le.gl.LEQUAL,_t.ReadWrite,U.depthRangeFor3D),ze=new _t(le.gl.LEQUAL,_t.ReadOnly,U.depthRangeFor3D),fe=new o.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),je=U.renderPass==="shadow",Pe=je&&ae?ae.getCurrentCascadeFrustum():se.getFrustum(se.scaleZoom(se.worldSize)),Je=Q.paint.get("model-front-cutoff"),at=Je[2]<1,$e=Qr(U,Q.paint.get("model-cutoff-fade-range")),it=Q.getLayerRenderingStats();(function(wt,bt,ft,Et){const Dt=wt.terrain?wt.terrain.exaggeration():0,Rt=wt.transform.zoom;for(const Jt of Et){const si=bt.getTile(Jt).getBucket(ft);si&&(si.setFilter(ft.filter),wt.conflationActive&&si.updateReplacement(Jt,wt.replacementSource),si.evaluateTransform(wt,ft),wt.terrain&&Dt>0&&si.elevationUpdate(wt.terrain,Dt,Jt,ft.source),si.needsReEvaluation(wt,Rt,ft)&&si.evaluate(ft))}})(U,q,Q,ne),function(){let wt,bt,ft;at?(wt=ne.length-1,bt=-1,ft=-1):(wt=0,bt=ne.length,ft=1);const Et=new Float64Array(16),Dt=o.ef(),Rt=new o.P(0,0);for(let Jt=wt;Jt!==bt;Jt+=ft){const si=ne[Jt],Ni=q.getTile(si).getBucket(Q);if(!Ni||!Ni.uploaded)continue;let an=!1;ae&&(an=ae.getMaxCascadeForTile(si.toUnwrapped())===0);const ji=se.calculatePosMatrix(si.toUnwrapped(),se.worldSize),qi=Ni.modelTraits;!je&&at&&(o.bi(Et,ji),o.ad(Dt,he,Et),Rt.x=Dt[0],Rt.y=Dt[1]);const Fn=[];Ni.setFilter(Q.filter);for(const ei of Ni.getNodesInfo()){if(ei.hiddenByReplacement||!ei.node.meshes)continue;const hi=ei.node;let vi=0;U.terrain&&hi.elevation&&(vi=hi.elevation*U.terrain.exaggeration());const un=(()=>{const zn=ei.aabb;return fe.min=[...zn.min],fe.max=[...zn.max],fe.min[2]+=vi,fe.max[2]+=vi,o.ad(fe.min,fe.min,ji),o.ad(fe.max,fe.max,ji),fe})(),Gn=ei.evaluatedScale;if(Gn[0]<=1&&Gn[1]<=1&&Gn[2]<=1&&un.intersects(Pe)===0)continue;if(!je&&at){const zn=.16666666666666666;ei.cameraCollisionOpacity=he[0]>un.min[0]&&he[0]<un.max[0]&&he[1]>un.min[1]&&he[1]<un.max[1]&&he[2]*Ne<un.max[2]&&hi.footprint&&o.bS(Rt,hi.footprint)?Math.max(ei.cameraCollisionOpacity-zn,0):Math.min(1,ei.cameraCollisionOpacity+zn)}const rn=[...ji],zi=1/o.cU(si.canonical),Dn=hi.anchor?hi.anchor[0]:0,Ti=hi.anchor?hi.anchor[1]:0;o.bo(rn,rn,[Dn*(Gn[0]-1)+ei.evaluatedTranslation[0]*zi,Ti*(Gn[1]-1)+ei.evaluatedTranslation[1]*zi,vi+ei.evaluatedTranslation[2]]),o.ci(Gn,o.eg)||o.cE(rn,rn,Gn);const jn=o.az([],rn,hi.matrix),cn=o.az([],se.expandedFarZProjMatrix,jn),Qi=o.az([],se.expandedFarZProjMatrix,rn),hn=o.aA([],[Dn,Ti,vi,1],cn)[2];hi.hidden=!1;let Ri=Ge;je||(at&&(Ri*=ei.cameraCollisionOpacity,Ri*=Ol(rn,se,ei.aabb,Je)),Ri*=ng($e,hn)),Ri!==0?Fn.push({nodeInfo:ei,depth:hn,opacity:Ri,wvpForNode:cn,wvpForTile:Qi,nodeModelMatrix:jn,tileModelMatrix:rn}):hi.hidden=!0}je||Fn.sort((ei,hi)=>!at||ei.opacity===1&&hi.opacity===1?ei.depth<hi.depth?-1:1:ei.opacity===1?-1:hi.opacity===1?1:ei.depth>hi.depth?-1:1);for(const ei of Fn){const hi=ei.nodeInfo,vi=hi.node;let un=o.az([],Fe,ei.tileModelMatrix);o.az(un,ke,un);const Gn=o.bi([],un);o.ee(Gn,Gn),o.cE(Gn,Gn,Mp),un=o.az(un,un,vi.matrix);const rn=U.renderPass==="light-beam",zi=Q.paint.get("model-color-use-theme").constantOr("default")==="none",Dn=qi&o.em.HasMapboxMeshFeatures,Ti=Dn?0:hi.evaluatedRMEA[0][2];for(let jn=0;jn<vi.meshes.length;++jn){const cn=vi.meshes[jn],Qi=jn===vi.lightMeshIndex;let hn=ei.wvpForNode;if(Qi){if(!rn&&!U.terrain&&U.shadowRenderer){U.currentLayer<U.firstLightBeamLayer&&(U.firstLightBeamLayer=U.currentLayer);continue}hn=ei.wvpForTile}else if(rn)continue;const Ri={defines:[]},zn=[];if(!je&&ae&&(ae.useNormalOffset=!!cn.normalBuffer),Qe(Ri.defines,zn,cn,U,zi?null:Q.lut),Dn||Ri.defines.push("DIFFUSE_SHADED"),an&&Ri.defines.push("SHADOWS_SINGLE_CASCADE"),it&&(je?it.numRenderedVerticesInShadowPass+=cn.vertexArray.length:it.numRenderedVerticesInTransparentPass+=cn.vertexArray.length),je){Cn(cn,ei.nodeModelMatrix,U,Q);continue}let ga=null;if(re){const Vr=qs(ei.nodeModelMatrix,U.transform);if(ga=new Float32Array(Vr),se.projection.name!=="globe"){const Mr=cn.aabb.min,qa=cn.aabb.max,[hs,Ur]=re.getOpacityForBounds(Vr,Mr[0],Mr[1],qa[0],qa[1]);Ri.overrideFog=hs>=Ce||Ur>=Ce}}const wn=cn.material;let Di;wn.occlusionTexture&&wn.occlusionTexture.offsetScale&&(Di=wn.occlusionTexture.offsetScale,Ri.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const nr=U.getOrCreateProgram("model",Ri);!je&&ae&&ae.setupShadowsFromMatrix(ei.tileModelMatrix,nr,ae.useNormalOffset),U.uploadCommonUniforms(le,nr,null,ga);const Ja=wn.pbrMetallicRoughness;Ja.metallicFactor=.9,Ja.roughnessFactor=.5;const mr=nc(new Float32Array(hn),new Float32Array(un),new Float32Array(Gn),new Float32Array(vi.matrix),U,ei.opacity,Ja.baseColorFactor,wn.emissiveFactor,Ja.metallicFactor,Ja.roughnessFactor,wn,Ti,Q,[0,0,0],Di);!Qi&&(hi.hasTranslucentParts||ei.opacity<1)&&nr.draw(U,le.gl.TRIANGLES,be,Gt.disabled,mi.disabled,Ft.backCCW,mr,Q.id,cn.vertexBuffer,cn.indexBuffer,cn.segments,Q.paint,U.transform.zoom,void 0,zn),nr.draw(U,le.gl.TRIANGLES,Qi?ze:be,Gt.disabled,Qi||ei.opacity<1||hi.hasTranslucentParts?mi.alphaBlended:mi.unblended,Ft.backCCW,mr,Q.id,cn.vertexBuffer,cn.indexBuffer,cn.segments,Q.paint,U.transform.zoom,void 0,zn)}}}}()}(l,t,a,u),void x();if(T.type!=="model")return;const M=T.getModels(),I=[],C=l.transform.getFreeCameraOptions().position,z=o.bY([],[C.x,C.y,C.z],l.transform.worldSize);o.eb(z,z);const O=[],N=[];let $=0;for(const U of M){const q=a.paint.get("model-rotation").constantOr(null),Q=a.paint.get("model-scale").constantOr(null),ne=a.paint.get("model-translation").constantOr(null);U.computeModelMatrix(l,q,Q,ne,!0,!0,!1);const le=o.bx([]),se=o.ec(U.position.lat,l.transform.zoom),re=o.bn([],[1,1,1/se]);o.bo(le,le,z),I.push({zScaleMatrix:re,negCameraPosMatrix:le});for(const ae of U.nodes)Gs(l.transform,ae,U.matrix,l.transform.expandedFarZProjMatrix,$,O,N);$++}if(O.sort((U,q)=>q.depth-U.depth),l.renderPass!=="shadow"){if(p===1)for(const U of N)mt(U,l,a,I[U.modelIndex],Gt.disabled,l.colorModeForRenderPass());else{for(const U of N)mt(U,l,a,I[U.modelIndex],Gt.disabled,mi.disabled);for(const U of N)mt(U,l,a,I[U.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const U of O)mt(U,l,a,I[U.modelIndex],Gt.disabled,l.colorModeForRenderPass());x()}else{for(const U of N)Cn(U.mesh,U.nodeModelMatrix,l,a);for(const U of O)Cn(U.mesh,U.nodeModelMatrix,l,a);x()}}},Ip={line:function(l,t,a){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const f=t.getTile(p).getBucket(l);if(f&&(f.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,a){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,u.type==="vector"?l.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const f of p)f.upload(a.context)},raster:function(l,t,a){const u=t.getSource();if(!(u instanceof Yo&&u.loaded()))return;const p=l.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const f=l.paint.get("raster-array-band")||u.getInitialBand(p);if(f==null)return;const _=t.getIds().map(b=>t.getTileByID(b));for(const b of _)b.updateNeeded(p,f)&&u.prepareTile(b,p,f)},"raster-particle":function(l,t,a){const u=t.getSource();if(!(u instanceof Yo&&u.loaded()))return;const p=l.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const f=l.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(f==null)return;const _=t.getIds().map(b=>t.getTileByID(b));for(const b of _)b.updateNeeded(p,f)&&u.prepareTile(b,p,f)}},Po={fill:Ap},cc={fill:function(l,t,a,u){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const p=l.context.gl,f=new _t(p.LEQUAL,_t.ReadOnly,l.depthRangeFor3D),_=new Gt({func:p.ALWAYS,mask:255},255,255,p.KEEP,p.KEEP,p.REPLACE),b=l.transform.getFreeCameraOptions().position,x=l.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const T of u){const M=t.getTile(T),I=M.getBucket(a);if(!I)continue;const C=I.elevatedStructures;if(!C||C.maskSegments.segments[0].primitiveLength===0)continue;const z=Ch(T.toUnwrapped(),b),O=l.translatePosMatrix(T.projMatrix,M,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),N=Th(O,z,0,0,0);x.draw(l,p.TRIANGLES,f,_,mi.disabled,Ft.disabled,N,a.id,C.vertexBuffer,C.indexBuffer,C.maskSegments,a.paint,l.transform.zoom)}}};class $l{constructor(t,a,u,p,f,_){this.context=new n1(t,a),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=f,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const b=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const T of b)this._debugParams.enabledLayers[T]=!0;f.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),f.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),f.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),f.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),f.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),f.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const T of b)f.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],T);this.occlusionParams=new ag(f),this.setup(),this.numSublayers=Va.maxUnderzooming+Va.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new By(this),this._wireframeDebugCache=new h1,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const x=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,x,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p,this.worldview=_}updateTerrain(t,a){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Xu(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,a),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=a.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const f=u+.78*(p-u);this.transform.fogCullDistSq=f*f}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Xu(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*o.q.devicePixelRatio,this.height=a*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,a=new o.ba;a.emplaceBack(0,0),a.emplaceBack(o.aj,0),a.emplaceBack(0,o.aj),a.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=t.createVertexBuffer(a,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const u=new o.ba;u.emplaceBack(0,0),u.emplaceBack(o.aj,0),u.emplaceBack(0,o.aj),u.emplaceBack(o.aj,o.aj),this.debugBuffer=t.createVertexBuffer(u,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const p=new o.ba;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const f=new o.aZ;f.emplaceBack(0,0,0,0),f.emplaceBack(o.aj,0,o.aj,0),f.emplaceBack(0,o.aj,0,o.aj),f.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(f,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const _=new o.a_;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const b=new o.bb;for(const T of[0,1,3,2,0])b.emplaceBack(T);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new o.T(t,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bz();const x=this.context.gl;this.stencilClearMode=new Gt({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,_t.disabled,this.stencilClearMode,mi.disabled,Ft.disabled,Os(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,u){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const x of u)if(this._tileClippingMaskIDs[x.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=a.id;const p=this.context,f=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(mi.disabled),p.setDepthMode(_t.disabled);const _=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of u){const x=a.getTile(b),T=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:I,tileBoundsSegments:C}=this.getTileBoundsBuffers(x);_.draw(this,f.TRIANGLES,_t.disabled,new Gt({func:f.ALWAYS,mask:0},T,255,f.KEEP,f.KEEP,f.REPLACE),mi.disabled,Ft.disabled,Os(b.projMatrix),"$clipping",M,I,C)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Gt({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new Gt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,u=t.sort((_,b)=>b.overscaledZ-_.overscaledZ),p=u[u.length-1].overscaledZ,f=u[0].overscaledZ-p+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const _={};for(let b=0;b<f;b++)_[b+p]=new Gt({func:a.GEQUAL,mask:255},b+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=f,[_,u]}return[{[p]:Gt.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new mi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mi.unblended:mi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new mi([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,u,p=!1){if(this.depthOcclusion)return new _t(this.context.gl.GREATER,_t.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return _t.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _t(u||this.context.gl.LEQUAL,a,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),f=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&u!==0&&(this.depthFBO=new kp(this.context,a,u,!1,"texture"),this.depthTexture=new o.T(this.context,{width:a,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,f),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,u,0,0,a,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,a)=>t+a/this._fpsHistory.length,0))}render(t,a){const u=o.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const p=this.style._mergedLayers,f=!(!this.terrain||!this.terrain.enabled),_=()=>this.style._getOrder(f).filter(be=>{const ze=p[be];return!(ze.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ze.type]});let b=_(),x=!1,T=!1;for(const be of b){const ze=p[be];ze.type==="circle"&&(x=!0),ze.type==="symbol"&&(ze.hasInitialOcclusionOpacityProperties?T=!0:x=!0)}let M=b.map(be=>p[be]);const I=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let C=0,z=!1;for(const be in I){const ze=I[be];ze.used&&(ze.prepare(this.context),ze.getSource().usedInConflation&&++C)}let O=!1;for(const be of M)be.isHidden(this.transform.zoom)||(be.type==="clip"&&(O=!0),this.prepareLayer(be));const N={},$={},U={},q={},Q={};for(const be in I){const ze=I[be];N[be]=ze.getVisibleCoordinates(),$[be]=N[be].slice().reverse(),U[be]=ze.getVisibleCoordinates(!0).reverse(),q[be]=ze.getShadowCasterCoordinates(),Q[be]=ze.sortCoordinatesByDistance(N[be])}const ne=be=>{const ze=this.style.getLayerSourceCache(be);return ze&&ze.used?ze.getSource():null};if(C||O||this._clippingActiveLastFrame){const be=[],ze=[];let fe=0;for(const je of M)this.isSourceForClippingOrConflation(je,ne(je))&&(be.push(je),ze.push(fe)),fe++;if(be&&(O||be.length>1)||this._clippingActiveLastFrame){O=!1;const je=[];for(let Pe=0;Pe<be.length;Pe++){const Je=be[Pe],at=ze[Pe],$e=this.style.getLayerSourceCache(Je);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Je.type!=="clip")continue;let it=o.eu,wt=o.bQ.None;const bt=[];let ft=!0;if(Je.type==="clip"){it=at;for(const Et of Je.layout.get("clip-layer-types"))wt|=Et==="model"?o.bQ.Model:Et==="symbol"?o.bQ.Symbol:o.bQ.FillExtrusion;for(const Et of Je.layout.get("clip-layer-scope"))bt.push(Et);Je.isHidden(this.transform.zoom)?ft=!1:O=!0}ft&&je.push({layer:Je.fqid,cache:$e,order:it,clipMask:wt,clipScope:bt})}this.replacementSource.setSources(je),z=!0}}this._clippingActiveLastFrame=O,z||this.replacementSource.clear(),this.conflationActive=z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let be=0;be<M.length;be++){const ze=M[be],fe=ze.cutoffRange();if(this.longestCutoffRange=Math.max(fe,this.longestCutoffRange),fe>0){const je=ne(ze);je&&(this.minCutoffZoom=Math.max(je.minzoom,this.minCutoffZoom)),ze.minzoom&&(this.minCutoffZoom=Math.max(ze.minzoom,this.minCutoffZoom))}ze.is3D(f)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=be),this._lastOcclusionLayer=be)}const le=this.style&&this.style.fog;le?(this._fogVisible=le.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=le.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0,b=_(),M=b.map(be=>p[be]));const se=this._shadowRenderer;if(se){se.updateShadowParameters(this.transform,this.style.directionalLight);for(const be in I)for(const ze of N[be]){let fe={min:0,max:0};this.terrain&&(fe=this.terrain.getMinMaxForTile(ze)||fe),se.addShadowReceiver(ze.toUnwrapped(),fe.min,fe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Fl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const re=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(re&&!this._snow&&(this._snow=new yn(this)),!re&&this._snow&&(this._snow.destroy(),delete this._snow),ae&&!this._rain&&(this._rain=new d1(this)),!ae&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!po.has(this.context.gl))return;this.renderPass="offscreen";for(const be of M){const ze=t.getLayerSourceCache(be);if(!be.hasOffscreenPass()||be.isHidden(this.transform.zoom))continue;const fe=ze?$[ze.id]:void 0;(be.type==="custom"||be.type==="raster"||be.type==="raster-particle"||be.isSky()||fe&&fe.length)&&this.renderLayer(this,ze,be,fe)}this.depthRangeFor3D=[0,1-(M.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,q)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ue=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),he=(()=>{if(a.showOverdrawInspector)return o.am.black;const be=this.style.fog;if(be&&this.transform.projection.supportsFog){const ze=this.style.getLut(be.scope);if(!ue){const fe=be.properties.get("color-use-theme")==="none",je=be.properties.get("color").toNonPremultipliedRenderColor(fe?null:ze).toArray01();return new o.am(...je)}if(ue){const fe=be.properties.get("space-color-use-theme")==="none",je=be.properties.get("space-color").toNonPremultipliedRenderColor(fe?null:ze).toArray01();return new o.am(...je)}}return o.am.transparent})();if(this.context.clear({color:he,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const be=M[this.currentLayer],ze=t.getLayerSourceCache(be);if(be.isSky())continue;const fe=ze?(be.is3D(f)?Q:$)[ze.id]:void 0;this._renderTileClippingMasks(be,ze,fe),this.renderLayer(this,ze,be,fe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const be=M[this.currentLayer],ze=t.getLayerSourceCache(be);be.isSky()&&this.renderLayer(this,ze,be,ze?$[ze.id]:void 0)}function xe(be,ze){let fe;return ze&&(fe=(be.type==="symbol"?U:be.is3D(f)?Q:$)[ze.id]),fe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<b.length;){const be=M[this.currentLayer];if(be.type==="raster"||be.type==="raster-particle"){const ze=t.getLayerSourceCache(be);this.renderLayer(this,ze,be,xe(be,ze))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ke=0;se&&(ke=se.getShadowCastingLayerCount());let Ne=!1,Fe=-1;for(let be=0;be<b.length;++be){const ze=M[be];ze.isHidden(this.transform.zoom)||ze.is3D(f)&&(Fe=be)}T&&Fe===-1&&(x=!0);let Ge=!1;for(;this.currentLayer<b.length;){const be=M[this.currentLayer],ze=t.getLayerSourceCache(be);if(be.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(be)){if(be.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ge&&be.is3D(f)&&!f){const fe=this.currentLayer,je=Pe=>{for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Je=M[this.currentLayer];if(Po[Je.type]){const at=this.style.getLayerSourceCache(Je);Po[Je.type](this,at,Je,xe(Je,at),Pe)}}};je("initialize"),je("reset"),this.currentLayer=fe,Ge=!0}if(x&&!Ne&&this.terrain&&!this.transform.isOrthographic&&(Ne=!0,this.blitDepth()),T&&Fe!==-1&&this.currentLayer===Fe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(be,ze,ze?N[ze.id]:void 0),this.renderLayer(this,ze,be,xe(be,ze)),!this.terrain&&se&&ke>0&&be.hasShadowPass()&&--ke==0){{this.clearStencil();const fe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const je=M[this.currentLayer];if(cc[je.type]){const Pe=this.style.getLayerSourceCache(je);cc[je.type](this,Pe,je,xe(je,Pe))}}this.currentLayer=fe}if(se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const fe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=fe;this.currentLayer++){const je=M[this.currentLayer];if(!je.hasLightBeamPass())continue;const Pe=t.getLayerSourceCache(je);this.renderLayer(this,Pe,je,Pe?$[Pe.id]:void 0)}this.currentLayer=fe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const fe=this.currentLayer;this.depthOcclusion=!0;for(const je of this.layersWithOcclusionOpacity){this.currentLayer=je;const Pe=M[this.currentLayer],Je=t.getLayerSourceCache(Pe),at=Je?$[Je.id]:void 0;this.terrain||this._renderTileClippingMasks(Pe,Je,Je?N[Je.id]:void 0),this.renderLayer(this,Je,Pe,at)}this.depthOcclusion=!1,this.currentLayer=fe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let be=null;M.forEach(ze=>{const fe=t.getLayerSourceCache(ze);fe&&!ze.isHidden(this.transform.zoom)&&fe.getVisibleCoordinates().length&&(!be||be.getSource().maxzoom<fe.getSource().maxzoom)&&(be=fe)}),be&&this.options.showTileBoundaries&&So(this,be,be.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&So(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(be){const ze=be.transform.padding;Dh(be,be.transform.height-(ze.top||0),3,s1),Dh(be,ze.bottom||0,3,l1),Ih(be,ze.left||0,3,ir),Ih(be,be.transform.width-(ze.right||0),3,Pp);const fe=be.transform.centerPoint;(function(je,Pe,Je,at){Nl(je,Pe-1,Je-10,2,20,at),Nl(je,Pe-10,Je-1,20,2,at)})(be,fe.x,be.transform.height-fe.y,Wa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),z||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,u=!a||!a.includes(t.type);if(Ip[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);Ip[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,a,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Ei[u.type](t,a,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(a.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,u=a.createQuery();this.deferredRenderGpuTimeQueries.push(u),a.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const u in t){const p=t[u],f=this.context.extTimerQuery,_=f.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;f.deleteQueryEXT(p.query),a[u]=_}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let u=0;for(const p of t)u+=a.getQueryParameter(p,a.QUERY_RESULT)/1e6,a.deleteQuery(p);return u}translatePosMatrix(t,a,u,p,f){if(!u[0]&&!u[1])return t;const _=f?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(_){const T=Math.sin(_),M=Math.cos(_);u=[u[0]*M-u[1]*T,u[0]*T+u[1]*M]}const b=[f?u[0]:o.aw(a,u[0],this.transform.zoom),f?u[1]:o.aw(a,u[1],this.transform.zoom),0],x=new Float32Array(16);return o.bo(x,t,b),x}saveTileTexture(t){const a=t.size[0],u=this._tileTextures[a];u?u.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,f=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(f.push("LIGHTING_3D_MODE"),f.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||f.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||f.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(f.push("TERRAIN"),this.linearFloatFilteringSupported()&&f.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&f.push("GLOBE"),!this._fogVisible||p||a!==void 0&&!a||f.push("FOG","FOG_DITHERING"),p&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}getOrCreateProgram(t,a){this.cache=this.cache||{};const u=a&&a.defines||[],p=a&&a.config,f=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(u),_=Sh.cacheKey(dh[t],t,f,p);return this.cache[_]||(this.cache[_]=new Sh(this.context,t,dh[t],p,qf[t],f)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const f=((_,b,x)=>{const T=_.properties.get("direction"),M=_.properties.get("color-use-theme")==="none",I=_.properties.get("color").toNonPremultipliedRenderColor(M?null:x.getLut(_.scope)).toArray01(),C=_.properties.get("intensity"),z=b.properties.get("color-use-theme")==="none",O=b.properties.get("color").toNonPremultipliedRenderColor(z?null:x.getLut(b.scope)).toArray01(),N=b.properties.get("intensity"),$=[T.x,T.y,T.z],U=o.dw(O,N),q=o.dw(I,C);return{u_lighting_ambient_color:U,u_lighting_directional_dir:$,u_lighting_directional_color:q,u_ground_radiance:Ah($,q,U)}})(u,p,this.style);a.setLightsUniformValues(t,f)}}}uploadCommonUniforms(t,a,u,p,f){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const b=_.getOpacity(this.transform.pitch),x=((T,M,I,C,z,O,N,$,U,q,Q,ne)=>{const le=T.transform,se=M.properties.get("color-use-theme")==="none",re=M.properties.get("color").toNonPremultipliedRenderColor(se?null:T.style.getLut(M.scope)).toArray01();re[3]=C;const ae=T.frameCounter/1e3%1,[ue,he]=M.properties.get("vertical-range");return{u_fog_matrix:I?le.calculateFogTileMatrix(I):ne||T.identityMat,u_fog_range:M.getFovAdjustedRange(le._fov),u_fog_color:re,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ue,he),he],u_fog_temporal_offset:ae,u_frustum_tl:z,u_frustum_tr:O,u_frustum_br:N,u_frustum_bl:$,u_globe_pos:U,u_globe_radius:q,u_viewport:Q,u_globe_transition:o.ah(le.zoom),u_is_globe:+(le.projection.name==="globe")}})(this,_,u,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],p);a.setFogUniformValues(t,x)}f&&a.setCutoffUniformValues(t,f.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)a[p.key]=t[p.key]||new Ms(p,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=Ce||a[1]>=Ce}setupDepthForOcclusion(t,a,u){const p=this.context,f=p.gl,_=!!u;var b;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(f.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((b=this.depthRangeFor3D)[1]-b[0]),-1-2*b[0]/(b[1]-b[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),p.activeTexture.set(f.TEXTURE0),_||a.setTerrainUniformValues(p,u)}}function ss(l,t){let a=!1,u=null;const p=()=>{u=null,a&&(l(),u=setTimeout(p,t),a=!1)};return()=>(a=!0,u||p(),u)}class zp{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ss(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=Wh(t);if(this._hashName){const u=this._hashName;let p=!1;const f=location.hash.slice(1).split("&").map(_=>{const b=_.split("=")[0];return b===u?(p=!0,`${b}=${a}`):_}).filter(_=>_);return p||f.push(`${u}=${a}`),`#${f.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(a=u)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(u=>isNaN(Number(u)))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wh(l,t){const a=l.getCenter(),u=Math.round(100*l.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,p),_=Math.round(a.lng*f)/f,b=Math.round(a.lat*f)/f,x=l.getBearing(),T=l.getPitch();let M=t?`/${_}/${b}/${u}`:`${u}/${b}/${_}`;return(x||T)&&(M+="/"+Math.round(10*x)/10),T&&(M+=`/${Math.round(T)}`),M}const jl={linearity:.3,easing:o.ew(0,0,.3,1)},Lp=o.h({deceleration:2500,maxSpeed:1400},jl),to=o.h({deceleration:20,maxSpeed:1400},jl),ls=o.h({deceleration:1e3,maxSpeed:360},jl),hc=o.h({deceleration:1e3,maxSpeed:90},jl);class Nh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=o.q.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)a.zoom+=f.zoomDelta||0,a.bearing+=f.bearingDelta||0,a.pitch+=f.pitchDelta||0,f.panDelta&&a.pan._add(f.panDelta),f.around&&(a.around=f.around),f.pinchAround&&(a.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const f=Ul(a.pan.mag(),u,o.h({},Lp,t||{}));p.offset=a.pan.mult(f.amount/a.pan.mag()),p.center=this._map.transform.center,Vl(p,f)}if(a.zoom){const f=Ul(a.zoom,u,to);p.zoom=this._map.transform.zoom+f.amount,Vl(p,f)}if(a.bearing){const f=Ul(a.bearing,u,ls);p.bearing=this._map.transform.bearing+o.ay(f.amount,-179,179),Vl(p,f)}if(a.pitch){const f=Ul(a.pitch,u,hc);p.pitch=this._map.transform.pitch+f.amount,Vl(p,f)}if(p.zoom||p.bearing){const f=a.pinchAround===void 0?a.around:a.pinchAround;p.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Vl(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Ul(l,t,a){const{maxSpeed:u,linearity:p,deceleration:f}=a,_=o.ay(l*p/(t/1e3),-u,u),b=Math.abs(_)/(f*p);return{easing:a.easing,duration:1e3*b,amount:_*(b/2)}}class ma extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u,p={}){const f=ri(a.getCanvasContainer(),u),_=a.unproject(f);super(t,o.h({point:f,lngLat:_,originalEvent:u},p)),this._defaultPrevented=!1,this.target=a}}class Jl extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){const p=t==="touchend"?u.changedTouches:u.touches,f=oi(a.getCanvasContainer(),p),_=f.map(x=>a.unproject(x)),b=f.reduce((x,T,M,I)=>x.add(T.div(I.length)),new o.P(0,0));super(t,{points:f,point:b,lngLats:_,lngLat:a.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class us extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Rp{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new us(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new ma(t.type,this._map,t))}mouseup(t){this._map.fire(new ma(t.type,this._map,t))}preclick(t){const a=o.h({},t);a.type="preclick",this._map.fire(new ma(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ma(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ma(t.type,this._map,t))}mouseover(t){this._map.fire(new ma(t.type,this._map,t))}mouseout(t){this._map.fire(new ma(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Jl(t.type,this._map,t))}touchmove(t){this._map.fire(new Jl(t.type,this._map,t))}touchend(t){this._map.fire(new Jl(t.type,this._map,t))}touchcancel(t){this._map.fire(new Jl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ma(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ma("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ma(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bp{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(vt(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a,p=this._startPos,f=this._lastPos;if(!p||!f||f.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=He("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(p.x,u.x),b=Math.max(p.x,u.x),x=Math.min(p.y,u.y),T=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${x}px)`,this._box.style.width=b-_+"px",this._box.style.height=T-x+"px")})}mouseupWindow(t,a){if(!this._active)return;const u=this._startPos,p=a;if(u&&t.button===0){if(this.reset(),ti(),u.x!==p.x||u.y!==p.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ot(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new o.A(t,{originalEvent:a}))}}function dc(l,t){const a={};for(let u=0;u<l.length;u++)a[l[u].identifier]=t[u];return a}class fa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const f=new o.P(0,0);for(const _ of p)f._add(_);return f.div(p.length)}(a),this.touches=dc(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const p=dc(u,a);for(const f in this.touches){const _=p[f];(!_||_.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class pc{constructor(t){this.singleTap=new fa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const p=this.singleTap.touchend(t,a,u);if(p){const f=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(p)<30;if(f&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Wp{constructor(){this._zoomIn=new pc({numTouches:1,numTaps:2}),this._zoomOut=new pc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const p=this._zoomIn.touchend(t,a,u),f=this._zoomOut.touchend(t,a,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(p)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Np={0:1,2:2},cs={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class mc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const u=Yt(t);this._correctButton(t,u)&&(this._lastPoint=a,this._eventButton=u)}mousemoveWindow(t,a){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,f){const _=Np[f];return p.buttons===void 0||(p.buttons&_)!==_}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(u,a)}}mouseupWindow(t){this._lastPoint&&Yt(t)===this._eventButton&&(this._moved&&ti(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fp extends mc{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Oh extends mc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?cs[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const u=.8*(a.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Hs extends mc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?cs[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const u=-.5*(a.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Op{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!o.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,u)}}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const p=dc(u,a),f=new o.P(0,0),_=new o.P(0,0);let b=0;for(const T in p){const M=p[T],I=this._touches[T];I&&(f._add(M),_._add(M.sub(I)),b++,p[T]=M)}if(this._touches=p,b<this._minTouches||!_.mag())return;const x=_.div(b);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(b),panDelta:x}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=He("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class fc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,u){return{}}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[f,_]=p,b=ql(u,a,f),x=ql(u,a,_);if(!b||!x)return;const T=this._aroundCenter?null:b.add(x).div(2);return this._move([b,x],T,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[p,f]=this._firstTwoTouches,_=ql(u,a,p),b=ql(u,a,f);_&&b||(this._active&&ti(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ql(l,t,a){for(let u=0;u<l.length;u++)if(l[u].identifier===a)return t[u]}function gc(l,t){return Math.log(l/t)/Math.LN2}class $p extends fc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(gc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gc(this._distance,u),pinchAround:a}}}function $h(l,t){return 180*l.angleWith(t)/Math.PI}class og extends fc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$h(this._vector,u),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=$h(t,u);return Math.abs(p)<a}}function jh(l){return Math.abs(l.y)>Math.abs(l.x)}class sg extends fc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,jh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){const p=this._lastPoints;if(!p)return;const f=t[0].sub(p[0]),_=t[1].sub(p[1]);return this._map._cooperativeGestures&&!o.ex()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(f,_,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5})}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,f=a.mag()>=2;if(!p&&!f)return;if(!p||!f)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const _=t.y>0==a.y>0;return jh(t)&&jh(a)&&_}}const lg={panStep:100,bearingStep:15,pitchStep:10};class ug{constructor(){const t=lg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,p=0,f=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:b=>{const x=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:cg,zoom:a?Math.round(x)+a*(t.shiftKey?2:1):x,bearing:b.getBearing()+u*this._bearingStep,pitch:b.getPitch()+p*this._pitchStep,offset:[-f*this._panStep,-_*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cg(l){return l*(2-l)}const jp=4.000244140625,hg=1/450;class dg{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=hg,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=o.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%jp==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ri(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>jp?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&M!==0&&(M=1/M);const I=a(),C=Math.pow(2,I),z=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):C;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(z*M))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:a(),p=this._startZoom,f=this._easing;let _,b=!1;if(this._type==="wheel"&&p&&f){const T=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),M=f(T);_=o.ai(p,u,M),T<1?this._frameId||(this._frameId=!0):b=!0}else _=u,b=!0;this._active=!0,b&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let x=_-a();return x*this._lastDelta<0&&(x=0),{noInertia:!0,needsRenderFrame:!b,zoomDelta:x,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=o.ey;if(this._prevEase){const u=this._prevEase,p=(o.q.now()-u.start)/u.duration,f=u.easing(p+.01)-u.easing(p),_=.27/Math.sqrt(f*f+1e-4)*.01,b=Math.sqrt(.0729-_*_);a=o.ew(_,b,.25,1)}return this._prevEase={start:o.q.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=He("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class pg{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fg{constructor(){this._tap=new pc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=a[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,a,u))}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=a[0],f=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,a,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gg{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class p1{constructor(t,a,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class m1{constructor(t,a,u,p){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vh=l=>l.zoom||l.drag||l.pitch||l.rotate;class In extends o.A{}class _g{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const u=o.at([],a,t);this.radius=o.ae(u[2]<0?o.eA([],u,this.constants):[u[0],u[1],0])}projectRay(t){o.eA(t,t,this.constants),o.au(t,t),o.eB(t,t,this.constants);const a=o.bY([],t,this.radius);if(a[2]>0){const u=o.bY([],[0,0,1],o.bG(a,[0,0,1])),p=o.bY([],o.au([],[a[0],a[1],0]),this.radius),f=o.cV([],a,o.bY([],o.at([],o.cV([],p,u),a),2));a[0]=f[0],a[1]=f[1]}return a}}function Uh(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Vp{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nh(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new _g,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),o.aV(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,f,_]of this._listeners){const b=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(f,b,_)}}destroy(){for(const[t,a,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,p,u)}}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new Rp(a,t));const p=a.boxZoom=new Bp(a,t);this._add("boxZoom",p);const f=new Wp,_=new mg;a.doubleClickZoom=new pg(_,f),this._add("tapZoom",f),this._add("clickZoom",_);const b=new fg;this._add("tapDragZoom",b);const x=a.touchPitch=new sg(a);this._add("touchPitch",x);const T=new Oh(t),M=new Hs(t);a.dragRotate=new p1(t,T,M),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const I=new Fp(t),C=new Op(a,t);a.dragPan=new gg(u,I,C),this._add("mousePan",I),this._add("touchPan",C,["touchZoom","touchRotate"]);const z=new og,O=new $p;a.touchZoomRotate=new m1(u,O,z,b),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",O,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fh(a));const N=a.scrollZoom=new dg(a,this);this._add("scrollZoom",N,["mousePan"]);const $=a.keyboard=new ug;this._add("keyboard",$);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[U]&&a[U].enable(t[U])}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,u){for(const p in t)if(p!==u&&(!a||a.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}handleEvent(t,a){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,f={needsRenderFrame:!1},_={},b={},x=t.touches?this._getMapTouches(t.touches):void 0,T=x?oi(this._el,x):u?void 0:ri(this._el,t);for(const{handlerName:C,handler:z,allowed:O}of this._handlers){if(!z.isEnabled())continue;let N;this._blockedByActive(b,O,C)?z.reset():z[a||t.type]&&(N=z[a||t.type](t,T,x),this.mergeHandlerResult(f,_,N,C,p),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||z.isActive())&&(b[C]=z)}const M={};for(const C in this._previousActiveHandlers)b[C]||(M[C]=p);this._previousActiveHandlers=b,(Object.keys(M).length||Uh(f))&&(this._changes.push([f,_,M]),this._triggerRenderFrame()),(Object.keys(b).length||Uh(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:I}=f;I&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],I(this._map))}mergeHandlerResult(t,a,u,p,f){if(!u)return;o.h(t,u);const _={handlerName:p,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(a.zoom=_),u.panDelta!==void 0&&(a.drag=_),u.pitchDelta!==void 0&&(a.pitch=_),u.bearingDelta!==void 0&&(a.rotate=_)}_applyChanges(){const t={},a={},u={};for(const[p,f,_]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),o.h(a,f),o.h(u,_);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const p=this._map,f=p.transform,_=q=>[q.x,q.y,q.z];if((q=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!Uh(t)){const q=f.zoom;f.cameraElevationReference="sea",this._originalZoom!=null&&f._orthographicProjectionAtLowPitch&&f.projection.name!=="globe"&&f.pitch===0?(f.cameraElevationReference="ground",f.zoom=this._originalZoom):(f.recenterOnTerrain(),f.cameraElevationReference="ground"),q!==f.zoom&&this._map._update(!0)}if(f._isCameraConstrained&&p._stop(!0),!Uh(t))return void this._fireEvents(a,u,!0);let{panDelta:b,zoomDelta:x,bearingDelta:T,pitchDelta:M,around:I,aroundCoord:C,pinchAround:z}=t;f._isCameraConstrained&&(x>0&&(x=0),f._isCameraConstrained=!1),z!==void 0&&(I=z),(x||(q=>a[q]&&!this._eventsInProgress[q])("drag"))&&I&&(this._dragOrigin=_(f.pointCoordinate3D(I)),this._originalZoom=f.zoom,this._trackingEllipsoid.setup(f._camera.position,this._dragOrigin)),f.cameraElevationReference="sea",p._stop(!0),I=I||p.transform.centerPoint,T&&(f.bearing+=T),M&&(f.pitch+=M),f._updateCameraState();const O=[0,0,0];if(b)if(f.projection.name==="mercator"){const q=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(I).dir),Q=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(I.sub(b)).dir);O[0]=Q[0]-q[0],O[1]=Q[1]-q[1]}else{const q=f.pointCoordinate(I);if(f.projection.name==="globe"){b=b.rotate(-f.angle);const Q=f._pixelsPerMercatorPixel/f.worldSize;O[0]=-b.x*o.ez(o.aY(q.y))*Q,O[1]=-b.y*o.ez(f.center.lat)*Q}else{const Q=f.pointCoordinate(I.sub(b));q&&Q&&(O[0]=Q.x-q.x,O[1]=Q.y-q.y)}}const N=f.zoom,$=[0,0,0];if(x){const q=_(C||f.pointCoordinate3D(I)),Q={dir:o.au([],o.at([],q,f._camera.position))};if(Q.dir[2]<0){const ne=f.zoomDeltaToMovement(q,x);o.bY($,Q.dir,ne)}}const U=o.cV(O,O,$);f._translateCameraConstrained(U),x&&Math.abs(f.zoom-N)>1e-4&&f.recenterOnTerrain(),f.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_fireEvents(t,a,u){const p=Vh(this._eventsInProgress),f=Vh(t),_={};for(const M in t){const{originalEvent:I}=t[M];this._eventsInProgress[M]||(_[`${M}start`]=I),this._eventsInProgress[M]=t[M]}!p&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in _)this._fireEvent(M,_[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in t){const{originalEvent:I}=t[M];this._fireEvent(M,I)}const b={};let x;for(const M in this._eventsInProgress){const{handlerName:I,originalEvent:C}=this._eventsInProgress[M];this._handlersById[I].isActive()||(delete this._eventsInProgress[M],x=a[I]||C,b[`${M}end`]=x)}for(const M in b)this._fireEvent(M,b[M]);const T=Vh(this._eventsInProgress);if(u&&(p||f)&&!T){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=C=>C!==0&&-this._bearingSnap<C&&C<this._bearingSnap;M?(I(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:x})):(this._map.fire(new o.A("moveend",{originalEvent:x})),I(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new o.A(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new In("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _c extends o.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,u){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.h({offset:t},a),u)}panTo(t,a,u){return this.easeTo(o.h({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(o.h({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(o.h({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,o.h({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=o.aG.convert(t);const u=a&&a.bearing||0,p=a&&a.pitch||0,f=t.getNorthWest(),_=t.getSouthEast();return this._cameraForBounds(this.transform,f,_,u,p,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?o.h({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:o.h({},a,t)}_extendCameraOptions(t){return(t=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const u=a.max[0]-a.min[0],p=a.max[1]-a.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,u,p,f,_){const b=t.clone(),x=this._extendCameraOptions(_);b.bearing=p,b.pitch=f;const T=o.cd.convert(a),M=o.cd.convert(u),I=.5*(T.lat+M.lat),C=.5*(T.lng+M.lng),z=o.eC(I,C),O=o.au([],z),N=o.au([],o.bF([],O,[0,1,0])),$=o.bF([],N,O),U=[N[0],N[1],N[2],0,$[0],$[1],$[2],0,O[0],O[1],O[2],0,0,0,0,1],q=[z,o.eC(T.lat,T.lng),o.eC(M.lat,T.lng),o.eC(M.lat,M.lng),o.eC(T.lat,M.lng),o.eC(I,T.lng),o.eC(I,M.lng),o.eC(T.lat,C),o.eC(M.lat,C)];let Q=o.cW.fromPoints(q.map(Pe=>[o.bG(N,Pe),o.bG($,Pe),o.bG(O,Pe)]));const ne=o.ad([],Q.center,U);o.eD(ne)===0&&o.eE(ne,0,0,1),o.au(ne,ne),o.bY(ne,ne,o.aB),b.center=o.eF(ne);const le=b.getWorldToCameraMatrix(),se=o.bi(new Float64Array(16),le);Q=o.cW.applyTransform(Q,o.az([],le,U));const re=this._extendAABB(Q,b,x,p);if(!re)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Q=re,o.ad(ne,ne,le);const ae=.5*(Q.max[2]-Q.min[2]),ue=this._minimumAABBFrustumDistance(b,Q),he=o.bY([],[0,0,1],ae),xe=o.cV(he,ne,he),ke=ue+(b.pitch===0?0:o.bD(ne,xe)),Ne=b.globeCenterInViewSpace,Fe=o.at([],ne,[Ne[0],Ne[1],Ne[2]]);o.au(Fe,Fe),o.bY(Fe,Fe,ke);const Ge=o.cV([],ne,Fe);o.ad(Ge,Ge,se);const be=o.eq/o.aB,ze=o.ae(Ge),fe=o.c6(Math.max(ze*be-o.eq,Number.EPSILON),0),je=Math.min(b.zoomFromMercatorZAdjusted(fe),x.maxZoom);return je>.5*(o.cL+o.cx)?(b.setProjection({name:"mercator"}),b.zoom=je,this._cameraForBounds(b,a,u,p,f,_)):{center:b.center,zoom:je,bearing:p,pitch:f}}_extendAABB(t,a,u,p){const f=.5*((u.padding.left||0)+(u.padding.right||0)),_=.5*((u.padding.top||0)+(u.padding.bottom||0)),b=_,x=f,T=f,M=_,I=a.width-(x+T),C=a.height-(b+M),z=o.at([],t.max,t.min),O=Math.min(I/z[0],C/z[1]),N=Math.min(a.scaleZoom(a.scale*O),u.maxZoom);if(isNaN(N))return null;const $=a.scale/a.zoomScale(N),U=new o.cW([t.min[0]-x*$,t.min[1]-M*$,t.min[2]],[t.max[0]+T*$,t.max[1]+b*$,t.max[2]]),q=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new o.P(u.offset.x,u.offset.y):o.P.convert(u.offset)).rotate(-o.al(p));return U.center[0]-=q.x*$,U.center[1]+=q.y*$,U}queryTerrainElevation(t,a){const u=this.transform.elevation;return u?(a=o.h({},{exaggerated:!0},a),u.getAtPoint(o.ac.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,u,p,f,_){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,u,p,f,_);const b=t.clone(),x=this._extendCameraOptions(_);b.bearing=p,b.pitch=f;const T=o.cd.convert(a),M=o.cd.convert(u),I=new o.cd(T.lng,M.lat),C=new o.cd(M.lng,T.lat),z=b.project(T),O=b.project(M),N=this.queryTerrainElevation(T),$=this.queryTerrainElevation(M),U=this.queryTerrainElevation(I),q=this.queryTerrainElevation(C),Q=[[z.x,z.y,Math.min(N||0,$||0,U||0,q||0)],[O.x,O.y,Math.max(N||0,$||0,U||0,q||0)]];let ne=o.cW.fromPoints(Q);const le=b.getWorldToCameraMatrix(),se=o.bi(new Float64Array(16),le);ne=o.cW.applyTransform(ne,le);const re=this._extendAABB(ne,b,x,p);if(!re)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=re;const ae=.5*o.at([],ne.max,ne.min)[2],ue=this._minimumAABBFrustumDistance(b,ne),he=[0,0,1,0];o.aA(he,he,le),o.eG(he,he);const xe=o.bY([],he,ue+ae),ke=o.cV([],ne.center,xe);o.ad(ne.center,ne.center,se),o.ad(ke,ke,se);const Ne=b.unproject(new o.P(ne.center[0],ne.center[1])),Fe=o.eH(b.projection,Ne),Ge=Math.pow(2,Fe),be=Math.min(b._zoomFromMercatorZ(ke[2]*b.pixelsPerMeter*Ge/b.worldSize),x.maxZoom);return b.mercatorFromTransition&&be<.5*(o.cL+o.cx)?(b.setProjection({name:"globe"}),b.zoom=be,this._cameraForBounds(b,a,u,p,f,_)):{center:Ne,zoom:be,bearing:p,pitch:f}}fitBounds(t,a,u){const p=this.cameraForBounds(t,a);return this._fitInternal(p,a,u)}fitScreenCoordinates(t,a,u,p,f){const _=o.P.convert(t),b=o.P.convert(a),x=new o.P(Math.min(_.x,b.x),Math.min(_.y,b.y)),T=new o.P(Math.max(_.x,b.x),Math.max(_.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_,b))return this;const M=this.transform.pointLocation3D(x),I=this.transform.pointLocation3D(T),C=this.transform.pointLocation3D(new o.P(x.x,T.y)),z=this.transform.pointLocation3D(new o.P(T.x,x.y)),O=[Math.min(M.lng,I.lng,C.lng,z.lng),Math.min(M.lat,I.lat,C.lat,z.lat)],N=[Math.max(M.lng,I.lng,C.lng,z.lng),Math.max(M.lat,I.lat,C.lat,z.lat)],$=p&&p.pitch?p.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,O,N,u,$,p);return this._fitInternal(U,p,f)}_fitInternal(t,a,u){return t?(a=o.h(t,a)).linear?this.easeTo(a,u):this.flyTo(a,u):this}jumpTo(t,a){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,f=!1,_=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=o.cd.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(f=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(_=!0,u.pitch=+t.pitch);const b=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(b))if(t.retainPadding===!1){const x=u.clone();x.padding=b,u.setLocationAtPoint(u.center,x.centerPoint)}else u.padding=b;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.A("movestart",a)).fire(new o.A("move",a)),p&&this.fire(new o.A("zoomstart",a)).fire(new o.A("zoom",a)).fire(new o.A("zoomend",a)),f&&this.fire(new o.A("rotatestart",a)).fire(new o.A("rotate",a)).fire(new o.A("rotateend",a)),_&&this.fire(new o.A("pitchstart",a)).fire(new o.A("pitch",a)).fire(new o.A("pitchend",a)),this.fire(new o.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(yg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.w(yg),this;this.stop();const p=u.zoom,f=u.pitch,_=u.bearing;u.setFreeCameraOptions(t);const b=p!==u.zoom,x=f!==u.pitch,T=_!==u.bearing;return this.fire(new o.A("movestart",a)).fire(new o.A("move",a)),b&&this.fire(new o.A("zoomstart",a)).fire(new o.A("zoom",a)).fire(new o.A("zoomend",a)),T&&this.fire(new o.A("rotatestart",a)).fire(new o.A("rotate",a)).fire(new o.A("rotateend",a)),x&&this.fire(new o.A("pitchstart",a)).fire(new o.A("pitch",a)).fire(new o.A("pitchend",a)),this.fire(new o.A("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=o.h({offset:[0,0],duration:500,easing:o.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),f=this.getBearing(),_=this.getPitch(),b=this.getPadding(),x="zoom"in t?+t.zoom:p,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,M="pitch"in t?+t.pitch:_,I=this._extendPadding(t.padding),C=o.P.convert(t.offset);let z,O,N;if(u.projection.name==="globe"){const he=o.ac.fromLngLat(u.center),xe=C.rotate(-u.angle);he.x+=xe.x/u.worldSize,he.y+=xe.y/u.worldSize;const ke=he.toLngLat(),Ne=o.cd.convert(t.center||ke);this._normalizeCenter(Ne),z=u.centerPoint.add(xe),O=new o.P(he.x,he.y).mult(u.worldSize),N=new o.P(o.aD(Ne.lng),o.aH(Ne.lat)).mult(u.worldSize).sub(O)}else{z=u.centerPoint.add(C);const he=u.pointLocation(z),xe=o.cd.convert(t.center||he);this._normalizeCenter(xe),O=u.project(he),N=u.project(xe).sub(O)}const $=u.zoomScale(x-p);let U,q;t.around&&(U=o.cd.convert(t.around),q=u.locationPoint(U));const Q=this._zooming||x!==p,ne=this._rotating||f!==T,le=this._pitching||M!==_,se=!u.isPaddingEqual(I),re=t.retainPadding===!1?u.clone():u,ae=he=>xe=>{if(Q&&(he.zoom=o.ai(p,x,xe)),ne&&(he.bearing=o.ai(f,T,xe)),le&&(he.pitch=o.ai(_,M,xe)),se&&(re.interpolatePadding(b,I,xe),z=re.centerPoint.add(C)),U)he.setLocationAtPoint(U,q);else{const ke=he.zoomScale(he.zoom-p),Ne=x>p?Math.min(2,$):Math.max(.5,$),Fe=Math.pow(Ne,1-xe),Ge=he.unproject(O.add(N.mult(xe*Fe)).mult(ke));he.setLocationAtPoint(he.renderWorldCopies?Ge.wrap():Ge,z)}return t.preloadOnly||this._fireMoveEvents(a),he};if(t.preloadOnly){const he=this._emulate(ae,t.duration,u);return this._preloadTiles(he),this}const ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=ne,this._pitching=le,this._padding=se,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ue),this._ease(ae(u),he=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(a,he)},t),this}_prepareEase(t,a,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||u.moving||this.fire(new o.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new o.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new o.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new o.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.A("move",t)),this._zooming&&this.fire(new o.A("zoom",t)),this._rotating&&this.fire(new o.A("rotate",t)),this._pitching&&this.fire(new o.A("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.A("zoomend",t)),p&&this.fire(new o.A("rotateend",t)),f&&this.fire(new o.A("pitchend",t)),this.fire(new o.A("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const Pe=o.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Pe,a)}this.stop(),t=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.ey},t);const u=this.transform,p=this.getZoom(),f=this.getBearing(),_=this.getPitch(),b=this.getPadding(),x="zoom"in t?o.ay(+t.zoom,u.minZoom,u.maxZoom):p,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,M="pitch"in t?+t.pitch:_,I=this._extendPadding(t.padding),C=u.zoomScale(x-p),z=o.P.convert(t.offset);let O=u.centerPoint.add(z);const N=u.pointLocation(O),$=o.cd.convert(t.center||N);this._normalizeCenter($);const U=u.project(N),q=u.project($).sub(U);let Q=t.curve;const ne=Math.max(u.width,u.height),le=ne/C,se=q.mag();if("minZoom"in t){const Pe=o.ay(Math.min(t.minZoom,p,x),u.minZoom,u.maxZoom),Je=ne/u.zoomScale(Pe-p);Q=Math.sqrt(Je/se*2)}const re=Q*Q;function ae(Pe){const Je=(le*le-ne*ne+(Pe?-1:1)*re*re*se*se)/(2*(Pe?le:ne)*re*se);return Math.log(Math.sqrt(Je*Je+1)-Je)}function ue(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function he(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const xe=ae(0);let ke=function(Pe){return he(xe)/he(xe+Q*Pe)},Ne=function(Pe){return ne*((he(xe)*(ue(Je=xe+Q*Pe)/he(Je))-ue(xe))/re)/se;var Je},Fe=(ae(1)-xe)/Q;if(Math.abs(se)<1e-6||!isFinite(Fe)){if(Math.abs(ne-le)<1e-6)return this.easeTo(t,a);const Pe=le<ne?-1:1;Fe=Math.abs(Math.log(le/ne))/Q,Ne=function(){return 0},ke=function(Je){return Math.exp(Pe*Q*Je)}}t.duration="duration"in t?+t.duration:1e3*Fe/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ge=f!==T,be=M!==_,ze=!u.isPaddingEqual(I),fe=t.retainPadding===!1?u.clone():u,je=Pe=>Je=>{const at=Je*Fe,$e=1/ke(at);Pe.zoom=Je===1?x:p+Pe.scaleZoom($e),Ge&&(Pe.bearing=o.ai(f,T,Je)),be&&(Pe.pitch=o.ai(_,M,Je)),ze&&(fe.interpolatePadding(b,I,Je),O=fe.centerPoint.add(z));const it=Je===1?$:Pe.unproject(U.add(q.mult(Ne(at))).mult($e));return Pe.setLocationAtPoint(Pe.renderWorldCopies?it.wrap():it,O),Pe._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Pe};if(t.preloadOnly){const Pe=this._emulate(je,t.duration,u);return this._preloadTiles(Pe),this}return this._zooming=!0,this._rotating=Ge,this._pitching=be,this._padding=ze,this._prepareEase(a,!1),this._ease(je(u),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,a)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=o.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=o.bX(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const u=t.lng-a.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,u){const p=Math.ceil(15*a/1e3),f=[],_=t(u.clone());for(let b=0;b<=p;b++){const x=_(b/p);f.push(x.clone())}return f}_preloadTiles(t,a){}}class Up{constructor(t={}){this.options=t,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=He("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=He("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=He("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=He("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const u=a.reduce((p,f,_)=>(f.value&&(p+=`${f.key}=${f.value}${_<a.length-1?"&":""}`),p),"?");t.href=`${o.e.FEEDBACK_URL}/${u}#${Wh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style._mergedSourceCaches;for(const p in a){const f=a[p];if(f.used){const _=f.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort((p,f)=>p.length-f.length),t=t.filter((p,f)=>{for(let _=f+1;_<t.length;_++)if(t[_].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Jh{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=He("div","mapboxgl-ctrl");const a=He("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const u=t[a].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class yc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Mo{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=o.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,u){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+u}}const qh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class $n extends o.A{constructor(t,a,u,p){const{point:f,lngLat:_,originalEvent:b,target:x}=t;super(t.type,{point:f,lngLat:_,originalEvent:b,target:x}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=u,this.feature=p}}class io{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=a.filter;let p=a.type;u&&this.filters.set(t,o.b3(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const f=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):f.size===0&&this.map.on(p,this.handleType),f.size===0&&this.interactionsByType.set(p,f),f.set(t,a),this.typeById.set(t,p)}get(t){const a=this.typeById.get(t);if(!a)return;const u=this.interactionsByType.get(a);return u?u.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(a);u&&(u.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const u=[];for(const[p,f]of a)f.target&&u.push({targetId:p,target:f.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const u=new Map;for(const[p,{feature:f}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(f.id,f);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const u=t.type==="mouseenter";if(u&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const p=Array.from(this.interactionsByType.get(t.type)).reverse(),f=!!a;a=a||this.queryTargets(t.point,p);let _=!1;const b=new Set;for(const x of a){for(const[T,M]of p){if(!M.target)continue;const I=x.variants?x.variants[T]:null;if(I){for(const C of I){if(Zc(C,x,b,T))continue;const z=new o.de(x,C),O=Du(C,x,T);f&&(z.state=this.map.getFeatureState(z));const N=u?this.prevHoveredFeatures.get(O):null,$=new $n(t,T,M,z),U=N?N.stop:M.handler($);if(u&&this.hoveredFeatures.set(O,{feature:x,stop:U}),U!==!1){_=!0;break}}if(_)break}}if(_)break}if(!_)for(const[x,T]of p){const{handler:M,target:I}=T;if(!I&&M(new $n(t,x,T,null))!==!1)break}}}function wc(l,t){if(Array.isArray(l)&&Array.isArray(t)){const a=new Set(l),u=new Set(t);return a.size===u.size&&l.every(p=>u.has(p))}return o.bv(l,t)}const Gh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},wg={showCompass:!0,showZoom:!0,visualizePitch:!1};class f1{constructor(t,a,u=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Oh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Hs({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),vt()}move(t,a){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,a),f=p&&p.bearingDelta;if(f&&u.setBearing(u.getBearing()+f),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,a),b=_&&_.pitchDelta;b&&u.setPitch(u.getPitch()+b)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ot(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ri(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ri(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oi(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=oi(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Gl(l,t,a){if(l=new o.cd(l.lng,l.lat),t){const u=new o.cd(l.lng-360,l.lat),p=new o.cd(l.lng+360,l.lat),f=360*Math.ceil(Math.abs(l.lng-a.center.lng)/360),_=a.locationPoint3D(l).distSqr(t),b=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(u).distSqr(t)<_&&(b||Math.abs(u.lng-a.center.lng)<f)?l=u:a.locationPoint3D(p).distSqr(t)<_&&(b||Math.abs(p.lng-a.center.lng)<f)&&(l=p)}for(;Math.abs(l.lng-a.center.lng)>180;){const u=a.locationPoint3D(l);if(u.x>=0&&u.y>=0&&u.x<=a.width&&u.y<=a.height)break;l.lng>a.center.lng?l.lng-=360:l.lng+=360}return l}const Jp={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},no={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class bc extends o.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=o.h({element:t},a)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:p="#3FB1CE",scale:f=1,draggable:_=!1,clickTolerance:b=0,rotation:x=no.rotation,rotationAlignment:T=no.rotationAlignment,pitchAlignment:M=no.pitchAlignment,occludedOpacity:I=no.occludedOpacity,altitude:C=no.altitude}=t||{};this._anchor=u,this._color=p,this._scale=f,this._draggable=_,this._clickTolerance=b,this._rotation=x,this._rotationAlignment=T,this._pitchAlignment=M,this._occludedOpacity=I,this._altitude=C,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",N=>{N.preventDefault()}),this._element.addEventListener("mousedown",N=>{N.preventDefault()});const z=this._element.classList;for(const N in Jp)z.remove(`mapboxgl-marker-anchor-${N}`);z.add(`mapboxgl-marker-anchor-${this._anchor}`);const O=t&&t.className?t.className.trim().split(/\s+/):[];z.add(...O),this._popup=null}_createDefaultMarker(){const t=He("div"),a=yi("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=yi("radialGradient",{id:"shadowGradient"},yi("defs",{},a));yi("stop",{offset:"10%","stop-opacity":.4},u),yi("stop",{offset:"100%","stop-opacity":.05},u),yi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return yi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),yi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),yi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||no.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,u=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,u=this._element;this._popup&&(a===u||u.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const u=t.unproject(a,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const f=p.position.toLngLat();return f.distanceTo(u)<.9*f.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(a,this._altitude);let p;t._showingGlobe()&&o.eK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Jp[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,u=this.getPitchAlignment();if(!a||!t||u!=="map")return"";if(!a._showingGlobe()){const x=a.getPitch();return x?`rotateX(${x}deg)`:""}const p=o.cJ(o.eL(a.transform,this._lngLat)),f=t.sub(o.eM(a.transform)),_=Math.abs(f.x)+Math.abs(f.y);if(_===0)return"";const b=p/_;return`rotateX(${-f.y*b}deg) rotateY(${f.x*b}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(a._showingGlobe()){const f=a.project(new o.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),_=a.project(new o.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(f);u=o.cJ(Math.atan2(_.y,_.x))-90}else u=-a.getBearing();else if(p==="horizon"){const f=o.af(4,6,a.getZoom()),_=o.eM(a.transform);_.y+=f*a.transform.height;const b=t.sub(_),x=o.cJ(Math.atan2(b.y,b.x));u=(x>90?x-270:x+90)*(1-f)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Gl(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const f=this._clickTolerance||a._clickTolerance;if(t.point.dist(u)<f)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,u=this._pos;a&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||no.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||no.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||no.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||no.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const qp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},vc={maxWidth:100,unit:"metric"},Yl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},jr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pr(l=new o.P(0,0),t="bottom"){if(typeof l=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new o.P(0,l);case"top-left":return new o.P(a,a);case"top-right":return new o.P(-a,a);case"bottom":return new o.P(0,-l);case"bottom-left":return new o.P(a,-a);case"bottom-right":return new o.P(-a,-a);case"left":return new o.P(l,0);case"right":return new o.P(-l,0)}return new o.P(0,0)}return l instanceof o.P||Array.isArray(l)?o.P.convert(l):o.P.convert(l[t]||[0,0])}return{version:_e,supported:St.supported,setRTLTextPlugin:o.eQ,getRTLTextPluginStatus:o.eP,Map:class extends _c{constructor(l){pt.mark(Ie.create);const t=l;if((l=o.h({},Gh,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.eI(window)&&(l.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xd(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new yc,this._domRenderTaskQueue=new yc,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},qh,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Mo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new It(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const a=document.getElementById(l.container);if(!a)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=a}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ep),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Vp(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||o.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this.indoor=new Wy(this),l.hash&&(this._hash=new zp(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const a=l.bounds;a&&(this.resize(),this.fitBounds(a,o.h({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new Up({customAttribution:l.customAttribution})),this._logoControl=new Jh,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new o.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new o.A(`${a.dataType}dataloading`,a))}),this._interactions=new io(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.A("movestart",l)).fire(new o.A("move",l)),this.fire(new o.A("resize",l)),t&&this.fire(new o.A("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.aG.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let a;t==="globe"&&l.zoom>=o.cx?(l.setMercatorFromTransition(),a=!0):t==="mercator"&&l.zoom<o.cx&&(l.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=o.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(o.cd.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(o.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,a){const u=p=>{let f=[];if(Array.isArray(t)){const _=t.filter(b=>this.getLayer(b));f=_.length?this.queryRenderedFeatures(p,{layers:_}):[]}else f=this.queryRenderedFeatures(p,{target:t});return f};if(l==="mouseenter"||l==="mouseover"){let p=!1;return{listener:a,targets:t,delegates:{mousemove:_=>{const b=u(_.point);b.length?p||(p=!0,a.call(this,new ma(l,this,_.originalEvent,{features:b}))):p=!1},mouseout:()=>{p=!1}}}}if(l==="mouseleave"||l==="mouseout"){let p=!1;return{listener:a,targets:t,delegates:{mousemove:b=>{u(b.point).length?p=!0:p&&(p=!1,a.call(this,new ma(l,this,b.originalEvent)))},mouseout:b=>{p&&(p=!1,a.call(this,new ma(l,this,b.originalEvent)))}}}}{const p=f=>{const _=u(f.point);_.length&&(f.features=_,a.call(this,f),delete f.features)};return{listener:a,targets:t,delegates:{[l]:p}}}}on(l,t,a){if(typeof t=="function"||a===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(l,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(l,t,a){if(typeof t=="function"||a===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(l,t,a);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(l,t,a){if(typeof t=="function"||a===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[l]:void 0;return u&&(p=>{for(let f=0;f<p.length;f++){const _=p[f];if(_.listener===a&&wc(_.targets,t)){for(const b in _.delegates)this.off(b,_.delegates[b]);return p.splice(f,1),this}}})(u),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof o.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const f=this.style.queryRenderedFeatures(l,void 0,this.transform),_=this.style.queryRenderedFeatureset(l,void 0,this.transform);return f.concat(_)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const f of t.layers)if(!this._isValidId(f)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(l,t,this.transform))),a&&(p=p.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),p}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(a,u)=>{if(a){const p=typeof a=="string"?a:a instanceof Error?a.message:a.error;o.w(`Unable to perform style diff: ${p}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const a=o.h({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new Ta(this,a).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ta(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.d8(l)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,a)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:a=1,sdf:u=!1,stretchX:p,stretchY:f,content:_}={}){this._lazyInitEmptyStyle();const b=o.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:x,height:T,data:M}=o.q.getImageData(t);this.style.addImage(b,{data:new o.r({width:x,height:T},M),pixelRatio:a,stretchX:p,stretchY:f,content:_,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:x,height:T}=t,M=t;this.style.addImage(b,{data:new o.r({width:x,height:T},new Uint8Array(M.data)),pixelRatio:a,stretchX:p,stretchY:f,content:_,sdf:u,usvg:!1,version:0,userImage:M}),M.onAdd&&M.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const a=o.I.from(l),u=this.style.getImage(a);if(!u)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.q.getImageData(t):t,{width:f,height:_,data:b}=p;if(f===void 0||_===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||_!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${f}, ${_})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const x=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let T=!1;u.usvg?(u.data=new o.r({width:f,height:_},new Uint8Array(b)),u.usvg=!1,u.icon=void 0,T=!0):u.data.replace(b,x),this.style.updateImage(a,u,T)}hasImage(l){return l?!!this.style&&!!this.style.getImage(o.I.from(l)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(o.I.from(l))}loadImage(l,t){o.o(this._requestManager.transformRequest(l,o.R.Image),(a,u)=>{t(a,u instanceof HTMLImageElement?o.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(l=>l.name)}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch(a=>this.fire(new o.z(new Error("Failed to add import",a)))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,a){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,a),this._update(!0)):this}setFilter(l,t,a={}){return this._isValidId(l)?(this.style.setFilter(l,t,a),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,a,u={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,a,u),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,a,u={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,a,u),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,a){return this.style.setConfigProperty(l,t,a),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.cd.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,u,p,f=this._container;for(;f&&(!u||!p);){const _=window.getComputedStyle(f).transform;_&&_!=="none"&&(a=_.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(u=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(p=a[3])),f=f.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=He("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=He("div","mapboxgl-canvas-container",l);this._canvas=He("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=He("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=He("div",`mapboxgl-ctrl-${p}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const a=o.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(l),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=o.h({},St.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(Br(t,!0),this.painter=new $l(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(t)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new o.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,u=o.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,M=this.transform.pitch,I=o.q.now(),C=new o.aa(T,{now:I,fadeDuration:f,pitch:M,transition:this.style.transition,worldview:this._worldview});this.style.update(C)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(u);const b=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),b&&(this._placementDirty=b.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,pt.mark(Ie.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const T=o.q.now()-u;p.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const M=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new o.A("gpu-timing-frame",{cpuTime:T,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(T);this.fire(new o.A("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(T);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:M}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(x||this._repaint)this.triggerRepaint();else{const T=this.idle();if(T&&(_=this._updateAverageElevation(u,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,pt.mark(Ie.fullLoad),this._performanceMetricsCollection&&br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const a=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const p=this.transform.averageElevation;let f=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(f)?f=0:this._averageElevationLastSampledAt=l;const _=Math.abs(p-f);if(_>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(f),a(f);this._averageElevation.easeTo(f,l,300)}else if(_>1e-4)return this._averageElevation.jumpTo(f),a(f)}return!!this._averageElevation.isEasing(l)&&a(this._averageElevation.getValue(l))}_authenticate(){ul(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===Ki||l.status===401)){const t=this.painter.context.gl;Br(t,!1),this._logoControl instanceof Jh&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Za(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&An(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,u=a.createFramebuffer();function p(f){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,f,0);const _=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,_),_}return a.bindFramebuffer(a.FRAMEBUFFER,u),this._canvasPixelComparison(p(l),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(l,t,a){let u=a[1]-a[0];const p=l.length/4;for(let f=0;f<t.length;f++){const _=t[f];let b=0;for(let x=0;x<_.length;x+=4)_[x]===l[x]&&_[x+1]===l[x+1]&&_[x+2]===l[x+2]&&_[x+3]===l[x+3]&&(b+=1);u+=(a[f+2]-a[f+1])*(1-b/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),po.delete(this.painter.context.gl),fn.remove(),Rr.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.q.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return o.bt(t,(a,u)=>a._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){o.eJ(l,t)}get version(){return _e}},NavigationControl:class{constructor(l={}){this.options=o.h({},wg,l),this._container=He("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),He("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),He("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=He("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),a=t===l.getMaxZoom(),u=t===l.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new f1(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const a=He("button",l,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(l,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",a),l.firstElementChild&&l.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends o.E{constructor(l={}){super();const t=navigator.geolocation;this.options=o.h({geolocation:t},qp,l),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ss(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=He("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,l(a)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>t(a.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),a=l.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",l)),this._finish()}}_updateCamera(l){const t=new o.cd(l.coords.longitude,l.coords.latitude),a=l.coords.accuracy,u=this._map.getBearing(),p=o.h({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),p,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new o.cd(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=o.c6(1,l._center.lat)*l.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=He("button","mapboxgl-ctrl-geolocate",this._container),He("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=He("div","mapboxgl-user-location"),this._dotElement.appendChild(He("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(He("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=He("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Up,ScaleControl:class{constructor(l={}){this.options=o.h({},vc,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,u=t._containerWidth/2-l/2,p=t.unproject([u,a]),f=t.unproject([u+l,a]),_=p.distanceTo(f);if(this.options.unit==="imperial"){const b=3.2808*_;b>5280?this._setScale(l,b/5280,"mile"):this._setScale(l,b,"foot")}else this.options.unit==="nautical"?this._setScale(l,_/1852,"nautical-mile"):_>=1e3?this._setScale(l,_/1e3,"kilometer"):this._setScale(l,_,"meter")}_setScale(l,t,a){this._map._requestDomTask(()=>{const u=function(f){const _=Math.pow(10,`${Math.floor(f)}`.length-1);let b=f/_;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(x){const T=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*T)/T}(b),_*b}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(u):`${u}&nbsp;${Yl[a]}`,this._container.style.width=l*p+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=He("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=He("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=He("button","mapboxgl-ctrl-fullscreen",this._controlContainer);He("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(l){super(),this.options=o.h(Object.create(Eo),l),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.cd.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=l;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=He("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const a=this._closeButton=He("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,u=this._pos;if(!t||!a||!u)return"bottom";const p=a.offsetWidth,f=a.offsetHeight,_=u.x<p/2,b=u.x>t.transform.width-p/2;if(u.y+l<f)return _?"top-left":b?"top-right":"top";if(u.y>t.transform.height-f){if(_)return"bottom-left";if(b)return"bottom-right"}return _?"left":b?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let u=this._container;if(u||(u=this._container=He("div","mapboxgl-popup",t.getContainer()),this._tip=He("div","mapboxgl-popup-tip",u),u.appendChild(a)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Gl(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const p=this._pos=this._trackPointer&&l instanceof o.P?l:t.project(this._lngLat,this._altitude),f=Pr(this.options.offset),_=this._anchor=this._getAnchor(f.y),b=Pr(this.options.offset,_),x=p.add(b).round();t._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${Jp[_]} translate(${x.x}px,${x.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=o.eK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(jr);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:bc,Style:Ta,LngLat:o.cd,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:kf,Evented:o.E,config:o.e,prewarm:o.eO,clearPrewarmedResources:o.eN,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(l){o.e.ACCESS_TOKEN=l},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(l){o.e.API_URL=l},get workerCount(){return o.eX.workerCount},set workerCount(l){o.eX.workerCount=l},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.eW(l)},get workerUrl(){return o.eV.workerUrl},set workerUrl(l){o.eV.workerUrl=l},get workerClass(){return o.eV.workerClass},set workerClass(l){o.eV.workerClass=l},get workerParams(){return o.eV.workerParams},set workerParams(l){o.eV.workerParams=l},get dracoUrl(){return o.eU()},set dracoUrl(l){o.eT(l)},get meshoptUrl(){return o.eS()},set meshoptUrl(l){o.eR(l)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var K=L;return K})})(r5);var QP=r5.exports;const Zw=A7(QP);Zw.accessToken="pk.eyJ1IjoiYXRtaWthcGFpMTMiLCJhIjoiY21idHR4eTJpMDdhMjJsb20zNmZheTZ6ayJ9.d_bQSBzesyiCUMA-YHRoIA";function eM({restaurants:c,onRestaurantSelect:m,activeFilters:v,onLegendFilterChange:P,favorites:L}){const B=ta.useRef(null),K=ta.useRef(null),o=ta.useRef([]),_e=ta.useRef([]);ta.useRef(10);const Ie=()=>window.innerWidth<=768||"ontouchstart"in window,pt=(St,He,yi)=>{let Ee=St;return Ie()&&He>=12?Ee*=1.5:He>=12&&(Ee*=1.4),Math.round(Ee)},dt=()=>{if(!K.current)return;const St=K.current.getZoom(),He=Ie();_e.current.forEach((yi,Ee)=>{if(yi&&yi.style){const Ae=parseInt(yi.getAttribute("data-base-size")||"8"),Oe=pt(Ae,St);yi.style.width=`${Oe}px`,yi.style.height=`${Oe}px`;const vt=yi.parentElement;if(vt){const Ot=He?"12px":"8px";vt.style.padding=Ot}}})};ta.useEffect(()=>{if(B.current)return K.current=new Zw.Map({container:B.current,style:"mapbox://styles/mapbox/streets-v12",center:[-73.979545,40.744293],zoom:10}),K.current.on("zoom",()=>{dt()}),window.addEventListener("resize",dt),()=>{K.current&&K.current.remove(),window.removeEventListener("resize",dt)}},[]),ta.useEffect(()=>{if(!K.current)return;o.current.forEach(He=>He.remove()),o.current=[],_e.current=[],c.filter(He=>v.length===0?!0:v.some(yi=>{switch(yi){case"michelin":return He.michelin_award&&["ONE_STAR","TWO_STARS","THREE_STARS"].includes(He.michelin_award);case"bib":return He.michelin_award==="BIB_GOURMAND";case"nyt":return He.nyttop100_rank;case"regular":return!He.michelin_award&&!He.nyttop100_rank;case"favorites":return L.includes(He.name);default:return!1}})).forEach(He=>{if(He.latitude&&He.longitude){let yi="#000000",Ee="8px";He.michelin_award?["ONE_STAR","TWO_STARS","THREE_STARS"].includes(He.michelin_award)?(yi=" #C81224",Ee="10px"):He.michelin_award==="BIB_GOURMAND"&&(yi="#f9a83d",Ee="10px"):He.nyttop100_rank&&(yi="#FF69B4",Ee="10px");const Ae=document.createElement("div");Ae.style.padding=Ie()?"12px":"8px",Ae.style.display="flex",Ae.style.alignItems="center",Ae.style.justifyContent="center",Ae.style.cursor="pointer";const Oe=document.createElement("div");Oe.className="restaurant-marker",Oe.style.width=Ee,Oe.style.height=Ee,Oe.style.borderRadius="50%",Oe.style.backgroundColor=yi,Oe.style.border="1px solid white",Oe.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",Ae.appendChild(Oe);const vt=parseInt(Ee);Oe.setAttribute("data-base-size",vt.toString());const Ot=new Zw.Marker(Ae).setLngLat([He.longitude,He.latitude]).addTo(K.current);Ae.addEventListener("click",()=>{m(He)}),o.current.push(Ot),_e.current.push(Oe)}}),dt()},[c,m,v]);const Xe=St=>{P(St)},zt=c.filter(St=>v.length===0?!0:v.some(He=>{switch(He){case"michelin":return St.michelin_award&&["ONE_STAR","TWO_STARS","THREE_STARS"].includes(St.michelin_award);case"bib":return St.michelin_award==="BIB_GOURMAND";case"nyt":return St.nyttop100_rank;case"regular":return!St.michelin_award&&!St.nyttop100_rank;case"favorites":return L.includes(St.name);default:return!1}}));return gt.jsxs("div",{className:"map-wrapper",children:[gt.jsx("div",{ref:B,className:"map-container"}),gt.jsxs("div",{className:"map-legend",children:[gt.jsxs("h4",{style:{color:"#000000",margin:"0 0 -7px 0"},children:[zt.length," Restaurants"]}),gt.jsx("div",{style:{fontSize:"clamp(6px, 0.8vw, 12px)",color:"#666",marginBottom:"0px",marginTop:"0px"},children:"Click on list below:"}),gt.jsxs("div",{className:"legend-list-vertical",children:[gt.jsxs("div",{className:"legend-item",onClick:()=>Xe("michelin"),style:{cursor:"pointer"},children:[gt.jsx("div",{className:"legend-marker",style:{backgroundColor:" #C81224"}}),gt.jsx("img",{src:"MichelinStar.svg.png",alt:"Michelin Star",style:{width:"clamp(10px, 1.2vw, 16px)",height:"clamp(10px, 1.2vw, 16px)",marginRight:"2px",verticalAlign:"middle"}}),gt.jsx("span",{style:{fontWeight:v.includes("michelin")?"bold":"normal",color:"#000000"},children:"Michelin"}),v.includes("michelin")&&gt.jsx("button",{onClick:St=>{St.stopPropagation(),Xe("michelin")},style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"clamp(6px, 0.8vw, 12px)",padding:"0",marginLeft:"2px"},children:"×"})]}),gt.jsxs("div",{className:"legend-item",onClick:()=>Xe("bib"),style:{cursor:"pointer"},children:[gt.jsx("div",{className:"legend-marker",style:{backgroundColor:"#f9a83d"}}),gt.jsx("img",{src:"bibgourmand.png",alt:"Bib Gourmand",style:{width:"clamp(10px, 1.2vw, 16px)",height:"clamp(10px, 1.2vw, 16px)",marginRight:"2px",verticalAlign:"middle"}}),gt.jsx("span",{style:{fontWeight:v.includes("bib")?"bold":"normal",color:"#000000"},children:"Bib Gourmand"}),v.includes("bib")&&gt.jsx("button",{onClick:St=>{St.stopPropagation(),Xe("bib")},style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"clamp(6px, 0.8vw, 12px)",padding:"0",marginLeft:"2px"},children:"×"})]}),gt.jsxs("div",{className:"legend-item",onClick:()=>Xe("nyt"),style:{cursor:"pointer"},children:[gt.jsx("div",{className:"legend-marker",style:{backgroundColor:"#FF69B4"}}),gt.jsx("img",{src:"nytimes.png",alt:"NYT Top 100",style:{width:"clamp(10px, 1.2vw, 16px)",height:"clamp(10px, 1.2vw, 16px)",marginRight:"2px",verticalAlign:"middle"}}),gt.jsx("span",{style:{fontWeight:v.includes("nyt")?"bold":"normal",color:"#000000"},children:"NYT Top 100"}),v.includes("nyt")&&gt.jsx("button",{onClick:St=>{St.stopPropagation(),Xe("nyt")},style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"clamp(6px, 0.8vw, 12px)",padding:"0",marginLeft:"2px"},children:"×"})]}),gt.jsxs("div",{className:"legend-item",onClick:()=>Xe("regular"),style:{cursor:"pointer"},children:[gt.jsx("div",{className:"legend-marker",style:{backgroundColor:"#000000"}}),gt.jsx("span",{style:{fontWeight:v.includes("regular")?"bold":"normal",color:"#000000"},children:"The Rest"}),v.includes("regular")&&gt.jsx("button",{onClick:St=>{St.stopPropagation(),Xe("regular")},style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"clamp(6px, 0.8vw, 12px)",padding:"0",marginLeft:"2px"},children:"×"})]})]})]})]})}function tM({onSearch:c,onFilterChange:m,allRestaurants:v=[],onResetAll:P,onRestaurantSelect:L,favorites:B,onFavoritesToggle:K,favoritesActive:o}){const[_e,Ie]=ta.useState(""),[pt,dt]=ta.useState(null),[Xe,zt]=ta.useState({}),[St,He]=ta.useState(!1),[yi,Ee]=ta.useState(!1),Ae={Cuisine:["Mexican","American (Traditional)","Steakhouse","French","Italian","Thai","Asian Fusion","Indian","American (New)","Japanese / Sushi","Chinese","Seafood","Caribbean","Mediterranean","Spanish","Austrian","Gastropub","Eclectic","Cuban","Belgian","Puerto Rican","Argentinian","Taiwanese","Greek","Eastern European","Latin American","Middle Eastern","Barbecue","Ukrainian","Brazilian","Korean","Peruvian","Turkish","Hawaiian","Pan-Asian","British","Continental","Vietnamese","Irish","Cajun/Creole","Soul Food / Southern","African","Colombian","Pizza"],"Meal Types":["$30 Lunch Price","$60 Dinner Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price","$45 Lunch Price","$60 Sunday Dinner Price","$30 Dinner Price","$30 Sunday Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Lunch Price","$60 Sunday Lunch/Brunch Price"],Collections:["around-the-boroughs","date-night","summer-vibes","celebrity-chefs","dress-for-the-occasion","classic-restaurants","hidden-gems","for-the-foodies"],"Participating Weeks":["Week 1 (July 21 - July 27)","Week 2 (July 28 - Aug 3)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"]},Oe=It=>{const wi=It.target.value;Ie(wi),He(wi.length>0),c(wi)},vt=()=>_e.trim()?v.filter(It=>It.name.toLowerCase().includes(_e.toLowerCase())).slice(0,5):[],Ot=It=>{Ie(It.name),He(!1),c(It.name),L(It)},Qt=It=>{dt(pt===It?null:It)},ti=(It,wi)=>{const Ui=Xe[It]||[];let nn;wi==="All"?nn=[]:Ui.includes(wi)?nn=Ui.filter(bi=>bi!==wi):nn=[...Ui,wi];const jt={...Xe,[It]:nn};zt(jt),m(It,nn),dt(null)},ri=()=>{const It=!yi;Ee(It),m("Has Menu",It?["active"]:[])},oi=()=>{console.log("Resetting all filters..."),Ie(""),zt({}),Ee(!1),P()},ci=(()=>{const It=[];return Object.entries(Xe).forEach(([wi,Ui])=>{Ui.forEach(nn=>{It.push({filterType:wi,value:nn})})}),It})(),Bn=It=>It.split("-").map(wi=>wi.charAt(0).toUpperCase()+wi.slice(1)).join(" "),Ki=It=>{navigator.clipboard.writeText(It).then(()=>{alert("Favorites link copied to clipboard!")}).catch(()=>{const wi=document.createElement("textarea");wi.value=It,document.body.appendChild(wi),wi.select(),document.execCommand("copy"),document.body.removeChild(wi),alert("Favorites link copied to clipboard!")})};return gt.jsxs("div",{className:"filters-container",children:[gt.jsxs("div",{className:"filters-header",children:[gt.jsx("h2",{className:"filters-title",children:"Browse All Restaurants"}),gt.jsx("p",{className:"filters-instructions",children:"To learn more about NYC Restaurant Week Summer 2025 restaurant offerings, tap on a pin in the map or search for one below:"})]}),gt.jsxs("div",{className:"search-container",children:[gt.jsx("input",{type:"text",placeholder:"Search",value:_e,onChange:Oe,onBlur:()=>setTimeout(()=>He(!1),200),className:"search-input"}),gt.jsx("div",{className:"search-icon",children:"🔍"}),St&&vt().length>0&&gt.jsx("div",{className:"search-suggestions",children:vt().map((It,wi)=>gt.jsx("div",{className:"suggestion-item",onClick:()=>Ot(It),children:It.name},wi))})]}),gt.jsxs("div",{className:"filter-buttons",children:[Object.entries(Ae).map(([It,wi])=>{const Ui=Xe[It]&&Xe[It].length>0;return gt.jsxs("div",{className:"filter-group",children:[gt.jsxs("button",{className:`filter-button ${Ui?"active":""}`,onClick:()=>Qt(It),children:[It,gt.jsx("span",{className:"dropdown-arrow",children:gt.jsx("svg",{width:"15",height:"15",viewBox:"0 0 20 20",fill:"none",children:gt.jsx("path",{d:"M5 8L10 13L15 8",stroke:"black",strokeWidth:"2.1"})})})]}),pt===It&&gt.jsx("div",{className:"dropdown-menu",children:wi.map(nn=>{const jt=Xe[It]||[],bi=nn==="All"?jt.length===0:jt.includes(nn),Ht=It==="Collections"?Bn(nn):nn;return gt.jsxs("div",{className:`dropdown-item ${bi?"selected":""}`,onClick:()=>ti(It,nn),children:[gt.jsx("span",{className:"checkbox",children:bi?"☑":"☐"}),Ht]},nn)})})]},It)}),gt.jsx("div",{className:"filter-group",children:gt.jsx("button",{className:`filter-button ${yi?"active":""}`,onClick:ri,children:"Has Menu"})}),ci.length>0&&gt.jsx("div",{className:"filter-group",children:gt.jsx("button",{className:"filter-button reset-all-button",onClick:oi,children:"RESET ALL ×"})}),gt.jsx("div",{className:"filter-group favorites-filter",children:gt.jsxs("button",{className:`filter-button ${o?"active":""}`,onClick:K,children:[gt.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:o?"#FF69B4":"none",stroke:"#FF69B4",strokeWidth:"2",style:{marginRight:"4px"},children:gt.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),B.length," Favorites"]})}),B.length>0&&gt.jsxs("div",{className:"filter-group share-dropdown",children:[gt.jsxs("button",{className:"filter-button share-button",onClick:()=>dt(pt==="share"?null:"share"),children:[gt.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"4px"},children:[gt.jsx("path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"}),gt.jsx("polyline",{points:"16,6 12,2 8,6"}),gt.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"15"})]}),"Share",gt.jsx("span",{className:"dropdown-arrow",children:gt.jsx("svg",{width:"15",height:"15",viewBox:"0 0 20 20",fill:"none",children:gt.jsx("path",{d:"M5 8L10 13L15 8",stroke:"currentColor",strokeWidth:"2.1"})})})]}),pt==="share"&&gt.jsxs("div",{className:"dropdown-menu share-dropdown-menu",children:[gt.jsxs("div",{className:"dropdown-item",onClick:()=>{const It=window.location.origin+window.location.pathname,wi=B.map(nn=>{var jt;return(jt=v.find(bi=>bi.name===nn))==null?void 0:jt.slug}).filter(nn=>nn!==void 0),Ui=`${It}#favorites=${encodeURIComponent(wi.join(","))}`;navigator.share?navigator.share({title:"My NYC Restaurant Week Favorites",text:`Check out my ${B.length} favorite restaurants for NYC Restaurant Week!`,url:Ui}).catch(nn=>{console.log("Share cancelled or failed:",nn),Ki(Ui)}):Ki(Ui),dt(null)},children:[gt.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"8px"},children:[gt.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),gt.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),"Share with friends"]}),gt.jsxs("div",{className:"dropdown-item",onClick:()=>{const It=B.map(wi=>{const Ui=v.find(nn=>nn.name===wi);if(Ui){const nn=Ui.address?`${Ui.name}, ${Ui.address}`:Ui.name;return encodeURIComponent(nn)}return null}).filter(wi=>wi!==null);if(It.length>0){const wi=`https://www.google.com/maps/dir/${It.join("/")}`;window.open(wi,"_blank")}dt(null)},children:[gt.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"8px"},children:[gt.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),gt.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),"Export to Google Maps"]})]})]})]})]})}function iM({restaurant:c,placeholderRestaurant:m,onClose:v,isFavorited:P=!1,onToggleFavorite:L}){const B=c||m;if(!B)return null;const K=()=>{B.menu_url&&window.open(B.menu_url,"_blank")},o=()=>{B.website&&window.open(B.website,"_blank")};return gt.jsxs("div",{className:"restaurant-card",children:[v&&gt.jsx("button",{className:"restaurant-card-close",onClick:v,"aria-label":"Close",children:gt.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[gt.jsx("line",{x1:"4",y1:"4",x2:"16",y2:"16"}),gt.jsx("line",{x1:"16",y1:"4",x2:"4",y2:"16"})]})}),L&&gt.jsx("button",{className:"restaurant-card-heart",onClick:L,"aria-label":P?"Remove from favorites":"Add to favorites",children:P?gt.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#FF69B4",stroke:"#FF69B4",strokeWidth:"2",children:gt.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):gt.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#FF69B4",strokeWidth:"2",children:gt.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),gt.jsxs("h2",{className:"restaurant-name",children:[B.name,B.michelin_award&&["ONE_STAR","TWO_STARS","THREE_STARS"].includes(B.michelin_award)&&gt.jsx("img",{src:"MichelinStar.svg.png",alt:"Michelin Star",className:"michelin-star-inline"}),B.michelin_award==="BIB_GOURMAND"&&gt.jsx("img",{src:"bibgourmand.png",alt:"Bib Gourmand",className:"bib-gourmand-inline"}),B.nyttop100_rank&&gt.jsx("img",{src:"nytimes.png",alt:"NYT Top 100",className:"nyt-top100-inline"})]}),gt.jsxs("div",{className:"restaurant-tags",children:[gt.jsx("span",{className:"tag tag-cuisine",children:B.cuisine}),gt.jsx("span",{className:"tag tag-neighborhood",children:B.neighborhood}),B.nyttop100_rank&&gt.jsxs("span",{className:"tag tag-nyt-rank",children:["NYT Rank ",B.nyttop100_rank]})]}),gt.jsx("p",{className:"restaurant-description",children:B.summary}),B.meal_types&&B.meal_types.length>0&&gt.jsxs("div",{className:"meals-section",children:[gt.jsx("h3",{className:"meals-heading",children:"Meals Available"}),gt.jsx("div",{className:`meals-list ${B.meal_types.length>=3?"meals-list-two-columns":""}`,children:B.meal_types.map((_e,Ie)=>{const pt=_e.replace(" Price","").replace("$","$");return gt.jsxs("div",{className:"meal-item",children:["• ",pt]},Ie)})})]}),gt.jsxs("div",{className:"restaurant-actions",children:[B.menu_url&&gt.jsxs("button",{className:"action-link",onClick:K,children:[gt.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:gt.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"See Menu"]}),B.website&&gt.jsxs("button",{className:"action-link",onClick:o,children:[gt.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:gt.jsx("path",{d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"LEARN MORE"]})]}),B.opentable_id&&B.opentable_id.trim()!==""&&gt.jsx("a",{className:"find-table-btn",href:`https://www.opentable.com/restaurant/profile/${B.opentable_id}`,target:"_blank",rel:"noopener noreferrer",children:"Find a Table"})]})}const z_=[{name:"Atlantic Grill",slug:"atlantic-grill",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Seafood",summary:"Just steps from Lincoln Center, this Upper West Side spot specializes in seafood of all sorts—oyster, clam and shellfish selections that change daily and market-fresh fish available simply grilled a la carte or as composed entrees.",website:"https://atlanticgrill.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3da0E0IkNGQA3JXU0WpUfJ/36cf426bb439d1f9d5c5ebe155407d7b/Atlantic-Grill-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1175752",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/35962-AtlanticGrill-menu.pdf",primary_location:"Upper West Side",address:"50 W. 65th St., Manhattan, NY 10023",latitude:40.7724966,longitude:-73.9811104,telephone:"(212)3627800",price_range:"$",facebook_url:"https://www.facebook.com/atlanticgrillnyc",instagram_url:"https://instagram.com/atlanticgrillnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Serra",slug:"serra-by-birreria",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Italian",summary:"Eataly's seasonal rooftop restaurant will transport you the Italian Alps.",website:"https://www.eataly.com/us_en/stores/nyc-flatiron/restaurants/serra-by-birreria",image_url:"//images.ctfassets.net/1aemqu6a6t65/2GpNe2uSk1xjeWdlmqJg7l/5d0288c95513d79c695805425b171439/serra-alpina-birreria-flatiron-manhattan-nyc-eataly.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["summer-vibes"],opentable_id:"152821",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36098-SerrabyBirreria-menu.pdf",primary_location:"Flatiron District",address:"Eataly NYC Flatiron, 200 Fifth Ave., 10010 Manhattan",latitude:40.742045,longitude:-73.9900845,telephone:"(212)2292560",price_range:"$",facebook_url:"https://www.facebook.com/EatalyNYCFlatiron/",instagram_url:"https://instagram.com/eatalynewyorkcity",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bixi",slug:"bixi",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Asian Fusion",summary:"Bixi offers dishes and drinks that are packed with unforgettable flavors and served by a knowledgeable, friendly staff.",website:"https://bixiharlem.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4Nz847eZbnN1SW9Jdip4KX/b152cf205c53239557128586492bb20d/Bixi-Manhattan-NYC-Photo-Spothopper__1_.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1154983",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45644-Bixi-menu.pdf",primary_location:"Harlem",address:"2164 Frederick Douglass Blvd., Manhattan, NY 10026",latitude:40.8048198,longitude:-73.9547643,telephone:"(917)4090570",price_range:"$",facebook_url:"https://www.facebook.com/p/Bixi-Harlem-100070642128767",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kokomo",slug:"kokomo-restaurant",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Caribbean",summary:"Influenced by the rich and exotic culture of the Caribbean, Kokomo's cuisine builds on familiar island ingredients and offerings with a modern flair.",website:"https://www.kokomonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5EQUt5MZOUYvcwXLM679WB/e46ea44d0c2176a611877818c38164f5/kokomo-williamsburg-brooklyn-nyc-katrine-moite.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1070542",menu_url:"",primary_location:"Williamsburg",address:"65 Kent Ave., Brooklyn, NY 11249",latitude:40.7219794,longitude:-73.9597134,telephone:"(347)7991312",price_range:"$",facebook_url:"https://www.facebook.com/KokomoNYC",instagram_url:"https://instagram.com/kokomonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gair",slug:"gair",borough:"Brooklyn",neighborhood:"Dumbo",cuisine:"American (New)",summary:"Gair is Dumbo’s premier destination for elevated, distinctive cocktails, locally-sourced, seasonally-inspired dishes, and an unmatched environment.",website:"https://www.gair-dumbo.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/OUmh10wt80t2iaejqwGX0/6a4ac810b2ce04cc936069893838b6b9/Gair-Dumbo-Brooklyn-NYC-Courtesy-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1268680",menu_url:"",primary_location:"Dumbo",address:"41 Washington St., Brooklyn, NY 11201",latitude:40.7031021,longitude:-73.9894143,telephone:"(718)2332595",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice on Hudson",slug:"felice-on-hudson",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Felice on Hudson fits seamlessly into the picturesque West Village, bringing an array of daily specials inspired by seasonal ingredients and an extensive Italian wine list to the neighborhood.",website:"https://www.felicerestaurants.com/felice-hudson",image_url:"//images.ctfassets.net/1aemqu6a6t65/5UEb4RSKsuytdGS6yu7YdA/99ad82fb8b3df171e56935e35037857d/Felice-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"West Village",address:"615 Hudson St., Manhattan, NY 10014",latitude:40.7379067,longitude:-74.0058747,telephone:"(212)7679210",price_range:"$",facebook_url:"https://www.facebook.com/FeliceNewYorkCity",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Stout NYC Grand Central",slug:"stout-nyc-grand-central",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"American (Traditional)",summary:"Find Stout NYC Grand Central in the midst of New York City icons including the Chrysler Building and the New York Public Library.",website:"https://www.stoutnyc.com/location/stout-nyc-grand-central",image_url:"//images.ctfassets.net/1aemqu6a6t65/62ETRmv6PlMKxOgQfToPmH/e565a0f227efbb7aa6df0a33997ba046/Stout-NYC-Manhattan-NYC-Photo-Angelito-Jusay-Virten-Media.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46500-StoutNYCGrandCentral-menu.pdf",primary_location:"Murray Hill",address:"60 E. 41st St., Manhattan, NY 10017",latitude:40.7515953,longitude:-73.9787467,telephone:"(212)9229009",price_range:"$",facebook_url:"https://www.facebook.com/StoutNYCGrandCentral",instagram_url:"https://instagram.com/stout_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Jardinier",slug:"le-jardinier",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"French",summary:"This chic French restaurant in Midtown has a vegetable-forward menu.",website:"https://lejardinier-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/8YtDtBP3EQrLtqqTbSqGs/e263285eb1fafb3b154f025b3d29de56/Le-Jardinier-Manhattan-NYC-Photo-Alex-Staniloff-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"1041964",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46529-LeJardinier-menu.pdf",primary_location:"Midtown East",address:"610 Lexington Ave., Manhattan, NY 10022",latitude:40.758176,longitude:-73.9713245,telephone:"(212)4519211",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lejardiniernyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Longo Bros.",slug:"longo-bros",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Italian",summary:"Longo Bros. bar-restaurant offers an all-day menu of Italian favorites like antipasti, pasta and pizza.",website:"https://longobrosnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7qVTPl1h57Ko7GZwZIOheF/f1e6860dd7cab2724e5d544629d04358/compressed-longo-bros-hells-kitchen-manhattan-nyc-courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44866-LongoBros.-menu.pdf",primary_location:"Hells Kitchen",address:"474 Ninth Ave., Manhattan, NY 10018",latitude:40.7548278,longitude:-73.9948546,telephone:"(332)2053568",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/longobrosnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sweet Catch",slug:"sweet-catch",borough:"Brooklyn",neighborhood:"Prospect Lefferts Gardens",cuisine:"Seafood",summary:"Sweet Catch is an ode to the connection between African-American people and their rich history of seafood culinary mastery.",website:"https://www.sweetcatchbk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4mCpgqSey8Dfk5v7EMJT2d/af48cb113e5624a128fc0839f585202d/Sweet-Catch-Brooklyn-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["summer-vibes"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47861-SweetCatch-menu.pdf",primary_location:"Prospect Lefferts Gardens",address:"1222 Nostrand Ave., Brooklyn, NY 11225",latitude:40.6573744,longitude:-73.9505511,telephone:"(347)2407799",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/sweetcatchbk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Filé Gumbo Bar",slug:"file-gumbo-bar",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"Cajun/Creole",summary:"Beyond the signature gumbo, dining at Filé is an educational feast of the culinary subtleties of Cajun and Creole food.",website:"https://filenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4OueL4q6SJokI93DaJOOWm/187caa34cd23f4aa29350e996100e95c/File-Gumbo-Bar-Manhattan-NYC-Photo-Patrick-Dolande-5.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1178713",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46614-Fil%C3%A9GumboBar-menu.pdf",primary_location:"Tribeca",address:"275 Church St., Manhattan, NY 10013",latitude:40.7184878,longitude:-74.0048194,telephone:"(917)5406268",price_range:"$",facebook_url:"https://www.facebook.com/filegumbobar",instagram_url:"https://instagram.com/filegumbobar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Koi New York",slug:"koi-new-york",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Japanese / Sushi",summary:"Koi New York's chic and sexy surroundings, inventive cocktails and beloved signature dishes set the scene for a fun and sophisticated dining experience.",website:"https://koirestaurant.com/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/6zCxWCGuGpbM7hvFQd0N0b/05b3ac312e83967b6edb992020b1c9db/Koi-Restaurant-Manhattan-NYC-Courtesy-3.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:["dress-for-the-occasion"],opentable_id:"4035",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/26697-KoiNewYork-menu.pdf",primary_location:"Midtown West",address:"Bryant Park Hotel, 40 W. 40th St., 10018 Manhattan",latitude:40.7530572,longitude:-73.9840881,telephone:"(212)9213330",price_range:"$",facebook_url:"https://www.facebook.com/KoiRestaurants",instagram_url:"https://instagram.com/koirestaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nizza",slug:"nizza",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Italian",summary:"Nizza takes its name from the Italian word for the French region of Nice, and its menu is French-Italian fusion.",website:"https://nizzanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3CJANmB0CyITFUILvAjS8b/5d98c745988dc7ed69ca3be7577763c9/rw-to-go_nizza_e052e747-5056-a36f-23b943e49de874b1-e052e4db5056a36_e052e7a2-5056-a36f-230c7a7783c77383.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"29137",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44381-Nizza-menu.pdf",primary_location:"Hells Kitchen",address:"630 Ninth Ave., Manhattan, NY 10036",latitude:40.759987,longitude:-73.9912338,telephone:"(212)9561800",price_range:"$",facebook_url:"https://www.facebook.com/nizzanyc",instagram_url:"https://instagram.com/nizzanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Momoya - Upper West Side",slug:"momoya-upper-west",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Japanese / Sushi",summary:"The beloved Japanese restaurant Momoya has added this new incarnation on Manhattan's Upper West Side. ",website:"https://momoyanyc.com/uws.html",image_url:"//images.ctfassets.net/1aemqu6a6t65/7tmktSRbO5SXSQJ3xOV3qQ/aa96307dc6629e7858a7e84692735d03/compressed-salmon-teriyaki_BF095920-B49F-477E-A2A130317A062D31_888db5fe-2ccc-4f60-97753785a75f6c82.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"242434",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48136-Momoya-UpperWestSide-menu.pdf",primary_location:"Upper West Side",address:"427 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7839759,longitude:-73.9772867,telephone:"(212)5800007",price_range:"$",facebook_url:"https://www.facebook.com/momoyauws",instagram_url:"https://instagram.com/momoyauws",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bocca Di Bacco—Chelsea",slug:"bocca-di-bacco-chelsea",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Italian",summary:"Boasting an Italian-centric wine list of over 300 distinct selections to match with the menu overseen by executive chef Kristin Sollenne, the restaurant brings a contemporary, farm-to-table approach to Italian dining.",website:"https://www.boccadibacconyc.com/location/bocca-di-bacco-chelsea",image_url:"//images.ctfassets.net/1aemqu6a6t65/4ENWT1zxM5ydCveKWJjupH/05844efbfea241ddb14ab4683470f835/Bocca-di-Bacco-Manhattan-NYC-Photo-NYCRG.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"100966",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39473-BoccaDiBacco-Chelsea-menu.pdf",primary_location:"Chelsea",address:"169 Ninth Ave., Manhattan, NY 10011",latitude:40.7446144,longitude:-74.0030186,telephone:"(212)9898400",price_range:"$",facebook_url:"https://www.facebook.com/BoccaDiBaccoNYCRG",instagram_url:"https://instagram.com/boccadibacconyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Tuck Room",slug:"the-tuck-room",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"Gastropub",summary:"Tucked away above iPic Theaters is this spirited drinking and dining den with an urban chic atmosphere.",website:"https://www.thetuckroom.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/12TkLKCUBss7OY9dgeRvK6/816aa6482247f738b0b6675d0b907d77/The-Tuck-Room-Seaport-Manhattan-NYC-Photo-Courtesy-the-Seaport-2.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40042-TuckRoom-menu.pdf",primary_location:"The Seaport",address:"11 Fulton St., Manhattan, NY 10038",latitude:40.7066254,longitude:-74.0031519,telephone:"(212)7768273",price_range:"$",facebook_url:"https://www.facebook.com/TuckRoomNYC",instagram_url:"https://instagram.com/thetuckroom",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Metropolis",slug:"metropolis",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"American (New)",summary:"Metropolis is a vibrant contemporary American restaurant from Marcus Samuelsson within the Perelman Performing Arts Center in Lower Manhattan.",website:"https://www.metropolisbymarcus.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5xKqGVZJjtPvyme8r9jGag/8f3ee1283b55357265b96c6a5f2ac746/Metropolis-Manhattan-NYC-Photo-Andrew-Lee-Thomas.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1317532",menu_url:"",primary_location:"Lower Manhattan",address:"251 Fulton St., Manhattan, NY 10007",latitude:40.712439,longitude:-74.0123736,telephone:"(212)2663018",price_range:"$",facebook_url:"https://www.facebook.com/metropolisbymarcussamuelsson",instagram_url:"https://instagram.com/metropolisbymarcus",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tarallucci e Vino - NoMad",slug:"tarallucci-e-vino-nomad",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Italian",summary:"From their handcrafted pastries every morning, to their fresh pastas and locally and seasonally inspired Italian plates at night, Tarallucci e Vino invites you to start or end your day and unwind with them.",website:"https://www.taralluccievino.net/nomad",image_url:"//images.ctfassets.net/1aemqu6a6t65/7EJTVmgyeRkSqpkMl0Vpkq/355d2c1013da9c720e7276c564140b93/Tarallucci-e-Vino-NYC-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"261748",menu_url:"",primary_location:"Nomad",address:"44 E. 28th St., Manhattan, NY 10016",latitude:40.7433821,longitude:-73.9846389,telephone:"(212)7791100",price_range:"$",facebook_url:"https://www.facebook.com/taralluccinyc",instagram_url:"https://instagram.com/taralluccinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Iris",slug:"iris",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Greek",summary:"Inspired by the rich culinary traditions of the Mediterranean, chef John Fraser explores the cuisine of the Aegean at Iris.",website:"https://www.irisrestaurant.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/3XC9loGfN2FRhVYq4HWJmg/35979e611284465305bae635ffc5ed40/iris_interior_dining_room_-_conor_harrigan.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1063336",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46190-Iris-menu.pdf",primary_location:"Midtown West",address:"1740 Broadway, Manhattan, NY 10019",latitude:40.7651145,longitude:-73.9814962,telephone:"(212)9701740",price_range:"$",facebook_url:"https://www.facebook.com/irisrestaurantnyc",instagram_url:"https://instagram.com/irisrestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Stone Park Cafe",slug:"stone-park-cafe",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"American (New)",summary:` Park Slope, Brooklyn, has quickly risen to New York restaurant fame, and this neighborhood hotspot is no exception.
`,website:"https://www.stoneparkcafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6ySlr0W85Mx5iCkPj440E9/53670c430e35e6c43f297387e8c2730e/img_6572.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"6858",menu_url:"",primary_location:"Park Slope",address:"324 Fifth Ave., Brooklyn, NY 11215",latitude:40.6729864,longitude:-73.9833557,telephone:"(718)3690082",price_range:"$",facebook_url:"https://www.facebook.com/StoneParkCafe",instagram_url:"https://instagram.com/stoneparkcafe",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Quimby",slug:"the-quimby",borough:"Queens",neighborhood:"Jamaica",cuisine:"American (New)",summary:"The Quimby is named after the United State's first licensed female pilot, Harriet Quimby, a pioneer in aviation, known for her style and adventurous spirit.",website:"https://thequimbynyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4CMm6LQQMR5SU6ZxiZSgqV/0b399152d028c376cadbdf7e6f858c0f/The-Quimby-Queens-NYC-Photo-Concrete-Hospitality-Group.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1318840",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48983-Quimby-menu.pdf",primary_location:"Jamaica",address:"Marriott New York JFK Airport, 135-25 142nd St., 11436 Queens",latitude:40.6673965,longitude:-73.796598,telephone:"(347)5666233",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61556454196316",instagram_url:"https://instagram.com/thequimbynyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Sirene",slug:"la-sirene",borough:"Manhattan",neighborhood:"Soho",cuisine:"French",summary:"The menu at La Sirène is crafted to reflect the best of South France and the freshest ingredients of the season.",website:"https://lasirenenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2LZbeDCxUwJQsBTIJ0EQn/5eb46ac65fb37dbfbbebaedb56f418de/_V2A6069_ED30A104-9AF8-42C4-B618CF2E27400DC0_f61473d6-8945-49b9-bbbacb640da899d3.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38865-LaSirene-menu.pdf",primary_location:"Soho",address:"558 Broome St., Manhattan, NY 10013",latitude:40.7245417,longitude:-74.0057286,telephone:"(212)9253061",price_range:"$",facebook_url:"https://www.facebook.com/lasirenenyc",instagram_url:"https://instagram.com/lasirenenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Buddakan",slug:"buddakan-nyc",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Asian Fusion",summary:"Pan-Asian restaurant with large menu and ornate décor.",website:"https://buddakannyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6IdVFkYP0EyiIM8vrWXeNG/4373148293a6b1660406d35a02b95ad0/buddakan-chelsea-manhattab-nyc0161103-buddakan-new-york-0017.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"5002",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/27980-Buddakan-menu.pdf",primary_location:"Chelsea",address:"75 Ninth Ave., Manhattan, NY 10011",latitude:40.7424509,longitude:-74.0059581,telephone:"(212)9896699",price_range:"$",facebook_url:"https://www.facebook.com/buddakannyc",instagram_url:"https://instagram.com/buddakannyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hunter's Steak & Ale House",slug:"hunters-steak-ale-house",borough:"Brooklyn",neighborhood:"Bay Ridge",cuisine:"Steakhouse",summary:"Enjoy traditional dishes like homemade crab cakes, chicken wings, lobster tails and a variety of steaks and hearty fare.",website:"https://www.hunterssteakhouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6j9yuCbNP3646JKVmc3Ajq/3fc9cd45711f5bcd29c5a4ed5aeff265/Hunter-s-Steak-_-Ale-House-Brooklyn-NYC-Photo-Steve-Gannon.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/24660-Hunter%27sSteak%26AleHouse-menu.pdf",primary_location:"Bay Ridge",address:"9404 4th Ave., Brooklyn, NY 11209",latitude:40.616677,longitude:-74.0311876,telephone:"(718)2388899",price_range:"$",facebook_url:"https://www.facebook.com/HuntersSteakAndAle",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Musket Room",slug:"the-musket-room",borough:"Manhattan",neighborhood:"Nolita",cuisine:"American (New)",summary:"Chef Mary Attea leads a culinary team that draws on their heritages, world travels and personal inclinations to create vivid flavors and inventive dishes that deftly cross borders and defy categorization.",website:"https://www.musketroom.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/LZHwIadyzJigsbSvGWUle/4eb69570cd7564bd573361eafd3c417d/compressed-the-musket-room-nolita-manhattan-nyc-salmon_credit---signe-birck.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"106336",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40445-MusketRoom-menu.pdf",primary_location:"Nolita",address:"265 Elizabeth St., Manhattan, NY 10012",latitude:40.7239145,longitude:-73.9938152,telephone:"(212)2190764",price_range:"$",facebook_url:"https://www.facebook.com/TheMusketRoom",instagram_url:"https://instagram.com/musketroom",michelin_award:"ONE_STAR",michelin_slug:"the-musket-room",nyttop100_rank:""},{name:"Mito - Forest Hills",slug:"mito-forest-hills",borough:"Queens",neighborhood:"Forest Hills",cuisine:"Japanese / Sushi",summary:"Mito's esteemed head chef, who has devoted numerous years to the masterful art of cooking, brings with him a wealth of experience at esteemed establishments such as Jean Georges and Buddha Bar.",website:"https://themito.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/O7nDoCfodaZ3IkP9yrzox/84c98812eb55337f2b03ec39dc7059b3/Mito-Forest-Hills-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49414-Mito-ForestHills-menu.pdf",primary_location:"Forest Hills",address:"64-18 108th St., Queens, NY 11375",latitude:40.7323718,longitude:-73.8497752,telephone:"(718)8198817",price_range:"$",facebook_url:"https://www.facebook.com/mitoasianfusion",instagram_url:"https://instagram.com/mitomodernasian",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"GupShup",slug:"gupshup",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Indian",summary:"A modern Indian fusion restaurant brings colorful dishes and decor to Gramercy.",website:"https://www.gupshupnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5dG4cmcAwnjBHy5mtX0kHA/5dc28fb7bd2af15f1e88ce14756f7868/Leg-of-Lamb-3_B117D6BB-8FD0-4B74-A00DC6C0455756ED_528aeb09-dd6b-469b-b3f5bbf9776bc5c7.jpg",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1027957",menu_url:"",primary_location:"Gramercy",address:"115 E. 18th St., Manhattan, NY 10003",latitude:40.7368777,longitude:-73.98764,telephone:"(212)5187313",price_range:"$",facebook_url:"https://www.facebook.com/GupShupNYC",instagram_url:"https://instagram.com/gupshupnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Da Andrea - Chelsea",slug:"da-andrea-chelsea",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Italian",summary:"Experience the beauty of authentic Italian dining with a menu that specializes in the art of homemade pasta, traditional Italian dishes, delicious risottos, and more.",website:"https://daandreanyc.com/chelsea-location",image_url:"//images.ctfassets.net/1aemqu6a6t65/19qzAhWtCOhRBPcilhAvTw/c940d3edb43e3d0ce5247df7ec9a115d/Da-Andrea-Manhattan-NYC-Photo-Rachel-Bires-9.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1328881",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49319-DaAndrea-Chelsea-menu.pdf",primary_location:"Chelsea",address:"160 Eighth Ave., Manhattan, NY 10011",latitude:40.7420291,longitude:-74.0004666,telephone:"(212)3545971",price_range:"$",facebook_url:"https://www.facebook.com/daandreanyc",instagram_url:"https://instagram.com/daandreanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Havana Central",slug:"havana-central-times-square",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Cuban",summary:"Through its festive ambiance, vibrant décor and mouth-watering food, dining at Havana Central is like taking a mini vacation.",website:"https://www.havanacentral.com/location/times-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/1zUnH00hax0xIiwVuMSMU8/7984bdafc502e61371f4a96ddbc75835/rw-to-go_havana-central_b796e6ff-5056-a36f-23cb89f9f8d94015-b796e5875056a36_b796e76a-5056-a36f-23e4ab829b641aae__1_.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"4664",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/26384-HavanaCentral-menu.pdf",primary_location:"Times Square/Theatre District",address:"151 W. 46th St., Manhattan, NY 10036",latitude:40.7583422,longitude:-73.9841102,telephone:"(212)3987440",price_range:"$",facebook_url:"https://www.facebook.com/havanacentral",instagram_url:"https://instagram.com/havanacentral",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Baci & Abbracci",slug:"baci-and-abbracci",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Italian",summary:'Baci & Abbracci offers traditional Neapolitan fare as well as Italian classics from all over the "Boot."',website:"https://www.baciny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/483YorW9FyA5YfuIS2jbYn/3d044315c5200f8a8945bf75b48d234b/Baci-_-Abbracci-Brooklyn-NYC-Courtesy.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"20914",menu_url:"",primary_location:"Williamsburg",address:"204 Grand St., Brooklyn, NY 11211",latitude:40.713973,longitude:-73.960411,telephone:"(718)5996599",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kashkaval Garden",slug:"kashkaval-garden",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Mediterranean",summary:"Kashkaval Garden offers a casual, relaxed environment in which to enjoy wines, cocktails and Mediterranean food in Hell's Kitchen.",website:"https://www.kashkavalgarden.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/DrQxULQS8Dblpkx4agPOO/b0488aa2f7d6fec85bfed29e0e48b2ab/img_9423-edit_9f006e27-bb4d-4d74-90543f9ac6b915ac_3632677e-3a08-430c-b3932dd103255f7a.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45640-KashkavalGarden-menu.pdf",primary_location:"Hells Kitchen",address:"852 Ninth Ave., Manhattan, NY 10019",latitude:40.7667608,longitude:-73.9861939,telephone:"(212)2451758",price_range:"$",facebook_url:"https://www.facebook.com/kashkavalnyc",instagram_url:"https://instagram.com/KashkavalGarden",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kraam",slug:"kraam",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Thai",summary:"Kraam, a restaurant in NoMad, serves up authentic Thai cuisine with playful culinary twists.",website:"https://kraamnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/186YKPoVoPXPXiB1ZIkngx/a2fa435850a4062074bd33bc250ad83c/Kraam-Thai-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1403569",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49068-Kraam-menu.pdf",primary_location:"Nomad",address:"254 Fifth Ave., Manhattan, NY 10001",latitude:40.7449771,longitude:-73.9874335,telephone:"(646)6784586",price_range:"$",facebook_url:"https://www.facebook.com/kraamnyc",instagram_url:"https://instagram.com/kraam.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Fogo de Chão Brazilian Steakhouse",slug:"fogo-de-chao-churrascaria-brazilian-steakhouse",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Brazilian",summary:"Fogo de Chão is an authentic Brazilian steakhouse (churrascaria) that has been setting the standard in Brazil since 1979.",website:"https://fogodechao.com/location/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/7CygP3z6WLI7XudBq2jvlx/c0bb018439a8feb36e0cb8b555eb3ec5/compressed-fogodechao-groupdining-fogodechao_7c73b645-5056-a36f-23f1db1c476987b7.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"115417",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37929-FogodeChaoBrazilianSteakhouse-menu.pdf",primary_location:"Midtown West",address:"40 W. 53rd St., Manhattan, NY 10019",latitude:40.7610935,longitude:-73.9777823,telephone:"(212)9699980",price_range:"$",facebook_url:"https://www.facebook.com/fogorestaurants",instagram_url:"https://instagram.com/fogo",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sei Less",slug:"sei-less",borough:"Manhattan",neighborhood:"Garment District",cuisine:"Chinese",summary:"Curiously nestled behind an enigmatic mural in Midtown, behind a blink-and-you’ll-miss-it door stands Sei Less, an Asian fusion restaurant with an exclusive flair.",website:"https://www.seiless.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4N6Fyt0K6CAnqEhrF69lxU/202d38ad76b3491efc83e92357286155/Sei-Less-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1224220",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46461-SeiLess-menu.pdf",primary_location:"Garment District",address:"156 W. 38th St., Manhattan, NY 10018",latitude:40.7532237,longitude:-73.9884189,telephone:"(212)5862675",price_range:"$",facebook_url:"https://www.facebook.com/SeiLessNYC",instagram_url:"https://instagram.com/seilessnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Palm - Midtown",slug:"palm-midtown",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Steakhouse",summary:"The second in a chain of Palm restaurants, this one is located in the Theatre District.",website:"https://www.thepalm.com/location/the-palm-midtown/",image_url:"//images.ctfassets.net/1aemqu6a6t65/7bDNCGI4Og7YoIam2U7hKc/6af2c1b569a7d5a66ea436a347b24cf4/The-Palm-Manhattan-NYC-Photo-Landrys-Inc-3.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"13384",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/16297-Palm-Midtown-menu.pdf",primary_location:"Times Square/Theatre District",address:"250 W. 50th St., Manhattan, NY 10019",latitude:40.7618477,longitude:-73.9858466,telephone:"(212)3337256",price_range:"$",facebook_url:"https://www.facebook.com/palmwestnyc",instagram_url:"https://instagram.com/palmrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Barawine",slug:"barawine-harlem",borough:"Manhattan",neighborhood:"Harlem",cuisine:"French",summary:"This chic wine bar—overseen by Fabrice Warin, a restaurateur with roots in upmarket New York institutions like François Payard Bakery and Le Cercle Rouge—is an oenophile's dream.",website:"https://www.barawine.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5hd0aB8aSifjrqBh0COVLJ/0700d826460a46c9398bd413ca188717/Barawine-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"114856",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39191-Barawine-menu.pdf",primary_location:"Harlem",address:"200 Lenox Ave., Manhattan, NY 10027",latitude:40.8045891,longitude:-73.9474832,telephone:"(646)7564154",price_range:"$",facebook_url:"https://www.facebook.com/BarawineHarlem",instagram_url:"https://instagram.com/barawine_harlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Prohibition",slug:"prohibition",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (New)",summary:"This bar/restaurant offers a wide variety of cocktails, casual American fare and live music every night after 9pm.",website:"https://prohibition.net",image_url:"//images.ctfassets.net/1aemqu6a6t65/3KNBX7Km14UVZ9t9J6QR5T/920b18d1790d048cb6abcafdb4a612bb/prohibition-upper-west-side-manhattan-nyc-courtesy-20220716.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"",menu_url:"",primary_location:"Upper West Side",address:"503 Columbus Ave., Manhattan, NY 10024",latitude:40.7852237,longitude:-73.9727957,telephone:"(212)5793100",price_range:"$",facebook_url:"https://www.facebook.com/ProhibitionNYC",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Frankie & Johnnie’s Steakhouse",slug:"frankie-johnnies-steakhouse-46th-street",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Steakhouse",summary:"With some serious steaks and chops, this welcoming and unpretentious spot has quite the history as a real Prohibition-era speakeasy.",website:"https://frankieandjohnnies.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5Grddxsoh4imfRtKYCKlgb/5a314080203bdc7ae452b6dbd0510d40/fj_46.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"211633",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/7617-FrankieandJohnniesSteakhouse46thStreet-menu.pdf",primary_location:"Times Square/Theatre District",address:"320 W. 46th St., Manhattan, NY 10036",latitude:40.7599678,longitude:-73.9889027,telephone:"(212)9979494",price_range:"$",facebook_url:"https://www.facebook.com/FrankieandJohnnies46th",instagram_url:"https://instagram.com/frankiejohnnies",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Del Friscos Double Eagle Steakhouse New York",slug:"del-friscos-double-eagle-steakhouse-new-york",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Taiwanese",summary:"Del Frisco's Double Eagle Steakhouse New York is an energetic, sprawling, three-story restaurant in Midtown, featuring floor-to-ceiling windows that offer grand views of Sixth Avenue.",website:"https://www.delfriscos.com/location/del-friscos-double-eagle-steakhouse-new-york-ny",image_url:"//images.ctfassets.net/1aemqu6a6t65/122tBevoIZnnMgjSXavPI4/e5a62ae8429902a748f9f3bd9659b229/Del-Friscos-Double-Eagle-Steakhouse-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"42265",menu_url:"",primary_location:"Midtown West",address:"1221 Sixth Ave., Manhattan, NY 10020",latitude:40.7594995,longitude:-73.9822451,telephone:"(212)5755129",price_range:"$",facebook_url:"https://www.facebook.com/DelsNewYork",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sereneco",slug:"sereneco",borough:"Brooklyn",neighborhood:"Greenpoint",cuisine:"American (New)",summary:"Sereneco is an all-day restaurant in Greenpoint that serves seasonal New American cuisine alongside creative drinks.",website:"https://www.sereneconyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4x7Q5IGhuT3sBie06wF3nx/f47cf032a7a8000dbc700d95c3990fca/Sereneco-Apps-Spread-Brooklyn-NYC-Photo-Courtesy-Sereneco__1___1_.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"1208164",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45838-Sereneco-menu.pdf",primary_location:"Greenpoint",address:"113 Franklin St., Brooklyn, NY 11222",latitude:40.7301625,longitude:-73.9579347,telephone:"(929)2950152",price_range:"$",facebook_url:"https://www.facebook.com/sereneconyc",instagram_url:"https://instagram.com/sereneconyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ma•dé",slug:"ma-de",borough:"Manhattan",neighborhood:"Nolita",cuisine:"Asian Fusion",summary:"Ma•dé draws inspiration from the sandy beaches of Bali for both its menu and décor. ",website:"https://www.ma-de-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3Uj2DndolPC76rmShcNpMd/cd0913d777bbf02a8d22a01cf2297383/Ma-de-Manhattan-NYC-Photo-Noah-Fecks-4.jpg",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Nolita",address:"22 Spring St., Manhattan, NY 10012",latitude:40.7213331,longitude:-73.9951863,telephone:"(917)3883908",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/ma_de.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Oda House - Manhattan",slug:"oda-house-manhattan",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Eastern European",summary:"Devoted and passionate Michelin-recognized chef Maia Acquaviva, the co-founder of Oda House, immerses guests into the flavorful world of traditional Georgian dishes.",website:"https://odahouse.com/hours-locations/manhattan",image_url:"//images.ctfassets.net/1aemqu6a6t65/4MEyTvII4JB8aXSFEVBya6/59ebbde03b3b6944e97304503fe85cc7/Oda-House-Manhattan-NYC-Courtesy-_7.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1043122",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49351-OdaHouse-Manhattan-menu.pdf",primary_location:"Upper East Side",address:"406 E. 73rd St., Manhattan, NY 10021",latitude:40.7681035,longitude:-73.9549634,telephone:"(646)9985152",price_range:"$",facebook_url:"https://www.facebook.com/odahouse",instagram_url:"https://instagram.com/odahouseny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sae Ron",slug:"sae-ron",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"Korean",summary:"Sae Ron is a modern Korean kitchen dedicated to harmoniously blending traditional Korean dishes with contemporary culinary flavors and techniques.",website:"https://www.saeronnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1G7REwaUczwPGjJM6vPNNp/44f2d24a64c85aadfd9616a9ac9689d9/Sae-Ron-Manhattan-NYC-Photo-Christine-Yoo-1.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49762-SaeRon-menu.pdf",primary_location:"Lower East Side",address:"99 Stanton St., Manhattan, NY 10002",latitude:40.7211615,longitude:-73.9881158,telephone:"(646)4540848",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/saeronnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Café d’Anvers",slug:"cafe-danvers",borough:"Manhattan",neighborhood:"East Harlem",cuisine:"Belgian",summary:"Founded in late 2023 by chef Johan Halsberghe, known for his chocolate mousse, this bistro serves Belgian classic dishes and also chef's creations.",website:"https://cafedanversnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1mZqLCfDyHQasDJuN9rhBW/c41f6e90fbd65f536c67210fc3d0c081/Cafe-D-Anvers-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49384-Caf%C3%A9d%E2%80%99Anvers-menu.pdf",primary_location:"East Harlem",address:"1567 Lexington Ave., Manhattan, NY 10029",latitude:40.7884685,longitude:-73.9487946,telephone:"(917)7233005",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/cafedanversnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Red Rooster Harlem",slug:"red-rooster-harlem",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Soul Food / Southern",summary:"Marcus Samuelsson's restaurant focuses on elevated American comfort food.",website:"https://www.redroosterharlem.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4GGv9uJ9tdudefcoFmNJGg/540cb6608b9b7aa1738309eb22606ca4/red-rooster-harlem-srw-jen-davis.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"48841",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/35797-RedRoosterHarlem-menu.pdf",primary_location:"Harlem",address:"310 Lenox Ave., Manhattan, NY 10027",latitude:40.8080989,longitude:-73.9447535,telephone:"(212)7929001",price_range:"$",facebook_url:"https://www.facebook.com/RedRoosterHarlem",instagram_url:"https://instagram.com/roosterharlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pink Taco",slug:"pink-taco",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Mexican",summary:"Pink Taco isn’t just another taco joint. What they’re after is a detonation of flavors dancing on your tastebuds.",website:"https://www.pinktaco.com/locations/new-york-city",image_url:"//images.ctfassets.net/1aemqu6a6t65/5GY7oiXQvIiqH7QvzUhby6/34f32064d77e3b8b123cfbb7e0a1d697/LUNCHSPREAD1_8E3B67D7-9A7B-4AA9-8B81645BC7550728_82ac1bdb-35b4-45ed-97aae976df4a23b5.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1256761",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47784-PinkTaco-menu.pdf",primary_location:"Times Square/Theatre District",address:"7 Times Square, Manhattan, NY 10036",latitude:40.7557653,longitude:-73.9867598,telephone:"(212)3158226",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/pinktaco",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Wolfe",slug:"the-wolfe",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (New)",summary:"The Wolfe is a sports bar and restaurant inspired by Tom Wolfe, the late novelist and long-time NYC resident.",website:"https://www.thewolfenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6Lvcji4BuALEeU4pKkeVYb/5643770a43a631b5ffc833a37fa5f0a0/The-Wolfe-Manhattan-NYC-Photo-Alex-Staniloff-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48557-Wolfe-menu.pdf",primary_location:"Upper West Side",address:"425 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7839494,longitude:-73.9773996,telephone:"(646)8761004",price_range:"$",facebook_url:"https://facebook.com/thewolfenyc",instagram_url:"https://instagram.com/thewolfe.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"HanGawi",slug:"hangawi",borough:"Manhattan",neighborhood:"Koreatown",cuisine:"Korean",summary:"Slide off your shoes and sit down on a comfortable pillow at this fine-dining establishment serving Korean-inspired vegetarian cuisine in Manhattan's Koreatown.",website:"https://hangawirestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5pKR9YZlwqENvfAxlgvIfQ/97de662b6eca6643b5065820a5757096/hagawi-koreatown-manhattan-nyc-courtesy-061.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/9276-HanGawi-menu.pdf",primary_location:"Koreatown",address:"12 E. 32nd St., Manhattan, NY 10016",latitude:40.746542,longitude:-73.9848211,telephone:"(212)2130077",price_range:"$",facebook_url:"https://www.facebook.com/hangawinyc",instagram_url:"https://instagram.com/hangawi",michelin_award:"BIB_GOURMAND",michelin_slug:"hangawi",nyttop100_rank:""},{name:"Wallsé",slug:"wallse",borough:"Manhattan",neighborhood:"West Village",cuisine:"Austrian",summary:"This modern European restaurant offers an impeccable integration between fine dining and fine art.",website:"https://www.wallse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4dNXZ9uD63ILTYtER7A0Jo/c232c79535b59c638db40f9ffc4e0efe/Wallse_-Dining-Room-Manhattan-NYC-Photo-Courtesy-Wallse_.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38573-Walls%C3%A9-menu.pdf",primary_location:"West Village",address:"344 W. 11th St., Manhattan, NY 10014",latitude:40.7354249,longitude:-74.0082356,telephone:"(212)3522300",price_range:"$",facebook_url:"https://www.facebook.com/WallseNYC",instagram_url:"https://instagram.com/wallsenewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sant Ambroeus—West Village",slug:"sant-ambroeus-west-village",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Shortly after the original Sant Ambroeus opened its doors in Milan in 1936, a devoted following emerged.",website:"https://www.santambroeus.com/pages/location-west-village",image_url:"//images.ctfassets.net/1aemqu6a6t65/2poaJwkWUZ83XrpTIO4Vet/5faddbf8971a6d0a59cf13723eca5d89/sant_ambroeus_wine_bottles.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"",primary_location:"West Village",address:"259 W. 4th St., Manhattan, NY 10014",latitude:40.7354258,longitude:-74.003141,telephone:"(212)6049254",price_range:"$",facebook_url:"https://www.facebook.com/SantAmbroeus",instagram_url:"https://instagram.com/santambroeus",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Souvlaki GR - Lower East Side",slug:"souvlaki-gr",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"Greek",summary:"Fast, cheap and friendly, Souvlaki GR exudes the same spirit as its food truck, which began the enterprise.",website:"https://www.souvlakigr.com/location/souvlaki-gr-lower-east-side",image_url:"//images.ctfassets.net/1aemqu6a6t65/3ZFzCKHJrmmbbdC5nt4qg6/bf002e1fab686958fdc555cd24034f95/rw-to-go_souvlaki_gr_-_lower_east_side.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"81409",menu_url:"",primary_location:"Lower East Side",address:"116 Stanton St., Manhattan, NY 10002",latitude:40.7212335,longitude:-73.9871175,telephone:"(212)7770116",price_range:"$",facebook_url:"https://www.facebook.com/souvlakigr",instagram_url:"https://instagram.com/souvlakigr",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Da Andrea - Greenwich Village",slug:"da-andrea-greenwich-village",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Italian",summary:"Experience the beauty of authentic Italian dining with a menu that specializes in the art of homemade pasta, traditional Italian dishes, delicious risottos, and more.",website:"https://daandreanyc.com/greenwich-village",image_url:"//images.ctfassets.net/1aemqu6a6t65/3DtnY1VDZLVeX07b7C7LdI/a93306968598184d3755d918d9daa8b6/Da-Andrea-Manhattan-NYC-Photo-Rachel-Bires-4.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"192976",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49726-DaAndrea-GreenwichVillage-menu.pdf",primary_location:"Greenwich Village",address:"35 W. 13th St., Manhattan, NY 10011",latitude:40.7362477,longitude:-73.9958123,telephone:"(212)3671979",price_range:"$",facebook_url:"https://www.facebook.com/daandreanyc",instagram_url:"https://instagram.com/daandreanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Maiella",slug:"maiella",borough:"Queens",neighborhood:"Long Island City",cuisine:"Italian",summary:"Enjoy casual and rustic Italian waterfront dining in Long Island City.",website:"https://www.maiellalic.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2vqFFxrX2s5DewBKlOnFML/4ef7ed1c111b25aae117050e5daa67c5/Maiella-Long-Island-City-Queens-NYC-10-3586e6665056a36_3586e871-5056-a36f-238f477afbc928ab.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"162811",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39720-Maiella-menu.pdf",primary_location:"Long Island City",address:"4610 Center Blvd., Queens, NY 11109",latitude:40.74729,longitude:-73.9568372,telephone:"(718)6061770",price_range:"$",facebook_url:"https://www.facebook.com/maiellany",instagram_url:"https://instagram.com/MAIELLA_LIC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Barano",slug:"barano",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Italian",summary:`Fire-roasted, grandma-inspired Italian food in Williamsburg.
`,website:"https://www.baranobk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/qkcVTPdIMELQm3bCkpht2/47a8a5de5c6bc90a96abd0c65a1b59ed/Barano-Williamsburg-Brooklyn-NYC-0330-9aa2f3045056a36_9aa2f485-5056-a36f-23d2b86949fb6e6e.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"189313",menu_url:"",primary_location:"Williamsburg",address:"26 Broadway, Brooklyn, NY 11249",latitude:40.7103553,longitude:-73.9678051,telephone:"(347)9874500",price_range:"$",facebook_url:"https://www.facebook.com/BARANOBK",instagram_url:"https://instagram.com/baranobk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Veerays",slug:"veerays",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Indian",summary:"Located in Manhattan's Midtown East, Veerays is NYC’s first Indian speakeasy restaurant, envisioned by Michelin-starred chef Hemant Mathur.",website:"https://www.veerays.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5xpcE097kWwS0TqkYdTiq3/5a1753f3d1d18bde0764d3b26dee68b3/Veerays-Manhattan-NYC-Courtesy-_2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown East",address:"213 E. 45th St., Manhattan, NY 10017",latitude:40.7525585,longitude:-73.9722846,telephone:"(646)4298398",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/veerays.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tavola",slug:"tavola",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Italian",summary:"Tavola is an authentic Italian restaurant focused on Sicilian, Apulian and Roman cuisine, specializing in wood-fired pizzas, Italian pastas, seafood and other traditional Italian dishes",website:"https://tavolahellskitchen.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7H5iVZ7mk5UkLYvzJyQc0k/b43919bcff1135bbdbdeb323c24a1b22/Tavola-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48979-Tavola-menu.pdf",primary_location:"Hells Kitchen",address:"488 Ninth Ave., Manhattan, NY 10018",latitude:40.7554215,longitude:-73.9945297,telephone:"(212)2731181",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/tavolanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Barbalu Bklyn",slug:"barbalu-bklyn",borough:"Brooklyn",neighborhood:"Boerum Hill",cuisine:"Italian",summary:"This Boerum Hill Italian restaurant is Stefano Barbagallo and Adriana Luque's second, following their Seaport location that opened in 2013.",website:"https://www.barbalu.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5yWmenWBacD6YImzK698wW/907e2acc0d0e6b3f85b4e27cb78a7129/compressed-barbalu-bkln-boreum-hill-brooklyn-nyc-courtesy-20220718__1_.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Boerum Hill",address:"68 Bergen St., Brooklyn, NY 11201",latitude:40.6867438,longitude:-73.9910146,telephone:"(347)2944287",price_range:"$",facebook_url:"https://www.facebook.com/BarbaluBklyn",instagram_url:"https://instagram.com/BarbaluBklyn",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Via 13",slug:"via-13",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Via 13, set in the West Village, serves the essence of Italy today—bold flavors, warm hospitality, and surprising twists make every visit unforgettable.",website:"https://via13nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/d2KKRF8sAqChgrZdaH1J9/365086ae0359a6ac905a45bf3eb9ec8d/Via-13-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"76384",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48711-Via13-menu.pdf",primary_location:"West Village",address:"140 W. 13th St., Manhattan, NY 10011",latitude:40.7372586,longitude:-73.9991582,telephone:"(212)6471001",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Osteria 57",slug:"osteria-57",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Italian",summary:"Osteria 57 offers a different kind of Italian menu, combining seafood choices and vegetarian dishes.",website:"https://osteria57.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2vJ0cRZiEy0Ta7QVOnTJOp/26cd23fae0cdfe8b4eda151674271748/Osteria-57-Manhattan-NYC-Photo-Embe-restaurant-Corp-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41052-Osteria57-menu.pdf",primary_location:"Greenwich Village",address:"453 Sixth Ave., Manhattan, NY 10011",latitude:40.735162,longitude:-73.9987529,telephone:"(212)7770057",price_range:"$",facebook_url:"https://www.facebook.com/osteria57",instagram_url:"https://instagram.com/osteria57",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Virgil's Real BBQ - Times Square",slug:"virgils-real-bbq-times-square",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Barbecue",summary:"Good barbeque is surprisingly hard to find in New York, but Virgil's was among the first to boldly promise the real deal.",website:"https://www.virgilsbbq.com/locations/times-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/4lRGZSU3BSKKEWspC3OgOg/dc7ca2d40145fe081308f66a227425a5/05_virgils_-_virgils_pig_out_2_danielkrieger.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"2298",menu_url:"",primary_location:"Times Square/Theatre District",address:"152 W. 44th St., Manhattan, NY 10036",latitude:40.7567595,longitude:-73.9851662,telephone:"(212)9219494",price_range:"$",facebook_url:"https://www.facebook.com/Virgilsrealbbq",instagram_url:"https://instagram.com/virgilsrealbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Scarpetta",slug:"scarpetta",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Italian",summary:"It all started in a Greek revival townhouse on the edge of the Meatpacking District, where LDV Hospitality brought an unexpected and soulful touch to Italian cuisine.",website:"https://www.scarpettarestaurants.com/location/scarpetta-new-york-city",image_url:"//images.ctfassets.net/1aemqu6a6t65/4rYDidAcoZZo4dInKL2llm/eefb37988b294f9a2f93e6abb72d5d4d/RW-To-Go_Scarpetta_E685E032-5056-A36F-2365124D94350A20-e685df1c5056a36_e685e085-5056-a36f-2357667869a8a24a.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"",menu_url:"",primary_location:"Nomad",address:"The James New York—NoMad, 88 Madison Ave., 10016 Manhattan",latitude:40.7444392,longitude:-73.9857838,telephone:"(212)6910555",price_range:"$",facebook_url:"https://www.facebook.com/ScarpettaNYC",instagram_url:"https://instagram.com/scarpettarestaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Yakiniku Futago",slug:"yakiniku-futago",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Steakhouse",summary:"Sleek and dimly lit Yakiniku Futago specializes in Japanese barbecue.",website:"https://www.futago25usa.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4E4fLV9Lm88iAhl1zqqcmH/3001fd8c4948bea304bb5fa68fc771fe/Yakiniku-Futago-Chelsea-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"168805",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44775-YakinikuFutago-menu.pdf",primary_location:"Flatiron District",address:"37 W. 17th St., Manhattan, NY 10011",latitude:40.7388959,longitude:-73.9940906,telephone:"(212)6200225",price_range:"$",facebook_url:"https://www.facebook.com/Yakiniku-Futago-USA-1576660339237848",instagram_url:"https://instagram.com/futago.usa",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"T Bar",slug:"t-bar",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (New)",summary:"New York has some of the best steaks in the country, and this restaurant on the Upper East Side certainly holds its own.",website:"https://tbar.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/1SccxATct9JYtXbfdu0npx/a79cf30aa3adfe65ab34ae38d7cf167d/H92A9975_15330F2A-69F3-4199-A6454617F52DB6ED_25d1c139-f6ca-4426-bb9c764744efc7e6.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"116 E. 60th St., Manhattan, NY 10022",latitude:40.763048,longitude:-73.9687092,telephone:"(212)7720404",price_range:"$",facebook_url:"https://www.facebook.com/tbarnyc",instagram_url:"https://instagram.com/tbarnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Blue Fin",slug:"blue-fin",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Seafood",summary:"Set in Times Square—a neighborhood better known for trinkets and fast food chains—Blue Fin is an outlier and a standout.",website:"https://www.bluefinnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3qSIzJxOnJi2vqxAoK9nVx/1c4cb0ef7df126ef8235a4fe750e4762/Blue-Fin-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"30505",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/20975-BlueFin-menu.pdf",primary_location:"Times Square/Theatre District",address:"W New York–Times Square, 1567 Broadway, 10036 Manhattan",latitude:40.7593016,longitude:-73.9855873,telephone:"(212)9181400",price_range:"$",facebook_url:"https://www.facebook.com/BlueFinNYC",instagram_url:"https://instagram.com/bluefinnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosa Mexicano - Lincoln Center",slug:"rosa-mexicano-lincoln-center",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Mexican",summary:"Setting a standard in authentic Mexican cooking since opening its doors, Rosa Mexicano now has three locations throughout NYC.",website:"https://rosamexicano.com/location/lincoln-center",image_url:"//images.ctfassets.net/1aemqu6a6t65/52jcAVEI7H6kIPpBaWaQnD/3100b141473c73cad2d5a47c77374244/rosa-mexicano-photo-cody-rasmossen-01.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1787",menu_url:"",primary_location:"Upper West Side",address:"61 Columbus Ave., Manhattan, NY 10023",latitude:40.771105,longitude:-73.9829577,telephone:"(212)9777700",price_range:"$",facebook_url:"https://www.facebook.com/rosamexicano",instagram_url:"https://instagram.com/rosamexicano",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Morton's The Steakhouse—World Trade Center",slug:"mortons-the-steakhouse-world-trade-center",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"Steakhouse",summary:"Nestled in the heart of Lower Manhattan, located in the World Trade Center, Morton's The Steakhouse is a true blend of classic cuisine and contemporary style.",website:"https://www.mortons.com/newyorkwtc",image_url:"//images.ctfassets.net/1aemqu6a6t65/1AvtbHZFk9BpeSzM2I9838/01ab769275cb50e0bf090777a967c686/mortons-wtc-boardrooma.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"107920",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37794-Morton%27sTheSteakhouseWorldTradeCenter-menu.pdf",primary_location:"Lower Manhattan",address:"136 Washington St., Manhattan, NY 10006",latitude:40.7097089,longitude:-74.0139508,telephone:"(212)6080171",price_range:"$",facebook_url:"https://www.facebook.com/Mortons",instagram_url:"https://instagram.com/MortonsSteak",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Grotta Azzurra",slug:"grotta-azzurra-restaurant",borough:"Manhattan",neighborhood:"Little Italy",cuisine:"Italian",summary:"After a hundred years in Little Italy, Grotto Azzurra is holding down its history as host to Caruso and Sinatra; that same hospitality extends to the travelers and locals who pack the recently renovated restaurant.",website:"https://bluegrotta.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4WOLaXrTHQFNjNZLRCZZav/9f0d808b221b8db3bc9c327710a621da/grotta-azzurra-little-italy-manhattan-nyc-courtesy-059.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/10954-GrottaAzzurra-menu.pdf",primary_location:"Little Italy",address:"177 Mulberry St., Manhattan, NY 10013",latitude:40.7202466,longitude:-73.997079,telephone:"(212)9258775",price_range:"$",facebook_url:"https://www.facebook.com/GrottaAzzurra",instagram_url:"https://instagram.com/GrottaAzzurraNY",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Lillie's Victorian—Union Square",slug:"lillies-victorian-establishment-union-square",borough:"Manhattan",neighborhood:"Union Square",cuisine:"American (New)",summary:'Combines an authentic ostentatious decor and mellow ambiance, representing one of the last great Victorian "gin palaces" that once flourished in the industrial cities of Northern Ireland and England.',website:"https://www.lilliesnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4oqiVV8pj9kcvclJACRx89/79f340881e3e12311e1c79e5f408dfba/lillies-victorian-union-square_simmer-group_20161109_0089.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39816-Lillie%27sVictorianEstablishment%E2%80%94UnionSquare-menu.pdf",primary_location:"Union Square",address:"13 E. 17th St., Manhattan, NY 10003",latitude:40.7375016,longitude:-73.9912571,telephone:"(212)3371970",price_range:"$",facebook_url:"https://www.facebook.com/lilliesvictorian",instagram_url:"https://instagram.com/lilliesvictorian",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Crave Fishbar - Upper East Side",slug:"crave-fishbar-upper-east-side",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Seafood",summary:"This Upper East Side location serves creative seafood in an upscale neighborhood setting, complete with warm hospitality.",website:"https://cravefishbar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7gDg0ajOAkA7brQCq1NcUT/fe5d6027897070c346f05e09ef511a14/CRAVE-9899_E666ACCA-4CAC-4CBE-A00FD04607925033_0915f7d8-571f-41fe-91b5c11e572de19b.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1380592",menu_url:"",primary_location:"Upper East Side",address:"1462 Second Ave., Manhattan, NY 10075",latitude:40.7715707,longitude:-73.9560109,telephone:"(212)6888886",price_range:"$",facebook_url:"https://www.facebook.com/cravefishbar",instagram_url:"https://instagram.com/cravefishbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"London Lennie's",slug:"london-lennies",borough:"Queens",neighborhood:"Forest Hills",cuisine:"Seafood",summary:"Founded in 1959 by a couple who relocated from England, London Lennie's has evolved into a premier seafood restaurant, now owned by their son.",website:"https://www.londonlennies.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4Jx8YFhKZhxXPgXl4BXlqt/123a3ed71bb3916bda35c6479132eff2/London-Lennies-Forest-Queens-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"",menu_url:"",primary_location:"Forest Hills",address:"63-88 Woodhaven Blvd., Queens, NY 11374",latitude:40.7221282,longitude:-73.8676598,telephone:"(718)8948084",price_range:"$",facebook_url:"https://www.facebook.com/londonlennies.seafood",instagram_url:"https://instagram.com/londonlennies",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Sirene UWS",slug:"la-sirene-uws",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"French",summary:"Chef/owner Didier Pawlicki's menu at La Sirène is crafted to reflect the best of South France and the freshest ingredients of the season.",website:"https://lasirenenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4IJmEMwKZm1c6UqRblIRnk/8cf0b7fb2d6f08a7b87f3127043de948/_V2A6172_A44D1C85-5542-49A8-94041871BDF1B87F_98ba119c-a1f5-4be0-8218ebcb40fabdbb.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40695-LaSireneUWS-menu.pdf",primary_location:"Upper West Side",address:"416 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7838279,longitude:-73.9780648,telephone:"(917)2615279",price_range:"$",facebook_url:"https://www.facebook.com/lasirenenyc",instagram_url:"https://instagram.com/lasirenenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chez Nick",slug:"chez-nick",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (New)",summary:"Three chefs have collaborated to create an elevated neighborhood dining experience at this Upper East Side seasonal New American restaurant.",website:"https://www.cheznicknyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4fqQet1BLDhBcabhViwok5/e7634215e85477717f7cb4c9d4935729/rw-to-go_chez_nick.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"1737 York Ave., Manhattan, NY 10128",latitude:40.7790105,longitude:-73.9452127,telephone:"(646)4293310",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100070841124844",instagram_url:"https://instagram.com/cheznicknyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Balade",slug:"balade",borough:"Manhattan",neighborhood:"East Village",cuisine:"Middle Eastern",summary:"Omar Daoud, executive chef at Balade, is a culinary virtuoso in Middle Eastern cuisine, with a particular expertise in Lebanese dishes.",website:"https://www.baladerestaurants.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/HK6XTxa1A6lZl4ZFrcHPe/91fb590f0b19d27a454b76a5c8b96edd/Balade-Manhattan-NYC-Photo-Daniel-Kwock.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"41515",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48315-Balade-menu.pdf",primary_location:"East Village",address:"208 First Ave., Manhattan, NY 10009",latitude:40.7302839,longitude:-73.9830748,telephone:"(212)5296868",price_range:"$",facebook_url:"https://www.facebook.com/baladenyc",instagram_url:"https://instagram.com/baladenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bananas",slug:"bananas",borough:"Manhattan",neighborhood:"East Village",cuisine:"American (New)",summary:"Bananas is an expression of the chef-owners' take on Asian American food, incorporating classic Asian flavors with Western cuisine—a signature menu of American favorites with elements of Asian cooking.",website:"https://www.bananasrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/El079LSI4OcfNswrgeKNH/f08060035529319e0a91cace8923583a/Bananas-Manhattan-NYC-Photo-Raychel-Brightman-3.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49803-Bananas-menu.pdf",primary_location:"East Village",address:"174 First Ave., Manhattan, NY 10009",latitude:40.7290328,longitude:-73.9839151,telephone:"(646)4227169",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/bananas_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Long Room",slug:"the-long-room",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Irish",summary:"The Long Room is an authentic Irish bar and gastropub located in Times Square.",website:"https://www.thelongroomnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/70XbGURMG60mcYwfEJQ4SS/f44386a4f4804e4363e0d49417f996da/the_long_room.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46442-LongRoom-menu.pdf",primary_location:"Times Square/Theatre District",address:"120 W. 44th St., Manhattan, NY 10036",latitude:40.7564107,longitude:-73.9843398,telephone:"(212)9973933",price_range:"$",facebook_url:"https://www.facebook.com/thelongroomnyc",instagram_url:"https://instagram.com/thelongroomnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Blue Mezze Bar - UES",slug:"blue-mezze-bar-ues",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Mediterranean",summary:"Blue Mezze Bar - UES is a unique Mediterranean restaurant/bar on Manhattan's Upper East Side with an extensive mezze and cocktail menu, ideal for sharing and tasting.",website:"https://ues.bluemezze.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3fk5s52lpvRYcncCrFk5Jw/70cd967163b64e7159b1bed6222648bf/Blue-Mezze-Manhattan-NYC-Courtesy-.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1201135",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46106-BlueMezzeBar-UES-menu.pdf",primary_location:"Upper East Side",address:"1480 Second Ave., Manhattan, NY 10075",latitude:40.7720339,longitude:-73.9556467,telephone:"(646)3466161",price_range:"$",facebook_url:"https://www.facebook.com/thebluemezze",instagram_url:"https://instagram.com/bluemezze",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Plado Tasting Bar",slug:"plado-tasting-bar",borough:"Manhattan",neighborhood:"East Village",cuisine:"Mediterranean",summary:"Try well-crafted Mediterranean tapas at this East Village restaurant.",website:"https://pladohospitality.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6rJYsfIJ9cUm5p3MnDgu52/581804354d864906e6393385f1a34858/plado-tasting-bar-east-village--manhattan-nyc-courtesy-013.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1055296",menu_url:"",primary_location:"East Village",address:"192 E. 2nd St., Manhattan, NY 10009",latitude:40.7225464,longitude:-73.9838548,telephone:"(646)8505151",price_range:"$",facebook_url:"https://www.facebook.com/pladoNYC",instagram_url:"https://instagram.com/plado_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Victor's Cafe",slug:"victors-cafe",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Cuban",summary:"Victor’s, in the Theatre District, has been a redoubt for high-end Cuban food for decades.",website:"https://victorscafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2DMbDK3RTAuYIeTh2xyYUQ/859ff2ff8de54881f48d2e3315c97094/Victors-Cafe-Manhattan-NYC-Photo-Courtesy-Victors-Cafe__1___1_.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"3716",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/8278-Victor%27sCafe-menu.pdf",primary_location:"Times Square/Theatre District",address:"236 W. 52nd St., Manhattan, NY 10019",latitude:40.7628914,longitude:-73.9841186,telephone:"(212)5867714",price_range:"$",facebook_url:"https://www.facebook.com/VictorsCafe",instagram_url:"https://instagram.com/victorscafenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Clocktower",slug:"the-clocktower",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"British",summary:"This chic 88-seat, David Rockwell-designed restaurant serves contemporary cuisine with British sensibilities.",website:"https://theclocktowernyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1joDrx3rx0xLQZp1lY65Fa/78de077d42f604267b8b4792d8a8d8b3/the-clocktower-food-nick-solares.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"",menu_url:"",primary_location:"Flatiron District",address:"The New York Edition, 5 Madison Ave. (enter on 24th St.), 10010 Manhattan",latitude:40.741286,longitude:-73.9873577,telephone:"(212)4134300",price_range:"$",facebook_url:"https://www.facebook.com/TheClocktowerNYC",instagram_url:"https://instagram.com/clocktowernyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Independent",slug:"the-independent",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"American (New)",summary:"The Independent is a snug and stylish space for notable drinks and food in Times Square, not far from Broadway theaters, the Garment District and Bryant Park.",website:"https://www.theindependentnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3PE1KY99e0mVROkEH9YZbK/8fcc47ab6a18ea6b64a10d733fa8c608/the_independent.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46076-Independent-menu.pdf",primary_location:"Times Square/Theatre District",address:"147 W. 40th St., Manhattan, NY 10018",latitude:40.7546804,longitude:-73.9874917,telephone:"(917)3883727",price_range:"$",facebook_url:"https://www.facebook.com/theindependentnyc",instagram_url:"https://instagram.com/theindependentnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Fulton",slug:"the-fulton",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"Seafood",summary:"Dine at Jean-Georges Vongerichten's celebration of fresh seafood in the Seaport.",website:"https://www.thefulton.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/1FuxiF4G7o8HIW5TWDrxnD/1460165869ee7ca7535e9584de95b4a8/The-Fulton-Seaport-Manhattan-NYC-Photo-Mike-Szpot-on-behalf-of-The-Seaport-3.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["summer-vibes"],opentable_id:"",menu_url:"",primary_location:"The Seaport",address:"Pier 17, 89 South St., 10038 Manhattan",latitude:40.705573,longitude:-74.0014567,telephone:"(212)8381200",price_range:"$",facebook_url:"https://www.facebook.com/TheFultonNYC",instagram_url:"https://instagram.com/thefultonnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Luigi's",slug:"luigis",borough:"Queens",neighborhood:"New Hyde Park",cuisine:"Italian",summary:"Since 1992, guests have come to Luigi's in New Hyde Park, Queens, to enjoy a well-made cocktail, a diverse selection of wines and an unforgettable meal.",website:"https://www.luigisnewhydepark.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6YpPjzTel2upq30kV2GZb5/e1832ad34614462e04a111efc7182988/Luigis-Restaurant-Hyde-Park-NYC-Photo-Stephanie-S.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"106588",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45793-Luigi%27s-menu.pdf",primary_location:"New Hyde Park",address:"265-21 Union Tpke., Queens, NY 11040",latitude:40.7496513,longitude:-73.7075825,telephone:"(718)3477136",price_range:"$",facebook_url:"https://www.facebook.com/LuigisNY",instagram_url:"https://instagram.com/luigis_restaurant_nhp",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jue Lan Club",slug:"jue-lan-club",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Chinese",summary:"Occupying the historic Limelight space, this elegant Flatiron restaurant serves Asian food with modern touches.",website:"https://www.juelanclub.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2yhiPYJBsg1vtLCUvN3Gi1/5eff51e0d03f23bfba135307382441e0/Jue-Lan-Club-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"191161",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39750-JueLanClub-menu.pdf",primary_location:"Flatiron District",address:"49 W. 20th St., Manhattan, NY 10011",latitude:40.7409034,longitude:-73.9933383,telephone:"(646)5247409",price_range:"$",facebook_url:"https://www.facebook.com/JueLanClub",instagram_url:"https://instagram.com/juelanclub",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Travelers Poets & Friends",slug:"travelers-poets-and-friends",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Travelers Poets & Friends captures the essence of the Italian coastline with its authentic offerings.",website:"https://travelerspoetsandfriends.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/24Y9gLyo5HbWijdgwtLp97/b7b5b2fd462ca326a40d699f8ab7484f/Travelers-Poets-and-Friends-Manhattan-NYC-Photo-Masticabrodo-llc-2.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48971-TravelersPoets%26Friends-menu.pdf",primary_location:"West Village",address:"457 Sixth Ave., Manhattan, NY 10011",latitude:40.735255,longitude:-73.998673,telephone:"(212)4200057",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/travelerspoetsandfriends",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Atla",slug:"atla",borough:"Manhattan",neighborhood:"Noho",cuisine:"Mexican",summary:"Mexican celebrity chef Enrique Olvera opened an all-day eatery in Noho.",website:"https://www.eatatla.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5gIREuaWbO4Al2folQcvYV/bd81b6fa9adf993fcc3cfc3f2ed27a8a/ATLA-Manhattan-NYC-Photo-Araceli-Paz-4.jpg",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44266-Atla-menu.pdf",primary_location:"Noho",address:"372 Lafayette St., Manhattan, NY 10012",latitude:40.7271217,longitude:-73.9940491,telephone:"(347)6623522",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/eatatla",michelin_award:"BIB_GOURMAND",michelin_slug:"atla",nyttop100_rank:""},{name:"Ootoya - Union Square",slug:"ootoya-union-square",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Japanese / Sushi",summary:"The specialty at Greenwich Village's Ootoya - Union Square is traditional Japanese home cooking in set-meal style, or teishoku.",website:"https://ootoya.us",image_url:"//images.ctfassets.net/1aemqu6a6t65/1mXv3jsmwRfeS7BiDyLOol/3aef7dbfeb3461f696f478dea7983565/Ootoya-Manhattan-NYC-Photo-Hachikin-Creative-5.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45696-Ootoya-UnionSquare-menu.pdf",primary_location:"Greenwich Village",address:"41 E. 11th St., Manhattan, NY 10003",latitude:40.7332423,longitude:-73.9929048,telephone:"(212)4734300",price_range:"$",facebook_url:"https://www.facebook.com/Ootoyanyc",instagram_url:"https://instagram.com/ootoyanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Essex",slug:"essex",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"American (New)",summary:"Located in the historic Essex Street Market Building, Essex is a loft-like multilevel space with contemporary cuisine inspired by the flavors of the Lower East Side.",website:"https://www.essexnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4oIY15T2edayZrC83whiZs/f071d16b24219fa1a34be25ae7d28ab9/Essex-Restaurant-Manhattan-NYC-Photo-Courtesy-Essex-Restaurant-2.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"13675",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38771-Essex-menu.pdf",primary_location:"Lower East Side",address:"124 Rivington St., Manhattan, NY 10002",latitude:40.7199179,longitude:-73.987059,telephone:"(212)5339616",price_range:"$",facebook_url:"https://www.facebook.com/EssexNYC",instagram_url:"https://instagram.com/essexrestaurant.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Siren Oyster Bar & Restaurant",slug:"siren-oyster-bar-and-restaurant",borough:"Brooklyn",neighborhood:"South Slope",cuisine:"Seafood",summary:"Siren is a contemporary European seafood restaurant in South Slope, Brooklyn, specializing in modern dishes and an extensive oyster selection.",website:"https://www.sirenbk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/29tndd6mPfYspCz8tMMP4H/0c43dc39575f63b3c414c919b19aa24a/Siren-Oyster-Bar-_-Restaurant-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1329493",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48685-SirenOysterBar%26Restaurant-menu.pdf",primary_location:"South Slope",address:"687 Fifth Ave., Brooklyn, NY 11215",latitude:40.6614403,longitude:-73.9930691,telephone:"(347)6894577",price_range:"$",facebook_url:"https://www.facebook.com/SirenBrooklyn",instagram_url:"https://instagram.com/siren.bk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosemary's West Village",slug:"rosemarys-west-village",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Rosemary's evokes an enclosed Italian courtyard, full of greenery, reclaimed-wood tables, exposed-brick walls and terra-cotta flooring.",website:"https://www.rosemarysnyc.com/location/rosemarys-west-village",image_url:"//images.ctfassets.net/1aemqu6a6t65/2FrNNHQtEf389rVWlzJDTW/8b390ad74acd879af0cafb25762f76da/rosemarys-west-village-manhattan-photo-courtesy.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"150718",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45429-Rosemary%27sWestVillage-menu.pdf",primary_location:"West Village",address:"18 Greenwich Ave., Manhattan, NY 10011",latitude:40.7348852,longitude:-73.9996717,telephone:"(212)6471818",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61575106562084",instagram_url:"https://instagram.com/rosemarysrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Masseria East",slug:"masseria-east",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Masseria East continues the fine dining legacy of the old Parma Restaurant, which was established in this location in 1977.",website:"https://masseriaeast.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/KZH8k4E91DaZRWXPDWdcz/c28be0f570df3c68a49dc3737a0e8bc0/Masseria-East-Manhattan-NYC-Photo-Giorgio-Manzio-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"220543",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47936-MasseriaEast-menu.pdf",primary_location:"Upper East Side",address:"1404 Third Ave., Manhattan, NY 10075",latitude:40.7749099,longitude:-73.9571627,telephone:"(212)5353520",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/masseriaeast",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"ABC Cocina",slug:"abc-cocina",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Latin American",summary:"ABC Kitchen has a design of ethereal lightness, while its sister restaurant, ABC Cocina, is all dark magic.",website:"https://www.abccocina.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/5k6uOVYKRQ37B8QELizZyD/8a4b4e9dae884006619af394c75141e4/abc-cocina-tagger-yancey-iv-4723.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1286",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39079-ABCCocina-menu.pdf",primary_location:"Union Square",address:"38 E. 19th St., Manhattan, NY 10003",latitude:40.7379868,longitude:-73.9892758,telephone:"(212)4755829",price_range:"$",facebook_url:"https://www.facebook.com/ABC-Cocina-402443796503622",instagram_url:"https://instagram.com/abccocina",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Anassa Taverna - Manhattan",slug:"anassa-taverna",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Greek",summary:'Anassa ("breath of fresh air" in Greek) is an elegant interpretation of the traditional Greek taverna.',website:"https://anassataverna.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4peRXudOaUfLR71RhGL2uB/86c5ddd7b127493b57b6ede4b8c62dfd/anassa-taverna-skordas-design-studio.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38306-AnassaTaverna-Manhattan-menu.pdf",primary_location:"Upper East Side",address:"200 E. 60th St., Manhattan, NY 10022",latitude:40.7619091,longitude:-73.9658824,telephone:"(212)3715200",price_range:"$",facebook_url:"https://www.facebook.com/anassanyc",instagram_url:"https://instagram.com/anassataverna",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Grande Boucherie",slug:"la-grande-boucherie",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"French",summary:"With a dazzling dining gallery, this one-of-a-kind brasserie is built in the tradition of the Belle Epoque, inspired by elegant and ornamental Art Nouveau style.",website:"https://www.boucherieus.com/location/boucherie-la-grande-boucherie",image_url:"//images.ctfassets.net/1aemqu6a6t65/44tsngAW4zn4hmGHUiUgKV/9fdc35b32979635967f58c80379ab7fc/La-Grand-Boucherie-Manhattan-NYC-Photo-Rachel-Bires-1.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"1142380",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46075-LaGrandeBoucherie-menu.pdf",primary_location:"Midtown West",address:"145 W. 53rd St., Manhattan, NY 10019",latitude:40.7626345,longitude:-73.9808359,telephone:"(212)5107714",price_range:"$",facebook_url:"https://www.facebook.com/BoucherieNYC",instagram_url:"https://instagram.com/boucherie_us",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cosme",slug:"cosme-flatiron-district",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Mexican",summary:"Mexican inspired rather than straightforward Mexican describes the innovative, vibrant dishes at Enrique Olvera's Cosme.",website:"https://www.cosmenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/30rw6lE4PgG1fokKJBvmwk/ad7427513cadbb6afcf6453d1e8192a4/Cosme-Manhattan-NYC-Photo-Araceli-Paz-6.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38375-Cosme-menu.pdf",primary_location:"Flatiron District",address:"35 E. 21st St., Manhattan, NY 10010",latitude:40.7395952,longitude:-73.98835640000001,telephone:"(212)9139659",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/cosmenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Keuka Kafe",slug:"keuka-kafe-a-wine-bar",borough:"Queens",neighborhood:"Forest Hills",cuisine:"American (New)",summary:"Keuka Kafe is a New American restaurant and wine bar in Forest Hills, Queens, that serves seafood, gourmet cheese, dessert and more with a full menu of wine, beer and mixed drinks.",website:"https://www.keukakafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4ZtAuNXpJ3pjnIxChFSI8R/1a40ef3f48761a48a49aa027c0063cda/restaurant_week_final_version__1_.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/43873-KeukaKafeaWineBar-menu.pdf",primary_location:"Forest Hills",address:"112-04 Queens Blvd., Queens, NY 11375",latitude:40.7178695,longitude:-73.836848,telephone:"(718)8801478",price_range:"$",facebook_url:"https://www.facebook.com/KeukaKafe",instagram_url:"https://instagram.com/keukakafe",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"DiWine",slug:"diwine",borough:"Queens",neighborhood:"Astoria",cuisine:"American (New)",summary:"DiWine is a wine bar and New American restaurant focused on natural biodynamic wines and hand-crafted cocktails in a relaxed atmosphere.",website:"https://diwineonline.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/kcPoUWci2KEmQAvwoh5sJ/6f226ae888e05639210aef6c9ed7234b/Diwine-Astoria-Queens-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49295-DiWine-menu.pdf",primary_location:"Astoria",address:"41-15 31st Ave., Queens, NY 11103",latitude:40.760854,longitude:-73.9155712,telephone:"(718)7771355",price_range:"$",facebook_url:"https://www.facebook.com/diwinebar",instagram_url:"https://instagram.com/diwinebar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Baires Grill New York",slug:"baires-grill-new-york",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Argentinian",summary:"The menu at Baires Grill New York features homemade dishes that capture the rich, traditional flavors of Argentine cuisine. ",website:"https://www.bairesgrill.com/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/6WUa7x6xrUkZVdz1Y4GL4u/94bd2b6e00a91931413e80b47a9ddaa2/Baires-Grill-New-York-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1282117",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49863-BairesGrillNewYork-menu.pdf",primary_location:"Hells Kitchen",address:"350 W. 50th St., Manhattan, NY 10019",latitude:40.7629477,longitude:-73.9880771,telephone:"(212)8841355",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/bairesgrill",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"See No Evil Pizza",slug:"see-no-evil-pizza",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Pizza",summary:"See No Evil Pizza is a modern New York pizzeria located on the concourse level of the 1 train 50th street subway station.",website:"https://seenoevilpizza.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7bk3aKO1X6dSwcUuWFgcB/8c400adac21ffe30675e8951b7645e38/See-No-Evil-Pizza-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49158-SeeNoEvilPizza-menu.pdf",primary_location:"Times Square/Theatre District",address:"210 W. 50th St., Concourse #1, 10019 Manhattan",latitude:40.7614519,longitude:-73.9845231,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/seenoevilpizza",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ocean Prime",slug:"ocean-prime",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Seafood",summary:"This award-winning restaurant and lounge from renowned restaurateur Cameron Mitchell is designed to please all palates.",website:"https://www.ocean-prime.com/locations/new-york-city",image_url:"//images.ctfassets.net/1aemqu6a6t65/33HXuW7YOP56Kh55JuHFr8/51b53a274799e7e93d833e029bb4268c/Ocean-Prime-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"173662",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38880-OceanPrime-menu.pdf",primary_location:"Midtown West",address:"123 W. 52nd St., Manhattan, NY 10019",latitude:40.7617542,longitude:-73.9805768,telephone:"(212)9561404",price_range:"$",facebook_url:"https://www.facebook.com/OceanPrimeNYC",instagram_url:"https://instagram.com/oceanprimenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Brooklyn Chop House - Times Square",slug:"brooklyn-chop-house-times-square",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Asian Fusion",summary:"This clubby spot serves steakhouse classics and Asian dishes in Times Square.",website:"https://www.brooklynchophouse.com/times-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/4oILICfIhIAycPt6oH5fXB/9d80cc78b0a54463bb6542467bc84a5f/Brooklyn-Chop-House-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1230112",menu_url:"",primary_location:"Times Square/Theatre District",address:"253 W. 47th St., Manhattan, NY 10036",latitude:40.7602153,longitude:-73.9863868,telephone:"(212)6191210",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100083368788037",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Miss Lily's 7A",slug:"miss-lilys-7a",borough:"Manhattan",neighborhood:"East Village",cuisine:"Caribbean",summary:'Under the new culinary director, Brittney "Stikxz" Williams, Miss Lily’s 7A, in the East Village, offers innovative and delicious island cooking, friendly staff, a sunny vibe and Caribbean flavor.',website:"https://www.misslilys.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7kjWgF6MkTUrjp9Q19Svjn/4b07d6caa291c70cab305a1466f744f2/miss-lilys-7a-daniel-krieger-002.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"East Village",address:"109 Avenue A, Manhattan, NY 10009",latitude:40.7260534,longitude:-73.9838523,telephone:"(212)8121482",price_range:"$",facebook_url:"https://www.facebook.com/MissLilysNYC",instagram_url:"https://instagram.com/misslilys",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sicily Osteria",slug:"sicily-osteria",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"Located on Restaurant Row in Manhattan's Theatre District, Sicily Osteria is a dining destination that appeals to local residents and office workers, as well as Broadway theatergoers.",website:"https://www.sicilynyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5f1lrcAA41MfFIr6YAXPYl/6dcfdb809e8a932a39a250e12466dd62/Sicily-Osteria-Manhattan-NYC-Photo-New-York-City-Restaurant-Group.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"1214629",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46336-SicilyOsteria-menu.pdf",primary_location:"Times Square/Theatre District",address:"330 W. 46th St., Manhattan, NY 10036",latitude:40.7601439,longitude:-73.9892202,telephone:"(646)6093417",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/sicilynyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Ribbon—Upper West Side",slug:"the-ribbon-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (New)",summary:"The Ribbon—Upper West Side presents spit roasted meats, seafood and Blue Ribbon Restaurants classics in polished surrounds with rustic touches, plus an extensive bar and whisky program.",website:"https://www.theribbonnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4I4EVZMwSIBw1ImfI2GUzC/6e4bdf3f703739644827fb84ec7704b4/theribbon-centralparkwest-manhattan-nyc-restaurant-ribbonllc-prime-rib-_f8d62221-53d1-4a11-.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"169513",menu_url:"",primary_location:"Upper West Side",address:"20 W. 72nd St., Manhattan, NY 10023",latitude:40.7765087,longitude:-73.9775392,telephone:"(212)7875656",price_range:"$",facebook_url:"https://www.facebook.com/theribbonnyc",instagram_url:"https://instagram.com/Theribbonnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Loulou Petit Bistro",slug:"loulou-petit-bistro",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"French",summary:"Loulou Petit Bistro serves French classics for lunch, brunch and dinner.",website:"https://www.loulounyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5buKlyIOJo6wvSPPlLdk4L/109760426d1c6cef51d27d5be0c20053/Loulou-Petit-Bistro-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Chelsea",address:"176 Eighth Ave., Manhattan, NY 10011",latitude:40.74262,longitude:-74.0000524,telephone:"(917)2925624",price_range:"$",facebook_url:"https://www.facebook.com/louloupetitbistro",instagram_url:"https://instagram.com/loulou.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hunt & Fish Club NYC",slug:"hunt-fish-club-nyc",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Steakhouse",summary:"Hunt & Fish Club NYC debuted in Midtown Manhattan in 2014 with a classic yet contemporary menu of exceptionally prepared steaks and game plus a unique selection of canapés and seafood offerings.",website:"https://www.hfcnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/37sNvBQxRCzULTMPQRjYcw/38171ff42e385962bb57afc9191b1dbd/14_green_room_s_5.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"151972",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39658-Hunt%26FishClubNYC-menu.pdf",primary_location:"Times Square/Theatre District",address:"125 W. 44th St., Manhattan, NY 10036",latitude:40.7568129,longitude:-73.984243,telephone:"(347)6251220",price_range:"$",facebook_url:"https://www.facebook.com/huntandfishnyc",instagram_url:"https://instagram.com/huntandfish",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pecora Bianca Midtown",slug:"la-pecora-bianca-midtown",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Italian",summary:"La Pecora Bianca Midtown offers an expanded menu from Mario Batali alum Cruz Goler in a bright, sophisticated space nearly twice the size of the original in NoMad.",website:"https://www.lapecorabianca.com/location/midtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/2chkRq9unQaWkwKKUzoNhD/72956d6acae6a5ab2d7a927cb7a955fc/lapecorabianca_midtown_manhattan_nyc_evansung_lpb-midtown-private-dining-room.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"986275",menu_url:"",primary_location:"Midtown East",address:"950 Second Ave., Manhattan, NY 10022",latitude:40.7550058,longitude:-73.9680538,telephone:"(212)8999996",price_range:"$",facebook_url:"https://www.facebook.com/LaPecoraBiancaNYC",instagram_url:"https://instagram.com/lapecorabianca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Red Hook Lobster Pound",slug:"red-hook-lobster-pound",borough:"Brooklyn",neighborhood:"Red Hook",cuisine:"Seafood",summary:"The famous lobster rolls at this Red Hook mainstay aren't all you'll find on the menu, but their popularity is a sure sign you should sample one.",website:"https://www.redhooklobster.com/location/red-hook",image_url:"//images.ctfassets.net/1aemqu6a6t65/1Qm6IB8USJ1I7IojDRxpl8/3e71bf297d1777c519491c0e7dbff060/Red-Hook-Lobster-Pound-Brooklyn-NYC-Photo-Fat-Chix-Inc-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:["summer-vibes"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44208-RedHookLobsterPound-menu.pdf",primary_location:"Red Hook",address:"284 Van Brunt St., Brooklyn, NY 11231",latitude:40.6798444,longitude:-74.0103726,telephone:"(718)8587650",price_range:"$",facebook_url:"https://www.facebook.com/redhooklobster",instagram_url:"https://instagram.com/redhooklobster",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tudor City Steakhouse",slug:"tudor-city-steakhouse",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:'Located in a historic enclave, Tudor City Steakhouse is a "next generation" steakhouse, offering dishes not typically associated with the genre.',website:"https://www.tudorcitysteakhouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6K9iAkvoxkynDeyKOeC9tc/4f7e0426785fe6b83083063ec785b874/tudor-city-steakhouse-midtown-manhattan-nyc-courtesy-03.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1175887",menu_url:"",primary_location:"Midtown East",address:"45 Tudor City Place, Manhattan, NY 10017",latitude:40.7493702,longitude:-73.9699861,telephone:"(212)6824000",price_range:"$",facebook_url:"https://www.facebook.com/tudorcitysteakhouse",instagram_url:"https://instagram.com/tudorcitysteakhouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Obao Hell's Kitchen",slug:"obao-hells-kitchen",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Thai",summary:"Obao bridges the gap between the streets of Southeast Asia and the culinary sensibilities of NYC, bringing diners a combination of Thai and Vietnamese comfort foods that have a twist.",website:"https://www.obaony.com/home-hk",image_url:"//images.ctfassets.net/1aemqu6a6t65/1e7Bqk7E7yG0DcQ2M10Ese/a777936e8c6fbb09dc138ab5f1fd53cb/obao-pichan-keitsrichart-5.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Hells Kitchen",address:"647 Ninth Ave., Manhattan, NY 10036",latitude:40.7606617,longitude:-73.9913386,telephone:"(212)2458880",price_range:"$",facebook_url:"https://www.facebook.com/obaony09",instagram_url:"https://instagram.com/obao_ny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Legasea",slug:"legasea",borough:"Manhattan",neighborhood:"Garment District",cuisine:"American (New)",summary:"Legasea combines a top-tier seafood menu with a fun atmosphere.",website:"https://taogroup.com/venues/legasea-bar-grill-new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/2EkFRLP6DGUMH45DBwXceu/4cd833328a220fe54218957b4ff31d04/JustinLevyPhoto-36_91EA0A18-3237-4954-9F0FFDC3E0912674_c246849d-1a58-4f4f-9d5c23277e2e814e__1___1_.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"745729",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40234-Legasea-menu.pdf",primary_location:"Garment District",address:"Moxy Times Square, 485 Seventh Ave., 10018 Manhattan",latitude:40.7523587,longitude:-73.9893192,telephone:"(212)2681888",price_range:"$",facebook_url:"https://www.facebook.com/legaseany",instagram_url:"https://instagram.com/legaseany",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Champers Social Club",slug:"champers-social-club",borough:"Manhattan",neighborhood:"Soho",cuisine:"French",summary:"Champers serves a French-adjacent twist on bar classics including oysters, roasted mushroom toast, deviled eggs, and Nicoise, alongside a large selection of champagne and sparkling wines.",website:"https://www.champerssocialclub.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7eADCCCkX5b2DY9pIZIxmp/6c56cec30e6599d8836000c422ea5b08/Champers-Social-Club-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49943-ChampersSocialClub-menu.pdf",primary_location:"Soho",address:"39-1/2 Crosby St., Manhattan, NY 10012",latitude:40.7215357,longitude:-73.9987798,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/champerssocialclub",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Torch & Crown Brewing Company",slug:"torch-crown-brewing-company",borough:"Manhattan",neighborhood:"Hudson Square",cuisine:"American (New)",summary:"Torch & Crown Brewing Company, in Hudson Square, is Manhattan’s only production brewery and restaurant, a thirst-quenching gathering place with a New York-centric food and drinks program. ",website:"https://www.torchandcrown.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3WPZ6nCCmcKAEQkWaxPIwM/aeffbe734a16256fa6be4334c913ef43/Torch-and-Crown-Brewery-Manhattan-NYC-Photo-Michael-Citarella-4.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/42011-Torch%26CrownBrewingCompany-menu.pdf",primary_location:"Hudson Square",address:"12 Vandam St., Manhattan, NY 10013",latitude:40.7261952,longitude:-74.0043361,telephone:"(212)2287005",price_range:"$",facebook_url:"https://www.facebook.com/torchandcrown",instagram_url:"https://instagram.com/torchandcrown",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sinigual",slug:"sinigual",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Mexican",summary:"Sinigual celebrates a fusion of contemporary and native flavors of Mexico.",website:"https://www.sinigualrestaurants.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2CqabPCRAtwYJHD4kIEn3C/3c531c898abe6f1447448e2e1e8bee75/rw-to-go_sinigual_1bb746e9-5056-a36f-2343a1ab6ef62bfe-1bb745c85056a36_1bb74738-5056-a36f-237fb3672585ea40_1920x1280.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"24487",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/34541-Sinigual-menu.pdf",primary_location:"Midtown East",address:"640 Third Ave., Manhattan, NY 10017",latitude:40.7503139,longitude:-73.9750476,telephone:"(212)2860250",price_range:"$",facebook_url:"https://www.facebook.com/sinigualnyc",instagram_url:"https://instagram.com/sinigualnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice 83",slug:"felice-83",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Felice reflects the soul of Italy, inspired by the sophisticated streets of Florence and the rustic warmth of the Tuscan countryside.",website:"https://www.felicerestaurants.com/felice-83",image_url:"//images.ctfassets.net/1aemqu6a6t65/4FZNTJFivkGQkh4ur6VmzP/55551bcc04bb28c5e6f6a658bc95fe6f/felice83_sahospitalitygroup_1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"1593 First Ave., Manhattan, NY 10028",latitude:40.7749003,longitude:-73.9510928,telephone:"(212)2494080",price_range:"$",facebook_url:"https://www.facebook.com/Felice.NewYorkCity/",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pappardella",slug:"pappardella",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"This longstanding Italian restaurant—on the Upper West Side since 1983—serves Tuscan cuisine.",website:"https://www.pappardella.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6SMhoQVRIG553NIz20hlT/e99cefde4e9e64f97f4fa7b87f53f78b/IMG_6015_1ACC7270-21A8-4D95-8C3C26E78933D106_671b9d6e-d4d2-46ad-906c1dd916d0919b__1___1_.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"43045",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44776-Pappardella-menu.pdf",primary_location:"Upper West Side",address:"316 Columbus Ave., Manhattan, NY 10023",latitude:40.779347,longitude:-73.9776056,telephone:"(212)5957996",price_range:"$",facebook_url:"https://www.facebook.com/pappardellaristorante",instagram_url:"https://instagram.com/pappardellanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Fushimi - Times Square",slug:"fushimi-times-square",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Japanese / Sushi",summary:"Fushimi is a buzzing eatery and lounge in Hell's Kitchen near Times Square.",website:"https://fushimi.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/43TKNiM9HiorYWIMmL2jwI/a3c9634643f9ab6b633e3cdda490c5da/Fushimi-Times-Square-NYC-Manhattan-NYC-Courtesy-15.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1292557",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48239-Fushimi-TimesSquare-menu.pdf",primary_location:"Hells Kitchen",address:"311 W. 43rd St., Manhattan, NY 10036",latitude:40.7584564,longitude:-73.9900329,telephone:"(212)2458881",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/fushiminyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Bar Room at The Modern",slug:"the-bar-room-at-the-modern",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"American (New)",summary:"The lively Bar Room at The Modern, a Michelin-starred contemporary American restaurant at MoMA, offers Chef Abram Bissell's vividly seasonal contemporary cooking à la carte.",website:"https://www.themodernnyc.com/the-bar-room-at-the-modern",image_url:"//images.ctfassets.net/1aemqu6a6t65/33scmddB5C9f11CcJ3h7Yi/e401797ed670fea0686c95d2a5e9da36/gundi_chanterelle_6648_f36e05d0-0932-4195-95fa9610f8a7ed74_cecfac60-060e-47e0-88138f2511417339.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41033-BarRoomatTheModern-menu.pdf",primary_location:"Midtown West",address:"The Museum of Modern Art, 9 W. 53rd St., 10019 Manhattan",latitude:40.7614327,longitude:-73.9776216,telephone:"(212)3331220",price_range:"$",facebook_url:"https://www.facebook.com/TheModernNYC",instagram_url:"https://instagram.com/themodernnyc",michelin_award:"TWO_STARS",michelin_slug:"the-modern",nyttop100_rank:""},{name:"Il Carino",slug:"il-carino",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Il Carino’s pride is their delicious, cooked-with-care Italian cuisines, and fine service to meet patrons' needs.",website:"https://www.ilcarinorestaurantnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/JrYDXH2oc7N2vn9QMsk1j/4c450a7289d843fb6526eb87523ca96e/IL-Carino-Manhattan-NYC-Courtesy-15.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"986089",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47964-IlCarino-menu.pdf",primary_location:"Upper East Side",address:"1710 Second Ave., Manhattan, NY 10128",latitude:40.7794742,longitude:-73.9502189,telephone:"(646)8820487",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100054252740468",instagram_url:"https://instagram.com/ilcarinorestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sant Ambroeus—Brookfield",slug:"sant-ambroeus-brookfield",borough:"Manhattan",neighborhood:"Battery Park City",cuisine:"Italian",summary:"The menu by chef Iacopo Falai reflects the brand’s culinary vision and historic origins of Northern Italy, including its signature vitello tonnato, cotoletta milanese and risotti.",website:"https://www.santambroeus.com/pages/location-brookfield-place",image_url:"//images.ctfassets.net/1aemqu6a6t65/2ATdeyY3mLZYZ4rqzh4n6U/94ab7c1f18c4ffc49f78601e325776b1/rw-to-go_sant_ambroeusYbrookfield__1_.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44324-SantAmbroeusBrookfield-menu.pdf",primary_location:"Battery Park City",address:"200 Vesey St., Manhattan, NY 10281",latitude:40.7134003,longitude:-74.0154383,telephone:"(212)7320907",price_range:"$",facebook_url:"https://www.facebook.com/SantAmbroeus",instagram_url:"https://instagram.com/santambroeus",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Vino &... - Eataly NYC Downtown",slug:"vino-and",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"Italian",summary:"Vino &..., the wine bar in the heart of the marketplace at Eataly NYC Downtown, brings the best of Italian wines into one restaurant and bar in downtown New York.",website:"https://www.eataly.com/us_en/stores/nyc-downtown/restaurants/vino-e-grano-restaurant",image_url:"//images.ctfassets.net/1aemqu6a6t65/6QieA8htr6AtL93yAdEqJ1/8332983018c293a76b2c165ca587e8ff/vino-and-la-pasa-eataly-downtown-nyc-courtesy-eataly.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1014571",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46088-Vino%26...-EatalyNYCDowntown-menu.pdf",primary_location:"Lower Manhattan",address:"Eataly NYC Downtown, 4 World Trade Center, 3rd fl. 101 Liberty St.",latitude:40.7100647,longitude:-74.0119758,telephone:"(212)8972895",price_range:"$",facebook_url:"https://www.facebook.com/EatalyNYCFlatiron",instagram_url:"https://instagram.com/eatalynewyorkcity",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Lido",slug:"lido",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Italian",summary:`James Beard Award–winning author Serena Bass, Lido's executive chef, creates unique twists on Northern Italian classics on Harlem's "Restaurant Row."`,website:"https://lidoharlem.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1eI3K8B1DwmYUrU2Ov7Say/1149e6c1011fe5edb082f3b22eed5a9a/lido-courtesy-lido.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"63250",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36475-Lido-menu.pdf",primary_location:"Harlem",address:"2168 Frederick Douglass Blvd., Manhattan, NY 10026",latitude:40.8048926,longitude:-73.9546798,telephone:"(646)4908575",price_range:"$",facebook_url:"https://www.facebook.com/LidoHarlem",instagram_url:"https://instagram.com/lidoharlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sant Ambroeus—SoHo",slug:"sant-ambroeus-soho",borough:"Manhattan",neighborhood:"Nolita",cuisine:"Italian",summary:"An exquisite menu by chef Marco Barbisotti, a native of Milan, reflects the brand's culinary vision and historic origins of Northern Italy, including its signature vitello tonnato, cotoletta milanese and risotti.",website:"https://www.santambroeus.com/pages/location-soho",image_url:"//images.ctfassets.net/1aemqu6a6t65/3A9JCc3UJ41FybOTjXTBV1/9e8b420ec29a14b4bfaeda1018c59162/santambroeussoho_sahospitalitygroup_2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38415-SantAmbroeusSoHo-menu.pdf",primary_location:"Nolita",address:"265 Lafayette St., Manhattan, NY 10012",latitude:40.7233903,longitude:-73.9965327,telephone:"(212)9662770",price_range:"$",facebook_url:"https://www.facebook.com/SantAmbroeus",instagram_url:"https://instagram.com/santambroeus",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosa Mexicano - Second Avenue",slug:"rosa-mexicano-second-avenue",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Mexican",summary:"Rosa Mexicano serves up Mexican goodness in an authentic yet stylish and festive atmosphere.",website:"https://rosamexicano.com/location/second-avenue",image_url:"//images.ctfassets.net/1aemqu6a6t65/96r7Ja70NAGnRpiJsDmS2/fa160725957b87e578c5dbed8a27df3b/rosa-mexicano-photo-cody-rasmossen-02__1___1_.jpeg",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1207771",menu_url:"",primary_location:"Midtown East",address:"251 E. 52nd St., Manhattan, NY 10022",latitude:40.7564243,longitude:-73.9679096,telephone:"(212)7537407",price_range:"$",facebook_url:"https://www.facebook.com/rosamexicano",instagram_url:"https://instagram.com/rosamexicano",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kyma Hudson Yards",slug:"kyma-hudson-yards",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"Greek",summary:"Kyma's whitewashed interior, decorated with Greek pottery and ceramics, echoes the style of a restaurant in Santorini.",website:"https://kymarestaurants.com/locations-hudson-yards",image_url:"//images.ctfassets.net/1aemqu6a6t65/7vX8kHqf55yv5HQqsjaFiB/87d472448575d5bb48b1cc5a2ab172d8/kyma-hudson_yards-nyc-courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1123090",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46176-KymaHudsonYards-menu.pdf",primary_location:"Hudson Yards",address:"445 W. 35th St., Manhattan, NY 10001",latitude:40.7550643,longitude:-73.9978137,telephone:"(212)9679700",price_range:"$",facebook_url:"https://www.facebook.com/kymahudsonyards",instagram_url:"https://instagram.com/kyma.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pastai",slug:"pastai",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Italian",summary:"Located in the heart of West Chelsea, near the Highline, Pastai is a Southern Italian restaurant and bar, serving dishes inspired by their family tradition.",website:"https://www.pastainyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1eng58jZCuT6rtxqiWHObu/c6f6251c079e1d5242c69889632347e9/dsc_2092_0eaea6f4-bbf5-4c81-b6ba9dad2e222a04_c0f11e6b-c419-402b-9b58f60ac87cd288.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Chelsea",address:"186 Ninth Ave., Manhattan, NY 10011",latitude:40.7454058,longitude:-74.0018528,telephone:"(646)6883463",price_range:"$",facebook_url:"https://www.facebook.com/pastaiNYC",instagram_url:"https://instagram.com/pastainyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Brooklyn Bowl",slug:"brooklyn-bowl",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"American (Traditional)",summary:"Enjoy the world's first LEED-certified bowling alley and music venue.",website:"https://www.brooklynbowl.com/brooklyn",image_url:"//images.ctfassets.net/1aemqu6a6t65/1UhZKh5FKTwPBtwwSLGaPP/69912ba669f1c7a2966a2330af193c54/Brooklyn-Bowl-Brooklyn-NYC-Photo-Ken-Spielman-1.jpg",meal_types:["$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"251356",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39980-BrooklynBowl-menu.pdf",primary_location:"Williamsburg",address:"61 Wythe Ave., Brooklyn, NY 11249",latitude:40.7218874,longitude:-73.9573813,telephone:"(718)9633369",price_range:"$",facebook_url:"https://www.facebook.com/BrooklynBowl",instagram_url:"https://instagram.com/BrooklynBowl",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nice Matin",slug:"nice-matin",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"French",summary:"A culinary venture through Nice in the fall of 2002 inspired partners Simon Oren (Marseille, Sushi Samba and L’Express) and chef Andy d’Amico (Sign of the Dove and Little Dove) to open Nice Matin in 2003.",website:"https://www.nicematinnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5sV9pcepa53tmwtLsbNGEi/4acbb981c0414f29988d53eb17d733c1/nicematin_upperwestside_manhattan_nyc_dish-13_img_8251_2400px.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"2374",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/23936-NiceMatin-menu.pdf",primary_location:"Upper West Side",address:"201 W. 79th St., Manhattan, NY 10024",latitude:40.7834267,longitude:-73.9784952,telephone:"(212)8736423",price_range:"$",facebook_url:"https://www.facebook.com/NiceMatin",instagram_url:"https://instagram.com/nicematin",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kings of Kobe",slug:"kings-of-kobe",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Steakhouse",summary:"The towering American Wagyu burger creations and mouth-melting American Wagyu steaks—and the frenzy of sides—speak to the Kings of Kobe core: unadulterated, delicious fun.",website:"https://www.kingsofkobe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5ZpVwo51optriFLk1WhoD2/2961660acf87e3e79128cba9d04048fb/Kings-of-Kobe-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"988825",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48191-KingsofKobe-menu.pdf",primary_location:"Hells Kitchen",address:"650 W. 42nd St., Manhattan, NY 10036",latitude:40.7612169,longitude:-74.0003278,telephone:"(646)3705121",price_range:"$",facebook_url:"https://www.facebook.com/kingsofkobe",instagram_url:"https://instagram.com/kingsofkobe",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wayan",slug:"wayan",borough:"Manhattan",neighborhood:"Nolita",cuisine:"Asian Fusion",summary:"Intoxicating Indonesian food from a talented chef in Nolita.",website:"https://www.wayan-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/64b0huxdNhtxofUldW2FSw/caca0d2bf58c25769fb30c484e312a34/rw-to-go_wayan.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Nolita",address:"20 Spring St., Manhattan, NY 10012",latitude:40.7212142,longitude:-73.9951519,telephone:"(917)2614388",price_range:"$",facebook_url:"https://www.facebook.com/Wayan-299448740919619",instagram_url:"https://instagram.com/wayan_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kru",slug:"kru",borough:"Brooklyn",neighborhood:"Greenpoint",cuisine:"Thai",summary:"The concept at Kru is the modern interpretation of 100-year-old Thai recipes.",website:"https://www.krubrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1jh74XvrgzhfREPMvoJ23g/3d1002c76537202d24c9a7f1328ae255/Kru-Dining-Room-Brooklyn-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48044-Kru-menu.pdf",primary_location:"Greenpoint",address:"190 N. 14th St., Brooklyn, NY 11249",latitude:40.7228016,longitude:-73.9557975,telephone:"(347)5990266",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/kru.bk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hawksmoor",slug:"hawksmoor",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Steakhouse",summary:"The goal of this steakhouse is to serve the perfect steak in an environment where everyone, guests and staff, can relax and enjoy themselves. ",website:"https://www.hawksmoornyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/59FVSvNyHd1AVUjMro7Yo0/373b91cad050cb55f2708202a5956701/Hawksmoor-Manhattan-NYC-Photo-Courtesy-Hawksmoor.jpg",meal_types:["$60 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1052086",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45840-Hawksmoor-menu.pdf",primary_location:"Gramercy",address:"109 E. 22nd St., Manhattan, NY 10010",latitude:40.7393354,longitude:-73.9862031,telephone:"(212)7771840",price_range:"$",facebook_url:"https://www.facebook.com/HawksmoorNYC",instagram_url:"https://instagram.com/hawksmoornyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Recette",slug:"recette",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"French",summary:"Recette is a lively French bistro in Williamsburg, Brooklyn, featuring tasty dishes and unique specials by executive chef Alan Vargas.",website:"https://recettebrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6adkDESrCyHf0jBqN480Pq/b2b092ddc0b92fa903c12d70a32b8128/compressed-compressed-recette-williamsburg-brooklyn-nyc-courtesy-recette__1_.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1216783",menu_url:"",primary_location:"Williamsburg",address:"103 Havemeyer St., Brooklyn, NY 11211",latitude:40.7132156,longitude:-73.9563231,telephone:"(347)2278829",price_range:"$",facebook_url:"https://m.facebook.com/profile.php?id=100075866589556&sk=photos&ref=page_internal&_rdr",instagram_url:"https://instagram.com/recettebklyn",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Maggie's Place",slug:"maggies-place",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"Family-owned since 1974, Maggie's Place serves up shepherd's pie, chicken pot pie, fish & chips, burgers and pub fare alongside a selection of wine and beer.",website:"https://www.maggiesnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5pU986anZyjoVcwDlLpXrE/32d113f44cb302e063f68cff5718b4d3/Maggie-s-Place-Manhattan-NYC-Photo-Martha-Ponce.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46077-MaggiesPlace-menu.pdf",primary_location:"Midtown East",address:"21 E. 47th St., Manhattan, NY 10017",latitude:40.7562972,longitude:-73.9771145,telephone:"(212)7535757",price_range:"$",facebook_url:"https://www.facebook.com/maggiesnyc",instagram_url:"https://instagram.com/maggiesplacenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"When in Bangkok",slug:"when-in-bangkok",borough:"Queens",neighborhood:"Flushing",cuisine:"Thai",summary:"When in Bangkok is a Thai restaurant that will transport you to a kitchen in Bangkok.",website:"https://www.wib-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/Zk0FIl2fmsePSg2uCpgEI/a8bfebcfcfc23fcf596ad43fcde9b4f5/When-in-Bangkok-Queens-NYC-Photo-Courtesy-When-In-Bangkok.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46446-WheninBangkok-menu.pdf",primary_location:"Flushing",address:"161-16 Northern Blvd., Queens, NY 11358",latitude:40.7622026,longitude:-73.8042611,telephone:"(929)3622000",price_range:"$",facebook_url:"https://www.facebook.com/wib.nyc",instagram_url:"https://instagram.com/wib.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cull & Pistol Oyster Bar",slug:"cull-pistol-oyster-bar",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Seafood",summary:"The Cull & Pistol Oyster Bar is a Michelin-acclaimed seafood restaurant located in Chelsea Market.",website:"https://www.cullandpistol.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5iC1q00TKZTIvKKDhuWRYC/edb13a7f692f1a5102a5b021e4f14831/overhead-table-9_9c63574b-5185-4e93-842ec2eb9cf9e722_59aeda2f-07fa-4e6d-9cda3c689dada26f.jpeg",meal_types:["$45 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"109174",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46184-Cull%26PistolOysterBar-menu.pdf",primary_location:"Chelsea",address:"75 Ninth Ave., Manhattan, NY 10011",latitude:40.7424509,longitude:-74.0059581,telephone:"(646)5681223",price_range:"$",facebook_url:"https://www.facebook.com/cullandpistol",instagram_url:"https://instagram.com/cullandpistol",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mark's Off Madison",slug:"marks-off-madison",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Italian",summary:"This restaurant-bakery combines rustic Italian and European cooking and traditional Jewish food. Alongside fresh homemade pastas, entrée salads and Belgian fries, there's Jewish deli rye and hand-rolled bagels and bialys.",website:"https://www.marksoffmadison.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/GdF9wOOU98O7XP2Zr8EN8/d0445c1ec27adc0fd7e01e4a545d7d5f/Marks-Off-Madison-NYC-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44483-Mark%27sOffMadison-menu.pdf",primary_location:"Nomad",address:"41 Madison Ave., Manhattan, NY 10010",latitude:40.7437389,longitude:-73.9875483,telephone:"(646)8388300",price_range:"$",facebook_url:"https://www.facebook.com/marksoffmadison",instagram_url:"https://instagram.com/marksoffmadison",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Socarrat Paella Bar - Chelsea",slug:"socarrat-paella-bar-chelsea",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Spanish",summary:"Socarrat Paella Bar Chelsea reflects an ambiance rich in warmth, comfort and hospitality, and brings out the Spaniard in New York: it's elegant, bold and sexy. A neighborhood staple comprised primarily of one large communal table with a bar and smaller communal tables scattered throughout, Socarrat Chelsea also has a private dining room that can can accommodate up to 28 people.",website:"https://socarratnyc.com/chelsea",image_url:"//images.ctfassets.net/1aemqu6a6t65/2GO13Yi0DpPUiclqCkcvfZ/33df7c6ab278dfd8af65d69ca3fd4bd0/socarrat_paella_bar_chelsea_manhattan-photo-courtesy-4.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"60874",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38284-SocarratPaellaBar-Chelsea-menu.pdf",primary_location:"Chelsea",address:"259 W. 19th St., Manhattan, NY 10011",latitude:40.7427594,longitude:-73.999481,telephone:"(212)4621000",price_range:"$",facebook_url:"https://www.facebook.com/socarratpaellabar",instagram_url:"https://instagram.com/socarratnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Frenchette",slug:"frenchette",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"French",summary:`This classic French brasserie and bar in Tribeca has a friendly attitude and bistro favorites like duck frites. Stay for a meal or have a drink at the welcoming long bar.
`,website:"https://www.frenchettenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/58qm6OXXb3MsCyCqnTUlQu/5c506f48ca8b1764fcd2c076dc3d9746/Frenchette-Manhattan-NYC-Photo-Melanie-Dunea.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"1028608",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40844-Frenchette-menu.pdf",primary_location:"Tribeca",address:"241 West Broadway, Manhattan, NY 10013",latitude:40.7196236,longitude:-74.0057461,telephone:"(212)3343883",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/frenchettenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:44},{name:"Morton's The Steakhouse—Manhattan",slug:"mortons-the-steakhouse-manhattan",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:"There are quite a few venerable steakhouses in Midtown, but Morton's stands tall among them.",website:"https://www.mortons.com/newyork",image_url:"//images.ctfassets.net/1aemqu6a6t65/267AXhmUbxc3dMQJpyAcNK/b9d639025f8e9a26c2571db48e4dc4c1/mortonsthesteakhouse_16364_125.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"3018",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/7859-Morton%27sTheSteakhouseManhattan-menu.pdf",primary_location:"Midtown East",address:"551 Fifth Ave. (enter on 45th St.), Manhattan, NY 10017",latitude:40.7551812578,longitude:-73.9787432319,telephone:"(212)9723315",price_range:"$",facebook_url:"https://www.facebook.com/Mortons",instagram_url:"https://instagram.com/MortonsSteak",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Il Mulino Prime | Soho",slug:"il-mulino-prime-soho",borough:"Manhattan",neighborhood:"Soho",cuisine:"Steakhouse",summary:"This culinary haven in SoHo embraces the unique character of the surrounding neighborhood.",website:"https://www.imny.com/location/prime-soho",image_url:"//images.ctfassets.net/1aemqu6a6t65/7MOSZcMYsbZtRpa944OHZ5/b23e38ad14288d7746a542194d174d06/Il-Mulino-Prime_Soho_Exterior_BEC21362-6E0B-4536-BF751EAA3432F3DE_b1442b06-d69c-4bfb-9cada31601c109a8.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"147904",menu_url:"",primary_location:"Soho",address:"331 West Broadway, Manhattan, NY 10013",latitude:40.7221926,longitude:-74.0037316,telephone:"(212)2260020",price_range:"$",facebook_url:"https://www.facebook.com/ilmulinonyc",instagram_url:"https://instagram.com/ilmulinonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Perry Street",slug:"perry-street",borough:"Manhattan",neighborhood:"West Village",cuisine:"American (New)",summary:"Jean-Georges Vongerichten's son Cedric leads the kitchen, which blends French, American and Asian influences",website:"https://www.perrystrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7GBhVwFUpPDZKY2gVJJDcL/0d05525d01a3e0f05defadc52b194ec1/_perry-street-francesco-tonelli-005.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"3948",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/27429-PerryStreet-menu.pdf",primary_location:"West Village",address:"176 Perry St., Manhattan, NY 10014",latitude:40.7344364,longitude:-74.0097048,telephone:"(212)3521900",price_range:"$",facebook_url:"https://www.facebook.com/perrystrestaurant",instagram_url:"https://instagram.com/perryst_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Excuse My French",slug:"excuse-my-french",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"French",summary:"With its cozy 1920s French look, Excuse My French is a small slip-down-the-basement bistro that feels like a speakeasy but offers much more.",website:"https://excusemyfrench-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5oGCLkbYY20dSaTuGDnpug/9df874517f319405df5add8e5832842c/Excuse-my-french-Manhattan-NYC-Photo-Patric-Dolande.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 4 (Aug 11 - Aug 17)"],collections:["dress-for-the-occasion"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40307-ExcuseMyFrench-menu.pdf",primary_location:"Lower East Side",address:"96 Orchard St., Manhattan, NY 10002",latitude:40.7184435,longitude:-73.9898209,telephone:"(212)7809600",price_range:"$",facebook_url:"https://www.facebook.com/excusemyfrenchnewyorkcity",instagram_url:"https://instagram.com/excusemyfrenchtapasbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Shell Seafood Kitchen",slug:"the-shell-seafood-kitchen",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Mediterranean",summary:"The Shell is a modern seafood restaurant on Manhattan's Upper West Side that features a vibrant and sophisticated atmosphere.",website:"https://theshellrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3ZqmV8mCc9hXnuFgRoOgAU/d681a05e1c92e8e21166895046c3249f/The-Shell-Manhattan-NYC-Photo-Courtesy-The-Shell.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1276408",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49132-ShellSeafoodKitchen-menu.pdf",primary_location:"Upper West Side",address:"635 Amsterdam Ave., Manhattan, NY 10025",latitude:40.7906204,longitude:-73.9724608,telephone:"(646)6697628",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61559279256712",instagram_url:"https://instagram.com/theshellrestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Neir's Tavern",slug:"neirs",borough:"Queens",neighborhood:"Woodhaven",cuisine:"American (Traditional)",summary:"The oldest bar in Queens (and possibly the City), Neir's serves up a simple setting and uncomplicated drinks.",website:"https://neirstavern.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1YNvbQ3ZtwKemZrdLxafRD/9257886e4885a68235455a43848806e2/compressed-Neirs-Tavern-Woodhaven-Queens-NYC.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["classic-restaurants"],opentable_id:"",menu_url:"",primary_location:"Woodhaven",address:"87-48 78th St., Queens, NY 11421",latitude:40.6898228,longitude:-73.8635967,telephone:"(718)2960600",price_range:"$",facebook_url:"https://www.facebook.com/neirstavern1",instagram_url:"https://instagram.com/neirstavern",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Zuma",slug:"zuma",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Japanese / Sushi",summary:"Zuma, the brainchild of award-winning co-founder and creator Rainer Becker, brings its internationally acclaimed style of modern Japanese cuisine to Midtown Manhattan.",website:"https://zumarestaurant.com/locations/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/5arEQp9ryYr8J2h1gYUg1t/8cc420c6a4f0b0407d9f977244db8abd/_zuma-courtesy-05.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"162010",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38734-Zuma-menu.pdf",primary_location:"Murray Hill",address:"261 Madison Ave., Manhattan, NY 10016",latitude:40.7504689,longitude:-73.9806241,telephone:"(212)5449862",price_range:"$",facebook_url:"https://www.facebook.com/zumanewyork",instagram_url:"https://instagram.com/zumanewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Catria Cucina and Bar",slug:"catria-nyc",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"Italian",summary:"This all-day modern Italian spot draws inspiration from Italy's Marche region, offering a menu that highlights premium ingredients and house-made pastas.",website:"https://www.catriacucina.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5qD24H3RWypVbeEQ8nrfcO/28f9c06a4b19e291b3dd4c87ef8058a1/Catria-Cucina-and-Bar-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1063342",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44777-CatriaCucinaandBar-menu.pdf",primary_location:"Hudson Yards",address:"Courtyard New York Manhattan/Midtown West, 461 W. 34th St., 10001 Manhattan",latitude:40.754694,longitude:-73.998649,telephone:"(646)4376740",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/catriacucina",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Broadway Lounge",slug:"broadway-lounge",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"American (New)",summary:"With spectacular views of Times Square and sophisticated and comfortable décor, this lounge is perfect for cocktails or pre-theater snacks above Times Square.",website:"https://www.broadwaylounge.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/7JFI3GPkzw6Y9nVUOtO6zJ/3afcc7b80df065c49ca46cab382a56c6/_broadway-lounge-courtesy-marriot-international-04_7b854210-5056-a36f-23e71458d3ad126f__1___1_.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1221586",menu_url:"",primary_location:"Times Square/Theatre District",address:"New York Marriott Marquis, 1535 Broadway, 10036 Manhattan",latitude:40.7585862,longitude:-73.9858202,telephone:"(212)7048834",price_range:"$",facebook_url:"https://www.facebook.com/BroadwayLoungeTimesSquare/",instagram_url:"https://instagram.com/BroadwayLoungeNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hear & There",slug:"hear-and-there",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Japanese / Sushi",summary:"Hear & There is an listening bar and omakase restaurant in Williamsburg from husband-wife team Howard Ng and Samantha Nie of Third Date Hospitality.",website:"https://www.hearandthereny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6EITOZwoew6V1sT8mlmfKB/f35376ad78af39213b61cfd29f1fa1fe/Hear-_-There-Brooklyn-NYC-Photo-Ben-Hon.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49765-Hear%26There-menu.pdf",primary_location:"Williamsburg",address:"109 S. 6th St., Brooklyn, NY 11249",latitude:40.7108069,longitude:-73.9642076,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/hearandthereny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice Columbus",slug:"felice-columbus",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"Felice Columbus brings the vineyards of the Tuscan countryside to the Upper West Side.",website:"https://www.felicerestaurants.com/felice-columbus",image_url:"//images.ctfassets.net/1aemqu6a6t65/4L3GKNFjFeEoancHUaeyW0/02c5b30302b6aec2a5405c8c355df2ad/Felice-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper West Side",address:"240 Columbus Ave., Manhattan, NY 10023",latitude:40.7769784,longitude:-73.9793528,telephone:"(212)9311150",price_range:"$",facebook_url:"https://www.facebook.com/Felice.NewYorkCity",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Socarrat Paella Bar - Nolita",slug:"socarrat-paella-bar-nolita",borough:"Manhattan",neighborhood:"Nolita",cuisine:"Spanish",summary:'"Socarrat" is that scrumptious crust that forms at the bottom of the paella pan when the liquid is rendered and the rice has reached its peak of succulence: evidence of a paella cooked to perfection.',website:"https://socarratnyc.com/nolita",image_url:"//images.ctfassets.net/1aemqu6a6t65/4O84jQGwt0gz1Q5pYZsl4J/b548f192d758f3e526b6dfaf94b97494/socarrat-paella-bar-photo-courtesy-0-1.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"58891",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36363-SocarratPaellaBar-Nolita-menu.pdf",primary_location:"Nolita",address:"284 Mulberry St., Manhattan, NY 10012",latitude:40.7244569,longitude:-73.994917,telephone:"(212)2190101",price_range:"$",facebook_url:"https://www.facebook.com/socarratpaellabar",instagram_url:"https://instagram.com/socarratnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Palermo Argentinian Bistro - Gramercy",slug:"palermo-argentinian-bistro-gramercy",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Argentinian",summary:"Executive chef Carlos Barroz and his partners in Palermo Argentinian Bistro on Manhattan’s Restaurant Row have opened this second location in Gramercy.",website:"https://www.palermoargentinianbistro.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2DUilFJjltA1ZJAAwYjBsJ/21337752c88fbe8035a440813b5aaaeb/Palermo-Argentinian-Bistro-Gramercy-Manhattan-NYC-Photo-Daniel-Acevedo-1.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1428664",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49807-PalermoArgentinianBistro-Gramercy-menu.pdf",primary_location:"Gramercy",address:"53 Irving Pl., Manhattan, NY 10003",latitude:40.7360984,longitude:-73.9874916,telephone:"(917)9052441",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/palermobistrogramercy",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Henry's End",slug:"henrys-end",borough:"Brooklyn",neighborhood:"Brooklyn Heights",cuisine:"American (New)",summary:"For more than 50 years in Brooklyn Heights, Henry’s End has offered classic staples and neighborhood favorites alongside a seasonally oriented program of specials.",website:"https://www.henrysend.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5fnFnn6OV4Op06fO1W8ob8/8cd6f21913d8680fe976f6a03f62440d/Henry-s-End-NYC-Brooklyn-NYC-Photo-Mark-Lahm-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"162367",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39730-Henry%27sEnd-menu.pdf",primary_location:"Brooklyn Heights",address:"72 Henry St., Brooklyn, NY 11201",latitude:40.6987184,longitude:-73.9926307,telephone:"(718)8341776",price_range:"$",facebook_url:"https://www.facebook.com/henrys.end.restaurant",instagram_url:"https://instagram.com/henrys_end",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chito Gvrito NYC",slug:"chito-gvrito-nyc",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Eastern European",summary:"Chito Gvrito's seasonal menu offers classic Georgian flavors with modern twists using locally sourced ingredients paired with natural Georgian wines and craft cocktails.",website:"https://chito-gvritonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/11oAfnNVHfrN00uaHHQZEw/ded1aed242223ff91b28a6e9e7cc9467/Chito-Gvrito-NYC-Manhattan-NYC-Photo-They-Call-Me-Hip-3.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Gramercy",address:"173 Third Ave., Manhattan, NY 10003",latitude:40.7347688,longitude:-73.9858561,telephone:"(646)7671054",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100070623307230",instagram_url:"https://instagram.com/chitogvritonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"STK Downtown",slug:"stk-downtown",borough:"Manhattan",neighborhood:"Meatpacking District",cuisine:"Steakhouse",summary:` Simply put, STK is not your daddy's steakhouse.
`,website:"https://stksteakhouse.com/venues/nyc-downtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/1UGt0A5bs1goXKaKIc5jln/fa9630ee2e61d2f416aaeff490b76b0e/rw-to-go_stk-downtown_e6c48714-5056-a36f-232587530a1f5885-e6c485865056a36_e6c48764-5056-a36f-23108ec76890f445.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"7098",menu_url:"",primary_location:"Meatpacking District",address:"26 Little W. 12th St., Manhattan, NY 10014",latitude:40.7397905,longitude:-74.0072722,telephone:"(646)6242444",price_range:"$",facebook_url:"https://www.facebook.com/STKhouse",instagram_url:"https://instagram.com/eatSTK",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Lincoln Ristorante",slug:"lincoln-ristorante",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"Lincoln Ristorante combines Chef Shea Gallante’s refined interpretation of Italian cuisine with the vision of restaurateur Nick Valenti.",website:"https://www.lincolnristorante.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/8qoG2JWzPPxgmIZkRixIT/d8adceca094856f98e6d6ca02ab9a1df/lincoln-ristorante-tagger-yancey-iv-0948.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"50815",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36125-LincolnRistorante-menu.pdf",primary_location:"Upper West Side",address:"142 W. 65th St., Manhattan, NY 10023",latitude:40.7733701,longitude:-73.983728,telephone:"(212)3596500",price_range:"$",facebook_url:"https://www.facebook.com/Lincoln-Ristorante-154979751197343",instagram_url:"https://instagram.com/lincolnristorante",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Otter",slug:"the-otter",borough:"Manhattan",neighborhood:"Soho",cuisine:"Seafood",summary:"Acclaimed chef Alex Stupak serves a menu focused on simply prepared seafood using the freshest ingredients from carefully selected purveyors. ",website:"https://www.theotter.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/4l171z2h2L4ekZ44Emte60/42040e36a69fbed84852b7b56588a02e/The-Otter-at-The-Manner-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49783-Otter-menu.pdf",primary_location:"Soho",address:"The Manner Hotel, 58 Thompson St., 10012 Manhattan",latitude:40.7239633,longitude:-74.0032292,telephone:"(929)6515330",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Il Buco Alimentari & Vineria",slug:"il-buco-alimentari-vineria",borough:"Manhattan",neighborhood:"Noho",cuisine:"Italian",summary:"Find a restaurant, market, salumeria and bakery all in one spot.",website:"https://ilbuco.com/pages/alimentari",image_url:"//images.ctfassets.net/1aemqu6a6t65/52gD2MC93055RrfnLlup66/d771be7d917bed442153e080c0ad1bd0/ilbucoalimentarivineria_taggeryanceyiv_3250-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["date-night"],opentable_id:"",menu_url:"",primary_location:"Noho",address:"53 Great Jones St., Manhattan, NY 10012",latitude:40.7264417,longitude:-73.9925756,telephone:"(212)8372622",price_range:"$",facebook_url:"https://www.facebook.com/IlBucoAlimentarieVineria",instagram_url:"https://instagram.com/ilbuco_av",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Frenchman's Dough",slug:"frenchmans-dough-at-tin-building-by-jean-georges",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"Italian",summary:"The Frenchman’s Dough is a traditional Italian restaurant with a French twist, serving freshly made pastas and perfectly charred pizzas.",website:"https://www.tinbuilding.com/restaurants-and-bars/the-frenchmans-dough",image_url:"//images.ctfassets.net/1aemqu6a6t65/5cF3q5IyV3wMoMTG8Uosqg/b56f643a122208bcc93a07b4dba38bc5/The-Frenchmans-Dough-Seaport-Manhattan-NYC-Photo-Courtesy-The-Seaport-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47950-Frenchman%27sDoughatTinBuildingbyJean-Georges-menu.pdf",primary_location:"The Seaport",address:"96 South St., Manhattan, NY 10038",latitude:40.7062323,longitude:-74.0022681,telephone:"(888)7770942",price_range:"$",facebook_url:"https://www.facebook.com/TinBuildingNYC",instagram_url:"https://instagram.com/tinbuilding",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Stout NYC Financial District",slug:"stout-nyc-financial-district",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"American (Traditional)",summary:"You’ll find all the signature Stout NYC favorites here on the corner of John and Gold Streets in the Financial District.",website:"https://www.stoutnyc.com/location/stout-nyc-financial-district",image_url:"//images.ctfassets.net/1aemqu6a6t65/62ETRmv6PlMKxOgQfToPmH/e565a0f227efbb7aa6df0a33997ba046/Stout-NYC-Manhattan-NYC-Photo-Angelito-Jusay-Virten-Media.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46499-StoutNYCFinancialDistrict-menu.pdf",primary_location:"Lower Manhattan",address:"90 John St., Manhattan, NY 10038",latitude:40.7079836,longitude:-74.0064861,telephone:"(212)2409122",price_range:"$",facebook_url:"https://www.facebook.com/StoutNYCFiDi",instagram_url:"https://instagram.com/stout_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dear Strangers",slug:"dear-strangers",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"American (New)",summary:"Dear Strangers is a Latin-inspired Modern American restaurant and cocktail bar located in Greenwich Village. ",website:"https://dearstrangersnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1x7HKJcpWTDbolJSCnzFmY/0f0c1d24a2d83e931bf44c7c09f20642/Dear-Strangers-Manhattan-NYC-Photo-Andrea-Grujic-3.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49383-DearStrangers-menu.pdf",primary_location:"Greenwich Village",address:"147 W. 4th St., Manhattan, NY 10012",latitude:40.731602,longitude:-74.000376,telephone:"(646)4764422",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/dearstrangersnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Park Ave Kitchen by David Burke",slug:"park-ave-kitchen-by-david-burke",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"Park Ave Kitchen by David Burke brings together delicious and authentic American fare with top-notch service in a fun atmosphere.",website:"https://parkavekitchenbydb.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2Z5jV94EmJBcIoo4YRnhGl/95e8e34c83cc3047d4903308b31a51f5/Park-Ave-Kitchen-by-David-Burke-Manhattan-NYC-Photo-David-Burke-Hospitality-Management.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1266931",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48556-ParkAveKitchenbyDavidBurke-menu.pdf",primary_location:"Midtown East",address:"277 Park Ave., Manhattan, NY 10172",latitude:40.7550435,longitude:-73.973669,telephone:"(646)8474166",price_range:"$",facebook_url:"https://www.facebook.com/parkavekitchenbydb",instagram_url:"https://instagram.com/parkavekitchenbydb",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Twilight Lounge",slug:"twilight-lounge",borough:"Manhattan",neighborhood:"East Village",cuisine:"Chinese",summary:"Twilight Lounge is a modern Chinese kitchen in the East Village where chef Peizheng Chen reimagines Cantonese and Sichuan cuisine. ",website:"https://www.twilightloungenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1pMxt2nZh34kcnp783Sdlu/24770c8ffef40cd48d544b1d78ff4461/Twilight-Lounge-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49782-TwilightLounge-menu.pdf",primary_location:"East Village",address:"110 First Ave., Manhattan, NY 10009",latitude:40.726696,longitude:-73.9857509,telephone:"(646)3516055",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61575244973900",instagram_url:"https://instagram.com/twilightlounge_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Indian Table",slug:"indian-table",borough:"Brooklyn",neighborhood:"Cobble Hill",cuisine:"Indian",summary:"Indian Table showcases the flavors, herbs, spices and cooking techniques of Goa, the coastal Indian state once colonized by the Portuguese, with a distinct British influence.",website:"https://indiantableny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7dZ31XWTedQExWeQu9SHM8/7a9ac09ffe4164a887c928770a9859f8/Indian-Table-Brooklyn-NYC-Photo-Vinicius-Carvalho-4.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45413-IndianTable-menu.pdf",primary_location:"Cobble Hill",address:"234 Court St., Brooklyn, NY 11201",latitude:40.6860572,longitude:-73.9944029,telephone:"(347)6893882",price_range:"$",facebook_url:"https://www.facebook.com/IndianTableNY",instagram_url:"https://instagram.com/IndianTableNY",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosevale Cocktail Room",slug:"rosevale-cocktail-room",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"American (New)",summary:"Rosevale Cocktail Room,  located inside the Civilian Hotel, offers a world-class beverage experience alongside delectable bites.",website:"https://rosevalenyc.com/cocktail-room",image_url:"//images.ctfassets.net/1aemqu6a6t65/4YebqkAphanpmw2lVeF3FR/d42a357f5f04a1db7e6f48985beff59e/Rosevale-Manhattan-NYC-Photo-Orlin-Goble-2.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1443148",menu_url:"",primary_location:"Hells Kitchen",address:"Civilian Hotel, 305 W. 48th St., 10036 Manhattan",latitude:40.76143,longitude:-73.987451,telephone:"(212)3009859",price_range:"$",facebook_url:"https://www.facebook.com/rosevalecocktailroom",instagram_url:"https://instagram.com/rosevalecocktailroom",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Bronx Beer Hall",slug:"bronx-beer-hall",borough:"The Bronx",neighborhood:"Belmont",cuisine:"Eclectic",summary:"In historic Arthur Avenue Retail Market, Bronx Beer Hall offers a selection of local craft beers and food.",website:"https://www.thebronxbeerhall.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5SZmPTRqM0lMC9KVFh15Br/7e5579f419e98b4993a9120f15f50f0a/bronx-beer-hall-belmont-bronx-nyc-molly-flores8.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Belmont",address:"2344 Arthur Ave., Bronx, NY 10458",latitude:40.8542639,longitude:-73.8883864,telephone:"(347)3960555",price_range:"$",facebook_url:"https://www.facebook.com/bronxbeerhall",instagram_url:"https://instagram.com/bronxbeerhall",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pera Mediterranean Brasserie",slug:"pera-mediterranean-brasserie",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Mediterranean",summary:"This gem of a bistro serves innovative interpretations of classic Greek and Turkish dishes in Murray Hill.",website:"https://www.peranyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7qnKICviIjrT1dUXBrlepp/ee93c841dd9670c92da7fd1d1fb32ced/pera-octopus__1___1_.jpeg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"10447",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/30118-PeraMediterraneanBrasserie-menu.pdf",primary_location:"Murray Hill",address:"303 Madison Ave., Manhattan, NY 10017",latitude:40.752316,longitude:-73.9794252,telephone:"(212)8786301",price_range:"$",facebook_url:"https://www.facebook.com/peranyc",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tamarind Tribeca",slug:"tamarind-tribeca",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"Indian",summary:"Avtar Walia, owner of Tamarind in the Flatiron District, has opened Tamarind TriBeCa in a handsome art deco building at the corner of Hudson and Franklin Streets.",website:"https://www.tamarindtribeca.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4RbcH2W0BOlnZPxtTyXLPx/ca21086662f0888e0bd7acc40898e076/tamarind-tribeca-courtesy.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"41389",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/35824-TamarindTribeca-menu.pdf",primary_location:"Tribeca",address:"99 Hudson St., Manhattan, NY 10013",latitude:40.7190756,longitude:-74.0090645,telephone:"(212)7759000",price_range:"$",facebook_url:"https://www.facebook.com/tamarindtribecanyc",instagram_url:"https://instagram.com/tamarindtribecanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Vallata",slug:"vallata",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Italian",summary:"Inspired by his family and their home-cooked meals, Vallata is celebrity chef Tom Colicchio's first-ever Italian restaurant.",website:"https://www.vallatanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2G5kdOeTAVZcxvswzP9yfE/b0672f95205553c91db35a2c4fffc557/Vallata-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1209775",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46368-Vallata-menu.pdf",primary_location:"Gramercy",address:"47 E. 19th St., Manhattan, NY 10003",latitude:40.7380708,longitude:-73.9886063,telephone:"(212)4614300",price_range:"$",facebook_url:"https://www.facebook.com/vallatanyc",instagram_url:"https://instagram.com/vallatanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Aldo Sohm Wine Bar",slug:"aldo-sohm-wine-bar",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"French",summary:"An elegant glass of wine, discriminating snack and a quiet, plush setting can be had at Aldo Sohm Wine Bar, a prime Midtown destination.",website:"https://www.aldosohmwinebar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/yMLYz7n48EDhIhNDqi6Uh/c9bfd8b236702afba01f1b36253de041/Aldo-Sohm-Wine-Bar-Manhattan-NYC-Photo-Francesco-Tonelli.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49929-AldoSohmWineBar-menu.pdf",primary_location:"Midtown West",address:"151 W. 51st St., Manhattan, NY 10019",latitude:40.7614804,longitude:-73.9814283,telephone:"(212)5541143",price_range:"$",facebook_url:"https://www.facebook.com/SohmBar",instagram_url:"https://instagram.com/sohmbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Baciccia Pizza e Cucina",slug:"baciccia-pizza-e-cucina",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Italian",summary:"Baciccia offers a number of classic Ligurian delicacies, including their neighborhood-famous Trofie al Pesto Genovese, as well as brick oven Roman-style pizza.",website:"https://bacicciabrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7Jv3YogWeCzUi9IhKKwHUa/1f71018d663aebb6bfa6004e5194bee2/Baciccia-Pizza-E-Cucina-Brooklyn-NYC-Photo-Hanna-Pabonan-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49764-BacicciaPizzaeCucina-menu.pdf",primary_location:"Park Slope",address:"426A 7th Ave., Brooklyn, NY 11215",latitude:40.6638125,longitude:-73.9844534,telephone:"(718)7881000",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/bacicciabk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ilili Restaurant",slug:"ilili-restaurant",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Mediterranean",summary:"Ilili is New York's premier contemporary Mediterranean restaurant, offering inspired Lebanese cuisine.",website:"https://www.ililirestaurants.com/location/ilili-nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/1jhRP2avSmid3iW9tINvLU/c6e82621aceeb2b87e0a65c77ce6b058/RW-To-Go_ilili-Restaurant_B7AB9EC7-5056-A36F-23307BE7765CB397-b7ab9d905056a36_b7ab9f19-5056-a36f-236b4ebbd86c1469.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"15550",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/32279-ilili-menu.pdf",primary_location:"Nomad",address:"236 Fifth Ave., Manhattan, NY 10001",latitude:40.7444147,longitude:-73.9879195,telephone:"(212)6832929",price_range:"$",facebook_url:"https://www.facebook.com/ililinyc",instagram_url:"https://instagram.com/ililirestaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Flatiron Room - NoMad",slug:"the-flatiron-room",borough:"Manhattan",neighborhood:"Nomad",cuisine:"American (New)",summary:"Private-stock scotch and nightly jazz performances take center stage at this Flatiron-area lounge, while the dishes served are meant to be enjoyed in their natural state, letting the complexity of their flavors truly take hold.",website:"https://www.theflatironroom.com/nomad-home",image_url:"//images.ctfassets.net/1aemqu6a6t65/2KWWfKV3U6QfbckDMIgTE2/d8a6aec30568d84105a7dfd05e15e3f4/The-Flatiron-Room-Manhattan-NYC-Photo-Heather-Willensky-2__1_.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41029-FlatironRoom-NoMad-menu.pdf",primary_location:"Nomad",address:"37 W. 26th St., Manhattan, NY 10010",latitude:40.7445865,longitude:-73.9904569,telephone:"(212)7253860",price_range:"$",facebook_url:"https://www.facebook.com/TheFlatironRoomNoMad",instagram_url:"https://instagram.com/theflatironroom_nomad",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tasca NYC",slug:"tasca-nyc",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Latin American",summary:'Tasca (Iberian for "tavern") brings together the vibrant flavors and culinary traditions of both Spain and the islands of the Latin Caribbean: Puerto Rico, the Dominican Republic and Cuba.',website:"https://www.tasca-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/jT96XBQGdlfPxrqscStNk/5e747da886c9e017c575e84cd5f25da4/Tasca_1120_2_LizClayman_002_78D5687B-6DF5-4854-A5CF219704C04DAE_5814c5f3-389c-4aa6-a8399a265c1c7215.jpg",meal_types:["$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1144567",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46084-TascaNYC-menu.pdf",primary_location:"Upper West Side",address:"505 Columbus Ave., Manhattan, NY 10024",latitude:40.7852908,longitude:-73.9726952,telephone:"(212)3622211",price_range:"$",facebook_url:"https://www.facebook.com/tascaNYC",instagram_url:"https://instagram.com/tascaNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Fleur Rouge",slug:"le-fleur-rouge",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Chinese",summary:"Le Fleur Rouge, a unique culinary experience rooted in Brooklyn, merges the vibrant flavors of Chinese cuisine with French culinary finesse, helmed by a Michelin-trained chef. ",website:"https://lefleurrouge.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/1dmEh4HdO1NxyvN7BpSxyU/054c70006a3a1e1ac486d41c5475814e/DSC02540_5F1687BE-EB4B-403C-AAF648B622C4BF01_c0a1c2e4-0462-4739-bf0259ee73805155.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49333-LeFleurRouge-menu.pdf",primary_location:"Park Slope",address:"392 5th Ave., Brooklyn, NY 11215",latitude:40.6708117834,longitude:-73.9851043394,telephone:"(718)5340110",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lefleurrouge.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tarallucci e Vino - Upper West Side",slug:"tarallucci-e-vino-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"Tarallucci e Vino Upper West Side is a locals’ favorite restaurant known for expertly crafted coffee, housemade pastries, fresh pastas and authentic Italian cuisine.",website:"https://www.taralluccievino.net/upper-west-side-location",image_url:"//images.ctfassets.net/1aemqu6a6t65/4SnesfEWe15a8MgYMjDtzK/853479d659774389cea147016b0bfe45/Tarallucci-e-Vino-NYC-UWS-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"261745",menu_url:"",primary_location:"Upper West Side",address:"475 Columbus Ave., Manhattan, NY 10024",latitude:40.7843419,longitude:-73.9734658,telephone:"(212)3625454",price_range:"$",facebook_url:"https://www.facebook.com/taralluccinyc",instagram_url:"https://instagram.com/taralluccinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gyu-Kaku Japanese BBQ - Midtown",slug:"gyu-kaku-midtown",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Japanese / Sushi",summary:"Gyu-Kaku specializes in yakiniku—Japanese barbecue meat over a charcoal grill.",website:"https://www.gyu-kaku.com/midtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/1roInUUcloQkNdfInxkcO7/25af15e469961d91cdd095cd9930544f/rw-to-go_gyu-kaku_midtown__1___1_.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"7700",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44802-Gyu-KakuJapaneseBBQ-Midtown-menu.pdf",primary_location:"Midtown East",address:"805 Third Ave., 2nd fl., 10022 Manhattan",latitude:40.7554154,longitude:-73.9705757,telephone:"(212)7028816",price_range:"$",facebook_url:"https://www.facebook.com/GyuKakuJBBQ",instagram_url:"https://instagram.com/gyukakujbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dos Caminos Times Square",slug:"dos-caminos-times-square",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Mexican",summary:"Dos Caminos Times Square spans two floors and features a 40-seat mezcal and margarita bar on the street level and a guacamole bar on the subterranean level.",website:"https://www.doscaminos.com/times-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/63N7f41ifa9pEIVZnrCLCU/c200590020be9154e4e280778605d017/_dos-caminos-times-square-001.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"186067",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38992-DosCaminosTimesSquare-menu.pdf",primary_location:"Times Square/Theatre District",address:"W New York—Times Square, 1567 Broadway, 10036 Manhattan",latitude:40.7593016,longitude:-73.9855873,telephone:"(212)9181330",price_range:"$",facebook_url:"https://www.facebook.com/doscaminos",instagram_url:"https://instagram.com/doscaminos",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Benoit Restaurant & Wine Bar",slug:"benoit-restaurant-wine-bar",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"French",summary:"There were high expectations for this Midtown French bistro even before the doors opened, as it was the latest in the restaurant family of Alain Ducasse, arguably the top French chef in the world.",website:"https://www.benoitny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5fZCj0WbHvdjBBKZSZptbL/9da45e9d2a98ffc9fa9817f2e82978ec/benoit_pierre-monetta.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"21025",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/32478-BenoitRestaurant%26WineBar-menu.pdf",primary_location:"Midtown West",address:"60 W. 55th St., Manhattan, NY 10019",latitude:40.7624832,longitude:-73.9773402,telephone:"(646)9437373",price_range:"$",facebook_url:"https://www.facebook.com/benoitbistroNY",instagram_url:"https://instagram.com/benoitny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hav & Mar",slug:"hav-mar",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Seafood",summary:"Hav & Mar is a vibrant seafood house in Chelsea from chef Marcus Samuelsson.",website:"https://www.havandmar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3VSQxYfh919vBBQYbSgewC/36bba21d8e77b4f18d54b9f1be21e38e/Hav-and-Mar-Manhattan-NYC-Photo-Andrew-Lee-Thomas.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"1259890",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48438-Hav%26Mar-menu.pdf",primary_location:"Chelsea",address:"245 Eleventh Ave., Manhattan, NY 10001",latitude:40.7450991,longitude:-74.0080411,telephone:"(212)3288041",price_range:"$",facebook_url:"https://www.facebook.com/havandmar",instagram_url:"https://instagram.com/havandmar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Four Twenty Five",slug:"four-twenty-five",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"This new restaurant from chef Jean-Georges Vongerichten perfectly blends culinary excellence with architectural marvel and sustainability practices.",website:"https://www.425parkrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6PkOxaGubsmeoBDNP31cSs/2e3a9e48d8f64b61f7af9768ea34d8a1/Fiour-Twenty-Five-Manhattan-NYC-Photo-Nicole-Franzen.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48360-FourTwentyFive-menu.pdf",primary_location:"Midtown East",address:"425 Park Ave., Manhattan, NY 10022",latitude:40.7605182,longitude:-73.9712319,telephone:"(212)7516921",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/425restaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:43},{name:"Dagon",slug:"dagon",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Mediterranean",summary:"The menu at Dagon, named for the Phoenician and Philistine god of agriculture and the earth, showcases modern Israeli cuisine with Levantine influences.",website:"https://dagonnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4OTLg8XjDnHx3wbNtzdPaD/e73212fd7c259ebccc67302b8b3af3b4/dagon_pic_sign.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1071811",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46071-Dagon-menu.pdf",primary_location:"Upper West Side",address:"2454 Broadway, Manhattan, NY 10024",latitude:40.7911514,longitude:-73.9739083,telephone:"(212)8732466",price_range:"$",facebook_url:"https://www.facebook.com/dagonnyc",instagram_url:"https://instagram.com/dagonnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Clara",slug:"clara",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (New)",summary:"Set inside the iconic New-York Historical Society building across from Central Park, Clara offers upscale New York classics.",website:"https://www.clara-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2Rp84WQPzCffKVLMP5Vpvs/c670c6fcd435f84da08e8b382a8bf4c7/Clara-Restaurant-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48603-Clara-menu.pdf",primary_location:"Upper West Side",address:"The New-York Historical, 170 Central Park West (entry at 2 W. 77th St.), 10024 Manhattan",latitude:40.7793487,longitude:-73.9739079,telephone:"(212)4859211",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/clararestaurant_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Evalyn’s Tap House",slug:"evalyns-tap-house",borough:"Brooklyn",neighborhood:"Boerum Hill",cuisine:"Gastropub",summary:"Experience the gastropub menu at Evalyn’s Tap House, which is thoughtfully curated by their talented chef, Steffen Sander.",website:"https://www.evalynstaphouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1VkKsn9PZ2lSVCvIsUd7C4/cc2ad3c7f5b780fa203370c6e051c8d1/Evalyn-Tap-House-Brooklyn-NYC-Photo-Heather-Willensky-_1.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1283887",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47829-Evalyn%E2%80%99sTapHouse-menu.pdf",primary_location:"Boerum Hill",address:"236 Butler St., Brooklyn, NY 11217",latitude:40.681481,longitude:-73.985532,telephone:"(718)2101899",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/evalyns.tap.house",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"French Roast",slug:"french-roast",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"French",summary:"Upper West Siders have flocked to this popular French cafe for years for a taste of their bistro favorites, like croque monsieur, steak frites, French onion soup, duck confit and burgers, as well as a full brunch menu.",website:"https://www.frenchroastnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6oUti5r40iFB9Dpe3gr8hP/fdae2e3b66f48221b60e26bfb5a63ec9/RW-To-Go_French-Roast-Uptown_B71F8F50-5056-A36F-23F319B193ED6491-b71f8e805056a36_b71f8fb2-5056-a36f-23bbe1b8afbd654c.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"3783",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/23932-FrenchRoast-menu.pdf",primary_location:"Upper West Side",address:"2340 Broadway, Manhattan, NY 10024",latitude:40.7876417,longitude:-73.9765902,telephone:"(212)7991533",price_range:"$",facebook_url:"https://www.facebook.com/FrenchRoastnyc",instagram_url:"https://instagram.com/frenchroastnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Michael's",slug:"michaels-restaurant",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"American (New)",summary:"Michael's has long functioned as a power-breakfast-and-lunch scene for the who's who of media.",website:"https://michaelsnewyork.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3lEa1YSWet2h3EXCiWa36q/c0a9c304d55cfc7a20f673a5d5e61a77/_michaels-restaurant-courtesy001.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/7852-Michael%27s-menu.pdf",primary_location:"Midtown West",address:"24 W. 55th St., Manhattan, NY 10019",latitude:40.7620797,longitude:-73.9764438,telephone:"(212)7670555",price_range:"$",facebook_url:"https://www.facebook.com/michaelsnyc",instagram_url:"https://instagram.com/michaelsnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Charlie Palmer Steak IV",slug:"charlie-palmer-steak-iv",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Steakhouse",summary:`Chef Palmer adds new twists to his acclaimed cuisine to create the Knickerbocker Hotel's signature "Honest American Cuisine" in an open-action kitchen.`,website:"https://www.charliepalmersteak.com/charlie-palmer-steak-iv",image_url:"//images.ctfassets.net/1aemqu6a6t65/3uYuLKwCe9JYwtOkI2FqaM/71b33305ec431f5019a736a6a238bc40/Charlie-Palmer-Steak-IV-Manhattan-NYC-Photo-Briana-Balducci-1.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"33133",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39448-CharliePalmerSteakIV-menu.pdf",primary_location:"Times Square/Theatre District",address:"The Knickerbocker, 6 Times Square, Manhattan 4th fl.",latitude:40.7556622,longitude:-73.9862703,telephone:"(212)3191660",price_range:"$",facebook_url:"https://www.facebook.com/cpsteaknyc",instagram_url:"https://instagram.com/charliepalmersteak",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tucci",slug:"tucci",borough:"Manhattan",neighborhood:"Noho",cuisine:"Italian",summary:"Tucci, New York's newest Italian restaurant, serves refined modern Italian cuisine and family recipes in a warm and inviting atmosphere.",website:"https://www.tuccinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/42sEz9BnSSgikswoGGv4QG/8766b3609b428e89fd9041ee06c07e67/Tucci-Manhattan-NYC-Courtesy-_7.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48976-Tucci-menu.pdf",primary_location:"Noho",address:"643 Broadway, Manhattan, NY 10012",latitude:40.7267089,longitude:-73.9959191,telephone:"(917)8311401",price_range:"$",facebook_url:"https://www.facebook.com/tuccinewyork",instagram_url:"https://instagram.com/tuccinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Restaurant Nippon",slug:"restaurant-nippon",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Japanese / Sushi",summary:"Opened in 1963, Restaurant Nippon became the first Japanese restaurant in the United States with an authentic sushi bar.",website:"https://www.restaurantnippon.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2xsArCiXsHZRJakuo9wD1f/4990458d2e84329ef757c0d980c2aa9c/Restaurant-Nippon-Manhattan-NYC-Photo-Hachikin-Creative-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"45151",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36345-RestaurantNippon-menu.pdf",primary_location:"Midtown East",address:"155 E. 52nd St., Manhattan, NY 10022",latitude:40.7573354,longitude:-73.9704484,telephone:"(212)6885941",price_range:"$",facebook_url:"https://www.facebook.com/RestaurantNipponNYC",instagram_url:"https://instagram.com/restaurant_nippon",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Harta",slug:"harta",borough:"Manhattan",neighborhood:"Garment District",cuisine:"American (New)",summary:"Harta is a New American brasserie that features flavors spanning the Mediterranean and beyond.",website:"https://www.hartanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7lfnMJ3SSsrG2vKwKA9d9R/3741eef4d8d1b76d5f9168e9cc63f6c1/harta-garment-district-manhattan-nyc-courtesy-03__1_.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1256209",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47823-Harta-menu.pdf",primary_location:"Garment District",address:"Grayson Hotel, 30 W. 39th St., 10018 Manhattan",latitude:40.7520979,longitude:-73.9838551,telephone:"(646)4436864",price_range:"$",facebook_url:"https://www.facebook.com/hartanyc",instagram_url:"https://instagram.com/hartanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Morandi",slug:"morandi",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Morandi's rustic space is a fitting setting for its sublime Italian dishes.",website:"https://www.morandiny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6iwK5JgrukRDRByoix9wZM/67a76222e11d7f6315da41123941df4b/RW-To-Go_Morandi_45D99015-5056-A36F-230EA596BF3D2FEF-45d98edf5056a36_45d99072-5056-a36f-232cee0562097001.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40775-Morandi-menu.pdf",primary_location:"West Village",address:"211 Waverly Pl., Manhattan, NY 10014",latitude:40.735317,longitude:-74.0014282,telephone:"(212)6277575",price_range:"$",facebook_url:"https://www.facebook.com/morandinyc",instagram_url:"https://instagram.com/morandinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rivercrest",slug:"rivercrest",borough:"Queens",neighborhood:"Astoria",cuisine:"American (New)",summary:"Named for the former Astoria Sanitarium that was closed in 1961, Rivercrest offers craft beer, cocktails and all kinds of comfort foods.",website:"https://www.rivercrestny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/13zp4T5oXnWxkv01YQIndr/53f4040708c2171fffad8ca8803040b5/compressed-Rivercrest-Astoria-NYC-Photo-Kai-Liu-2__1_.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44219-Rivercrest-menu.pdf",primary_location:"Astoria",address:"33-15 Ditmars Blvd., Queens, NY 11105",latitude:40.7751808,longitude:-73.9089998,telephone:"(347)8087887",price_range:"$",facebook_url:"https://www.facebook.com/RiverCrestNYC",instagram_url:"https://instagram.com/rivercrestnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Café Boulud",slug:"cafe-boulud",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"French",summary:"Daniel Boulud's tribute to the original Café Boulud in Lyon, France, serves finely executed cuisine.",website:"https://www.cafeboulud.com/nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/2g6BkcyaE0uNJEGTJiXpNG/ad48c50979d8a8d3249b10018954f6ab/Cafe-Boulud-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/16367-CafeBoulud-menu.pdf",primary_location:"Upper East Side",address:"100 E. 63rd St., Manhattan, NY 10065",latitude:40.7650665,longitude:-73.9676538,telephone:"(212)7722600",price_range:"$",facebook_url:"https://www.facebook.com/CafeBouludNY",instagram_url:"https://instagram.com/cafebouludny",michelin_award:"ONE_STAR",michelin_slug:"cafe-boulud",nyttop100_rank:""},{name:"Eléa",slug:"elea",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Greek",summary:"The Upper West Side welcomes a modern split-level Greek restaurant.",website:"https://eleanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5VeZwGOe9JaBRuc5mddYK5/225b2a5eeb8af74088558cb3b51d8729/RW-To-Go_El-a_B6BD7B53-5056-A36F-23E76BDC9748F015-b6bd794f5056a36_b6bd7bd9-5056-a36f-235b227c2ec0ea04.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1011193",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41205-Elea-menu.pdf",primary_location:"Upper West Side",address:"217 W. 85th St., Manhattan, NY 10024",latitude:40.7875756,longitude:-73.976447,telephone:"(212)3699800",price_range:"$",facebook_url:"https://www.facebook.com/Elea-1363632107115290",instagram_url:"https://instagram.com/elea_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sempre Oggi",slug:"sempre-oggi",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"Born from Italian tradition and heritage, executive Chef Phillip Basone's menu takes seasonal and local ingredients and places them center stage.",website:"https://www.semprenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3n5mwbOdMfYRRItiCZGchp/1e7fbfca58048d208ae4a0c0bd738816/z1ar18tQ_FE77D789-14D5-4A56-9AC88331536DC441_a61d1612-81e9-49e6-ad5b68bcc3f757fe",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1328710",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48987-SempreOggi-menu.pdf",primary_location:"Upper West Side",address:"164 W. 75th St., Manhattan, NY 10023",latitude:40.7802763,longitude:-73.9798894,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Uva Next Door",slug:"uva-next-door",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Seasonal Italian classics and fantastic Amalfi style pizza paired with a cocktail-forward beverage program make Uva Next Door the playful little sister to the original Uva.",website:"https://www.uvanextdoor.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5IsBlfCXGTpUt9j8JzIt5y/27f243ff5e116772f0c568abe5adb42d/Uva-Next-Door-Interior-Manhattan-NYC-Photo-Courtesy-Uva-Next-Door-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46450-UvaNextDoor-menu.pdf",primary_location:"Upper East Side",address:"1484 Second Ave., Manhattan, NY 10075",latitude:40.7721348,longitude:-73.9556277,telephone:"(917)4727921",price_range:"$",facebook_url:"https://www.facebook.com/Uva-Next-Door-101550205185193",instagram_url:"https://instagram.com/uvanextdoor",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dinner Party",slug:"dinner-party",borough:"Brooklyn",neighborhood:"Clinton Hill",cuisine:"American (New)",summary:"The cuisine falls somewhere between French, Italian, and, as the chef loves to insist, “Californian”—reflecting the myriad possible directions of a set menu that changes every week.",website:"https://www.dinnerpartybk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4w4VT3qzu0cHpLOlifxgkp/7ef967af82243517f8e899341c912917/Dinner-Party-Brooklyn-NYC-Photo-George-Watts-9.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49804-DinnerParty-menu.pdf",primary_location:"Clinton Hill",address:"274 Hall St., Brooklyn, NY 11205",latitude:40.6900427,longitude:-73.9654379,telephone:"(347)4639173",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/dinnerpartybk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Aqua Boil",slug:"aqua-boil",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Seafood",summary:"Aqua Boil is a noteworthy seafood spot serving Cajun-inspired seafood boils, lobster rolls and fried fish platters plus nautically themed cocktails.",website:"https://www.aquaboilnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3KW67WpwyN8SwlFJdwz1ic/dc5fa820dc7cb39e99af1f8d1bdff0d2/Aqua-Boil-Manhattan-NYC-Courtesy-_2.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["summer-vibes"],opentable_id:"1401595",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41672-AquaBoil-menu.pdf",primary_location:"Hells Kitchen",address:"750 Ninth Ave., Manhattan, NY 10019",latitude:40.7637215,longitude:-73.988403,telephone:"(212)4647428",price_range:"$",facebook_url:"https://www.facebook.com/aquaboilnyc",instagram_url:"https://instagram.com/aquaboilnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Haven Rooftop",slug:"haven-rooftop",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"American (New)",summary:"Haven is a swanky rooftop lounge and restaurant at the Sanctuary Hotel that offers a welcome retreat from the hectic streets below.",website:"https://www.havenrooftop.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1e63EYQdg4Swe3erTIDr3d/548a6eb6910ca3add9876a0613b018a0/havenrooftop_courtesy_04",meal_types:["$30 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"90400",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/34081-HavenRooftop-menu.pdf",primary_location:"Times Square/Theatre District",address:"Sanctuary Hotel, 132 W. 47th St., 10036 Manhattan",latitude:40.7584057,longitude:-73.9833062,telephone:"(212)4669000",price_range:"$",facebook_url:"https://www.facebook.com/HavenRooftop",instagram_url:"https://instagram.com/havenRooftop",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Uptown Garrison",slug:"the-uptown-garrison",borough:"Manhattan",neighborhood:"Washington Heights",cuisine:"American (New)",summary:"With specialty coffee, breakfast sandwiches, brick-oven pizza and craft cocktails on offer, The Uptown Garrison has something to satisfy your cravings from morning till night.",website:"https://www.theuptowngarrison.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/sXWliBwR5b1DiwvTYAWS9/3aca4255d614eebfe4f96636340cbc6b/The-Uptown-Garrison-Garrison-Washington-Heights-Manhattan-NYC-Courtesy__1___1_.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45361-UptownGarrison-menu.pdf",primary_location:"Washington Heights",address:"821 W. 181st St., Manhattan, NY 10033",latitude:40.851348,longitude:-73.939392,telephone:"(917)2614680",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/theuptowngarrison",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Altamirano’s Italian Ristorante",slug:"altamiranos-italian-ristorante",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Experience Italian classics with a twist at Altamirano's, family owned and operated by former Upper East Side waiters living their dream. ",website:"https://altamiranositalianristorante.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5VOWsVgmG3N49DrO9EmVLX/cc6c9019edc9afbaf4cfeeb15b7312ab/Altamirano-s-Italian-Ristorante-Manhattan-NYC-Photo-Courtesy-1.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1433932",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49758-Altamirano%E2%80%99sItalianRistorante-menu.pdf",primary_location:"Upper East Side",address:"1479 York Ave., Manhattan, NY 10075",latitude:40.7709789,longitude:-73.9510577,telephone:"(646)6827676",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61575533247733",instagram_url:"https://instagram.com/altamiranos.italian.ristorante",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Gioconda",slug:"la-gioconda",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Italian",summary:"La Gioconda focuses on typical regional Italian cuisine using the finest ingredients",website:"https://www.lagiocondanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3h8j57UkHV8Enhq0gOE753/b660c4b20aba7bdafcbead033a1b7fe5/La-Gioconda-Manhattan-NYC-Photo-Courtesy-La-Gioconda-4.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45508-LaGioconda-menu.pdf",primary_location:"Midtown East",address:"226 E. 53rd St., Manhattan, NY 10022",latitude:40.757067,longitude:-73.9684282,telephone:"(212)3713536",price_range:"$",facebook_url:"https://www.facebook.com/lagiocondanyc",instagram_url:"https://instagram.com/lagiocondanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Armani/Ristorante New York",slug:"armani-ristorante-new-york",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Chef Daniele Castellano translates Armani's tasteful philosophy to include simple yet enticing Italian dishes.",website:"https://www.armani.com/en-us/experience/armani-restaurant/armani-ristorante-new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/tZEcZ0DhMmWNUIO2pzIyN/36175589aef36495d0a6f063f194a033/Armani-Ristorante-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$60 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/34566-Armani-RistoranteNewYork-menu.pdf",primary_location:"Upper East Side",address:"760 Madison Ave., Manhattan, NY 10065",latitude:40.7676012,longitude:-73.9687464,telephone:"(212)2071902",price_range:"$",facebook_url:"https://www.facebook.com/armaniristorante",instagram_url:"https://instagram.com/armanirestaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Palermo Argentinian Bistro - NYC",slug:"palermo-argentinian-bistro",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Argentinian",summary:"Meat lovers will love Palermo Argentinian Bistro on Restaurant Row, where beef reigns supreme.",website:"https://palermonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1rao5DwZPIwQultAAxG9Hd/78f0878e76d1232d401a5f886c99c4f9/Palermo-Manhattan-NYC-Courtesy-3.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1180861",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48474-PalermoArgentinianBistro-NYC-menu.pdf",primary_location:"Times Square/Theatre District",address:"373 W. 46th St., Manhattan, NY 10036",latitude:40.7609425,longitude:-73.9903468,telephone:"(212)2652060",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/palermobistro",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Addictive NYC",slug:"addictive-nyc",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Spanish",summary:"Tapas bar, wine bar and restaurant filled with delicious wines and dishes inspired by their love of vineyards terroir around the world as well as Mediterranean flavors.",website:"https://addictivenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7LXiBXYGz0FcvWMsbcN3yn/a49177b19790c345ecd92c173918eb99/Tiramisu-Addictive-NYC-Manhattan-NYC-Photo-Patrick-Duonh.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1257724",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46551-AddictiveNYC-menu.pdf",primary_location:"Midtown West",address:"19 W. 46th St., Manhattan, NY 10036",latitude:40.7565859,longitude:-73.9800332,telephone:"(212)3909578",price_range:"$",facebook_url:"https://www.facebook.com/Addictiveon5thave",instagram_url:"https://instagram.com/addictivenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Fresco by Scotto",slug:"fresco-by-scotto",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Italian",summary:"For more than three decades, Fresco by Scotto, a family-run venture, has been a go-to destination for celebrities, CEOs, and New Yorkers in the know.",website:"https://www.frescobyscottony.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/JRA3952cmkq984eSRczU4/077989db9678e4967f89b9d90f0af765/Fresco-by-Scotto-Midtown-East-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/17058-FrescobyScotto-menu.pdf",primary_location:"Midtown East",address:"34 E. 52nd St., New York, NY 10022",latitude:40.7588164,longitude:-73.9745136,telephone:"(212)9353434",price_range:"$",facebook_url:"https://www.facebook.com/FrescobyScotto",instagram_url:"https://instagram.com/frescobyscotto",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bar56",slug:"bar56",borough:"Brooklyn",neighborhood:"Dumbo",cuisine:"American (New)",summary:'A Modern American menu with Italian and French influences is complemented by a carefully curated wine list to provide "Palate Character."',website:"https://www.bar56dumbo.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/78EjJDqTVayKKhkBSZISlF/b08904c4d4d2d270b430b681caf6b4d8/Bar-56-Manhattan-NYC-Photo-James-Fantaci-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49010-Bar56-menu.pdf",primary_location:"Dumbo",address:"53 Water St., Brooklyn, NY 11201",latitude:40.7034261,longitude:-73.9924083,telephone:"(718)7014956",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/taste56wines",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Boucherie West Village",slug:"boucherie-west-village",borough:"Manhattan",neighborhood:"West Village",cuisine:"French",summary:"Boucherie West Village is a traditional French brasserie and steakhouse, celebrating Joie de Vivre, that prepares a menu of French classics and timeless bistro favorites, in addition to dry-aged steaks.",website:"https://www.boucherieus.com/location/boucherie-west-village",image_url:"//images.ctfassets.net/1aemqu6a6t65/ktfCKp23swyHcoHQeqGQk/a7da98f91098282d5ba2caef7bdac255/Boucherie-WV-Manhattan-NYC-Photo-Jai-Nima-Idowu.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"346609",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/43875-BoucherieWestVillage-menu.pdf",primary_location:"West Village",address:"99 Seventh Ave. South, Manhattan, NY 10014",latitude:40.7330828,longitude:-74.0028776,telephone:"(212)8371616",price_range:"$",facebook_url:"https://www.facebook.com/BoucherieNYC",instagram_url:"https://instagram.com/boucherie_us",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Takumen",slug:"takumen",borough:"Queens",neighborhood:"Long Island City",cuisine:"Japanese / Sushi",summary:"Restorative bowls of ramen, sashimi and sushi rolls are served up at this hip izakaya.",website:"http://www.takumenlic.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2qvnZRBZJ3OdWGSA1qbs2S/b810e482e070d96d816083fd087acca5/Takumen-Manhattan-NYC-Photo-Nao-Fukui-_1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47805-Takumen-menu.pdf",primary_location:"Long Island City",address:"5-50 50th Ave., Queens, NY 11101",latitude:40.7427319,longitude:-73.9546865,telephone:"(718)3617973",price_range:"$",facebook_url:"https://www.facebook.com/TakumenLIC",instagram_url:"https://instagram.com/takumenlic",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Palo Santo",slug:"palo-santo",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Latin American",summary:"At Palo Santo, you’ll find chef Jacques Gautier’s pan-Latin cooking in a Brooklyn brownstone.",website:"https://www.palosantorestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5ETarL1jdkgDinp7gVahLy/0508cc336381e9a0b2f4868e82efc1cf/Palo-Santo-Brooklyn-NYC-Courtesy-1.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45493-PaloSanto-menu.pdf",primary_location:"Park Slope",address:"652 Union St., Brooklyn, NY 11215",latitude:40.6767933,longitude:-73.9819584,telephone:"(718)6366311",price_range:"$",facebook_url:"https://www.facebook.com/palo.santoBK",instagram_url:"https://instagram.com/palosantobk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Villa Berulia",slug:"villa-berulia",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Italian",summary:"Located on 34th Street in the historic Murray Hill district of Manhattan, Villa Berulia offers a bucolic retreat from the hectic area around the Empire State Building only four blocks away.",website:"https://villaberulia.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5wpOviReIkKMHPevYsnetS/9399544804bb53426a059e9b0a9b4812/villa-berulia-nyc-courtesy-villa-berulia-inc-05.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"242167",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/12618-VillaBerulia-menu.pdf",primary_location:"Murray Hill",address:"107 E. 34th St., Manhattan, NY 10016",latitude:40.7469315,longitude:-73.9805395,telephone:"(212)6891970",price_range:"$",facebook_url:"https://www.facebook.com/VillaBeruliaNYC",instagram_url:"https://instagram.com/villaberulia",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Crave Fishbar - Midtown",slug:"crave-fishbar-turtle-bay",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Seafood",summary:"Crave Fishbar—NYC’s first 100% sustainable seafood restaurant—is home to the #Oystergram Happy Hour, one of NYC’s best oyster happy hour deals.",website:"https://cravefishbar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4vtOWZen9logs0KrPKE5T0/6ecde081ac67a306a74c0e6d47015641/Barramundi_4BAB53F9-DAA3-4ED8-A1EB0558460CD18E_6d07da69-c183-45b2-bb70b64158ff78fe.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"90223",menu_url:"",primary_location:"Midtown East",address:"945 Second Ave., Manhattan, NY 10022",latitude:40.755145,longitude:-73.9686917,telephone:"(646)8959585",price_range:"$",facebook_url:"https://www.facebook.com/cravefishbar",instagram_url:"https://instagram.com/cravefishbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dos Caminos Meatpacking District",slug:"dos-caminos-meatpacking-district",borough:"Manhattan",neighborhood:"Meatpacking District",cuisine:"Mexican",summary:"The fourth NYC outpost of this mod-Mexican mini-empire boasts a chic Meatpacking District address (in the prominent space formerly occupied by Vento Trattoria).",website:"https://www.doscaminos.com/meatpacking",image_url:"//images.ctfassets.net/1aemqu6a6t65/3825Cty7LszX65ihjiwUK1/4a8dc8bee79771697deeebbde99fe9b0/_dos-caminos-meatpacking-noah-fecks-001.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"30508",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/24743-DosCaminosMeatpackingDistrict-menu.pdf",primary_location:"Meatpacking District",address:"675 Hudson St., Manhattan, NY 10014",latitude:40.7404411,longitude:-74.0054362,telephone:"(212)6992400",price_range:"$",facebook_url:"https://www.facebook.com/doscaminos",instagram_url:"https://instagram.com/doscaminos",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Socarrat Paella Bar - Midtown East",slug:"socarrat-paella-bar-midtown-east",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Spanish",summary:"Socarrat is the sensuous crust that forms on the bottom of the paella pan when the liquid is rendered and the rice reaches its peak of succulence.",website:"https://socarratnyc.com/midtown-east",image_url:"//images.ctfassets.net/1aemqu6a6t65/5klYuj1DN9HCC2Tetj7e5p/d4a0d2e32073a152a1e98c72f7487e95/socarrat-paella-bar-photo-courtesy-0-3__1___1_.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"96670",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38285-SocarratPaellaBar-MidtownEast-menu.pdf",primary_location:"Midtown East",address:"953 Second Ave., Manhattan, NY 10022",latitude:40.7553091,longitude:-73.9685283,telephone:"(212)7590101",price_range:"$",facebook_url:"https://www.facebook.com/socarratpaellabar",instagram_url:"https://instagram.com/SocarratNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Darbar Grill",slug:"darbar-grill",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Indian",summary:"Darbar Grill, conveniently located in the heart of East Midtown, serves up solid, fresh Indian cuisine.",website:"https://darbargrill.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3Ty8dt9rC5mlAfdTIHkq4P/ab1f8fff5dabcd1ea4ccd12f3eee0327/darbargrill-55st.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"27742",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/10578-DarbarGrill-menu.pdf",primary_location:"Midtown East",address:"157 E. 55th St., Manhattan, NY 10022",latitude:40.759341,longitude:-73.9688386,telephone:"(212)7514600",price_range:"$",facebook_url:"https://www.facebook.com/darbargrill",instagram_url:"https://instagram.com/darbargrillrestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Leuca",slug:"leuca",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Italian",summary:"Inspired by Southern Italy, Leuca is a neighborhood restaurant from Chef Andrew Carmellini's NoHo Hospitality Group serving house-made pastas, wood-fired pizzas and rustic dishes in a sunlit corner space in Williamsburg.",website:"https://www.leuca.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/645MIc357rJ1DOXaXNHJwV/1705ac9e1994cb5dacb1d36d7ef52632/RW-To-Go_Leuca_DF0717AB-5056-A36F-235B658CC6CE49D8-df0716105056a36_df0717fe-5056-a36f-23d3387cab529eaa.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["around-the-boroughs"],opentable_id:"268384",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40160-Leuca-menu.pdf",primary_location:"Williamsburg",address:"111 N. 12th St., Brooklyn, NY 11249",latitude:40.7223157,longitude:-73.9566829,telephone:"(718)5815900",price_range:"$",facebook_url:"https://www.facebook.com/leucanyc",instagram_url:"https://instagram.com/leucanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Greywind",slug:"greywind",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"American (New)",summary:"Chef Dan Kluger offers a seasonally-driven, vegetable-forward dining experience that creatively highlights seasonal ingredients and rotisserie cooking.",website:"https://www.greywindnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/IHjs3HXUhka0Oi5bHTETw/9bf25ac467b7e0a2fb9085a16acb79ff/Greywind-Manhattan-NYC-Courtesy-5.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["celebrity-chefs"],opentable_id:"",menu_url:"",primary_location:"Hudson Yards",address:"451 Tenth Ave., Manhattan, NY 10018",latitude:40.7557505,longitude:-73.9986545,telephone:"(347)2524012",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/greywind_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tao Uptown",slug:"tao-uptown",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Pan-Asian",summary:"This pan-Asian hotspot leaves no stone unturned with its menu, which covers Thai, Chinese and Japanese cuisines.",website:"https://taorestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3kRcm0VOA4l4YcDnQ6Goa6/0970f3733d2c797e77293f6acaae0096/TAO-Uptown-Manhattan-NYC-Photo-Tao-Group-Hospitality-2.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"1266",menu_url:"",primary_location:"Midtown East",address:"42 E. 58th St., Manhattan, NY 10022",latitude:40.7626119,longitude:-73.9714871,telephone:"(212)8882288",price_range:"$",facebook_url:"https://www.facebook.com/TAONYC",instagram_url:"https://instagram.com/TAONY",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Gratin",slug:"le-gratin",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"French",summary:"Le Gratin echoes the traditional bistros and bouchons of chef Daniel Boulud's hometown of Lyon, France, known for their welcoming ambiance and soulful cuisine.",website:"https://legratinnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/175KEc3EFAlF81inerr069/e5ea71d89ad3b36a0f6370141f77f214/Le-Gratin-Manhattan-NYC-Photo-Bill-Milne.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46408-LeGratin-menu.pdf",primary_location:"Lower Manhattan",address:"The Beekman, 5 Beekman St., 10038 Manhattan",latitude:40.7112134,longitude:-74.0069041,telephone:"(212)5979020",price_range:"$",facebook_url:"https://www.facebook.com/LeGratinNYC",instagram_url:"https://instagram.com/legratinnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Limani",slug:"limani",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Mediterranean",summary:"Limani, the Greek and Mediterranean restaurant in Rockefeller Center, uses only the highest-quality local and Mediterranean seafood.",website:"https://limani.com/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/6sBEHQhHZjGjSqC4GospUi/d74d0ce1540fc6586359e04bab20940d/_limani-photo-nyc-dsgn-04.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:[],opentable_id:"158017",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38505-Limani-menu.pdf",primary_location:"Midtown West",address:"45 Rockefeller Plaza, Manhattan, NY 10111",latitude:40.7583395,longitude:-73.9792303,telephone:"(212)8589200",price_range:"$",facebook_url:"https://www.facebook.com/limaninyc",instagram_url:"https://instagram.com/limani_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Maizal",slug:"maizal",borough:"Staten Island",neighborhood:"Rosebank",cuisine:"Mexican",summary:"Maizal Restaurant is a family-owned restaurant featuring authentic Mexican cuisine from Puebla.",website:"https://www.maizalrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/67xn9tVH41zVolVJcaRVvP/08f806705539f691d5e7dc4280624eeb/maizal-courtesy-maizal.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Rosebank",address:"990 Bay St., Staten Island, NY 10305",latitude:40.6183412,longitude:-74.0695411,telephone:"(347)8253776",price_range:"$",facebook_url:"https://www.facebook.com/maizalrestaurant",instagram_url:"https://instagram.com/maizal_restaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Beauty & Essex",slug:"beauty-essex",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"American (New)",summary:"Hidden behind a functioning pawn shop, Beauty & Essex is a true gem on the Lower East Side and widely regarded as one of New York's most beautiful restaurants.",website:"https://beautyandessex.com/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/0kQTFnSQRse3h0TL66vds/1cc65ee97341650d0c744a79b30e5a8c/Beauty-Essex-Manhattan-NYC-Photo-Tao-Hospitality-Group-2.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"52456",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36122-Beauty%26Essex-menu.pdf",primary_location:"Lower East Side",address:"146 Essex St., Manhattan, NY 10002",latitude:40.7204209,longitude:-73.9868826,telephone:"(212)6140146",price_range:"$",facebook_url:"https://www.facebook.com/BeautyandEssex",instagram_url:"https://instagram.com/beautyandessexnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"El Coco - Hell's Kitchen",slug:"el-coco-hells-kitchen",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Mexican",summary:"El Coco is a new taqueria in Hell's Kitchen with a twist, featuring authentic Mexican dishes, empanadas, traditional tacos, and a variety of signature sauces.",website:"https://www.elcocony.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4LJA9csFRxbLoLmHbi8cce/376f16d02a0ce79c96d2548d9cd15d0c/37ihiw0Y_004AC46B-C802-4F6F-BB697C98844597DD_aad2a153-d6f3-447f-bc20aef320099ecf.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1308466",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49073-ElCoco-Hell%27sKitchen-menu.pdf",primary_location:"Hells Kitchen",address:"828 Ninth Ave., Manhattan, NY 10019",latitude:40.7661387,longitude:-73.986721,telephone:"(646)8641412",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/elcocotaqueria",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ben & Jack's 44th Street",slug:"ben-jacks-steakhouse-44th-street",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:"Ben and Jack Sinanaj, long-time waiters at Peter Luger’s, have opened a classic steakhouse all their own.",website:"https://benandjackssteakhouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/8nWquZGwzWMrcj2IyFrRI/2e4ffb3b5ae8d83c78850f5a73fe841a/Ben-Jacks-Steakhouse-44th-Street-NYC-Photo-Courtesy-1.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"13717",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/34790-Ben%26Jack%27sSteakhouse44thStreet-menu.pdf",primary_location:"Midtown East",address:"219 E. 44th St., Manhattan, NY 10017",latitude:40.751837,longitude:-73.972356,telephone:"(212)6825678",price_range:"$",facebook_url:"https://www.facebook.com/BenandJacksSteakhouse",instagram_url:"https://instagram.com/benandjackssteakhousenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ootoya - Chelsea",slug:"ootoya-chelsea",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Japanese / Sushi",summary:"Ootoya's specialty is traditional Japanese home cooking in set-meal style, or teishoku.",website:"https://ootoya.us",image_url:"//images.ctfassets.net/1aemqu6a6t65/1mXv3jsmwRfeS7BiDyLOol/3aef7dbfeb3461f696f478dea7983565/Ootoya-Manhattan-NYC-Photo-Hachikin-Creative-5.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45461-Ootoya-Chelsea-menu.pdf",primary_location:"Flatiron District",address:"8 W. 18th St., Manhattan, NY 10011",latitude:40.7388278,longitude:-73.9927981,telephone:"(212)2550018",price_range:"$",facebook_url:"https://www.facebook.com/Ootoyanyc",instagram_url:"https://instagram.com/ootoyanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Relais De Venise",slug:"le-relais-de-venise",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"French",summary:"Renowned the world over for its steak frites, Le Relais de Venise L’Entrecôte’s signature dish is prepared using a famous Parisian secret sauce, as well as sinful French desserts.",website:"https://relaisdevenise.com/locations/new-york.php",image_url:"//images.ctfassets.net/1aemqu6a6t65/PYmscv3ZjsquEwTAs2OCD/f7a749ea34f26bb064b466bf3faabe54/Le-Relais-de-Venise-l-Entrecote-Manhattan-NYC-Photo-Brad-Stein.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49701-LeRelaisDeVenise-menu.pdf",primary_location:"Midtown East",address:"155 E. 54th St., Manhattan, NY 10022",latitude:40.7588609,longitude:-73.9696081,telephone:"(212)3024090",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100089514588208",instagram_url:"https://instagram.com/lerelaisdeveniseofficial",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Chemistry Room",slug:"the-chemistry-room",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Japanese / Sushi",summary:"The Chemistry Room is an innovative and modern take on traditional Japanese cuisine that combines tradition with unforgettable modern flair.",website:"https://www.thechemistryroom.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2VlW4WAyp6IzjfYpz9YSxS/e28bd2bc59c8bea99fc470a938e1c7ed/The-Chemistry-Room-Manhattan-NYC-Photo-Courtesy-The-Chemistry-Room-by-Sushi-Lab.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48498-ChemistryRoom-menu.pdf",primary_location:"Times Square/Theatre District",address:"Sanctuary Hotel New York, 132 W. 47th St., 10036 Manhattan",latitude:40.75837,longitude:-73.9832957,telephone:"(212)5146000",price_range:"$",facebook_url:"https://www.facebook.com/thechemistryroom",instagram_url:"https://instagram.com/thechemistryroom",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jade Eatery & Lounge",slug:"jade-eatery-and-lounge",borough:"Queens",neighborhood:"Forest Hills",cuisine:"Asian Fusion",summary:"Jade Eatery & Lounge serves favorite Pan-Asian and southeast Asian dishes, as well as creative culinary innovations that have become neighborhood favorites.",website:"https://www.jadeeatery.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4K6Z19HST5J18sq2PDVxkG/8f6da64c9499a48f165c8a382dd46154/Jade-Eatery-Forest-Hills-NYC-Photo-Daisy-Vera.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1071193",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48485-JadeEatery%26Lounge-menu.pdf",primary_location:"Forest Hills",address:"1 Station Sq., Queens, NY 11375",latitude:40.7189633,longitude:-73.845194,telephone:"(718)7932203",price_range:"$",facebook_url:"https://www.facebook.com/JadeEateryAndLounge",instagram_url:"https://instagram.com/jadeeatery",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Contenta Oeste",slug:"la-contenta-oeste",borough:"Manhattan",neighborhood:"West Village",cuisine:"Mexican",summary:"La Contenta Oeste offers a traditional Mexican menu with French accents and also features one of NYC's largest tequila, mezcal and alt agave selections.",website:"https://lacontentanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4ttRTwqcRHByqcIowYGnQ7/95cfba2a18e2180706f2bf324648e8f1/La-Contenta-Oeste-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"1014631",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44485-LaContentaOeste-menu.pdf",primary_location:"West Village",address:"78 W. 11th St., Manhattan, NY 10011",latitude:40.7351431,longitude:-73.9980504,telephone:"(212)5332233",price_range:"$",facebook_url:"https://www.facebook.com/lacontentaoeste",instagram_url:"https://instagram.com/lacontentaoeste",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chela",slug:"chela",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Mexican",summary:"This Park Slope spot whips up inventive, beautifully plated cuisine leaning heavily on traditional South American flavors.",website:"https://www.chelaparkslope.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5Znhc6lDmlAKD39auR9smv/38d7b26e82ba3d5354b7e77494ec3d3e/rw-to-go_chela.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"",menu_url:"",primary_location:"Park Slope",address:"408 5th Ave., Brooklyn, NY 11215",latitude:40.6703129,longitude:-73.9856331,telephone:"(718)7011891",price_range:"$",facebook_url:"https://www.facebook.com/chelaparkslope",instagram_url:"https://instagram.com/chelaparkslope",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mishik",slug:"mishik",borough:"Manhattan",neighborhood:"Hudson Square",cuisine:"Japanese / Sushi",summary:"Executive chef/partner Markee Manaloto brings his experience working with Edomae sushi to his new venture, a modern Japanese restaurant in Hudson Square.",website:"https://mishiknyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6TBBRsWdWCA1Ytwx5aMTxh/1fa2a894c937d3b124ca5bda71343469/Mishik-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49207-Mishik-menu.pdf",primary_location:"Hudson Square",address:"259A Hudson St., Manhattan, NY 10013",latitude:40.7249077,longitude:-74.0079398,telephone:"(347)9297878",price_range:"$",facebook_url:"https://www.facebook.com/mishiknyc",instagram_url:"https://instagram.com/mishiknyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rowland's Bar & Grill",slug:"rowlands-bar-grill",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"Gastropub",summary:"Rowland's Bar & Grill serves American gastropub cuisine in a comfortable, modern atmosphere on the lower level at Macy's Herald Square.",website:"https://www.patinagroup.com/rowlands",image_url:"//images.ctfassets.net/1aemqu6a6t65/1njRZrK15oi1L26qOuWKki/82bfc2dde848b679a6f5c8b14750ddc4/rowlands-chicken-wings.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"192205",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39405-Rowland%27sBar%26Grill-menu.pdf",primary_location:"Herald Square",address:"Macy's Herald Square, 151 W. 34th St., Manhattan lower level",latitude:40.7508025,longitude:-73.9894835,telephone:"(212)8683001",price_range:"$",facebook_url:"https://www.facebook.com/RowlandsNYC",instagram_url:"https://instagram.com/RowlandsNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Dynamo Room",slug:"the-dynamo-room",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Steakhouse",summary:"Featuring steakhouse classics, a raw bar, and curated cocktails, The Dynamo Room channels the vibrant spirit of New York’s historic grills. ",website:"https://www.thedynamoroom.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/NjvN8RiUYGqqMSYtyMLcn/2d9b6f3a01532f57e7080c5c0005f04e/The-Dynamo-Room-Manhattan-NYC-Photo-Eric-Medsker-_-Gentl_Hyers-3.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1433542",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49923-DynamoRoom-menu.pdf",primary_location:"Chelsea",address:"2 Pennsylvania Plaza, Manhattan, NY 10121",latitude:40.7494331,longitude:-73.9914027,telephone:"(203)2979477",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/thedynamoroom",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"So & So's",slug:"so-and-sos",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"American (New)",summary:"This sumptuously-appointed, dimly-lit piano-bar-meets-supper-club evokes the feeling of stumbling into a local legend’s living room during a night out in NYC—but is also an ode to Broadway.",website:"https://www.soandsosbar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3Xx9X1zmc3th7waC7hC5Z/3d1e10911fecd94b25c4e50fdf5b6d04/So-_-So-s-Manhattan-NYC-Photo-Emma-Fishman-2.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49254-So%26So%27s-menu.pdf",primary_location:"Hells Kitchen",address:"Romer Hell's Kitchen, 302 W. 52nd St., 10019 Manhattan",latitude:40.7635668,longitude:-73.9854912,telephone:"(646)7105850",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/soandsosny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Flava of the Bronx",slug:"flava-of-the-bronx",borough:"The Bronx",neighborhood:"Woodstock",cuisine:"Caribbean",summary:"Diners feel the tropical breeze and experience yard-man and yard-woman flava style cooking.",website:"https://flavaofthebronx.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/IkCNaYnn3gvH9t7km0mYO/999fe9a375e7ef05059cb100e1a32156/Flava-of-the-Bronx-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46594-FlavaoftheBronx-menu.pdf",primary_location:"Woodstock",address:"3114 Third Ave., Bronx, NY 10451",latitude:40.8219488,longitude:-73.9114978,telephone:"(347)3528219",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61555895158852",instagram_url:"https://instagram.com/flavabx",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sarabeth's Central Park South",slug:"sarabeths-central-park-south",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"American (New)",summary:"At Sarabeth's Central Park South, you'll find contemporary American food, a warm atmosphere and the friendly service Sarabeth's restaurants are known for.",website:"https://sarabethsrestaurants.com/locations/central-park-south",image_url:"//images.ctfassets.net/1aemqu6a6t65/4ekuJw3AizNyfGM812rSE9/c1ede01be891e0f676255bf467b90240/sarabeths-central-park-south_sarabeths_decor.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"34816",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/22758-Sarabeth%27sCentralParkSouth-menu.pdf",primary_location:"Midtown West",address:"40 Central Park South, Manhattan, NY 10019",latitude:40.7651362,longitude:-73.9757026,telephone:"(212)8265959",price_range:"$",facebook_url:"https://www.facebook.com/sarabethsCPS",instagram_url:"https://instagram.com/sarabethsnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice 64",slug:"felice-64",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"Italian wines and flavors from Tuscany are served in a modern space infused with traditional elements on the Upper East Side.",website:"https://www.felicerestaurants.com/felice-64",image_url:"//images.ctfassets.net/1aemqu6a6t65/6feE9zrrz7pZkbzO5XHu14/b2b19313465d8158efacbcd70dadc343/felice15_salmon-tartare.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"1166 First Ave., Manhattan, NY 10065",latitude:40.7625672,longitude:-73.9595639,telephone:"(212)5932223",price_range:"$",facebook_url:"https://www.facebook.com/Felice.NewYorkCity/",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pera SoHo",slug:"pera-soho",borough:"Manhattan",neighborhood:"Soho",cuisine:"Mediterranean",summary:"Pera SoHo is an eastern Mediterranean retreat inspired by its namesake Istanbul neighborhood.",website:"https://www.pera-soho.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6UCofIbPE7ZX5MHJUoyEJ0/dd69baf6dbe4625524f25decff40f98c/rw-to-go_pera-soho_e0865dfc-5056-a36f-23dad3d858a39972-e0865cca5056a36_e0865e52-5056-a36f-23e5b94f84c3a8bc__1___1_.jpeg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"76933",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38407-PeraSoHo-menu.pdf",primary_location:"Soho",address:"54 Thompson St., Manhattan, NY 10012",latitude:40.7237889,longitude:-74.0032322,telephone:"(212)8786305",price_range:"$",facebook_url:"https://www.facebook.com/perasohonyc",instagram_url:"https://instagram.com/perasoho",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Archer & Goat",slug:"archer-goat",borough:"Manhattan",neighborhood:"Harlem",cuisine:"American (New)",summary:"An intimate global restaurant in Harlem serves impressive cocktails.",website:"https://www.archerandgoat.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3KaEtzzHWPHFkhxwVtfBw5/5213a642e757b3d83bb32fd752dfc4ad/archer-and-goat-harlem-manhattan-nyc-corutesy-archer-and-goat-unknown-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Harlem",address:"187 Lenox Ave., Manhattan, NY 10026",latitude:40.80433,longitude:-73.9483418,telephone:"(917)2616602",price_range:"$",facebook_url:"https://www.facebook.com/archerandgoat",instagram_url:"https://instagram.com/archerandgoat_harlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Barra",slug:"la-barra",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"Spanish",summary:"At La Barra, you can explore beloved dishes from numerous tapas bars all around Spain.",website:"https://www.littlespain.com/restaurant/la-barra",image_url:"//images.ctfassets.net/1aemqu6a6t65/2nCpoM7szjqU4IoIhnX1aS/6350cda99bb9a0068ac4d3ebaa89ebbe/Little-Spain-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1101643",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45654-LaBarraatMercadoLittleSpain-menu.pdf",primary_location:"Hudson Yards",address:"10 Hudson Yards, Manhattan, NY 10001",latitude:40.752594,longitude:-74.0013517,telephone:"(646)4951242",price_range:"$",facebook_url:"https://www.facebook.com/littlespain",instagram_url:"https://instagram.com/LittleSpain",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Manhatta",slug:"manhatta",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"American (New)",summary:"Feast on stunning views of the City and a compelling New American menu.",website:"https://www.manhattarestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/lDtOus8qJyG1Ue0pfFWvz/c6ebcedee060b7349fbd59521e143305/manhatta-financial-district-manhattabn-nyc-emily-andrews-manhatta-4_ae5447c2-efdb-4d44-95bd2c5e9a05df65_3695125a-99c6-49b4-8.jpg",meal_types:["$60 Lunch Price","$60 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"",menu_url:"",primary_location:"Lower Manhattan",address:"28 Liberty St., 60th fl., 10005 Manhattan",latitude:40.708227,longitude:-74.0090809,telephone:"(212)2305788",price_range:"$",facebook_url:"https://www.facebook.com/ManhattaRestaurant",instagram_url:"https://instagram.com/manhatta_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Brass & the Tusk Bar",slug:"the-tusk-bar",borough:"Manhattan",neighborhood:"Nomad",cuisine:"American (New)",summary:"Through the Art Deco lobby of the historic Evelyn Hotel, find The Tusk Bar for bright takes on classic cocktails, raw bar and seafood-driven small plates, and Brass, an NYC take on the French brasserie.",website:"https://www.brassny.com/home#tusk",image_url:"//images.ctfassets.net/1aemqu6a6t65/64tMWy7bAgjxTckFTyXa3c/a17429292ef85eb17092c12e50f4cf84/Tusk-Bar-Manhattan-NYC-Courtesy-3.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1331476",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49388-Brass%26theTuskBar-menu.pdf",primary_location:"Nomad",address:"Evelyn Hotel, 7 E. 27th St., 10016 Manhattan",latitude:40.7439469,longitude:-73.9869744,telephone:"(212)9719746",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/brass_tuskbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Temple Court",slug:"temple-court-by-tom-colicchio",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"American (New)",summary:"Tom Colicchio serves a menu of quintessential New York City dishes in Lower Manhattan.",website:"https://www.templecourtnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/IPw0o7FHLwQY4f5QQ806g/59dc62ade080fae0c068dd1412096d32/Temple-Court-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"264043",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40069-TempleCourtbyTomColicchio-menu.pdf",primary_location:"Lower Manhattan",address:"5 Beekman St., Manhattan, NY 10038",latitude:40.7114295,longitude:-74.0068285,telephone:"(212)6581848",price_range:"$",facebook_url:"https://www.facebook.com/TempleCourtNYC",instagram_url:"https://instagram.com/templecourtnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bar Primi - Bowery",slug:"bar-primi",borough:"Manhattan",neighborhood:"East Village",cuisine:"Italian",summary:"A cozy Bowery space with two bars for dining and drinking, Bar Primi is a casual corner pasta shop devoted to primi piatti (the pasta course), a staple in chef and co-owner Andrew Carmellini's repertoire.",website:"https://www.barprimi.com/location/bar-primi-bowery",image_url:"//images.ctfassets.net/1aemqu6a6t65/jTlHT98gUThtqpViWGAwO/3af5f0d08efaa1139c9950da57cd8f76/barprimi_eastvillage_manhattan_nyc_pancakes-and-frose_noahfecks.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"144598",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38169-BarPrimi-Bowery-menu.pdf",primary_location:"East Village",address:"325 Bowery, Manhattan, NY 10003",latitude:40.7257162,longitude:-73.9916803,telephone:"(212)2209100",price_range:"$",facebook_url:"https://www.facebook.com/barprimi",instagram_url:"https://instagram.com/barprimi",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Zero Otto Nove - Flatiron",slug:"zero-otto-nove",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Italian",summary:"Roberto Paciullo's Flatiron District restaurant combines the menu of Paciullo's other Bronx outpost, Roberto's Restaurant, with that of the original Zero Otto Nove.",website:"https://zeroottonove.com/nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/54rWTg9aj0E0TgpiTNgGH3/75ba02e73f6c40e8813ff1c061e84529/zero-otto-nove-flatiron-manhattan-nyc-will-steacy-34.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"89980",menu_url:"",primary_location:"Flatiron District",address:"15 W. 21st St., Manhattan, NY 10010",latitude:40.7408377,longitude:-73.9915684,telephone:"(212)2420899",price_range:"$",facebook_url:"https://www.facebook.com/ZeroOttoNoveNYC",instagram_url:"https://instagram.com/zeroottonove",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Lattanzi Cucina Italiana",slug:"lattanzi-cucina-italiana",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:'Set in a romantic and welcoming Restaurant Row townhouse, Lattanzi is celebrated for its "Roman Jewish-style specialties.',website:"https://lattanzinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/bNeVlBUR5Mg0bXI2wP4qB/1a6b30807439973c94df1b540d0521aa/compressed-main-room_CFA89AEC-5547-4279-AFFD4AE3B55B11B6_a385b3fd-d86f-4887-b6236cfb7601f419.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"5920",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/11292-LattanziCucinaItaliana-menu.pdf",primary_location:"Times Square/Theatre District",address:"361 W. 46th St., Manhattan, NY 10036",latitude:40.7608494,longitude:-73.990016,telephone:"(212)3150980",price_range:"$",facebook_url:"https://www.facebook.com/LattanziRestaurant",instagram_url:"https://instagram.com/lattanzirestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Society Cafe",slug:"society-cafe",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"American (New)",summary:"Hidden inside Walker Hotel is Society Cafe, a market-to-table American restaurant by chef Nicholas McCann.",website:"https://www.societycafenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/TaMXGbezRhoUQ3ne6XZB0/75b0470a1666178e6eec7af2cb745c63/society-cafe-greenwich-village-manhattan-nyc-courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:[],opentable_id:"101131",menu_url:"",primary_location:"Greenwich Village",address:"Walker Hotel Greenwich Village, 52 W. 13th St., 10011 Manhattan",latitude:40.73618,longitude:-73.9966,telephone:"(212)3751300",price_range:"$",facebook_url:"https://www.facebook.com/societycafenyc",instagram_url:"https://instagram.com/societycafenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Molyvos",slug:"molyvos-restaurant",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Greek",summary:"A meal at this high-end Midtown eatery is sure to put you in a sunny mood.",website:"https://www.molyvos.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5bsPvIXRndlvzkQM1TvgC0/d83ee7c58c182b1b2bafadc9bddade6b/molyvos-midtown-manhattan-nyc-courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"174",menu_url:"",primary_location:"Hells Kitchen",address:"402 W. 43rd St., Manhattan, NY 10036",latitude:40.7592097,longitude:-73.9927457,telephone:"(212)5827500",price_range:"$",facebook_url:"https://www.facebook.com/MolyvosRestaurant",instagram_url:"https://instagram.com/MolyvosNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Little Maven",slug:"little-maven",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"American (New)",summary:"With an exciting and approachable menu featuring classics with a twist, Little Maven is a vibrant, fun and delicious choice.",website:"https://www.littlemavenrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2HhBLykt7r3ngPgQMeyMpU/44a6f01d6cc9b8068db8be7242483fdf/Little-Maven-Manhattan-NYC-Photo-Noah-Fecks.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49050-LittleMaven-menu.pdf",primary_location:"Flatiron District",address:"30 W. 18th St., Manhattan, NY 10011",latitude:40.7390428,longitude:-73.9934938,telephone:"(212)3208111",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/littlemavenrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Calle Dão - Bryant Park",slug:"calle-dao-bryant-park",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Asian Fusion",summary:"Calle Dão pays homage to Havana’s once-thriving El Barrio Chino (Chinatown), once the largest such community in Latin America.",website:"https://www.calledao.com/location/calle-dao-bryant-park",image_url:"//images.ctfassets.net/1aemqu6a6t65/3iPIHtti8SmL2EeQ2ltFC/264e383af27beefa6e71e797bd3be374/CR5_8501_9B1C1FAE-52C1-45A2-94772B394F137485_aa91653d-ac02-4a3e-9874f6857139145a.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"149428",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47915-CalleDao-BryantPark-menu.pdf",primary_location:"Midtown West",address:"38 W. 39th St., Manhattan, NY 10018",latitude:40.7521634,longitude:-73.9842196,telephone:"(646)4765696",price_range:"$",facebook_url:"https://www.facebook.com/CalleDaoNYC",instagram_url:"https://instagram.com/calledaonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Emmy Squared Pizza - Upper East Side",slug:"emmy-squared-pizza-upper-east-side",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Pizza",summary:"Founded on an unconditional love of well-made food, Emmy Squared combines a New York style “grandma” pie with a Detroit style pizza, and then tops it off with an added dose of culinary creativity.",website:"https://www.emmysquaredpizza.com/location/upper-east-side",image_url:"//images.ctfassets.net/1aemqu6a6t65/5YOrM27Do3KPceZkm61Wz1/59d9e6677e1e27a129efc0999654a7d9/Emmy-Squared-Pizza-UES-Manhattan-NYC-Courtesy-3.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"1266625",menu_url:"",primary_location:"Upper East Side",address:"1426 Third Ave., Manhattan, NY 10028",latitude:40.775589,longitude:-73.956614,telephone:"(917)5999594",price_range:"$",facebook_url:"https://www.facebook.com/EmmySquaredPizza",instagram_url:"https://instagram.com/emmysquaredpizza",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Stand",slug:"the-stand",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Italian",summary:`The Stand was recently voted New York's "Best Comedy Club" by New York magazine and regularly hosts top comedians like Judah Friedlander, Todd Barry, Janeane Garofalo and more.`,website:"https://www.thestandnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4wG7mlMhufHpDPNGElABrI/181464069195af3332615a9a04aceab3/KH-201_68EDDC25-3CD0-4559-BCA034212D0ED899_819ea0b5-10fa-4e94-84bf04e63748bb21.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"86878",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37550-Stand-menu.pdf",primary_location:"Union Square",address:"116 E. 16th St., Manhattan, NY 10003",latitude:40.7353826,longitude:-73.9884719,telephone:"(212)6772600",price_range:"$",facebook_url:"https://www.facebook.com/thestandnyc",instagram_url:"https://instagram.com/thestandnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jacob's Pickles",slug:"jacobs-pickles-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Soul Food / Southern",summary:"Pickles are more than just a garnish at this Southern-inspired eatery; they're a way of life.",website:"https://www.jacobspickles.com/location/jacobs-pickles-upper-west-side",image_url:"//images.ctfassets.net/1aemqu6a6t65/57nlN2UUgdsjelbQUJV6IY/d94a2507912b4c31f278bb18a166b13f/rw-to-go_jacobs_pickles.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41845-Jacob%27sPickles-menu.pdf",primary_location:"Upper West Side",address:"509 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7866017,longitude:-73.9754271,telephone:"(212)4705566",price_range:"$",facebook_url:"https://www.facebook.com/jacobspickles",instagram_url:"https://instagram.com/jacobspickles",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Library at The Public",slug:"library-at-the-public",borough:"Manhattan",neighborhood:"Noho",cuisine:"American (New)",summary:"The Library, named for the building's original use as the Astor Library, is a central element of the mezzanine level of this landmark edifice at Astor Place (which famously houses downtown performance venue The Public Theater).",website:"https://www.thelibraryatthepublic.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/14od9LmlT3oqSM8Rh5oq3r/505f45c6ab0952ab134c5a3761d396e5/library-at-the-public-noho-manhattan-photo-noah-fecks.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"92092",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37816-LibraryatThePublic-menu.pdf",primary_location:"Noho",address:"The Public Theater, 425 Lafayette St., Manhattan mezzanine level",latitude:40.7289834,longitude:-73.9917347,telephone:"(212)5398777",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/thelibraryatthepublic",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Manuela",slug:"manuela",borough:"Manhattan",neighborhood:"Soho",cuisine:"American (New)",summary:"Manuela is a welcoming neighborhood restaurant and bar in SoHo where great contemporary art and food combine to create a convivial atmosphere and sense of abundance. ",website:"https://manuela-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3gJkoiZifXxwrMDXW90r99/73fb0883fb7750925db2b00dd465bfab/Manuela-NY-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49773-Manuela-menu.pdf",primary_location:"Soho",address:"130 Prince St., Manhattan, NY 10012",latitude:40.7253651,longitude:-74.0005917,telephone:"(917)2452770",price_range:"$",facebook_url:"https://www.facebook.com/manuelanewyorkcity",instagram_url:"https://instagram.com/manuelanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Acadia",slug:"acadia",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Mediterranean",summary:"Executive chef Ari Bokovza's menu is inspired by Levantine traditions, brought to life through innovative preparation.",website:"https://www.acadianyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5JLLbrI5cBhthA37gvN4mN/99b640af94995878c3dbb4130e7858ca/YtscEc_A_EBED8664-F2A9-48A6-81B9DC081D3D642C_7cde6265-a505-4b07-9f66cfc1e963f9c2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1322983",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48687-Acadia-menu.pdf",primary_location:"Midtown West",address:"101 W. 57th St., Manhattan, NY 10019",latitude:40.7646408,longitude:-73.9772407,telephone:"(212)3777170",price_range:"$",facebook_url:"https://www.facebook.com/Acadianyc",instagram_url:"https://instagram.com/acadianyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Opto",slug:"opto",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Mediterranean",summary:"Opto is not your yia-yia's Mediterranean spot, and serves up detail-oriented dishes with no need for puffery.",website:"https://optonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5uyNG8hLqkODAAegY9TCsj/6650979d2944a83dfdb1757e33cd10c1/Opto-Manhattan-NYC-Photo-Noah-Frecks-5.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49761-Opto-menu.pdf",primary_location:"Flatiron District",address:"35 W. 20th St., Manhattan, NY 10011",latitude:40.7407162,longitude:-73.9928978,telephone:"(212)4637890",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/opto.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Panda Harlem",slug:"panda-harlem",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Chinese",summary:"Panda Harlem is a unique dining experience inspired by fine cuisine, high-energy hospitality and hip-hop culture.",website:"https://www.pandaharlem.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5hJ4kmvwohnEVezAVfliCs/7e9c02be81b33f2162c084bc2d747beb/Panda-Harlem-Manhattan-NYC-Courtesy-Dream-Hospitality-Group-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1224304",menu_url:"",primary_location:"Harlem",address:"2331 Twelfth Ave., Manhattan, NY 10027",latitude:40.8200015,longitude:-73.958588,telephone:"(347)9054192",price_range:"$",facebook_url:"https://www.facebook.com/PandaHarlemNYC",instagram_url:"https://instagram.com/panda.harlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Marlow Bistro",slug:"marlow-bistro",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Mediterranean",summary:"Marlow Bistro combines its Mediterranean roots with a European sensibility, and strives to create a warm and welcoming space.",website:"https://www.marlowbistro.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1BptFFW739TTU1wf896Blk/46e1ed28348653803a6ca979eec2ff85/charissa-fay-marlow-bistro-10__1_.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41671-MarlowBistro-menu.pdf",primary_location:"Upper West Side",address:"1018 Amsterdam Ave., Manhattan, NY 10025",latitude:40.802973,longitude:-73.9642863,telephone:"(212)6629020",price_range:"$",facebook_url:"https://m.facebook.com/p/Marlow-Bistro-100063589777903",instagram_url:"https://instagram.com/marlowbistro",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pulperia",slug:"la-pulperia",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Latin American",summary:"La Pulperia, modeled after the general stores found throughout South America, features rustic Latin cuisine with European influences.",website:"https://lapulperianyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6jkEazpYQAhJspb9e3miBl/84f595fc959f4fe93d9026ec98f4fc8a/la_pulperia.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1185889",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37671-LaPulperia-menu.pdf",primary_location:"Times Square/Theatre District",address:"338 W. 46th St., Manhattan, NY 10036",latitude:40.7601272,longitude:-73.989554,telephone:"(646)6698984",price_range:"$",facebook_url:"https://www.facebook.com/PulperiaNYC",instagram_url:"https://instagram.com/lapulperianyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Veselka",slug:"veselka-restaurant",borough:"Manhattan",neighborhood:"East Village",cuisine:"Ukrainian",summary:"Find 24-hour comfort food and Ukrainian specialties at this East Village standby.",website:"https://veselka.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/11JNo3SduDcCKgrPGaOkdV/f765503a25d9c10bcd6d649056388127/compressed-rw-to-go_veselka_1c097c03-5056-a36f-235e166222ce1fde-1c09793e5056a36_1c097c52-5056-a36f-231860c61f2e1dbc__1_.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"",menu_url:"",primary_location:"East Village",address:"144 Second Ave., Manhattan, NY 10003",latitude:40.7289226,longitude:-73.9869285,telephone:"(212)2289682",price_range:"$",facebook_url:"https://www.facebook.com/veselkaNYC",instagram_url:"https://instagram.com/veselkanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Giorgio's of Gramercy",slug:"giorgios-of-gramercy",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"American (New)",summary:"A classy, well-rated Italian eatery decorated in beige and burgundy in the neighborhood of Gramercy, Giorgio's offerings include salad, pasta, sandwiches and entrees such as filet mignon.",website:"https://giorgiosofgramercy.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2ct6q4OsVmltkEz8ERBJT3/822f3f292e7f3955543c4056e7be15c9/oyster.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"11560",menu_url:"",primary_location:"Gramercy",address:"27 E. 21st St., Manhattan, NY 10010",latitude:40.7397115,longitude:-73.9886319,telephone:"(212)4770007",price_range:"$",facebook_url:"https://www.facebook.com/GiorgiosofGramercy",instagram_url:"https://instagram.com/giorgiosofgramercy",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosemary's East",slug:"rosemarys-east",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Italian",summary:"This walk-in restaurant in Peter Cooper Village brings Rosemary's warm design, accessible menu of seasonal Italian dishes and neighborly hospitality to Manhattan's east side.",website:"https://www.rosemarysnyc.com/location/rosemarys-east",image_url:"//images.ctfassets.net/1aemqu6a6t65/2eSOz7MfhAD0JkXHfGqGJT/8725877a8d1a7f7f94e39801814d2623/rosemarys-east-manhattan-photo-courtesy-03.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1186936",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45430-Rosemary%27sEast-menu.pdf",primary_location:"Gramercy",address:"350 First Ave., Manhattan, NY 10010",latitude:40.7350189,longitude:-73.9793814,telephone:"(646)8685335",price_range:"$",facebook_url:"https://www.facebook.com/rosemaryseast",instagram_url:"https://instagram.com/rosemarysnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sagaponack",slug:"sagaponack",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Seafood",summary:"Sagaponack is a seafood restaurant specializing in chef-driven approachable quality.",website:"https://www.saganewyork.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6mhnn58sOjCehffjuF08jf/82c45a555440e8127fd405fdfc1116ba/sagaponack-manhattan-courtesy-sagaponack.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["summer-vibes"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47782-Sagaponack-menu.pdf",primary_location:"Flatiron District",address:"4 W. 22nd St., Manhattan, NY 10010",latitude:40.7409362,longitude:-73.9907851,telephone:"(212)2292226",price_range:"$",facebook_url:"https://www.facebook.com/saganewyork",instagram_url:"https://instagram.com/sagavibes",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Il Falco",slug:"il-falco",borough:"Queens",neighborhood:"Long Island City",cuisine:"Italian",summary:"Chef-owner Bolivar Perez has decades of experience cooking Italian fine cuisine.",website:"https://www.ilfalcolic.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3YKprtDUoGO4wBuYwEYHs0/afe77dea7ad7a24f34778607274632dd/il_falco_20220719-photo-courtesy.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"191239",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45823-IlFalco-menu.pdf",primary_location:"Long Island City",address:"21-50 44th Dr., Queens, NY 11101",latitude:40.7475747,longitude:-73.9455582,telephone:"(718)7070009",price_range:"$",facebook_url:"https://www.facebook.com/Ilfalcolic",instagram_url:"https://instagram.com/ilfalcolic",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Treadwell Park - Upper East Side",slug:"treadwell-park-upper-east-side",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (Traditional)",summary:'Treadwell Park’s craft beer hall offers 20 rotating draft beers and ciders, delivered by on-site "flux capacitor."',website:"https://www.treadwellpark.com/location/upper-east-side",image_url:"//images.ctfassets.net/1aemqu6a6t65/QYXHSppnOMjnQGURsudhb/09579e3a3220e24042c6e410b50b4289/Treadwell-Park-Uptwon-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1267594",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41698-TreadwellPark-UpperEastSide-menu.pdf",primary_location:"Upper East Side",address:"1125 First Ave., Manhattan, NY 10065",latitude:40.7614741,longitude:-73.9611074,telephone:"(212)8321551",price_range:"$",facebook_url:"https://www.facebook.com/treadwellpark",instagram_url:"https://instagram.com/treadwellpark",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sushi Lab Rooftop",slug:"sushi-lab-rooftop-nyc",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Japanese / Sushi",summary:"Sushi Lab Rooftop is a New York City–born innovative concept with unique creations based on traditional sushi.",website:"https://www.sushilab.com/sushi-lab",image_url:"//images.ctfassets.net/1aemqu6a6t65/1JdDNraPN5v4AQKCD2ShWF/a388a791fdec8328bcf54ee5b4190c0a/All_In_NYC_Sushi-Lab-Rooftop-NYC_3000x20000-eb4e819c5056a36_eb4e831f-5056-a36f-232db9635568abcc.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/42593-SushiLabRooftopNYC-menu.pdf",primary_location:"Times Square/Theatre District",address:"Sanctuary Hotel New York, 130 W. 47th St., 10036 Manhattan",latitude:40.75837,longitude:-73.9832957,telephone:"(212)4320000",price_range:"$",facebook_url:"https://www.facebook.com/sushilab.nyc",instagram_url:"https://instagram.com/sushilab.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Little Thai Kitchen",slug:"little-thai-kitchen",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Thai",summary:"You can find popular dishes such as drunken noodle, pad see-ew, and pad thai that are all made with fresh, savory ingredients.",website:"https://www.littlethaikitchenmidtown.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/pN6lJg2NLAU60dFlu7bp4/56979609249a56c7ba21aaf079c4a6a3/Little-Thai-Kitchen-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown East",address:"243 E. 53rd St., Manhattan, NY 10022",latitude:40.7571349,longitude:-73.9677464,telephone:"(212)6445353",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100063639723784",instagram_url:"https://instagram.com/ltkmidtown",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Estiatorio Milos Hudson Yards",slug:"estiatorio-milos-hudson-yards",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"Seafood",summary:"Pristine Mediterranean-style seafood shines in an industrial-chic setting at Milos, featuring a view of the Vessel and Hudson River.",website:"https://www.estiatoriomilos.com/location/nyhudsonyards",image_url:"//images.ctfassets.net/1aemqu6a6t65/7lNFlcgVoea0Cf3Jn4qmJg/6977ab05fcdc3d52f020d749426f7be9/estiatorio_milos_hudson_yards_copy__1_.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1044916",menu_url:"",primary_location:"Hudson Yards",address:"20 Hudson Yards, 5th fl., 10001 Manhattan",latitude:40.7165282,longitude:-74.0090444,telephone:"(646)9071970",price_range:"$",facebook_url:"https://www.facebook.com/estiatoriomilosofficial",instagram_url:"https://instagram.com/estiatoriomilos",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kaizen",slug:"kaizen",borough:"Queens",neighborhood:"Flushing",cuisine:"Japanese / Sushi",summary:"An authentic and contemporary Temaki Omakase concept in Flushing, Queens, that highlights delicate hand rolls and artful craft cocktail pairings.",website:"https://www.nyckaizen.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1Bcej3Hr4izX3adQc2kU0o/247ea7ee58b849d308480dedf68e35d4/compressed-Untitled-design-31.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1390924",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47954-Kaizen-menu.pdf",primary_location:"Flushing",address:"Four Points by Sheraton Flushing, 33-70 Farrington St., 11354 Queens",latitude:40.7651286,longitude:-73.8321303,telephone:"(718)9712413",price_range:"$",facebook_url:"https://www.facebook.com/nyckaizen",instagram_url:"https://instagram.com/kaizen_ny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jing Li",slug:"jing-li",borough:"Queens",neighborhood:"Long Island City",cuisine:"Chinese",summary:"Jing Li is a fine-dining destination in Long Island City, Queens, that serves a mix of Szechuan, Shanghai and Cantonese cuisines.",website:"https://jinglinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5j8K3ip36m8dnRP48R9AcP/b546850b017c6ae8bd16eaebb85447cf/Jing-Li-LIC-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49413-JingLi-menu.pdf",primary_location:"Long Island City",address:"27-35 Jackson Ave., Queens, NY 11101",latitude:40.7481812,longitude:-73.9403027,telephone:"(718)2556661",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/jinglinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Marsanne",slug:"marsanne",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Mediterranean",summary:"The team at Marsanne are passionate about sharing the rich and diverse flavors of Mediterranean cuisine with the community.",website:"https://marsannenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4n89ldYhURsAeDynWRYTJE/40e87b748d6df19adb793332bc77038b/Marsanne-NYC-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1359478",menu_url:"",primary_location:"Chelsea",address:"233 Eighth Ave., Manhattan, NY 10011",latitude:40.7446196,longitude:-73.9992322,telephone:"(646)7264614",price_range:"$",facebook_url:"https://www.facebook.com/marsannenyc",instagram_url:"https://instagram.com/marsanne_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jacques Brasserie",slug:"jacques-brasserie",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"French",summary:"Jacques Brasserie is a romantic bistro that feels like one of those off-the-tourist track places that you always hope to find in Paris. ",website:"https://www.jacquesbrasserie.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/39llZC7Cjr0uscAxvI8ORD/cc7b2222197ecbc8fd5944fe2426e5d6/Jacques-Brasserie-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/19032-JacquesBrasserie-menu.pdf",primary_location:"Upper East Side",address:"204-206 E. 85th St., Manhattan, NY 10028",latitude:40.7778615,longitude:-73.9542576,telephone:"(212)3272272",price_range:"$",facebook_url:"https://www.facebook.com/jacquesbrasserieny",instagram_url:"https://instagram.com/jacques_brasserie",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Arte Cafe",slug:"arte-cafe",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"This family-owned restaurant presents an upscale Italian cuisine with artisanal homemade pizzas and gourmet desserts.",website:"https://www.artecafenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2S8SIKE5vPSshij0LVZi3P/f1abb9ecaa5551e80c594d440740e743/Arte-Cafe-UWS-Manhattan-NYC-Photo-NYCRG-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"3601",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39114-ArteCafe-menu.pdf",primary_location:"Upper West Side",address:"106 W. 73rd St., Manhattan, NY 10023",latitude:40.7781026,longitude:-73.9788477,telephone:"(212)5017014",price_range:"$",facebook_url:"https://www.facebook.com/artecafenyc",instagram_url:"https://instagram.com/artecafenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mesiba",slug:"mesiba",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Mediterranean",summary:"Tel Aviv-inspired restaurant takes inspiration from Bar Lab Hospitality’s founding partner Elad Zvi’s childhood memories of the diverse flavors of Israel.",website:"https://www.mesibabk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4NtkRhYiVr75G3tfX6dPlN/470554146eb667355bb5321f443c9f64/Mesiba-Brooklyn-NYC-Courtesy-3.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1324447",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48699-Mesiba-menu.pdf",primary_location:"Williamsburg",address:"353 Bedford Ave., Brooklyn, NY 11211",latitude:40.7117016,longitude:-73.9628766,telephone:"(929)4890150",price_range:"$",facebook_url:"https://www.facebook.com/mesibabk",instagram_url:"https://instagram.com/mesibabk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"JoJo",slug:"jojo",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (New)",summary:"A lavishly gorgeous and perfectly refined town house is home to one of Jean-Georges Vongerichten's greatest dining accomplishments.",website:"https://www.jojorestaurantnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/0MdrqEE32TymjSTM4QDBp/dfd6632c06066e5c42faef46fd0a047e/_jojo-francesco-tonelli-003.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"4871",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/15188-JoJo-menu.pdf",primary_location:"Upper East Side",address:"160 E. 64th St., Manhattan, NY 10065",latitude:40.7650606,longitude:-73.9657136,telephone:"(212)2235656",price_range:"$",facebook_url:"https://www.facebook.com/jojorestaurant",instagram_url:"https://instagram.com/jojorestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Philippe by Philippe Chow Downtown",slug:"philippe-by-philippe-chow-downtown",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Chinese",summary:"This newly renovated subterranean dining space offers a family-style menu that emphasizes traditional Beijing cuisine with an elevated twist.",website:"https://www.philippechow.com/location/philippe-chow-downtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/64aZ9p3kaJln7TuMgXJhyp/892635f7d385e79dfd73c820246f5f39/Philippe-Chow-Downtown-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1022116",menu_url:"",primary_location:"Chelsea",address:"Dream Downtown, 355 W. 16th St., 10011 Manhattan",latitude:40.7423311,longitude:-74.0034791,telephone:"(212)8859400",price_range:"$",facebook_url:"https://www.facebook.com/PhilippeDowntown",instagram_url:"https://instagram.com/philippechownyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tuscan Hills",slug:"tuscan-hills",borough:"Queens",neighborhood:"Forest Hills",cuisine:"Italian",summary:"Tuscan dishes such as the house specialty, cacciucco alla livornese, can be found at this rustic Italian restaurant in Forest Hills.",website:"https://www.tuscanhillsnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/24HzddT3suDm1yL4lRbNsu/7777a116e47eddcee66b3eca75497ca6/DSCN1618_DA7CEA33-F6FC-4482-AD3292A2FD29EA7A_8f7f6879-2c89-4f48-8d86732bdb06ad3b.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Forest Hills",address:"110-60 Queens Blvd., Queens, NY 11375",latitude:40.7189717,longitude:-73.8393511,telephone:"(718)4874500",price_range:"$",facebook_url:"https://www.facebook.com/Tuscan-Hills-325953470872924",instagram_url:"https://instagram.com/tuscanhillsrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gallaghers Steakhouse",slug:"gallaghers-steakhouse",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Steakhouse",summary:"Back in the prohibition years, Gallaghers Steakhouse served as a speakeasy.",website:"https://www.gallaghersnysteakhouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6iveHsvOQ7ZbhdNOvfzQjx/33065b4e6d77950ed3cd8bdb4ff003f0/gallaghers-steakhouse-bar-daniel-kreiger.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["classic-restaurants"],opentable_id:"104182",menu_url:"",primary_location:"Times Square/Theatre District",address:"228 W. 52nd St., Manhattan, NY 10019",latitude:40.7628299,longitude:-73.9838826,telephone:"(212)5865000",price_range:"$",facebook_url:"https://www.facebook.com/GallaghersNYC",instagram_url:"https://instagram.com/gallaghersnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Psaraki",slug:"psaraki",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Greek",summary:"Psaraki, the creation of longtime hospitality veteran James Paloumbis, evokes the charm of seaside tavernas found along the shores of Greece.",website:"https://www.psaraki.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3YZ8NvjLxRoYtecBL9kri3/8460acab211136f9e8d14e30d6566ee5/Psaraki-Brooklyn-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1377028",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49198-Psaraki-menu.pdf",primary_location:"Williamsburg",address:"420 Kent Ave., Brooklyn, NY 11249",latitude:40.7099936,longitude:-73.9691698,telephone:"(212)2205035",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Carlotto",slug:"carlotto",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Italian",summary:"Under the leadership of executive chef Andy Kitko and his culinary team, Carlotto’s menu honors Italy’s most celebrated regions.",website:"https://carlottonewyork.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2UbM35SO8OqcuBwYpYWbDp/eaba9eec5cc89ea0b25610a5a50fe993/Carlotto-Manhattan-NYC-Photo-Courtesy-Carlotto-2__1___1_.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Gramercy",address:"100 E. 19th St., Manhattan, NY 10003",latitude:40.7374367,longitude:-73.9876492,telephone:"(212)2091054",price_range:"$",facebook_url:"https://www.facebook.com/CarlottoCucinaItaliana",instagram_url:"https://instagram.com/carlottonewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Amali",slug:"amali",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Mediterranean",summary:"Chef Alex Tubero's updated Mediterranean menu features house-made pasta, sustainably caught seafood, seasonal produce and meat from family farms.",website:"https://www.amalinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6cpqLBEb6ULySWQVqyrBw/cb9f80f28d89539ef2cbf7d31c7af783/amali--ues-manhattan-nyc-photo-doug-young-spiced_chicken_3__1___1_.jpeg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"18622",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/33662-Amali-menu.pdf",primary_location:"Upper East Side",address:"115 E. 60th St., Manhattan, NY 10022",latitude:40.7633736,longitude:-73.9685713,telephone:"(212)3398363",price_range:"$",facebook_url:"https://www.facebook.com/AmaliNewYork",instagram_url:"https://instagram.com/AmaliNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Benny John's Bar and Grill",slug:"benny-johns-bar-and-grill",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:"Benny John's Bar and Grill is a steakhouse that offers lunch and dinner daily, along with happy hour and bar bites.",website:"https://www.bennyjohnsnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2DyMKo3PV0krM1oR5P1PTr/aeea226a612caefe0760d02a1603b8d0/Benny-Johns-Bar-And-Grill-Manhattan-NYC-Photo-Courtesy-4.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1317547",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48159-BennyJohn%27sBarandGrill-menu.pdf",primary_location:"Midtown East",address:"8 E. 48th St., Manhattan, NY 10017",latitude:40.7568173,longitude:-73.9774474,telephone:"(212)5001857",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/bennyjohnsnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Stella 34 Trattoria",slug:"stella-34-trattoria",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"Italian",summary:"This modern Italian trattoria and bar on Macy's sixth floor boasts soaring ceilings and beautiful natural light, not to mention impressive views of the Empire State Building.",website:"https://www.patinagroup.com/stella-34",image_url:"//images.ctfassets.net/1aemqu6a6t65/4CgR2EVXiOQ6bWzukIYxIv/57ffdab21955a342efb2aa7e0dd34c5f/stella34-chitarra.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:["hidden-gems"],opentable_id:"102115",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37733-Stella34Trattoria-menu.pdf",primary_location:"Herald Square",address:"Macy's Herald Square, 151 W. 34th St., Manhattan 6th fl.",latitude:40.7508025,longitude:-73.9894835,telephone:"(212)9679251",price_range:"$",facebook_url:"https://www.facebook.com/Stella34Trattoria",instagram_url:"https://instagram.com/Stella34Macys",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Masseria",slug:"la-masseria",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"Masseria means farmhouse in Italian, and this restaurant’s inspiration is evident in the stone walls and exposed wooden beams.",website:"https://lamasserianyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7zkvEF7u1cuvHUJIp0s8fW/04509f8b3bab0b717defc7240c3e4bb2/compressed-la-masseria-times-square-manhattan-nyc-b89d6cf9-4352-4875-852a-fd3cb3114993_5297d067-625f-4f0a-bd441367cc74a80c_2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"21001",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/25577-LaMasseria-menu.pdf",primary_location:"Times Square/Theatre District",address:"235 W. 48th St., Manhattan, NY 10036",latitude:40.7607614,longitude:-73.9861055,telephone:"(212)5822111",price_range:"$",facebook_url:"https://www.facebook.com/lamasserianyc",instagram_url:"https://instagram.com/lamasserianyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kubeh",slug:"kubeh",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Middle Eastern",summary:"Kubeh, a Greenwich Village restaurant dedicated to lesser known cuisines of the Middle East, is the product of chef Melanie Shurka and husband David Ort.",website:"https://www.eatkubeh.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2aGH4LEzBMmOPjvprFz5HE/af9299d035e3d2b7cccee33d8ceb6886/kubeh11092020-149.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46004-Kubeh-menu.pdf",primary_location:"Greenwich Village",address:"464 Sixth Ave., Manhattan, NY 10011",latitude:40.7354689,longitude:-73.9980051,telephone:"(646)4486688",price_range:"$",facebook_url:"https://www.facebook.com/eatkubeh",instagram_url:"https://instagram.com/eatkubeh",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Del Frisco's Grille - Brookfield Place",slug:"del-friscos-grille-brookfield-place",borough:"Manhattan",neighborhood:"Battery Park City",cuisine:"Steakhouse",summary:"Del Frisco’s features a steakhouse-style menu, with classic starters like a wedge salad and choice cuts of broiled steaks.",website:"https://delfriscosgrille.com/brookfield-place",image_url:"//images.ctfassets.net/1aemqu6a6t65/c3zcQb4UQb0CqzmFzNoGM/b85c827848f99dc2beb3097bf078cba1/Del-Friscos-Brookfield-Place-NYC-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"730255",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/42278-DelFrisco%27sGrille-BrookfieldPlace-menu.pdf",primary_location:"Battery Park City",address:"250 Vesey St., Manhattan, NY 10281",latitude:40.7141662,longitude:-74.0161089,telephone:"(212)7860760",price_range:"$",facebook_url:"https://www.facebook.com/DFGrilleBrookfieldPlace",instagram_url:"https://instagram.com/dfgrille",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bourbon Steak New York",slug:"bourbon-steak-new-york",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Bourbon Steak is chef Michael Mina's love letter to the classic American steakhouse, serving the finest cuts of premium beef and seafood, as well as seasonal ingredients sourced from local farmers and purveyors.",website:"https://www.bourbonsteaknyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/zKVUKf2J2L2tGLMYlwePi/dd017146c41e1185f402da1461390e0a/Bourbon-Steak-New-York-Manhattan-NYC-Photo-Rey-Lopez-3.jpg",meal_types:["$45 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1368814",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49430-BourbonSteakNewYork-menu.pdf",primary_location:"Midtown West",address:"JW Marriott Essex House New York, 160 Central Park South, 10019 Manhattan",latitude:40.7662802,longitude:-73.9785674,telephone:"(212)4845120",price_range:"$",facebook_url:"https://www.facebook.com/bourbonsteaknyc",instagram_url:"https://instagram.com/bourbonsteaknyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chelsea Ristorante",slug:"chelsea-ristorante",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Italian",summary:"Chelsea Ristorante combines the rich tradition of Italian cuisine with casual but elegant design and architecture in an updated and innovative setting.",website:"https://chrnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6fsZxBx459XKNixl2QkPUv/844848c765e94393c64830ef68951619/Chelsea-Ristorante-Manhattan-NYC-Photo-Spothopper-Inc.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"31204",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/30229-ChelseaRistorante-menu.pdf",primary_location:"Chelsea",address:"108 Eighth Ave., Manhattan, NY 10011",latitude:40.7406516,longitude:-74.0015915,telephone:"(212)9247786",price_range:"$",facebook_url:"https://www.facebook.com/chelsearistoranteny",instagram_url:"https://instagram.com/chelsearistorante",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tha Phraya",slug:"tha-phraya",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Thai",summary:"Enjoy pure, original, unfiltered Thai food on Manhattan's Upper East Side at Tha Phraya.",website:"https://www.thaphraya.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6ZF1UkWpW0EfqBbzq14svU/968070be010439e73b43c55fc9448f38/Tha-Praya-Manhattan-NYC-Photo-Courtesy-Tha-Phraya.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49201-ThaPhraya-menu.pdf",primary_location:"Upper East Side",address:"1553 Second Ave., Manhattan, NY 10028",latitude:40.7745319,longitude:-73.954509,telephone:"(646)5641456",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/thaphraya.nyc",michelin_award:"BIB_GOURMAND",michelin_slug:"tha-phraya",nyttop100_rank:""},{name:"The Dolar Shop Hot Pot",slug:"the-dolar-shop-hot-pot",borough:"Manhattan",neighborhood:"East Village",cuisine:"Chinese",summary:"The Dolar Shop's philosophy is to continuously innovate, always serve fresh ingredients, and to excel in customer service to build a strong connection with their guests, and proudly showcase the Macau hot pot culture.",website:"https://www.dolarshop.com/location/manhattan-location",image_url:"//images.ctfassets.net/1aemqu6a6t65/jIsqucY3Z7j3pLY7OeMKS/aa5d02b325fb3fc0b8fbb4b1c102f78b/The-Dolar-Shop-Hot-Pot-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49349-DolarShopHotPot-menu.pdf",primary_location:"East Village",address:"55 Third Ave., Manhattan, NY 10003",latitude:40.731068,longitude:-73.9884998,telephone:"(646)5900034",price_range:"$",facebook_url:"https://www.facebook.com/thedolarshopnewyork",instagram_url:"https://instagram.com/thedolarshopusa",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Asuka Sushi",slug:"asuka-sushi",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Japanese / Sushi",summary:"From various rolls to teriyaki, and many mouth-watering Japanese dishes, you'll be sure to find many different flavors to try. ",website:"https://www.asukasushiny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2d5wGxNAeREWZzkAk4wRyW/12b821c38507c6000d3581bfcf7888f4/Asuka-Sushi-Manhattan-NYC-Courtesy-3.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"78148",menu_url:"",primary_location:"Chelsea",address:"300 W. 23rd St., Manhattan, NY 10011",latitude:40.7452177,longitude:-73.9989291,telephone:"(212)7270888",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100068904018640",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"RA Sushi Bar Restaurant – Times Square",slug:"ra-sushi-bar-restaurant-times-square",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Japanese / Sushi",summary:"RA Sushi serves up a fresh, creative, Japanese menu with a unique blend of creative sushi and an innovative menu from the kitchen.",website:"https://rasushi.com/locations/times-square-ny",image_url:"//images.ctfassets.net/1aemqu6a6t65/DAAC4X68EyO75HsmFzyQx/d3e15be22025dad049e663ce433739e9/Haru-Sushi211099_1CD3BF53-A9CB-45C3-B5FB54ABED1054BF_6ac59680-2b24-4611-8eb25af59396fcf1.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"144244",menu_url:"",primary_location:"Times Square/Theatre District",address:"229 W. 43rd St., Manhattan, NY 10036",latitude:40.7576153,longitude:-73.9873677,telephone:"(212)3989810",price_range:"$",facebook_url:"https://www.facebook.com/RASushi",instagram_url:"https://instagram.com/rasushi",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hutong",slug:"hutong",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Chinese",summary:"Midtown East holds a luxurious Northern Chinese restaurant and lounge.",website:"https://www.hutong-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5LamcnBOmikihOsEn5C6eg/c6d8c3301b40007ed0150c04e0cf5a32/hutong-midtown-manhattan-nyc-20180412-hutong_red-lantern-soft-shell-crab-2.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"1283758",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41187-Hutong-menu.pdf",primary_location:"Midtown East",address:"731 Lexington Ave., Manhattan, NY 10022",latitude:40.7618677,longitude:-73.9682925,telephone:"(212)7584800",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/hutongnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Altesi Ristorante",slug:"altesi-ristorante",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"The elegantly modern and sophisticated Altesi Ristorante, on the Upper East Side, offers a menu consisting of Tuscan-inspired dishes. ",website:"https://www.altesinyc.com/madison",image_url:"//images.ctfassets.net/1aemqu6a6t65/2TKuFlEzqO6yZVM6BzVCJS/099931f9eb3fa0c79ec7a94549ff20a9/_altesi-_altesi-img_2819.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"145837",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38609-AltesiRistorante-menu.pdf",primary_location:"Upper East Side",address:"26 E. 64th St., Manhattan, NY 10065",latitude:40.7668491,longitude:-73.9694425,telephone:"(212)7598900",price_range:"$",facebook_url:"https://www.facebook.com/pages/Altesi-Ristorante/786805498014795",instagram_url:"https://instagram.com/altesinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Maya",slug:"maya",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Mexican",summary:"Chef Richard Sandoval’s modern Mexican restaurant evokes the essence of Acapulco, from its decor to its cuisine.",website:"https://mayanewyorkcity.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2iDosUgtkAog5ksTnbMsPF/5436c4e30ac99e6dbe053f2a47a12187/RW-To-Go_Maya_DFB016A6-5056-A36F-23AA1D9C819F5480-dfb015b35056a36_dfb016f7-5056-a36f-23b113346b017dad.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"2501",menu_url:"",primary_location:"Upper East Side",address:"1191 First Ave., Manhattan, NY 10065",latitude:40.7631741,longitude:-73.9597236,telephone:"(212)5851818",price_range:"$",facebook_url:"https://www.facebook.com/MayaNewYorkCity",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Suprema Provisions",slug:"suprema-provisions",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Suprema, home of the top-rated burger in NYC, was inspired by the great salumerias of Rome, tapas bars of Barcelona and sidewalk cafés of Paris.",website:"https://www.supremanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5biMEiVMD5S81mfbhDu3bC/d658634b151346ece86e9ad993b9ca10/img_2975_3e9216aa-16d0-4a9f-a6e83a34207062bf_5be00f07-6d7a-4668-aedaf3207e2fc3af.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46205-SupremaProvisions-menu.pdf",primary_location:"West Village",address:"305 Bleecker St., Manhattan, NY 10014",latitude:40.7326906,longitude:-74.0036439,telephone:"(646)9644994",price_range:"$",facebook_url:"https://www.facebook.com/SupremaNYC",instagram_url:"https://instagram.com/supremanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Porter House",slug:"porter-house-bar-and-grill",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Carnivores and sophisticates meet at this all-American steakhouse, opened in 2006 by star chef Michael Lomonaco.",website:"https://www.porterhousenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2prittKGDBmterfOA0CROu/ae45b6a8eddfd205ae2f8954e9448ba6/Porter-House-Manhattan-NYC-Photo-Natalie-Anne-Powers-3.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"7053",menu_url:"",primary_location:"Midtown West",address:"10 Columbus Circle, 4th fl., 10019 Manhattan",latitude:40.7685716,longitude:-73.9831426,telephone:"(212)8239500",price_range:"$",facebook_url:"https://www.facebook.com/PorterHouseNY",instagram_url:"https://instagram.com/porterhouse_ny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Malibu Farm",slug:"malibu-farm",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"American (New)",summary:"An indoor-outdoor, California-style restaurant that has views of the Brooklyn Bridge from Pier 17.",website:"https://www.malibufarm.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/4rHaF92uDCFb8SYqVMm0Ap/9eb44a6acba5e02ee383f530a46959c7/Malibu-Farm-Seaport-Manhattan-NYC-Photo-Courtesy-The-Seaport-Photo-Mike-Szpot-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1048528",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44633-MalibuFarm-menu.pdf",primary_location:"The Seaport",address:"Pier 17, 89 South St., 10038 Manhattan",latitude:40.705573,longitude:-74.0014567,telephone:"(212)2653030",price_range:"$",facebook_url:"https://www.facebook.com/MalibuFarmNewYork",instagram_url:"https://instagram.com/malibufarmnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wagamama - Murray Hill",slug:"wagamama-murray-hill",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Asian Fusion",summary:"Wagamama serves fresh and nourishing Asian food inspired by the flavors of Japan.",website:"https://www.wagamama.us/restaurants/nyc-murray-hill",image_url:"//images.ctfassets.net/1aemqu6a6t65/3idUcYjhcKffEhHsHE74yb/72e2da9f92b400b04b152366fd19f9be/Wagamama2022October-1827-edited_8A9DF52C-E7F4-4833-858B35D5F599DA1D_12dbf134-c23a-4597-8f67631ac6c1d3a4.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1027582",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44465-Wagamama-MurrayHill-menu.pdf",primary_location:"Murray Hill",address:"605 Third Ave., Manhattan, NY 10158",latitude:40.7489423767,longitude:-73.9755907823,telephone:"(646)8133396",price_range:"$",facebook_url:"https://www.facebook.com/wagamamausa",instagram_url:"https://instagram.com/wagamamausa",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Noortwyck",slug:"the-noortwyck",borough:"Manhattan",neighborhood:"West Village",cuisine:"American (New)",summary:"Set in the West Village, The Noortwyck exudes an elegant yet intimate charm, offering a timeless, New American menu that celebrates seasonal dishes, an extensive wine selection and specialty cocktails.",website:"https://www.thenoortwyck.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4XaoTs5j0qkFHFdUo6rhAZ/a28a5dfda298691950c580d016cfa524/The-Noortwyck-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49738-Noortwyck-menu.pdf",primary_location:"West Village",address:"289 Bleecker St., Manhattan, NY 10014",latitude:40.7321832,longitude:-74.0033181,telephone:"(917)2612009",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/thenoortwyck",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"STK Midtown",slug:"stk-midtown",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Simply put, STK is not your daddy's steakhouse.",website:"https://stksteakhouse.com/venues/nyc-midtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/2rX2FuK9G8Am4HW1PbzmJ1/53dce19a98115726896abf7c04cf54d0/rw-to-go_stk-midtown_e6cc5456-5056-a36f-23829015f322aa96-e6cc532d5056a36_e6cc54b4-5056-a36f-239d3d33b8fc0a0b.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"65347",menu_url:"",primary_location:"Midtown West",address:"1114 Sixth Ave., Manhattan, NY 10036",latitude:40.7546664,longitude:-73.9828494,telephone:"(646)6242455",price_range:"$",facebook_url:"https://www.facebook.com/STKhouse",instagram_url:"https://instagram.com/eatSTK",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Dutch",slug:"the-dutch",borough:"Manhattan",neighborhood:"Soho",cuisine:"American (New)",summary:"Andrew Carmellini's Soho spot serves New American fare with an emphasis on local, seasonal produce and comfort food.",website:"https://www.thedutchnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4yBepucPdRYceUnnVNWGlf/49975d02e7c33e7b0b85483eff9694e2/RW-To-Go_The-Dutch_E73D9DF6-5056-A36F-23FDEBCB7B20965F-e73d9cd95056a36_e73d9e4e-5056-a36f-237680ea17c23d91.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"47848",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36694-Dutch-menu.pdf",primary_location:"Soho",address:"131 Sullivan St., Manhattan, NY 10012",latitude:40.7265479,longitude:-74.0021666,telephone:"(212)6776200",price_range:"$",facebook_url:"https://www.facebook.com/TheDutchNYC",instagram_url:"https://instagram.com/thedutchnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"House of the Red Pearl",slug:"house-of-the-red-pearl-at-tin-building-by-jean-georges",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"Chinese",summary:"The House of the Red Pearl is a clandestine fine dining restaurant.",website:"https://www.tinbuilding.com/restaurants-and-bars/house-of-the-red-pearl",image_url:"//images.ctfassets.net/1aemqu6a6t65/4SalF7iWIb52ffzsLAQ1Pd/64e4a1619f2375468e65860be28d76a8/tin-building-house-of-the-red-pearl-courtesy-tin-building__1___1_.jpeg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47952-HouseoftheRedPearlatTinBuildingbyJean-Georges-menu.pdf",primary_location:"The Seaport",address:"96 South St., Manhattan, NY 10038",latitude:40.7062323,longitude:-74.0022681,telephone:"(888)7770942",price_range:"$",facebook_url:"https://www.facebook.com/TinBuildingNYC",instagram_url:"https://instagram.com/tinbuilding",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Celeste",slug:"celeste",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"This neighborhood trattoria has been a reliable Upper West Side standby for a number of years.",website:"https://www.celesterestaurantny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7GMeCEKZVeWPnISWQLQv20/b7e1544d3a9c7772a81715591f4e85e4/Celeste-Restaurant-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44589-Celeste-menu.pdf",primary_location:"Upper West Side",address:"502 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7866992,longitude:-73.9760929,telephone:"(212)8744559",price_range:"$",facebook_url:"https://www.facebook.com/celesterestaurantnyc",instagram_url:"https://instagram.com/celesterestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"David Burke Tavern",slug:"david-burke-tavern",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (New)",summary:"David Burke Tavern is a modern American tavern on the Upper East Side that features American plates as a reflection of chef Burke’s contemporary approach to cooking, with a nod to elevated New York classics.",website:"https://davidburketavern.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/60ROa5LWZ65oTf8OrHebFZ/02e0f4f4b260ae0d706dc564191d43cb/david_burke_tavern",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1028503",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39746-DavidBurkeTavern-menu.pdf",primary_location:"Upper East Side",address:"135 E. 62nd St., Manhattan, NY 10065",latitude:40.7644377,longitude:-73.967102,telephone:"(212)9889021",price_range:"$",facebook_url:"https://www.facebook.com/DavidBurkeTavern",instagram_url:"https://instagram.com/dbtavern",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Empire Steak House - Midtown East",slug:"empire-steak-house-east-50th-street",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:"Empire Steak House's location on the east side has two raised tiers of seating featuring wrap-around booths and a hand-painted dome.",website:"https://www.empiresteakhousenyc.com/midtown-east",image_url:"//images.ctfassets.net/1aemqu6a6t65/3HCfOLUn7687US8bDsYqRh/ae1e35e3dd877a5016bb9c121be5bc74/20.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"212278",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39370-EmpireSteakHouse-MidtownEast-menu.pdf",primary_location:"Midtown East",address:"151 E. 50th St., Manhattan, NY 10022",latitude:40.7561844,longitude:-73.9712258,telephone:"(212)5826900",price_range:"$",facebook_url:"https://www.facebook.com/EmpireSteakHouseE50th",instagram_url:"https://instagram.com/empiresteakhousenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"El Coco - Chelsea",slug:"el-coco-chelsea",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Mexican",summary:"El Coco is a new taqueria in Chelsea with a twist, featuring authentic Mexican dishes, empanadas, traditional tacos, and a variety of signature sauces.",website:"https://www.elcocony.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5R6s5EbjUZgI9KdHOlb3fk/c207f6c0e5c79075fe7eadc55a5ce0df/AU8I5247_D2B49B4F-AE1D-4355-99D580497633EB8C_30b320cd-fa15-4845-b70044b3ad4144e7.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1307545",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49072-ElCoco-Chelsea-menu.pdf",primary_location:"Chelsea",address:"202 Eighth Ave., Manhattan, NY 10011",latitude:40.7435248,longitude:-73.9994683,telephone:"(646)6924123",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/elcocotaqueria",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dinosaur Bar-B-Que - Harlem",slug:"dinosaur-bar-b-que",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Barbecue",summary:"Healthy portions of pork ribs, Texas-style brisket and pulled pork, along with plenty of cocktails and seasonal brews, are on the menu at this barbecue spot. ",website:"https://dinosaurbarbque.com/locations/harlem",image_url:"//images.ctfassets.net/1aemqu6a6t65/4z0xZKrAxk0YhOfecWcMSO/0e46312fd0dc703da9c192c0ee25d6df/bbq-wings_2c2997bf-f34a-4056-8fad4e23ce5dc1b4_c3bb1880-43be-45b1-b7cba7a84c67b20c-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/26366-DinosaurBar-B-Que-Harlem-menu.pdf",primary_location:"Harlem",address:"700 W. 125th St., Manhattan, NY 10027",latitude:40.8180319,longitude:-73.9609174,telephone:"(212)6941777",price_range:"$",facebook_url:"https://www.facebook.com/DinosaurBBQHarlem",instagram_url:"https://instagram.com/Dinosaur_BBQ",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pete's Tavern",slug:"petes-tavern",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"American (Traditional)",summary:"Pete's Tavern is the oldest continuously operating bar and restaurant in New York City.",website:"https://www.petestavern.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4AbUqMYIUj93QUlKEjZ0h/5250421f9314691e7d0e40acf5937ea1/img_7009.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["classic-restaurants"],opentable_id:"",menu_url:"",primary_location:"Gramercy",address:"129 E. 18th St., Manhattan, NY 10003",latitude:40.7364886,longitude:-73.9867085,telephone:"(212)4737676",price_range:"$",facebook_url:"https://www.facebook.com/petestavern1864",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sushi of Gari 46",slug:"sushi-of-gari-46",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Japanese / Sushi",summary:"Masatoshi “Gari” Sugio is the Japanese owner-chef of several highly regarded sushi spots known for procuring the freshest fish on the market.",website:"https://www.sushiofgari.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2w2F6gbI049WwEiFwbt4w4/d5d9b6ba7df9eac2b8564b6ab98616be/compressed-sushigari46_restaurant_dining_46thstreet_manhattan_nyc.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"17965",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49732-SushiofGari46-menu.pdf",primary_location:"Times Square/Theatre District",address:"347 W. 46th St., Manhattan, NY 10036",latitude:40.7606826,longitude:-73.9896109,telephone:"(212)9570046",price_range:"$",facebook_url:"https://www.facebook.com/sushi.of.gari",instagram_url:"https://instagram.com/sushi.of.gari",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Copinette",slug:"copinette",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"Midtown East's Copinette serves American cuisine with strong French influences.",website:"https://copinettenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1G2E0MJdXNkx0PQh59uZvv/c4f1521fca87ccde621b9a847ce48900/Copinette-Manhattan-NYC-Photo-Joalia-Hospitality-1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1011319",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41007-Copinette-menu.pdf",primary_location:"Midtown East",address:"891 First Ave., Manhattan, NY 10022",latitude:40.7541516,longitude:-73.9662617,telephone:"(212)9034001",price_range:"$",facebook_url:"https://www.facebook.com/CopinetteNYC",instagram_url:"https://instagram.com/copinettenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Warren Street Bar & Restaurant",slug:"warren-street-bar-and-restaurant",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"American (New)",summary:"This modern neighborhood brasserie offers an all-day menu of much-loved classics and fresh, seasonal dishes filled with flavors and ingredients from around the world.",website:"https://www.firmdalehotels.com/hotels/new-york/warren-street-hotel/warren-street-bar-restaurant",image_url:"//images.ctfassets.net/1aemqu6a6t65/2QLrrTIsJhzvF5rbfP8zwg/6952f6ac93d9eabff67ee333c095f3b6/Bar-1-_454B29DF-4ABD-43CC-ADD8A2853998E18E_acabf815-9eed-45e9-82a9bc43b9ef3ee8.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1235140",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49023-WarrenStreetBar%26Restaurant-menu.pdf",primary_location:"Tribeca",address:"Warren Street Hotel, 86 Warren St., 10007 Manhattan",latitude:40.7155632,longitude:-74.010503,telephone:"(212)2558686",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Monterey",slug:"monterey",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"Simon Oren, Dudi Sasson and chef James Tracey bring midtown Manhattan a glamorous bold American restaurant: Monterey.",website:"https://www.montereyny.com/",image_url:"//images.ctfassets.net/1aemqu6a6t65/4wAkKMrESIMp9gxzY1Hz6Z/90be78ba7f9596e17ad35528caebbdc8/DqakaJAw_16853FDA-4408-4E73-83CF72AFC4D39127_bab8b5ea-2c4f-4925-830bc28344089be8",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1242103",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48139-Monterey-menu.pdf",primary_location:"Midtown East",address:"37 E. 50th St., Manhattan, NY 10019",latitude:40.7578864,longitude:-73.9746074,telephone:"(212)3777171",price_range:"$",facebook_url:"https://www.facebook.com/montereynyc",instagram_url:"https://instagram.com/monterey_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Strip House Downtown",slug:"strip-house-downtown",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Steakhouse",summary:"Strip House Downtown delivers on dishes and décor, creating a steakhouse unlike any other in New York.",website:"https://www.striphouse.com/location/striphouse-downtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/77sDBR2NYVqlDzdY72MqCS/838c2b1e6ac4a06725b19cb439ac251f/strip-house-downtown-greenwich-village-manhattan-nyc-8b0.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"3181",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/18274-StripHouseDowntown-menu.pdf",primary_location:"Greenwich Village",address:"13 E. 12th St., Manhattan, NY 10003",latitude:40.734399,longitude:-73.9934116,telephone:"(212)3280000",price_range:"$",facebook_url:"https://www.facebook.com/StripHouseSteak",instagram_url:"https://instagram.com/striphouseofficial",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"No Work Allowed",slug:"no-work-allowed",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Asian Fusion",summary:"No Work Allowed is a Japanese izakaya with a northeastern Thai twist—a unique culinary destination where good food, great drinks, and live jazz come together in a relaxed, vintage-inspired atmosphere.",website:"https://noworkallowednyc.godaddysites.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/42y5VShlboCBJtJbgElwoi/cb975a3b898f4d36bdb3bb5977f3147d/No-Work-Allowed-Manhattan-NYC-Photo-Peeradon-Ariyanukooltorn-3.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown East",address:"235 E. 53rd St., Manhattan, NY 10022",latitude:40.7572723,longitude:-73.9679571,telephone:"(212)3712947",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61560283486477",instagram_url:"https://instagram.com/noworkallowednyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Dining Room at Gramercy Tavern",slug:"the-dining-room-at-gramercy-tavern",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"American (New)",summary:"Executive chef and partner Michael Anthony’s menu consists of elegant dishes with a rustic influence that showcases the restaurant’s relationships with local farms and purveyors.",website:"https://www.gramercytavern.com/location/gramercy-tavern-the-dining-room",image_url:"//images.ctfassets.net/1aemqu6a6t65/4trL2nvUtuFW7eTgmuKpwx/16b34d8320f15f57a741d63a4da03203/the-dining-room-gramercy-tavern-manhattan-nyc-photo-evan-angelastro__52.jpg",meal_types:["$60 Lunch Price","$60 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["classic-restaurants"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46438-DiningRoomatGramercyTavern-menu.pdf",primary_location:"Gramercy",address:"42 E. 20th St., Manhattan, NY 10003",latitude:40.7384569,longitude:-73.9885545,telephone:"(212)4770777",price_range:"$",facebook_url:"https://www.facebook.com/GramercyTavern",instagram_url:"https://instagram.com/gramercytavern",michelin_award:"ONE_STAR",michelin_slug:"gramercy-tavern",nyttop100_rank:47},{name:"Nudibranch",slug:"nudibranch",borough:"Manhattan",neighborhood:"East Village",cuisine:"Korean",summary:"Nudibranch is a Korean-Spanish restaurant that serves thoughtful small plates, juicy wines and cocktails in a chic space in the East Village.",website:"https://nudibranchnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4mXJeQQtZC0EVO77cYl000/3dfaa9ba5d3c4ac3a8d2994b750c3686/Nudibranch-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1238359",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46309-Nudibranch-menu.pdf",primary_location:"East Village",address:"125 First Ave., Manhattan, NY 10003",latitude:40.7274205,longitude:-73.9857285,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/nudibranchnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bond 45",slug:"bond-45",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"This enormous, bi-level, Italian-ish venue offers a huge variety of meals and dishes.",website:"https://www.bond45ny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/eCkeaCs6fUIOvhvpVZTVe/23fd9a71d2c431c625017465fb08a2bd/bond45_restaurant_timessquare_theatredistrict_manhattan_nyc_photo_lizclayman.jpg",meal_types:["$45 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"34009",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/26385-Bond45-menu.pdf",primary_location:"Times Square/Theatre District",address:"221 W. 46th St., Manhattan, NY 10036",latitude:40.7593741,longitude:-73.9861745,telephone:"(212)8694545",price_range:"$",facebook_url:"https://www.facebook.com/bond45nyc",instagram_url:"https://instagram.com/bond45nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tavern on the Green",slug:"tavern-on-the-green",borough:"Manhattan",neighborhood:"Central Park",cuisine:"American (New)",summary:`One of NYC's most recognizable restaurants is tucked just inside Central Park. It serves up American fare in an elegant indoor-outdoor setting.
`,website:"https://www.tavernonthegreen.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2JTKzntUaffbOvYWqQQ4AH/e68505d8ace7b9e541b51f7c04097f55/headertavern-on-the-green-courtyarda-maura-daley.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:["classic-restaurants"],opentable_id:"118102",menu_url:"",primary_location:"Central Park",address:"1 Tavern on the Green, Manhattan, NY 10023",latitude:40.7722597,longitude:-73.9776896,telephone:"(212)8778684",price_range:"$",facebook_url:"https://www.facebook.com/TavernOnTheGreen",instagram_url:"https://instagram.com/tavernonthegreen",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Docks Oyster Bar",slug:"docks-oyster-bar",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Seafood",summary:"Docks Oyster Bar has been serving the freshest seafood and oysters for more than 25 years in Midtown Manhattan.",website:"https://www.docksoysterbar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5l9pH1JoJeWU0cFEf0cZd8/2833ee9763c62cee90d3053cfdf801de/_docks-oyster-bar-quintin-bacon-_docks-oyster-bar-quintin-bacon-_docks-oyster-bar-quin-bacon-docks-vodka-martini.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"35893",menu_url:"",primary_location:"Midtown East",address:"633 Third Ave., Manhattan, NY 10017",latitude:40.7498006,longitude:-73.9749831,telephone:"(212)9868080",price_range:"$",facebook_url:"https://www.facebook.com/pages/Docks-Oyster-Bar/108427555862746",instagram_url:"https://instagram.com/docksoysterbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Crown Shy",slug:"crown-shy",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"American (New)",summary:"Find creative fine dining in a stunning art deco tower.",website:"https://www.crownshy.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/3VdYB5sdb2HNG52FYheWD3/00abee691cf42f385b3c5cd7ada8cdae/crown-shy-lower-manhattan-nyc-chris-payne.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46520-CrownShy-menu.pdf",primary_location:"Lower Manhattan",address:"70 Pine St., Manhattan, NY 10005",latitude:40.7065047,longitude:-74.0077715,telephone:"(212)5171932",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"ONE_STAR",michelin_slug:"crown-shy",nyttop100_rank:35},{name:"Benjamin Steakhouse",slug:"benjamin-steakhouse",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:"This opulent gem near Grand Central Terminal is the offspring of Peter Luger alumni Benjamin Prelvukaj and chef Arturo McLeod, who bring with them more than 20 years of experience.",website:"https://benjaminsteakhouse.com/nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/14duJ3FeBILVE2ecNBgce6/45cce17de8123ca5e789e4ce5913290d/benjamin-steakhouse-midtown-east-manhattan-nyc-front-sign_1dc2d706-da6b-4aa2-80da055dbb1fed82_836908f7-a3b0-4525-aa15de32b2f.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"10918",menu_url:"",primary_location:"Midtown East",address:"52 E. 41st St., Manhattan, NY 10017",latitude:40.7516438,longitude:-73.9791194,telephone:"(212)2979177",price_range:"$",facebook_url:"https://www.facebook.com/BenjaminSteakhouse",instagram_url:"https://instagram.com/benjaminsteak",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sake No Hana",slug:"sake-no-hana",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"Japanese / Sushi",summary:"This lively, modern Japanese restaurant serves free-spirited izakaya dishes invigorated with New York attitude.",website:"https://taogroup.com/venues/sake-no-hana-new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/588NWHQKJtLO8J7k0UhSXP/1b4dc872e76e438b219822d990e4c307/Sake-No-Hana-Manhattan-NYC-Courtesy-Tao-Group-Hospitality.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1255435",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47937-SakeNoHana-menu.pdf",primary_location:"Lower East Side",address:"Moxy NYC Lower East Side, 145 Bowery, 10002 Manhattan",latitude:40.7189681,longitude:-73.9944634,telephone:"(212)2490315",price_range:"$",facebook_url:"https://www.facebook.com/sakenohanany",instagram_url:"https://instagram.com/sakenohana",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sushi Ann",slug:"sushi-ann",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Japanese / Sushi",summary:"Businesspeople flock to this no-frills sushi joint for both lunch and post-work dinners.",website:"https://www.sushiann.net",image_url:"//images.ctfassets.net/1aemqu6a6t65/7bCeOFYmbklg1TNPODdzVn/9c0fcaabe25a6983656437bee6873707/Sushi-Ann-Manhattan-NYC-Courtesy-5.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49308-SushiAnn-menu.pdf",primary_location:"Midtown East",address:"38 E. 51st St., Manhattan, NY 10022",latitude:40.7579092,longitude:-73.974326,telephone:"(212)7551780",price_range:"$",facebook_url:"https://www.facebook.com/sushi.ann.nyc",instagram_url:"https://instagram.com/sushi_ann",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"American Cut Tribeca",slug:"american-cut-steakhouse-tribeca",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"Steakhouse",summary:"American Cut Steakhouse pays homage to the best original and aspirational New York dining experience, the steakhouse.",website:"https://www.americancutsteakhouse.com/location/american-cut-tribeca",image_url:"//images.ctfassets.net/1aemqu6a6t65/25jEydeMo9HoxZA6x4GNQi/f219c21d6e06b5211a602aae35b3b39b/americancut_melissahom_7c4df1e0-5056-a36f-23135e3e7fb9096e.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38412-AmericanCutSteakhouseTribeca-menu.pdf",primary_location:"Tribeca",address:"363 Greenwich St., Manhattan, NY 10013",latitude:40.7190959,longitude:-74.009992,telephone:"(212)2264736",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/americancut",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mamo",slug:"mamo-restaurant",borough:"Manhattan",neighborhood:"Soho",cuisine:"Italian",summary:"Mamo brings a long tradition of Italian hospitality and provençal charm to New York City's SoHo neighborhood.",website:"https://mamorestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5BtRCC9IyKl7Jc6Y3cYjgh/d8ef47c62db86f923093d0296219eae5/_mamo-evan-sung-01.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39140-Mamo-menu.pdf",primary_location:"Soho",address:"323 West Broadway, Manhattan, NY 10013",latitude:40.7219097,longitude:-74.0039152,telephone:"(646)9644641",price_range:"$",facebook_url:"https://www.facebook.com/mamorestaurant",instagram_url:"https://instagram.com/mamo_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Voglia",slug:"la-voglia",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"La Voglia is an elegant restaurant offering contemporary interpretations of Italian classics on the Upper East Side.",website:"https://lavoglianyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3wG2O8lwc7bkxm1wiR7Ixo/dbe051e3060a1f0e9af188a3a5ffd90a/La-Voglia-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48518-LaVoglia-menu.pdf",primary_location:"Upper East Side",address:"1645 Third Ave., Manhattan, NY 10128",latitude:40.7826745,longitude:-73.9508638,telephone:"(212)4170181",price_range:"$",facebook_url:"https://www.facebook.com/Lavoglia.newyork",instagram_url:"https://instagram.com/lavoglianyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"5 Napkin Burger - Hell's Kitchen",slug:"five-napkin-burger-hells-kitchen",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"American (Traditional)",summary:"5 Napkin Burger serves up hearty and delightful fare, including their signature burger.",website:"https://www.5napkinburger.com/location/hell-s-kitchen-5napkinburger",image_url:"//images.ctfassets.net/1aemqu6a6t65/4stQU0D2nxj0UGZXXU2QT7/f70f8d63f3423accb0a5fe76e6baee57/RW-To-Go_5-Napkin-Burger---Hell-s-Kitchen_B02793FF-5056-A36F-23D00A3E6A95DEBF-b02792965056a36_b027945f-5056-a36f-231616ab0fd.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"22765",menu_url:"",primary_location:"Hells Kitchen",address:"630 Ninth Ave., Manhattan, NY 10036",latitude:40.759987,longitude:-73.9912338,telephone:"(212)7572277",price_range:"$",facebook_url:"https://www.facebook.com/5napkinburger",instagram_url:"https://instagram.com/5napkinburger",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ophelia Lounge NYC",slug:"ophelia-lounge-nyc",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"Find old-school glamour and new-school cocktails at this rooftop bar.",website:"https://www.opheliany.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2tJbHs96EjJ7pWsum4VNP9/16cac334db6404c9c6ea2d35ef7a3891/Ophelia-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"995113",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/42037-OpheliaLoungeNYC-menu.pdf",primary_location:"Midtown East",address:"3 Mitchell Pl., 26th fl., 10017 Manhattan",latitude:40.753401,longitude:-73.9661736,telephone:"(212)9804796",price_range:"$",facebook_url:"https://www.facebook.com/ophelianewyork",instagram_url:"https://instagram.com/opheliany",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wonderland Bar",slug:"wonderland-bar",borough:"Manhattan",neighborhood:"East Village",cuisine:"Asian Fusion",summary:"Wonderland holds pride in their captivating presentations of magical cocktail creations paired with Sichuan-inspired tapas.",website:"https://wonderlandbarnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5J9ebrRvj3iVVUak1W4cmf/6fa2ddbe3d88efda262e65a176431bbe/Wonderland-Bar-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"East Village",address:"96 Second Ave., Manhattan, NY 10003",latitude:40.7270204,longitude:-73.9884895,telephone:"(212)8142943",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61563440864929",instagram_url:"https://instagram.com/wonderlandbarnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pasta Lovers",slug:"pasta-lovers",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"This casual Italian restaurant offers a full variety of reasonably priced sandwiches, pastas, pizza, chicken, veal and fresh fish dishes.",website:"http://pastaloversnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4xy07yLHhzO5JejpiuzkcG/42f9da8ff172e9f0c857588a3c5d0c86/Pasta-lovers-Manhattan-NYC-Photo-SB-Photography-2__1___1_.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"102103",menu_url:"",primary_location:"Times Square/Theatre District",address:"142 W. 49th St., Manhattan, NY 10019",latitude:40.7599841,longitude:-73.9828704,telephone:"(212)8191155",price_range:"$",facebook_url:"https://www.facebook.com/pastaloversnyc",instagram_url:"https://instagram.com/pastaloverstrattoria",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rynn Thai Restaurant & Bar",slug:"rynn-thai-restaurant-and-bar",borough:"Manhattan",neighborhood:"East Village",cuisine:"Thai",summary:"Whether you are a Thai food enthusiast or someone new to the cuisine, Rynn Thai Restaurant & Bar offers the vibrant tapestry of Thai cuisine.",website:"https://www.rynnnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/hDBInNziVIwu5gALpSnrH/43b65f3ad7002e52bad078a059ce46eb/Rynn-Manhattan-NYC-Photo-Bia.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49361-RynnThaiRestaurant%26Bar-menu.pdf",primary_location:"East Village",address:"309 E. Fifth St., Manhattan, NY 10003",latitude:40.7268045,longitude:-73.9882662,telephone:"(646)9228558",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/rynn.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Meadowsweet",slug:"meadowsweet-williamsburg",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"American (New)",summary:"At Williamsburg's modern, chic Meadowsweet, executive chef Polo Dobkin has a deft touch with seasonal ingredients, crafting dishes with a Mediterranean bent.",website:"https://www.meadowsweetnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/212sRbfQWYvp77bHAlfBvg/c1008ff3b479aafb5780dae41a675397/Meadowseet-Brooklyn-NYC-Photo-Evan-Sung.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"141328",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39020-Meadowsweet-menu.pdf",primary_location:"Williamsburg",address:"149 Broadway, Brooklyn, NY 11211",latitude:40.7104217,longitude:-73.9631268,telephone:"(718)3840673",price_range:"$",facebook_url:"https://www.facebook.com/meadowsweetnyc",instagram_url:"https://instagram.com/meadowsweetnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Gallery",slug:"the-gallery",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Japanese / Sushi",summary:"Enjoy artwork alongside delicious culinary creations and original cocktails at The Gallery, a new cultural space in the Flatiron District from chef Hiroki Odo.",website:"https://www.odogallery.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/62SYKeVtqVD3Ysp65i03vp/fa7b8682bbe32bd6e250e560a2fafb3b/the_gallery.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1246903",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45551-Gallery-menu.pdf",primary_location:"Flatiron District",address:"17 W. 20th St., Manhattan, NY 10011",latitude:40.7403982,longitude:-73.9921624,telephone:"(646)8700383",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/the.gallery.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Parlour Room",slug:"the-parlour-room",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"American (New)",summary:"The Parlour Room Bar and Grill is a classic American restaurant nestled near Herald Square that also features a collection of 450 of the world’s finest whiskeys.",website:"https://www.parlourroomnyc.com/?y_source=1_MTAwNDExNTY3Ny03MTUtbG9jYXRpb24ud2Vic2l0ZQ%3D%3D",image_url:"//images.ctfassets.net/1aemqu6a6t65/4MtCyM7C3QfI3z2dFr1wg/c6a72a8440a8554a889fc52b52c9000c/The-Parlour-Room-Manhattan-NYC-Photo-Noah-Fecks.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"15709",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49039-ParlourRoom-menu.pdf",primary_location:"Herald Square",address:"70 W. 36th St., Manhattan, NY 10018",latitude:40.7506112,longitude:-73.9862911,telephone:"(917)2615495",price_range:"$",facebook_url:"https://www.facebook.com/parlourroomnyc",instagram_url:"https://instagram.com/parlourroom.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hearth",slug:"hearth",borough:"Manhattan",neighborhood:"East Village",cuisine:"Italian",summary:"Hearth is everything its name implies...a warm, comfortable restaurant with hospitality as its goal.",website:"https://www.restauranthearth.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/F5RsCtW1gdTi9BmfQdGZU/5a447585724d2c77ea31eabac241519a/Hearth-Manhattan-NYC-Photo-Daniel-Krieger.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38974-Hearth-menu.pdf",primary_location:"East Village",address:"403 E. 12th St., Manhattan, NY 10009",latitude:40.7300263,longitude:-73.9831883,telephone:"(646)6021300",price_range:"$",facebook_url:"https://www.facebook.com/HearthNYC",instagram_url:"https://instagram.com/hearthrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Crave Fishbar - Upper West Side",slug:"crave-fishbar-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Seafood",summary:"Crave Fishbar—NYC’s first 100% sustainable seafood restaurant—is home to the #Oystergram Happy Hour, one of NYC’s best oyster happy hour deals.",website:"https://cravefishbar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/22eDyayaZK7ZdKso26ekZk/13f0f542da628df4ef33bb3ffc261c85/CRAVE-9847_A1E3A834-A62B-4702-8F759CC3B9FB651F_706ac90e-dabd-4f5c-84abffec68075183.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"190753",menu_url:"",primary_location:"Upper West Side",address:"428 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7842654,longitude:-73.9778134,telephone:"(646)4942750",price_range:"$",facebook_url:"https://www.facebook.com/cravefishbar",instagram_url:"https://instagram.com/cravefishbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Marchande",slug:"la-marchande",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"French",summary:"La Marchande is chef John Fraser’s modernized take on the French brasserie, set in The Wall Street Hotel.",website:"https://www.lamarchandenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3Tq7UIEKmzgjGh8F4mfdYv/676a6b113ca0ab7dd3341664f902d3ea/La-Marchande-Interior-Manhattan-NYC-Photo-Courtesy-La-Marchande__1___1_.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1242889",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47797-LaMarchande-menu.pdf",primary_location:"Lower Manhattan",address:"The Wall Street Hotel, 88 Wall St., 10005 Manhattan",latitude:40.7055706,longitude:-74.007662,telephone:"(212)8372089",price_range:"$",facebook_url:"https://www.facebook.com/LaMarchandeNewYork",instagram_url:"https://instagram.com/lamarchandenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosemary's Midtown",slug:"rosemarys-midtown",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Italian",summary:"The beloved West Village institution comes to Midtown with another sun-filled dining room, large sidewalk cafe, beautiful private dining room, spacious bar and wine bar.",website:"https://www.rosemarysnyc.com/location/rosemarys-midtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/7fKY0Ha6qjcitKZkkCFoW4/9ca32f105cd1ccc7c65882ff8ff38930/Rosemary-s-Midtown-Manhattan-NYC-Photo-Daniel-Krieger.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1401259",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49024-Rosemary%27sMidtown-menu.pdf",primary_location:"Midtown East",address:"825 Third Ave., Manhattan, NY 10022",latitude:40.7558722,longitude:-73.9701462,telephone:"(646)8685335",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/rosemarysnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Steak Frites Bistro",slug:"steak-frites-bistro",borough:"Manhattan",neighborhood:"Garment District",cuisine:"French",summary:"Chef/owner Adam Schop brings classic French fare, in an environment familiar to popular bistros found on the side streets of Paris, to Hell’s Kitchen.",website:"https://www.steakfritesbistro.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/36Uth5SPYnMMCgrosJeWtw/6384c5e3f474b2fd2a622e8524258a63/Steak-Frites-Bistro-Manhattan-NYC-Photo-Steve-Hill__1___1_.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47957-SteakFritesBistro-menu.pdf",primary_location:"Garment District",address:"496 Ninth Ave., Manhattan, NY 10018",latitude:40.7555944,longitude:-73.9943859,telephone:"(929)6145070",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/steakfritesbistro",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Lore",slug:"lore",borough:"Brooklyn",neighborhood:"South Slope",cuisine:"Eclectic",summary:"Lore is a seasonal restaurant located in the South Slope neighborhood in Brooklyn.",website:"https://www.lorebrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6WWobEROWi1OkGHJJkIgX7/2e92a434bded8789c50bd122dae596ff/Lore-Brooklyn-NYC-Photo-Sukhbir-Channa.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46635-Lore-menu.pdf",primary_location:"South Slope",address:"441 7th Ave., Brooklyn, NY 11215",latitude:40.663082,longitude:-73.9844024,telephone:"(347)5990300",price_range:"$",facebook_url:"https://www.facebook.com/LOREBrooklyn",instagram_url:"https://instagram.com/lore.brooklyn",michelin_award:"BIB_GOURMAND",michelin_slug:"lore",nyttop100_rank:""},{name:"Oceana",slug:"oceana",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Seafood",summary:"A beloved dining destination since 1992, Oceana is renowned for exceptional hospitality, an award-winning wine list, and world-class cuisine.",website:"https://www.oceanarestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7vq6woXOV5q9JNSDIIe9IW/7d38de2bd7b4c2b7655b33af34fe26fe/Oceana-Restaurant-Manhattan-NYC-Photo-Liz-Clayman-2.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"178",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/11776-Oceana-menu.pdf",primary_location:"Midtown West",address:"120 W. 49th St., Manhattan, NY 10020",latitude:40.7597437,longitude:-73.982321,telephone:"(212)7595941",price_range:"$",facebook_url:"https://www.facebook.com/Oceananyc",instagram_url:"https://instagram.com/oceanaNYC",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sofrito on the Hudson",slug:"sofrito-on-the-hudson",borough:"Manhattan",neighborhood:"Hamilton Heights",cuisine:"Puerto Rican",summary:"Throw back a mojito in the dimly lit bar and savor authentic and affordable Latin American cuisine.",website:"https://sofritony.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3tlEabnh9Wg82MgQVrst2Z/a00317acea9fd962a433ded94d07c1ed/Sofrito-on-the-Hudson-Manhattan-NYC-Photo-Jen-Davis.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"82576",menu_url:"",primary_location:"Hamilton Heights",address:"Riverbank State Park, 679 Riverside Dr. (enter at 145th St.), 10031 Manhattan",latitude:40.8264236,longitude:-73.9559555,telephone:"(212)7545999",price_range:"$",facebook_url:"https://www.facebook.com/sofritonyc",instagram_url:"https://instagram.com/Sofritonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Girasole Trattoria",slug:"girasole-trattoria",borough:"Manhattan",neighborhood:"East Harlem",cuisine:"Italian",summary:"The Belgian-Brazilian couple behind Mojo Mousse Bar brings this Brazilian-inspired cocktail bar to El Barrio.",website:"https://bargoyana.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/75wgVS2XSYTaVEWK2iCZ4s/d5754fc7e0c674289a88e4247cdf3f6c/Girasole-Trattoria-Manhattan-NYC-Courtesy-4.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45945-GirasoleTrattoria-menu.pdf",primary_location:"East Harlem",address:"177 E. 100th St., Manhattan, NY 10029",latitude:40.7883604,longitude:-73.9486555,telephone:"(917)2134480",price_range:"$",facebook_url:"https://www.facebook.com/bargoyana",instagram_url:"https://instagram.com/bargoyana",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"abcV",slug:"abcv",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"American (New)",summary:"Jean-Georges Vongerichten performs magic with vegetables.",website:"https://www.abcv.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/5ITZ4m2IrkMadziqzwrnsF/34ec4dfba901916ed4a67e4270ccbd04/chia_pudding.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1374229",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40425-abcV-menu.pdf",primary_location:"Flatiron District",address:"38 E. 19th St., Manhattan, NY 10003",latitude:40.7379868,longitude:-73.9892758,telephone:"(212)4755829",price_range:"$",facebook_url:"https://www.facebook.com/abcvnyc",instagram_url:"https://instagram.com/abcVnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"French Louie",slug:"french-louie",borough:"Brooklyn",neighborhood:"Boerum Hill",cuisine:"French",summary:"French Louie is a modern French-American bistro from the team behind Buttermilk Channel.",website:"https://frenchlouienyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/48S3oQqKyEkfX6gK7HqNbO/98ef238a9d95a1ce584673adfe6f022b/compressed-french_louie_bar_7c173295-5056-a36f-23f9855d1134f406.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39050-FrenchLouie-menu.pdf",primary_location:"Boerum Hill",address:"320 Atlantic Ave., Brooklyn, NY 11201",latitude:40.6880635,longitude:-73.988177,telephone:"(718)9351200",price_range:"$",facebook_url:"https://www.facebook.com/frenchlouienyc",instagram_url:"https://instagram.com/frenchlouienyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sarabeth's Upper West Side",slug:"sarabeths-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (New)",summary:"Established just across the street from the very first Sarabeth's location, Sarabeth's Upper West Side has been a neighborhood staple serving breakfast, lunch, brunch and dinner seven days a week for nearly 30 years.",website:"https://sarabethsrestaurants.com/locations/upper-west-side",image_url:"//images.ctfassets.net/1aemqu6a6t65/4lubHDLXP64Z4mSazd4OHa/d29ba42c967139155b36809eadbfb7d7/sarabeths-uws-janine-giesick-5921.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"36058",menu_url:"",primary_location:"Upper West Side",address:"423 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7838797,longitude:-73.9774244,telephone:"(212)4966280",price_range:"$",facebook_url:"https://www.facebook.com/Sarabeths-West",instagram_url:"https://instagram.com/sarabethsnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Muteki Udon",slug:"muteki-udon",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Japanese / Sushi",summary:"Visit this Park Slope restaurant for an unforgettable dining experience, with homemade udon noodles crafted from the finest ingredients and complemented by a selection of Japanese sakes and beers. ",website:"https://mutekiudon.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/CCK76EKF537gB1I4hzzy4/eb15fe42ee9f6cdc6f9a84431175d354/Muteki-Udon-Manhattan-NYC-Photo-Courtesy-1.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49813-MutekiUdon-menu.pdf",primary_location:"Park Slope",address:"234 Flatbush Ave., Brooklyn, NY 11217",latitude:40.6803718,longitude:-73.9751397,telephone:"(917)6883407",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61556762917630",instagram_url:"https://instagram.com/mutekiudon",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wagamama - Nomad/Flatiron",slug:"wagamama",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Asian Fusion",summary:"Wagamama first opened in London in April of 1992 with a clear purpose: to feed guests fresh and nourishing Asian food inspired by the flavors of Japan.",website:"https://www.wagamama.us/restaurants/nyc-nomad-flatiron",image_url:"//images.ctfassets.net/1aemqu6a6t65/4uzi0cWRjuXbh4slVCXDZe/375a1a046804c15590af7dd961d3d4a2/Wagamama2022October-1827-edited_61F4B69D-2E74-42B8-8D11638608377D4B_150fa559-cd09-4e50-959d043977b7b251.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1008775",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39657-Wagamama-Nomad-Flatiron-menu.pdf",primary_location:"Flatiron District",address:"210 Fifth Ave., Manhattan, NY 10010",latitude:40.7433574,longitude:-73.9887711,telephone:"(212)9206233",price_range:"$",facebook_url:"https://www.facebook.com/wagamamaUSA",instagram_url:"https://instagram.com/wagamamausa",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Reyna",slug:"reyna",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Mediterranean",summary:"Reyna is an alluring Mediterranean tapas restaurant and cocktail bar nestled in Union Square.",website:"https://www.reynanewyork.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4DiPzYIQUxvKnfsXs60FeA/940d0a9394c588a8b70fd52b83abd04d/Reyna-Manhattan-NYC-Photo-Coyrtesy-Reyna.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"1254664",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48008-Reyna-menu.pdf",primary_location:"Union Square",address:"11 E. 13th St., Manhattan, NY 10003",latitude:40.735079,longitude:-73.9931549,telephone:"(917)2591300",price_range:"$",facebook_url:"https://www.facebook.com/reyna.newyork",instagram_url:"https://instagram.com/reyna.newyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kellari Taverna",slug:"kellari-taverna",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Greek",summary:"Located in Midtown Manhattan near the Theatre District, Kellari features traditional Greek cuisine, as well as the largest selection of Greek wines in any restaurant in the United States.",website:"https://kellariny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7qXOQODuc3W87j42VZKMDn/d353f8cade6f73a013171113a24c622e/kellari-taverna-fish-display.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"5923",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/28430-KellariTaverna-menu.pdf",primary_location:"Midtown West",address:"19 W. 44th St., Manhattan, NY 10036",latitude:40.7555245,longitude:-73.980845,telephone:"(212)2210144",price_range:"$",facebook_url:"https://www.facebook.com/KellariNY",instagram_url:"https://instagram.com/KellariNY",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Roey's",slug:"roeys",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"This sister restaurant to West Village mainstay Rosemary’s is an all-day Italian café-bar serving wholesome Italian fare in a casual and sophisticated setting.",website:"https://www.roeysnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6c7BAIM12AaldzBrKX8JmH/b4ddba1dd8ae6594384dda76501f8918/roeys-manhattan-nyc-courtesy__1___1_.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45428-Roey%27s-menu.pdf",primary_location:"West Village",address:"1 Perry St., Manhattan, NY 10014",latitude:40.7359857,longitude:-74.0009892,telephone:"(646)8641200",price_range:"$",facebook_url:"https://www.facebook.com/rosemaryspizza",instagram_url:"https://instagram.com/roeysnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Naks",slug:"naks",borough:"Manhattan",neighborhood:"East Village",cuisine:null,summary:"Naks by Unapologetic Foods offers a gastronomic tour of the Philippines framed by the personal memories of the restaurant’s chef, Eric Valdez.",website:"https://www.naks.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/57BmTa8rQ9ZvzV5IZzK0by/0f6134353f23bf7ce614910695fc9a75/Naks-Manhattan-NYC-Photo-Pau-McDonough-3.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49247-Naks-menu.pdf",primary_location:"East Village",address:"201 First Ave., Manhattan, NY 10003",latitude:40.7303138,longitude:-73.98363,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ai Fiori",slug:"ai-fiori",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Italian",summary:"The Langham, New York, Fifth Avenue’s signature restaurant celebrates cuisine from the Italian and French Riviera.",website:"https://aifiorinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/41iDI6sfj49EzS5zca3NrJ/cce64a4528da8c07f725f6138a1b1b66/_ai-fiori-courtesy-altamarea-group-07.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown West",address:"The Langham, New York, 400 Fifth Ave. Fifth Avenue",latitude:40.7501833,longitude:-73.983759,telephone:"(212)6138660",price_range:"$",facebook_url:"https://www.facebook.com/AiFiori",instagram_url:"https://instagram.com/AiFiori",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Riverpark",slug:"riverpark",borough:"Manhattan",neighborhood:"Kips Bay",cuisine:"American (New)",summary:"Enjoy the seasonally inspired, seafood-forward, New American cuisine with some of the best waterfront views NYC has to offer.",website:"https://riverparknyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7JgnNnvv8TkoY7arvApLq8/5242506984d46959a4a8f28443f97c24/Riverpark-Mahattan-NYC-Photo-Courtesy-Riverpark.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36117-Riverpark-menu.pdf",primary_location:"Kips Bay",address:"Alexandria Center, 450 E. 29th St., 10016 Manhattan",latitude:40.7396,longitude:-73.9739,telephone:"(212)7064131",price_range:"$",facebook_url:"https://www.facebook.com/riverparknyc",instagram_url:"https://instagram.com/riverparknyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Stout NYC Penn Station",slug:"stout-nyc-penn-station",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"American (Traditional)",summary:"The first Stout NYC location is comprised of 3-stories, over 16,000 square feet of space and multiple private party rooms.",website:"https://www.stoutnyc.com/location/stout-nyc-penn-station",image_url:"//images.ctfassets.net/1aemqu6a6t65/62ETRmv6PlMKxOgQfToPmH/e565a0f227efbb7aa6df0a33997ba046/Stout-NYC-Manhattan-NYC-Photo-Angelito-Jusay-Virten-Media.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46498-StoutNYCPennStation-menu.pdf",primary_location:"Herald Square",address:"133 W. 33rd St., Manhattan, NY 10001",latitude:40.7499664,longitude:-73.9898656,telephone:"(212)6296191",price_range:"$",facebook_url:"https://www.facebook.com/StoutNYCFlagship",instagram_url:"https://instagram.com/stout_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Empellón",slug:"empellon",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Mexican",summary:"Alex Stupak’s Midtown flagship is a warm and inviting venue with an extensive agave program and inventive menu.",website:"https://www.empellon.com/restaurants/empellon",image_url:"//images.ctfassets.net/1aemqu6a6t65/QaQIPl8lVB3bqY203mSSd/c6b576197998d63bcb6d6761d11e4177/EmpelloÌ_n-Manhattan-NYC-Photo-Evan-Sung-4.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"729934",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40491-Empellon-menu.pdf",primary_location:"Midtown East",address:"510 Madison Ave., Manhattan, NY 10022",latitude:40.7596933,longitude:-73.9745729,telephone:"(212)8589365",price_range:"$",facebook_url:"https://www.facebook.com/pg/EmpellonRestaurant",instagram_url:"https://instagram.com/empellon",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mable's Smokehouse and Banquet Hall",slug:"mables-smokehouse-williamsburg",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Barbecue",summary:"Smoky brisket, pulled pork and St. Louis–style ribs taste authentic and won't set you back too much.",website:"https://mablessmokehouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5uNYFfdjaq2CFCIdkprVW/de31ab86e87ce47bbee886b2291aea28/Mable-s-Smokehouse-Brooklyn-NYC-Photo-Meghan-Love.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"",menu_url:"",primary_location:"Williamsburg",address:"44 Berry St., Brooklyn, NY 11249",latitude:40.7211069,longitude:-73.9565362,telephone:"(718)2186655",price_range:"$",facebook_url:"https://www.facebook.com/MablesBrooklyn",instagram_url:"https://instagram.com/mables_smokehouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Maison Pickle",slug:"maison-pickle",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (Traditional)",summary:"Maison Pickle offers Continental classics and that iconic American sandwich, the French Dip, in a refined and relaxed setting for food and drink.",website:"https://www.maisonpickle.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/69AuYnrWHUS2kGGUCy0Xxc/7d2baeff3d8d8e0a786776c5bc92467c/maison-pickle-upper-west-side-manhattan-nyc-mp_bar_atmosphere2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41039-MaisonPickle-menu.pdf",primary_location:"Upper West Side",address:"2315 Broadway, Manhattan, NY 10024",latitude:40.7870473,longitude:-73.9781361,telephone:"(212)4969100",price_range:"$",facebook_url:"https://www.facebook.com/maisonpickle",instagram_url:"https://instagram.com/maisonpickle",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Loring Place",slug:"loring-place",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"American (New)",summary:"Loring Place offers seasonal, local, American cuisine by Chef Dan Kluger in the heart of Greenwich Village.",website:"https://www.loringplacenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/CwPhSVwIprep1DtD1MpUG/be35fdf883c23e97a07a7cf84c94a77b/rw-to-go_loring-place_df7184bd-5056-a36f-23bcd9384c783889-df7183565056a36_df718514-5056-a36f-2363abc1920533d4.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Greenwich Village",address:"21 W. 8th St., Manhattan, NY 10011",latitude:40.732976,longitude:-73.9974616,telephone:"(212)3881831",price_range:"$",facebook_url:"https://www.facebook.com/loringplacenyc",instagram_url:"https://instagram.com/loringplacenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Rock",slug:"le-rock",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"French",summary:"Le Rock is a bustling French Brasserie that serves traditional French fare alongside some more unexpected offerings.",website:"https://www.lerocknyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7glplvqCL0VeY22WtygEMx/047b9204878f0638c4e68009f8561d30/Le-Rock-Manhattan-NYC-Photo-Carl-Timphone.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"1208293",menu_url:"",primary_location:"Midtown West",address:"45 Rockefeller Plaza, Manhattan, NY 10011",latitude:40.7594164,longitude:-73.9778147,telephone:"(332)2588734",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lerocknyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"T. Brasserie",slug:"t-brasserie-at-tin-building-by-jean-georges",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"French",summary:"T. Brasserie serves timeless French fare using only the finest and freshest ingredients from breakfast through dinner.",website:"https://www.tinbuilding.com/restaurants-and-bars/t-brasserie",image_url:"//images.ctfassets.net/1aemqu6a6t65/2zVD6u0c2akXU3UTVt4yw3/3c17c11928d3112d1e3beaa37ae2637d/T-Brasserie-Seaport-Manhattan-NYC-Photo-Courtesy-The-Seaport-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47951-T.BrasserieatTinBuildingbyJean-Georges-menu.pdf",primary_location:"The Seaport",address:"96 South St., Manhattan, NY 10038",latitude:40.7062323,longitude:-74.0022681,telephone:"(888)7770942",price_range:"$",facebook_url:"https://www.facebook.com/TinBuildingNYC",instagram_url:"https://instagram.com/tinbuilding",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Carne Mare",slug:"carne-mare",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"Steakhouse",summary:"Carne Mare is an Italian chophouse by chef Andrew Carmellini offering prime cuts of steaks, fine seafood and Italian specialties.",website:"https://www.carnemare.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4Rug9uQbuGiA3nEIO5TMlG/004011f5b4af65356d7d464ea07cc9ac/carne-mare-courtesy.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45784-CarneMare-menu.pdf",primary_location:"The Seaport",address:"Pier 17, 89 South St., 10038 Manhattan",latitude:40.705573,longitude:-74.0014567,telephone:"(212)2804600",price_range:"$",facebook_url:"https://www.facebook.com/CarneMareNYC",instagram_url:"https://instagram.com/carnemare",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nonna Dora's",slug:"nonna-doras",borough:"Manhattan",neighborhood:"Kips Bay",cuisine:"Italian",summary:"Nonna Dora's is an Italian restaurant and pasta bar in Kips Bay serving fresh pasta made daily by Nonna herself.",website:"https://www.nonnadoras.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4txrEC9ZB1O40aJkW6T8UX/9226ebee6c8a60c39a2ab42cb22aa7fc/Nonna-Doras-Manhattan-NYC-Photo-Nonna-Doras.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Kips Bay",address:"606 Second Ave., Manhattan, NY 10016",latitude:40.7442128,longitude:-73.9757457,telephone:"(917)2616544",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/nonnadorasnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nougatine at Jean-Georges",slug:"nougatine-at-jean-georges",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"American (New)",summary:"Perhaps the best way to sample dishes from one of world-famous chef Jean-Georges Vongerichten's menus without breaking the bank is by dining at Nougatine, an overlooked gem on the Upper West Side.",website:"https://www.jean-georgesrestaurant.com/nougatine-and-terrace-at-jean-georges",image_url:"//images.ctfassets.net/1aemqu6a6t65/2i0u6Gf8LpcFmxVp4CWeg5/aa37bea2b5206db42968711b44f6f3c7/_nougatine-at-jean-georges-francesco-tonelli-05.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/20931-NougatineatJean-Georges-menu.pdf",primary_location:"Upper West Side",address:"1 Central Park West, Manhattan, NY 10023",latitude:40.7690255,longitude:-73.9816255,telephone:"(212)2993900",price_range:"$",facebook_url:"https://www.facebook.com/JeanGeorgesRestaurant.NYC",instagram_url:"https://instagram.com/nougatinenyc",michelin_award:"TWO_STARS",michelin_slug:"jean-georges",nyttop100_rank:55},{name:"Lele's Roman",slug:"leles-roman",borough:"Brooklyn",neighborhood:"Boerum Hill",cuisine:"Italian",summary:"Inspired by the lively neighborhood of Trastevere, Lele’s Roman brings a fresh take on Roman cuisine to Brooklyn's Boerum Hill neighborhood. ",website:"https://www.lelesroman.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5MI7b2ZiAnjaLOhcyKWIRu/60f3bcc7b9a425a40a76fbd622c06c3b/Lele-s-Roman-Brooklyn-NYC-Photo-Melissa-Hom.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Boerum Hill",address:"Ace Hotel Brooklyn, 252 Schermerhorn St., 11217 Brooklyn",latitude:40.6878373,longitude:-73.983725,telephone:"(718)3083608",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lelesroman",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Isabelle's Osteria",slug:"isabelles-osteria",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Italian",summary:"Isabelle’s Italian menu adds unusual touches to traditional appetizers and entrees.",website:"https://isabellesnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7fMV4crotpEItLeFnNSPy5/eee50c9c8962f00940a12dc4068e94c4/rw-to-go_isabelle-s-osteria_b7b8c148-5056-a36f-23f4d255b3767bc3-b7b8c0065056a36_b7b8c19b-5056-a36f-23407696f74795fb__1_.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"335782",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40038-Isabelle%27sOsteria-menu.pdf",primary_location:"Gramercy",address:"245 Park Ave. South, Manhattan, NY 10003",latitude:40.7379741,longitude:-73.9876775,telephone:"(212)3881145",price_range:"$",facebook_url:"https://www.facebook.com/isabellesnyc",instagram_url:"https://instagram.com/isabellesnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rampoldi",slug:"rampoldi",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"French",summary:"Rampoldi is an institution and a symbol of Monte Carlo, and this first New York location near Lincoln Center offers the same feel and menu as its original location. ",website:"https://rampoldirestaurant.com/#contentblock-2",image_url:"//images.ctfassets.net/1aemqu6a6t65/6blvUJ7ApeD3H2q8tuzp1t/99a788065c558b7db5ec28250071f0cf/Rampoldi-NYC-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1352260",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49149-Rampoldi-menu.pdf",primary_location:"Upper West Side",address:"49 W. 64th St., Manhattan, NY 10023",latitude:40.7720947,longitude:-73.9813502,telephone:"(212)7991000",price_range:"$",facebook_url:"https://www.facebook.com/people/Rampoldi-NYC/61550912914438",instagram_url:"https://instagram.com/rampoldinewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gran Morsi",slug:"gran-morsi",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"Italian",summary:'Gran Morsi, named after the Italian word for "bites" epitomizes elegant simplicity.',website:"https://www.granmorsi.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4dECuYj6o3MmcD2fKXdcEl/a260cd543660da4a3411c2f1db2d9e8b/morsiinterior_1_october03_2014.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"151951",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38779-GranMorsi-menu.pdf",primary_location:"Tribeca",address:"22 Warren St., Manhattan, NY 10007",latitude:40.7143138,longitude:-74.0077763,telephone:"(212)5772725",price_range:"$",facebook_url:"https://www.facebook.com/granmorsi",instagram_url:"https://instagram.com/granmorsi",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Fandi Mata",slug:"fandi-mata",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Mediterranean",summary:"Fandi Mata delivers a new take on artisinal, global cuisine inspired by the vast Mediterranean region, featuring classics with a contemporary touch.",website:"https://www.fandimata.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3N0nLRzOKGYXNTyJpZeN2f/e6dc8fda62bb797241c9fd3341af3633/DSC07921_4862A83F-C5A8-43F8-8AAE7E6468731E6B_c29b8a70-e15a-4919-b0c5cae4023328a4.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1162696",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46443-FandiMata-menu.pdf",primary_location:"Williamsburg",address:"74 Bayard St., Brooklyn, NY 11222",latitude:40.7188471,longitude:-73.9492531,telephone:"(718)3888877",price_range:"$",facebook_url:"https://www.facebook.com/fandimatabklyn",instagram_url:"https://instagram.com/fandimatabklyn",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Indochine",slug:"indochine",borough:"Manhattan",neighborhood:"Noho",cuisine:"Vietnamese",summary:"French-Vietnamese cuisine is served in this perennial hot spot.",website:"https://www.indochinenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4mJMx9XygWYnPCx3I1T0eD/48b7e523a51bacda8d5cb480a6657aec/indochine-noho-manhattan-nyc-46581snapper.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/9328-Indochine-menu.pdf",primary_location:"Noho",address:"430 Lafayette St., Manhattan, NY 10003",latitude:40.729286,longitude:-73.9924838,telephone:"(212)5055111",price_range:"$",facebook_url:"https://www.facebook.com/IndochineNY",instagram_url:"https://instagram.com/indochinenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tanoreen",slug:"tanoreen",borough:"Brooklyn",neighborhood:"Bay Ridge",cuisine:"Middle Eastern",summary:"Many are willing to travel far for food this good.",website:"https://tanoreen.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5YOXRmSnccoGGZf7OdPn5b/a015ae50296660e4bb5dd319e6012e17/tanoreen-kate-glicksberg-0462.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Bay Ridge",address:"7523 Third Ave., Brooklyn, NY 11209",latitude:40.6307916,longitude:-74.0277865,telephone:"(718)7485600",price_range:"$",facebook_url:"https://www.facebook.com/tanoreen",instagram_url:"https://instagram.com/tanoreen",michelin_award:"BIB_GOURMAND",michelin_slug:"tanoreen",nyttop100_rank:""},{name:"Il Nonno",slug:"il-nonno",borough:"Queens",neighborhood:"Astoria",cuisine:"Italian",summary:"The folks at Il Nonno, an Italian restaurant in Astoria, Queens, are passionate about creating a memorable dining experience for every guest. ",website:"https://www.ilnonnonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3TrbT2IaC3ylb45M1v21CH/101db820858a446d95c4744c91a7dc19/Il-Nonno-Ristorante-Queens-NYC-Photo-Jessenia-Perez-2.jpg",meal_types:["$45 Dinner Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49778-IlNonno-menu.pdf",primary_location:"Astoria",address:"25-17 Astoria Blvd., Queens, NY 11102",latitude:40.7713439,longitude:-73.922144,telephone:"(347)8080087",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61557578788657",instagram_url:"https://instagram.com/ilnonnonewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Estiatorio Milos",slug:"estiatorio-milos",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Seafood",summary:"Pristine Mediterranean-style seafood shines in an industrial-chic Midtown setting at Milos.",website:"https://www.estiatoriomilos.com/restaurant/nymidtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/71PdIlzuzuLlJI96jWFas7/3ce0bf92590afc0ea0f4234d2466f4b7/greek-salad_6dc46d14-78c6-4f46-8905d56b4b9f4ea3_60184522-daed-40ef-964bf4ab2a5b4b0b.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1973",menu_url:"",primary_location:"Midtown West",address:"125 W. 55th St., Manhattan, NY 10019",latitude:40.763598,longitude:-73.9789514,telephone:"(212)2457400",price_range:"$",facebook_url:"https://www.facebook.com/estiatoriomilosofficial",instagram_url:"https://instagram.com/estiatoriomilos",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Rosa Mexicano - Union Square",slug:"rosa-mexicano-union-square",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Mexican",summary:"Setting a standard in authentic Mexican cooking since opening its doors, Rosa Mexicano now has three locations throughout NYC.",website:"https://rosamexicano.com/location/union-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/4WKMDHKPsNN3FdgCETOHNU/d968a6d413cf0022ca2045303c7a02be/rosa-mexicana-union-square-courtesy-01.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"4946",menu_url:"",primary_location:"Union Square",address:"9 E. 18th St., Manhattan, NY 10003",latitude:40.7383338,longitude:-73.9907684,telephone:"(212)5333350",price_range:"$",facebook_url:"https://www.facebook.com/rosamexicano",instagram_url:"https://instagram.com/RosaMexicano",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Momofuku Noodle Bar",slug:"noodle-bar-east-village",borough:"Manhattan",neighborhood:"East Village",cuisine:"Asian Fusion",summary:`David Chang’s original Korean-American sensation.
`,website:"https://momofukunoodlebar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6Eu20LGGqomCZLNFSVXiVh/6530907640ff0438052d69e46ec5a83f/ginger-scallion-noodles-pickled-shiitakes-cucumber-cabbage.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1392934",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44128-NoodleBar-EastVillage-menu.pdf",primary_location:"East Village",address:"171 First Ave., Manhattan, NY 10003",latitude:40.729233,longitude:-73.98451,price_range:"$",facebook_url:"https://www.facebook.com/luckypeach",instagram_url:"https://instagram.com/momolongplay",michelin_award:"BIB_GOURMAND",michelin_slug:"momofuku-noodle-bar",nyttop100_rank:""},{name:"Le Pavillon",slug:"le-pavillon",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"French",summary:"Le Pavillon expresses chef Daniel Boulud’s roots in New York City with a fresh and unique approach to fine dining in a dramatic setting.",website:"https://lepavillonnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4ekXOyUKKub0NfgiCjFl82/f7106fd2d0cf53b11216db6a2c927452/La-Pavillon-Manhattan-NYC-Photo-Todd-Coleman-1.jpg",meal_types:["$60 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45628-LePavillon-menu.pdf",primary_location:"Midtown East",address:"1 Vanderbilt Ave., Manhattan, NY 10017",latitude:40.7530356,longitude:-73.9785114,telephone:"(212)6621000",price_range:"$",facebook_url:"https://www.facebook.com/lepavillonnewyork",instagram_url:"https://instagram.com/lepavillonnyc",michelin_award:"ONE_STAR",michelin_slug:"le-pavillon-1192744",nyttop100_rank:""},{name:"Fish Cheeks",slug:"fish-cheeks",borough:"Manhattan",neighborhood:"Noho",cuisine:"Thai",summary:"Family-style Thai seafood and great cocktails in NoHo.",website:"https://www.fishcheeksnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3BUOqbEU3tbK6u5WjALV35/bf5d2f51794f82093ba417c7dfea4b7e/RW-To-Go_Fish-Cheeks_4D645DC4-5056-A36F-23982D892D6C803E-4d645c895056a36_4d645e2b-5056-a36f-23fda4ecc4cc5721.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"",menu_url:"",primary_location:"Noho",address:"55 Bond St., Manhattan, NY 10012",latitude:40.7256763,longitude:-73.9926822,telephone:"(212)6772223",price_range:"$",facebook_url:"https://www.facebook.com/fishcheeksnyc",instagram_url:"https://instagram.com/fishcheeksnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Queensboro",slug:"the-queensboro",borough:"Queens",neighborhood:"Jackson Heights",cuisine:"American (Traditional)",summary:"This modern, spacious American restaurant also has a great cocktail list.",website:"https://www.thequeensboro.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6aeF2t0Dp3UPUtsTEJNJdF/e763a6d8093b3c6e083e0176b1215397/queensboro-jackson-heights-queens-nyc-queensboro-fall-2018-cocktails_9.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44560-Queensboro-menu.pdf",primary_location:"Jackson Heights",address:"80-02 Northern Blvd., Queens, NY 11372",latitude:40.755152,longitude:-73.8869912,telephone:"(929)2960038",price_range:"$",facebook_url:"https://www.facebook.com/thequeensboro",instagram_url:"https://instagram.com/thequeensboro",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Industry Kitchen",slug:"industry-kitchen",borough:"Manhattan",neighborhood:"The Seaport",cuisine:"American (New)",summary:"Industry Kitchen serves simply prepared modern American dishes with views of the Brooklyn and Manhattan Bridges and Brooklyn skyline. ",website:"https://www.industry-kitchen.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/YyHowDAwR2pzZapzp7eqa/e51ead59b65529712aaa9e5882a0bbf6/Industry-Kitchen-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"161413",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/42604-IndustryKitchen-menu.pdf",primary_location:"The Seaport",address:"70 South St., Manhattan, NY 10038",latitude:40.7051725,longitude:-74.0053083,telephone:"(212)4879600",price_range:"$",facebook_url:"https://www.facebook.com/industrykitchennyc",instagram_url:"https://instagram.com/industrykitchen",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Alice",slug:"alice",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Alice is a sophisticated, intimate Italian seafood and lobster bar set in the basement of a historic brownstone.",website:"https://alicenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/621crVhA5nH1wL0rn95jLE/af6bd1775139b69e72b855509de7b2fe/Alice-Manhattan-NYC-Photo-Emanuele-Nigro.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/24275-Alice-menu.pdf",primary_location:"West Village",address:"126 W. 13th St., Manhattan, NY 10011",latitude:40.7370456,longitude:-73.9986702,telephone:"(212)6914886",price_range:"$",facebook_url:"https://www.facebook.com/Alicerestaurantnyc",instagram_url:"https://instagram.com/alicerestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Golden K Burgers",slug:"golden-k-burgers",borough:"Queens",neighborhood:"Bayside",cuisine:"American (Traditional)",summary:"This cozy, Korean-American family-owned restaurant offers a diverse selection of beef, veggie, seafood, and chicken burgers, each served with a side of crispy fries, pepperoncini, and pickles.",website:"https://www.goldenkburgersnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7uy6Q4SB1HGEoM5WwXyTx5/46446f8ce5ec1192297ac995d3d553c0/Golden-K-Burgers-Queens-NYC-Photo-Julian-Bracero-1.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49760-GoldenKBurgers-menu.pdf",primary_location:"Bayside",address:"40-17 Bell Blvd., Queens, NY 11361",latitude:40.763825,longitude:-73.7708288,telephone:"(718)8198186",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61561145482303",instagram_url:"https://instagram.com/goldenkburgers",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Del Frisco's Grille",slug:"del-friscos-grille",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Located near Radio City and Times Square, Del Frisco's Grille features a sweeping bar with a wood-burning oven, expansive walls showcasing more than 700 bottles of wine and a sprawling patio perfect for al fresco dining.",website:"https://www.delfriscosgrille.com/location/del-friscos-grille-new-york-ny",image_url:"//images.ctfassets.net/1aemqu6a6t65/6C6BJHLFK0QcK82447Pj7S/dc3da78fb2b4b3aa61816a26e7350ceb/Del-Friscos-Grille-Rockefeller-NYC-Manhattan-NYC-Courtesy-1.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"67849",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36465-DelFrisco%27sGrille-menu.pdf",primary_location:"Midtown West",address:"50 Rockefeller Plaza, Manhattan, NY 10020",latitude:40.7595931,longitude:-73.9782143,telephone:"(212)7670371",price_range:"$",facebook_url:"https://www.facebook.com/pages/Del-Friscos-Grille/195364257252878",instagram_url:"https://instagram.com/dfgrille",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"53",slug:"53",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Pan-Asian",summary:"53 introduces an elevated blend of Asian cuisine with a contemporary edge in a chic lifestyle setting, featuring an exciting rotating installation art program in collaboration with Friedrich Petzel Gallery.",website:"https://53-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2eVMh23LiazJssSAZ3CyoU/33859cfd3f8bf1eae7fd4daa687b9b32/53-Manhattan-NYC-Photo-Altamarea-Group.jpg",meal_types:["$45 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown West",address:"53 W. 53rd St., Manhattan, NY 10019",latitude:40.7641732,longitude:-73.9847405,telephone:"(646)5353994",price_range:"$",facebook_url:"https://www.facebook.com/53nyc",instagram_url:"https://instagram.com/53nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice Montague",slug:"felice-montague",borough:"Brooklyn",neighborhood:"Brooklyn Heights",cuisine:"Italian",summary:"Felice Montague serves classic Italian dishes inspired by the traditional cuisine of the Tuscan countryside.",website:"https://www.felicerestaurants.com/felice-montague",image_url:"//images.ctfassets.net/1aemqu6a6t65/4L3GKNFjFeEoancHUaeyW0/02c5b30302b6aec2a5405c8c355df2ad/Felice-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Brooklyn Heights",address:"84 Montague St., Brooklyn, NY 11201",latitude:40.695172,longitude:-73.9961544,telephone:"(718)4759877",price_range:"$",facebook_url:"https://www.facebook.com/FeliceNewYorkCity",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cafe D'Alsace",slug:"cafe-dalsace",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"French",summary:"Café D'Alsace has been an Upper East Side institution for more than two decades, serving Alsatian cuisine in a uniquely special setting.",website:"https://www.cafedalsace.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/EJUXNDJrmwsHIRUrmX8jd/0725143912f717236feca733cafcc944/Cafe-D-Alsace-Manhattan-NYC-Photo-Courtesy-Chef-Driven-Hospitality-6.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"6363",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/28617-CafeD%27Alsace-menu.pdf",primary_location:"Upper East Side",address:"1703 Second Ave., Manhattan, NY 10128",latitude:40.7794576,longitude:-73.9509299,telephone:"(212)7225133",price_range:"$",facebook_url:"https://www.facebook.com/CafedAlsace",instagram_url:"https://instagram.com/cafedalsacenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"State Grill and Bar",slug:"state-grill-and-bar",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"American (Traditional)",summary:"State Grill and Bar, an elegant addition to the newly renovated Empire State Building, is open for breakfast, lunch and dinner.",website:"https://www.patinagroup.com/state-grill-and-bar",image_url:"//images.ctfassets.net/1aemqu6a6t65/1fbUdusMpd3AkUvWjSUeL6/14bdcd81d9f41cd0641cb95ec1f69b04/state-dining-room.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:[],opentable_id:"150565",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38343-StateGrillandBar-menu.pdf",primary_location:"Herald Square",address:"Empire State Building, 21 W. 33rd St., 10118 Manhattan",latitude:40.7485505,longitude:-73.9859262,telephone:"(212)2169693",price_range:"$",facebook_url:"https://www.facebook.com/stategrillesb",instagram_url:"https://instagram.com/stategrill",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pecora Bianca NoMad",slug:"la-pecora-bianca-nomad",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Italian",summary:"This Italian café restaurant has good energy, with an enthusiastic staff and executive chef Cruz Goler in the open kitchen.",website:"https://www.lapecorabianca.com/location/nomad",image_url:"//images.ctfassets.net/1aemqu6a6t65/3svPQP1sAHCVL2TReWQedq/be8d7a755e920260409876adf3650420/lpb_bar2_brianpark.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Nomad",address:"1133 Broadway, Manhattan, NY 10010",latitude:40.7437839,longitude:-73.9893618,telephone:"(212)4989696",price_range:"$",facebook_url:"https://www.facebook.com/lapecorabiancanyc",instagram_url:"https://instagram.com/lapecorabianca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Strip House Midtown",slug:"strip-house-midtown",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Strip House Midtown brings all the Strip House signatures to a bi-level space on 44th Street that offers lunch, dinner and private dining.",website:"https://www.striphouse.com/location/striphouse-midtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/7IW7l183o1QIZjwgiNzGCY/57c410470881ec218a85904a108a11ca/compressed-strip-house-midtown-manhattan-nyc-striphouse_c8cf17a5-c9f0-4a7b-8fe0bda87aad9e1a_9855ead2-cd6f-4943-98d92803c81c3.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"97504",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37491-StripHouseMidtown-menu.pdf",primary_location:"Midtown West",address:"15 W. 44th St., Manhattan, NY 10036",latitude:40.755344,longitude:-73.9806613,telephone:"(212)3365454",price_range:"$",facebook_url:"https://www.facebook.com/StripHouseSteak",instagram_url:"https://instagram.com/striphouseofficial",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chili",slug:"chili",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Chinese",summary:"Chili specialize in authentic Szechuan cuisine, offering a fiery feast for the senses with traditional dishes like spicy dan dan noodles, mouthwatering mapo tofu, and sizzling dry pots.",website:"https://www.chilinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3bZkvBR5RybE2KrzOgdHJb/f45985269ae9130a9b2307e177f9bf5c/Chili-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Murray Hill",address:"13 E. 37th St., Manhattan, NY 10016",latitude:40.7500175,longitude:-73.9821576,telephone:"(646)8820666",price_range:"$",facebook_url:"https://www.facebook.com/chilinyc",instagram_url:"https://instagram.com/chilimeili",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Meet the Meat",slug:"meet-the-meat",borough:"Queens",neighborhood:"Astoria",cuisine:"Steakhouse",summary:"This highly-regarded steakhouse in Astoria serves prime cuts of meat aged to perfection in a unique way, accompanied by superior customer service.",website:"https://meetthemeat.net",image_url:"//images.ctfassets.net/1aemqu6a6t65/4OBFeysnicOhjcwCfE55BR/c1a6f9eb42db5aa8ddd5e0652b0e5d8d/meetthemeat_astoria_queens_nyc_6-21-5.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"172396",menu_url:"",primary_location:"Astoria",address:"23-92 21st St., Queens, NY 11105",latitude:40.7770481,longitude:-73.9214503,telephone:"(917)8327984",price_range:"$",facebook_url:"https://www.facebook.com/meetthemeatastoria",instagram_url:"https://instagram.com/meetthemeatny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Altesi Downtown",slug:"altesi-downtown",borough:"Manhattan",neighborhood:"Soho",cuisine:"Italian",summary:"You don't have to go all the way to Italy for authentic Tuscan cuisine—just as far as Spring Street.",website:"https://www.altesinyc.com/downtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/3gry1Fj4AjDhwszOFT1j3F/c5b03e37e2b121b63c3271ead8f93ce7/becco-hellskitchen-manhattan-nyc-restaurant-beccoimg_5422.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"4205",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/30900-AltesiDowntown-menu.pdf",primary_location:"Soho",address:"200 Spring St., Manhattan, NY 10012",latitude:40.7250957,longitude:-74.0033108,telephone:"(212)4311212",price_range:"$",facebook_url:"https://www.facebook.com/AltesiDowntown",instagram_url:"https://instagram.com/altesinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Alta Calidad",slug:"alta-calidad",borough:"Brooklyn",neighborhood:"Prospect Heights",cuisine:"Mexican",summary:"Try innovative Mexican fare in Prospect Heights.",website:"https://altacalidadbk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4uGA75oDl6NTvt2Ah3zJQ3/34dcb36d31f22a02ce7d5a0da4c00494/rw-to-go_alta_calidad.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"954982",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44834-AltaCalidad-menu.pdf",primary_location:"Prospect Heights",address:"552 Vanderbilt Ave., Brooklyn, NY 11238",latitude:40.6801383,longitude:-73.9682298,telephone:"(718)6221111",price_range:"$",facebook_url:"https://www.facebook.com/altacalidadBK",instagram_url:"https://instagram.com/altacalidadbk",michelin_award:"BIB_GOURMAND",michelin_slug:"alta-calidad",nyttop100_rank:""},{name:"Kimika",slug:"kimika",borough:"Manhattan",neighborhood:"Nolita",cuisine:"Eclectic",summary:"Kimika is an eclectic meeting point of Japanese and Italian comfort foods that merge in a delightful and satisfying way.",website:"https://www.kimikanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1QooSmamISaM3CfRCYpk0c/a8dee661b0751b066338747c84609ecd/rw-to-go_kimika_0f2033b6-5056-a36f-23f01638ca8b5e2f-0f2032925056a36_0f203405-5056-a36f-2303a34733c183ef.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44630-Kimika-menu.pdf",primary_location:"Nolita",address:"40 Kenmare St., Manhattan, NY 10012",latitude:40.7206118,longitude:-73.9952615,telephone:"(212)2569280",price_range:"$",facebook_url:"https://www.facebook.com/kimika.nyc",instagram_url:"https://instagram.com/kimika.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Leopard at Des Artistes",slug:"leopard-at-des-artistes",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"The Leopard at des Artistes has recaptured the splendor of the old Café des Artistes, which was at its height from 1975 to 2009, when it was owned by the legendary George Lang.",website:"https://www.theleopardnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/ssjqNGnwMuD5vxe5iCmHu/5bb051094998d83139f189345a6d9957/rw-to-go_the-leopard-at-des-artistes_1d9bf6be-5056-a36f-23ebea10fe7dee1b-1d9bf5735056a36_1d9bf730-5056-a36f-2360807e86dfe02d.jpg",meal_types:["$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"99925",menu_url:"",primary_location:"Upper West Side",address:"1 W. 67th St., Manhattan, NY 10023",latitude:40.773502,longitude:-73.9789261,telephone:"(212)7878767",price_range:"$",facebook_url:"https://www.facebook.com/TheLeopardatdesArtistes",instagram_url:"https://instagram.com/theleopardnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"City Cruises Signature Dining",slug:"city-cruises-signature-dining",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"American (Traditional)",summary:"Experience breathtaking NYC skyline views, delicious food and cocktails, attentive service, and live entertainment while cruising along the Hudson River.",website:"https://www.cityexperiences.com/new-york/city-cruises/nyc-restaurant-week/?utm_source=nyctourism.com&utm_medium=referral&utm_campaign=nyc_restaurant_week_2025",image_url:"//images.ctfassets.net/1aemqu6a6t65/5d1lqUBaMQXA1w2hTdfYzm/dd57d092df0e30c6f3e651e68dcbf71c/compressed-2021_290850_CC_NYC_IMAGE-NYC-amp-Co_Spirit2021_290850_CC_NYC_IMAGE-NYC-amp-Co_Spirit_06_D10BBEBC-F028-4385-880E8D.jpg",meal_types:["$60 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/8122-CityCruisesSignatureDining-menu.pdf",primary_location:"Chelsea",address:"Pier 61, Chelsea Piers at W. 23rd St. \\u0026 12th Avenue, 10011 Manhattan",latitude:40.7473466,longitude:-74.0082779,telephone:"(866)4833866",price_range:"$",facebook_url:"https://www.facebook.com/CityExperiences",instagram_url:"https://instagram.com/cityexperiences",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Leonetta",slug:"leonetta",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Mediterranean",summary:"Bringing Mediterranean warmth to Murray Hill at the edge of Kips Bay, Leonetta offers a refined yet inviting dining experience inspired by the coastal flavors of Southern Europe.",website:"https://www.leonettanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4eyNEh2tP7yusvUbN7Ieq1/81b516a98edbe234ab9449fc4783425a/Leonetta-Manhattan-NYC-Photo-Dillon-Burke-6.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Murray Hill",address:"181 Lexington Ave., Manhattan, NY 10016",latitude:40.7445772,longitude:-73.9807739,telephone:"(646)4484288",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/leonettanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bar Sprezzatura",slug:"bar-sprezzatura",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"Bar Sprezzatura NYC is a coastal-inspired rooftop aperitivo bar and restaurant located atop the Kimpton Theta New York - Times Square hotel.",website:"https://www.barsprezzaturanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5Dm4Ha29tqQ6WgeMytNneY/91c4c62be07db7a0d781f28c4ff886c0/Bar-Sprezzatura-Manhattan-NYC-Courtesy-5.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49419-BarSprezzatura-menu.pdf",primary_location:"Times Square/Theatre District",address:"251 W. 48th St., Manhattan, NY 10019",latitude:40.7610219,longitude:-73.986653,telephone:"(646)7105777",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/barsprezzaturanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gargiulo's",slug:"gargiulos-restaurant",borough:"Brooklyn",neighborhood:"Coney Island",cuisine:"Italian",summary:"In business since 1907 in the Historic Coney Island Amusement Area, Gargiulo's serves classic Neapolitan cuisine.",website:"https://gargiulos.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6nEDQ0AeiA5izz7Ou2RMbB/53887eb5f0ac56c7f9b68e6de4fbc908/gargiulos-coney-island-brooklyn-nyc-risotto-pescatore_abe5c4f0-527c-426a-8b3978659727c358_5ed18037-1022-4723-ae22da4b4ff5e96.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"166234",menu_url:"",primary_location:"Coney Island",address:"2911 W. 15th St., Brooklyn, NY 11224",latitude:40.5764566,longitude:-73.9819928,telephone:"(718)2664891",price_range:"$",facebook_url:"https://www.facebook.com/gargiulosrestaurant",instagram_url:"https://instagram.com/gargiulosrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pinky Swear",slug:"pinky-swear",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"Eclectic",summary:"Pinky Swear is an art-forward restaurant and cocktail bar on Manhattan's Lower East Side where creativity, connection, and discovery collide.",website:"https://www.pinkyswearnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5h0G8NowxwbjExXT6i9nu5/08eb0f7118c3ec66cffe428ff9ea8616/Pinky-Swear-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49920-PinkySwear-menu.pdf",primary_location:"Lower East Side",address:"171A Chrystie St., Manhattan, NY 10002",latitude:40.7208685,longitude:-73.9927592,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/pinkyswearnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Qanoon",slug:"qanoon",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Middle Eastern",summary:"Nostalgia and Palestinian comfort food rule at this casual Chelsea spot.",website:"https://www.qanoonnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6Um6uw1vvsdFj4w4w0DrVo/d87c878b12174cb6330de4a0cd06ce28/qanoon-chelsea-manhattan-nyc-lws_3545__1___1_.jpeg",meal_types:["$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Chelsea",address:"180 Ninth Ave., Manhattan, NY 10011",latitude:40.7452323,longitude:-74.0019905,telephone:"(646)8439711",price_range:"$",facebook_url:"https://www.facebook.com/Qanoon-Restaurant-2142339569212134",instagram_url:"https://instagram.com/qanoonnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"L'Express",slug:"lexpress",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"French",summary:"Enjoy the Gallic fare at L'Express 24/7—breakfast, lunch, dinner, brunch, pre-club, post-club, and instead of club.",website:"https://www.lexpressnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6yd2jMb2NNMBDzEiccOC8R/ac9be842d8e7f45e74e93ba1e39e3f60/rw-to-go_l-express_456cc758-5056-a36f-23adb91157bb5d6e-456cc69f5056a36_456cc7b2-5056-a36f-237fb48ea3835d36.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"115630",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/23934-L%27Express-menu.pdf",primary_location:"Gramercy",address:"249 Park Ave. South, Manhattan, NY 10003",latitude:40.7381068,longitude:-73.9875849,telephone:"(212)2545858",price_range:"$",facebook_url:"https://www.facebook.com/LExpressNYC",instagram_url:"https://instagram.com/lexpressnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Greenhouse Cafe",slug:"the-greenhouse-cafe",borough:"Brooklyn",neighborhood:"Bay Ridge",cuisine:"American (New)",summary:"There's almost always a party at the Greenhouse Café, a popular Bay Ridge venue where many local Brooklynites celebrate their weddings, anniversaries and other special events.",website:"https://www.greenhousecafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3KG9xZKETG0KpQV1bk5KO3/4feefccf3b0897655c6ab246a2dc315e/greenhouse-cafe-brooklyn-nyc-courtesy.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"187261",menu_url:"",primary_location:"Bay Ridge",address:"7717 Third Ave., Brooklyn, NY 11209",latitude:40.6295393,longitude:-74.0283024,telephone:"(718)8338200",price_range:"$",facebook_url:"https://www.facebook.com/greenhousecafebayridge",instagram_url:"https://instagram.com/greenhousebayridge",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Grand Brasserie",slug:"grand-brasserie",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"French",summary:"The landmark Vanderbilt Hall, once Grand Central Terminal’s main waiting room, has been transformed into Grand Brasserie, a New York City meeting place with Parisian flair.",website:"https://www.grandbrasserie.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6VWAc2PqWLHqqoJyJXc7M7/bc2f47aeb2c7c2a56ef73f2e56e028a5/Grand-Brasserie-Manhattan-NYC-Photo-Jovani-Demetrie.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"1363489",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49366-GrandBrasserie-menu.pdf",primary_location:"Midtown East",address:"Vanderbilt Hall, 89 E. 42nd St., 10017 Manhattan",latitude:40.7527277,longitude:-73.9772353,price_range:"$",facebook_url:"https://www.facebook.com/grandbrasserieny",instagram_url:"https://instagram.com/grandbrasserienyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mission Ceviche - Upper East Side",slug:"mission-ceviche-upper-east-side",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Peruvian",summary:"Mission Ceviche, from chef Jose Luis Chavez and partner Brice Mastroluca, has become synonymous with modern Peruvian cuisine, offering a diverse array of dishes crafted from the freshest ingredients.",website:"https://missionceviche.com/upper-east-side-location",image_url:"//images.ctfassets.net/1aemqu6a6t65/4EWZoFJ3STKjte0vCOdS6D/d116f508f149486f54f6af6b2f186c89/Mission-Ceviche-UES-Manhattan-NYC-Photo-Oriana-Rivera.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1283566",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49324-MissionCeviche-UpperEastSide-menu.pdf",primary_location:"Upper East Side",address:"1400 Second Ave., Manhattan, NY 10021",latitude:40.7691005,longitude:-73.9578631,telephone:"(212)6804067",price_range:"$",facebook_url:"https://www.facebook.com/MissionCeviche",instagram_url:"https://instagram.com/missionceviche",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Antica Pesa",slug:"antica-pesa",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Italian",summary:"The Willliamsburg, Brooklyn eatery is the sister restaurant of the well-known Roman dining establishment, which has been run by the same family.",website:"https://www.anticapesa.com/antica-pesa-newyork",image_url:"//images.ctfassets.net/1aemqu6a6t65/7kgRKbPVnG06yKqScUrYwn/d94ee4eff88a4fe45af1dee505a2405e/Antica-Pesa-Brooklyn-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37936-AnticaPesa-menu.pdf",primary_location:"Williamsburg",address:"115 Berry St., Brooklyn, NY 11249",latitude:40.7188116,longitude:-73.9586417,telephone:"(347)7632635",price_range:"$",facebook_url:"https://www.facebook.com/AnticaPesaBrooklyn",instagram_url:"https://instagram.com/anticapesabk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mission Ceviche - Union Square",slug:"mission-ceviche-union-square",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Peruvian",summary:"Mission Ceviche, from chef Jose Luis Chavez and partner Brice Mastroluca, has become synonymous with modern Peruvian cuisine, offering a diverse array of dishes crafted from the freshest ingredients.",website:"https://missionceviche.com/union-square-location",image_url:"//images.ctfassets.net/1aemqu6a6t65/iJKtdKUg8v1sqAa7p4epA/8a19e5bfce86acc38504f2650436080f/Mission-Ceviche-Nomad-Manhattan-NYC-Photo-Oriana-Rivera.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1361170",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49893-MissionCeviche-UnionSquare-menu.pdf",primary_location:"Union Square",address:"7 E. 17th St., Manhattan, NY 10003",latitude:40.7378555,longitude:-73.9913424,telephone:"(212)6804067",price_range:"$",facebook_url:"https://www.facebook.com/MissionCeviche",instagram_url:"https://instagram.com/missionceviche",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Oscar Wilde",slug:"oscar-wilde",borough:"Manhattan",neighborhood:"Nomad",cuisine:"American (New)",summary:"This Victorian-themed bar features a cocktail list that reflects both the Victorian and Prohibition eras.",website:"https://www.oscarwildenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/32PFP66HYY22RqtIsVTxvt/c65d2531a56cada56ca493ca3c45afac/oscarwilde-nomad-manhattan-nyc-cmc_4306.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"989221",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40035-OscarWilde-menu.pdf",primary_location:"Nomad",address:"45 W. 27th St., Manhattan, NY 10001",latitude:40.7451715,longitude:-73.9900275,telephone:"(212)2133066",price_range:"$",facebook_url:"https://www.facebook.com/oscarwildenyc",instagram_url:"https://instagram.com/oscarwildenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Draught 55",slug:"draught-55",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Gastropub",summary:"Draught 55, founded by Katrina McNamee in 2012, provides an exceptional, seasonally curated food menu and a carefully curated beer and cocktail selection. ",website:"https://www.draught55.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3QqxRQNSVhgKtIRszbVCvJ/6d2dc1aba8a3d4aa27965e79fdb2bc4c/Draught-55-Manhattan-NYC-Photo-Courtesy-4.jpg",meal_types:["$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49731-Draught55-menu.pdf",primary_location:"Midtown East",address:"245 E. 55th St., Manhattan, NY 10022",latitude:40.7583039,longitude:-73.9665883,telephone:"(212)3004096",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Treadwell Park - Downtown",slug:"treadwell-park-downtown",borough:"Manhattan",neighborhood:"Battery Park City",cuisine:"American (Traditional)",summary:"Treadwell Park’s craft beer hall offers 20 rotating draft beers and ciders, as well as beer in some of the cocktails and ice cream floats.",website:"https://www.treadwellpark.com/location/downtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/QYXHSppnOMjnQGURsudhb/09579e3a3220e24042c6e410b50b4289/Treadwell-Park-Uptwon-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1225828",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40805-TreadwellPark-Downtown-menu.pdf",primary_location:"Battery Park City",address:"301 South End Ave., Manhattan, NY 10280",latitude:40.7102795,longitude:-74.0165824,telephone:"(212)9450528",price_range:"$",facebook_url:"https://www.facebook.com/treadwellpark",instagram_url:"https://instagram.com/treadwellpark",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Aromi",slug:"aromi",borough:"Brooklyn",neighborhood:"Carroll Gardens",cuisine:"Italian",summary:"Aromi is a restaurant and pizzeria with a mission to bring classic, authentic Italian recipes to Carroll Gardens in Brooklyn.",website:"https://www.arominyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/I5OR3c5fdQN6GfcSnFKlN/9c96dfbb2417bbd53e6e501e5ac92740/Aromi-Brooklyn-NYC-Photo-Sarah-El-Ghendi-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Carroll Gardens",address:"552 Court St., Brooklyn, NY 11231",latitude:40.6750294,longitude:-73.9996712,telephone:"(347)5295752",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100075867400460",instagram_url:"https://instagram.com/arominyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Petite Boucherie",slug:"petite-boucherie",borough:"Manhattan",neighborhood:"West Village",cuisine:"French",summary:"Located at the historic intersection of Christopher and Gay Streets, Petite Boucherie brings a touch of France to the cultured and eclectic neighborhood of the West Village.",website:"https://www.boucherieus.com/location/boucherie-petite-boucherie-bistro",image_url:"//images.ctfassets.net/1aemqu6a6t65/1AvyGUSjx46AgW0n7qgAww/ea6ade3f93b6afab2e8160191a90f6dd/Petite-Boucherie-Manhattan-NYC-Photo-Francesco-Sapienza.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"157048",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40774-PetiteBoucherie-menu.pdf",primary_location:"West Village",address:"14 Christopher St., Manhattan, NY 10014",latitude:40.7338319,longitude:-74.0004287,telephone:"(646)7564145",price_range:"$",facebook_url:"https://www.facebook.com/BoucherieNYC",instagram_url:"https://instagram.com/boucherie_us",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Malii Gramercy",slug:"malii-gramercy",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Thai",summary:"Malii Gramercy is a creative Thai restaurant in the Gramercy Park area in Manhattan.",website:"https://www.maliigramercy.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4XsMIgG4UpQZjiwjQ0vlWj/58f4470bea9d3922acb2fef114acefdc/malii_gramercy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46060-MaliiGramercy-menu.pdf",primary_location:"Gramercy",address:"391 Second Ave., Manhattan, NY 10010",latitude:40.7377049,longitude:-73.9813506,telephone:"(646)9520078",price_range:"$",facebook_url:"https://www.facebook.com/Malii-Gramercy-219393666721524",instagram_url:"https://instagram.com/maliigramercy",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Sea Fire Grill",slug:"sea-fire-grill",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Seafood",summary:"Having perfected the classic steakhouse, the Benjamin Steakhouse Restaurant Group has moved beyond beef to conquer the seafood market.",website:"https://theseafiregrill.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1IZZKp6BFHvfuzG545AI9g/97479146110a0fb31e3cabe76db3f0f2/The-Sea-Fire-Grill-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"98503",menu_url:"",primary_location:"Midtown East",address:"158 E. 48th St., Manhattan, NY 10017",latitude:40.7546919,longitude:-73.9722216,telephone:"(212)9353785",price_range:"$",facebook_url:"https://www.facebook.com/TheSeaFireGrill",instagram_url:"https://instagram.com/theseafiregrill",michelin_award:"",michelin_slug:"",nyttop100_rank:49},{name:"Tinto Tapas Restaurant & Wine Bar",slug:"tinto-tapas-bar",borough:"Manhattan",neighborhood:"Washington Heights",cuisine:"Spanish",summary:"Indulge in the art of sharing and enjoy an elevated tapas experience in Tinto Tapas Restaurant & Wine Bar's cozy and inviting space.",website:"https://www.tintonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2VhAxUt180lXk2wwHz4As6/82fcfebeae2677d2725025a7e028753f/Tinto-Tapas-Manhattan_NYC-Courtesy-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Washington Heights",address:"209 Pinehurst Ave., Manhattan, NY 10033",latitude:40.8550871,longitude:-73.9377887,telephone:"(212)9331803",price_range:"$",facebook_url:"https://www.facebook.com/people/Tinto-Tapas-Restaurant-Wine-Bar/61556790440833/",instagram_url:"https://instagram.com/tinto.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"STK Rooftop",slug:"stk-rooftop",borough:"Manhattan",neighborhood:"Meatpacking District",cuisine:"Steakhouse",summary:"STK Rooftop overlooks the beautiful High Line, right in the middle of the Meatpacking District.",website:"https://stksteakhouse.com/venues/nyc-rooftop",image_url:"//images.ctfassets.net/1aemqu6a6t65/31MRaVFRPsqEpo9CQabddR/71b0c28173717a5b2a62bf1cce549b4d/rw-to-go_stk-rooftop_e6e1352b-5056-a36f-2389ee0931d52ab4-e6e133e45056a36_e6e13579-5056-a36f-23231c404f6fe034.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"65470",menu_url:"",primary_location:"Meatpacking District",address:"26 Little W. 12th St., Manhattan, NY 10014",latitude:40.7398399,longitude:-74.0071747,telephone:"(646)6242400",price_range:"$",facebook_url:"https://www.facebook.com/eatSTK",instagram_url:"https://instagram.com/eatstk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Blackbarn",slug:"blackbarn",borough:"Manhattan",neighborhood:"Nomad",cuisine:"American (New)",summary:"Blackbarn is an American restaurant serving local, artisanal food in the comfort of a modern barn setting.",website:"https://www.blackbarnrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7FDIN7UJswOlFuWQ8B0L73/4adaf43516289d6aa6f22eb456b998f7/Black-Barn-Manhattan-NYC-Photo-C3-Creative-Agency-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"5337",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39236-Blackbarn-menu.pdf",primary_location:"Nomad",address:"19 E. 26th St., Manhattan, NY 10010",latitude:40.7432105,longitude:-73.9870892,telephone:"(212)2655959",price_range:"$",facebook_url:"https://www.facebook.com/blackbarnrestaurant",instagram_url:"https://instagram.com/blackbarnrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Dram Shop Bar",slug:"the-dram-shop-bar",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"American (Traditional)",summary:"The Dram Shop Bar is a locally owned sports bar and restaurant in Park Slope.",website:"https://www.dramshopbrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1tOaLHl4pQTKyIYPch8nZK/e82221ed07a13a4b1045241c51fcafde/compressed-the-dram-shop-bar-park-slope-brooklyn-nyc-courtesy-03.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45821-DramShopBar-menu.pdf",primary_location:"Park Slope",address:"339 9th St., Brooklyn, NY 11215",latitude:40.6688658,longitude:-73.9850575,telephone:"(718)7881444",price_range:"$",facebook_url:"https://www.facebook.com/dramshopbrooklyn",instagram_url:"https://instagram.com/dramshopbrooklyn",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"ABC Kitchen",slug:"abc-kitchen",borough:"Manhattan",neighborhood:"Union Square",cuisine:"American (New)",summary:"ABC Kitchen by Michelin starred Chef Jean-Georges Vongerichten has a passionate commitment to offering the freshest organic and local ingredients possible.",website:"https://www.abckitchen.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/7DVkDiyxO7xo0gENyxNLmX/049828c4f8357da7406b168361d5d527/abc-kitchen-tagger-yancey-iv-4578__1___1_.jpeg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"570",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38713-ABCKitchen-menu.pdf",primary_location:"Union Square",address:"35 E. 18th St., Manhattan, NY 10003",latitude:40.7378274,longitude:-73.9895556,telephone:"(212)4755829",price_range:"$",facebook_url:"https://www.facebook.com/ABCKitchen",instagram_url:"https://instagram.com/abckitchen",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chazz Palminteri Italian Restaurant",slug:"chazz-palminteri-italian-restaurant",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Italian",summary:"Chazz Palminteri's features the finest meat, seafood and pasta dishes, as well as antipasto and traditional Italian desserts.",website:"https://www.chazzpalminterinyc.com/new-york-city",image_url:"//images.ctfassets.net/1aemqu6a6t65/4jSFLikhAgmSnAF1CWQR3A/df708e47406c91d27db306d41c21d0b8/Photo-Apr__1_.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"188260",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39371-ChazzPalminteriItalianRestaurant-menu.pdf",primary_location:"Midtown West",address:"30 W. 46th St., Manhattan, NY 10036",latitude:40.7564318,longitude:-73.9806682,telephone:"(212)3555540",price_range:"$",facebook_url:"https://www.facebook.com/chazzpalminterirestaurant",instagram_url:"https://instagram.com/chazzpalminterinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Olio e Più",slug:"olio-e-piu",borough:"Manhattan",neighborhood:"West Village",cuisine:"Italian",summary:"Inspired by the warmth and comfort of the Italian countryside, Olio e Più and chef Danilo Galati bring tradition and authentic Italian cuisine to the West Village.",website:"https://www.olioepiu.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4TtpIgQaYhj3Uv3ceaR3qX/4224217e9904b5994204e918b259d2ec/olio-e-piu-west-village-manhattan-nyc-courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"55837",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46074-OlioePi%C3%B9-menu.pdf",primary_location:"West Village",address:"3 Greenwich Ave., Manhattan, NY 10014",latitude:40.7338863,longitude:-73.9998718,telephone:"(212)2436546",price_range:"$",facebook_url:"https://www.facebook.com/olionyc",instagram_url:"https://instagram.com/olioepiu",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ci Siamo",slug:"ci-siamo",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Italian",summary:"Celebrating the beauty of simplicity, chef Hillary Sterling centers Ci Siamo's Italian-inflected menu around live-fire cooking and seasonal ingredients.",website:"https://www.cisiamonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6esvkxYBd8qvHKXp4H8SYw/f46d1fd27ce92593064ca2b1a2d240f7/ci-siamo-2-0174_3c895019-722c-4af4-93f2cd11b9628d24_1bb3a36e-bea1-4355-b98b7fe1c0b1abd3.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46090-CiSiamo-menu.pdf",primary_location:"Chelsea",address:"385 Ninth Ave., Manhattan, NY 10001",latitude:40.7522251,longitude:-73.9981157,telephone:"(212)2196559",price_range:"$",facebook_url:"https://www.facebook.com/cisiamonyc",instagram_url:"https://instagram.com/cisiamonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kissaki",slug:"kissaki-bowery",borough:"Manhattan",neighborhood:"East Village",cuisine:"Japanese / Sushi",summary:"The East Village is home to a luxurious sushi experience in a narrow space curved like a knife blade.",website:"https://explorekissaki.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6eXBQIIc0usljzyiiFU8BL/e8811a18c6476d82a8ba7acaaf88e5c1/Kissaki-Manhattan-NYC-Photo-Ben-Hon-1.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41940-KissakiSushi-Bowery-menu.pdf",primary_location:"East Village",address:"319 Bowery, Manhattan, NY 10003",latitude:40.7253384,longitude:-73.9919442,telephone:"(212)5771150",price_range:"$",facebook_url:"https://www.facebook.com/ExploreKissaki",instagram_url:"https://instagram.com/explorekissaki",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tin Marín",slug:"tin-marin-riverdale",borough:"The Bronx",neighborhood:"Riverdale",cuisine:"Latin American",summary:"This stylish, upscale tapas bar combines Latino fusion small plates and entrees—like sophisticated versions of paella, skirt steak with mashed mangu, sweet plantains with cheese or pulpo al gallego (octopus with potatoes)—with a chic atmosphere.",website:"https://www.tinmarintapas.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/9LgTcJvEI4ewsfKwWXGQP/f9ef278f90abb8acbe1f7b83369c80aa/Tin-Mari_n-Tapas-Bronx-NYC-Photo-OjoIntruso-Media-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Riverdale",address:"3708 Riverdale Ave., Bronx, NY 10463",latitude:40.8870447,longitude:-73.9068368,telephone:"(718)8844800",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100003749401269",instagram_url:"https://instagram.com/tin.marin.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mito - Bayside",slug:"mito-bayside",borough:"Queens",neighborhood:"Bayside",cuisine:"Asian Fusion",summary:"Mito's esteemed head chef, who has devoted numerous years to the masterful art of cooking, brings with him a wealth of experience at esteemed establishments such as Jean Georges and Buddha Bar. ",website:"https://themito.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6XGIc5ncnLDvKLqp2ytGf7/c40dd575cc4b3afe7ce99f46302c59c9/Mito-Bayside-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48790-Mito-Bayside-menu.pdf",primary_location:"Bayside",address:"210-35 26th Ave., Queens, NY 11375",latitude:40.7784657,longitude:-73.7789509,telephone:"(718)8198817",price_range:"$",facebook_url:"https://www.facebook.com/mitoasianfusion",instagram_url:"https://instagram.com/mitomodernasian",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kyma",slug:"kyma",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Greek",summary:"Dine on pristine seafood at this upscale Greek restaurant.",website:"https://kymarestaurants.com/locations-flatiron",image_url:"//images.ctfassets.net/1aemqu6a6t65/5eEltx9hNZjHrx2bXAQtea/dff646f964629163892a67852a39c368/kyma-flatiron-manhattan-nyc-pikilia.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"1011196",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40563-Kyma-menu.pdf",primary_location:"Flatiron District",address:"15 W. 18th St., Manhattan, NY 10011",latitude:40.7391382,longitude:-73.9928051,telephone:"(212)2685555",price_range:"$",facebook_url:"https://www.facebook.com/kymaflatiron",instagram_url:"https://instagram.com/kymanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Flatiron Room - Murray Hill",slug:"the-flatiron-room-murray-hill",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"American (New)",summary:"The experience at The Flatiron Room - Murray Hill is meant to be a theatrical and memorable trip to Old New York.",website:"https://theflatironroom.com/murray-hill-home",image_url:"//images.ctfassets.net/1aemqu6a6t65/7Dl08IXkLZapjAxgHtyNXA/691cfa451a772b8a8ef6ccfda303d8ef/170321_f-r_smokinoldfashioned_1738_be915a2e-37f6-415f-8d2d923a82b8050d_00d96ca7-129b-4a80-94097ce2ac3d5d80.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40742-FlatironRoom-MurrayHill-menu.pdf",primary_location:"Murray Hill",address:"9 E. 37th St., Manhattan, NY 10016",latitude:40.7501775,longitude:-73.9821594,telephone:"(212)7253866",price_range:"$",facebook_url:"https://www.facebook.com/theflatironroommurrayhill",instagram_url:"https://instagram.com/theflatironroom_murrayhill",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gaia",slug:"gaia-restaurant",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"Mediterranean",summary:"With a focus on fresh, high-quality ingredients and artfully crafted dishes, Gaia offers a dining experience that blends elegance and flavor in a vibrant, modern atmosphere.",website:"https://www.gaiarestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1Si3HCUn5awD3RBbZJmVH9/a67c1cdc80b5877a91dc3f19125b3560/Gaia-Restaurant-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1389583",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49362-Gaia-menu.pdf",primary_location:"Herald Square",address:"42 W. 35th St., Manhattan, NY 10001",latitude:40.749779,longitude:-73.986039,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/gaiarestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Churrascaria Plataforma Brazilian Steakhouse",slug:"churrascaria-plataforma-brazilian-steakhouse",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Brazilian",summary:"Churrascaria Plataforma Brazilian Steakhouse is a rodízio-style restaurant.",website:"https://www.plataformaonline.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3EJDCBeY5DgBe93ylf1T0f/b9aaadec2287f6f91bae8300bcfa27c8/ww-us-ny-churrascariaplatforma-01.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"14839",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38733-ChurrascariaPlataformaBrazilianSteakhouse-menu.pdf",primary_location:"Midtown West",address:"316 W. 49th St., Manhattan, NY 10019",latitude:40.7620327,longitude:-73.9876634,telephone:"(212)2450505",price_range:"$",facebook_url:"https://www.facebook.com/churrascariaplataformany",instagram_url:"https://instagram.com/churrascariaplataforma",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Benjamin Prime",slug:"benjamin-prime",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Steakhouse",summary:"Offering high quality food in luxurious environments, Benjamin Prime melds together classic steakhouse fare and fresh and vibrant seafood with the grill as the main focus.",website:"https://benjaminsteakhouse.com/prime",image_url:"//images.ctfassets.net/1aemqu6a6t65/4qYLdIy22ojByh7V2iO9B2/1c8d3747e50629edf01bdd6d4178fb3f/benjaminsteakhouseprime-midtown-manhattan-nyc-flourless-chocolate-cake.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"333250",menu_url:"",primary_location:"Murray Hill",address:"23 E. 40th St., Manhattan, NY 10016",latitude:40.7514044,longitude:-73.9797149,telephone:"(212)3380818",price_range:"$",facebook_url:"https://www.facebook.com/benjaminprimeny",instagram_url:"https://instagram.com/BenjaminSteakhousePrime",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Barbetta",slug:"barbetta",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"Owned by the same family for more than a century, Barbetta is a romantic Italian restaurant with ornate décor and a lush back garden.",website:"https://barbettarestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/15LF6buPXQeNEU2HVvfykF/5257b1616a6293a8123d132b6cfcf36f/barbetta-garden-times-square-manhattan-photo-courtesy.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["date-night"],opentable_id:"7335",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/7380-Barbetta-menu.pdf",primary_location:"Times Square/Theatre District",address:"321 W. 46th St., Manhattan, NY 10036",latitude:40.7602468,longitude:-73.9890019,telephone:"(212)2469171",price_range:"$",facebook_url:"https://www.facebook.com/BarbettaNY",instagram_url:"https://instagram.com/barbettarestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Ivory Peacock",slug:"the-ivory-peacock",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Gastropub",summary:"The Ivory Peacock offers distinct, imaginative cocktails complemented by a variety of vibrant shareable plates. ",website:"https://theivorypeacock.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6H1tD3u8RJsEdTDNK8uWbN/211a7d77848f74b5f0824a65984b19d7/Ivory-Peacock-Manhattan-NYC-Photo-Courtesy-Ivory-Peacock-2.jpg",meal_types:["$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1246276",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48472-IvoryPeacock-menu.pdf",primary_location:"Flatiron District",address:"38 W. 26th St., Manhattan, NY 10010",latitude:40.7442721,longitude:-73.9907621,telephone:"(646)9308888",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/theivorypeacock",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sarabeth's Park Avenue South",slug:"sarabeths-park-avenue-south",borough:"Manhattan",neighborhood:"Nomad",cuisine:"American (New)",summary:"Sarabeth's Park Avenue South offers contemporary American cuisine in an elegant yet modern atmosphere.",website:"https://www.sarabethsrestaurants.com/location/sarabeths-park-avenue-south",image_url:"//images.ctfassets.net/1aemqu6a6t65/7BgdigIN5ybC1MohABwxjt/1687152ed5dc45315ad46bc44e559d31/sarabethscps_dsc_0091.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"102730",menu_url:"",primary_location:"Nomad",address:"381 Park Ave. South, Manhattan, NY 10016",latitude:40.7423804,longitude:-73.9842006,telephone:"(212)3350093",price_range:"$",facebook_url:"https://www.facebook.com/SarabethsParkAve",instagram_url:"https://instagram.com/sarabethspas",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Casa Lever",slug:"casa-lever",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Italian",summary:"At Casa Lever, Modern art and timeless architecture set the stage for Italian classics, curated wines and supreme hospitality.",website:"https://www.casalever.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5bH2q0UhnfzVfd7NODbDbd/0bdb799b99aad0cbf422595d06817785/casa-lever-midtown-east-manhattan-nyc--fohnyc-4547_585cc9e2-5256-4a0b-8a5b02d543805b01_9d558c27-e074-4b25-9e7395c54beeac1d.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38745-CasaLever-menu.pdf",primary_location:"Midtown East",address:"390 Park Ave., Manhattan, NY 10022",latitude:40.7597331,longitude:-73.9729522,telephone:"(212)8882700",price_range:"$",facebook_url:"https://www.facebook.com/CasaLever",instagram_url:"https://instagram.com/casalever",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Commissary at Metrograph",slug:"the-commissary-at-metrograph",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"American (Traditional)",summary:"Inspired by the golden age of Hollywood studio commissaries, this stylish restaurant is a hidden gem for film lovers and foodies alike.",website:"https://metrograph.com/eat-drink",image_url:"//images.ctfassets.net/1aemqu6a6t65/3bwogxLMMWz2zn79SsUd5i/8fcc54b7a69712f5f8d6accfd23843ae/Commissary-at-Metrograph-Manhattan-NYC-Photo-Julia-Khoroshilov-2.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49812-CommissaryatMetrograph-menu.pdf",primary_location:"Lower East Side",address:"7 Ludlow St., Manhattan, NY 10002",latitude:40.7151142,longitude:-73.9911829,telephone:"(212)6600312",price_range:"$",facebook_url:"https://www.facebook.com/metrographNYC",instagram_url:"https://instagram.com/metrograph",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Perrine",slug:"perrine",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"French",summary:"Under the direction of executive chef/culinary director Vincenzo Garofalo, the farm-to-table restaurant's seasonally inspired menus skew toward what's fresh and fun.",website:"https://www.perrinenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/dAhno4kJQdllexvyJt94R/2dde5594295238d028836c16bddb4db6/whispering_angel_food_display_7c6dfe45-5056-a36f-2351646e7c735fdb.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"The Pierre New York, 2 E. 61st St., 10065 Manhattan",latitude:40.7651828,longitude:-73.9718937,telephone:"(212)9408195",price_range:"$",facebook_url:"https://www.facebook.com/PerrineNYC",instagram_url:"https://instagram.com/perrinenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nick + Stef's Steakhouse",slug:"nick-stefs-steakhouse",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Nick + Stef's is a masterful blend of ultra-stylish contemporary design and time-honored culinary artistry.",website:"https://www.patinagroup.com/nick-and-stefs-steakhouse-nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/3BiSET854QleKQMdE8YG2l/1ecafed5ae21a01cd0aff0c7ae2f263c/nick-and-stefs-steakhouse-porterhouse-patina-restaurant-group.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"2216",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/18712-Nick%2BStef%27sSteakhouse-menu.pdf",primary_location:"Midtown West",address:"9 Penn Plaza, Manhattan, NY 10001",latitude:40.7510597,longitude:-73.9932303,telephone:"(212)5634444",price_range:"$",facebook_url:"https://www.facebook.com/nickandstefssteakhouse",instagram_url:"https://instagram.com/nickandstefsnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ammos Estiatorio - Grand Central",slug:"ammos-estiatorio-grand-central",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Mediterranean",summary:"Open design, light woods and weathered stones conjure the sun-drenched atmosphere of the Greek islands at Ammos, which features upscale authentic Greek cuisine from various regions of Greece, emphasizing seafood and incorporating Mediterranean and North African influences.",website:"https://ammosny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5KGxJM9FrOn3ggDz2DQ4qn/0a8c77487fe805a6363c226f4265a8ab/ammosestiatorio_courtesy_3.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"5796",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/27978-AmmosEstiatorio-GrandCentral-menu.pdf",primary_location:"Midtown East",address:"52 Vanderbilt Ave., Manhattan, NY 10017",latitude:40.7543343,longitude:-73.9773555,telephone:"(212)9229999",price_range:"$",facebook_url:"https://www.facebook.com/AmmosEstiatorio",instagram_url:"https://instagram.com/ammos_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Catch NYC",slug:"catch-nyc",borough:"Manhattan",neighborhood:"Meatpacking District",cuisine:"Seafood",summary:"Catch NYC is a globally influenced seafood restaurant set in a landmark building in Manhattan’s Meatpacking District.",website:"https://www.catchrestaurants.com/location/catch-nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/6zSAx8eu8GFyyCrAEuccsF/82f29b785e32275dc820ddfc865915f0/Catch-NYC-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"70204",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36938-CatchNYC-menu.pdf",primary_location:"Meatpacking District",address:"21 Ninth Ave., Manhattan, NY 10014",latitude:40.7401991,longitude:-74.0062574,telephone:"(212)3925978",price_range:"$",facebook_url:"https://www.facebook.com/catch",instagram_url:"https://instagram.com/catch",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Koloman",slug:"koloman",borough:"Manhattan",neighborhood:"Nomad",cuisine:"French",summary:"Koloman bridges two worlds: turn-of-the-century European cafe culture and the energy of today’s New York.",website:"https://kolomanrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6PTgThb1xQIIrgffxsUKmT/8b8287db263854046f890fa5256b8b0b/Koloman-Manhattan-NYC-Photo-Courtesy-Koloman.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1241668",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48440-Koloman-menu.pdf",primary_location:"Nomad",address:"16 W. 29th St., Manhattan, NY 10001",latitude:40.7456687,longitude:-73.9880941,telephone:"(212)7908970",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/kolomannyc",michelin_award:"",michelin_slug:"",nyttop100_rank:60},{name:"Lafayette",slug:"lafayette",borough:"Manhattan",neighborhood:"Noho",cuisine:"French",summary:"Lafayette, a French restaurant in downtown Manhattan's NoHo neighborhood, is at once a gorgeous dining destination, vibrant nightspot and delectable French bakery.",website:"https://www.lafayetteny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1ZdfkXjMi7aOlDVwBMqllf/8839b65e620f409eb4d7ce3e2663348f/RW-To-Go_Lafayette_DEFFE00C-5056-A36F-23B7EAF7A0F3E969-deffdec75056a36_deffe070-5056-a36f-231497db54dc3c6e.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"105322",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37827-Lafayette-menu.pdf",primary_location:"Noho",address:"380 Lafayette St., Manhattan, NY 10003",latitude:40.7276377,longitude:-73.9936084,telephone:"(212)5333000",price_range:"$",facebook_url:"https://www.facebook.com/Lafayette380",instagram_url:"https://instagram.com/lafayette380",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Russian Tea Room",slug:"the-russian-tea-room",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Continental",summary:"This opulent restaurant has been a treasured destination since 1927, serving continental classics in a soaring setting.",website:"https://russiantearoomnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5ngPyIqaccInQqHhwveNfX/63f2433b22fa686221de846a7ba3fb1d/russian-tea-room-midtown-west-manhattan-clane-gessel-photographythe-russian-tea-room---main-dining-room-2-_c911c6a5-078e-4b4.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["classic-restaurants"],opentable_id:"7626",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/12083-RussianTeaRoom-menu.pdf",primary_location:"Midtown West",address:"150 W. 57th St., Manhattan, NY 10019",latitude:40.7649476,longitude:-73.9794337,telephone:"(212)5817100",price_range:"$",facebook_url:"https://www.facebook.com/RussianTeaRoomNYC",instagram_url:"https://instagram.com/russiantearoom",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jack & Charlie’s No. 118",slug:"jack-and-charlies-no-118",borough:"Manhattan",neighborhood:"West Village",cuisine:"American (New)",summary:"At Jack & Charlie’s No. 118, nostalgia meets modern flair in a New American menu inspired by mid-century supper clubs.",website:"https://www.jackandcharlies118.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1KAZTbKDwP2gU47PCOoaNC/4f48e0ff55348a6f655823b9d486a5c7/Jack-_-Charlie-s-118-Manhattan-NYC-Photo-Dillon-Burke.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"West Village",address:"118 Greenwich Ave., Manhattan, NY 10011",latitude:40.7385575,longitude:-74.0021182,telephone:"(212)6804265",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/jackandcharlies118",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Brooklyn Chop House - Downtown",slug:"brooklyn-chop-house",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"Steakhouse",summary:"This clubby Financial District spot serves steakhouse classics and Asian dishes in an airy industrial space.",website:"https://www.brooklynchophouse.com/brooklyn-chop-house",image_url:"//images.ctfassets.net/1aemqu6a6t65/3fk2l4I4143Z8VJEztEP9K/43a3bef2ddb0c5aabfaf70a3340ead82/brooklyn-chop-house-2",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1017331",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40743-BrooklynChopHouse-Downtown-menu.pdf",primary_location:"Lower Manhattan",address:"150 Nassau St., Manhattan, NY 10038",latitude:40.7114624,longitude:-74.0059409,telephone:"(212)6191200",price_range:"$",facebook_url:"https://www.facebook.com/brooklynchophouse",instagram_url:"https://instagram.com/brooklynchophouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice 56",slug:"felice-56",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Italian",summary:"Felice 56 brings an Italian sensibility to the City through its Tuscan-inspired cuisine.",website:"https://www.felicerestaurants.com/felice-56",image_url:"//images.ctfassets.net/1aemqu6a6t65/3IgAbjK8dyAGpthMVQPWMM/15abfe2fdb9064e417a08248e733a7b4/felice-56-midtown-west-manhattan-nyc-felcie_food_apps_005.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown West",address:"Chambers Hotel, 15 W. 56th St., 10019 Manhattan",latitude:40.762936,longitude:-73.975427,telephone:"(646)4377272",price_range:"$",facebook_url:"https://www.facebook.com/FeliceNewYorkCity",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"A La Turka",slug:"a-la-turka",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Turkish",summary:"A La Turka is a Turkish restaurant known for its family recipes, lively atmosphere and authentic Mediterranean-style flavors.",website:"https://www.alaturkany.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2WzubkD03F8CDkhz35Wgvf/0fc8a0addc7651e88ba1c477a75f8353/Ala-Turka-Manhattan-NYC-Coutesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"35173",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46105-ALaTurka-menu.pdf",primary_location:"Upper East Side",address:"1417 Second Ave., Manhattan, NY 10021",latitude:40.7701243,longitude:-73.9577261,telephone:"(212)7442424",price_range:"$",facebook_url:"https://www.facebook.com/alaturka.med.ny",instagram_url:"https://instagram.com/alaturkany",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gyu-Kaku Japanese BBQ - Times Square",slug:"gyu-kaku-times-square",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Japanese / Sushi",summary:"Gyu-Kaku specializes in yakiniku—Japanese barbecue meat over a charcoal grill.",website:"https://www.gyu-kaku.com/times-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/7e4w2Bc4huEuQH6y0b096V/79d46589460ac4024847827bd5ff4c1e/rw-to-go_gyu-kaku_japanese_bbq_-_times_square.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"79393",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44801-Gyu-KakuJapaneseBBQ-TimesSquare-menu.pdf",primary_location:"Hells Kitchen",address:"321 W. 44th St., Unit 103, 10036 Manhattan",latitude:40.7591328,longitude:-73.9898984,telephone:"(646)6929115",price_range:"$",facebook_url:"https://www.facebook.com/GyuKakuJBBQ",instagram_url:"https://instagram.com/gyukakujbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Carmine's Times Square",slug:"carmines-times-square",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"Wonderful Southern Italian food served in abundant portions at this family favorite.",website:"https://www.carminesnyc.com/locations/times-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/2rNmE66WgXfUScMntmqesd/094aac5644575255327b20cbd93d3a7b/Carmine-s-Times-Square-Manhattan-NYC-Photo-James-Yardley-2.jpg",meal_types:["$45 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"2295",menu_url:"",primary_location:"Times Square/Theatre District",address:"200 W. 44th St., Manhattan, NY 10036",latitude:40.7574742,longitude:-73.9866043,telephone:"(212)6757722",price_range:"$",facebook_url:"https://www.facebook.com/carminestsq",instagram_url:"https://instagram.com/carminesnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Ivy Room",slug:"the-ivy-room",borough:"Manhattan",neighborhood:"Nomad",cuisine:"American (New)",summary:"The Ivy Room is a modern, swanky take on the NYC piano and cocktail lounge.",website:"https://www.royaltonparkavenue.com/ivy-room",image_url:"//images.ctfassets.net/1aemqu6a6t65/3tikP0vzowtRM3TwpMii9J/f020b85f2e3f75632dbcac26aa0e77e5/The-Ivy-Room-Manhattan-NYC-Photo-Concrete-Hospitality-Group-6.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1267852",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48192-IvyRoom-menu.pdf",primary_location:"Nomad",address:"Royalton Park Avenue, 420 Park Ave. South, 10016 Manhattan",latitude:40.7439008,longitude:-73.9841382,telephone:"(332)3459232",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/theivyroomnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Freemans",slug:"freemans",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"American (Traditional)",summary:"It might be a little tricky to find Freeman's but if you can make your way there, you’ll find surreal, hunting lodge–inspired decor, a hip scene and the most comforting meals.",website:"https://www.freemansrestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/amX41E9hzY7Qext9Bsjju/fe03925e0bdbb23413af16236fe2c3ef/freemans-lower-east-side-manhattan-nyc-freemansmussels.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40761-Freemans-menu.pdf",primary_location:"Lower East Side",address:"End of Freemans Alley (off Rivington St., btw. Chrystie St. and Bowery), 10002 Manhattan",latitude:40.7219877,longitude:-73.9924573,telephone:"(212)4200012",price_range:"$",facebook_url:"https://www.facebook.com/FreemansAlley",instagram_url:"https://instagram.com/freemansrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bar Primi - Penn District",slug:"bar-primi-penn-district",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Italian",summary:'Bar Primi is a casual Italian pasta shop devoted to "primi piatti," the pasta course.',website:"https://www.barprimi.com/location/bar-primi-penn-district",image_url:"//images.ctfassets.net/1aemqu6a6t65/5wyKPudnOeurc8hcavVNn3/5ce04dd94c6b853655c8b7c53799efbe/Bar-Primi-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$30 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1357930",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49025-BarPrimi-PennDistrict-menu.pdf",primary_location:"Chelsea",address:"349 W. 33rd St., Manhattan, NY 10001",latitude:40.7524624,longitude:-73.9958877,telephone:"(212)2336100",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Carmine's - Upper West Side",slug:"carmines-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"About as old-school Italian as it gets, the legendary family-style Southern Italian Carmine's delivers everything but the red-checkered tablecloth.",website:"https://www.carminesnyc.com/locations/upper-west-side",image_url:"//images.ctfassets.net/1aemqu6a6t65/3OcZNt0Lt7orrCzEWAkBL1/b4edd67d68ff0ca6b7b3564879175f75/rw-to-go_carmines_-_upper_west_side.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"2296",menu_url:"",primary_location:"Upper West Side",address:"2450 Broadway, Manhattan, NY 10024",latitude:40.7911109,longitude:-73.9739789,telephone:"(212)3622200",price_range:"$",facebook_url:"https://www.facebook.com/carminesuws",instagram_url:"https://instagram.com/carminesnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Noreetuh",slug:"noreetuh",borough:"Manhattan",neighborhood:"East Village",cuisine:"Hawaiian",summary:"Noreetuh is a modern Hawaiian restaurant in the East Village from chef Chung Chow.",website:"https://www.noreetuh.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3NXNGD90s62z81mSS8GnRR/38797e8f2a8f12ceeebc7932c8bd94da/Spread2_885BC0F2-F24F-48DC-9829DC47EA5CEC6D_69c4dc26-add8-43b2-b77d901bcc5c0173.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"",menu_url:"",primary_location:"East Village",address:"128 First Ave., Manhattan, NY 10009",latitude:40.7272851,longitude:-73.9852368,telephone:"(646)8923050",price_range:"$",facebook_url:"https://www.facebook.com/noreetuh",instagram_url:"https://instagram.com/noreetuh",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Terrace and Outdoor Gardens",slug:"the-terrace-and-outdoor-gardens",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"American (New)",summary:"Dine amidst the abundant greenery at The Terrace Restaurant, a casual, all-day eatery inspired by the French brasseries and American chophouses chef and restaurateur John Fraser worked at early in his career.",website:"https://www.editionhotels.com/times-square/restaurants-and-bars/the-terrace-and-outdoor-gardens",image_url:"//images.ctfassets.net/1aemqu6a6t65/5iqoJfGOgKzXfbmWsQ8ldN/2c16f5004ba092d05ef70637aeab52b5/Garden-Manhattan-NYC-Photo-Courtesy-The-Terrace-and-Outdoor-Garden.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1017811",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41663-TerraceandOutdoorGardens-menu.pdf",primary_location:"Times Square/Theatre District",address:"The Times Square Edition, 701 Seventh Ave., 10036 Manhattan",latitude:40.759149,longitude:-73.984164,telephone:"(212)2615400",price_range:"$",facebook_url:"https://www.facebook.com/TerraceAtEDITION",instagram_url:"https://instagram.com/timessquareedition",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nami Nori - Williamsburg",slug:"nami-nori-williamsburg",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Japanese / Sushi",summary:"Nami Nori is a cozy Williamsburg spot to try the innovative temaki hand rolls—a sort of Japanese version of tacos.",website:"https://naminori.nyc/williamsburg",image_url:"//images.ctfassets.net/1aemqu6a6t65/5elDfYCNkAxATxdF6i1pQ1/d48c7abb504e262c559a106961cf0547/Nami-Nori-Williamsburg-Brooklyn-NYC-Photo-Sebastian-Lucrecio-2.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1210780",menu_url:"",primary_location:"Williamsburg",address:"236 N. 12th St., Brooklyn, NY 11211",latitude:40.7190781,longitude:-73.9528907,telephone:"(917)9091299",price_range:"$",facebook_url:"https://www.facebook.com/naminori.nyc",instagram_url:"https://instagram.com/naminori.nyc",michelin_award:"BIB_GOURMAND",michelin_slug:"nami-nori",nyttop100_rank:""},{name:"Lorenzo's Restaurant, Bar & Cabaret",slug:"lorenzos-restaurant-bar-cabaret",borough:"Staten Island",neighborhood:"Bloomfield",cuisine:"Italian",summary:"Lorenzos Restaurant, Bar & Cabaret serves modern Italian and American fare at breakfast, lunch, and dinner daily.",website:"https://lorenzosdining.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3WXzJeFIfYhRutDcJTNS4S/901ec5be261b136878120bce9efc08cc/RW-To-Go_Lorenzo-s-Restaurant_7ABA9F4D-5056-A36F-2322BCFC45E0CEA9-7aba9e965056a36_7aba9fbd-5056-a36f-23d9ad9a075f0a23__1_cop.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["classic-restaurants","around-the-boroughs"],opentable_id:"79729",menu_url:"",primary_location:"Bloomfield",address:"Hilton Garden Inn New York/Staten Island, 1100 South Ave., 10314 Staten Island",latitude:40.6148318,longitude:-74.1766456,telephone:"(718)4772400",price_range:"$",facebook_url:"https://www.facebook.com/LorenzosDining",instagram_url:"https://instagram.com/LorenzosDining",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Club A Steakhouse",slug:"club-a-steakhouse",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Steakhouse",summary:"This creation of restaurateur Bruno Selimaj (of Bruno Restaurant fame) combines characteristics of a traditional steakhouse with New World modernism in both the menu and decor.",website:"https://www.clubasteakhouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6WweaXYwmEjn2DvXFr5mlQ/f0f04650ca2fa8b78df6184e3d1529fe/img_2538.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"21631",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/35452-ClubASteakhouse-menu.pdf",primary_location:"Midtown East",address:"240 E. 58th St., Manhattan, NY 10022",latitude:40.7600574,longitude:-73.9655842,telephone:"(212)6884190",price_range:"$",facebook_url:"https://www.facebook.com/clubasteakhouse",instagram_url:"https://instagram.com/clubasteakhouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"De Mole - Williamsburg",slug:"de-mole-williamsburg",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Mexican",summary:"Chef Jose Luis Flores oversees a kitchen that specializes in mole poblano alongside other regional Mexican dishes.",website:"https://demolehopest.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4vdpa469fvtC0858NitV2C/6ec8211b67299cb9d9426ffc7060db01/rw-to-go_de_mole_williamsburg.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44175-DeMole-Williamsburg-menu.pdf",primary_location:"Williamsburg",address:"2 Hope St., Brooklyn, NY 11211",latitude:40.7137814,longitude:-73.9578342,telephone:"(347)7213399",price_range:"$",facebook_url:"https://www.facebook.com/HopeStdeMole",instagram_url:"https://instagram.com/demolewilliamsburg",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gui Steakhouse",slug:"gui-steakhouse",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Steakhouse",summary:"Gui Steakhouse is elevated steakhouse experience that integrates the unique flavors and techniques of Korean beef grilling.",website:"https://www.guinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3Z26dv12Drl9Ylv4k7viaK/de6edb4f8e7f1cdf62063378db8b7410/Gui-Steakhouse-Manhattan-NYC-Photo-Dan-Ahn-Creative-Coffee-8.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1275472",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49744-GuiSteakhouse-menu.pdf",primary_location:"Times Square/Theatre District",address:"776 Eighth Ave., Manhattan, NY 10036",latitude:40.7605436,longitude:-73.9870459,telephone:"(646)3295929",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/gui.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Robert",slug:"robert",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"American (New)",summary:"Robert, located atop the Museum of Arts and Design on Columbus Circle, offers an expansive view of Central Park and Broadway.",website:"https://robertnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1nbaHe2GelvFcG3CmykvFD/1ae142c6ff8a769f3732e9721af09b73/Robert-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"37249",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/35447-Robert-menu.pdf",primary_location:"Midtown West",address:"Museum of Arts and Design, 2 Columbus Circle, Manhattan 9th fl.",latitude:40.7673124,longitude:-73.9818864,telephone:"(212)2997730",price_range:"$",facebook_url:"https://www.facebook.com/RobertatMAD",instagram_url:"https://instagram.com/robertrestaurant",michelin_award:"BIB_GOURMAND",michelin_slug:"roberta-s",nyttop100_rank:""},{name:"Lé Chai",slug:"le-chai",borough:"Brooklyn",neighborhood:"Flatlands",cuisine:"Thai",summary:"Lé Chai, located in Flatlands, Brooklyn, redefines the classic steakhouse experience with a Thai fusion twist.",website:"https://www.lechainyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6FivqERUydzqZ0kGfYDdbt/48b337e042ca95a43fbf07a8ed8088f2/Le_-Chai-Brooklyn-NYC-Courtesy-2.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"1348444",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49321-L%C3%A9Chai-menu.pdf",primary_location:"Flatlands",address:"1904 Utica Ave., Brooklyn, NY 11234",latitude:40.6253416,longitude:-73.9278705,telephone:"(929)2732500",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lechaibk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Schilling",slug:"schilling",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"Austrian",summary:"Schilling offers a day-to-night bistro that features Michelin-starred chef Eduard Frauneder's contemporary take on Austrian fare.",website:"https://www.schillingnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1vD17l2X3swTfHFiSVbQkB/206765c0371706683399329792296578/schilling-interior_1_cdv.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"263413",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39763-Schilling-menu.pdf",primary_location:"Lower Manhattan",address:"109 Washington St., Manhattan, NY 10006",latitude:40.7085801,longitude:-74.0139689,telephone:"(212)4061200",price_range:"$",facebook_url:"https://www.facebook.com/schillingnyc",instagram_url:"https://instagram.com/schillingnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Barbounia",slug:"barbounia",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Mediterranean",summary:"With ivy growing up the dimly lit columns, funky lighting and throw pillows strewn along several of the seating areas, Barbounia is anything but stuffy.",website:"https://barbounia.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5omWxU6uQEX8olUaAS06lq/f6cd281c4cea1c97e586064f99c6b0af/barbounia_daveta081217_193__1_.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"5072",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/27737-Barbounia-menu.pdf",primary_location:"Gramercy",address:"250 Park Ave. South, Manhattan, NY 10003",latitude:40.7382365,longitude:-73.9881694,telephone:"(212)9950242",price_range:"$",facebook_url:"https://www.facebook.com/barbounianyc",instagram_url:"https://instagram.com/barbounianyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Obao Midtown East",slug:"obao-noodles-grill",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Thai",summary:"Michael Bao Huynh, of Bia Garden and Baoguette fame, brings his formula—Pan-Asian food in a sleek setting—to the east side.",website:"https://www.obaony.com/home-me",image_url:"//images.ctfassets.net/1aemqu6a6t65/1e7Bqk7E7yG0DcQ2M10Ese/a777936e8c6fbb09dc138ab5f1fd53cb/obao-pichan-keitsrichart-5.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown East",address:"222 E. 53rd St., Manhattan, NY 10022",latitude:40.7571525,longitude:-73.9685544,telephone:"(212)3085588",price_range:"$",facebook_url:"https://www.facebook.com/obaonyc",instagram_url:"https://instagram.com/obao_ny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mae Mae Cafe & Plant Shop",slug:"mae-mae-cafe-and-plant-shop",borough:"The Bronx",neighborhood:"Mott Haven",cuisine:"Eclectic",summary:"Mae Mae Cafe & Plant Shop is a plant-based cafe and bar in Mott Haven that is also a plant shop.",website:"https://www.maemaecafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1WBA01RmqXn2NJgXw1zYZI/9cfe329cfae0a2317461cf4fcf085165/Mae-Mae-Cafe-Plant-Shop-Bronx-NYC-Photo-Courtesy-Mae-Mae-Cafe-Plant-Shop-Great-Performances.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Mott Haven",address:"2417 Third Ave., Bronx, NY 10451",latitude:40.8087961,longitude:-73.9307007,telephone:"(212)3376098",price_range:"$",facebook_url:"https://www.facebook.com/maemaecafe",instagram_url:"https://instagram.com/maemaeplantcafe",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Morgan's Brooklyn Barbecue",slug:"morgans-brooklyn-barbecue-prospect-heights",borough:"Brooklyn",neighborhood:"Prospect Heights",cuisine:"Barbecue",summary:`Morgan's is Brooklyn through and through, a restaurant with a DIY edge that is as mindful of families with young kids as it is of the borough's bearded whiskey fanatics.
`,website:"https://www.morgansbrooklynbarbecue.com/location/brooklyn",image_url:"//images.ctfassets.net/1aemqu6a6t65/rIHUXF9PMyZjE3G5D25B0/e388a6541a9811822c9066b2b1455925/Morgans-Brooklyn-Barbecue-Brooklyn-NYC-Photo-Noah-Fecks.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["summer-vibes"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41802-Morgan%27sBrooklynBarbecue-menu.pdf",primary_location:"Prospect Heights",address:"267 Flatbush Ave., Brooklyn, NY 11217",latitude:40.6798958,longitude:-73.9740726,telephone:"(718)6222224",price_range:"$",facebook_url:"https://www.facebook.com/morgansbrooklynbbq",instagram_url:"https://instagram.com/morgansbrooklynbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tarallucci e Vino - Union Square",slug:"tarallucci-e-vino-union-square",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Italian",summary:"This neighborhood Italian restaurant features handcrafted pastries every morning, grilled panini on homemade focaccia and salads at lunch, and fresh pastas and locally and seasonally inspired Italian plates at night.",website:"https://www.taralluccievino.net/union-square-location",image_url:"//images.ctfassets.net/1aemqu6a6t65/1CD9VGcSA7nOZdscDCsbJE/475827831eb2db458a58ce3b67c04542/Tarallucci-e-Vino-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"24979",menu_url:"",primary_location:"Union Square",address:"15 E. 18th St., Manhattan, NY 10003",latitude:40.7382144,longitude:-73.9906077,telephone:"(212)2285400",price_range:"$",facebook_url:"https://www.facebook.com/taralluccinyc",instagram_url:"https://instagram.com/taralluccinyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gyu-Kaku Japanese BBQ - East Village",slug:"gyu-kaku-japanese-bbq-east-village",borough:"Manhattan",neighborhood:"Noho",cuisine:"Japanese / Sushi",summary:"Gyu-Kaku specializes in yakiniku—Japanese barbecue meat over a charcoal grill.",website:"https://www.gyu-kaku.com/east-village",image_url:"//images.ctfassets.net/1aemqu6a6t65/2DJh86ileALPbvwhQH2fqv/290bca1f2b75454a4a69ad779b07d6d7/rw-to-go_gyu-kaku_japanese_bbq_-_east_village.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"7703",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44896-Gyu-KakuJapaneseBBQ-EastVillage-menu.pdf",primary_location:"Noho",address:"34 Cooper Square, Manhattan, NY 10003",latitude:40.728255,longitude:-73.9914601,telephone:"(212)4752989",price_range:"$",facebook_url:"https://www.facebook.com/GyuKakuJBBQ",instagram_url:"https://instagram.com/gyukakujbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Felice 15 Gold Street",slug:"felice-15-gold-street",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"Italian",summary:"Felice, the ultimate Tuscan restaurant and wine bar, already in two locations on the Upper East Side in NYC, is also in the Financial District.",website:"https://www.felicerestaurants.com/felice-15-gold-street",image_url:"//images.ctfassets.net/1aemqu6a6t65/2w3vlMzkhASakhz8mDnrbn/7e692bd5d024e17fb5e676e81560ff05/felice15goldst_sahospitalitygroup_3.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Lower Manhattan",address:"Gild Hall, A Thompson Hotel, Manhattan 15 Gold St.",latitude:40.7079177,longitude:-74.0072143,telephone:"(212)7855950",price_range:"$",facebook_url:"https://www.facebook.com/Felice.NewYorkCity",instagram_url:"https://instagram.com/felice.restaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Rivage",slug:"le-rivage-restaurant",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"French",summary:"This traditional French restaurant is located in the heart of the Theatre District and has been operated since 1984 by the Denamiel family.",website:"https://www.lerivagenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7B5Rh0RNnO1met00TEFcFm/c3a9cd41b9cc1c844ed0e2606c3c7edd/Le-Rivage-Manhattan-NYC-Photo-Evan-Sung-5.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"18745",menu_url:"",primary_location:"Times Square/Theatre District",address:"340 W. 46th St., Manhattan, NY 10036",latitude:40.760252,longitude:-73.9895454,telephone:"(212)7657374",price_range:"$",facebook_url:"https://www.facebook.com/lerivagenyc",instagram_url:"https://instagram.com/lerivagenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Central Park Boathouse",slug:"central-park-boathouse",borough:"Manhattan",neighborhood:"Central Park",cuisine:"Continental",summary:"Nestled in the park, right on the lake, is the Central Park Boathouse, an iconic and elegant restaurant with both indoor and outdoor seating, and different menus (in different price ranges) for each seating area.",website:"https://centralparkboathouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4j1OmmvAjPTfphrZii6MEf/23ecae4119a2fa04ff0fd82250cbe313/central-park-loeb-boathouse-christopher-postlewaite-0620.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1294132",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/8163-CentralParkBoathouse-menu.pdf",primary_location:"Central Park",address:"Central Park, E. 72nd and Park Dr. N., 10028 Manhattan",latitude:40.771159,longitude:-73.9639329,telephone:"(718)9739339",price_range:"$",facebook_url:"https://www.facebook.com/centralparkboathouse",instagram_url:"https://instagram.com/nycboathouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bocca Di Bacco—Theatre District",slug:"bocca-di-bacco-theatre-district",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Italian",summary:"Bocca Di Bacco is an Italian restaurant located near the Theatre District that is popular with celebrities, tourists and native New Yorkers.",website:"https://www.boccadibacconyc.com/location/bocca-di-bacco-theater-district",image_url:"//images.ctfassets.net/1aemqu6a6t65/5tkky93681yDrIqTqrgH1X/2da35db8aabd181ced450bac6406f7ae/Bocca-Di-Bacco-Manhattan-NYC-Photo-NYCRG-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"4478",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39125-BoccaDiBacco-TheatreDistrict-menu.pdf",primary_location:"Hells Kitchen",address:"635 Ninth Ave., Manhattan, NY 10036",latitude:40.7602533,longitude:-73.9916643,telephone:"(212)2622525",price_range:"$",facebook_url:"https://www.facebook.com/BDBTheaterDistrict",instagram_url:"https://instagram.com/boccadibacconyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Animo!",slug:"animo",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Mexican",summary:"Ánimo! is an authentic Mexican restaurant dedicated to honoring the rich culinary traditions of Mexico.",website:"https://animonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5VslvJFwdxzFZYdKvkOgjX/a447bf11f08cc968d7b0c85618811171/Animo-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1421236",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49757-Animo-menu.pdf",primary_location:"Midtown East",address:"1004 Second Ave., Manhattan, NY 10022",latitude:40.7567764,longitude:-73.9668003,telephone:"(212)8371791",price_range:"$",facebook_url:"https://www.facebook.com/AnimoNewYork",instagram_url:"https://instagram.com/animo.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bar Milano by Eataly",slug:"bar-milano",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Italian",summary:"Amidst a cosmopolitan ambiance inspired by Italy's most fashion-forward city, enjoy elevated, rich Milanese cuisine, iconic drinks like the Negroni, and more.",website:"https://www.eataly.com/us_en/stores/nyc-flatiron/restaurants/bar-milano-by-eataly",image_url:"//images.ctfassets.net/1aemqu6a6t65/4s8BzwFtMJNtV1ISXgTm5C/259fbfc8d5ad8501becc2ccd7d1cdb64/eataly-manzo-virginia-rollison.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1108453",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36094-BarMilanobyEataly-menu.pdf",primary_location:"Flatiron District",address:"Eataly NYC Flatiron, 200 Fifth Ave., 10010 Manhattan",latitude:40.7420328,longitude:-73.989975,telephone:"(212)2292560",price_range:"$",facebook_url:"https://www.facebook.com/EatalyNYCFlatiron",instagram_url:"https://instagram.com/eatalynewyorkcity",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Francie",slug:"francie",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"American (New)",summary:"Francie is a New American brasserie serving a menu inspired by French and Italian flavors. ",website:"https://www.franciebrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2vRnhbaIPdYfyRsqlCQvpH/0d0960461833f5c95e0f9d3c8bace610/compressed-compressed-compressed-francie_all_dishes_003_photo-david-a-lee__1_.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1146772",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44609-Francie-menu.pdf",primary_location:"Williamsburg",address:"136 Broadway, Brooklyn, NY 11249",latitude:40.7101864,longitude:-73.9640186,telephone:"(718)2187572",price_range:"$",facebook_url:"https://www.facebook.com/franciebrooklyn-111530353781536",instagram_url:"https://instagram.com/franciebrooklyn",michelin_award:"ONE_STAR",michelin_slug:"francie",nyttop100_rank:""},{name:"Marseille",slug:"marseille",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"French",summary:"Taking its name from the port town in southern France, the restaurant, like the town, is a melting pot of influences and ideas.",website:"https://www.marseillenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/0M0prsyoNaCM9u8kg1Xl/229a20f8351378c03e341210378c4baa/RW-To-Go_Marseille_DF9F902D-5056-A36F-23C7B2D756283F43-df9f8e215056a36_df9f9088-5056-a36f-2364a317d4a24e17.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1946",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/20930-Marseille-menu.pdf",primary_location:"Hells Kitchen",address:"630 Ninth Ave., Manhattan, NY 10036",latitude:40.759987,longitude:-73.9912338,telephone:"(212)3332323",price_range:"$",facebook_url:"https://www.facebook.com/MarseilleNYC",instagram_url:"https://instagram.com/marseillenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Lure Fishbar",slug:"lure-fishbar",borough:"Manhattan",neighborhood:"Soho",cuisine:"Seafood",summary:"With decor that evokes a luxury yacht, Lure puts a contemporary spin on its classic fish-house menu.",website:"https://www.lurefishbar.com/location/lure-fishbar-new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/11kdGQ0ilEKBAmpzE1q0Ns/b218fdf0352cd9c85b23aa7866c239b5/2016-04-05_13.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["summer-vibes"],opentable_id:"3358",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/29985-LureFishbar-menu.pdf",primary_location:"Soho",address:"142 Mercer St., Manhattan, NY 10012",latitude:40.724703,longitude:-73.9983278,telephone:"(212)4317676",price_range:"$",facebook_url:"https://www.facebook.com/LUREFISHBAR",instagram_url:"https://instagram.com/LureFishbar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dowling’s at The Carlyle",slug:"dowlings-at-the-carlyle",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (Traditional)",summary:"Dowling’s at The Carlyle's menu features chef Moosah Reaume’s interpretations of timeless New York favorites and throwback dishes from another era, with an emphasis on tableside preparations. ",website:"https://www.rosewoodhotels.com/en/the-carlyle-new-york/dining/dowlings-at-the-carlyle",image_url:"//images.ctfassets.net/1aemqu6a6t65/7lZW2xN5Z5aRmk55Y4ff5s/f89ac5d9ce68ecb12e957db43464e810/carlyle_dowling-s_03_04a62ffe-6dd7-4481-be642fcf3e8c5f02_56a882d4-7fd1-4983-88900bbe77834ae4.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["dress-for-the-occasion","for-the-foodies"],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"35 E. 76th St., Manhattan, NY 10021",latitude:40.774416,longitude:-73.9631559,telephone:"(212)7441600",price_range:"$",facebook_url:"https://www.facebook.com/thecarlylehotel",instagram_url:"https://instagram.com/dowlingsatthecarlyle",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chez Josephine",slug:"chez-josephine",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"French",summary:"This romantic, red-velvet dining room is ideal for late-night, post-show dining with its lively scene and reinterpretations of bistro benchmarks.",website:"https://chezjosephinenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2J0KcvBEGeNUbZA0vGiWaX/fe42c489edf02c065e84373b69989d4e/chez-josephine-hells-kitchen-manhattan-photo-matthew-papa-06901.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"35647",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/10405-ChezJosephine-menu.pdf",primary_location:"Hells Kitchen",address:"414 W. 42nd St., Manhattan, NY 10036",latitude:40.7584711,longitude:-73.9935856,telephone:"(212)5941925",price_range:"$",facebook_url:"https://www.facebook.com/chezjosephine",instagram_url:"https://instagram.com/chezjosephinenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cebu Bar & Bistro",slug:"cebu-bar-and-bistro",borough:"Brooklyn",neighborhood:"Bay Ridge",cuisine:"American (New)",summary:"The New American cuisine at Cebu Bar & Bistro includes roast chicken, burgers and risotto balls with porcini mushroom. ",website:"https://www.cebubrooklyn.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7dr4XB46l4z70twoIOR0ZQ/dc2ef2fa7825d0e61b4edde9b8b68c55/Cebu-Bar-Bistro-Brooklyn-NYC-Courtesy-04.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44624-CebuBar%26Bistro-menu.pdf",primary_location:"Bay Ridge",address:"8801 Third Ave., Brooklyn, NY 11209",latitude:40.6218955,longitude:-74.0314249,telephone:"(718)4925095",price_range:"$",facebook_url:"https://www.facebook.com/cebubarbistro",instagram_url:"https://instagram.com/cebubarbistro",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Baraka",slug:"la-baraka",borough:"Queens",neighborhood:"Little Neck",cuisine:"French",summary:"La Baraka is a Little Neck destination for the best French dining experience...with a touch of North Africa. ",website:"https://www.labarakarest.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6sgDHIperClvAnuklPvjAp/c481bcf3961bffa901313f694ce7b5b7/La-Baraka-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"235921",menu_url:"",primary_location:"Little Neck",address:"255-09 Northern Blvd., Queens, NY 11362",latitude:40.7722433,longitude:-73.7342049,telephone:"(718)4281461",price_range:"$",facebook_url:"https://www.facebook.com/labarakarestaurant",instagram_url:"https://instagram.com/labaraka_bonjour",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"DomoDomo NYC",slug:"domodomo",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Japanese / Sushi",summary:"Domodomo is a premier Japanese restaurant specializing in handrolls, sushi, and modern interpretations of traditional Asian dishes.",website:"https://www.domodomorestaurant.com/domodomonyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/5z2B58nJGAbSKJ8ulLVRNI/8d9dd80e9db2bfd89e32684ff9c8d5bd/DOMODOMO-NYC-Manhattan-NYC-Courtesy-4.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45672-DomoDomoNYC-menu.pdf",primary_location:"Greenwich Village",address:"140 W. Houston St., Manhattan, NY 10012",latitude:40.7280131,longitude:-74.0016178,telephone:"(646)7070301",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/domodomonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"BLT Prime",slug:"blt-prime",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Steakhouse",summary:"BLT Prime’s Upper East Side location has an expanded menu featuring signature standouts such as a selection of USDA Prime and 100% naturally raised Black Angus.",website:"https://www.bltrestaurants.com/location/blt-prime-new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/4eL54TTsi06VOl5N6Jvkpn/3dff2a695d3ad53566dff792c662b49b/BLT-Prime-Manhattan-NYC-Photo-Andrew-Sokolov-2.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1039201",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/27561-BLTPrime-menu.pdf",primary_location:"Upper East Side",address:"1032 Lexington Ave., Manhattan, NY 10021",latitude:40.7715732,longitude:-73.9616751,telephone:"(212)9958500",price_range:"$",facebook_url:"https://www.facebook.com/bltprime",instagram_url:"https://instagram.com/bltrestaurants",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bocca Di Bacco—Hell's Kitchen",slug:"bocca-di-bacco-hells-kitchen",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"Italian",summary:"Bocca Di Bacco—Hell's Kitchen, an Italian restaurant located near Columbus Circle and Central Park, is a favorite spot for celebrities, tourists and native New Yorkers alike.",website:"https://www.boccadibacconyc.com/location/bocca-di-bacco-hells-kitchen",image_url:"//images.ctfassets.net/1aemqu6a6t65/6n8D09bYwCwzFKq35pO1vK/4004129a6d4be5eb994f14a1bb602887/_bocca-dibacco-marc-orneth-002.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"17530",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39483-BoccaDiBacco-Hell%27sKitchen-menu.pdf",primary_location:"Hells Kitchen",address:"828 Ninth Ave., Manhattan, NY 10019",latitude:40.7661302,longitude:-73.9867853,telephone:"(212)2658828",price_range:"$",facebook_url:"https://www.facebook.com/pages/Bocca-di-Bacco/1825360731085261",instagram_url:"https://instagram.com/boccadibacconyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Momoya Soho",slug:"momoya-soho",borough:"Manhattan",neighborhood:"Nolita",cuisine:"Japanese / Sushi",summary:"The beloved Japanese restaurant Momoya has evolved into this stunning new incarnation on the border of Soho and Nolita.",website:"https://momoyanyc.com/soho.html",image_url:"//images.ctfassets.net/1aemqu6a6t65/7u9MSAHNYtrPCWr0A5Un2b/08d68fc7b76d7ac04489aa3d5513824d/Momoya-Soho-Manhattan-NYC-Courtesy-02.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1238623",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46600-MomoyaSoho-menu.pdf",primary_location:"Nolita",address:"47 Prince St., Manhattan, NY 10012",latitude:40.7235399,longitude:-73.9957852,telephone:"(646)4299315",price_range:"$",facebook_url:"https://www.facebook.com/momoyasoho",instagram_url:"https://instagram.com/momoyasoho",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Junoon",slug:"junoon",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Indian",summary:`Junoon's name, meaning "passion" or "obsession," is an indication of the dedication that went into this restaurant.`,website:"https://www.junoonnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/47q3K4aaIwB0C7bvIMDj6t/c3fe4a45befb2bb210b847e37a3023a2/Junoon-Manhattan-NYC-Photo-Courtesy-1.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["date-night"],opentable_id:"",menu_url:"",primary_location:"Flatiron District",address:"19 W. 24th St., Manhattan, NY 10010",latitude:40.7430664,longitude:-73.9903997,telephone:"(212)4902100",price_range:"$",facebook_url:"https://www.facebook.com/junoonnyc",instagram_url:"https://instagram.com/junoonnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Trattoria Dell'Arte",slug:"trattoria-dellarte",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Italian",summary:"A favorite of concert goers at nearby Carnegie Hall, Trattoria Dell'Arte is a design landmark, thanks to an interior done by the legendary Milton Glaser, and a entrance marked by a giant white nose.",website:"https://www.trattoriadellarte.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6gOMwDaqHl0nPNaozTpbMv/4b3de09e48fea3e3d1fc511e9f6562d8/trattoriadellarte2philkline.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"31231",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/9736-TrattoriaDell%27Arte-menu.pdf",primary_location:"Midtown West",address:"900 Seventh Ave., Manhattan, NY 10019",latitude:40.7654454,longitude:-73.9805358,telephone:"(212)2459800",price_range:"$",facebook_url:"https://www.facebook.com/TrattoriaNY",instagram_url:"https://instagram.com/trattoriadellarte",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Langan's",slug:"langans",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"American (New)",summary:"Whether you're enjoying a perfectly mixed cocktail, savoring delicious food, or simply soaking in the lively ambiance, Langan’s continues to be a cornerstone of the City’s vibrant nightlife scene.",website:"https://www.langansnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6DzBJ5pe4ucCxZEspBZ2pJ/ae662c817d9460e234067543ae540eb7/Langan-s-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1394434",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/11284-Langan%27s-menu.pdf",primary_location:"Times Square/Theatre District",address:"114 W. 47th St., Manhattan, NY 10036",latitude:40.7581194,longitude:-73.9830293,telephone:"(212)8695482",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/langansnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Bobo",slug:"bobo",borough:"Manhattan",neighborhood:"West Village",cuisine:"French",summary:"Bobo serves classic French food, seasonal cocktails and sustainably produced wines from family-owned vineyards.",website:"https://www.bobonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2vppRRbozjhBKp8IkZTQ8u/ecf15f517348c16346f8fe5e238e0b61/bobo_westvillage_manhattan_nyc_bobo_0206.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39484-Bobo-menu.pdf",primary_location:"West Village",address:"181 W. 10th St., Manhattan, NY 10014",latitude:40.7344612,longitude:-74.0026236,telephone:"(212)4882626",price_range:"$",facebook_url:"https://www.facebook.com/boborestaurant",instagram_url:"https://instagram.com/boborestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sabai Thai",slug:"sabai-thai-restaurant",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Thai",summary:"This elegant Thai restaurant in NoMad offers popular dishes such as pad Thai and tom yum goong, as well as chef's specialties that show the complexity of the country's cuisine.",website:"https://www.sabaithai.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/5QUprQu0jd2aL9uIlzCrq9/4dec18ad4d9bb3067c6ab05509d071d2/compressed-rw-to-go_sabai-thai_1ba8c2c7-5056-a36f-2341dee1498f9124-1ba8c1305056a36_1ba8c32c-5056-a36f-2344ab3c33e55731.jpg",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"1009492",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/43835-SabaiThai-menu.pdf",primary_location:"Nomad",address:"432 Park Ave. South, Manhattan, NY 10016",latitude:40.7442673,longitude:-73.9837039,telephone:"(646)4764521",price_range:"$",facebook_url:"https://www.facebook.com/sabaithainyc",instagram_url:"https://instagram.com/sabaithainyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Chocolat Restaurant & Bar",slug:"chocolat-restaurant-bar",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Soul Food / Southern",summary:"Chocolat is a stylish comfort-food restaurant in Harlem that serves updates on Southern classics for brunch, lunch and dinner.",website:"https://www.chocolatharlem.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5eKNWiFu6NuC81ouEzrtcO/201af5c92ff79ed74150f2e4c84b8f00/Chocolat-Restaurant-_-Bar-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/36870-ChocolatRestaurant%26Bar-menu.pdf",primary_location:"Harlem",address:"2223 Frederick Douglass Blvd., Manhattan, NY 10026",latitude:40.8069823,longitude:-73.9537509,telephone:"(212)2224545",price_range:"$",facebook_url:"https://www.facebook.com/ChocolatHarlem",instagram_url:"https://instagram.com/chocolatharlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"AperiBar",slug:"aperibar",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Italian",summary:"This chic restaurant and cocktail bar serves uncomplicated food and cocktails in warm, stylish surroundings that invite conversation and sharing.",website:"https://www.aperibar.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1TiSbITg1mwuSujZsKk6Lg/c1f2c56b20bfae96d8e5cdf7aa86f510/AperiBar-Manhattan-NYC-Photo-Briana-Balducci-1.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1267177",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47847-AperiBar-menu.pdf",primary_location:"Times Square/Theatre District",address:"Luma Hotel Times Square, 120 W. 41st St., 10036 Manhattan",latitude:40.754376,longitude:-73.985804,telephone:"(212)7308900",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=100083093480661",instagram_url:"https://instagram.com/aperibar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Stout NYC Bryant Park",slug:"stout-nyc-bryant-park",borough:"Manhattan",neighborhood:"Garment District",cuisine:"American (Traditional)",summary:"The newest Stout NYC location is just steps away from Bryant Park, Times Square and the Theatre District.",website:"https://www.stoutnyc.com/location/stout-nyc-bryant-park",image_url:"//images.ctfassets.net/1aemqu6a6t65/6R0T8TQ8UDdEkxtsnZB3Ro/0766259548bd24c7cf9192688cd2c331/BaconCheeseburger_3-1_45599CD3-704A-41EA-A4EFEB19E73E3B3D_e6f6b7db-8ba9-4532-80e6aa1ad9bff6c7.jpg",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46501-StoutNYCBryantPark-menu.pdf",primary_location:"Garment District",address:"109 W. 39th St., Manhattan, NY 10018",latitude:40.7534115,longitude:-73.9860791,telephone:"(212)8400414",price_range:"$",facebook_url:"https://www.facebook.com/StoutNYCBryantPark",instagram_url:"https://instagram.com/stout_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Soogil",slug:"soogil",borough:"Manhattan",neighborhood:"East Village",cuisine:"Korean",summary:"Chef Soogil Lim's refined French technique infuses with his Korean heritage for exceptional dishes that stay true to both.",website:"https://www.soogil.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4CgnkmEPXOIpSPTE1yMSIt/8a0a048b5791d32a4c457366ec749467/restaurant-soogil-east-village-manhattan-nyc-soogil-int-3-by-michael-tulipan.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"",menu_url:"",primary_location:"East Village",address:"108 E. 4th St., Manhattan, NY 10003",latitude:40.7255336,longitude:-73.9883517,telephone:"(646)8385524",price_range:"$",facebook_url:"https://www.facebook.com/SOOGILNYC",instagram_url:"https://instagram.com/soogilnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hard Rock Cafe",slug:"hard-rock-cafe",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"American (Traditional)",summary:"As continually mobbed as the Beatles at Shea, the Hard Rock Café is an ongoing international phenomenon.",website:"https://cafe.hardrock.com/new-york",image_url:"//images.ctfassets.net/1aemqu6a6t65/1ABHLbeqZg9bLZb8fm5U1O/c8180177685267133b0ee3c7ad12aab0/dining_-_couple__1_.jpg",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"174004",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/7681-HardRockCafe-menu.pdf",primary_location:"Times Square/Theatre District",address:"1501 Broadway, Manhattan, NY 10036",latitude:40.7570555,longitude:-73.9864838,telephone:"(212)3433355",price_range:"$",facebook_url:"https://www.facebook.com/hardrockcafenewyork",instagram_url:"https://instagram.com/hardrocknewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pappas NYC",slug:"pappas-nyc",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"Greek",summary:"With a diverse menu featuring traditional Greek eats with a modern approach, guests can indulge in live, wood-fire cooked meats and fish and small plates prepared with the utmost care.",website:"https://pappasnewyork.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/18ZsmFHrMdHRK0IvdQSir5/4b38f92e3c778b06553a852dfaf87ada/PAPPAS_07_2628C305-E339-4610-8A7EBC95D5F0C627_ee9196f6-3e2c-46ec-8696a7dee96df071.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1101250",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48601-PappasNYC-menu.pdf",primary_location:"Greenwich Village",address:"105 MacDougal St., Manhattan, NY 10012",latitude:40.7297453,longitude:-74.0008276,telephone:"(646)4102911",price_range:"$",facebook_url:"https://www.facebook.com/pappasnewyork",instagram_url:"https://instagram.com/pappasnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Boucherie Union Square",slug:"boucherie-union-square",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"French",summary:"Boucherie Union Square is a traditional French brasserie and steakhouse, celebrating Joie de Vivre, that prepares a menu of French classics and timeless bistro favorites, in addition to dry-aged steaks.",website:"https://www.boucherieus.com/location/boucherie-union-square",image_url:"//images.ctfassets.net/1aemqu6a6t65/6tPEwMNGr0v4k5IG7G0fOP/028bacdf826dc289b3e7a7c379549b0a/Boucherie-Union-Square-Manhattan-NYC-Photo-Melissa-Hom-2.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1004143",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40454-BoucherieUnionSquare-menu.pdf",primary_location:"Gramercy",address:"225 Park Ave. South, Manhattan, NY 10003",latitude:40.7371329,longitude:-73.9879502,telephone:"(212)3530200",price_range:"$",facebook_url:"https://www.facebook.com/BoucherieUnionSquare",instagram_url:"https://instagram.com/boucherie_us",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Souvlaki GR - Midtown East",slug:"souvlaki-gr-midtown-east",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Greek",summary:"Fast, cheap and friendly, Souvlaki GR exudes the same spirit as its food truck, which began the enterprise.",website:"https://www.souvlakigr.com/location/souvlaki-gr-midtown-east",image_url:"//images.ctfassets.net/1aemqu6a6t65/5fFObZg5FtJdHjQLXO94Dm/7077a9aacc37a1d5518d7327023b862e/rw-to-go_souvlaki_gr_-_midtown_east.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1020640",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44429-SouvlakiGRMidtownEast-menu.pdf",primary_location:"Midtown East",address:"231 E. 53rd St., Manhattan, NY 10022",latitude:40.7572858,longitude:-73.9680615,telephone:"(212)8320395",price_range:"$",facebook_url:"https://www.facebook.com/souvlakigr",instagram_url:"https://instagram.com/souvlakigr",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Redeye Grill",slug:"redeye-grill",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"American (New)",summary:"This cavernous restaurant captures the richness of NYC with a big, inclusive menu that ranges from miso to matzo ball soup and Cobb salad.",website:"https://www.redeyegrill.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/79jnT5poL6pZUvNk8u4RFm/bdf5e3d6f8b9d00501b887265ad5bf40/redeyegrill2philkline-2.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"31216",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/9618-RedeyeGrill-menu.pdf",primary_location:"Midtown West",address:"890 Seventh Ave., Manhattan, NY 10019",latitude:40.7651937,longitude:-73.9806837,telephone:"(212)5419000",price_range:"$",facebook_url:"https://www.facebook.com/RedeyeGrillNYC",instagram_url:"https://instagram.com/redeyegrillnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nangman BBQ",slug:"nangman-bbq",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Korean",summary:"Nangman BBQ is a Korean barbecue restaurant created to celebrate the spirit of glamping.",website:"https://www.nangmanbbq.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3Ov5qEwMVFL6MUqaLMzZJ6/8f4eff2dd5abdcaafdc9c31863f9909a/Nangman-BBQ-Manhattan-NYC-Photo-Courtesy-Nangman-Inc-2.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"1217374",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48339-NangmanBBQ-menu.pdf",primary_location:"Chelsea",address:"793 Sixth Ave., Manhattan, NY 10001",latitude:40.7454162,longitude:-73.9912648,telephone:"(347)2098255",price_range:"$",facebook_url:"https://www.facebook.com/nangmanbbq",instagram_url:"https://instagram.com/nangman_bbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Shan",slug:"shan",borough:"Brooklyn",neighborhood:"Boerum Hill",cuisine:"Chinese",summary:"Shan features authentic Szechuan food and a casual bar in a comfortably stylish space in Boerum Hill.",website:"https://shannyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/nVQZQOlrALKigcPJTTHuC/2744be794706b681e050ed53c368db38/Shan-Szechuan-Brooklyn-NYC-Photo-Courtesy-Shan-Szechuan-2.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1291423",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48338-Shan-menu.pdf",primary_location:"Boerum Hill",address:"191 Smith St., Brooklyn, NY 11201",latitude:40.6852598,longitude:-73.9913247,telephone:"(347)2944660",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/shanszechuan",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gyu-Kaku Japanese BBQ - Amsterdam",slug:"gyu-kaku-japanese-bbq-amsterdam",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Japanese / Sushi",summary:"Gyu-Kaku Japanese BBQ - Amsterdam specializes in yakiniku—barbecue meat over a charcoal grill. ",website:"https://www.gyu-kaku.com/amsterdam",image_url:"//images.ctfassets.net/1aemqu6a6t65/35LWeFj9q7sw50IZqZnHYs/6e2b0c47e245b4ac180572c58ff849b3/rw-to-go_gyu-kaku_-amsterdam.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1047469",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44856-Gyu-KakuJapaneseBBQ-Amsterdam-menu.pdf",primary_location:"Upper West Side",address:"620 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7905246,longitude:-73.9732201,telephone:"(646)8502989",price_range:"$",facebook_url:"https://www.facebook.com/GyuKakuJBBQ",instagram_url:"https://instagram.com/gyukakujbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Xolo",slug:"xolo",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Mexican",summary:"Xolo serves contemporary Mexican cuisine with a dash of tradition for good measure in a casual and fun space near the Williamsburg Bridge.",website:"https://www.xolobk.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5YgOJsdJcTIVWqGlMv3crj/a4cc1ee0224e4a33632d7d86f1d46df0/Xolo-Brooklyn-NYC-Photo-Jorge-Boetto.jpg",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1239427",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48469-Xolo-menu.pdf",primary_location:"Williamsburg",address:"29 Dunham Pl., Brooklyn, NY 11248",latitude:40.7115231,longitude:-73.9674492,telephone:"(929)2980032",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/xolobk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Soba Totto",slug:"soba-totto",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Japanese / Sushi",summary:"Soba Totto serves soba, yakitori and other Japanese specialties just a short walk from Grand Central Terminal.",website:"https://www.soba-totto.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/2P3UJaXfGUeh8zwuiFdQD2/e34bf2d87cd4f344d64bb95b75263b46/Soba-Totto-Manhattan-NYC-Photo-Hachikin-Marketing-Company.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1321891",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46449-SobaTotto-menu.pdf",primary_location:"Midtown East",address:"211 E. 43rd St., Manhattan, NY 10017",latitude:40.7512499,longitude:-73.9731679,telephone:"(212)3778947",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/Soba.Totto",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Mercerie",slug:"la-mercerie",borough:"Manhattan",neighborhood:"Soho",cuisine:"French",summary:"A modern French restaurant resides inside a posh Soho lifestyle store.",website:"https://www.lamerceriecafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6PmVkwvR0rKG8yFSwqpjzJ/1cfa84263414fbe3575afa2c2862074a/La-Mercerie-Manhattan-NYC-Photo-Freya-Gothelf.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1422712",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44135-LaMercerie-menu.pdf",primary_location:"Soho",address:"53 Howard St., Manhattan, NY 10013",latitude:40.7201139,longitude:-74.0022466,telephone:"(212)8529097",price_range:"$",facebook_url:"https://www.facebook.com/lamerceriecafe",instagram_url:"https://instagram.com/lamercerieny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gaonnuri",slug:"gaonnuri",borough:"Manhattan",neighborhood:"Koreatown",cuisine:"Korean",summary:"Gaonnuri's 39th floor penthouse in Koreatown affords wraparound views of Midtown.",website:"https://www.gaonnurinyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/73o0tr5epkWDQcWQ0URGWm/ddb2df6602698bd95588731784cc60eb/gaonnuri-marley-white-260_7c8be1d9-5056-a36f-236b5cc7e90c00b5.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"92776",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37535-Gaonnuri-menu.pdf",primary_location:"Koreatown",address:"1250 Broadway (enter at 32nd St.), 39th fl., 10001 Manhattan",latitude:40.748178,longitude:-73.98729,telephone:"(212)9719045",price_range:"$",facebook_url:"https://www.facebook.com/gaonnurinyc",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Yama Ramen",slug:"yama-ramen",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Japanese / Sushi",summary:"This Japanese eatery serves ramen, sushi, teriyaki, pork buns and more on its extensive menu.",website:"https://yamaramen.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3fgtOkbNejvWjY5EpupqNu/f06ecde3b1d3f060b44cd317d5dad8cc/rw-to-go_yama-ramen_1d27d223-5056-a36f-23574648cba5012d-1d27cf225056a36_1d27d279-5056-a36f-235d466a5b2af34f.jpg",meal_types:["$30 Lunch Price","$30 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44306-YamaRamen-menu.pdf",primary_location:"Midtown West",address:"60 W. 48th St., 2nd fl., 10036 Manhattan",latitude:40.7581459,longitude:-73.9806957,telephone:"(212)8322288",price_range:"$",facebook_url:"https://www.facebook.com/yamaramen",instagram_url:"https://instagram.com/yamaramen",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Il Cortile",slug:"il-cortile-restaurant",borough:"Manhattan",neighborhood:"Little Italy",cuisine:"Italian",summary:"This old-world Mulberry Street gem packs in the garlic lovers nightly, thanks to a gorgeous cocktail lounge and an ultra-romantic garden room.",website:"https://www.ilcortile.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3i2HwudUdA8xXUjj6Pul3p/a0cc7837946d7158784b4627e96e5476/ilcortie_littleitaly_manhattan_nyc.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"62413",menu_url:"",primary_location:"Little Italy",address:"125 Mulberry St., New York, NY 10013",latitude:40.7179835,longitude:-73.9982316,telephone:"(212)2266060",price_range:"$",facebook_url:"https://www.facebook.com/ilcortilenyc",instagram_url:"https://instagram.com/ilcortile_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mezze on the River",slug:"mezze-on-the-river",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"American (Traditional)",summary:"This casual, family-friendly restaurant on the Manhattan waterfront features shareable dishes such as artichoke and spinach dip and a quartet of mac-n-cheese cones.",website:"https://www.mezzeontheriver.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4IIxsK0OKsT6Rkuqlz1Poa/2f8acd3e8f35b8f9bfc44c2214641c90/Mezze-on-the-River-Manhattan-NYC-Courtesy.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:["summer-vibes"],opentable_id:"1245115",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41658-MezzeontheRiver-menu.pdf",primary_location:"Lower Manhattan",address:"375 South End Ave., Manhattan, NY 10280",latitude:40.7112473,longitude:-74.0176642,telephone:"(212)4321451",price_range:"$",facebook_url:"https://www.facebook.com/mezzeontheriver",instagram_url:"https://instagram.com/mezzeontheriver",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Aqua New York",slug:"aqua-new-york",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Japanese / Sushi",summary:"Aqua New York has two separate restaurants—Aqua Roma and Aqua Kyoto—each a master of its own cuisine to bring this unique lifestyle dining concept to the table.",website:"https://aqua-nyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4uSdyUK3dwMkjABh3qdoqM/85418db971f1b8e804f78f32ec3090ee/Aqua-New-York-Manhattan-NYC-Courtesy-2.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49385-AquaNewYork-menu.pdf",primary_location:"Flatiron District",address:"902 Broadway, Manhattan, NY 10010",latitude:40.7393716,longitude:-73.9894046,telephone:"(212)3533888",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/aquanewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Oceans",slug:"oceans",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"Seafood",summary:"With a name like Oceans, it’s no surprise to learn that this restaurant’s menu is inspired by fresh catches from the Atlantic, Pacific and Mediterranean.",website:"https://oceansnewyork.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6EJEnpVaOz6EmxQHGI2rop/62b87063015de493604ea3884c680121/RW-To-Go_Oceans_7AF1763F-5056-A36F-23FFEDCBD5E13135-7af174bc5056a36_7af176e0-5056-a36f-239cb6116fb0c118.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1050274",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44325-Oceans-menu.pdf",primary_location:"Gramercy",address:"233 Park Ave. South, Manhattan, NY 10003",latitude:40.7374674,longitude:-73.9879206,telephone:"(212)2091055",price_range:"$",facebook_url:"https://www.facebook.com/oceansnewyork",instagram_url:"https://instagram.com/oceansnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Baar Baar",slug:"baar-baar",borough:"Manhattan",neighborhood:"East Village",cuisine:"Indian",summary:"This dark, clubby restaurant features modern Indian cuisine.",website:"https://baarbaarnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/reU6stdZkBVQwyPnD3VnY/4f8ed0a221b3a391fd0fb3dc7d8921b3/Baar-Baar-NYC-Manhattan-NYC-Courtesy-6.jpg",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"989047",menu_url:"",primary_location:"East Village",address:"13 E. 1st St., Manhattan, NY 10003",latitude:40.724433,longitude:-73.991532,telephone:"(212)2281200",price_range:"$",facebook_url:"https://www.facebook.com/baarbaarnyc",instagram_url:"https://instagram.com/baarbaarnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Heritage Grand Bakery",slug:"heritage-grand-bakery",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Mediterranean",summary:"Heritage Grand Bakery, inspired by the Mediterranean, serves signature breads, pastries and wood-fired pizzas in a stylish and worldly setting.",website:"https://www.heritagegrandbakery.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/7o1dJgliga25zC3ysVS6z1/979218e644639e4f01c6be72444973dd/Heritage-Grand-Bakery-Outdoor-Manhattan-NYC-Photo-Alex-Staniloff.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48559-HeritageGrandBakery-menu.pdf",primary_location:"Midtown West",address:"8 W. 40th St., Manhattan, NY 10018",latitude:40.7522652,longitude:-73.9826166,telephone:"(212)4199163",price_range:"$",facebook_url:"https://www.facebook.com/Heritagebakeryrestaurant",instagram_url:"https://instagram.com/heritagegrandbakery",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Il Fiorista",slug:"il-fiorista",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Mediterranean",summary:"Il Florista is a restaurant, bar, café, florist, boutique, and community education space that embraces the manifold uses and beautiful benefits of flowers.",website:"https://www.ilfioristanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/755CWjzAlKb1KBtXLvXj3f/b8ec8da123900fa1b97593808a32723a/il-fiorista-photo-courtesy-01",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1052233",menu_url:"",primary_location:"Nomad",address:"17 W. 26th St., Manhattan, NY 10010",latitude:40.7441598,longitude:-73.9895882,telephone:"(646)4908240",price_range:"$",facebook_url:"https://www.facebook.com/ilfioristanewyork",instagram_url:"https://instagram.com/ilfioristanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sotto la Luna",slug:"sotto-la-luna",borough:"Queens",neighborhood:"Astoria",cuisine:"Italian",summary:"Sotto la luna, located in Astoria, Queens, is an open-kitchen pasta bar and Neapolitan pizzeria that serves modern Italian food in an industrial, high-ceiling, open vibrant space. ",website:"https://www.sottolalunanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/47BvhJFFx70mHWGIzPs5kd/df7d022b1c2ce57a49559334b928e9bd/Sotto-La-Luna-Queens-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49755-SottolaLuna-menu.pdf",primary_location:"Astoria",address:"34-39 31st St., Queens, NY 11106",latitude:40.7583798,longitude:-73.9279682,telephone:"(631)3803569",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/sottolalunanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wagamama - Midtown",slug:"wagamama-midtown",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Asian Fusion",summary:"Wagamama first opened in London in April of 1992 with a clear purpose: to feed guests fresh and nourishing Asian food inspired by the flavors of Japan.",website:"https://www.wagamama.us/restaurants/midtown",image_url:"//images.ctfassets.net/1aemqu6a6t65/33y5YLDlHtFCFkNTxH8oEA/634bc08b8d7d5bb8e31a3dcc2d404629/Wagamama2022October-1827-edited_95B3E6BF-E923-456D-9FB3D7C7F7363925_38c3b269-8bf4-4f0f-bb1e7da34083ae2f.jpg",meal_types:["$30 Dinner Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1068469",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41661-Wagamama-Midtown-menu.pdf",primary_location:"Midtown West",address:"100 W. 55th St., Manhattan, NY 10019",latitude:40.7631438,longitude:-73.9788554,telephone:"(332)9006111",price_range:"$",facebook_url:"https://www.facebook.com/wagamamausa",instagram_url:"https://instagram.com/wagamamausa",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pardon My French",slug:"pardon-my-french",borough:"Manhattan",neighborhood:"East Village",cuisine:"French",summary:"Founded by Antonin Brune, Pardon My French is a contemporary version of a bistro style restaurant, offering a modern approach to classic French fare with an elegant twist.",website:"https://www.pmfnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/76ovm303G4otWlizVFncJN/f71484eecda772c11c90f71e1f20a984/Pardon-My-French-Manhattan-NYC-Courtesy.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49261-PardonMyFrench-menu.pdf",primary_location:"East Village",address:"103 Avenue B, Manhattan, NY 10009",latitude:40.7247523,longitude:-73.9811914,telephone:"(212)3589683",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/pmf_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Āne Bar & Restaurant",slug:"ane-bar-and-restaurant",borough:"Manhattan",neighborhood:"Garment District",cuisine:"Eclectic",summary:"With a menu crafted from the freshest ingredients and a warm, inviting atmosphere, Āne Bar & Restaurant aims to make every meal a celebration.",website:"https://www.anerestaurant.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/70SGwbEzEIGvCOPlzWF8Ff/aa235093727cc4f021381bc3cf45180d/Ane-Bar-_-Restaurant-Manhattan-NYC-Photo-Rama-Marukola.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Garment District",address:"326 W. 37th St., Manhattan, NY 10018",latitude:40.754486,longitude:-73.9936111,telephone:"(212)9330310",price_range:"$",facebook_url:"https://www.facebook.com/people/%C4%80ne-Bar-Restaurant/61568460724161/",instagram_url:"https://instagram.com/ane_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"The Orchard Townhouse",slug:"the-orchard-townhouse",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"American (New)",summary:"The Orchard Townhouse is a comfy eatery set in a four-story Chelsea townhouse, offering American plates and twists on classic cocktails.",website:"https://www.theorchardtownhouse.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5NuiqG2d6vjPZcjjMGN2Hn/e0b0a902abbae8a6fa9034bd59165111/The-Orchard-Townhouse-Manhattan-NYC-Photo-Steve-Freihon-1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1283590",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47828-OrchardTownhouse-menu.pdf",primary_location:"Chelsea",address:"242 Tenth Ave., Manhattan, NY 10001",latitude:40.748382,longitude:-74.0034316,telephone:"(646)9705670",price_range:"$",facebook_url:"https://www.facebook.com/theorchardtownhouse",instagram_url:"https://instagram.com/theorchardtownhouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kurant Wine Bar",slug:"kurant",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"American (New)",summary:"This inviting neighborhood wine bar serves dozens of red, white and sparkling wines by the glass and bottle.",website:"https://www.kurantnyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/N4mlb6d2LKGWFFXqlfuIl/f523119944e47ebc2f63b1d704c59345/Kurant-Wine-Bar-Manhattan-NYC-Photo-Joalia-Hospitality-1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45212-KurantWineBar-menu.pdf",primary_location:"Midtown East",address:"1091 Second Ave., Manhattan, NY 10022",latitude:40.7597416,longitude:-73.9652628,telephone:"(646)3706928",price_range:"$",facebook_url:"https://www.facebook.com/KurantWIneBar",instagram_url:"https://instagram.com/kurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nar Restaurant",slug:"nar-restaurant",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Mediterranean",summary:"Nar Restaurant serves reimagined regional Turkish cuisine, sourced to be clean, organic, and halal-certified.",website:"https://www.narrestaurant.nyc",image_url:"//images.ctfassets.net/1aemqu6a6t65/42tV78huAvgAj1JVVp8mu8/4d61ec4a79a76872d4000ca5eecc2563/Nar-Manhattan-NYC-Photo-Gokces-Yildirim-2__1___1_.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48600-NarRestaurant-menu.pdf",primary_location:"Flatiron District",address:"34 E. 20th St., Manhattan, NY 10003",latitude:40.7385478,longitude:-73.9888053,telephone:"(917)3883195",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61553866850554",instagram_url:"https://instagram.com/narrestaurantnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Union Square Cafe",slug:"union-square-cafe",borough:"Manhattan",neighborhood:"Gramercy",cuisine:"American (New)",summary:"The flagship business launched Danny Meyer’s Union Square Hospitality Group.",website:"https://www.unionsquarecafe.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/x3pEoOM8H6dYgg4h2ilBc/95984b4eed106b8a7f644e7207bb6d6a/union-square-cafe-manhattan-nyc-union-square-cafe_fall-2018_dinner-spread_-credit-peter-garritano-usc-1-_ebdc6671-4c64-4ce8-.jpg",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["classic-restaurants"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/9748-UnionSquareCafe-menu.pdf",primary_location:"Gramercy",address:"101 E. 19th St., Manhattan, NY 10003",latitude:40.7377702,longitude:-73.9878767,telephone:"(212)2434020",price_range:"$",facebook_url:"https://www.facebook.com/unionsquarecafe",instagram_url:"https://instagram.com/unionsquarecafe",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jazba",slug:"jazba",borough:"Manhattan",neighborhood:"East Village",cuisine:"Indian",summary:"Jazba is a tribute and celebration of India's famous eateries—their take on some of the iconic dishes which are more than a century old. ",website:"https://www.jazbanyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/6zo5w7k6VcoJt2enJkW9qg/2a03348ab5bfc5778d13f521230e68ae/Jazba-Manhattan-NYC-Photo-Courtesy-1.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1276645",menu_url:"",primary_location:"East Village",address:"207 Second Ave., Manhattan, NY 10003",latitude:40.7317071,longitude:-73.9858725,telephone:"(646)8613343",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nusr-Et - Midtown",slug:"nusr-et-midtown",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:'Nusr-Et is an internationally acclaimed destination for luxury dining from Nusret "Salt Bae" Gökçeis, a Turkish butcher, chef, and restaurateur whose technique became an internet meme. ',website:"https://www.nusr-et.com.tr/distinctive-venues/new-york-midtown.2.aspx",image_url:"//images.ctfassets.net/1aemqu6a6t65/NjZ8nnuFII4xx3F5WZ5OX/39cf835578c648b6a30ba4c401d71a03/Nusr-Et-Steakhouse-Manhattan-NYC-Photo-Courtesy-Nusr-Et-Steakhouse.jpg",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"988885",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48615-Nusr-Et-Midtown-menu.pdf",primary_location:"Midtown West",address:"60 W. 53rd St., Manhattan, NY 10019",latitude:40.7612482,longitude:-73.9788127,telephone:"(212)3153660",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Jiang Nan - Long Island City",slug:"jiang-nan-long-island-city",borough:"Queens",neighborhood:"Long Island City",cuisine:"Chinese",summary:"Jiang Nan - Long Island City serves indulgent and comforting dining experiences, featuring the best of fusion flavors from each region of China, plus high-quality food and ingredients and superior customer service.",website:"https://www.jiangnanny.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5cbNcTddjLjdwkUSaLLLEZ/95d1d445df265247f7c81cde7d29597e/Jiang-Nan-LIC-NYC-Courtesy-1.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["around-the-boroughs"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49287-JiangNan-LongIslandCity-menu.pdf",primary_location:"Long Island City",address:"27-19 Thomson Ave., ste. 101, 11101 Queens",latitude:40.7464342,longitude:-73.9423019,telephone:"(518)7523091",price_range:"$",facebook_url:"https://www.facebook.com/jiangnannyc",instagram_url:"https://instagram.com/jiangnan.official",michelin_award:"BIB_GOURMAND",michelin_slug:"jiang-nan",nyttop100_rank:""},{name:"San Carlo",slug:"san-carlo-osteria-piemonte",borough:"Manhattan",neighborhood:"Soho",cuisine:"Italian",summary:"San Carlo Osteria Piemonte is a corner of Turin in Soho.",website:"https://www.sancarlonyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1CNIbqmRRG7Kz0a1AYq6Ov/6e812e10c2c2073aded40810c261af70/San-Carlo-Osteria-Piemonte-Manhattan-NYC-Photo-Courtesy-Osteria-Piemonte-Corp-2__1___1_.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"212347",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40258-SanCarloOsteriaPiemonte-menu.pdf",primary_location:"Soho",address:"90 Thompson St., Manhattan, NY 10012",latitude:40.725135,longitude:-74.002087,telephone:"(212)6251212",price_range:"$",facebook_url:"https://www.facebook.com/sancarlonyc",instagram_url:"https://instagram.com/sancarlonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Atrio Wine Bar & Restaurant",slug:"atrio-bar-restaurant",borough:"Manhattan",neighborhood:"Battery Park City",cuisine:"American (New)",summary:"Atrio Wine Bar & Restaurant serves seasonally-inspired New American cuisine from a dramatic open kitchen.",website:"https://www.hilton.com/en/hotels/nyccici-conrad-new-york-downtown/dining/atrio-wine-bar-restaurant",image_url:"//images.ctfassets.net/1aemqu6a6t65/1WOe8J1Lu4YIIMgbaL0OOd/72a6ae04eb4b8084e8fba74a860b1efa/atrio.jpg",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"78982",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/37199-AtrioWineBar%26Restaurant-menu.pdf",primary_location:"Battery Park City",address:"Conrad New York Downtown, 102 North End Ave., 10282 Manhattan",latitude:40.7149114,longitude:-74.0154612,telephone:"(646)7694250",price_range:"$",facebook_url:"https://www.facebook.com/conradnydowntown",instagram_url:"https://instagram.com/conradnydowntown",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Burger & Lobster Bryant Park",slug:"burger-lobster-bryant-park",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Seafood",summary:"Burger & Lobster has been serving the finest of burgers and the freshest of lobsters since 2014.",website:"https://www.burgerandlobster.com/locations/new-york/bryant-park",image_url:"//images.ctfassets.net/1aemqu6a6t65/3lvayifNpRzuRYU2IPDUtF/619fd63052bbe0770f1685b4a25f82c9/Burger-_-Lobster-Bryant-Park-Manhattan-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1195105",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/40532-Burger%26LobsterBryantPark-menu.pdf",primary_location:"Times Square/Theatre District",address:"132 W. 43rd St., Manhattan, NY 10036",latitude:40.7559517,longitude:-73.9851995,telephone:"(917)5659044",price_range:"$",facebook_url:"https://www.facebook.com/burgerandlobsterbryantpark",instagram_url:"https://instagram.com/burgerandlobsterusa",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mamazul",slug:"mamazul-mexican-grill",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Mexican",summary:"Mamazul Mexican Grill, located in NoMad, is a culinary gem that celebrates the vibrant flavors and traditions of Mexico.",website:"https://www.mamazulnyc.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1309417",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49320-MamazulMexicanGrill-menu.pdf",primary_location:"Nomad",address:"1155 Broadway, Manhattan, NY 10001",latitude:40.7444421,longitude:-73.9892065,telephone:"(212)5006988",price_range:"$",facebook_url:"https://www.facebook.com/mamazulnyc",instagram_url:"https://instagram.com/mamazulnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cathédrale",slug:"cathedrale-restaurant",borough:"Manhattan",neighborhood:"East Village",cuisine:"French",summary:"Under soaring ceilings and a monumental wire-mesh sculpture by Edoardo Tresoldi, executive chef Jason Hall delivers pure, ingredient-driven flavors.",website:"https://cathedraleny.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"1046641",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/41403-Cathedrale-menu.pdf",primary_location:"East Village",address:"Moxy NYC East Village, 112 E. 11th St., 10003 Manhattan",latitude:40.7316,longitude:-73.98951,telephone:"(212)8881093",price_range:"$",facebook_url:"https://www.facebook.com/cathedralenewyork",instagram_url:"https://instagram.com/cathedralenewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nisí Estiatorio",slug:"nisi-estiatorio",borough:"Queens",neighborhood:"Astoria",cuisine:"Greek",summary:"Nisí Estiatorio is a celebration of Greek culture and cuisine, with a contemporary twist.",website:"https://www.nisiastoria.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:["around-the-boroughs"],opentable_id:"1274452",menu_url:"",primary_location:"Astoria",address:"32-07 30th Ave., Queens, NY 11102",latitude:40.7665765,longitude:-73.9203027,telephone:"(718)4409295",price_range:"$",facebook_url:"https://www.facebook.com/nisinyc",instagram_url:"https://instagram.com/nisiastoria",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Nizuc",slug:"nizuc",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"Mexican",summary:"Nizuc brings Latin flair to Hudson Yards with contemporary coastal Mexican cuisine rooted in quality ingredients.",website:"https://nizucnyc.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1331371",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49376-Nizuc-menu.pdf",primary_location:"Hudson Yards",address:"485 Tenth Ave., Manhattan, NY 10018",latitude:40.7567889,longitude:-73.9979592,telephone:"(212)7841000",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/nizuc_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Burrito Bar",slug:"the-burrito-bar-west-brighton",borough:"Staten Island",neighborhood:"West Brighton",cuisine:"Mexican",summary:"This Mexican restaurant is located in a converted house, with a bar on the first floor and restaurant seating on the second level.",website:"http://www.theburritobar.com",image_url:"",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"West Brighton",address:"585 Forest Ave., Staten Island, NY 10310",latitude:40.6303476,longitude:-74.1088323,telephone:"(718)8159200",price_range:"$",facebook_url:"https://www.facebook.com/the.burrito.bar.si",instagram_url:"https://instagram.com/the_burrito_bar",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Jardin Bistro",slug:"le-jardin-bistro",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"French",summary:"Le Jardin Bistro stands out with its charming garden-inspired ambiance that makes diners feel as if they’ve been transported straight to France. ",website:"https://www.lejardinbistronyc.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1386064",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/26771-LeJardinBistro-menu.pdf",primary_location:"Lower East Side",address:"95 Delancey St., Manhattan, NY 10022",latitude:40.718657,longitude:-73.9894881,telephone:"(212)2280909",price_range:"$",facebook_url:"https://www.facebook.com/profile.php/?id=61565397292734",instagram_url:"https://instagram.com/lejardinbistro_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Monde",slug:"le-monde",borough:"Manhattan",neighborhood:"Morningside Heights",cuisine:"French",summary:"This restaurant in Columbia University’s neighborhood celebrates the cuisine of France's Loire Valley.",website:"https://www.lemondenyc.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"349132",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/23933-LeMonde-menu.pdf",primary_location:"Morningside Heights",address:"2885 Broadway, Manhattan, NY 10025",latitude:40.8058863,longitude:-73.9658847,telephone:"(212)5313939",price_range:"$",facebook_url:"https://www.facebook.com/lemonderestaurantnyc",instagram_url:"https://instagram.com/lemondenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Korali Estiatorio",slug:"korali-estiatorio",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Greek",summary:"Set in a serene, beautiful space with whitewashed arched walls and stonework reminiscent of Cretan Islands, this Upper East Sider focuses on Greek seafood.",website:"https://www.nyckorali.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"167623",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48244-KoraliEstiatorio-menu.pdf",primary_location:"Upper East Side",address:"1662 Third Ave., Manhattan, NY 10128",latitude:40.783492,longitude:-73.950977,telephone:"(646)9645470",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/korali_estiatorio",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Masaaki",slug:"masaaki",borough:"Queens",neighborhood:"Bayside",cuisine:"Japanese / Sushi",summary:"At Masaaki in Bayside, Queens, find go-to sushi rolls and hibachi, as well as delicately prepared 19-course omakase.",website:"https://www.masaakiusa.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1263607",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48977-Masaaki-menu.pdf",primary_location:"Bayside",address:"214-16 41st Ave., Queens, NY 11361",latitude:40.7635359,longitude:-73.7703105,telephone:"(718)4235353",price_range:"$",facebook_url:"https://www.facebook.com/masaaki.nyc",instagram_url:"https://instagram.com/masaaki_nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Patrick's on the Hill",slug:"patricks-on-the-hill",borough:"Manhattan",neighborhood:"Hamilton Heights",cuisine:"Caribbean",summary:"The menu at this Hamilton Heights restaurant features a mix of traditional Caribbean dishes and creative fusion offerings, with standout favorites like jerk chicken, oxtails, and Jamaican beef patties. ",website:"https://www.patricksonthehill.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1431049",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49811-Patrick%27sontheHill-menu.pdf",primary_location:"Hamilton Heights",address:"1635 Amsterdam Ave., Manhattan, NY 10031",latitude:40.8225191,longitude:-73.9493609,telephone:"(646)6827243",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/patricksonthehill",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Barlume",slug:"barlume",borough:"Manhattan",neighborhood:"Flatiron District",cuisine:"Mediterranean",summary:"Barlume is an all-day dining experience steeped in the sun-soaked flavors of the Mediterranean.",website:"https://barlume.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["hidden-gems"],opentable_id:"",menu_url:"",primary_location:"Flatiron District",address:"900 Broadway, Manhattan, NY 10003",latitude:40.7388596,longitude:-73.9895743,telephone:"(212)6914978",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/barlumenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Murano Ristorante",slug:"murano-ristorante",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Italian",summary:"Executive chef Cesar Dutan infuses elements of Italian, French and Asian flavors into an inspiring menu of authentic Venetian staples and flavors from across Italy with daring twists and visual flair.",website:"https://www.muranonewyork.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1393198",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49776-MuranoRistorante-menu.pdf",primary_location:"Midtown East",address:"120 E. 56th St., Manhattan, NY 10022",latitude:40.7604884,longitude:-73.9706578,telephone:"(212)4571299",price_range:"$",facebook_url:"https://www.facebook.com/muranony",instagram_url:"https://instagram.com/muranony",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dagg Thai",slug:"dagg-thai",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Thai",summary:'In Thai, "Dagg" means to eat in the warmest, friendliest way possible, just like inviting close friends to enjoy a meal together.',website:"https://daggthainyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/16KXrXF9aFiBNJuqvDbQ4w/3afc094c6db6b1d10117f1651dc4cf8d/DaggThai-36_DD749884-BC72-405F-8FA436158F51B68A_b1383705-5f3c-4ca6-a7851abc0443c988.jpg",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49465-DaggThai-menu.pdf",primary_location:"Murray Hill",address:"10 E. 39th St., Manhattan, NY 10016",latitude:40.7510646,longitude:-73.9816089,telephone:"(929)5992632",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/dagg.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Taste of India II",slug:"taste-of-india-ii",borough:"Staten Island",neighborhood:"New Dorp",cuisine:"Indian",summary:" Taste of India offers a sophisticated fine dining experience with effortlessly charming staff and discreet service.",website:"https://www.tasteofindia2.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/33QRFOK7J0XbOKIjAzyd6i/a6138b5eceae92d22f83d6e3a7d8e2eb/Taste-of-India-Staten-Island-NYC-Courtesy.jpg",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"111514",menu_url:"",primary_location:"New Dorp",address:"287 New Dorp Ln., Staten Island, NY 10306",latitude:40.572236,longitude:-74.1126406,telephone:"(718)9874700",price_range:"$",facebook_url:"https://www.facebook.com/tasteofindiasi",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"BOTA Supper Club",slug:"bota-supper-club",borough:"Staten Island",neighborhood:"St. George",cuisine:"American (New)",summary:"An exclusive 21+ venue, BOTA Supper Club is Staten Island’s hottest destination for elevated modern American cuisine, where chic vibes meet sultry sophistication.",website:"https://botasupperclub.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/1QyYYtR2h4NGWzUtFt754j/3e19b27e65b383e710be2b262e9a1a8f/BOTA-Supper-Club-Staten-Island-NYC-Courtesy-_1.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1388074",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49408-BOTASupperClub-menu.pdf",primary_location:"St. George",address:"402 St. Marks Pl., Staten Island, NY 10301",latitude:40.6399537,longitude:-74.0777016,telephone:"(347)4665585",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61565213227636",instagram_url:"https://instagram.com/botasupperclub",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tuome",slug:"tuome",borough:"Manhattan",neighborhood:"East Village",cuisine:"American (New)",summary:"Tuome is a critically acclaimed East Village restaurant by chef/owner Thomas Chen, whose ingredient-driven contemporary American menu showcases his classic culinary training with Asian influences.",website:"https://www.tuomenyc.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/4RVoykRkfXuvYvKA5BLXbF/cc6d2f2b8a4c80ae633028ee3da93ae9/Tuome-Manhattan-NYC-Photo-Noah-Fecks-1.jpg",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/39466-Tuome-menu.pdf",primary_location:"East Village",address:"536 E. 5th St., Manhattan, NY 10009",latitude:40.723998,longitude:-73.982949,telephone:"(646)8337811",price_range:"$",facebook_url:"https://www.facebook.com/tuomenyc",instagram_url:"https://instagram.com/tuomenyc",michelin_award:"ONE_STAR",michelin_slug:"tuome",nyttop100_rank:""},{name:"Pomp & Circumstance",slug:"pomp-circumstance",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Mediterranean",summary:"Pomp & Circumstance is a cozy Mediterranean restaurant with sidewalk seating.",website:"https://pandcdining.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/3fJtfuz7wDgkdYfgB24F19/09a5520162da0b2b9b0fa37d8cd95141/rw-to-go_pomp__circumstance.jpg",meal_types:["$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44983-Pomp%26Circumstance-menu.pdf",primary_location:"Williamsburg",address:"577 Lorimer St., Brooklyn, NY 11211",latitude:40.7142586,longitude:-73.9496365,telephone:"(718)3874861",price_range:"$",facebook_url:"https://www.facebook.com/pandcdining",instagram_url:"https://instagram.com/pandcdining",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Delmonico's",slug:"delmonicos-restaurant",borough:"Manhattan",neighborhood:"Lower Manhattan",cuisine:"Steakhouse",summary:"The classic NYC steakhouse, in business since 1837, is where eggs Benedict and baked Alaska were said to be invented.",website:"https://www.theoriginaldelmonicos.com",image_url:"//images.ctfassets.net/1aemqu6a6t65/5rYLfBnyi5KrjJfE9PU6sg/d17bc8d3bdda567014a5674adc81d65a/Delmonicos-Manhattan-NYC-Photo-Lanna-Apisukh-2.jpg",meal_types:["$60 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["classic-restaurants"],opentable_id:"1288075",menu_url:"",primary_location:"Lower Manhattan",address:"56 Beaver St., Manhattan, NY 10004",latitude:40.7051245,longitude:-74.0102421,telephone:"(212)3811237",price_range:"$",facebook_url:"https://www.facebook.com/delmonicosnewyork",instagram_url:"https://instagram.com/delmonicosnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Naro",slug:"naro",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Korean",summary:"Naro’s menu focuses on the subtle and delicate flavors of Korean cuisine, drawing inspiration from classic dishes from various moments throughout Korean history.",website:"https://www.naronyc.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1268866",menu_url:"",primary_location:"Midtown West",address:"610 Fifth Ave., Manhattan, NY 10020",latitude:40.7583290716,longitude:-73.9779332197,telephone:"(212)2020206",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/naro.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gyu-Kaku Japanese BBQ - Long Island City",slug:"gyu-kaku-japanese-bbq-long-island-city",borough:"Queens",neighborhood:"Long Island City",cuisine:"Japanese / Sushi",summary:"Gyu-Kaku specializes in yakiniku—Japanese barbecue meat over a charcoal grill.",website:"https://www.gyu-kaku.com/longislandcity",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1388899",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49799-Gyu-KakuJapaneseBBQ-LongIslandCity-menu.pdf",primary_location:"Long Island City",address:"44-45 21st St., Queens, NY 11101",latitude:40.7482509,longitude:-73.9470496,telephone:"(718)8870042",price_range:"$",facebook_url:"https://www.facebook.com/GyuKakuJBBQ",instagram_url:"https://instagram.com/gyukakujbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kanyakumari",slug:"kanyakumari",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Indian",summary:"Dishes from India’s southernmost coastline get the spotlight at this spot from veteran restaurateur Salil Mehta and Kebab Aur Sharab's Dipesh Shinde.",website:"http://kanyakumarinyc.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49014-Kanyakumari-menu.pdf",primary_location:"Union Square",address:"20 E. 17th St., Manhattan, NY 10003",latitude:40.7372081,longitude:-73.9912938,telephone:"(212)6410401",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sarabeth's Greenwich Village",slug:"sarabeths-greenwich-village",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"American (Traditional)",summary:"Located just a short walk from SoHo and West Village cultural landmarks, Sarabeth’s offers the perfect destination to enjoy both flavor and community in downtown NYC.",website:"https://www.sarabethsrestaurants.com/location/sarabeths-greenwich-village-soho/",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1388308",menu_url:"",primary_location:"Greenwich Village",address:"100 W. Houston St., Manhattan, NY 10012",latitude:40.7273444,longitude:-74.0002866,telephone:"(212)2547000",price_range:"$",facebook_url:"https://www.facebook.com/sarabethsnyc",instagram_url:"https://instagram.com/sarabethsnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pecora Bianca Upper West Side",slug:"la-pecora-bianca-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Italian",summary:"La Pecora Bianca Upper West Side offers an expanded menu from Mario Batali alum Cruz Goler in a bright, sophisticated space.",website:"https://www.lapecorabianca.com/location/la-pecora-bianca-upper-west-side",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper West Side",address:"359 Columbus Ave., Manhattan, NY 10024",latitude:40.7804753,longitude:-73.9763467,telephone:"(212)3009870",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lapecorabianca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Acru",slug:"acru",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"American (New)",summary:"In the main dining room, Acru offers a tasting menu inspired by global techniques and flavors gleaned from Chef Garwood’s Australian roots and a decade of cooking at some of the world’s top restaurants.",website:"https://www.acru.nyc",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Greenwich Village",address:"79 MacDougal St., Manhattan, NY 10012",latitude:40.7287691,longitude:-74.0016571,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/acrunyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sojourn Social",slug:"sojourn-social",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"American (New)",summary:"Sojourn Social features a multifaceted venue paired with food and libations representing the melting pot of cultures and cuisines.",website:"https://sojournsocial.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1213360",menu_url:"",primary_location:"Upper East Side",address:"1708 Second Ave., Manhattan, NY 10128",latitude:40.7794134,longitude:-73.9502659,telephone:"(212)5377750",price_range:"$",facebook_url:"https://www.facebook.com/SojournSocial",instagram_url:"https://instagram.com/sojourn_social",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Paris Bar",slug:"paris-bar",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"French",summary:"Paris Bar is an iconic French brasserie near Carnegie Hall and Central Park that serves traditional French fare from breakfast through supper every day, with brunch available on weekends, plus a rooftop bar.",website:"https://www.parisbarnyc.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1393621",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49343-ParisBar-menu.pdf",primary_location:"Midtown West",address:"120 W. 57th St., Manhattan, NY 10019",latitude:40.7645242,longitude:-73.9784575,telephone:"(212)5818900",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Noodle Bar - Uptown",slug:"noodle-bar-uptown",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Asian Fusion",summary:"The Uptown outpost of David Chang’s Korean-American sensation.",website:"https://momofukunoodlebar.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1072219",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44129-NoodleBar-Uptown-menu.pdf",primary_location:"Midtown West",address:"The Shops at Columbus Circle, 10 Columbus Circle, 10019 Manhattan",latitude:40.7685811,longitude:-73.9831811,price_range:"$",facebook_url:"https://www.facebook.com/luckypeach",instagram_url:"https://instagram.com/momolongplay",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Yefsi Estiatorio",slug:"yefsi-estiatorio",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Greek",summary:"Yefsi Estiatorio, a Greek restaurant on Manhattan's Upper East Side, features an upscale selection of souvlaki, seafood, and Greek Mediterranean cuisine.",website:"http://www.yefsiestiatorio.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49442-YefsiEstiatorio-menu.pdf",primary_location:"Upper East Side",address:"1481 York Ave., Manhattan, NY 10075",latitude:40.7710462,longitude:-73.9510258,telephone:"(212)5350293",price_range:"$",facebook_url:"https://www.facebook.com/YefsiEstiatorio",instagram_url:"https://instagram.com/yefsiestiatorio",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pecora Bianca SoHo",slug:"la-pecora-bianca-soho",borough:"Manhattan",neighborhood:"Soho",cuisine:"Italian",summary:"La Pecora Bianca SoHo offers an expanded menu from Mario Batali alum Cruz Goler in a bright, sophisticated space.",website:"https://www.lapecorabianca.com/location/soho",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Soho",address:"54 Prince St., Manhattan, NY 10012",latitude:40.72346,longitude:-73.9963118,telephone:"(212)3808202",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lapecorabianca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Aquarelle",slug:"aquarelle",borough:"Manhattan",neighborhood:"East Village",cuisine:"Seafood",summary:"Discover a captivating underwater world where the culinary approach mirrors the environment: beautiful presentation, bold flavors, and the freshest seafood prepared with precision and care. ",website:"https://aquarellenyc.com",image_url:"",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1432960",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49768-Aquarelle-menu.pdf",primary_location:"East Village",address:"47 Avenue B, Manhattan, NY 10009",latitude:40.7229625,longitude:-73.9825102,telephone:"(212)7774547",price_range:"$",facebook_url:"https://www.facebook.com/AquarelleNYC",instagram_url:"https://instagram.com/aquarellenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Le Tout Va Bien",slug:"le-tout-va-bien",borough:"Manhattan",neighborhood:"Hells Kitchen",cuisine:"French",summary:"The raison d’être of this cheery basement bistro is to get theater-going patrons fed and out the door by curtain time.",website:"https://letoutvabien.nyc",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1368112",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49028-LeToutVaBien-menu.pdf",primary_location:"Hells Kitchen",address:"311 W. 51st St., Manhattan, NY 10019",latitude:40.7635398,longitude:-73.9861188,telephone:"(212)2650190",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/letoutvabiennyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Oyamel",slug:"oyamel",borough:"Manhattan",neighborhood:"Hudson Yards",cuisine:"Mexican",summary:"At Oyamel, José Andrés and his team combine Mexico’s rich regional diversity with the vibrant urban atmosphere of Mexico City.",website:"https://www.oyamel.com/location/new-york-city",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1421776",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49771-Oyamel-menu.pdf",primary_location:"Hudson Yards",address:"505 W. 30th St., Manhattan, NY 10001",latitude:40.7524063,longitude:-74.0013731,telephone:"(646)4951242",price_range:"$",facebook_url:"https://www.facebook.com/Oyamel",instagram_url:"https://instagram.com/oyamelbyjose",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Raf's",slug:"rafs",borough:"Manhattan",neighborhood:"Noho",cuisine:"French",summary:"The hearth-driven menu threads the needle through the south of France and Italy, highlighting dishes such as cast iron sfincione (Sicilian pizza), wood-kissed escargot, and dry-aged côte de bôeuf. ",website:"https://www.rafsnewyork.com",image_url:"",meal_types:["$45 Lunch Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"1250887",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48403-Raf%27s-menu.pdf",primary_location:"Noho",address:"290 Elizabeth St., New York, NY 10012",latitude:40.7246816,longitude:-73.9931371,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/rafsnewyork",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Fogo de Chão Brazilian Steakhouse - Elmhurst",slug:"fogo-de-chao-brazilian-steakhouse-elmhurst",borough:"Queens",neighborhood:"Elmhurst",cuisine:"Brazilian",summary:"The menu includes delectable cuts of grilled meats such as sizzling steaks, lamb, chicken and pork carved tableside by Brazilian trained gaucho chefs as well as a lighter seafood option.",website:"https://fogodechao.com/location/queens",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1231222",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48642-FogodeCh%C3%A3oBrazilianSteakhouse-Elmhurst-menu.pdf",primary_location:"Elmhurst",address:"92-50 59th Ave., Queens, NY 11373",latitude:40.7344322,longitude:-73.8674969,telephone:"(929)3794333",price_range:"$",facebook_url:"https://www.facebook.com/fogorestaurants",instagram_url:"https://instagram.com/fogo",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"8282",slug:"8282",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"Korean",summary:"8282 is a light-hearted, fresh take on Korean food on the Lower East Side.",website:"https://www.eightwoeightwo.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["for-the-foodies"],opentable_id:"",menu_url:"",primary_location:"Lower East Side",address:"84 Stanton St., Manhattan, NY 10002",latitude:40.7216708,longitude:-73.9887463,telephone:"(929)8370360",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/8282nyc",michelin_award:"BIB_GOURMAND",michelin_slug:"8282",nyttop100_rank:""},{name:"Catch n' Chop",slug:"catch-n-chop",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Steakhouse",summary:"Catch n' Chop, situated on the Upper East Side, is a chef-driven modern American steakhouse with a focus on sustainable, fresh seafood and raw bar.",website:"https://catchnchop.com",image_url:"",meal_types:["$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1357879",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49439-Catchn%27Chop-menu.pdf",primary_location:"Upper East Side",address:"1600 Third Ave., Manhattan, NY 10128",latitude:40.7813704,longitude:-73.9524453,telephone:"(646)7070103",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61560525582428",instagram_url:"https://instagram.com/catchnchop",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Margaux by La Sirène",slug:"margaux-by-la-sirene",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"French",summary:"Margaux by La Sirène, a celebrated French restaurant offering an authentic and elegant taste of France since 2007, proudly serves timeless classics made with the finest ingredients and traditional techniques. ",website:"https://margaux.lasirene.nyc",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49750-MargauxbyLaSir%C3%A8ne-menu.pdf",primary_location:"Murray Hill",address:"238 Madison Ave., Manhattan, NY 10016",latitude:40.7499446,longitude:-73.9817461,telephone:"(917)4630379",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/margauxbylasirene",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cha Cha Tang",slug:"cha-cha-tang",borough:"Manhattan",neighborhood:"West Village",cuisine:"Chinese",summary:"This Chinese restaurant offers a playful rendition of a classic “cha chaan teng” (a Hong Kong-style cafe or diner) with a downtown fine-dining ambiance.",website:"https://www.chachatang.com",image_url:"",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["celebrity-chefs"],opentable_id:"1382116",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45663-ChaChaTang-menu.pdf",primary_location:"West Village",address:"257 Sixth Ave., Manhattan, NY 10014",latitude:40.7290259,longitude:-74.002807,telephone:"(212)6450193",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/chachatangnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Meili",slug:"meili",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Chinese",summary:"Meili is a refined Sichuan dining experience in Williamsburg, Brooklyn, that brings the bold, vibrant flavors of Sichuan street food into a sophisticated setting.",website:"https://meiliwilliamsburg.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1410943",menu_url:"",primary_location:"Williamsburg",address:"160 N. 12th St., Brooklyn, NY 11249",latitude:40.7208999,longitude:-73.9555685,telephone:"(516)9601936",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61573028812579",instagram_url:"https://instagram.com/meiliwilliamsburg",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Vetro Restaurant & Lounge",slug:"vetro-restaurant-and-lounge",borough:null,neighborhood:null,cuisine:"Italian",summary:"Vetro Restaurant & Lounge is a waterfront Italian restaurant, lounge and catering venue in Howard Beach, Queens, that has received top accolades for both its cuisine and wine list.",website:"https://vetronyc.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"34984",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/38175-VetroRestaurant%26Lounge-menu.pdf",primary_location:null,address:"164-49 Crossbay Blvd., Queens, NY 11414",latitude:40.6494418,longitude:-73.8370819,telephone:"(718)8438387",price_range:"$",facebook_url:"https://www.facebook.com/vetronyc",instagram_url:"https://instagram.com/vetronyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Raval Steakhouse",slug:"raval-steakhouse",borough:"Staten Island",neighborhood:"Tompkinsville",cuisine:"Steakhouse",summary:"Set on Staten Island’s vibrant north shore, Raval Steakhouse is the vision of lifelong friends who have brought their passion for great food and hospitality back to their Staten Island roots.",website:"https://ravalsteakhouse.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49407-RavalSteakhouse-menu.pdf",primary_location:"Tompkinsville",address:"12 Minthorne St., Staten Island, NY 10301",latitude:40.6371226,longitude:-74.0755683,telephone:"(718)2472323",price_range:"$",facebook_url:"https://www.facebook.com/ravalsteakhouse",instagram_url:"https://instagram.com/raval_steakhouse",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wayward Fare",slug:"wayward-fare",borough:"Brooklyn",neighborhood:"Prospect Heights",cuisine:"Mediterranean",summary:"Wayward Fare, a rustic and elegant culinary journey in Prospect Heights, offers a seasonally charged menu that weaves together a tapestry of some lesser-known Mediterranean flavors.",website:"https://waywardfarebk.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1411408",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49770-WaywardFare-menu.pdf",primary_location:"Prospect Heights",address:"554 Vanderbilt Ave., Brooklyn, NY 11238",latitude:40.6800795,longitude:-73.9682811,telephone:"(347)2211385",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61565434469638",instagram_url:"https://instagram.com/waywardfarebk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Amaranth",slug:"amaranth",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Mediterranean",summary:"Enjoy the typical approach to Mediterranean flavor with a mix of French and Italian cuisine, with generous portions, based on fresh products and full of sunshine and flavors. ",website:"https://www.amaranthrestaurant.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"138700",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45693-Amaranth-menu.pdf",primary_location:"Upper East Side",address:"21 E. 62nd St., Manhattan, NY 10065",latitude:40.7657854,longitude:-73.9703126,telephone:"(212)9806700",price_range:"$",facebook_url:"https://www.facebook.com/amaranthrestaurant",instagram_url:"https://instagram.com/amaranthrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Vestry",slug:"vestry",borough:"Manhattan",neighborhood:"Soho",cuisine:"American (New)",summary:"This dinner and weekend-lunch destination marries New American and Asian-inspired cuisine, emphasizing seasonal ingredients and seafood and vegetable dishes.",website:"https://www.vestrynyc.com",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["dress-for-the-occasion"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/45163-Vestry-menu.pdf",primary_location:"Soho",address:"The Dominick, 246 Spring St., 10013 Manhattan",latitude:40.7254695,longitude:-74.0053343,telephone:"(212)7841350",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/vestrynyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pylos",slug:"pylos",borough:"Manhattan",neighborhood:"East Village",cuisine:"Greek",summary:"Pylos brings fresh, wholesome cooking from all regions of Greece to an elegant, contemporary and comfortable setting in the East Village.",website:"https://pylosrestaurant.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46610-Pylos-menu.pdf",primary_location:"East Village",address:"128 E. 7th St.",latitude:40.7260604,longitude:-73.9841737,telephone:"(212)4730220",price_range:"$",facebook_url:"https://www.facebook.com/Pylos128",instagram_url:"https://instagram.com/pylosnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Guksu Jip",slug:"guksu-jip",borough:"Queens",neighborhood:"Flushing",cuisine:"Korean",summary:"Flushing's Guksu Jip serves various noodle dishes,includin special naengmyun (cold noodles with rich toppings), mul naengmyun (cold soup noodle), bibim naengmyun (spicy cold noodle), and hot noodle soup. ",website:"https://guksujip.com",image_url:"",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Flushing",address:"160-28 Northern Blvd., Queens, NY 11358",latitude:40.7623422,longitude:-73.804744,telephone:"(718)7990885",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/guksujip",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Altair",slug:"altair",borough:"Manhattan",neighborhood:"Garment District",cuisine:"American (New)",summary:"Located inside the Arlo Midtown, Altair serves modern American fare inspired by celestial wonder. ",website:"https://www.altairnyc.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1283761",menu_url:"",primary_location:"Garment District",address:"Arlo Midtown, 351 W. 38th St., 10018 Manhattan",latitude:40.75574,longitude:-73.9937868,telephone:"(212)3437000",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/altairnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"SEA by Jungsik",slug:"sea-by-jungsik",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Thai",summary:"SEA is a vibrant, fun Southeast Asian restaurant from chef Jungsik Yim, with a raw bar, small plates and shareable plates, along with a smart beverage program. ",website:"https://www.ny-sea.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49922-SEAbyJungsik-menu.pdf",primary_location:"Chelsea",address:"151 W. 30th St., Manhattan, NY 10001",latitude:40.7484352,longitude:-73.9917764,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/iseaunyc",michelin_award:"",michelin_slug:"",nyttop100_rank:57},{name:"Zoì Mediterranean Cuisine",slug:"zoi-mediterranean-cuisine",borough:"Manhattan",neighborhood:"Koreatown",cuisine:"Mediterranean",summary:"Located within The Life Hotel, a landmark of elegance and history, Zoì offers a refined yet welcoming dining experience where tradition meets innovation.",website:"https://www.zoinomad.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1379803",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49733-ZoiMediterraneanCuisine-menu.pdf",primary_location:"Koreatown",address:"19 W. 31st St., Manhattan, NY 10001",latitude:40.7472238,longitude:-73.9870206,telephone:"(347)6772035",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pecora Bianca Bryant Park",slug:"la-pecora-bianca-bryant-park",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Italian",summary:"La Pecora Bianca Bryant Park offers an expanded menu from Mario Batali alum Cruz Goler in a bright, sophisticated space.",website:"https://www.lapecorabianca.com/location/bryant-park",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Midtown West",address:"20 W. 40th St., Manhattan, NY 10018",latitude:40.7525176,longitude:-73.9831529,telephone:"(212)9244040",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lapecorabianca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Little Alley",slug:"little-alley",borough:"Manhattan",neighborhood:"Murray Hill",cuisine:"Chinese",summary:"Chef Yuchun Cheung, born and raised in one of Shanghai’s little alleys in a family of chefs and restaurateurs, decided that Little Alley should recreate the Shanghainese cuisine that he grew up with. ",website:"https://www.littlealley.nyc",image_url:"",meal_types:["$45 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"488713",menu_url:"",primary_location:"Murray Hill",address:"550 Third Ave., Manhattan, NY 10016",latitude:40.7474242,longitude:-73.9772312,telephone:"(646)9983976",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"BIB_GOURMAND",michelin_slug:"little-alley",nyttop100_rank:""},{name:"Tonchin Brooklyn",slug:"tonchin-brooklyn",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Japanese / Sushi",summary:"A modern Japanese restaurant featuring a full a la carte menu grounded in traditional flavors, with a New American twist.",website:"https://www.tonchinus.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48499-TonchinBrooklyn-menu.pdf",primary_location:"Williamsburg",address:"109 N. 3rd St., Brooklyn, NY 11249",latitude:40.716755,longitude:-73.9616957,telephone:"(347)4575528",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/tonchinbrooklyn",michelin_award:"BIB_GOURMAND",michelin_slug:"tonchin",nyttop100_rank:""},{name:"Docks Off 5th",slug:"docks-off-5th",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Seafood",summary:"This seafood-centric restaurant, steps away from Radio City Music Hall and Rockefeller Center, offers an unforgettable dining experience with Insta-worthy dishes, drinks and décor.",website:"https://docksoff5th.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1372909",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49926-DocksOff5th-menu.pdf",primary_location:"Midtown West",address:"25 W. 51st St., Manhattan, NY 10019",latitude:40.7599287,longitude:-73.9781925,telephone:"(646)6494471",price_range:"$",facebook_url:"https://www.facebook.com/docksoff5th",instagram_url:"https://instagram.com/docksoff5th",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"iNine Bistro",slug:"inine-bistro",borough:"The Bronx",neighborhood:"Mott Haven",cuisine:"Eclectic",summary:"Located in the Port Morris section of the Bronx, iNine boasts curated dishes from all over the world",website:"https://ininebistro.com",image_url:"",meal_types:["$45 Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Mott Haven",address:"53 Bruckner Blvd., Bronx, NY 10454",latitude:40.8067729,longitude:-73.9266819,telephone:"(929)2659682",price_range:"$",facebook_url:"https://www.facebook.com/iNINEBistro",instagram_url:"https://instagram.com/ininebistro",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Kahlo",slug:"kahlo-modern-mexican-cuisine",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Mexican",summary:"Enjoy guacamole, elevated tacos and plates of chicken mole and barbacoa, and choose from a long list of tequilas, mezcals and seasonal cocktails to accompany your meal.",website:"https://www.kahlonyc.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1027528",menu_url:"",primary_location:"Chelsea",address:"525 W. 29th St., Manhattan, NY 10001",latitude:40.7521891,longitude:-74.0026298,telephone:"(212)2560083",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/kahlonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Atlantis Prime",slug:"atlantis-prime",borough:"Manhattan",neighborhood:"Herald Square",cuisine:"Steakhouse",summary:"Atlantis Prime offers a refined surf-and-turf experience near Herald Square in Manhattan, showcasing prime dry-aged steaks, fresh seafood, and expertly crafted sides in an elegant, modern setting. ",website:"https://www.atlantisprimerestaurant.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49734-AtlantisPrime-menu.pdf",primary_location:"Herald Square",address:"38 W. 36th St., Manhattan, NY 10018",latitude:40.7502737,longitude:-73.9854762,telephone:"(212)2580756",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61576224775387",instagram_url:"https://instagram.com/atlantisprimenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Table d'Hote",slug:"table-dhote",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"French",summary:"With a small traditional menu, and a warm and inviting dining area, Table d'Hote is ideal for an intimate and delectable meal.",website:"https://tabledhote.co",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"44 E. 92nd St., Manhattan, NY 10128",latitude:40.7844463,longitude:-73.9558382,telephone:"(212)3488125",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/tabledhotenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dhamaka",slug:"dhamaka",borough:"Manhattan",neighborhood:"Lower East Side",cuisine:"Indian",summary:"Located at Essex Market on the Lower East Side of Manhattan, Dhamaka dives deep into the bold, provincial cooking rarely seen outside of Indian homes and roadside stalls.",website:"https://www.dhamaka.nyc",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47772-Dhamaka-menu.pdf",primary_location:"Lower East Side",address:"Essex Market, 119 Delancey St., Manhattan Store #34",latitude:40.7180658,longitude:-73.9881304,price_range:"$",facebook_url:"https://www.facebook.com/dhamakanyc",instagram_url:"https://instagram.com/dhamakanyc",michelin_award:"BIB_GOURMAND",michelin_slug:"dhamaka",nyttop100_rank:38},{name:"Benihana",slug:"benihana",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Japanese / Sushi",summary:"Benihana is a dining experience unlike any other: guests are seated at communal tables in groups, where a personal chef will perform the ancient art of teppanyaki.",website:"https://www.benihana.com/locations/newyorkwest-ny-we",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"87049",menu_url:"",primary_location:"Midtown West",address:"47 W. 56th St., Manhattan, NY 10019",latitude:40.7634526,longitude:-73.9767844,telephone:"(212)5810930",price_range:"$",facebook_url:"https://www.facebook.com/Benihana",instagram_url:"https://instagram.com/benihana",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Dos Caminos Lexington",slug:"dos-caminos-lexington",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Mexican",summary:"Margaritas and Mexican cuisine meet serious south-of-the-border style at this boisterous, popular mega-eatery.",website:"https://www.doscaminos.com/location/dos-caminos-lexington",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1256302",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48161-DosCaminosLexington-menu.pdf",primary_location:"Midtown East",address:"480 Lexington Ave., Manhattan, NY 10167",latitude:40.754543,longitude:-73.9741687,telephone:"(332)2265038",price_range:"$",facebook_url:"https://www.facebook.com/doscaminos",instagram_url:"https://instagram.com/doscaminos",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Safari",slug:"safari",borough:"Manhattan",neighborhood:"Harlem",cuisine:"African",summary:"Safari, located on a busy block in Harlem, may be the only Somali restaurant in the City.",website:"https://safariharlem.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/43863-Safari-menu.pdf",primary_location:"Harlem",address:"55 St. Nicholas Ave., Manhattan, NY 10026",latitude:40.8006605,longitude:-73.9527667,telephone:"(646)9644252",price_range:"$",facebook_url:"https://www.facebook.com/safarinyc",instagram_url:"https://instagram.com/safariharlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pepolino",slug:"pepolino",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"Italian",summary:"Pepolino serves authentic Tuscan cuisine in TriBeCa.",website:"https://www.pepolino.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48111-Pepolino-menu.pdf",primary_location:"Tribeca",address:"281 West Broadway, Manhattan, NY 10013",latitude:40.7207621,longitude:-74.0048877,telephone:"(212)9669983",price_range:"$",facebook_url:"https://www.facebook.com/pepolinorestaurant",instagram_url:"https://instagram.com/pepolinorestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Max's Esca",slug:"maxs-esca",borough:"Staten Island",neighborhood:"Todt Hill",cuisine:"Continental",summary:"Max's Esca is a premier destination for exceptional dining and fine Italian cuisine on Staten Island.",website:"https://www.maxsesca.com",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Todt Hill",address:"1559 Richmond Rd., Staten Island, NY 10304",latitude:40.5915008,longitude:-74.1012157,telephone:"(718)9805006",price_range:"$",facebook_url:"https://www.facebook.com/Maxsesca",instagram_url:"https://instagram.com/maxsesca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gage & Tollner",slug:"gage-tollner",borough:"Brooklyn",neighborhood:"Downtown Brooklyn",cuisine:"American (Traditional)",summary:"Gage & Tollner, opened in 1879, is the oldest landmark restaurant in New York, featuring Victorian decor and working gas lamps.",website:"https://www.gageandtollner.com",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/7623-Gage%26Tollner-menu.pdf",primary_location:"Downtown Brooklyn",address:"372 Fulton St., Brooklyn, NY 11201",latitude:40.691317,longitude:-73.987861,telephone:"(347)6893677",price_range:"$",facebook_url:"https://www.facebook.com/gagetollner",instagram_url:"https://instagram.com/gage.and.tollner",michelin_award:"",michelin_slug:"",nyttop100_rank:45},{name:"Addictive Wine & Tapas Bar",slug:"addictive-wine-tapas-bar",borough:"Queens",neighborhood:"East Elmhurst",cuisine:"Spanish",summary:"This tapas bar/restaurant serves dishes with influences of Spain and other Mediterranean countries. ",website:"https://addictivewinebar.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46571-AddictiveWine%26TapasBar-menu.pdf",primary_location:"East Elmhurst",address:"32-64 87th St., Queens, NY 11372",latitude:40.7563856,longitude:-73.8809011,telephone:"(347)8320951",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Smyth Tavern",slug:"smyth-tavern",borough:"Manhattan",neighborhood:"Tribeca",cuisine:"American (Traditional)",summary:"Smyth Tavern serves American tavern fare in Tribeca, featuring fresh fish, raw bar, dry-aged steaks, homemade pastas and a specialty burger.",website:"https://www.smythtavern.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price","$30 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1260085",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46693-SmythTavern-menu.pdf",primary_location:"Tribeca",address:"Smyth Tribeca, 85 West Broadway, 10007 Manhattan",latitude:40.7152566,longitude:-74.0091255,telephone:"(646)8139090",price_range:"$",facebook_url:"https://www.facebook.com/smythtavern",instagram_url:"https://instagram.com/smythtavern",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Enoteca Harlem",slug:"enoteca-harlem",borough:"Manhattan",neighborhood:"Harlem",cuisine:"Spanish",summary:"Enoteca Harlem was born from a journey to the Basque Country, the calmness of the coastal life, the scent of the sea breeze sweeping over the vineyards, and the joy of savoring fresh, local ingredients.",website:"https://www.enotecaharlem.com",image_url:"",meal_types:["$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Harlem",address:"2220 Frederick Douglass Blvd., Manhattan, NY 10026",latitude:40.8066646,longitude:-73.9534125,telephone:"(917)9934459",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/enoteca_harlem",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Gyu-Kaku Japanese BBQ – Flushing",slug:"gyu-kaku-japanese-bbq-flushing",borough:"Queens",neighborhood:"Flushing",cuisine:"Japanese / Sushi",summary:"Gyu-Kaku specializes in yakiniku—Japanese barbecue meat over a charcoal grill.",website:"https://www.gyu-kaku.com/flushing",image_url:"",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"729334",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48137-Gyu-KakuJapaneseBBQ%E2%80%93Flushing-menu.pdf",primary_location:"Flushing",address:"40-52 Main St., fl. 2, 11354 Queens",latitude:40.7581905,longitude:-73.8297312,telephone:"(347)5423653",price_range:"$",facebook_url:"https://www.facebook.com/GyuKakuJBBQ",instagram_url:"https://instagram.com/gyukakujbbq",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cacío e Pepe - East Village",slug:"cacio-e-pepe-east-village",borough:"Manhattan",neighborhood:"East Village",cuisine:"Italian",summary:"Cacío e Pepe is an authentic Italian restaurant named for its signature Roman dish—cacío e pepe—homemade pasta theatrically tossed out of a wheel of pecorino cheese.",website:"https://eastvillage.cacioepepe.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:["date-night"],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49209-CacioePepe-EastVillage-menu.pdf",primary_location:"East Village",address:"182 Second Ave., Manhattan, NY 10003",latitude:40.7306378,longitude:-73.9859258,telephone:"(212)5055931",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/cacioepepenyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Akoya",slug:"akoya",borough:"Manhattan",neighborhood:"Times Square/Theatre District",cuisine:"Japanese / Sushi",summary:"A hidden gem inside St. Cloud Rooftop Bar, Akoya offers guests an authentic temaki experience in an intimate and elevated setting atop The Knickerbocker Hotel.",website:"https://www.theknickerbocker.com/dine-drink/akoya",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49736-Akoya-menu.pdf",primary_location:"Times Square/Theatre District",address:"The Knickerbocker, 6 Times Square, 10036 Manhattan",latitude:40.7555831,longitude:-73.9862701,price_range:"$",facebook_url:"https://www.facebook.com/akoyanyc",instagram_url:"https://instagram.com/akoyanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Pig and Khao - Upper West Side",slug:"pig-and-khao-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"Pan-Asian",summary:"Pig and Khao is inspired by chef Leah Cohen's Filipino heritage and extensive travels throughout Southeast Asia.",website:"https://www.pigandkhao.com/uws",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1379533",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49780-PigandKhao-UpperWestSide-menu.pdf",primary_location:"Upper West Side",address:"433 Amsterdam Ave., Manhattan, NY 10024",latitude:40.784167,longitude:-73.9772473,telephone:"(646)3701430",price_range:"$",facebook_url:"https://www.facebook.com/PigAndKhao",instagram_url:"https://instagram.com/pigandkhao",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Laut",slug:"laut",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Asian Fusion",summary:"Laut presents the best recipes, dishes and flavors from South East Asia, preserving the flavor profiles of each dish while maintaining the integrity of each cuisine.",website:"https://lautnyc.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Union Square",address:"15 E. 17th St., Manhattan, NY 10003",latitude:40.7376076,longitude:-73.9910716,telephone:"(212)2068989",price_range:"$",facebook_url:"https://www.facebook.com/Lautnyc",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Amélie - West Village",slug:"amelie-west-village",borough:"Manhattan",neighborhood:"Greenwich Village",cuisine:"French",summary:"At this Greenwich Village location, the intention is to make good wine accessible, affordable and fun.",website:"https://www.ameliewinebar.com/home-amelie-west",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"82891",menu_url:"",primary_location:"Greenwich Village",address:"22 W. 8th St., Manhattan, NY 10011",latitude:40.7326534,longitude:-73.9976785,telephone:"(212)5332962",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/ameliebistronyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Hortus NYC",slug:"hortus-nyc",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Asian Fusion",summary:"The modern Asian cuisine at Hortus NYC reflects global influences.",website:"https://www.hortusnyc.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1025956",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44548-HortusNYC-menu.pdf",primary_location:"Nomad",address:"271 Fifth Ave., Front A, 10016 Manhattan",latitude:40.7454063,longitude:-73.9863775,telephone:"(646)8583784",price_range:"$",facebook_url:"https://www.facebook.com/hortusnyc",instagram_url:"https://instagram.com/hortusnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Carib-Soul Bk",slug:"carib-soul-bk",borough:"Brooklyn",neighborhood:"Prospect Heights",cuisine:"Caribbean",summary:"Carib-Soul brings bold Caribbean flavors to Prospect Heights, Brooklyn in a casual, welcoming setting.",website:"https://www.caribsoulbkny.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48612-CaribSoulBk-menu.pdf",primary_location:"Prospect Heights",address:"662 Washington Ave., Brooklyn, NY 11238",latitude:40.6783212,longitude:-73.9641432,telephone:"(845)5925517",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61550997794376",instagram_url:"https://instagram.com/caribsoulbrooklyn",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wildflower",slug:"wildflower",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"American (New)",summary:"Nestled beneath the iconic High Line, Wildflower offers an exceptional fusion of innovative cocktails and contemporary New American cuisine, thoughtfully crafted by the culinary director, chef Edwin Rivera.",website:"https://www.wildflowernyc.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49772-Wildflower-menu.pdf",primary_location:"Chelsea",address:"505 W. 23rd St., Manhattan, NY 10011",latitude:40.7479939,longitude:-74.0043708,telephone:"(917)5080007",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Little Fino",slug:"little-fino",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"Italian",summary:"Little Fino is an all day neighborhood bar and cafe located in North Williamsburg that serves a menu of Italian-inspired 'little somethings' alongside a playful cocktail list.",website:"https://www.littlefinonyc.com",image_url:"",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1431508",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49785-LittleFino-menu.pdf",primary_location:"Williamsburg",address:"111 N. 12th St., Brooklyn, NY 11249",latitude:39.9542354,longitude:-75.1594106,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/littlefinonyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Charoen Krung Thai Restaurant",slug:"charoen-krung-thai-restaurant",borough:"Manhattan",neighborhood:"Midtown East",cuisine:"Thai",summary:"​Experience the flavors of Bangkok at Charoen Krung Thai Restaurant, a Midtown East gem offering authentic Thai cuisine.",website:"https://www.charoenkrungnyc.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49823-CharoenKrungThaiRestaurant-menu.pdf",primary_location:"Midtown East",address:"955 Second Ave., Manhattan, NY 10022",latitude:40.755375,longitude:-73.9685168,telephone:"(929)7899456",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/charoenkrung_thai",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Cafe Zaffri",slug:"cafe-zaffri",borough:"Manhattan",neighborhood:"Union Square",cuisine:"Middle Eastern",summary:"The sprawling restaurant, located inside The Twenty Two New York, a hotel and private members club located in Union Square, serves modern interpretations on Levantine cuisine and its diaspora.",website:"https://cafezaffri.com",image_url:"",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"1388065",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49925-CafeZaffri-menu.pdf",primary_location:"Union Square",address:"16 E. 16th St., Manhattan, NY 10003",latitude:40.7327406,longitude:-73.9817553,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Zaytinya",slug:"zaytinya",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Mediterranean",summary:"Zaytinya offers an innovative mezze menu inspired by Turkish, Greek and Lebanese cuisines served up in a sleek and modern setting.",website:"https://www.zaytinya.com/location/new-york",image_url:"",meal_types:["$30 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1183219",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/47933-Zaytinya-menu.pdf",primary_location:"Nomad",address:"The Ritz-Carlton New York NoMad, 1185 Broadway, 10001 Manhattan",latitude:40.7454944,longitude:-73.9889085,telephone:"(212)8049070",price_range:"$",facebook_url:"https://www.facebook.com/zaytinyany",instagram_url:"https://instagram.com/zaytinya",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"María Mulata",slug:"maria-mulata",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Colombian",summary:"The restaurant offers a versatile, rich and colorful cuisine, and strives to represent every corner of Colombia with nature, art, elegance and biodiversity.",website:"https://www.mariamulatanyc.com",image_url:"",meal_types:["$45 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1346644",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49029-MariaMulata-menu.pdf",primary_location:"Upper East Side",address:"1007 Lexington Ave., Manhattan, NY 10021",latitude:40.7707301,longitude:-73.9617393,telephone:"(646)9464753",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Sungold",slug:"sungold",borough:"Brooklyn",neighborhood:"Williamsburg",cuisine:"American (New)",summary:"With an eye on the Mediterranean, chef Michael King and his team craft wood fired pizzas, handmade pastas, and large and small plates to share.",website:"https://www.sungoldbk.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)"],collections:[],opentable_id:"987481",menu_url:"",primary_location:"Williamsburg",address:"Arlo Williamsburg, 96 Wythe Ave., 11249 Brooklyn",latitude:40.7215045,longitude:-73.9587016,telephone:"(718)3628100",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/sungoldbk",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Anassa Taverna - Downtown",slug:"anassa-taverna-downtown",borough:"Manhattan",neighborhood:"Battery Park City",cuisine:"Greek",summary:"Nestled in Battery Park City, Anassa is an elegant interpretation of the traditional Greek taverna.",website:"https://anassataverna.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46067-AnassaTaverna-Downtown-menu.pdf",primary_location:"Battery Park City",address:"104 North End Ave., Manhattan, NY 10282",latitude:40.7153683,longitude:-74.0154941,telephone:"(718)7215050",price_range:"$",facebook_url:"https://www.facebook.com/anassanyc",instagram_url:"https://instagram.com/anassagroup",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Ishq",slug:"ishq",borough:"Manhattan",neighborhood:"East Village",cuisine:"Indian",summary:"The menu at this East Village restaurant is a celebration of India's culinary treasures—from aromatic curries to flavorful tandoori offerings, all made with the finest spices and ingredients. ",website:"https://www.ishq.nyc",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49454-Ishq-menu.pdf",primary_location:"East Village",address:"202 Avenue A, Manhattan, NY 10009",latitude:40.7293646,longitude:-73.9808662,telephone:"(646)5594747",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/ishqnyc",michelin_award:"BIB_GOURMAND",michelin_slug:"ishq",nyttop100_rank:""},{name:"Le B.",slug:"le-b",borough:"Manhattan",neighborhood:"West Village",cuisine:"French",summary:"Tableside presentations, intricate flavors, and forgotten pleasures mined from the history books are hallmarks of Le B.’s ethos.",website:"https://lebnyc.com",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)"],collections:[],opentable_id:"1319164",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48395-LeB.-menu.pdf",primary_location:"West Village",address:"283 W. 12th St., Manhattan, NY 10014",latitude:40.737684,longitude:-74.0040136,telephone:"(212)6752808",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/restaurantlebnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Amélie - Upper West Side",slug:"amelie-upper-west-side",borough:"Manhattan",neighborhood:"Upper West Side",cuisine:"French",summary:`"La Petite Amélie" is smaller and more intimate than Amélie's other locations, but has the same look and vibe.`,website:"https://www.amelieupperwest.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper West Side",address:"566 Amsterdam Ave., Manhattan, NY 10024",latitude:40.7887508,longitude:-73.9746244,telephone:"(646)4227167",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/ameliebistronyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Romeo's Italian Restaurant",slug:"romeos-italian-restaurant",borough:"Queens",neighborhood:"Jackson Heights",cuisine:"Italian",summary:"Romeo's Italian Restaurant offers fine Italian dining in Jackson Heights, Queens.",website:"https://romeositalianrestaurant.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1029109",menu_url:"",primary_location:"Jackson Heights",address:"74-27 37th Ave., Queens, NY 11372",latitude:40.749183,longitude:-73.8910294,telephone:"(718)4582174",price_range:"$",facebook_url:"https://www.facebook.com/romeositalianrestaurant",instagram_url:"https://instagram.com/romeositalianrestaurant",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Tinos",slug:"tinos",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Greek",summary:"Named after the picturesque Greek island known for its rich culture and stunning views, Tinos combines the charm of the Mediterranean with the taste of time-honored recipes.",website:"https://www.tinosnyc.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1269628",menu_url:"",primary_location:"Upper East Side",address:"1748 First Ave., Manhattan, NY 10128",latitude:40.7796701,longitude:-73.9469814,telephone:"(646)3706067",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/tinosnyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Wan Waan",slug:"wan-waan",borough:"Manhattan",neighborhood:"Chelsea",cuisine:"Thai",summary:"The team at Wan Waan, a Thai restaurant in the Chelsea neighborhood of Manhattan, emphasizes feelings through the taste of food.",website:"https://wannyc.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Lunch/Brunch Price","$60 Sunday Dinner Price"],participation_weeks:["Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Chelsea",address:"200 Eighth Ave., Manhattan, NY 10011",latitude:40.7434814,longitude:-73.9995027,telephone:"(646)5908994",price_range:"$",facebook_url:"https://www.facebook.com/wanwaan.nyc",instagram_url:"https://instagram.com/wanwaan.nyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Fogo de Chão Brazilian Steakhouse - Brooklyn",slug:"fogo-de-chao-brazilian-steakhouse-brooklyn",borough:"Brooklyn",neighborhood:"Downtown Brooklyn",cuisine:"Brazilian",summary:"This Downtown Brooklyn restaurant features an open churrasco grill giving guests a 360-degree view of gaucho chefs demonstrating the culinary art of churrasco.",website:"https://fogodechao.com/location/brooklyn",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"1344280",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/48872-FogodeCh%C3%A3oBrazilianSteakhouse-Brooklyn-menu.pdf",primary_location:"Downtown Brooklyn",address:"445 Albee Sq. W., Brooklyn, NY 11201",latitude:40.6907244,longitude:-73.9832855,telephone:"(917)9792550",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mas Tortilla",slug:"mas-tortilla",borough:"Queens",neighborhood:"Forest Hills",cuisine:"Mexican",summary:"Mas Tortilla is a Mexican restaurant, taquiera and cantina in Forest Hills, Queens.",website:"https://mastortilla.com",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$30 Sunday Lunch/Brunch Price","$30 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/46672-MasTortilla-menu.pdf",primary_location:"Forest Hills",address:"113-27B Queens Blvd., Queens, NY 11375",latitude:40.7175843,longitude:-73.8348158,telephone:"(718)4806439",price_range:"$",facebook_url:"https://www.facebook.com/MasTortillaRestaurant",instagram_url:"https://instagram.com/mastortillany",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Levant on Smith",slug:"levant-on-smith",borough:"Brooklyn",neighborhood:"Carroll Gardens",cuisine:"French",summary:"Enjoy traditional French cuisine with a touch of Mediterranean flair, beautifully complemented by handcrafted, inspired drinks.",website:"https://www.levantonsmith.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1224880",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49369-LevantonSmith-menu.pdf",primary_location:"Carroll Gardens",address:"223 Smith St., Brooklyn, NY 11201",latitude:40.6842168,longitude:-73.9919312,telephone:"(347)6893694",price_range:"$",facebook_url:"https://www.facebook.com/LevantonSmith",instagram_url:"https://instagram.com/levantonsmith",michelin_award:"",michelin_slug:"",nyttop100_rank:67},{name:"Masalawala & Sons",slug:"masalawala-and-sons",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Indian",summary:"Restaurateur Roni Mazumdar and Chintan Pandya explore the yesteryears of India from the perspective of a 75-year-old immigrant man from Kolkata—Roni’s father. ",website:"https://www.masalawala.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49245-Masalawala%26Sons-menu.pdf",primary_location:"Park Slope",address:"365 5th Ave., Brooklyn, NY 11215",latitude:40.6712763904,longitude:-73.9843422132,price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/masalawalanyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Café Carmellini",slug:"cafe-carmellini",borough:"Manhattan",neighborhood:"Nomad",cuisine:"Italian",summary:"James Beard Award-winning chef Andrew Carmellini distills his 30-year career into an extraordinary culinary experience that marks his return to fine dining.",website:"https://www.cafecarmellini.com",image_url:"",meal_types:["$60 Lunch Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49840-Caf%C3%A9Carmellini-menu.pdf",primary_location:"Nomad",address:"250 Fifth Ave., Manhattan, NY 10001",latitude:40.4406972,longitude:-80.0009386,telephone:"(212)2319200",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/cafecarmellini",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"La Pecora Bianca Upper East Side",slug:"la-pecora-bianca-upper-east-side",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"Italian",summary:"La Pecora Bianca Upper East Side offers an expanded menu from Mario Batali alum Cruz Goler in a bright, sophisticated space.",website:"https://www.lapecorabianca.com/location/la-pecora-bianca-upper-east-side",image_url:"",meal_types:["$30 Lunch Price","$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"",menu_url:"",primary_location:"Upper East Side",address:"1562 Second Ave., Manhattan, NY 10028",latitude:40.774638,longitude:-73.953736,telephone:"(212)3009840",price_range:"$",facebook_url:"https://www.facebook.com/nyctourism",instagram_url:"https://instagram.com/lapecorabianca",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Verde on Smith",slug:"verde-on-smith",borough:"Brooklyn",neighborhood:"Cobble Hill",cuisine:"Italian",summary:"Verde on Smith is Cobble Hill, Brooklyn's neighborhood eatery, featuring regional Italian cuisine complemented by friendly service and warm ambiance. ",website:"https://www.verdeonsmith.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"59281",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/44088-VerdeonSmith-menu.pdf",primary_location:"Cobble Hill",address:"216 Smith St., Brooklyn, NY 11201",latitude:40.6844516,longitude:-73.9922475,telephone:"(718)2221525",price_range:"$",facebook_url:"https://www.facebook.com/VerdeOnSmith",instagram_url:"https://instagram.com/verdeonsmith",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Flatiron Steakhouse",slug:"flatiron-steakhouse",borough:"Brooklyn",neighborhood:"Park Slope",cuisine:"Steakhouse",summary:"Flatiron Steakhouse is a restaurant in Park Slope, Brooklyn, with an old-school neighborhood vibe.",website:"https://flatironrestaurant.com",image_url:"",meal_types:["$45 Dinner Price","$45 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1241614",menu_url:"",primary_location:"Park Slope",address:"397 Fifth Ave., Brooklyn, NY 11215",latitude:40.6704735,longitude:-73.9849201,telephone:"(718)9654000",price_range:"$",facebook_url:"https://www.facebook.com/flatironparkslope",instagram_url:"https://instagram.com/flatironparkslope",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Mastro's Steakhouse NYC",slug:"mastros-steakhouse-nyc",borough:"Manhattan",neighborhood:"Midtown West",cuisine:"Steakhouse",summary:"Mastro's collection of sophisticated steakhouses and Ocean Clubs has brought its masterful combination of world-class service, highly acclaimed cuisine and refinement to New York City.",website:"https://www.mastrosrestaurants.com/location/mastros-steakhouse-new-york",image_url:"",meal_types:["$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)"],collections:[],opentable_id:"151816",menu_url:"",primary_location:"Midtown West",address:"1285 Sixth Ave., Manhattan, NY 10019",latitude:40.7611039,longitude:-73.9801635,telephone:"(212)4591222",price_range:"$",facebook_url:"https://www.facebook.com/mastrosrestaurants",instagram_url:"https://www.instagram.com/nyctourism",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Y Space BBQ",slug:"y-space-bbq",borough:"Queens",neighborhood:"Flushing",cuisine:"Barbecue",summary:"Y Space BBQ's expert chefs skillfully blend traditional grilling techniques with innovative culinary creations, ensuring every bite is a voyage of discovery.",website:"https://www.yspace-bbq.com",image_url:"",meal_types:["$30 Lunch Price","$60 Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49924-YSpaceBBQ-menu.pdf",primary_location:"Flushing",address:"138-25 39th Ave., Queens, NY 11354",latitude:40.7609319,longitude:-73.8280482,telephone:"(718)9689888",price_range:"$",facebook_url:"https://www.facebook.com/profile.php?id=61553224456481",instagram_url:"https://instagram.com/yspacebbq.ny",michelin_award:"",michelin_slug:"",nyttop100_rank:""},{name:"Supper Club by Le Petit Parisien",slug:"supper-club-by-le-petit-parisien",borough:"Manhattan",neighborhood:"Upper East Side",cuisine:"French",summary:"This Upper East Side restaurant is a collaboration between Le Petit Parisien and chef Josh Newman, offering unique seasonal menus. ",website:"https://supperclublpp.com",image_url:"",meal_types:["$60 Dinner Price","$60 Sunday Dinner Price"],participation_weeks:["Week 1 (July 21 - July 27)","Week 3 (Aug 4 - Aug 10)","Week 4 (Aug 11 - Aug 17)","Week 5 (Aug 18 - Aug 24)","Week 6 (Aug 25 - Aug 31)"],collections:[],opentable_id:"1318996",menu_url:"https://nyc-tourism-public.s3.amazonaws.com/srw25/menus/49797-SupperClubbyLePetitParisien-menu.pdf",primary_location:"Upper East Side",address:"355 E. 78th St., Manhattan, NY 10075",latitude:40.7719617,longitude:-73.9535505,telephone:"(917)2620910",price_range:"$",facebook_url:"https://www.facebook.com/lepetitparisienusa",instagram_url:"https://instagram.com/lepetitparisiennyc",michelin_award:"",michelin_slug:"",nyttop100_rank:""}];function nM(){const[c,m]=ta.useState([]),[v,P]=ta.useState([]),[L,B]=ta.useState(null),[K,o]=ta.useState({}),[_e,Ie]=ta.useState([]),[pt,dt]=ta.useState(""),[Xe,zt]=ta.useState([]),[St,He]=ta.useState(!1);ta.useEffect(()=>{m(z_),P(z_);const oi=window.location.hash;if(oi&&oi.includes("favorites=")){const Yt=oi.split("favorites=")[1].split("&")[0],Bn=decodeURIComponent(Yt).split(",").map(Ki=>{var It;return(It=z_.find(wi=>wi.slug===Ki))==null?void 0:It.name}).filter(Ki=>Ki!==void 0);zt(Bn),localStorage.setItem("restaurantFavorites",JSON.stringify(Bn))}else{const Yt=localStorage.getItem("restaurantFavorites");Yt&&zt(JSON.parse(Yt))}},[]);const yi=oi=>{const Yt=Xe.includes(oi)?Xe.filter(ci=>ci!==oi):[...Xe,oi];zt(Yt),localStorage.setItem("restaurantFavorites",JSON.stringify(Yt)),Ee(Yt)},Ee=oi=>{if(oi.length===0){const ci=window.location.hash.replace(/&?favorites=[^&]*/,"");window.location.hash=ci||"#"}else{const Yt=oi.map(Bn=>{var Ki;return(Ki=z_.find(It=>It.name===Bn))==null?void 0:Ki.slug}).filter(Bn=>Bn!==void 0),ci=encodeURIComponent(Yt.join(","));window.location.hash=`favorites=${ci}`}},Ae=()=>{He(!St)},Oe=oi=>{dt(oi);let Yt=c;oi.trim()&&(Yt=Yt.filter(ci=>ci.name.toLowerCase().includes(oi.toLowerCase()))),Yt=vt(Yt),P(Yt)},vt=oi=>{let Yt=oi;return St&&(Yt=Yt.filter(ci=>Xe.includes(ci.name))),Object.entries(K).forEach(([ci,Bn])=>{Bn.length>0&&(Yt=Yt.filter(Ki=>{switch(ci){case"Cuisine":return Bn.includes(Ki.cuisine);case"Participating Weeks":return Bn.some(It=>Ki.participation_weeks.includes(It));case"Meal Types":return Bn.some(It=>Ki.meal_types.includes(It));case"Collections":return Bn.some(It=>Ki.collections.includes(It));case"Has Menu":return Ki.menu_url&&Ki.menu_url.trim()!==""&&Ki.menu_url.toLowerCase()!=="na";default:return!0}}))}),_e.length>0&&(Yt=Yt.filter(ci=>_e.some(Bn=>{switch(Bn){case"michelin":return ci.michelin_award&&["ONE_STAR","TWO_STARS","THREE_STARS"].includes(ci.michelin_award);case"bib":return ci.michelin_award==="BIB_GOURMAND";case"nyt":return ci.nyttop100_rank;case"regular":return!ci.michelin_award&&!ci.nyttop100_rank;default:return!1}}))),Yt},Ot=(oi,Yt)=>{const ci={...K};Yt.length===0?delete ci[oi]:ci[oi]=Yt,o(ci)},Qt=oi=>{Ie(Yt=>Yt.includes(oi)?Yt.filter(ci=>ci!==oi):[...Yt,oi])},ti=oi=>{B(oi)},ri=()=>{o({}),Ie([]),dt(""),B(null),He(!1)};return ta.useEffect(()=>{let oi=c;pt.trim()&&(oi=oi.filter(Yt=>Yt.name.toLowerCase().includes(pt.toLowerCase()))),oi=vt(oi),P(oi)},[K,_e,pt,c,Xe,St]),gt.jsxs("div",{className:"app",children:[gt.jsx(XP,{}),gt.jsx("div",{className:"filter-bar-container",children:gt.jsx("div",{className:"filter-bar",children:gt.jsx(tM,{onSearch:Oe,onFilterChange:Ot,restaurantCount:v.length,allRestaurants:c,onResetAll:ri,onRestaurantSelect:ti,favorites:Xe,onFavoritesToggle:Ae,favoritesActive:St})})}),gt.jsxs("div",{className:"map-section",children:[gt.jsx(eM,{restaurants:v,onRestaurantSelect:ti,activeFilters:_e,onLegendFilterChange:Qt,totalRestaurants:c.length,favorites:Xe}),L&&gt.jsx("div",{className:"restaurant-card-overlay",children:gt.jsx(iM,{restaurant:L,onClose:()=>B(null),isFavorited:Xe.includes(L.name),onToggleFavorite:()=>yi(L.name)})})]})]})}a5(document.getElementById("root")).render(gt.jsx(ta.StrictMode,{children:gt.jsx(nM,{})}));
